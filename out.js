function component(e,t){return function(i){i.prototype.is=e,void 0!==t&&(i.prototype.extends=t)}}function extend(e){return function(t){t.prototype.extends=e}}function template(e){return function(t){t.prototype.template=e}}function style(e){return function(t){t.prototype.style=e}}function hostAttributes(e){return function(t){t.prototype.hostAttributes=e}}function property(e){return function(t,i){if(t.properties=t.properties||{},"function"==typeof t[i]){var n=e.computed,r="get_computed_"+i;e.computed=r+"("+n+")",t.properties[i]=e,t[r]=t[i]}else t.properties[i]=e||{}}}function computed(e){return function(t,i){t.properties=t.properties||{};var n=e||{},r="get_computed_"+i,o=t[i].toString(),s=o.indexOf("("),a=o.indexOf(")"),h=o.substring(s+1,a);n.computed=r+"("+h+")",t.properties[i]=n,t[r]=t[i]}}function listen(e){return function(t,i){t.listeners=t.listeners||{},t.listeners[e]=i}}function behavior(e){return function(t){if("function"==typeof t){t.prototype.behaviors=t.prototype.behaviors||[];var i=void 0===e.prototype?e:e.prototype;t.prototype.behaviors.push(i)}else{t.behaviors=t.behaviors||[];var i=void 0===e.prototype?e:e.prototype;t.behaviors.push(i)}}}function observe(e){return e.indexOf(",")>0||e.indexOf(".")>0?function(t,i){t.observers=t.observers||[],t.observers.push(i+"("+e+")")}:function(t,i){t.properties=t.properties||{},t.properties[e]=t.properties[e]||{},t.properties[e].observer=i}}function MakePromise(e){function t(e){if("object"!=typeof this||"function"!=typeof e)throw new TypeError;this._state=null,this._value=null,this._deferreds=[],s(e,n.bind(this),r.bind(this))}function i(t){var i=this;return null===this._state?void this._deferreds.push(t):void e(function(){var e=i._state?t.onFulfilled:t.onRejected;if("function"!=typeof e)return void(i._state?t.resolve:t.reject)(i._value);var n;try{n=e(i._value)}catch(e){return void t.reject(e)}t.resolve(n)})}function n(e){try{if(e===this)throw new TypeError;if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void s(t.bind(e),n.bind(this),r.bind(this))}this._state=!0,this._value=e,o.call(this)}catch(e){r.call(this,e)}}function r(e){this._state=!1,this._value=e,o.call(this)}function o(){for(var e=0,t=this._deferreds.length;e<t;e++)i.call(this,this._deferreds[e]);this._deferreds=null}function s(e,t,i){var n=!1;try{e(function(e){n||(n=!0,t(e))},function(e){n||(n=!0,i(e))})}catch(e){if(n)return;n=!0,i(e)}}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.then=function(e,n){var r=this;return new t(function(t,o){i.call(r,{onFulfilled:e,onRejected:n,resolve:t,reject:o})})},t.resolve=function(e){return e&&"object"==typeof e&&e.constructor===t?e:new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,i){i(e)})},t}window.Polymer={lazyRegister:!0,dom:"shadow"},!function(){window.WebComponents=window.WebComponents||{flags:{}};var e="webcomponents-lite.js",t=document.querySelector('script[src*="'+e+'"]'),i={};if(!i.noOpts){if(location.search.slice(1).split("&").forEach(function(e){var t,n=e.split("=");n[0]&&(t=n[0].match(/wc-(.+)/))&&(i[t[1]]=n[1]||!0)}),t)for(var n,r=0;n=t.attributes[r];r++)"src"!==n.name&&(i[n.name]=n.value||!0);if(i.log&&i.log.split){var o=i.log.split(",");i.log={},o.forEach(function(e){i.log[e]=!0})}else i.log={}}i.register&&(window.CustomElements=window.CustomElements||{flags:{}},window.CustomElements.flags.register=i.register),WebComponents.flags=i}(),function(e){"use strict";function t(e){return void 0!==u[e]}function i(){a.call(this),this._isInvalid=!0}function n(e){return""==e&&i.call(this),e.toLowerCase()}function r(e){var t=e.charCodeAt(0);return t>32&&t<127&&[34,35,60,62,63,96].indexOf(t)==-1?e:encodeURIComponent(e)}function o(e){var t=e.charCodeAt(0);return t>32&&t<127&&[34,35,60,62,96].indexOf(t)==-1?e:encodeURIComponent(e)}function s(e,s,a){function h(e){y.push(e)}var l=s||"scheme start",c=0,m="",g=!1,v=!1,y=[];e:for(;(e[c-1]!=f||0==c)&&!this._isInvalid;){var b=e[c];switch(l){case"scheme start":if(!b||!p.test(b)){if(s){h("Invalid scheme.");break e}m="",l="no scheme";continue}m+=b.toLowerCase(),l="scheme";break;case"scheme":if(b&&_.test(b))m+=b.toLowerCase();else{if(":"!=b){if(s){if(f==b)break e;h("Code point not allowed in scheme: "+b);break e}m="",c=0,l="no scheme";continue}if(this._scheme=m,m="",s)break e;t(this._scheme)&&(this._isRelative=!0),l="file"==this._scheme?"relative":this._isRelative&&a&&a._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"==b?(this._query="?",l="query"):"#"==b?(this._fragment="#",l="fragment"):f!=b&&"\t"!=b&&"\n"!=b&&"\r"!=b&&(this._schemeData+=r(b));break;case"no scheme":if(a&&t(a._scheme)){l="relative";continue}h("Missing scheme."),i.call(this);break;case"relative or authority":if("/"!=b||"/"!=e[c+1]){h("Expected /, got: "+b),l="relative";continue}l="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!=this._scheme&&(this._scheme=a._scheme),f==b){this._host=a._host,this._port=a._port,this._path=a._path.slice(),this._query=a._query,this._username=a._username,this._password=a._password;break e}if("/"==b||"\\"==b)"\\"==b&&h("\\ is an invalid code point."),l="relative slash";else if("?"==b)this._host=a._host,this._port=a._port,this._path=a._path.slice(),this._query="?",this._username=a._username,this._password=a._password,l="query";else{if("#"!=b){var x=e[c+1],P=e[c+2];("file"!=this._scheme||!p.test(b)||":"!=x&&"|"!=x||f!=P&&"/"!=P&&"\\"!=P&&"?"!=P&&"#"!=P)&&(this._host=a._host,this._port=a._port,this._username=a._username,this._password=a._password,this._path=a._path.slice(),this._path.pop()),l="relative path";continue}this._host=a._host,this._port=a._port,this._path=a._path.slice(),this._query=a._query,this._fragment="#",this._username=a._username,this._password=a._password,l="fragment"}break;case"relative slash":if("/"!=b&&"\\"!=b){"file"!=this._scheme&&(this._host=a._host,this._port=a._port,this._username=a._username,this._password=a._password),l="relative path";continue}"\\"==b&&h("\\ is an invalid code point."),l="file"==this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=b){h("Expected '/', got: "+b),l="authority ignore slashes";continue}l="authority second slash";break;case"authority second slash":if(l="authority ignore slashes","/"!=b){h("Expected '/', got: "+b);continue}break;case"authority ignore slashes":if("/"!=b&&"\\"!=b){l="authority";continue}h("Expected authority, got: "+b);break;case"authority":if("@"==b){g&&(h("@ already seen."),m+="%40"),g=!0;for(var A=0;A<m.length;A++){var C=m[A];if("\t"!=C&&"\n"!=C&&"\r"!=C)if(":"!=C||null!==this._password){var E=r(C);null!==this._password?this._password+=E:this._username+=E}else this._password="";else h("Invalid whitespace in authority.")}m=""}else{if(f==b||"/"==b||"\\"==b||"?"==b||"#"==b){c-=m.length,m="",l="host";continue}m+=b}break;case"file host":if(f==b||"/"==b||"\\"==b||"?"==b||"#"==b){2!=m.length||!p.test(m[0])||":"!=m[1]&&"|"!=m[1]?0==m.length?l="relative path start":(this._host=n.call(this,m),m="",l="relative path start"):l="relative path";continue}"\t"==b||"\n"==b||"\r"==b?h("Invalid whitespace in file host."):m+=b;break;case"host":case"hostname":if(":"!=b||v){if(f==b||"/"==b||"\\"==b||"?"==b||"#"==b){if(this._host=n.call(this,m),m="",l="relative path start",s)break e;continue}"\t"!=b&&"\n"!=b&&"\r"!=b?("["==b?v=!0:"]"==b&&(v=!1),m+=b):h("Invalid code point in host/hostname: "+b)}else if(this._host=n.call(this,m),m="",l="port","hostname"==s)break e;break;case"port":if(/[0-9]/.test(b))m+=b;else{if(f==b||"/"==b||"\\"==b||"?"==b||"#"==b||s){if(""!=m){var T=parseInt(m,10);T!=u[this._scheme]&&(this._port=T+""),m=""}if(s)break e;l="relative path start";continue}"\t"==b||"\n"==b||"\r"==b?h("Invalid code point in port: "+b):i.call(this)}break;case"relative path start":if("\\"==b&&h("'\\' not allowed in path."),l="relative path","/"!=b&&"\\"!=b)continue;break;case"relative path":if(f!=b&&"/"!=b&&"\\"!=b&&(s||"?"!=b&&"#"!=b))"\t"!=b&&"\n"!=b&&"\r"!=b&&(m+=r(b));else{"\\"==b&&h("\\ not allowed in relative path.");var S;(S=d[m.toLowerCase()])&&(m=S),".."==m?(this._path.pop(),"/"!=b&&"\\"!=b&&this._path.push("")):"."==m&&"/"!=b&&"\\"!=b?this._path.push(""):"."!=m&&("file"==this._scheme&&0==this._path.length&&2==m.length&&p.test(m[0])&&"|"==m[1]&&(m=m[0]+":"),this._path.push(m)),m="","?"==b?(this._query="?",l="query"):"#"==b&&(this._fragment="#",l="fragment")}break;case"query":s||"#"!=b?f!=b&&"\t"!=b&&"\n"!=b&&"\r"!=b&&(this._query+=o(b)):(this._fragment="#",l="fragment");break;case"fragment":f!=b&&"\t"!=b&&"\n"!=b&&"\r"!=b&&(this._fragment+=b)}c++}}function a(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function h(e,t){void 0===t||t instanceof h||(t=new h(String(t))),this._url=e,a.call(this);var i=e.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");s.call(this,i,null,t)}var l=!1;if(!e.forceJURL)try{var c=new URL("b","http://a");c.pathname="c%20d",l="http://a/c%20d"===c.href}catch(e){}if(!l){var u=Object.create(null);u.ftp=21,u.file=0,u.gopher=70,u.http=80,u.https=443,u.ws=80,u.wss=443;var d=Object.create(null);d["%2e"]=".",d[".%2e"]="..",d["%2e."]="..",d["%2e%2e"]="..";var f=void 0,p=/[a-zA-Z]/,_=/[a-zA-Z0-9\+\-\.]/;h.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var e="";return""==this._username&&null==this._password||(e=this._username+(null!=this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+e+this.host:"")+this.pathname+this._query+this._fragment},set href(e){a.call(this),s.call(this,e)},get protocol(){return this._scheme+":"},set protocol(e){this._isInvalid||s.call(this,e+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(e){!this._isInvalid&&this._isRelative&&s.call(this,e,"host")},get hostname(){return this._host},set hostname(e){!this._isInvalid&&this._isRelative&&s.call(this,e,"hostname")},get port(){return this._port},set port(e){!this._isInvalid&&this._isRelative&&s.call(this,e,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(e){!this._isInvalid&&this._isRelative&&(this._path=[],s.call(this,e,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"==this._query?"":this._query},set search(e){!this._isInvalid&&this._isRelative&&(this._query="?","?"==e[0]&&(e=e.slice(1)),s.call(this,e,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment},set hash(e){this._isInvalid||(this._fragment="#","#"==e[0]&&(e=e.slice(1)),s.call(this,e,"fragment"))},get origin(){var e;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null"}return e=this.host,e?this._scheme+"://"+e:""}};var m=e.URL;m&&(h.createObjectURL=function(e){return m.createObjectURL.apply(m,arguments)},h.revokeObjectURL=function(e){m.revokeObjectURL(e)}),e.URL=h}}(self),"undefined"==typeof WeakMap&&!function(){var e=Object.defineProperty,t=Date.now()%1e9,i=function(){this.name="__st"+(1e9*Math.random()>>>0)+(t++ +"__")};i.prototype={set:function(t,i){var n=t[this.name];return n&&n[0]===t?n[1]=i:e(t,this.name,{value:[t,i],writable:!0}),this},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},delete:function(e){var t=e[this.name];return!(!t||t[0]!==e||(t[0]=t[1]=void 0,0))},has:function(e){var t=e[this.name];return!!t&&t[0]===e}},window.WeakMap=i}(),function(e){function t(e){b.push(e),y||(y=!0,_(n))}function i(e){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(e)||e}function n(){y=!1;var e=b;b=[],e.sort(function(e,t){return e.uid_-t.uid_});var t=!1;e.forEach(function(e){var i=e.takeRecords();r(e),i.length&&(e.callback_(i,e),t=!0)}),t&&n()}function r(e){e.nodes_.forEach(function(t){var i=m.get(t);i&&i.forEach(function(t){t.observer===e&&t.removeTransientObservers()})})}function o(e,t){for(var i=e;i;i=i.parentNode){var n=m.get(i);if(n)for(var r=0;r<n.length;r++){var o=n[r],s=o.options;if(i===e||s.subtree){var a=t(s);a&&o.enqueue(a)}}}}function s(e){this.callback_=e,this.nodes_=[],this.records_=[],this.uid_=++x}function a(e,t){this.type=e,this.target=t,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function h(e){var t=new a(e.type,e.target);return t.addedNodes=e.addedNodes.slice(),t.removedNodes=e.removedNodes.slice(),t.previousSibling=e.previousSibling,t.nextSibling=e.nextSibling,t.attributeName=e.attributeName,t.attributeNamespace=e.attributeNamespace,t.oldValue=e.oldValue,t}function l(e,t){return P=new a(e,t)}function c(e){return A?A:(A=h(P),A.oldValue=e,A)}function u(){P=A=void 0}function d(e){return e===A||e===P}function f(e,t){return e===t?e:A&&d(e)?A:null}function p(e,t,i){this.observer=e,this.target=t,this.options=i,this.transientObservedNodes=[]}if(!e.JsMutationObserver){var _,m=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))_=setTimeout;else if(window.setImmediate)_=window.setImmediate;else{var g=[],v=String(Math.random());window.addEventListener("message",function(e){if(e.data===v){var t=g;g=[],t.forEach(function(e){e()})}}),_=function(e){g.push(e),window.postMessage(v,"*")}}var y=!1,b=[],x=0;s.prototype={observe:function(e,t){if(e=i(e),!t.childList&&!t.attributes&&!t.characterData||t.attributeOldValue&&!t.attributes||t.attributeFilter&&t.attributeFilter.length&&!t.attributes||t.characterDataOldValue&&!t.characterData)throw new SyntaxError;var n=m.get(e);n||m.set(e,n=[]);for(var r,o=0;o<n.length;o++)if(n[o].observer===this){r=n[o],r.removeListeners(),r.options=t;break}r||(r=new p(this,e,t),n.push(r),this.nodes_.push(e)),r.addListeners()},disconnect:function(){this.nodes_.forEach(function(e){for(var t=m.get(e),i=0;i<t.length;i++){var n=t[i];if(n.observer===this){n.removeListeners(),t.splice(i,1);break}}},this),this.records_=[]},takeRecords:function(){var e=this.records_;return this.records_=[],e}};var P,A;p.prototype={enqueue:function(e){var i=this.observer.records_,n=i.length;if(i.length>0){var r=i[n-1],o=f(r,e);if(o)return void(i[n-1]=o)}else t(this.observer);i[n]=e},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(e){var t=this.options;t.attributes&&e.addEventListener("DOMAttrModified",this,!0),t.characterData&&e.addEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.addEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(e){var t=this.options;t.attributes&&e.removeEventListener("DOMAttrModified",this,!0),t.characterData&&e.removeEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.removeEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(e){if(e!==this.target){this.addListeners_(e),this.transientObservedNodes.push(e);var t=m.get(e);t||m.set(e,t=[]),t.push(this)}},removeTransientObservers:function(){var e=this.transientObservedNodes;this.transientObservedNodes=[],e.forEach(function(e){this.removeListeners_(e);for(var t=m.get(e),i=0;i<t.length;i++)if(t[i]===this){t.splice(i,1);break}},this)},handleEvent:function(e){switch(e.stopImmediatePropagation(),e.type){case"DOMAttrModified":var t=e.attrName,i=e.relatedNode.namespaceURI,n=e.target,r=new l("attributes",n);r.attributeName=t,r.attributeNamespace=i;var s=e.attrChange===MutationEvent.ADDITION?null:e.prevValue;o(n,function(e){if(e.attributes&&(!e.attributeFilter||!e.attributeFilter.length||e.attributeFilter.indexOf(t)!==-1||e.attributeFilter.indexOf(i)!==-1))return e.attributeOldValue?c(s):r});break;case"DOMCharacterDataModified":var n=e.target,r=l("characterData",n),s=e.prevValue;o(n,function(e){if(e.characterData)return e.characterDataOldValue?c(s):r});break;case"DOMNodeRemoved":this.addTransientObserver(e.target);case"DOMNodeInserted":var a,h,d=e.target;"DOMNodeInserted"===e.type?(a=[d],h=[]):(a=[],h=[d]);var f=d.previousSibling,p=d.nextSibling,r=l("childList",e.target.parentNode);r.addedNodes=a,r.removedNodes=h,r.previousSibling=f,r.nextSibling=p,o(e.relatedNode,function(e){if(e.childList)return r})}u()}},e.JsMutationObserver=s,e.MutationObserver||(e.MutationObserver=s,s._isPolyfilled=!0)}}(self),function(){function e(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case"Â ":return"&nbsp;"}}function t(t){return t.replace(u,e)}var i="undefined"==typeof HTMLTemplateElement;/Trident/.test(navigator.userAgent)&&!function(){var e=document.importNode;document.importNode=function(){var t=e.apply(document,arguments);if(t.nodeType===Node.DOCUMENT_FRAGMENT_NODE){var i=document.createDocumentFragment();return i.appendChild(t),i}return t}}();var n=function(){if(!i){var e=document.createElement("template"),t=document.createElement("template");t.content.appendChild(document.createElement("div")),e.content.appendChild(t);var n=e.cloneNode(!0);return 0===n.content.childNodes.length||0===n.content.firstChild.content.childNodes.length}}(),r="template",o=function(){};if(i){var s=document.implementation.createHTMLDocument("template"),a=!0,h=document.createElement("style");h.textContent=r+"{display:none;}";var l=document.head;l.insertBefore(h,l.firstElementChild),o.prototype=Object.create(HTMLElement.prototype),o.decorate=function(e){if(!e.content){e.content=s.createDocumentFragment();for(var i;i=e.firstChild;)e.content.appendChild(i);if(e.cloneNode=function(e){return o.cloneNode(this,e)},a)try{Object.defineProperty(e,"innerHTML",{get:function(){for(var e="",i=this.content.firstChild;i;i=i.nextSibling)e+=i.outerHTML||t(i.data);return e},set:function(e){for(s.body.innerHTML=e,o.bootstrap(s);this.content.firstChild;)this.content.removeChild(this.content.firstChild);for(;s.body.firstChild;)this.content.appendChild(s.body.firstChild)},configurable:!0})}catch(e){a=!1}o.bootstrap(e.content)}},o.bootstrap=function(e){for(var t,i=e.querySelectorAll(r),n=0,s=i.length;n<s&&(t=i[n]);n++)o.decorate(t)},document.addEventListener("DOMContentLoaded",function(){o.bootstrap(document)});var c=document.createElement;document.createElement=function(){"use strict";var e=c.apply(document,arguments);return"template"===e.localName&&o.decorate(e),e};var u=/[&\u00A0<>]/g}if(i||n){var d=Node.prototype.cloneNode;o.cloneNode=function(e,t){var i=d.call(e,!1);return this.decorate&&this.decorate(i),t&&(i.content.appendChild(d.call(e.content,!0)),this.fixClonedDom(i.content,e.content)),i},o.fixClonedDom=function(e,t){if(t.querySelectorAll)for(var i,n,o=t.querySelectorAll(r),s=e.querySelectorAll(r),a=0,h=s.length;a<h;a++)n=o[a],i=s[a],this.decorate&&this.decorate(n),i.parentNode.replaceChild(n.cloneNode(!0),i)};var f=document.importNode;Node.prototype.cloneNode=function(e){var t=d.call(this,e);return e&&o.fixClonedDom(t,this),t},document.importNode=function(e,t){if(e.localName===r)return o.cloneNode(e,t);var i=f.call(document,e,t);return t&&o.fixClonedDom(i,e),i},n&&(HTMLTemplateElement.prototype.cloneNode=function(e){return o.cloneNode(this,e)})}i&&(window.HTMLTemplateElement=o)}(),function(e){"use strict";if(!window.performance||!window.performance.now){var t=Date.now();window.performance={now:function(){return Date.now()-t}}}window.requestAnimationFrame||(window.requestAnimationFrame=function(){var e=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return e?function(t){return e(function(){t(performance.now())})}:function(e){return window.setTimeout(e,1e3/60)}}()),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(){return window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)}}());var i=function(){var e=document.createEvent("Event");return e.initEvent("foo",!0,!0),e.preventDefault(),e.defaultPrevented}();if(!i){var n=Event.prototype.preventDefault;Event.prototype.preventDefault=function(){this.cancelable&&(n.call(this),Object.defineProperty(this,"defaultPrevented",{get:function(){return!0},configurable:!0}))}}var r=/Trident/.test(navigator.userAgent);if((!window.CustomEvent||r&&"function"!=typeof window.CustomEvent)&&(window.CustomEvent=function(e,t){t=t||{};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,Boolean(t.bubbles),Boolean(t.cancelable),t.detail),i},window.CustomEvent.prototype=window.Event.prototype),!window.Event||r&&"function"!=typeof window.Event){var o=window.Event;window.Event=function(e,t){t=t||{};var i=document.createEvent("Event");return i.initEvent(e,Boolean(t.bubbles),Boolean(t.cancelable)),i},window.Event.prototype=o.prototype}}(window.WebComponents),window.HTMLImports=window.HTMLImports||{flags:{}},function(e){function t(e,t){t=t||p,n(function(){o(e,t)},t)}function i(e){return"complete"===e.readyState||e.readyState===g}function n(e,t){if(i(t))e&&e();else{var r=function(){"complete"!==t.readyState&&t.readyState!==g||(t.removeEventListener(v,r),n(e,t))};t.addEventListener(v,r)}}function r(e){e.target.__loaded=!0}function o(e,t){function i(){h==l&&e&&e({allImports:a,loadedImports:c,errorImports:u})}function n(e){r(e),c.push(this),h++,i()}function o(e){u.push(this),h++,i()}var a=t.querySelectorAll("link[rel=import]"),h=0,l=a.length,c=[],u=[];if(l)for(var d,f=0;f<l&&(d=a[f]);f++)s(d)?(c.push(this),h++,i()):(d.addEventListener("load",n),d.addEventListener("error",o));else i()}function s(e){return u?e.__loaded||e.import&&"loading"!==e.import.readyState:e.__importParsed}function a(e){for(var t,i=0,n=e.length;i<n&&(t=e[i]);i++)h(t)&&l(t)}function h(e){return"link"===e.localName&&"import"===e.rel}function l(e){var t=e.import;t?r({target:e}):(e.addEventListener("load",r),e.addEventListener("error",r))}var c="import",u=Boolean(c in document.createElement("link")),d=Boolean(window.ShadowDOMPolyfill),f=function(e){return d?window.ShadowDOMPolyfill.wrapIfNeeded(e):e},p=f(document),_={get:function(){var e=window.HTMLImports.currentScript||document.currentScript||("complete"!==document.readyState?document.scripts[document.scripts.length-1]:null);return f(e)},configurable:!0};Object.defineProperty(document,"_currentScript",_),Object.defineProperty(p,"_currentScript",_);var m=/Trident/.test(navigator.userAgent),g=m?"complete":"interactive",v="readystatechange";u&&(new MutationObserver(function(e){for(var t,i=0,n=e.length;i<n&&(t=e[i]);i++)t.addedNodes&&a(t.addedNodes)}).observe(document.head,{childList:!0}),function(){if("loading"===document.readyState)for(var e,t=document.querySelectorAll("link[rel=import]"),i=0,n=t.length;i<n&&(e=t[i]);i++)l(e)}()),t(function(e){window.HTMLImports.ready=!0,window.HTMLImports.readyTime=(new Date).getTime();var t=p.createEvent("CustomEvent");t.initCustomEvent("HTMLImportsLoaded",!0,!0,e),p.dispatchEvent(t)}),e.IMPORT_LINK_TYPE=c,e.useNative=u,e.rootDocument=p,e.whenReady=t,e.isIE=m}(window.HTMLImports),function(e){var t=[],i=function(e){t.push(e)},n=function(){t.forEach(function(t){t(e)})};e.addModule=i,e.initializeModules=n}(window.HTMLImports),window.HTMLImports.addModule(function(e){var t=/(url\()([^)]*)(\))/g,i=/(@import[\s]+(?!url\())([^;]*)(;)/g,n={resolveUrlsInStyle:function(e,t){var i=e.ownerDocument,n=i.createElement("a");return e.textContent=this.resolveUrlsInCssText(e.textContent,t,n),e},resolveUrlsInCssText:function(e,n,r){var o=this.replaceUrls(e,r,n,t);return o=this.replaceUrls(o,r,n,i)},replaceUrls:function(e,t,i,n){return e.replace(n,function(e,n,r,o){var s=r.replace(/["']/g,"");return i&&(s=new URL(s,i).href),t.href=s,s=t.href,n+"'"+s+"'"+o})}};e.path=n}),window.HTMLImports.addModule(function(e){var t={async:!0,ok:function(e){return e.status>=200&&e.status<300||304===e.status||0===e.status},load:function(i,n,r){var o=new XMLHttpRequest;return(e.flags.debug||e.flags.bust)&&(i+="?"+Math.random()),o.open("GET",i,t.async),o.addEventListener("readystatechange",function(e){if(4===o.readyState){var i=null;try{var s=o.getResponseHeader("Location");s&&(i="/"===s.substr(0,1)?location.origin+s:s)}catch(e){console.error(e.message)}n.call(r,!t.ok(o)&&o,o.response||o.responseText,i)}}),o.send(),o},loadDocument:function(e,t,i){this.load(e,t,i).responseType="document"}};e.xhr=t}),window.HTMLImports.addModule(function(e){var t=e.xhr,i=e.flags,n=function(e,t){this.cache={},this.onload=e,this.oncomplete=t,this.inflight=0,this.pending={}};n.prototype={addNodes:function(e){this.inflight+=e.length;for(var t,i=0,n=e.length;i<n&&(t=e[i]);i++)this.require(t);this.checkDone()},addNode:function(e){this.inflight++,this.require(e),this.checkDone()},require:function(e){var t=e.src||e.href;e.__nodeUrl=t,this.dedupe(t,e)||this.fetch(t,e)},dedupe:function(e,t){return this.pending[e]?(this.pending[e].push(t),!0):this.cache[e]?(this.onload(e,t,this.cache[e]),this.tail(),!0):(this.pending[e]=[t],!1)},fetch:function(e,n){if(i.load&&console.log("fetch",e,n),e)if(e.match(/^data:/)){var r=e.split(","),o=r[0],s=r[1];s=o.indexOf(";base64")>-1?atob(s):decodeURIComponent(s),setTimeout(function(){this.receive(e,n,null,s)}.bind(this),0)}else{var a=function(t,i,r){this.receive(e,n,t,i,r)}.bind(this);t.load(e,a)}else setTimeout(function(){this.receive(e,n,{error:"href must be specified"},null)}.bind(this),0)},receive:function(e,t,i,n,r){this.cache[e]=n;for(var o,s=this.pending[e],a=0,h=s.length;a<h&&(o=s[a]);a++)this.onload(e,o,n,i,r),this.tail();this.pending[e]=null},tail:function(){--this.inflight,this.checkDone()},checkDone:function(){this.inflight||this.oncomplete()}},e.Loader=n}),window.HTMLImports.addModule(function(e){var t=function(e){this.addCallback=e,this.mo=new MutationObserver(this.handler.bind(this))};t.prototype={handler:function(e){for(var t,i=0,n=e.length;i<n&&(t=e[i]);i++)"childList"===t.type&&t.addedNodes.length&&this.addedNodes(t.addedNodes)},addedNodes:function(e){this.addCallback&&this.addCallback(e);for(var t,i=0,n=e.length;i<n&&(t=e[i]);i++)t.children&&t.children.length&&this.addedNodes(t.children)},observe:function(e){this.mo.observe(e,{childList:!0,subtree:!0})}},e.Observer=t}),window.HTMLImports.addModule(function(e){function t(e){return"link"===e.localName&&e.rel===c}function i(e){var t=n(e);return"data:text/javascript;charset=utf-8,"+encodeURIComponent(t)}function n(e){return e.textContent+r(e)}function r(e){var t=e.ownerDocument;t.__importedScripts=t.__importedScripts||0;var i=e.ownerDocument.baseURI,n=t.__importedScripts?"-"+t.__importedScripts:"";return t.__importedScripts++,"\n//# sourceURL="+i+n+".js\n"}function o(e){var t=e.ownerDocument.createElement("style");return t.textContent=e.textContent,s.resolveUrlsInStyle(t),t}var s=e.path,a=e.rootDocument,h=e.flags,l=e.isIE,c=e.IMPORT_LINK_TYPE,u="link[rel="+c+"]",d={documentSelectors:u,importsSelectors:[u,"link[rel=stylesheet]:not([type])","style:not([type])","script:not([type])",'script[type="application/javascript"]','script[type="text/javascript"]'].join(","),map:{link:"parseLink",script:"parseScript",style:"parseStyle"},dynamicElements:[],parseNext:function(){var e=this.nextToParse();e&&this.parse(e)},parse:function(e){if(this.isParsed(e))return void(h.parse&&console.log("[%s] is already parsed",e.localName));var t=this[this.map[e.localName]];t&&(this.markParsing(e),t.call(this,e))},parseDynamic:function(e,t){this.dynamicElements.push(e),t||this.parseNext()},markParsing:function(e){h.parse&&console.log("parsing",e),this.parsingElement=e},markParsingComplete:function(e){e.__importParsed=!0,this.markDynamicParsingComplete(e),e.__importElement&&(e.__importElement.__importParsed=!0,this.markDynamicParsingComplete(e.__importElement)),this.parsingElement=null,h.parse&&console.log("completed",e)},markDynamicParsingComplete:function(e){var t=this.dynamicElements.indexOf(e);t>=0&&this.dynamicElements.splice(t,1)},parseImport:function(e){if(e.import=e.__doc,window.HTMLImports.__importsParsingHook&&window.HTMLImports.__importsParsingHook(e),e.import&&(e.import.__importParsed=!0),this.markParsingComplete(e),e.__resource&&!e.__error?e.dispatchEvent(new CustomEvent("load",{bubbles:!1})):e.dispatchEvent(new CustomEvent("error",{bubbles:!1})),e.__pending)for(var t;e.__pending.length;)t=e.__pending.shift(),t&&t({target:e});this.parseNext()},parseLink:function(e){t(e)?this.parseImport(e):(e.href=e.href,this.parseGeneric(e))},parseStyle:function(e){var t=e;e=o(e),t.__appliedElement=e,e.__importElement=t,this.parseGeneric(e)},parseGeneric:function(e){this.trackElement(e),this.addElementToDocument(e)},rootImportForElement:function(e){for(var t=e;t.ownerDocument.__importLink;)t=t.ownerDocument.__importLink;return t},addElementToDocument:function(e){var t=this.rootImportForElement(e.__importElement||e);t.parentNode.insertBefore(e,t)},trackElement:function(e,t){var i=this,n=function(r){e.removeEventListener("load",n),e.removeEventListener("error",n),t&&t(r),i.markParsingComplete(e),i.parseNext()};if(e.addEventListener("load",n),e.addEventListener("error",n),l&&"style"===e.localName){var r=!1;if(e.textContent.indexOf("@import")==-1)r=!0;else if(e.sheet){r=!0;for(var o,s=e.sheet.cssRules,a=s?s.length:0,h=0;h<a&&(o=s[h]);h++)o.type===CSSRule.IMPORT_RULE&&(r=r&&Boolean(o.styleSheet))}r&&setTimeout(function(){e.dispatchEvent(new CustomEvent("load",{bubbles:!1}))})}},parseScript:function(t){var n=document.createElement("script");n.__importElement=t,n.src=t.src?t.src:i(t),e.currentScript=t,this.trackElement(n,function(t){n.parentNode&&n.parentNode.removeChild(n),e.currentScript=null}),this.addElementToDocument(n)},nextToParse:function(){return this._mayParse=[],!this.parsingElement&&(this.nextToParseInDoc(a)||this.nextToParseDynamic())},nextToParseInDoc:function(e,i){if(e&&this._mayParse.indexOf(e)<0){this._mayParse.push(e);for(var n,r=e.querySelectorAll(this.parseSelectorsForNode(e)),o=0,s=r.length;o<s&&(n=r[o]);o++)if(!this.isParsed(n))return this.hasResource(n)?t(n)?this.nextToParseInDoc(n.__doc,n):n:void 0}return i},nextToParseDynamic:function(){return this.dynamicElements[0]},parseSelectorsForNode:function(e){var t=e.ownerDocument||e;return t===a?this.documentSelectors:this.importsSelectors},isParsed:function(e){return e.__importParsed},needsDynamicParsing:function(e){return this.dynamicElements.indexOf(e)>=0},hasResource:function(e){return!t(e)||void 0!==e.__doc}};e.parser=d,e.IMPORT_SELECTOR=u}),window.HTMLImports.addModule(function(e){function t(e){return i(e,s)}function i(e,t){return"link"===e.localName&&e.getAttribute("rel")===t}function n(e){return!!Object.getOwnPropertyDescriptor(e,"baseURI")}function r(e,t){var i=document.implementation.createHTMLDocument(s);i._URL=t;var r=i.createElement("base");r.setAttribute("href",t),i.baseURI||n(i)||Object.defineProperty(i,"baseURI",{value:t});var o=i.createElement("meta");return o.setAttribute("charset","utf-8"),i.head.appendChild(o),i.head.appendChild(r),i.body.innerHTML=e,window.HTMLTemplateElement&&HTMLTemplateElement.bootstrap&&HTMLTemplateElement.bootstrap(i),i}var o=e.flags,s=e.IMPORT_LINK_TYPE,a=e.IMPORT_SELECTOR,h=e.rootDocument,l=e.Loader,c=e.Observer,u=e.parser,d={documents:{},documentPreloadSelectors:a,importsPreloadSelectors:[a].join(","),loadNode:function(e){f.addNode(e)},loadSubtree:function(e){var t=this.marshalNodes(e);f.addNodes(t)},marshalNodes:function(e){return e.querySelectorAll(this.loadSelectorsForNode(e))},loadSelectorsForNode:function(e){var t=e.ownerDocument||e;return t===h?this.documentPreloadSelectors:this.importsPreloadSelectors},loaded:function(e,i,n,s,a){if(o.load&&console.log("loaded",e,i),i.__resource=n,i.__error=s,t(i)){var h=this.documents[e];void 0===h&&(h=s?null:r(n,a||e),h&&(h.__importLink=i,this.bootDocument(h)),this.documents[e]=h),i.__doc=h}u.parseNext()},bootDocument:function(e){this.loadSubtree(e),this.observer.observe(e),u.parseNext()},
loadedAll:function(){u.parseNext()}},f=new l(d.loaded.bind(d),d.loadedAll.bind(d));if(d.observer=new c,!document.baseURI){var p={get:function(){var e=document.querySelector("base");return e?e.href:window.location.href},configurable:!0};Object.defineProperty(document,"baseURI",p),Object.defineProperty(h,"baseURI",p)}e.importer=d,e.importLoader=f}),window.HTMLImports.addModule(function(e){var t=e.parser,i=e.importer,n={added:function(e){for(var n,r,o,s,a=0,h=e.length;a<h&&(s=e[a]);a++)n||(n=s.ownerDocument,r=t.isParsed(n)),o=this.shouldLoadNode(s),o&&i.loadNode(s),this.shouldParseNode(s)&&r&&t.parseDynamic(s,o)},shouldLoadNode:function(e){return 1===e.nodeType&&r.call(e,i.loadSelectorsForNode(e))},shouldParseNode:function(e){return 1===e.nodeType&&r.call(e,t.parseSelectorsForNode(e))}};i.observer.addCallback=n.added.bind(n);var r=HTMLElement.prototype.matches||HTMLElement.prototype.matchesSelector||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector}),function(e){function t(){window.HTMLImports.importer.bootDocument(n)}var i=e.initializeModules;if(e.isIE,!e.useNative){i();var n=e.rootDocument;"complete"===document.readyState||"interactive"===document.readyState&&!window.attachEvent?t():document.addEventListener("DOMContentLoaded",t)}}(window.HTMLImports),window.CustomElements=window.CustomElements||{flags:{}},function(e){var t=e.flags,i=[],n=function(e){i.push(e)},r=function(){i.forEach(function(t){t(e)})};e.addModule=n,e.initializeModules=r,e.hasNative=Boolean(document.registerElement),e.isIE=/Trident/.test(navigator.userAgent),e.useNative=!t.register&&e.hasNative&&!window.ShadowDOMPolyfill&&(!window.HTMLImports||window.HTMLImports.useNative)}(window.CustomElements),window.CustomElements.addModule(function(e){function t(e,t){i(e,function(e){return!!t(e)||void n(e,t)}),n(e,t)}function i(e,t,n){var r=e.firstElementChild;if(!r)for(r=e.firstChild;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.nextSibling;for(;r;)t(r,n)!==!0&&i(r,t,n),r=r.nextElementSibling;return null}function n(e,i){for(var n=e.shadowRoot;n;)t(n,i),n=n.olderShadowRoot}function r(e,t){o(e,t,[])}function o(e,t,i){if(e=window.wrap(e),!(i.indexOf(e)>=0)){i.push(e);for(var n,r=e.querySelectorAll("link[rel="+s+"]"),a=0,h=r.length;a<h&&(n=r[a]);a++)n.import&&o(n.import,t,i);t(e)}}var s=window.HTMLImports?window.HTMLImports.IMPORT_LINK_TYPE:"none";e.forDocumentTree=r,e.forSubtree=t}),window.CustomElements.addModule(function(e){function t(e,t){return i(e,t)||n(e,t)}function i(t,i){return!!e.upgrade(t,i)||void(i&&s(t))}function n(e,t){y(e,function(e){if(i(e,t))return!0})}function r(e){A.push(e),P||(P=!0,setTimeout(o))}function o(){P=!1;for(var e,t=A,i=0,n=t.length;i<n&&(e=t[i]);i++)e();A=[]}function s(e){x?r(function(){a(e)}):a(e)}function a(e){e.__upgraded__&&!e.__attached&&(e.__attached=!0,e.attachedCallback&&e.attachedCallback())}function h(e){l(e),y(e,function(e){l(e)})}function l(e){x?r(function(){c(e)}):c(e)}function c(e){e.__upgraded__&&e.__attached&&(e.__attached=!1,e.detachedCallback&&e.detachedCallback())}function u(e){for(var t=e,i=window.wrap(document);t;){if(t==i)return!0;t=t.parentNode||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&t.host}}function d(e){if(e.shadowRoot&&!e.shadowRoot.__watched){v.dom&&console.log("watching shadow-root for: ",e.localName);for(var t=e.shadowRoot;t;)_(t),t=t.olderShadowRoot}}function f(e,i){if(v.dom){var n=i[0];if(n&&"childList"===n.type&&n.addedNodes&&n.addedNodes){for(var r=n.addedNodes[0];r&&r!==document&&!r.host;)r=r.parentNode;var o=r&&(r.URL||r._URL||r.host&&r.host.localName)||"";o=o.split("/?").shift().split("/").pop()}console.group("mutations (%d) [%s]",i.length,o||"")}var s=u(e);i.forEach(function(e){"childList"===e.type&&(C(e.addedNodes,function(e){e.localName&&t(e,s)}),C(e.removedNodes,function(e){e.localName&&h(e)}))}),v.dom&&console.groupEnd()}function p(e){for(e=window.wrap(e),e||(e=window.wrap(document));e.parentNode;)e=e.parentNode;var t=e.__observer;t&&(f(e,t.takeRecords()),o())}function _(e){if(!e.__observer){var t=new MutationObserver(f.bind(this,e));t.observe(e,{childList:!0,subtree:!0}),e.__observer=t}}function m(e){e=window.wrap(e),v.dom&&console.group("upgradeDocument: ",e.baseURI.split("/").pop());var i=e===window.wrap(document);t(e,i),_(e),v.dom&&console.groupEnd()}function g(e){b(e,m)}var v=e.flags,y=e.forSubtree,b=e.forDocumentTree,x=window.MutationObserver._isPolyfilled&&v["throttle-attached"];e.hasPolyfillMutations=x,e.hasThrottledAttached=x;var P=!1,A=[],C=Array.prototype.forEach.call.bind(Array.prototype.forEach),E=Element.prototype.createShadowRoot;E&&(Element.prototype.createShadowRoot=function(){var e=E.call(this);return window.CustomElements.watchShadow(this),e}),e.watchShadow=d,e.upgradeDocumentTree=g,e.upgradeDocument=m,e.upgradeSubtree=n,e.upgradeAll=t,e.attached=s,e.takeRecords=p}),window.CustomElements.addModule(function(e){function t(t,n){if("template"===t.localName&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(t),!t.__upgraded__&&t.nodeType===Node.ELEMENT_NODE){var r=t.getAttribute("is"),o=e.getRegisteredDefinition(t.localName)||e.getRegisteredDefinition(r);if(o&&(r&&o.tag==t.localName||!r&&!o.extends))return i(t,o,n)}}function i(t,i,r){return s.upgrade&&console.group("upgrade:",t.localName),i.is&&t.setAttribute("is",i.is),n(t,i),t.__upgraded__=!0,o(t),r&&e.attached(t),e.upgradeSubtree(t,r),s.upgrade&&console.groupEnd(),t}function n(e,t){Object.__proto__?e.__proto__=t.prototype:(r(e,t.prototype,t.native),e.__proto__=t.prototype)}function r(e,t,i){for(var n={},r=t;r!==i&&r!==HTMLElement.prototype;){for(var o,s=Object.getOwnPropertyNames(r),a=0;o=s[a];a++)n[o]||(Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(r,o)),n[o]=1);r=Object.getPrototypeOf(r)}}function o(e){e.createdCallback&&e.createdCallback()}var s=e.flags;e.upgrade=t,e.upgradeWithDefinition=i,e.implementPrototype=n}),window.CustomElements.addModule(function(e){function t(t,n){var h=n||{};if(!t)throw new Error("document.registerElement: first argument `name` must not be empty");if(t.indexOf("-")<0)throw new Error("document.registerElement: first argument ('name') must contain a dash ('-'). Argument provided was '"+String(t)+"'.");if(r(t))throw new Error("Failed to execute 'registerElement' on 'Document': Registration failed for type '"+String(t)+"'. The type name is invalid.");if(l(t))throw new Error("DuplicateDefinitionError: a type with name '"+String(t)+"' is already registered");return h.prototype||(h.prototype=Object.create(HTMLElement.prototype)),h.__name=t.toLowerCase(),h.extends&&(h.extends=h.extends.toLowerCase()),h.lifecycle=h.lifecycle||{},h.ancestry=o(h.extends),s(h),a(h),i(h.prototype),c(h.__name,h),h.ctor=u(h),h.ctor.prototype=h.prototype,h.prototype.constructor=h.ctor,e.ready&&m(document),h.ctor}function i(e){if(!e.setAttribute._polyfilled){var t=e.setAttribute;e.setAttribute=function(e,i){n.call(this,e,i,t)};var i=e.removeAttribute;e.removeAttribute=function(e){n.call(this,e,null,i)},e.setAttribute._polyfilled=!0}}function n(e,t,i){e=e.toLowerCase();var n=this.getAttribute(e);i.apply(this,arguments);var r=this.getAttribute(e);this.attributeChangedCallback&&r!==n&&this.attributeChangedCallback(e,n,r)}function r(e){for(var t=0;t<x.length;t++)if(e===x[t])return!0}function o(e){var t=l(e);return t?o(t.extends).concat([t]):[]}function s(e){for(var t,i=e.extends,n=0;t=e.ancestry[n];n++)i=t.is&&t.tag;e.tag=i||e.__name,i&&(e.is=e.__name)}function a(e){if(!Object.__proto__){var t=HTMLElement.prototype;if(e.is){var i=document.createElement(e.tag);t=Object.getPrototypeOf(i)}for(var n,r=e.prototype,o=!1;r;)r==t&&(o=!0),n=Object.getPrototypeOf(r),n&&(r.__proto__=n),r=n;o||console.warn(e.tag+" prototype not found in prototype chain for "+e.is),e.native=t}}function h(e){return v(C(e.tag),e)}function l(e){if(e)return P[e.toLowerCase()]}function c(e,t){P[e]=t}function u(e){return function(){return h(e)}}function d(e,t,i){return e===A?f(t,i):E(e,t)}function f(e,t){e&&(e=e.toLowerCase()),t&&(t=t.toLowerCase());var i=l(t||e);if(i){if(e==i.tag&&t==i.is)return new i.ctor;if(!t&&!i.is)return new i.ctor}var n;return t?(n=f(e),n.setAttribute("is",t),n):(n=C(e),e.indexOf("-")>=0&&y(n,HTMLElement),n)}function p(e,t){var i=e[t];e[t]=function(){var e=i.apply(this,arguments);return g(e),e}}var _,m=(e.isIE,e.upgradeDocumentTree),g=e.upgradeAll,v=e.upgradeWithDefinition,y=e.implementPrototype,b=e.useNative,x=["annotation-xml","color-profile","font-face","font-face-src","font-face-uri","font-face-format","font-face-name","missing-glyph"],P={},A="http://www.w3.org/1999/xhtml",C=document.createElement.bind(document),E=document.createElementNS.bind(document);_=Object.__proto__||b?function(e,t){return e instanceof t}:function(e,t){if(e instanceof t)return!0;for(var i=e;i;){if(i===t.prototype)return!0;i=i.__proto__}return!1},p(Node.prototype,"cloneNode"),p(document,"importNode"),document.registerElement=t,document.createElement=f,document.createElementNS=d,e.registry=P,e.instanceof=_,e.reservedTagList=x,e.getRegisteredDefinition=l,document.register=document.registerElement}),function(e){function t(){o(window.wrap(document)),window.CustomElements.ready=!0;var e=window.requestAnimationFrame||function(e){setTimeout(e,16)};e(function(){setTimeout(function(){window.CustomElements.readyTime=Date.now(),window.HTMLImports&&(window.CustomElements.elapsed=window.CustomElements.readyTime-window.HTMLImports.readyTime),document.dispatchEvent(new CustomEvent("WebComponentsReady",{bubbles:!0}))})})}var i=e.useNative,n=e.initializeModules;if(e.isIE,i){var r=function(){};e.watchShadow=r,e.upgrade=r,e.upgradeAll=r,e.upgradeDocumentTree=r,e.upgradeSubtree=r,e.takeRecords=r,e.instanceof=function(e,t){return e instanceof t}}else n();var o=e.upgradeDocumentTree,s=e.upgradeDocument;if(window.wrap||(window.ShadowDOMPolyfill?(window.wrap=window.ShadowDOMPolyfill.wrapIfNeeded,window.unwrap=window.ShadowDOMPolyfill.unwrapIfNeeded):window.wrap=window.unwrap=function(e){return e}),window.HTMLImports&&(window.HTMLImports.__importsParsingHook=function(e){e.import&&s(wrap(e.import))}),"complete"===document.readyState||e.flags.eager)t();else if("interactive"!==document.readyState||window.attachEvent||window.HTMLImports&&!window.HTMLImports.ready){var a=window.HTMLImports&&!window.HTMLImports.ready?"HTMLImportsLoaded":"DOMContentLoaded";window.addEventListener(a,t)}else t()}(window.CustomElements),function(e){var t=document.createElement("style");t.textContent="body {transition: opacity ease-in 0.2s; } \nbody[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } \n";var i=document.querySelector("head");i.insertBefore(t,i.firstChild)}(window.WebComponents),function(){function e(){document.body.removeAttribute("unresolved")}window.WebComponents?addEventListener("WebComponentsReady",e):"interactive"===document.readyState||"complete"===document.readyState?e():addEventListener("DOMContentLoaded",e)}(),window.Polymer={Settings:function(){var e=window.Polymer||{};if(!e.noUrlSettings)for(var t,i=location.search.slice(1).split("&"),n=0;n<i.length&&(t=i[n]);n++)t=t.split("="),t[0]&&(e[t[0]]=t[1]||!0);return e.wantShadow="shadow"===e.dom,e.hasShadow=Boolean(Element.prototype.createShadowRoot),e.nativeShadow=e.hasShadow&&!window.ShadowDOMPolyfill,e.useShadow=e.wantShadow&&e.hasShadow,e.hasNativeImports=Boolean("import"in document.createElement("link")),e.useNativeImports=e.hasNativeImports,e.useNativeCustomElements=!window.CustomElements||window.CustomElements.useNative,e.useNativeShadow=e.useShadow&&e.nativeShadow,e.usePolyfillProto=!e.useNativeCustomElements&&!Object.__proto__,e.hasNativeCSSProperties=!navigator.userAgent.match("AppleWebKit/601")&&window.CSS&&CSS.supports&&CSS.supports("box-shadow","0 0 0 var(--foo)"),e.useNativeCSSProperties=e.hasNativeCSSProperties&&e.lazyRegister&&e.useNativeCSSProperties,e}()},function(){var e=window.Polymer;window.Polymer=function(e){"function"==typeof e&&(e=e.prototype),e||(e={});var i=t(e);e=i.prototype;var n={prototype:e};return e.extends&&(n.extends=e.extends),Polymer.telemetry._registrate(e),document.registerElement(e.is,n),i};var t=function(e){var t=Polymer.Base;return e.extends&&(t=Polymer.Base._getExtendedPrototype(e.extends)),e=Polymer.Base.chainObject(e,t),e.registerCallback(),e.constructor};if(e)for(var i in e)Polymer[i]=e[i];Polymer.Class=t}(),Polymer.telemetry={registrations:[],_regLog:function(e){console.log("["+e.is+"]: registered")},_registrate:function(e){this.registrations.push(e),Polymer.log&&this._regLog(e)},dumpRegistrations:function(){this.registrations.forEach(this._regLog)}},Object.defineProperty(window,"currentImport",{enumerable:!0,configurable:!0,get:function(){return(document._currentScript||document.currentScript).ownerDocument}}),Polymer.RenderStatus={_ready:!1,_callbacks:[],whenReady:function(e){this._ready?e():this._callbacks.push(e)},_makeReady:function(){this._ready=!0;for(var e=0;e<this._callbacks.length;e++)this._callbacks[e]();this._callbacks=[]},_catchFirstRender:function(){requestAnimationFrame(function(){Polymer.RenderStatus._makeReady()})},_afterNextRenderQueue:[],_waitingNextRender:!1,afterNextRender:function(e,t,i){this._watchNextRender(),this._afterNextRenderQueue.push([e,t,i])},hasRendered:function(){return this._ready},_watchNextRender:function(){if(!this._waitingNextRender){this._waitingNextRender=!0;var e=function(){Polymer.RenderStatus._flushNextRender()};this._ready?requestAnimationFrame(e):this.whenReady(e)}},_flushNextRender:function(){var e=this;setTimeout(function(){e._flushRenderCallbacks(e._afterNextRenderQueue),e._afterNextRenderQueue=[],e._waitingNextRender=!1})},_flushRenderCallbacks:function(e){for(var t,i=0;i<e.length;i++)t=e[i],t[1].apply(t[0],t[2]||Polymer.nar)}},window.HTMLImports?HTMLImports.whenReady(function(){Polymer.RenderStatus._catchFirstRender()}):Polymer.RenderStatus._catchFirstRender(),Polymer.ImportStatus=Polymer.RenderStatus,Polymer.ImportStatus.whenLoaded=Polymer.ImportStatus.whenReady,function(){"use strict";var e=Polymer.Settings;Polymer.Base={__isPolymerInstance__:!0,_addFeature:function(e){this.extend(this,e)},registerCallback:function(){"max"===e.lazyRegister?this.beforeRegister&&this.beforeRegister():(this._desugarBehaviors(),this._doBehavior("beforeRegister")),this._registerFeatures(),e.lazyRegister||this.ensureRegisterFinished()},createdCallback:function(){this.__hasRegisterFinished||this._ensureRegisterFinished(this.__proto__),Polymer.telemetry.instanceCount++,this.root=this,this._doBehavior("created"),this._initFeatures()},ensureRegisterFinished:function(){this._ensureRegisterFinished(this)},_ensureRegisterFinished:function(t){t.__hasRegisterFinished===t.is&&t.is||("max"===e.lazyRegister&&(t._desugarBehaviors(),t._doBehaviorOnly("beforeRegister")),t.__hasRegisterFinished=t.is,t._finishRegisterFeatures&&t._finishRegisterFeatures(),t._doBehavior("registered"),e.usePolyfillProto&&t!==this&&t.extend(this,t))},attachedCallback:function(){var e=this;Polymer.RenderStatus.whenReady(function(){e.isAttached=!0,e._doBehavior("attached")})},detachedCallback:function(){var e=this;Polymer.RenderStatus.whenReady(function(){e.isAttached=!1,e._doBehavior("detached")})},attributeChangedCallback:function(e,t,i){this._attributeChangedImpl(e),this._doBehavior("attributeChanged",[e,t,i])},_attributeChangedImpl:function(e){this._setAttributeToProperty(this,e)},extend:function(e,t){if(e&&t)for(var i,n=Object.getOwnPropertyNames(t),r=0;r<n.length&&(i=n[r]);r++)this.copyOwnProperty(i,t,e);return e||t},mixin:function(e,t){for(var i in t)e[i]=t[i];return e},copyOwnProperty:function(e,t,i){var n=Object.getOwnPropertyDescriptor(t,e);n&&Object.defineProperty(i,e,n)},_logger:function(e,t){switch(1===t.length&&Array.isArray(t[0])&&(t=t[0]),e){case"log":case"warn":case"error":console[e].apply(console,t)}},_log:function(){var e=Array.prototype.slice.call(arguments,0);this._logger("log",e)},_warn:function(){var e=Array.prototype.slice.call(arguments,0);this._logger("warn",e)},_error:function(){var e=Array.prototype.slice.call(arguments,0);this._logger("error",e)},_logf:function(){return this._logPrefix.concat(this.is).concat(Array.prototype.slice.call(arguments,0))}},Polymer.Base._logPrefix=function(){var e=window.chrome&&!/edge/i.test(navigator.userAgent)||/firefox/i.test(navigator.userAgent);return e?["%c[%s::%s]:","font-weight: bold; background-color:#EEEE00;"]:["[%s::%s]:"]}(),Polymer.Base.chainObject=function(e,t){return e&&t&&e!==t&&(Object.__proto__||(e=Polymer.Base.extend(Object.create(t),e)),e.__proto__=t),e},Polymer.Base=Polymer.Base.chainObject(Polymer.Base,HTMLElement.prototype),window.CustomElements?Polymer.instanceof=CustomElements.instanceof:Polymer.instanceof=function(e,t){return e instanceof t},Polymer.isInstance=function(e){return Boolean(e&&e.__isPolymerInstance__)},Polymer.telemetry.instanceCount=0}(),function(){function e(){if(o)for(var e,t=document._currentScript||document.currentScript,i=t&&t.ownerDocument||document,n=i.querySelectorAll("dom-module"),r=n.length-1;r>=0&&(e=n[r]);r--){if(e.__upgraded__)return;CustomElements.upgrade(e)}}var t={},i={},n=function(e){return t[e]||i[e.toLowerCase()]},r=function(){return document.createElement("dom-module")};r.prototype=Object.create(HTMLElement.prototype),Polymer.Base.extend(r.prototype,{constructor:r,createdCallback:function(){this.register()},register:function(e){e=e||this.id||this.getAttribute("name")||this.getAttribute("is"),e&&(this.id=e,t[e]=this,i[e.toLowerCase()]=this)},import:function(t,i){if(t){var r=n(t);return r||(e(),r=n(t)),r&&i&&(r=r.querySelector(i)),r}}});var o=window.CustomElements&&!CustomElements.useNative;document.registerElement("dom-module",r)}(),Polymer.Base._addFeature({_prepIs:function(){if(!this.is){var e=(document._currentScript||document.currentScript).parentNode;if("dom-module"===e.localName){var t=e.id||e.getAttribute("name")||e.getAttribute("is");this.is=t}}this.is&&(this.is=this.is.toLowerCase())}}),Polymer.Base._addFeature({behaviors:[],_desugarBehaviors:function(){this.behaviors.length&&(this.behaviors=this._desugarSomeBehaviors(this.behaviors))},_desugarSomeBehaviors:function(e){var t=[];e=this._flattenBehaviorsList(e);for(var i=e.length-1;i>=0;i--){var n=e[i];t.indexOf(n)===-1&&(this._mixinBehavior(n),t.unshift(n))}return t},_flattenBehaviorsList:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];n instanceof Array?t=t.concat(this._flattenBehaviorsList(n)):n?t.push(n):this._warn(this._logf("_flattenBehaviorsList","behavior is null, check for missing or 404 import"))}return t},_mixinBehavior:function(e){for(var t,i=Object.getOwnPropertyNames(e),n=0;n<i.length&&(t=i[n]);n++)Polymer.Base._behaviorProperties[t]||this.hasOwnProperty(t)||this.copyOwnProperty(t,e,this)},_prepBehaviors:function(){this._prepFlattenedBehaviors(this.behaviors)},_prepFlattenedBehaviors:function(e){for(var t=0,i=e.length;t<i;t++)this._prepBehavior(e[t]);this._prepBehavior(this)},_doBehavior:function(e,t){for(var i=0;i<this.behaviors.length;i++)this._invokeBehavior(this.behaviors[i],e,t);this._invokeBehavior(this,e,t)},_doBehaviorOnly:function(e,t){for(var i=0;i<this.behaviors.length;i++)this._invokeBehavior(this.behaviors[i],e,t)},_invokeBehavior:function(e,t,i){var n=e[t];n&&n.apply(this,i||Polymer.nar)},_marshalBehaviors:function(){for(var e=0;e<this.behaviors.length;e++)this._marshalBehavior(this.behaviors[e]);this._marshalBehavior(this)}}),Polymer.Base._behaviorProperties={hostAttributes:!0,beforeRegister:!0,registered:!0,properties:!0,observers:!0,listeners:!0,created:!0,attached:!0,detached:!0,attributeChanged:!0,ready:!0},Polymer.Base._addFeature({_getExtendedPrototype:function(e){return this._getExtendedNativePrototype(e)},_nativePrototypes:{},_getExtendedNativePrototype:function(e){var t=this._nativePrototypes[e];if(!t){var i=this.getNativePrototype(e);t=this.extend(Object.create(i),Polymer.Base),this._nativePrototypes[e]=t}return t},getNativePrototype:function(e){return Object.getPrototypeOf(document.createElement(e))}}),Polymer.Base._addFeature({_prepConstructor:function(){this._factoryArgs=this.extends?[this.extends,this.is]:[this.is];var e=function(){return this._factory(arguments)};this.hasOwnProperty("extends")&&(e.extends=this.extends),Object.defineProperty(this,"constructor",{value:e,writable:!0,configurable:!0}),e.prototype=this},_factory:function(e){var t=document.createElement.apply(document,this._factoryArgs);return this.factoryImpl&&this.factoryImpl.apply(t,e),t}}),Polymer.nob=Object.create(null),Polymer.Base._addFeature({properties:{},getPropertyInfo:function(e){var t=this._getPropertyInfo(e,this.properties);if(!t)for(var i=0;i<this.behaviors.length;i++)if(t=this._getPropertyInfo(e,this.behaviors[i].properties))return t;return t||Polymer.nob},_getPropertyInfo:function(e,t){var i=t&&t[e];return"function"==typeof i&&(i=t[e]={type:i}),i&&(i.defined=!0),i},_prepPropertyInfo:function(){this._propertyInfo={};for(var e=0;e<this.behaviors.length;e++)this._addPropertyInfo(this._propertyInfo,this.behaviors[e].properties);this._addPropertyInfo(this._propertyInfo,this.properties),this._addPropertyInfo(this._propertyInfo,this._propertyEffects)},_addPropertyInfo:function(e,t){if(t){var i,n;for(var r in t)i=e[r],n=t[r],("_"!==r[0]||n.readOnly)&&(e[r]?(i.type||(i.type=n.type),i.readOnly||(i.readOnly=n.readOnly)):e[r]={type:"function"==typeof n?n:n.type,readOnly:n.readOnly,attribute:Polymer.CaseMap.camelToDashCase(r)})}}}),Polymer.CaseMap={_caseMap:{},_rx:{dashToCamel:/-[a-z]/g,camelToDash:/([A-Z])/g},dashToCamelCase:function(e){return this._caseMap[e]||(this._caseMap[e]=e.indexOf("-")<0?e:e.replace(this._rx.dashToCamel,function(e){return e[1].toUpperCase()}))},camelToDashCase:function(e){return this._caseMap[e]||(this._caseMap[e]=e.replace(this._rx.camelToDash,"-$1").toLowerCase())}},Polymer.Base._addFeature({_addHostAttributes:function(e){this._aggregatedAttributes||(this._aggregatedAttributes={}),e&&this.mixin(this._aggregatedAttributes,e)},_marshalHostAttributes:function(){this._aggregatedAttributes&&this._applyAttributes(this,this._aggregatedAttributes)},_applyAttributes:function(e,t){for(var i in t)if(!this.hasAttribute(i)&&"class"!==i){var n=t[i];this.serializeValueToAttribute(n,i,this)}},_marshalAttributes:function(){this._takeAttributesToModel(this)},_takeAttributesToModel:function(e){if(this.hasAttributes())for(var t in this._propertyInfo){var i=this._propertyInfo[t];this.hasAttribute(i.attribute)&&this._setAttributeToProperty(e,i.attribute,t,i)}},_setAttributeToProperty:function(e,t,i,n){if(!this._serializing&&(i=i||Polymer.CaseMap.dashToCamelCase(t),n=n||this._propertyInfo&&this._propertyInfo[i],n&&!n.readOnly)){var r=this.getAttribute(t);e[i]=this.deserialize(r,n.type)}},_serializing:!1,reflectPropertyToAttribute:function(e,t,i){this._serializing=!0,i=void 0===i?this[e]:i,this.serializeValueToAttribute(i,t||Polymer.CaseMap.camelToDashCase(e)),this._serializing=!1},serializeValueToAttribute:function(e,t,i){var n=this.serialize(e);i=i||this,void 0===n?i.removeAttribute(t):i.setAttribute(t,n)},deserialize:function(e,t){switch(t){case Number:e=Number(e);break;case Boolean:e=null!=e;break;case Object:try{e=JSON.parse(e)}catch(e){}break;case Array:try{e=JSON.parse(e)}catch(t){e=null,console.warn("Polymer::Attributes: couldn`t decode Array as JSON")}break;case Date:e=new Date(e);break;case String:}return e},serialize:function(e){switch(typeof e){case"boolean":return e?"":void 0;case"object":if(e instanceof Date)return e.toString();if(e)try{return JSON.stringify(e)}catch(e){return""}default:return null!=e?e:void 0}}}),Polymer.version="1.7.0",Polymer.Base._addFeature({_registerFeatures:function(){this._prepIs(),this._prepBehaviors(),this._prepConstructor(),this._prepPropertyInfo()},_prepBehavior:function(e){this._addHostAttributes(e.hostAttributes)},_marshalBehavior:function(e){},_initFeatures:function(){this._marshalHostAttributes(),this._marshalBehaviors()}}),Polymer.Base._addFeature({_prepTemplate:function(){void 0===this._template&&(this._template=Polymer.DomModule.import(this.is,"template")),this._template&&this._template.hasAttribute("is")&&this._warn(this._logf("_prepTemplate","top-level Polymer template must not be a type-extension, found",this._template,"Move inside simple <template>.")),this._template&&!this._template.content&&window.HTMLTemplateElement&&HTMLTemplateElement.decorate&&HTMLTemplateElement.decorate(this._template)},_stampTemplate:function(){this._template&&(this.root=this.instanceTemplate(this._template))},instanceTemplate:function(e){var t=document.importNode(e._content||e.content,!0);return t}}),function(){var e=Polymer.Base.attachedCallback;Polymer.Base._addFeature({_hostStack:[],ready:function(){},_registerHost:function(e){this.dataHost=e=e||Polymer.Base._hostStack[Polymer.Base._hostStack.length-1],e&&e._clients&&e._clients.push(this),this._clients=null,this._clientsReadied=!1},_beginHosting:function(){Polymer.Base._hostStack.push(this),this._clients||(this._clients=[])},_endHosting:function(){Polymer.Base._hostStack.pop()},_tryReady:function(){this._readied=!1,this._canReady()&&this._ready()},_canReady:function(){return!this.dataHost||this.dataHost._clientsReadied},_ready:function(){this._beforeClientsReady(),this._template&&(this._setupRoot(),this._readyClients()),this._clientsReadied=!0,this._clients=null,this._afterClientsReady(),this._readySelf()},_readyClients:function(){this._beginDistribute();var e=this._clients;if(e)for(var t,i=0,n=e.length;i<n&&(t=e[i]);i++)t._ready();this._finishDistribute()},_readySelf:function(){this._doBehavior("ready"),this._readied=!0,this._attachedPending&&(this._attachedPending=!1,this.attachedCallback())},_beforeClientsReady:function(){},_afterClientsReady:function(){},_beforeAttached:function(){},attachedCallback:function(){this._readied?(this._beforeAttached(),e.call(this)):this._attachedPending=!0}})}(),Polymer.ArraySplice=function(){function e(e,t,i){return{index:e,removed:t,addedCount:i}}function t(){}var i=0,n=1,r=2,o=3;return t.prototype={calcEditDistances:function(e,t,i,n,r,o){for(var s=o-r+1,a=i-t+1,h=new Array(s),l=0;l<s;l++)h[l]=new Array(a),h[l][0]=l;for(var c=0;c<a;c++)h[0][c]=c;for(l=1;l<s;l++)for(c=1;c<a;c++)if(this.equals(e[t+c-1],n[r+l-1]))h[l][c]=h[l-1][c-1];else{var u=h[l-1][c]+1,d=h[l][c-1]+1;h[l][c]=u<d?u:d}return h},spliceOperationsFromEditDistances:function(e){for(var t=e.length-1,s=e[0].length-1,a=e[t][s],h=[];t>0||s>0;)if(0!=t)if(0!=s){var l,c=e[t-1][s-1],u=e[t-1][s],d=e[t][s-1];l=u<d?u<c?u:c:d<c?d:c,l==c?(c==a?h.push(i):(h.push(n),a=c),t--,s--):l==u?(h.push(o),t--,a=u):(h.push(r),s--,a=d)}else h.push(o),t--;else h.push(r),s--;return h.reverse(),h},calcSplices:function(t,s,a,h,l,c){var u=0,d=0,f=Math.min(a-s,c-l);if(0==s&&0==l&&(u=this.sharedPrefix(t,h,f)),a==t.length&&c==h.length&&(d=this.sharedSuffix(t,h,f-u)),s+=u,l+=u,a-=d,c-=d,a-s==0&&c-l==0)return[];if(s==a){for(var p=e(s,[],0);l<c;)p.removed.push(h[l++]);return[p]}if(l==c)return[e(s,[],a-s)];var _=this.spliceOperationsFromEditDistances(this.calcEditDistances(t,s,a,h,l,c));p=void 0;for(var m=[],g=s,v=l,y=0;y<_.length;y++)switch(_[y]){case i:p&&(m.push(p),p=void 0),g++,v++;break;case n:p||(p=e(g,[],0)),p.addedCount++,g++,p.removed.push(h[v]),v++;break;case r:p||(p=e(g,[],0)),p.addedCount++,g++;break;case o:p||(p=e(g,[],0)),p.removed.push(h[v]),v++}return p&&m.push(p),m},sharedPrefix:function(e,t,i){for(var n=0;n<i;n++)if(!this.equals(e[n],t[n]))return n;return i},sharedSuffix:function(e,t,i){for(var n=e.length,r=t.length,o=0;o<i&&this.equals(e[--n],t[--r]);)o++;return o},calculateSplices:function(e,t){return this.calcSplices(e,0,e.length,t,0,t.length)},equals:function(e,t){return e===t}},new t}(),Polymer.domInnerHTML=function(){function e(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"Â ":return"&nbsp;"}}function t(t){return t.replace(s,e)}function i(t){return t.replace(a,e)}function n(e){for(var t={},i=0;i<e.length;i++)t[e[i]]=!0;return t}function r(e,n,r){switch(e.nodeType){case Node.ELEMENT_NODE:for(var s,a=e.localName,c="<"+a,u=e.attributes,d=0;s=u[d];d++)c+=" "+s.name+'="'+t(s.value)+'"';return c+=">",h[a]?c:c+o(e,r)+"</"+a+">";case Node.TEXT_NODE:var f=e.data;return n&&l[n.localName]?f:i(f);case Node.COMMENT_NODE:return"<!--"+e.data+"-->";default:throw console.error(e),new Error("not implemented")}}function o(e,t){e instanceof HTMLTemplateElement&&(e=e.content);for(var i,n="",o=Polymer.dom(e).childNodes,s=0,a=o.length;s<a&&(i=o[s]);s++)n+=r(i,e,t);return n}var s=/[&\u00A0"]/g,a=/[&\u00A0<>]/g,h=n(["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]),l=n(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);return{getInnerHTML:o}}(),function(){"use strict";var e=Element.prototype.insertBefore,t=Element.prototype.appendChild,i=Element.prototype.removeChild;Polymer.TreeApi={arrayCopyChildNodes:function(e){for(var t=[],i=0,n=e.firstChild;n;n=n.nextSibling)t[i++]=n;return t},arrayCopyChildren:function(e){for(var t=[],i=0,n=e.firstElementChild;n;n=n.nextElementSibling)t[i++]=n;return t},arrayCopy:function(e){for(var t=e.length,i=new Array(t),n=0;n<t;n++)i[n]=e[n];return i}},Polymer.TreeApi.Logical={hasParentNode:function(e){return Boolean(e.__dom&&e.__dom.parentNode)},hasChildNodes:function(e){return Boolean(e.__dom&&void 0!==e.__dom.childNodes)},getChildNodes:function(e){return this.hasChildNodes(e)?this._getChildNodes(e):e.childNodes},_getChildNodes:function(e){if(!e.__dom.childNodes){e.__dom.childNodes=[];for(var t=e.__dom.firstChild;t;t=t.__dom.nextSibling)e.__dom.childNodes.push(t)}return e.__dom.childNodes},getParentNode:function(e){return e.__dom&&void 0!==e.__dom.parentNode?e.__dom.parentNode:e.parentNode},getFirstChild:function(e){return e.__dom&&void 0!==e.__dom.firstChild?e.__dom.firstChild:e.firstChild},getLastChild:function(e){return e.__dom&&void 0!==e.__dom.lastChild?e.__dom.lastChild:e.lastChild},getNextSibling:function(e){return e.__dom&&void 0!==e.__dom.nextSibling?e.__dom.nextSibling:e.nextSibling},getPreviousSibling:function(e){return e.__dom&&void 0!==e.__dom.previousSibling?e.__dom.previousSibling:e.previousSibling},getFirstElementChild:function(e){return e.__dom&&void 0!==e.__dom.firstChild?this._getFirstElementChild(e):e.firstElementChild},_getFirstElementChild:function(e){for(var t=e.__dom.firstChild;t&&t.nodeType!==Node.ELEMENT_NODE;)t=t.__dom.nextSibling;return t},getLastElementChild:function(e){return e.__dom&&void 0!==e.__dom.lastChild?this._getLastElementChild(e):e.lastElementChild},_getLastElementChild:function(e){for(var t=e.__dom.lastChild;t&&t.nodeType!==Node.ELEMENT_NODE;)t=t.__dom.previousSibling;return t},getNextElementSibling:function(e){return e.__dom&&void 0!==e.__dom.nextSibling?this._getNextElementSibling(e):e.nextElementSibling},_getNextElementSibling:function(e){for(var t=e.__dom.nextSibling;t&&t.nodeType!==Node.ELEMENT_NODE;)t=t.__dom.nextSibling;return t},getPreviousElementSibling:function(e){return e.__dom&&void 0!==e.__dom.previousSibling?this._getPreviousElementSibling(e):e.previousElementSibling},_getPreviousElementSibling:function(e){for(var t=e.__dom.previousSibling;t&&t.nodeType!==Node.ELEMENT_NODE;)t=t.__dom.previousSibling;return t},saveChildNodes:function(e){if(!this.hasChildNodes(e)){e.__dom=e.__dom||{},e.__dom.firstChild=e.firstChild,e.__dom.lastChild=e.lastChild,e.__dom.childNodes=[];for(var t=e.firstChild;t;t=t.nextSibling)t.__dom=t.__dom||{},t.__dom.parentNode=e,e.__dom.childNodes.push(t),t.__dom.nextSibling=t.nextSibling,t.__dom.previousSibling=t.previousSibling}},recordInsertBefore:function(e,t,i){if(t.__dom.childNodes=null,e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(var n=e.firstChild;n;n=n.nextSibling)this._linkNode(n,t,i);else this._linkNode(e,t,i)},_linkNode:function(e,t,i){e.__dom=e.__dom||{},t.__dom=t.__dom||{},i&&(i.__dom=i.__dom||{}),e.__dom.previousSibling=i?i.__dom.previousSibling:t.__dom.lastChild,
e.__dom.previousSibling&&(e.__dom.previousSibling.__dom.nextSibling=e),e.__dom.nextSibling=i||null,e.__dom.nextSibling&&(e.__dom.nextSibling.__dom.previousSibling=e),e.__dom.parentNode=t,i?i===t.__dom.firstChild&&(t.__dom.firstChild=e):(t.__dom.lastChild=e,t.__dom.firstChild||(t.__dom.firstChild=e)),t.__dom.childNodes=null},recordRemoveChild:function(e,t){e.__dom=e.__dom||{},t.__dom=t.__dom||{},e===t.__dom.firstChild&&(t.__dom.firstChild=e.__dom.nextSibling),e===t.__dom.lastChild&&(t.__dom.lastChild=e.__dom.previousSibling);var i=e.__dom.previousSibling,n=e.__dom.nextSibling;i&&(i.__dom.nextSibling=n),n&&(n.__dom.previousSibling=i),e.__dom.parentNode=e.__dom.previousSibling=e.__dom.nextSibling=void 0,t.__dom.childNodes=null}},Polymer.TreeApi.Composed={getChildNodes:function(e){return Polymer.TreeApi.arrayCopyChildNodes(e)},getParentNode:function(e){return e.parentNode},clearChildNodes:function(e){e.textContent=""},insertBefore:function(t,i,n){return e.call(t,i,n||null)},appendChild:function(e,i){return t.call(e,i)},removeChild:function(e,t){return i.call(e,t)}}}(),Polymer.DomApi=function(){"use strict";var e=Polymer.Settings,t=Polymer.TreeApi,i=function(e){this.node=n?i.wrap(e):e},n=e.hasShadow&&!e.nativeShadow;i.wrap=window.wrap?window.wrap:function(e){return e},i.prototype={flush:function(){Polymer.dom.flush()},deepContains:function(e){if(this.node.contains(e))return!0;for(var t=e,i=e.ownerDocument;t&&t!==i&&t!==this.node;)t=Polymer.dom(t).parentNode||t.host;return t===this.node},queryDistributedElements:function(e){for(var t,n=this.getEffectiveChildNodes(),r=[],o=0,s=n.length;o<s&&(t=n[o]);o++)t.nodeType===Node.ELEMENT_NODE&&i.matchesSelector.call(t,e)&&r.push(t);return r},getEffectiveChildNodes:function(){for(var e,t=[],i=this.childNodes,n=0,s=i.length;n<s&&(e=i[n]);n++)if(e.localName===r)for(var a=o(e).getDistributedNodes(),h=0;h<a.length;h++)t.push(a[h]);else t.push(e);return t},observeNodes:function(e){if(e)return this.observer||(this.observer=this.node.localName===r?new i.DistributedNodesObserver(this):new i.EffectiveNodesObserver(this)),this.observer.addListener(e)},unobserveNodes:function(e){this.observer&&this.observer.removeListener(e)},notifyObserver:function(){this.observer&&this.observer.notify()},_query:function(e,i,n){i=i||this.node;var r=[];return this._queryElements(t.Logical.getChildNodes(i),e,n,r),r},_queryElements:function(e,t,i,n){for(var r,o=0,s=e.length;o<s&&(r=e[o]);o++)if(r.nodeType===Node.ELEMENT_NODE&&this._queryElement(r,t,i,n))return!0},_queryElement:function(e,i,n,r){var o=i(e);return o&&r.push(e),n&&n(o)?o:void this._queryElements(t.Logical.getChildNodes(e),i,n,r)}};var r=i.CONTENT="content",o=i.factory=function(e){return e=e||document,e.__domApi||(e.__domApi=new i.ctor(e)),e.__domApi};i.hasApi=function(e){return Boolean(e.__domApi)},i.ctor=i,Polymer.dom=function(e,t){return e instanceof Event?Polymer.EventApi.factory(e):i.factory(e,t)};var s=Element.prototype;return i.matchesSelector=s.matches||s.matchesSelector||s.mozMatchesSelector||s.msMatchesSelector||s.oMatchesSelector||s.webkitMatchesSelector,i}(),function(){"use strict";var e=Polymer.Settings,t=Polymer.DomApi,i=t.factory,n=Polymer.TreeApi,r=Polymer.domInnerHTML.getInnerHTML,o=t.CONTENT;if(!e.useShadow){var s=Element.prototype.cloneNode,a=Document.prototype.importNode;Polymer.Base.extend(t.prototype,{_lazyDistribute:function(e){e.shadyRoot&&e.shadyRoot._distributionClean&&(e.shadyRoot._distributionClean=!1,Polymer.dom.addDebouncer(e.debounce("_distribute",e._distributeContent)))},appendChild:function(e){return this.insertBefore(e)},insertBefore:function(e,r){if(r&&n.Logical.getParentNode(r)!==this.node)throw Error("The ref_node to be inserted before is not a child of this node");if(e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE){var s=n.Logical.getParentNode(e);s?(t.hasApi(s)&&i(s).notifyObserver(),this._removeNode(e)):this._removeOwnerShadyRoot(e)}if(!this._addNode(e,r)){r&&(r=r.localName===o?this._firstComposedNode(r):r);var a=this.node._isShadyRoot?this.node.host:this.node;r?n.Composed.insertBefore(a,e,r):n.Composed.appendChild(a,e)}return this.notifyObserver(),e},_addNode:function(e,t){var i=this.getOwnerRoot();if(i){var r=this._maybeAddInsertionPoint(e,this.node);i._invalidInsertionPoints||(i._invalidInsertionPoints=r),this._addNodeToHost(i.host,e)}n.Logical.hasChildNodes(this.node)&&n.Logical.recordInsertBefore(e,this.node,t);var o=this._maybeDistribute(e)||this.node.shadyRoot;if(o)if(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE)for(;e.firstChild;)n.Composed.removeChild(e,e.firstChild);else{var s=n.Composed.getParentNode(e);s&&n.Composed.removeChild(s,e)}return o},removeChild:function(e){if(n.Logical.getParentNode(e)!==this.node)throw Error("The node to be removed is not a child of this node: "+e);if(!this._removeNode(e)){var t=this.node._isShadyRoot?this.node.host:this.node,i=n.Composed.getParentNode(e);t===i&&n.Composed.removeChild(t,e)}return this.notifyObserver(),e},_removeNode:function(e){var t,r=n.Logical.hasParentNode(e)&&n.Logical.getParentNode(e),o=this._ownerShadyRootForNode(e);return r&&(t=i(e)._maybeDistributeParent(),n.Logical.recordRemoveChild(e,r),o&&this._removeDistributedChildren(o,e)&&(o._invalidInsertionPoints=!0,this._lazyDistribute(o.host))),this._removeOwnerShadyRoot(e),o&&this._removeNodeFromHost(o.host,e),t},replaceChild:function(e,t){return this.insertBefore(e,t),this.removeChild(t),e},_hasCachedOwnerRoot:function(e){return Boolean(void 0!==e._ownerShadyRoot)},getOwnerRoot:function(){return this._ownerShadyRootForNode(this.node)},_ownerShadyRootForNode:function(e){if(e){var t=e._ownerShadyRoot;if(void 0===t){if(e._isShadyRoot)t=e;else{var i=n.Logical.getParentNode(e);t=i?i._isShadyRoot?i:this._ownerShadyRootForNode(i):null}(t||document.documentElement.contains(e))&&(e._ownerShadyRoot=t)}return t}},_maybeDistribute:function(e){var t=e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&!e.__noContent&&i(e).querySelector(o),r=t&&n.Logical.getParentNode(t).nodeType!==Node.DOCUMENT_FRAGMENT_NODE,s=t||e.localName===o;if(s){var a=this.getOwnerRoot();a&&this._lazyDistribute(a.host)}var h=this._nodeNeedsDistribution(this.node);return h&&this._lazyDistribute(this.node),h||s&&!r},_maybeAddInsertionPoint:function(e,t){var r;if(e.nodeType!==Node.DOCUMENT_FRAGMENT_NODE||e.__noContent)e.localName===o&&(n.Logical.saveChildNodes(t),n.Logical.saveChildNodes(e),r=!0);else for(var s,a,h,l=i(e).querySelectorAll(o),c=0;c<l.length&&(s=l[c]);c++)a=n.Logical.getParentNode(s),a===e&&(a=t),h=this._maybeAddInsertionPoint(s,a),r=r||h;return r},_updateInsertionPoints:function(e){for(var t,r=e.shadyRoot._insertionPoints=i(e.shadyRoot).querySelectorAll(o),s=0;s<r.length;s++)t=r[s],n.Logical.saveChildNodes(t),n.Logical.saveChildNodes(n.Logical.getParentNode(t))},_nodeNeedsDistribution:function(e){return e&&e.shadyRoot&&t.hasInsertionPoint(e.shadyRoot)},_addNodeToHost:function(e,t){e._elementAdd&&e._elementAdd(t)},_removeNodeFromHost:function(e,t){e._elementRemove&&e._elementRemove(t)},_removeDistributedChildren:function(e,t){for(var r,o=e._insertionPoints,s=0;s<o.length;s++){var a=o[s];if(this._contains(t,a))for(var h=i(a).getDistributedNodes(),l=0;l<h.length;l++){r=!0;var c=h[l],u=n.Composed.getParentNode(c);u&&n.Composed.removeChild(u,c)}}return r},_contains:function(e,t){for(;t;){if(t==e)return!0;t=n.Logical.getParentNode(t)}},_removeOwnerShadyRoot:function(e){if(this._hasCachedOwnerRoot(e))for(var t,i=n.Logical.getChildNodes(e),r=0,o=i.length;r<o&&(t=i[r]);r++)this._removeOwnerShadyRoot(t);e._ownerShadyRoot=void 0},_firstComposedNode:function(e){for(var t,n,r=i(e).getDistributedNodes(),o=0,s=r.length;o<s&&(t=r[o]);o++)if(n=i(t).getDestinationInsertionPoints(),n[n.length-1]===e)return t},querySelector:function(e){var i=this._query(function(i){return t.matchesSelector.call(i,e)},this.node,function(e){return Boolean(e)})[0];return i||null},querySelectorAll:function(e){return this._query(function(i){return t.matchesSelector.call(i,e)},this.node)},getDestinationInsertionPoints:function(){return this.node._destinationInsertionPoints||[]},getDistributedNodes:function(){return this.node._distributedNodes||[]},_clear:function(){for(;this.childNodes.length;)this.removeChild(this.childNodes[0])},setAttribute:function(e,t){this.node.setAttribute(e,t),this._maybeDistributeParent()},removeAttribute:function(e){this.node.removeAttribute(e),this._maybeDistributeParent()},_maybeDistributeParent:function(){if(this._nodeNeedsDistribution(this.parentNode))return this._lazyDistribute(this.parentNode),!0},cloneNode:function(e){var t=s.call(this.node,!1);if(e)for(var n,r=this.childNodes,o=i(t),a=0;a<r.length;a++)n=i(r[a]).cloneNode(!0),o.appendChild(n);return t},importNode:function(e,t){var r=this.node instanceof Document?this.node:this.node.ownerDocument,o=a.call(r,e,!1);if(t)for(var s,h=n.Logical.getChildNodes(e),l=i(o),c=0;c<h.length;c++)s=i(r).importNode(h[c],!0),l.appendChild(s);return o},_getComposedInnerHTML:function(){return r(this.node,!0)}}),Object.defineProperties(t.prototype,{activeElement:{get:function(){var e=document.activeElement;if(!e)return null;var t=!!this.node._isShadyRoot;if(this.node!==document){if(!t)return null;if(this.node.host===e||!this.node.host.contains(e))return null}for(var n=i(e).getOwnerRoot();n&&n!==this.node;)e=n.host,n=i(e).getOwnerRoot();return this.node===document?n?null:e:n===this.node?e:null},configurable:!0},childNodes:{get:function(){var e=n.Logical.getChildNodes(this.node);return Array.isArray(e)?e:n.arrayCopyChildNodes(this.node)},configurable:!0},children:{get:function(){return n.Logical.hasChildNodes(this.node)?Array.prototype.filter.call(this.childNodes,function(e){return e.nodeType===Node.ELEMENT_NODE}):n.arrayCopyChildren(this.node)},configurable:!0},parentNode:{get:function(){return n.Logical.getParentNode(this.node)},configurable:!0},firstChild:{get:function(){return n.Logical.getFirstChild(this.node)},configurable:!0},lastChild:{get:function(){return n.Logical.getLastChild(this.node)},configurable:!0},nextSibling:{get:function(){return n.Logical.getNextSibling(this.node)},configurable:!0},previousSibling:{get:function(){return n.Logical.getPreviousSibling(this.node)},configurable:!0},firstElementChild:{get:function(){return n.Logical.getFirstElementChild(this.node)},configurable:!0},lastElementChild:{get:function(){return n.Logical.getLastElementChild(this.node)},configurable:!0},nextElementSibling:{get:function(){return n.Logical.getNextElementSibling(this.node)},configurable:!0},previousElementSibling:{get:function(){return n.Logical.getPreviousElementSibling(this.node)},configurable:!0},textContent:{get:function(){var e=this.node.nodeType;if(e===Node.TEXT_NODE||e===Node.COMMENT_NODE)return this.node.textContent;for(var t,i=[],n=0,r=this.childNodes;t=r[n];n++)t.nodeType!==Node.COMMENT_NODE&&i.push(t.textContent);return i.join("")},set:function(e){var t=this.node.nodeType;t===Node.TEXT_NODE||t===Node.COMMENT_NODE?this.node.textContent=e:(this._clear(),e&&this.appendChild(document.createTextNode(e)))},configurable:!0},innerHTML:{get:function(){var e=this.node.nodeType;return e===Node.TEXT_NODE||e===Node.COMMENT_NODE?null:r(this.node)},set:function(e){var t=this.node.nodeType;if(t!==Node.TEXT_NODE||t!==Node.COMMENT_NODE){this._clear();var i=document.createElement("div");i.innerHTML=e;for(var r=n.arrayCopyChildNodes(i),o=0;o<r.length;o++)this.appendChild(r[o])}},configurable:!0}}),t.hasInsertionPoint=function(e){return Boolean(e&&e._insertionPoints.length)}}}(),function(){"use strict";var e=Polymer.Settings,t=Polymer.TreeApi,i=Polymer.DomApi;if(e.useShadow){Polymer.Base.extend(i.prototype,{querySelectorAll:function(e){return t.arrayCopy(this.node.querySelectorAll(e))},getOwnerRoot:function(){for(var e=this.node;e;){if(e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&e.host)return e;e=e.parentNode}},importNode:function(e,t){var i=this.node instanceof Document?this.node:this.node.ownerDocument;return i.importNode(e,t)},getDestinationInsertionPoints:function(){var e=this.node.getDestinationInsertionPoints&&this.node.getDestinationInsertionPoints();return e?t.arrayCopy(e):[]},getDistributedNodes:function(){var e=this.node.getDistributedNodes&&this.node.getDistributedNodes();return e?t.arrayCopy(e):[]}}),Object.defineProperties(i.prototype,{activeElement:{get:function(){var e=i.wrap(this.node),t=e.activeElement;return e.contains(t)?t:null},configurable:!0},childNodes:{get:function(){return t.arrayCopyChildNodes(this.node)},configurable:!0},children:{get:function(){return t.arrayCopyChildren(this.node)},configurable:!0},textContent:{get:function(){return this.node.textContent},set:function(e){return this.node.textContent=e},configurable:!0},innerHTML:{get:function(){return this.node.innerHTML},set:function(e){return this.node.innerHTML=e},configurable:!0}});var n=function(e){for(var t=0;t<e.length;t++)r(e[t])},r=function(e){i.prototype[e]=function(){return this.node[e].apply(this.node,arguments)}};n(["cloneNode","appendChild","insertBefore","removeChild","replaceChild","setAttribute","removeAttribute","querySelector"]);var o=function(e){for(var t=0;t<e.length;t++)s(e[t])},s=function(e){Object.defineProperty(i.prototype,e,{get:function(){return this.node[e]},configurable:!0})};o(["parentNode","firstChild","lastChild","nextSibling","previousSibling","firstElementChild","lastElementChild","nextElementSibling","previousElementSibling"])}}(),Polymer.Base.extend(Polymer.dom,{_flushGuard:0,_FLUSH_MAX:100,_needsTakeRecords:!Polymer.Settings.useNativeCustomElements,_debouncers:[],_staticFlushList:[],_finishDebouncer:null,flush:function(){for(this._flushGuard=0,this._prepareFlush();this._debouncers.length&&this._flushGuard<this._FLUSH_MAX;){for(;this._debouncers.length;)this._debouncers.shift().complete();this._finishDebouncer&&this._finishDebouncer.complete(),this._prepareFlush(),this._flushGuard++}this._flushGuard>=this._FLUSH_MAX&&console.warn("Polymer.dom.flush aborted. Flush may not be complete.")},_prepareFlush:function(){this._needsTakeRecords&&CustomElements.takeRecords();for(var e=0;e<this._staticFlushList.length;e++)this._staticFlushList[e]()},addStaticFlush:function(e){this._staticFlushList.push(e)},removeStaticFlush:function(e){var t=this._staticFlushList.indexOf(e);t>=0&&this._staticFlushList.splice(t,1)},addDebouncer:function(e){this._debouncers.push(e),this._finishDebouncer=Polymer.Debounce(this._finishDebouncer,this._finishFlush)},_finishFlush:function(){Polymer.dom._debouncers=[]}}),Polymer.EventApi=function(){"use strict";var e=Polymer.DomApi.ctor,t=Polymer.Settings;e.Event=function(e){this.event=e},t.useShadow?e.Event.prototype={get rootTarget(){return this.event.path[0]},get localTarget(){return this.event.target},get path(){var e=this.event.path;return Array.isArray(e)||(e=Array.prototype.slice.call(e)),e}}:e.Event.prototype={get rootTarget(){return this.event.target},get localTarget(){for(var e=this.event.currentTarget,t=e&&Polymer.dom(e).getOwnerRoot(),i=this.path,n=0;n<i.length;n++)if(Polymer.dom(i[n]).getOwnerRoot()===t)return i[n]},get path(){if(!this.event._path){for(var e=[],t=this.rootTarget;t;){e.push(t);var i=Polymer.dom(t).getDestinationInsertionPoints();if(i.length){for(var n=0;n<i.length-1;n++)e.push(i[n]);t=i[i.length-1]}else t=Polymer.dom(t).parentNode||t.host}e.push(window),this.event._path=e}return this.event._path}};var i=function(t){return t.__eventApi||(t.__eventApi=new e.Event(t)),t.__eventApi};return{factory:i}}(),function(){"use strict";var e=Polymer.DomApi.ctor,t=Polymer.Settings.useShadow;Object.defineProperty(e.prototype,"classList",{get:function(){return this._classList||(this._classList=new e.ClassList(this)),this._classList},configurable:!0}),e.ClassList=function(e){this.domApi=e,this.node=e.node},e.ClassList.prototype={add:function(){this.node.classList.add.apply(this.node.classList,arguments),this._distributeParent()},remove:function(){this.node.classList.remove.apply(this.node.classList,arguments),this._distributeParent()},toggle:function(){this.node.classList.toggle.apply(this.node.classList,arguments),this._distributeParent()},_distributeParent:function(){t||this.domApi._maybeDistributeParent()},contains:function(){return this.node.classList.contains.apply(this.node.classList,arguments)}}}(),function(){"use strict";var e=Polymer.DomApi.ctor,t=Polymer.Settings;if(e.EffectiveNodesObserver=function(e){this.domApi=e,this.node=this.domApi.node,this._listeners=[]},e.EffectiveNodesObserver.prototype={addListener:function(e){this._isSetup||(this._setup(),this._isSetup=!0);var t={fn:e,_nodes:[]};return this._listeners.push(t),this._scheduleNotify(),t},removeListener:function(e){var t=this._listeners.indexOf(e);t>=0&&(this._listeners.splice(t,1),e._nodes=[]),this._hasListeners()||(this._cleanup(),this._isSetup=!1)},_setup:function(){this._observeContentElements(this.domApi.childNodes)},_cleanup:function(){this._unobserveContentElements(this.domApi.childNodes)},_hasListeners:function(){return Boolean(this._listeners.length)},_scheduleNotify:function(){this._debouncer&&this._debouncer.stop(),this._debouncer=Polymer.Debounce(this._debouncer,this._notify),this._debouncer.context=this,Polymer.dom.addDebouncer(this._debouncer)},notify:function(){this._hasListeners()&&this._scheduleNotify()},_notify:function(){this._beforeCallListeners(),this._callListeners()},_beforeCallListeners:function(){this._updateContentElements()},_updateContentElements:function(){this._observeContentElements(this.domApi.childNodes)},_observeContentElements:function(e){for(var t,i=0;i<e.length&&(t=e[i]);i++)this._isContent(t)&&(t.__observeNodesMap=t.__observeNodesMap||new WeakMap,t.__observeNodesMap.has(this)||t.__observeNodesMap.set(this,this._observeContent(t)))},_observeContent:function(e){var t=this,i=Polymer.dom(e).observeNodes(function(){t._scheduleNotify()});return i._avoidChangeCalculation=!0,i},_unobserveContentElements:function(e){for(var t,i,n=0;n<e.length&&(t=e[n]);n++)this._isContent(t)&&(i=t.__observeNodesMap.get(this),i&&(Polymer.dom(t).unobserveNodes(i),t.__observeNodesMap.delete(this)))},_isContent:function(e){return"content"===e.localName},_callListeners:function(){for(var e,t=this._listeners,i=this._getEffectiveNodes(),n=0;n<t.length&&(e=t[n]);n++){var r=this._generateListenerInfo(e,i);(r||e._alwaysNotify)&&this._callListener(e,r)}},_getEffectiveNodes:function(){return this.domApi.getEffectiveChildNodes()},_generateListenerInfo:function(e,t){if(e._avoidChangeCalculation)return!0;for(var i,n=e._nodes,r={target:this.node,addedNodes:[],removedNodes:[]},o=Polymer.ArraySplice.calculateSplices(t,n),s=0;s<o.length&&(i=o[s]);s++)for(var a,h=0;h<i.removed.length&&(a=i.removed[h]);h++)r.removedNodes.push(a);for(s=0,i;s<o.length&&(i=o[s]);s++)for(h=i.index;h<i.index+i.addedCount;h++)r.addedNodes.push(t[h]);return e._nodes=t,r.addedNodes.length||r.removedNodes.length?r:void 0},_callListener:function(e,t){return e.fn.call(this.node,t)},enableShadowAttributeTracking:function(){}},t.useShadow){var i=e.EffectiveNodesObserver.prototype._setup,n=e.EffectiveNodesObserver.prototype._cleanup;Polymer.Base.extend(e.EffectiveNodesObserver.prototype,{_setup:function(){if(!this._observer){var e=this;this._mutationHandler=function(t){t&&t.length&&e._scheduleNotify()},this._observer=new MutationObserver(this._mutationHandler),this._boundFlush=function(){e._flush()},Polymer.dom.addStaticFlush(this._boundFlush),this._observer.observe(this.node,{childList:!0})}i.call(this)},_cleanup:function(){this._observer.disconnect(),this._observer=null,this._mutationHandler=null,Polymer.dom.removeStaticFlush(this._boundFlush),n.call(this)},_flush:function(){this._observer&&this._mutationHandler(this._observer.takeRecords())},enableShadowAttributeTracking:function(){if(this._observer){this._makeContentListenersAlwaysNotify(),this._observer.disconnect(),this._observer.observe(this.node,{childList:!0,attributes:!0,subtree:!0});var e=this.domApi.getOwnerRoot(),t=e&&e.host;t&&Polymer.dom(t).observer&&Polymer.dom(t).observer.enableShadowAttributeTracking()}},_makeContentListenersAlwaysNotify:function(){for(var e,t=0;t<this._listeners.length;t++)e=this._listeners[t],e._alwaysNotify=e._isContentListener}})}}(),function(){"use strict";var e=Polymer.DomApi.ctor,t=Polymer.Settings;e.DistributedNodesObserver=function(t){e.EffectiveNodesObserver.call(this,t)},e.DistributedNodesObserver.prototype=Object.create(e.EffectiveNodesObserver.prototype),Polymer.Base.extend(e.DistributedNodesObserver.prototype,{_setup:function(){},_cleanup:function(){},_beforeCallListeners:function(){},_getEffectiveNodes:function(){return this.domApi.getDistributedNodes()}}),t.useShadow&&Polymer.Base.extend(e.DistributedNodesObserver.prototype,{_setup:function(){if(!this._observer){var e=this.domApi.getOwnerRoot(),t=e&&e.host;if(t){var i=this;this._observer=Polymer.dom(t).observeNodes(function(){i._scheduleNotify()}),this._observer._isContentListener=!0,this._hasAttrSelect()&&Polymer.dom(t).observer.enableShadowAttributeTracking()}}},_hasAttrSelect:function(){var e=this.node.getAttribute("select");return e&&e.match(/[[.]+/)},_cleanup:function(){var e=this.domApi.getOwnerRoot(),t=e&&e.host;t&&Polymer.dom(t).unobserveNodes(this._observer),this._observer=null}})}(),function(){function e(e,t){t._distributedNodes.push(e);var i=e._destinationInsertionPoints;i?i.push(t):e._destinationInsertionPoints=[t]}function t(e){var t=e._distributedNodes;if(t)for(var i=0;i<t.length;i++){var n=t[i]._destinationInsertionPoints;n&&n.splice(n.indexOf(e)+1,n.length)}}function i(e,t){var i=u.Logical.getParentNode(e);i&&i.shadyRoot&&c.hasInsertionPoint(i.shadyRoot)&&i.shadyRoot._distributionClean&&(i.shadyRoot._distributionClean=!1,t.shadyRoot._dirtyRoots.push(i))}function n(e,t){var i=t._destinationInsertionPoints;return i&&i[i.length-1]===e}function r(e){return"content"==e.localName}function o(e){for(;e&&s(e);)e=e.domHost;return e}function s(e){for(var t,i=u.Logical.getChildNodes(e),n=0;n<i.length;n++)if(t=i[n],t.localName&&"content"===t.localName)return e.domHost}function a(e){for(var t,i=0;i<e._insertionPoints.length;i++)t=e._insertionPoints[i],c.hasApi(t)&&Polymer.dom(t).notifyObserver()}function h(e){c.hasApi(e)&&Polymer.dom(e).notifyObserver()}function l(e){if(d&&e)for(var t=0;t<e.length;t++)CustomElements.upgrade(e[t])}var c=Polymer.DomApi,u=Polymer.TreeApi;Polymer.Base._addFeature({_prepShady:function(){this._useContent=this._useContent||Boolean(this._template)},_setupShady:function(){this.shadyRoot=null,this.__domApi||(this.__domApi=null),this.__dom||(this.__dom=null),this._ownerShadyRoot||(this._ownerShadyRoot=void 0)},_poolContent:function(){this._useContent&&u.Logical.saveChildNodes(this)},_setupRoot:function(){this._useContent&&(this._createLocalRoot(),this.dataHost||l(u.Logical.getChildNodes(this)))},_createLocalRoot:function(){this.shadyRoot=this.root,this.shadyRoot._distributionClean=!1,this.shadyRoot._hasDistributed=!1,this.shadyRoot._isShadyRoot=!0,this.shadyRoot._dirtyRoots=[];var e=this.shadyRoot._insertionPoints=!this._notes||this._notes._hasContent?this.shadyRoot.querySelectorAll("content"):[];u.Logical.saveChildNodes(this.shadyRoot);for(var t,i=0;i<e.length;i++)t=e[i],u.Logical.saveChildNodes(t),u.Logical.saveChildNodes(t.parentNode);this.shadyRoot.host=this},get domHost(){var e=Polymer.dom(this).getOwnerRoot();return e&&e.host},distributeContent:function(e){if(this.shadyRoot){this.shadyRoot._invalidInsertionPoints=this.shadyRoot._invalidInsertionPoints||e;var t=o(this);Polymer.dom(this)._lazyDistribute(t)}},_distributeContent:function(){this._useContent&&!this.shadyRoot._distributionClean&&(this.shadyRoot._invalidInsertionPoints&&(Polymer.dom(this)._updateInsertionPoints(this),this.shadyRoot._invalidInsertionPoints=!1),this._beginDistribute(),this._distributeDirtyRoots(),this._finishDistribute())},_beginDistribute:function(){this._useContent&&c.hasInsertionPoint(this.shadyRoot)&&(this._resetDistribution(),this._distributePool(this.shadyRoot,this._collectPool()))},_distributeDirtyRoots:function(){for(var e,t=this.shadyRoot._dirtyRoots,i=0,n=t.length;i<n&&(e=t[i]);i++)e._distributeContent();this.shadyRoot._dirtyRoots=[]},_finishDistribute:function(){if(this._useContent){if(this.shadyRoot._distributionClean=!0,c.hasInsertionPoint(this.shadyRoot))this._composeTree(),a(this.shadyRoot);else if(this.shadyRoot._hasDistributed){var e=this._composeNode(this);this._updateChildNodes(this,e)}else u.Composed.clearChildNodes(this),this.appendChild(this.shadyRoot);this.shadyRoot._hasDistributed||h(this),this.shadyRoot._hasDistributed=!0}},elementMatches:function(e,t){return t=t||this,c.matchesSelector.call(t,e)},_resetDistribution:function(){for(var e=u.Logical.getChildNodes(this),i=0;i<e.length;i++){var n=e[i];n._destinationInsertionPoints&&(n._destinationInsertionPoints=void 0),r(n)&&t(n)}for(var o=this.shadyRoot,s=o._insertionPoints,a=0;a<s.length;a++)s[a]._distributedNodes=[]},_collectPool:function(){for(var e=[],t=u.Logical.getChildNodes(this),i=0;i<t.length;i++){var n=t[i];r(n)?e.push.apply(e,n._distributedNodes):e.push(n)}return e},_distributePool:function(e,t){for(var n,r=e._insertionPoints,o=0,s=r.length;o<s&&(n=r[o]);o++)this._distributeInsertionPoint(n,t),i(n,this)},_distributeInsertionPoint:function(t,i){for(var n,r=!1,o=0,s=i.length;o<s;o++)n=i[o],n&&this._matchesContentSelect(n,t)&&(e(n,t),i[o]=void 0,r=!0);if(!r)for(var a=u.Logical.getChildNodes(t),h=0;h<a.length;h++)e(a[h],t)},_composeTree:function(){this._updateChildNodes(this,this._composeNode(this));for(var e,t,i=this.shadyRoot._insertionPoints,n=0,r=i.length;n<r&&(e=i[n]);n++)t=u.Logical.getParentNode(e),t._useContent||t===this||t===this.shadyRoot||this._updateChildNodes(t,this._composeNode(t))},_composeNode:function(e){for(var t=[],i=u.Logical.getChildNodes(e.shadyRoot||e),o=0;o<i.length;o++){var s=i[o];if(r(s))for(var a=s._distributedNodes,h=0;h<a.length;h++){var l=a[h];n(s,l)&&t.push(l)}else t.push(s)}return t},_updateChildNodes:function(e,t){for(var i,n=u.Composed.getChildNodes(e),r=Polymer.ArraySplice.calculateSplices(t,n),o=0,s=0;o<r.length&&(i=r[o]);o++){for(var a,h=0;h<i.removed.length&&(a=i.removed[h]);h++)u.Composed.getParentNode(a)===e&&u.Composed.removeChild(e,a),n.splice(i.index+s,1);s-=i.addedCount}for(var i,l,o=0;o<r.length&&(i=r[o]);o++)for(l=n[i.index],h=i.index,a;h<i.index+i.addedCount;h++)a=t[h],u.Composed.insertBefore(e,a,l),n.splice(h,0,a)},_matchesContentSelect:function(e,t){var i=t.getAttribute("select");if(!i)return!0;if(i=i.trim(),!i)return!0;if(!(e instanceof Element))return!1;var n=/^(:not\()?[*.#[a-zA-Z_|]/;return!!n.test(i)&&this.elementMatches(i,e)},_elementAdd:function(){},_elementRemove:function(){}});var d=window.CustomElements&&!CustomElements.useNative}(),Polymer.Settings.useShadow&&Polymer.Base._addFeature({_poolContent:function(){},_beginDistribute:function(){},distributeContent:function(){},_distributeContent:function(){},_finishDistribute:function(){},_createLocalRoot:function(){this.createShadowRoot(),this.shadowRoot.appendChild(this.root),this.root=this.shadowRoot}}),Polymer.Async={_currVal:0,_lastVal:0,_callbacks:[],_twiddleContent:0,_twiddle:document.createTextNode(""),run:function(e,t){return t>0?~setTimeout(e,t):(this._twiddle.textContent=this._twiddleContent++,this._callbacks.push(e),this._currVal++)},cancel:function(e){if(e<0)clearTimeout(~e);else{var t=e-this._lastVal;if(t>=0){if(!this._callbacks[t])throw"invalid async handle: "+e;this._callbacks[t]=null}}},_atEndOfMicrotask:function(){for(var e=this._callbacks.length,t=0;t<e;t++){var i=this._callbacks[t];if(i)try{i()}catch(e){throw t++,this._callbacks.splice(0,t),this._lastVal+=t,this._twiddle.textContent=this._twiddleContent++,e}}this._callbacks.splice(0,e),this._lastVal+=e}},new window.MutationObserver(function(){Polymer.Async._atEndOfMicrotask()}).observe(Polymer.Async._twiddle,{characterData:!0}),Polymer.Debounce=function(){function e(e,t,n){return e?e.stop():e=new i(this),e.go(t,n),e}var t=Polymer.Async,i=function(e){this.context=e;var t=this;this.boundComplete=function(){t.complete()}};return i.prototype={go:function(e,i){var n;this.finish=function(){t.cancel(n)},n=t.run(this.boundComplete,i),this.callback=e},stop:function(){this.finish&&(this.finish(),this.finish=null,this.callback=null)},complete:function(){if(this.finish){var e=this.callback;this.stop(),e.call(this.context)}}},e}(),Polymer.Base._addFeature({_setupDebouncers:function(){this._debouncers={}},debounce:function(e,t,i){return this._debouncers[e]=Polymer.Debounce.call(this,this._debouncers[e],t,i)},isDebouncerActive:function(e){var t=this._debouncers[e];return!(!t||!t.finish)},flushDebouncer:function(e){var t=this._debouncers[e];t&&t.complete()},cancelDebouncer:function(e){var t=this._debouncers[e];t&&t.stop()}}),Polymer.DomModule=document.createElement("dom-module"),Polymer.Base._addFeature({_registerFeatures:function(){this._prepIs(),this._prepBehaviors(),this._prepConstructor(),this._prepTemplate(),this._prepShady(),this._prepPropertyInfo()},_prepBehavior:function(e){this._addHostAttributes(e.hostAttributes)},_initFeatures:function(){this._registerHost(),this._template&&(this._poolContent(),this._beginHosting(),this._stampTemplate(),this._endHosting()),this._marshalHostAttributes(),this._setupDebouncers(),this._marshalBehaviors(),this._tryReady()},_marshalBehavior:function(e){}}),Polymer.nar=[],Polymer.Annotations={parseAnnotations:function(e){var t=[],i=e._content||e.content;return this._parseNodeAnnotations(i,t,e.hasAttribute("strip-whitespace")),t},_parseNodeAnnotations:function(e,t,i){return e.nodeType===Node.TEXT_NODE?this._parseTextNodeAnnotation(e,t):this._parseElementAnnotations(e,t,i)},_bindingRegex:function(){var e="(?:[a-zA-Z_$][\\w.:$\\-*]*)",t="(?:[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?)",i="(?:'(?:[^'\\\\]|\\\\.)*')",n='(?:"(?:[^"\\\\]|\\\\.)*")',r="(?:"+i+"|"+n+")",o="(?:"+e+"|"+t+"|"+r+"\\s*)",s="(?:"+o+"(?:,\\s*"+o+")*)",a="(?:\\(\\s*(?:"+s+"?)\\)\\s*)",h="("+e+"\\s*"+a+"?)",l="(\\[\\[|{{)\\s*",c="(?:]]|}})",u="(?:(!)\\s*)?",d=l+u+h+c;return new RegExp(d,"g")}(),_parseBindings:function(e){for(var t,i=this._bindingRegex,n=[],r=0;null!==(t=i.exec(e));){t.index>r&&n.push({literal:e.slice(r,t.index)});var o,s,a,h=t[1][0],l=Boolean(t[2]),c=t[3].trim();"{"==h&&(a=c.indexOf("::"))>0&&(s=c.substring(a+2),c=c.substring(0,a),o=!0),n.push({compoundIndex:n.length,value:c,mode:h,negate:l,event:s,customEvent:o}),r=i.lastIndex}if(r&&r<e.length){var u=e.substring(r);u&&n.push({literal:u})}if(n.length)return n},_literalFromParts:function(e){for(var t="",i=0;i<e.length;i++){var n=e[i].literal;t+=n||""}return t},_parseTextNodeAnnotation:function(e,t){var i=this._parseBindings(e.textContent);if(i){e.textContent=this._literalFromParts(i)||" ";var n={bindings:[{kind:"text",name:"textContent",parts:i,isCompound:1!==i.length}]};return t.push(n),n}},_parseElementAnnotations:function(e,t,i){var n={bindings:[],events:[]};return"content"===e.localName&&(t._hasContent=!0),this._parseChildNodesAnnotations(e,n,t,i),e.attributes&&(this._parseNodeAttributeAnnotations(e,n,t),this.prepElement&&this.prepElement(e)),(n.bindings.length||n.events.length||n.id)&&t.push(n),n},_parseChildNodesAnnotations:function(e,t,i,n){if(e.firstChild)for(var r=e.firstChild,o=0;r;){var s=r.nextSibling;if("template"!==r.localName||r.hasAttribute("preserve-content")||this._parseTemplate(r,o,i,t),"slot"==r.localName&&(r=this._replaceSlotWithContent(r)),r.nodeType===Node.TEXT_NODE){for(var a=s;a&&a.nodeType===Node.TEXT_NODE;)r.textContent+=a.textContent,s=a.nextSibling,e.removeChild(a),a=s;n&&!r.textContent.trim()&&(e.removeChild(r),o--)}if(r.parentNode){var h=this._parseNodeAnnotations(r,i,n);h&&(h.parent=t,h.index=o)}r=s,o++}},_replaceSlotWithContent:function(e){for(var t=e.ownerDocument.createElement("content");e.firstChild;)t.appendChild(e.firstChild);for(var i=e.attributes,n=0;n<i.length;n++){var r=i[n];t.setAttribute(r.name,r.value)}var o=e.getAttribute("name"),s=o?"[slot='"+o+"']":":not([slot])";return t.setAttribute("select",s),e.parentNode.replaceChild(t,e),t},_parseTemplate:function(e,t,i,n){
var r=document.createDocumentFragment();r._notes=this.parseAnnotations(e),r.appendChild(e.content),i.push({bindings:Polymer.nar,events:Polymer.nar,templateContent:r,parent:n,index:t})},_parseNodeAttributeAnnotations:function(e,t){for(var i,n=Array.prototype.slice.call(e.attributes),r=n.length-1;i=n[r];r--){var o,s=i.name,a=i.value;"on-"===s.slice(0,3)?(e.removeAttribute(s),t.events.push({name:s.slice(3),value:a})):(o=this._parseNodeAttributeAnnotation(e,s,a))?t.bindings.push(o):"id"===s&&(t.id=a)}},_parseNodeAttributeAnnotation:function(e,t,i){var n=this._parseBindings(i);if(n){var r=t,o="property";"$"==t[t.length-1]&&(t=t.slice(0,-1),o="attribute");var s=this._literalFromParts(n);s&&"attribute"==o&&e.setAttribute(t,s),"input"===e.localName&&"value"===r&&e.setAttribute(r,""),e.removeAttribute(r);var a=Polymer.CaseMap.dashToCamelCase(t);return"property"===o&&(t=a),{kind:o,name:t,propertyName:a,parts:n,literal:s,isCompound:1!==n.length}}},findAnnotatedNode:function(e,t){var i=t.parent&&Polymer.Annotations.findAnnotatedNode(e,t.parent);if(!i)return e;for(var n=i.firstChild,r=0;n;n=n.nextSibling)if(t.index===r++)return n}},function(){function e(e,t){return e.replace(a,function(e,n,r,o){return n+"'"+i(r.replace(/["']/g,""),t)+"'"+o})}function t(t,n){for(var r in h)for(var o,s,a,l=h[r],u=0,d=l.length;u<d&&(o=l[u]);u++)"*"!==r&&t.localName!==r||(s=t.attributes[o],a=s&&s.value,a&&a.search(c)<0&&(s.value="style"===o?e(a,n):i(a,n)))}function i(e,t){if(e&&l.test(e))return e;var i=r(t);return i.href=e,i.href||e}function n(e,t){return o||(o=document.implementation.createHTMLDocument("temp"),s=o.createElement("base"),o.head.appendChild(s)),s.href=t,i(e,o)}function r(e){return e.__urlResolver||(e.__urlResolver=e.createElement("a"))}var o,s,a=/(url\()([^)]*)(\))/g,h={"*":["href","src","style","url"],form:["action"]},l=/(^\/)|(^#)|(^[\w-\d]*:)/,c=/\{\{|\[\[/;Polymer.ResolveUrl={resolveCss:e,resolveAttrs:t,resolveUrl:n}}(),Polymer.Path={root:function(e){var t=e.indexOf(".");return t===-1?e:e.slice(0,t)},isDeep:function(e){return e.indexOf(".")!==-1},isAncestor:function(e,t){return 0===e.indexOf(t+".")},isDescendant:function(e,t){return 0===t.indexOf(e+".")},translate:function(e,t,i){return t+i.slice(e.length)},matches:function(e,t,i){return e===i||this.isAncestor(e,i)||Boolean(t)&&this.isDescendant(e,i)}},Polymer.Base._addFeature({_prepAnnotations:function(){if(this._template){var e=this;Polymer.Annotations.prepElement=function(t){e._prepElement(t)},this._template._content&&this._template._content._notes?this._notes=this._template._content._notes:(this._notes=Polymer.Annotations.parseAnnotations(this._template),this._processAnnotations(this._notes)),Polymer.Annotations.prepElement=null}else this._notes=[]},_processAnnotations:function(e){for(var t=0;t<e.length;t++){for(var i=e[t],n=0;n<i.bindings.length;n++)for(var r=i.bindings[n],o=0;o<r.parts.length;o++){var s=r.parts[o];if(!s.literal){var a=this._parseMethod(s.value);a?s.signature=a:s.model=Polymer.Path.root(s.value)}}if(i.templateContent){this._processAnnotations(i.templateContent._notes);var h=i.templateContent._parentProps=this._discoverTemplateParentProps(i.templateContent._notes),l=[];for(var c in h){var u="_parent_"+c;l.push({index:i.index,kind:"property",name:u,propertyName:u,parts:[{mode:"{",model:c,value:c}]})}i.bindings=i.bindings.concat(l)}}},_discoverTemplateParentProps:function(e){for(var t,i={},n=0;n<e.length&&(t=e[n]);n++){for(var r,o=0,s=t.bindings;o<s.length&&(r=s[o]);o++)for(var a,h=0,l=r.parts;h<l.length&&(a=l[h]);h++)if(a.signature){for(var c=a.signature.args,u=0;u<c.length;u++){var d=c[u].model;d&&(i[d]=!0)}a.signature.dynamicFn&&(i[a.signature.method]=!0)}else a.model&&(i[a.model]=!0);if(t.templateContent){var f=t.templateContent._parentProps;Polymer.Base.mixin(i,f)}}return i},_prepElement:function(e){Polymer.ResolveUrl.resolveAttrs(e,this._template.ownerDocument)},_findAnnotatedNode:Polymer.Annotations.findAnnotatedNode,_marshalAnnotationReferences:function(){this._template&&(this._marshalIdNodes(),this._marshalAnnotatedNodes(),this._marshalAnnotatedListeners())},_configureAnnotationReferences:function(){for(var e=this._notes,t=this._nodes,i=0;i<e.length;i++){var n=e[i],r=t[i];this._configureTemplateContent(n,r),this._configureCompoundBindings(n,r)}},_configureTemplateContent:function(e,t){e.templateContent&&(t._content=e.templateContent)},_configureCompoundBindings:function(e,t){for(var i=e.bindings,n=0;n<i.length;n++){var r=i[n];if(r.isCompound){for(var o=t.__compoundStorage__||(t.__compoundStorage__={}),s=r.parts,a=new Array(s.length),h=0;h<s.length;h++)a[h]=s[h].literal;var l=r.name;o[l]=a,r.literal&&"property"==r.kind&&(t._configValue?t._configValue(l,r.literal):t[l]=r.literal)}}},_marshalIdNodes:function(){this.$={};for(var e,t=0,i=this._notes.length;t<i&&(e=this._notes[t]);t++)e.id&&(this.$[e.id]=this._findAnnotatedNode(this.root,e))},_marshalAnnotatedNodes:function(){if(this._notes&&this._notes.length){for(var e=new Array(this._notes.length),t=0;t<this._notes.length;t++)e[t]=this._findAnnotatedNode(this.root,this._notes[t]);this._nodes=e}},_marshalAnnotatedListeners:function(){for(var e,t=0,i=this._notes.length;t<i&&(e=this._notes[t]);t++)if(e.events&&e.events.length)for(var n,r=this._findAnnotatedNode(this.root,e),o=0,s=e.events;o<s.length&&(n=s[o]);o++)this.listen(r,n.name,n.value)}}),Polymer.Base._addFeature({listeners:{},_listenListeners:function(e){var t,i,n;for(n in e)n.indexOf(".")<0?(t=this,i=n):(i=n.split("."),t=this.$[i[0]],i=i[1]),this.listen(t,i,e[n])},listen:function(e,t,i){var n=this._recallEventHandler(this,t,e,i);n||(n=this._createEventHandler(e,t,i)),n._listening||(this._listen(e,t,n),n._listening=!0)},_boundListenerKey:function(e,t){return e+":"+t},_recordEventHandler:function(e,t,i,n,r){var o=e.__boundListeners;o||(o=e.__boundListeners=new WeakMap);var s=o.get(i);s||(s={},o.set(i,s));var a=this._boundListenerKey(t,n);s[a]=r},_recallEventHandler:function(e,t,i,n){var r=e.__boundListeners;if(r){var o=r.get(i);if(o){var s=this._boundListenerKey(t,n);return o[s]}}},_createEventHandler:function(e,t,i){var n=this,r=function(e){n[i]?n[i](e,e.detail):n._warn(n._logf("_createEventHandler","listener method `"+i+"` not defined"))};return r._listening=!1,this._recordEventHandler(n,t,e,i,r),r},unlisten:function(e,t,i){var n=this._recallEventHandler(this,t,e,i);n&&(this._unlisten(e,t,n),n._listening=!1)},_listen:function(e,t,i){e.addEventListener(t,i)},_unlisten:function(e,t,i){e.removeEventListener(t,i)}}),function(){"use strict";function e(e){for(var t,i=y?["click"]:m,n=0;n<i.length;n++)t=i[n],e?document.addEventListener(t,b,!0):document.removeEventListener(t,b,!0)}function t(){x.mouse.mouseIgnoreJob||e(!0);var t=function(){e(),x.mouse.target=null,x.mouse.mouseIgnoreJob=null};x.mouse.mouseIgnoreJob=Polymer.Debounce(x.mouse.mouseIgnoreJob,t,_)}function i(e){var t=e.type;if(m.indexOf(t)===-1)return!1;if("mousemove"===t){var i=void 0===e.buttons?1:e.buttons;return e instanceof window.MouseEvent&&!v&&(i=g[e.which]||0),Boolean(1&i)}var n=void 0===e.button?0:e.button;return 0===n}function n(e){if("click"===e.type){if(0===e.detail)return!0;var t=P.findOriginalTarget(e),i=t.getBoundingClientRect(),n=e.pageX,r=e.pageY;return!(n>=i.left&&n<=i.right&&r>=i.top&&r<=i.bottom)}return!1}function r(e){for(var t,i=Polymer.dom(e).path,n="auto",r=0;r<i.length;r++)if(t=i[r],t[u]){n=t[u];break}return n}function o(e,t,i){e.movefn=t,e.upfn=i,document.addEventListener("mousemove",t),document.addEventListener("mouseup",i)}function s(e){document.removeEventListener("mousemove",e.movefn),document.removeEventListener("mouseup",e.upfn),e.movefn=null,e.upfn=null}var a=Polymer.DomApi.wrap,h="string"==typeof document.head.style.touchAction,l="__polymerGestures",c="__polymerGesturesHandled",u="__polymerGesturesTouchAction",d=25,f=5,p=2,_=2500,m=["mousedown","mousemove","mouseup","click"],g=[0,1,4,2],v=function(){try{return 1===new MouseEvent("test",{buttons:1}).buttons}catch(e){return!1}}(),y=navigator.userAgent.match(/iP(?:[oa]d|hone)|Android/),b=function(e){var t=e.sourceCapabilities;if((!t||t.firesTouchEvents)&&(e[c]={skip:!0},"click"===e.type)){for(var i=Polymer.dom(e).path,n=0;n<i.length;n++)if(i[n]===x.mouse.target)return;e.preventDefault(),e.stopPropagation()}},x={mouse:{target:null,mouseIgnoreJob:null},touch:{x:0,y:0,id:-1,scrollDecided:!1}},P={gestures:{},recognizers:[],deepTargetFind:function(e,t){for(var i=document.elementFromPoint(e,t),n=i;n&&n.shadowRoot;)n=n.shadowRoot.elementFromPoint(e,t),n&&(i=n);return i},findOriginalTarget:function(e){return e.path?e.path[0]:e.target},handleNative:function(e){var i,n=e.type,r=a(e.currentTarget),o=r[l];if(o){var s=o[n];if(s){if(!e[c]&&(e[c]={},"touch"===n.slice(0,5))){var u=e.changedTouches[0];if("touchstart"===n&&1===e.touches.length&&(x.touch.id=u.identifier),x.touch.id!==u.identifier)return;h||"touchstart"!==n&&"touchmove"!==n||P.handleTouchAction(e),"touchend"===n&&(x.mouse.target=Polymer.dom(e).rootTarget,t())}if(i=e[c],!i.skip){for(var d,f=P.recognizers,p=0;p<f.length;p++)d=f[p],s[d.name]&&!i[d.name]&&d.flow&&d.flow.start.indexOf(e.type)>-1&&d.reset&&d.reset();for(p=0,d;p<f.length;p++)d=f[p],s[d.name]&&!i[d.name]&&(i[d.name]=!0,d[n](e))}}}},handleTouchAction:function(e){var t=e.changedTouches[0],i=e.type;if("touchstart"===i)x.touch.x=t.clientX,x.touch.y=t.clientY,x.touch.scrollDecided=!1;else if("touchmove"===i){if(x.touch.scrollDecided)return;x.touch.scrollDecided=!0;var n=r(e),o=!1,s=Math.abs(x.touch.x-t.clientX),a=Math.abs(x.touch.y-t.clientY);e.cancelable&&("none"===n?o=!0:"pan-x"===n?o=a>s:"pan-y"===n&&(o=s>a)),o?e.preventDefault():P.prevent("track")}},add:function(e,t,i){e=a(e);var n=this.gestures[t],r=n.deps,o=n.name,s=e[l];s||(e[l]=s={});for(var h,c,u=0;u<r.length;u++)h=r[u],y&&m.indexOf(h)>-1&&"click"!==h||(c=s[h],c||(s[h]=c={_count:0}),0===c._count&&e.addEventListener(h,this.handleNative),c[o]=(c[o]||0)+1,c._count=(c._count||0)+1);e.addEventListener(t,i),n.touchAction&&this.setTouchAction(e,n.touchAction)},remove:function(e,t,i){e=a(e);var n=this.gestures[t],r=n.deps,o=n.name,s=e[l];if(s)for(var h,c,u=0;u<r.length;u++)h=r[u],c=s[h],c&&c[o]&&(c[o]=(c[o]||1)-1,c._count=(c._count||1)-1,0===c._count&&e.removeEventListener(h,this.handleNative));e.removeEventListener(t,i)},register:function(e){this.recognizers.push(e);for(var t=0;t<e.emits.length;t++)this.gestures[e.emits[t]]=e},findRecognizerByEvent:function(e){for(var t,i=0;i<this.recognizers.length;i++){t=this.recognizers[i];for(var n,r=0;r<t.emits.length;r++)if(n=t.emits[r],n===e)return t}return null},setTouchAction:function(e,t){h&&(e.style.touchAction=t),e[u]=t},fire:function(e,t,i){var n=Polymer.Base.fire(t,i,{node:e,bubbles:!0,cancelable:!0});if(n.defaultPrevented){var r=i.preventer||i.sourceEvent;r&&r.preventDefault&&r.preventDefault()}},prevent:function(e){var t=this.findRecognizerByEvent(e);t.info&&(t.info.prevent=!0)},resetMouseCanceller:function(){x.mouse.mouseIgnoreJob&&x.mouse.mouseIgnoreJob.complete()}};P.register({name:"downup",deps:["mousedown","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["down","up"],info:{movefn:null,upfn:null},reset:function(){s(this.info)},mousedown:function(e){if(i(e)){var t=P.findOriginalTarget(e),n=this,r=function(e){i(e)||(n.fire("up",t,e),s(n.info))},a=function(e){i(e)&&n.fire("up",t,e),s(n.info)};o(this.info,r,a),this.fire("down",t,e)}},touchstart:function(e){this.fire("down",P.findOriginalTarget(e),e.changedTouches[0],e)},touchend:function(e){this.fire("up",P.findOriginalTarget(e),e.changedTouches[0],e)},fire:function(e,t,i,n){P.fire(t,e,{x:i.clientX,y:i.clientY,sourceEvent:i,preventer:n,prevent:function(e){return P.prevent(e)}})}}),P.register({name:"track",touchAction:"none",deps:["mousedown","touchstart","touchmove","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["track"],info:{x:0,y:0,state:"start",started:!1,moves:[],addMove:function(e){this.moves.length>p&&this.moves.shift(),this.moves.push(e)},movefn:null,upfn:null,prevent:!1},reset:function(){this.info.state="start",this.info.started=!1,this.info.moves=[],this.info.x=0,this.info.y=0,this.info.prevent=!1,s(this.info)},hasMovedEnough:function(e,t){if(this.info.prevent)return!1;if(this.info.started)return!0;var i=Math.abs(this.info.x-e),n=Math.abs(this.info.y-t);return i>=f||n>=f},mousedown:function(e){if(i(e)){var t=P.findOriginalTarget(e),n=this,r=function(e){var r=e.clientX,o=e.clientY;n.hasMovedEnough(r,o)&&(n.info.state=n.info.started?"mouseup"===e.type?"end":"track":"start","start"===n.info.state&&P.prevent("tap"),n.info.addMove({x:r,y:o}),i(e)||(n.info.state="end",s(n.info)),n.fire(t,e),n.info.started=!0)},a=function(e){n.info.started&&r(e),s(n.info)};o(this.info,r,a),this.info.x=e.clientX,this.info.y=e.clientY}},touchstart:function(e){var t=e.changedTouches[0];this.info.x=t.clientX,this.info.y=t.clientY},touchmove:function(e){var t=P.findOriginalTarget(e),i=e.changedTouches[0],n=i.clientX,r=i.clientY;this.hasMovedEnough(n,r)&&("start"===this.info.state&&P.prevent("tap"),this.info.addMove({x:n,y:r}),this.fire(t,i),this.info.state="track",this.info.started=!0)},touchend:function(e){var t=P.findOriginalTarget(e),i=e.changedTouches[0];this.info.started&&(this.info.state="end",this.info.addMove({x:i.clientX,y:i.clientY}),this.fire(t,i,e))},fire:function(e,t,i){var n,r=this.info.moves[this.info.moves.length-2],o=this.info.moves[this.info.moves.length-1],s=o.x-this.info.x,a=o.y-this.info.y,h=0;return r&&(n=o.x-r.x,h=o.y-r.y),P.fire(e,"track",{state:this.info.state,x:t.clientX,y:t.clientY,dx:s,dy:a,ddx:n,ddy:h,sourceEvent:t,preventer:i,hover:function(){return P.deepTargetFind(t.clientX,t.clientY)}})}}),P.register({name:"tap",deps:["mousedown","click","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["click","touchend"]},emits:["tap"],info:{x:NaN,y:NaN,prevent:!1},reset:function(){this.info.x=NaN,this.info.y=NaN,this.info.prevent=!1},save:function(e){this.info.x=e.clientX,this.info.y=e.clientY},mousedown:function(e){i(e)&&this.save(e)},click:function(e){i(e)&&this.forward(e)},touchstart:function(e){this.save(e.changedTouches[0],e)},touchend:function(e){this.forward(e.changedTouches[0],e)},forward:function(e,t){var i=Math.abs(e.clientX-this.info.x),r=Math.abs(e.clientY-this.info.y),o=P.findOriginalTarget(e);(isNaN(i)||isNaN(r)||i<=d&&r<=d||n(e))&&(this.info.prevent||P.fire(o,"tap",{x:e.clientX,y:e.clientY,sourceEvent:e,preventer:t}))}});var A={x:"pan-x",y:"pan-y",none:"none",all:"auto"};Polymer.Base._addFeature({_setupGestures:function(){this.__polymerGestures=null},_listen:function(e,t,i){P.gestures[t]?P.add(e,t,i):e.addEventListener(t,i)},_unlisten:function(e,t,i){P.gestures[t]?P.remove(e,t,i):e.removeEventListener(t,i)},setScrollDirection:function(e,t){t=t||this,P.setTouchAction(t,A[e]||"auto")}}),Polymer.Gestures=P}(),function(){"use strict";if(Polymer.Base._addFeature({$$:function(e){return Polymer.dom(this.root).querySelector(e)},toggleClass:function(e,t,i){i=i||this,1==arguments.length&&(t=!i.classList.contains(e)),t?Polymer.dom(i).classList.add(e):Polymer.dom(i).classList.remove(e)},toggleAttribute:function(e,t,i){i=i||this,1==arguments.length&&(t=!i.hasAttribute(e)),t?Polymer.dom(i).setAttribute(e,""):Polymer.dom(i).removeAttribute(e)},classFollows:function(e,t,i){i&&Polymer.dom(i).classList.remove(e),t&&Polymer.dom(t).classList.add(e)},attributeFollows:function(e,t,i){i&&Polymer.dom(i).removeAttribute(e),t&&Polymer.dom(t).setAttribute(e,"")},getEffectiveChildNodes:function(){return Polymer.dom(this).getEffectiveChildNodes()},getEffectiveChildren:function(){var e=Polymer.dom(this).getEffectiveChildNodes();return e.filter(function(e){return e.nodeType===Node.ELEMENT_NODE})},getEffectiveTextContent:function(){for(var e,t=this.getEffectiveChildNodes(),i=[],n=0;e=t[n];n++)e.nodeType!==Node.COMMENT_NODE&&i.push(Polymer.dom(e).textContent);return i.join("")},queryEffectiveChildren:function(e){var t=Polymer.dom(this).queryDistributedElements(e);return t&&t[0]},queryAllEffectiveChildren:function(e){return Polymer.dom(this).queryDistributedElements(e)},getContentChildNodes:function(e){var t=Polymer.dom(this.root).querySelector(e||"content");return t?Polymer.dom(t).getDistributedNodes():[]},getContentChildren:function(e){return this.getContentChildNodes(e).filter(function(e){return e.nodeType===Node.ELEMENT_NODE})},fire:function(e,t,i){i=i||Polymer.nob;var n=i.node||this;t=null===t||void 0===t?{}:t;var r=void 0===i.bubbles||i.bubbles,o=Boolean(i.cancelable),s=i._useCache,a=this._getEvent(e,r,o,s);return a.detail=t,s&&(this.__eventCache[e]=null),n.dispatchEvent(a),s&&(this.__eventCache[e]=a),a},__eventCache:{},_getEvent:function(e,t,i,n){var r=n&&this.__eventCache[e];return r&&r.bubbles==t&&r.cancelable==i||(r=new Event(e,{bubbles:Boolean(t),cancelable:i})),r},async:function(e,t){var i=this;return Polymer.Async.run(function(){e.call(i)},t)},cancelAsync:function(e){Polymer.Async.cancel(e)},arrayDelete:function(e,t){var i;if(Array.isArray(e)){if(i=e.indexOf(t),i>=0)return e.splice(i,1)}else{var n=this._get(e);if(i=n.indexOf(t),i>=0)return this.splice(e,i,1)}},transform:function(e,t){t=t||this,t.style.webkitTransform=e,t.style.transform=e},translate3d:function(e,t,i,n){n=n||this,this.transform("translate3d("+e+","+t+","+i+")",n)},importHref:function(e,t,i,n){var r=document.createElement("link");r.rel="import",r.href=e;var o=Polymer.Base.importHref.imported=Polymer.Base.importHref.imported||{},s=o[r.href],a=s||r,h=this;if(t){var l=function(e){return e.target.__firedLoad=!0,e.target.removeEventListener("load",l),t.call(h,e)};a.addEventListener("load",l)}if(i){var c=function(e){return e.target.__firedError=!0,e.target.removeEventListener("error",c),i.call(h,e)};a.addEventListener("error",c)}return s?(s.__firedLoad&&s.dispatchEvent(new Event("load")),s.__firedError&&s.dispatchEvent(new Event("error"))):(o[r.href]=r,n=Boolean(n),n&&r.setAttribute("async",""),document.head.appendChild(r)),a},create:function(e,t){var i=document.createElement(e);if(t)for(var n in t)i[n]=t[n];return i},isLightDescendant:function(e){return this!==e&&this.contains(e)&&Polymer.dom(this).getOwnerRoot()===Polymer.dom(e).getOwnerRoot()},isLocalDescendant:function(e){return this.root===Polymer.dom(e).getOwnerRoot()}}),!Polymer.Settings.useNativeCustomElements){var e=Polymer.Base.importHref;Polymer.Base.importHref=function(t,i,n,r){CustomElements.ready=!1;var o=function(e){if(CustomElements.upgradeDocumentTree(document),CustomElements.ready=!0,i)return i.call(this,e)};return e.call(this,t,o,n,r)}}}(),Polymer.Bind={prepareModel:function(e){Polymer.Base.mixin(e,this._modelApi)},_modelApi:{_notifyChange:function(e,t,i){i=void 0===i?this[e]:i,t=t||Polymer.CaseMap.camelToDashCase(e)+"-changed",this.fire(t,{value:i},{bubbles:!1,cancelable:!1,_useCache:!0})},_propertySetter:function(e,t,i,n){var r=this.__data__[e];return r===t||r!==r&&t!==t||(this.__data__[e]=t,"object"==typeof t&&this._clearPath(e),this._propertyChanged&&this._propertyChanged(e,t,r),i&&this._effectEffects(e,t,i,r,n)),r},__setProperty:function(e,t,i,n){n=n||this;var r=n._propertyEffects&&n._propertyEffects[e];r?n._propertySetter(e,t,r,i):n[e]!==t&&(n[e]=t)},_effectEffects:function(e,t,i,n,r){for(var o,s=0,a=i.length;s<a&&(o=i[s]);s++)o.fn.call(this,e,this[e],o.effect,n,r)},_clearPath:function(e){for(var t in this.__data__)Polymer.Path.isDescendant(e,t)&&(this.__data__[t]=void 0)}},ensurePropertyEffects:function(e,t){e._propertyEffects||(e._propertyEffects={});var i=e._propertyEffects[t];return i||(i=e._propertyEffects[t]=[]),i},addPropertyEffect:function(e,t,i,n){var r=this.ensurePropertyEffects(e,t),o={kind:i,effect:n,fn:Polymer.Bind["_"+i+"Effect"]};return r.push(o),o},createBindings:function(e){var t=e._propertyEffects;if(t)for(var i in t){var n=t[i];n.sort(this._sortPropertyEffects),this._createAccessors(e,i,n)}},_sortPropertyEffects:function(){var e={compute:0,annotation:1,annotatedComputation:2,reflect:3,notify:4,observer:5,complexObserver:6,function:7};return function(t,i){return e[t.kind]-e[i.kind]}}(),_createAccessors:function(e,t,i){var n={get:function(){return this.__data__[t]}},r=function(e){this._propertySetter(t,e,i)},o=e.getPropertyInfo&&e.getPropertyInfo(t);o&&o.readOnly?o.computed||(e["_set"+this.upper(t)]=r):n.set=r,Object.defineProperty(e,t,n)},upper:function(e){return e[0].toUpperCase()+e.substring(1)},_addAnnotatedListener:function(e,t,i,n,r,o){e._bindListeners||(e._bindListeners=[]);var s=this._notedListenerFactory(i,n,Polymer.Path.isDeep(n),o),a=r||Polymer.CaseMap.camelToDashCase(i)+"-changed";e._bindListeners.push({index:t,property:i,path:n,changedFn:s,event:a})},_isEventBogus:function(e,t){return e.path&&e.path[0]!==t},_notedListenerFactory:function(e,t,i,n){return function(r,o,s){if(s){var a=Polymer.Path.translate(e,t,s);this._notifyPath(a,o)}else o=r[e],n&&(o=!o),i?this.__data__[t]!=o&&this.set(t,o):this[t]=o}},prepareInstance:function(e){e.__data__=Object.create(null)},setupBindListeners:function(e){for(var t,i=e._bindListeners,n=0,r=i.length;n<r&&(t=i[n]);n++){var o=e._nodes[t.index];this._addNotifyListener(o,e,t.event,t.changedFn)}},_addNotifyListener:function(e,t,i,n){e.addEventListener(i,function(e){return t._notifyListener(n,e)})}},Polymer.Base.extend(Polymer.Bind,{_shouldAddListener:function(e){return e.name&&"attribute"!=e.kind&&"text"!=e.kind&&!e.isCompound&&"{"===e.parts[0].mode},_annotationEffect:function(e,t,i){e!=i.value&&(t=this._get(i.value),this.__data__[i.value]=t),this._applyEffectValue(i,t)},_reflectEffect:function(e,t,i){this.reflectPropertyToAttribute(e,i.attribute,t)},_notifyEffect:function(e,t,i,n,r){r||this._notifyChange(e,i.event,t)},_functionEffect:function(e,t,i,n,r){i.call(this,e,t,n,r)},_observerEffect:function(e,t,i,n){var r=this[i.method];r?r.call(this,t,n):this._warn(this._logf("_observerEffect","observer method `"+i.method+"` not defined"))},_complexObserverEffect:function(e,t,i){var n=this[i.method];if(n){var r=Polymer.Bind._marshalArgs(this.__data__,i,e,t);r&&n.apply(this,r)}else i.dynamicFn||this._warn(this._logf("_complexObserverEffect","observer method `"+i.method+"` not defined"))},_computeEffect:function(e,t,i){var n=this[i.method];if(n){var r=Polymer.Bind._marshalArgs(this.__data__,i,e,t);if(r){var o=n.apply(this,r);this.__setProperty(i.name,o)}}else i.dynamicFn||this._warn(this._logf("_computeEffect","compute method `"+i.method+"` not defined"))},_annotatedComputationEffect:function(e,t,i){var n=this._rootDataHost||this,r=n[i.method];if(r){var o=Polymer.Bind._marshalArgs(this.__data__,i,e,t);if(o){var s=r.apply(n,o);this._applyEffectValue(i,s)}}else i.dynamicFn||n._warn(n._logf("_annotatedComputationEffect","compute method `"+i.method+"` not defined"))},_marshalArgs:function(e,t,i,n){for(var r=[],o=t.args,s=o.length>1||t.dynamicFn,a=0,h=o.length;a<h;a++){var l,c=o[a],u=c.name;if(c.literal?l=c.value:i===u?l=n:(l=e[u],void 0===l&&c.structured&&(l=Polymer.Base._get(u,e))),s&&void 0===l)return;if(c.wildcard){var d=Polymer.Path.isAncestor(i,u);r[a]={path:d?i:u,value:d?n:l,base:l}}else r[a]=l}return r}}),Polymer.Base._addFeature({_addPropertyEffect:function(e,t,i){var n=Polymer.Bind.addPropertyEffect(this,e,t,i);n.pathFn=this["_"+n.kind+"PathEffect"]},_prepEffects:function(){Polymer.Bind.prepareModel(this),this._addAnnotationEffects(this._notes)},_prepBindings:function(){Polymer.Bind.createBindings(this)},_addPropertyEffects:function(e){if(e)for(var t in e){var i=e[t];if(i.observer&&this._addObserverEffect(t,i.observer),i.computed&&(i.readOnly=!0,this._addComputedEffect(t,i.computed)),i.notify&&this._addPropertyEffect(t,"notify",{event:Polymer.CaseMap.camelToDashCase(t)+"-changed"}),i.reflectToAttribute){var n=Polymer.CaseMap.camelToDashCase(t);"-"===n[0]?this._warn(this._logf("_addPropertyEffects","Property "+t+" cannot be reflected to attribute "+n+' because "-" is not a valid starting attribute name. Use a lowercase first letter for the property instead.')):this._addPropertyEffect(t,"reflect",{attribute:n})}i.readOnly&&Polymer.Bind.ensurePropertyEffects(this,t)}},_addComputedEffect:function(e,t){for(var i,n=this._parseMethod(t),r=n.dynamicFn,o=0;o<n.args.length&&(i=n.args[o]);o++)this._addPropertyEffect(i.model,"compute",{method:n.method,args:n.args,trigger:i,name:e,dynamicFn:r});r&&this._addPropertyEffect(n.method,"compute",{method:n.method,args:n.args,trigger:null,name:e,dynamicFn:r})},_addObserverEffect:function(e,t){this._addPropertyEffect(e,"observer",{method:t,property:e})},_addComplexObserverEffects:function(e){if(e)for(var t,i=0;i<e.length&&(t=e[i]);i++)this._addComplexObserverEffect(t)},_addComplexObserverEffect:function(e){var t=this._parseMethod(e);if(!t)throw new Error("Malformed observer expression '"+e+"'");for(var i,n=t.dynamicFn,r=0;r<t.args.length&&(i=t.args[r]);r++)this._addPropertyEffect(i.model,"complexObserver",{method:t.method,args:t.args,trigger:i,dynamicFn:n});n&&this._addPropertyEffect(t.method,"complexObserver",{method:t.method,args:t.args,trigger:null,dynamicFn:n})},_addAnnotationEffects:function(e){for(var t,i=0;i<e.length&&(t=e[i]);i++)for(var n,r=t.bindings,o=0;o<r.length&&(n=r[o]);o++)this._addAnnotationEffect(n,i)},_addAnnotationEffect:function(e,t){Polymer.Bind._shouldAddListener(e)&&Polymer.Bind._addAnnotatedListener(this,t,e.name,e.parts[0].value,e.parts[0].event,e.parts[0].negate);for(var i=0;i<e.parts.length;i++){var n=e.parts[i];n.signature?this._addAnnotatedComputationEffect(e,n,t):n.literal||("attribute"===e.kind&&"-"===e.name[0]?this._warn(this._logf("_addAnnotationEffect","Cannot set attribute "+e.name+' because "-" is not a valid attribute starting character')):this._addPropertyEffect(n.model,"annotation",{kind:e.kind,index:t,name:e.name,propertyName:e.propertyName,value:n.value,isCompound:e.isCompound,compoundIndex:n.compoundIndex,event:n.event,customEvent:n.customEvent,negate:n.negate}))}},_addAnnotatedComputationEffect:function(e,t,i){var n=t.signature;if(n.static)this.__addAnnotatedComputationEffect("__static__",i,e,t,null);else{for(var r,o=0;o<n.args.length&&(r=n.args[o]);o++)r.literal||this.__addAnnotatedComputationEffect(r.model,i,e,t,r);n.dynamicFn&&this.__addAnnotatedComputationEffect(n.method,i,e,t,null)}},__addAnnotatedComputationEffect:function(e,t,i,n,r){this._addPropertyEffect(e,"annotatedComputation",{index:t,isCompound:i.isCompound,compoundIndex:n.compoundIndex,kind:i.kind,name:i.name,negate:n.negate,method:n.signature.method,args:n.signature.args,trigger:r,dynamicFn:n.signature.dynamicFn})},_parseMethod:function(e){var t=e.match(/([^\s]+?)\(([\s\S]*)\)/);if(t){var i={method:t[1],static:!0};if(this.getPropertyInfo(i.method)!==Polymer.nob&&(i.static=!1,i.dynamicFn=!0),t[2].trim()){var n=t[2].replace(/\\,/g,"&comma;").split(",");return this._parseArgs(n,i)}return i.args=Polymer.nar,i}},_parseArgs:function(e,t){return t.args=e.map(function(e){var i=this._parseArg(e);return i.literal||(t.static=!1),i},this),t},_parseArg:function(e){var t=e.trim().replace(/&comma;/g,",").replace(/\\(.)/g,"$1"),i={name:t},n=t[0];switch("-"===n&&(n=t[1]),n>="0"&&n<="9"&&(n="#"),n){case"'":case'"':i.value=t.slice(1,-1),i.literal=!0;break;case"#":i.value=Number(t),i.literal=!0}return i.literal||(i.model=Polymer.Path.root(t),i.structured=Polymer.Path.isDeep(t),i.structured&&(i.wildcard=".*"==t.slice(-2),i.wildcard&&(i.name=t.slice(0,-2)))),i},_marshalInstanceEffects:function(){Polymer.Bind.prepareInstance(this),this._bindListeners&&Polymer.Bind.setupBindListeners(this)},_applyEffectValue:function(e,t){var i=this._nodes[e.index],n=e.name;if(t=this._computeFinalAnnotationValue(i,n,t,e),"attribute"==e.kind)this.serializeValueToAttribute(t,n,i);else{var r=i._propertyInfo&&i._propertyInfo[n];if(r&&r.readOnly)return;this.__setProperty(n,t,!1,i)}},_computeFinalAnnotationValue:function(e,t,i,n){if(n.negate&&(i=!i),n.isCompound){var r=e.__compoundStorage__[t];r[n.compoundIndex]=i,i=r.join("")}return"attribute"!==n.kind&&("className"===t&&(i=this._scopeElementClass(e,i)),("textContent"===t||"input"==e.localName&&"value"==t)&&(i=void 0==i?"":i)),i},_executeStaticEffects:function(){this._propertyEffects&&this._propertyEffects.__static__&&this._effectEffects("__static__",null,this._propertyEffects.__static__)}}),function(){var e=Polymer.Settings.usePolyfillProto;Polymer.Base._addFeature({_setupConfigure:function(e){if(this._config={},this._handlers=[],this._aboveConfig=null,e)for(var t in e)void 0!==e[t]&&(this._config[t]=e[t])},_marshalAttributes:function(){this._takeAttributesToModel(this._config)},_attributeChangedImpl:function(e){var t=this._clientsReadied?this:this._config;this._setAttributeToProperty(t,e)},_configValue:function(e,t){var i=this._propertyInfo[e];i&&i.readOnly||(this._config[e]=t)},_beforeClientsReady:function(){this._configure()},_configure:function(){this._configureAnnotationReferences(),this._configureInstanceProperties(),this._aboveConfig=this.mixin({},this._config);for(var e={},t=0;t<this.behaviors.length;t++)this._configureProperties(this.behaviors[t].properties,e);this._configureProperties(this.properties,e),this.mixin(e,this._aboveConfig),this._config=e,this._clients&&this._clients.length&&this._distributeConfig(this._config)},_configureInstanceProperties:function(){for(var t in this._propertyEffects)!e&&this.hasOwnProperty(t)&&(this._configValue(t,this[t]),delete this[t])},_configureProperties:function(e,t){for(var i in e){var n=e[i];if(void 0!==n.value){var r=n.value;"function"==typeof r&&(r=r.call(this,this._config)),t[i]=r}}},_distributeConfig:function(e){var t=this._propertyEffects;if(t)for(var i in e){var n=t[i];if(n)for(var r,o=0,s=n.length;o<s&&(r=n[o]);o++)if("annotation"===r.kind){var a=this._nodes[r.effect.index],h=r.effect.propertyName,l="attribute"==r.effect.kind,c=a._propertyEffects&&a._propertyEffects[h];if(a._configValue&&(c||!l)){var u=i===r.effect.value?e[i]:this._get(r.effect.value,e);u=this._computeFinalAnnotationValue(a,h,u,r.effect),l&&(u=a.deserialize(this.serialize(u),a._propertyInfo[h].type)),a._configValue(h,u)}}}},_afterClientsReady:function(){this._executeStaticEffects(),this._applyConfig(this._config,this._aboveConfig),this._flushHandlers()},_applyConfig:function(e,t){for(var i in e)void 0===this[i]&&this.__setProperty(i,e[i],i in t)},_notifyListener:function(e,t){if(!Polymer.Bind._isEventBogus(t,t.target)){var i,n;if(t.detail&&(i=t.detail.value,n=t.detail.path),this._clientsReadied)return e.call(this,t.target,i,n);this._queueHandler([e,t.target,i,n])}},_queueHandler:function(e){this._handlers.push(e)},_flushHandlers:function(){for(var e,t=this._handlers,i=0,n=t.length;i<n&&(e=t[i]);i++)e[0].call(this,e[1],e[2],e[3]);this._handlers=[]}})}(),function(){"use strict";var e=Polymer.Path;Polymer.Base._addFeature({notifyPath:function(e,t,i){var n={},r=this._get(e,this,n);1===arguments.length&&(t=r),n.path&&this._notifyPath(n.path,t,i)},_notifyPath:function(e,t,i){var n=this._propertySetter(e,t);if(n!==t&&(n===n||t===t))return this._pathEffector(e,t),i||this._notifyPathUp(e,t),!0},_getPathParts:function(e){if(Array.isArray(e)){for(var t=[],i=0;i<e.length;i++)for(var n=e[i].toString().split("."),r=0;r<n.length;r++)t.push(n[r]);return t}return e.toString().split(".")},set:function(e,t,i){var n,r=i||this,o=this._getPathParts(e),s=o[o.length-1];if(o.length>1){for(var a=0;a<o.length-1;a++){var h=o[a];if(n&&"#"==h[0]?r=Polymer.Collection.get(n).getItem(h):(r=r[h],n&&parseInt(h,10)==h&&(o[a]=Polymer.Collection.get(n).getKey(r))),!r)return;n=Array.isArray(r)?r:null}if(n){var l,c,u=Polymer.Collection.get(n);"#"==s[0]?(c=s,l=u.getItem(c),s=n.indexOf(l),u.setItem(c,t)):parseInt(s,10)==s&&(l=r[s],c=u.getKey(l),o[a]=c,u.setItem(c,t))}r[s]=t,i||this._notifyPath(o.join("."),t)}else r[e]=t},get:function(e,t){return this._get(e,t)},_get:function(e,t,i){for(var n,r=t||this,o=this._getPathParts(e),s=0;s<o.length;s++){if(!r)return;var a=o[s];n&&"#"==a[0]?r=Polymer.Collection.get(n).getItem(a):(r=r[a],i&&n&&parseInt(a,10)==a&&(o[s]=Polymer.Collection.get(n).getKey(r))),n=Array.isArray(r)?r:null;
}return i&&(i.path=o.join(".")),r},_pathEffector:function(t,i){var n=e.root(t),r=this._propertyEffects&&this._propertyEffects[n];if(r)for(var o,s=0;s<r.length&&(o=r[s]);s++){var a=o.pathFn;a&&a.call(this,t,i,o.effect)}this._boundPaths&&this._notifyBoundPaths(t,i)},_annotationPathEffect:function(t,i,n){if(e.matches(n.value,!1,t))Polymer.Bind._annotationEffect.call(this,t,i,n);else if(!n.negate&&e.isDescendant(n.value,t)){var r=this._nodes[n.index];if(r&&r._notifyPath){var o=e.translate(n.value,n.name,t);r._notifyPath(o,i,!0)}}},_complexObserverPathEffect:function(t,i,n){e.matches(n.trigger.name,n.trigger.wildcard,t)&&Polymer.Bind._complexObserverEffect.call(this,t,i,n)},_computePathEffect:function(t,i,n){e.matches(n.trigger.name,n.trigger.wildcard,t)&&Polymer.Bind._computeEffect.call(this,t,i,n)},_annotatedComputationPathEffect:function(t,i,n){e.matches(n.trigger.name,n.trigger.wildcard,t)&&Polymer.Bind._annotatedComputationEffect.call(this,t,i,n)},linkPaths:function(e,t){this._boundPaths=this._boundPaths||{},t?this._boundPaths[e]=t:this.unlinkPaths(e)},unlinkPaths:function(e){this._boundPaths&&delete this._boundPaths[e]},_notifyBoundPaths:function(t,i){for(var n in this._boundPaths){var r=this._boundPaths[n];e.isDescendant(n,t)?this._notifyPath(e.translate(n,r,t),i):e.isDescendant(r,t)&&this._notifyPath(e.translate(r,n,t),i)}},_notifyPathUp:function(t,i){var n=e.root(t),r=Polymer.CaseMap.camelToDashCase(n),o=r+this._EVENT_CHANGED;this.fire(o,{path:t,value:i},{bubbles:!1,_useCache:!0})},_EVENT_CHANGED:"-changed",notifySplices:function(e,t){var i={},n=this._get(e,this,i);this._notifySplices(n,i.path,t)},_notifySplices:function(e,t,i){var n={keySplices:Polymer.Collection.applySplices(e,i),indexSplices:i},r=t+".splices";this._notifyPath(r,n),this._notifyPath(t+".length",e.length),this.__data__[r]={keySplices:null,indexSplices:null}},_notifySplice:function(e,t,i,n,r){this._notifySplices(e,t,[{index:i,addedCount:n,removed:r,object:e,type:"splice"}])},push:function(e){var t={},i=this._get(e,this,t),n=Array.prototype.slice.call(arguments,1),r=i.length,o=i.push.apply(i,n);return n.length&&this._notifySplice(i,t.path,r,n.length,[]),o},pop:function(e){var t={},i=this._get(e,this,t),n=Boolean(i.length),r=Array.prototype.slice.call(arguments,1),o=i.pop.apply(i,r);return n&&this._notifySplice(i,t.path,i.length,0,[o]),o},splice:function(e,t){var i={},n=this._get(e,this,i);t=t<0?n.length-Math.floor(-t):Math.floor(t),t||(t=0);var r=Array.prototype.slice.call(arguments,1),o=n.splice.apply(n,r),s=Math.max(r.length-2,0);return(s||o.length)&&this._notifySplice(n,i.path,t,s,o),o},shift:function(e){var t={},i=this._get(e,this,t),n=Boolean(i.length),r=Array.prototype.slice.call(arguments,1),o=i.shift.apply(i,r);return n&&this._notifySplice(i,t.path,0,0,[o]),o},unshift:function(e){var t={},i=this._get(e,this,t),n=Array.prototype.slice.call(arguments,1),r=i.unshift.apply(i,n);return n.length&&this._notifySplice(i,t.path,0,n.length,[]),r},prepareModelNotifyPath:function(e){this.mixin(e,{fire:Polymer.Base.fire,_getEvent:Polymer.Base._getEvent,__eventCache:Polymer.Base.__eventCache,notifyPath:Polymer.Base.notifyPath,_get:Polymer.Base._get,_EVENT_CHANGED:Polymer.Base._EVENT_CHANGED,_notifyPath:Polymer.Base._notifyPath,_notifyPathUp:Polymer.Base._notifyPathUp,_pathEffector:Polymer.Base._pathEffector,_annotationPathEffect:Polymer.Base._annotationPathEffect,_complexObserverPathEffect:Polymer.Base._complexObserverPathEffect,_annotatedComputationPathEffect:Polymer.Base._annotatedComputationPathEffect,_computePathEffect:Polymer.Base._computePathEffect,_notifyBoundPaths:Polymer.Base._notifyBoundPaths,_getPathParts:Polymer.Base._getPathParts})}})}(),Polymer.Base._addFeature({resolveUrl:function(e){var t=Polymer.DomModule.import(this.is),i="";if(t){var n=t.getAttribute("assetpath")||"";i=Polymer.ResolveUrl.resolveUrl(n,t.ownerDocument.baseURI)}return Polymer.ResolveUrl.resolveUrl(e,i)}}),Polymer.CssParse=function(){return{parse:function(e){return e=this._clean(e),this._parseCss(this._lex(e),e)},_clean:function(e){return e.replace(this._rx.comments,"").replace(this._rx.port,"")},_lex:function(e){for(var t={start:0,end:e.length},i=t,n=0,r=e.length;n<r;n++)switch(e[n]){case this.OPEN_BRACE:i.rules||(i.rules=[]);var o=i,s=o.rules[o.rules.length-1];i={start:n+1,parent:o,previous:s},o.rules.push(i);break;case this.CLOSE_BRACE:i.end=n+1,i=i.parent||t}return t},_parseCss:function(e,t){var i=t.substring(e.start,e.end-1);if(e.parsedCssText=e.cssText=i.trim(),e.parent){var n=e.previous?e.previous.end:e.parent.start;i=t.substring(n,e.start-1),i=this._expandUnicodeEscapes(i),i=i.replace(this._rx.multipleSpaces," "),i=i.substring(i.lastIndexOf(";")+1);var r=e.parsedSelector=e.selector=i.trim();e.atRule=0===r.indexOf(this.AT_START),e.atRule?0===r.indexOf(this.MEDIA_START)?e.type=this.types.MEDIA_RULE:r.match(this._rx.keyframesRule)&&(e.type=this.types.KEYFRAMES_RULE,e.keyframesName=e.selector.split(this._rx.multipleSpaces).pop()):0===r.indexOf(this.VAR_START)?e.type=this.types.MIXIN_RULE:e.type=this.types.STYLE_RULE}var o=e.rules;if(o)for(var s,a=0,h=o.length;a<h&&(s=o[a]);a++)this._parseCss(s,t);return e},_expandUnicodeEscapes:function(e){return e.replace(/\\([0-9a-f]{1,6})\s/gi,function(){for(var e=arguments[1],t=6-e.length;t--;)e="0"+e;return"\\"+e})},stringify:function(e,t,i){i=i||"";var n="";if(e.cssText||e.rules){var r=e.rules;if(r&&!this._hasMixinRules(r))for(var o,s=0,a=r.length;s<a&&(o=r[s]);s++)n=this.stringify(o,t,n);else n=t?e.cssText:this.removeCustomProps(e.cssText),n=n.trim(),n&&(n="  "+n+"\n")}return n&&(e.selector&&(i+=e.selector+" "+this.OPEN_BRACE+"\n"),i+=n,e.selector&&(i+=this.CLOSE_BRACE+"\n\n")),i},_hasMixinRules:function(e){return 0===e[0].selector.indexOf(this.VAR_START)},removeCustomProps:function(e){return e=this.removeCustomPropAssignment(e),this.removeCustomPropApply(e)},removeCustomPropAssignment:function(e){return e.replace(this._rx.customProp,"").replace(this._rx.mixinProp,"")},removeCustomPropApply:function(e){return e.replace(this._rx.mixinApply,"").replace(this._rx.varApply,"")},types:{STYLE_RULE:1,KEYFRAMES_RULE:7,MEDIA_RULE:4,MIXIN_RULE:1e3},OPEN_BRACE:"{",CLOSE_BRACE:"}",_rx:{comments:/\/\*[^*]*\*+([^\/*][^*]*\*+)*\//gim,port:/@import[^;]*;/gim,customProp:/(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?(?:[;\n]|$)/gim,mixinProp:/(?:^[^;\-\s}]+)?--[^;{}]*?:[^{};]*?{[^}]*?}(?:[;\n]|$)?/gim,mixinApply:/@apply\s*\(?[^);]*\)?\s*(?:[;\n]|$)?/gim,varApply:/[^;:]*?:[^;]*?var\([^;]*\)(?:[;\n]|$)?/gim,keyframesRule:/^@[^\s]*keyframes/,multipleSpaces:/\s+/g},VAR_START:"--",MEDIA_START:"@media",AT_START:"@"}}(),Polymer.StyleUtil=function(){var e=Polymer.Settings;return{NATIVE_VARIABLES:Polymer.Settings.useNativeCSSProperties,MODULE_STYLES_SELECTOR:"style, link[rel=import][type~=css], template",INCLUDE_ATTR:"include",toCssText:function(e,t){return"string"==typeof e&&(e=this.parser.parse(e)),t&&this.forEachRule(e,t),this.parser.stringify(e,this.NATIVE_VARIABLES)},forRulesInStyles:function(e,t,i){if(e)for(var n,r=0,o=e.length;r<o&&(n=e[r]);r++)this.forEachRuleInStyle(n,t,i)},forActiveRulesInStyles:function(e,t,i){if(e)for(var n,r=0,o=e.length;r<o&&(n=e[r]);r++)this.forEachRuleInStyle(n,t,i,!0)},rulesForStyle:function(e){return!e.__cssRules&&e.textContent&&(e.__cssRules=this.parser.parse(e.textContent)),e.__cssRules},isKeyframesSelector:function(e){return e.parent&&e.parent.type===this.ruleTypes.KEYFRAMES_RULE},forEachRuleInStyle:function(e,t,i,n){var r,o,s=this.rulesForStyle(e);t&&(r=function(i){t(i,e)}),i&&(o=function(t){i(t,e)}),this.forEachRule(s,r,o,n)},forEachRule:function(e,t,i,n){if(e){var r=!1;if(n&&e.type===this.ruleTypes.MEDIA_RULE){var o=e.selector.match(this.rx.MEDIA_MATCH);o&&(window.matchMedia(o[1]).matches||(r=!0))}e.type===this.ruleTypes.STYLE_RULE?t(e):i&&e.type===this.ruleTypes.KEYFRAMES_RULE?i(e):e.type===this.ruleTypes.MIXIN_RULE&&(r=!0);var s=e.rules;if(s&&!r)for(var a,h=0,l=s.length;h<l&&(a=s[h]);h++)this.forEachRule(a,t,i,n)}},applyCss:function(e,t,i,n){var r=this.createScopeStyle(e,t);return this.applyStyle(r,i,n)},applyStyle:function(e,t,i){t=t||document.head;var n=i&&i.nextSibling||t.firstChild;return this.__lastHeadApplyNode=e,t.insertBefore(e,n)},createScopeStyle:function(e,t){var i=document.createElement("style");return t&&i.setAttribute("scope",t),i.textContent=e,i},__lastHeadApplyNode:null,applyStylePlaceHolder:function(e){var t=document.createComment(" Shady DOM styles for "+e+" "),i=this.__lastHeadApplyNode?this.__lastHeadApplyNode.nextSibling:null,n=document.head;return n.insertBefore(t,i||n.firstChild),this.__lastHeadApplyNode=t,t},cssFromModules:function(e,t){for(var i=e.trim().split(" "),n="",r=0;r<i.length;r++)n+=this.cssFromModule(i[r],t);return n},cssFromModule:function(e,t){var i=Polymer.DomModule.import(e);return i&&!i._cssText&&(i._cssText=this.cssFromElement(i)),!i&&t&&console.warn("Could not find style data in module named",e),i&&i._cssText||""},cssFromElement:function(e){for(var t,i="",n=e.content||e,r=Polymer.TreeApi.arrayCopy(n.querySelectorAll(this.MODULE_STYLES_SELECTOR)),o=0;o<r.length;o++)if(t=r[o],"template"===t.localName)t.hasAttribute("preserve-content")||(i+=this.cssFromElement(t));else if("style"===t.localName){var s=t.getAttribute(this.INCLUDE_ATTR);s&&(i+=this.cssFromModules(s,!0)),t=t.__appliedElement||t,t.parentNode.removeChild(t),i+=this.resolveCss(t.textContent,e.ownerDocument)}else t.import&&t.import.body&&(i+=this.resolveCss(t.import.body.textContent,t.import));return i},isTargetedBuild:function(t){return e.useNativeShadow?"shadow"===t:"shady"===t},cssBuildTypeForModule:function(e){var t=Polymer.DomModule.import(e);if(t)return this.getCssBuildType(t)},getCssBuildType:function(e){return e.getAttribute("css-build")},_findMatchingParen:function(e,t){for(var i=0,n=t,r=e.length;n<r;n++)switch(e[n]){case"(":i++;break;case")":if(0===--i)return n}return-1},processVariableAndFallback:function(e,t){var i=e.indexOf("var(");if(i===-1)return t(e,"","","");var n=this._findMatchingParen(e,i+3),r=e.substring(i+4,n),o=e.substring(0,i),s=this.processVariableAndFallback(e.substring(n+1),t),a=r.indexOf(",");if(a===-1)return t(o,r.trim(),"",s);var h=r.substring(0,a).trim(),l=r.substring(a+1).trim();return t(o,h,l,s)},rx:{VAR_ASSIGN:/(?:^|[;\s{]\s*)(--[\w-]*?)\s*:\s*(?:([^;{]*)|{([^}]*)})(?:(?=[;\s}])|$)/gi,MIXIN_MATCH:/(?:^|\W+)@apply\s*\(?([^);\n]*)\)?/gi,VAR_CONSUMED:/(--[\w-]+)\s*([:,;)]|$)/gi,ANIMATION_MATCH:/(animation\s*:)|(animation-name\s*:)/,MEDIA_MATCH:/@media[^(]*(\([^)]*\))/,IS_VAR:/^--/,BRACKETED:/\{[^}]*\}/g,HOST_PREFIX:"(?:^|[^.#[:])",HOST_SUFFIX:"($|[.:[\\s>+~])"},resolveCss:Polymer.ResolveUrl.resolveCss,parser:Polymer.CssParse,ruleTypes:Polymer.CssParse.types}}(),Polymer.StyleTransformer=function(){var e=Polymer.StyleUtil,t=Polymer.Settings,i={dom:function(e,t,i,n){this._transformDom(e,t||"",i,n)},_transformDom:function(e,t,i,n){e.setAttribute&&this.element(e,t,i,n);for(var r=Polymer.dom(e).childNodes,o=0;o<r.length;o++)this._transformDom(r[o],t,i,n)},element:function(e,t,i,r){if(i)r?e.removeAttribute(n):e.setAttribute(n,t);else if(t)if(e.classList)r?(e.classList.remove(n),e.classList.remove(t)):(e.classList.add(n),e.classList.add(t));else if(e.getAttribute){var o=e.getAttribute(y);r?o&&e.setAttribute(y,o.replace(n,"").replace(t,"")):e.setAttribute(y,(o?o+" ":"")+n+" "+t)}},elementStyles:function(i,n){var r,o=i._styles,s="",a=i.__cssBuild,h=t.useNativeShadow||"shady"===a;if(h){var c=this;r=function(e){e.selector=c._slottedToContent(e.selector),e.selector=e.selector.replace(l,":host > *"),n&&n(e)}}for(var u,d=0,f=o.length;d<f&&(u=o[d]);d++){var p=e.rulesForStyle(u);s+=h?e.toCssText(p,r):this.css(p,i.is,i.extends,n,i._scopeCssViaAttr)+"\n\n"}return s.trim()},css:function(t,i,n,r,o){var s=this._calcHostScope(i,n);i=this._calcElementScope(i,o);var a=this;return e.toCssText(t,function(e){e.isScoped||(a.rule(e,i,s),e.isScoped=!0),r&&r(e,i,s)})},_calcElementScope:function(e,t){return e?t?m+e+g:_+e:""},_calcHostScope:function(e,t){return t?"[is="+e+"]":e},rule:function(e,t,i){this._transformRule(e,this._transformComplexSelector,t,i)},_transformRule:function(e,t,i,n){e.selector=e.transformedSelector=this._transformRuleCss(e,t,i,n)},_transformRuleCss:function(t,i,n,r){var s=t.selector.split(o);if(!e.isKeyframesSelector(t))for(var a,h=0,l=s.length;h<l&&(a=s[h]);h++)s[h]=i.call(this,a,n,r);return s.join(o)},_transformComplexSelector:function(e,t,i){var n=!1,r=!1,a=this;return e=e.trim(),e=this._slottedToContent(e),e=e.replace(l,":host > *"),e=e.replace(b,h+" $1"),e=e.replace(s,function(e,o,s){if(n)s=s.replace(p," ");else{var h=a._transformCompoundSelector(s,o,t,i);n=n||h.stop,r=r||h.hostContext,o=h.combinator,s=h.value}return o+s}),r&&(e=e.replace(d,function(e,t,n,r){return t+n+" "+i+r+o+" "+t+i+n+r})),e},_transformCompoundSelector:function(e,t,i,n){var r=e.search(p),o=!1;e.indexOf(u)>=0?o=!0:e.indexOf(h)>=0?e=this._transformHostSelector(e,n):0!==r&&(e=i?this._transformSimpleSelector(e,i):e),e.indexOf(f)>=0&&(t="");var s;return r>=0&&(e=e.replace(p," "),s=!0),{value:e,combinator:t,stop:s,hostContext:o}},_transformSimpleSelector:function(e,t){var i=e.split(v);return i[0]+=t,i.join(v)},_transformHostSelector:function(e,t){var i=e.match(c),n=i&&i[2].trim()||"";if(n){if(n[0].match(a))return e.replace(c,function(e,i,n){return t+n});var r=n.split(a)[0];return r===t?n:x}return e.replace(h,t)},documentRule:function(e){e.selector=e.parsedSelector,this.normalizeRootSelector(e),t.useNativeShadow||this._transformRule(e,this._transformDocumentSelector)},normalizeRootSelector:function(e){e.selector=e.selector.replace(l,"html")},_transformDocumentSelector:function(e){return e.match(p)?this._transformComplexSelector(e,r):this._transformSimpleSelector(e.trim(),r)},_slottedToContent:function(e){return e.replace(P,f+"> $1")},SCOPE_NAME:"style-scope"},n=i.SCOPE_NAME,r=":not(["+n+"]):not(."+n+")",o=",",s=/(^|[\s>+~]+)((?:\[.+?\]|[^\s>+~=\[])+)/g,a=/[[.:#*]/,h=":host",l=":root",c=/(:host)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))/,u=":host-context",d=/(.*)(?::host-context)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))(.*)/,f="::content",p=/::content|::shadow|\/deep\//,_=".",m="["+n+"~=",g="]",v=":",y="class",b=new RegExp("^("+f+")"),x="should_not_match",P=/(?:::slotted)(?:\(((?:\([^)(]*\)|[^)(]*)+?)\))/g;return i}(),Polymer.StyleExtends=function(){var e=Polymer.StyleUtil;return{hasExtends:function(e){return Boolean(e.match(this.rx.EXTEND))},transform:function(t){var i=e.rulesForStyle(t),n=this;return e.forEachRule(i,function(e){if(n._mapRuleOntoParent(e),e.parent)for(var t;t=n.rx.EXTEND.exec(e.cssText);){var i=t[1],r=n._findExtendor(i,e);r&&n._extendRule(e,r)}e.cssText=e.cssText.replace(n.rx.EXTEND,"")}),e.toCssText(i,function(e){e.selector.match(n.rx.STRIP)&&(e.cssText="")},!0)},_mapRuleOntoParent:function(e){if(e.parent){for(var t,i=e.parent.map||(e.parent.map={}),n=e.selector.split(","),r=0;r<n.length;r++)t=n[r],i[t.trim()]=e;return i}},_findExtendor:function(e,t){return t.parent&&t.parent.map&&t.parent.map[e]||this._findExtendor(e,t.parent)},_extendRule:function(e,t){e.parent!==t.parent&&this._cloneAndAddRuleToParent(t,e.parent),e.extends=e.extends||[],e.extends.push(t),t.selector=t.selector.replace(this.rx.STRIP,""),t.selector=(t.selector&&t.selector+",\n")+e.selector,t.extends&&t.extends.forEach(function(t){this._extendRule(e,t)},this)},_cloneAndAddRuleToParent:function(e,t){e=Object.create(e),e.parent=t,e.extends&&(e.extends=e.extends.slice()),t.rules.push(e)},rx:{EXTEND:/@extends\(([^)]*)\)\s*?;/gim,STRIP:/%[^,]*$/}}}(),Polymer.ApplyShim=function(){"use strict";function e(e,t){e=e.trim(),m[e]={properties:t,dependants:{}}}function t(e){return e=e.trim(),m[e]}function i(e,t){var i=p.exec(t);return i&&(t=i[1]?g._getInitialValueForProperty(e):"apply-shim-inherit"),t}function n(e){for(var t,n,r,o,s=e.split(";"),a={},h=0;h<s.length;h++)r=s[h],r&&(o=r.split(":"),o.length>1&&(t=o[0].trim(),n=i(t,o.slice(1).join(":")),a[t]=n));return a}function r(e){var t=g.__currentElementProto,i=t&&t.is;for(var n in e.dependants)n!==i&&(e.dependants[n].__applyShimInvalid=!0)}function o(i,o,s,a){if(s&&l.processVariableAndFallback(s,function(e,i){i&&t(i)&&(a="@apply "+i+";")}),!a)return i;var c=h(a),u=i.slice(0,i.indexOf("--")),d=n(c),f=d,p=t(o),m=p&&p.properties;m?(f=Object.create(m),f=Polymer.Base.mixin(f,d)):e(o,f);var g,v,y=[],b=!1;for(g in f)v=d[g],void 0===v&&(v="initial"),!m||g in m||(b=!0),y.push(o+_+g+": "+v);return b&&r(p),p&&(p.properties=f),s&&(u=i+";"+u),u+y.join("; ")+";"}function s(e,t,i){return"var("+t+",var("+i+"))"}function a(i,n){i=i.replace(f,"");var r=[],o=t(i);if(o||(e(i,{}),o=t(i)),o){var s=g.__currentElementProto;s&&(o.dependants[s.is]=s);var a,h,l;for(a in o.properties)l=n&&n[a],h=[a,": var(",i,_,a],l&&h.push(",",l),h.push(")"),r.push(h.join(""))}return r.join("; ")}function h(e){for(var t;t=c.exec(e);){var i=t[0],r=t[1],o=t.index,s=o+i.indexOf("@apply"),h=o+i.length,l=e.slice(0,s),u=e.slice(h),d=n(l),f=a(r,d);e=[l,f,u].join(""),c.lastIndex=o+f.length}return e}var l=Polymer.StyleUtil,c=l.rx.MIXIN_MATCH,u=l.rx.VAR_ASSIGN,d=/var\(\s*(--[^,]*),\s*(--[^)]*)\)/g,f=/;\s*/m,p=/^\s*(initial)|(inherit)\s*$/,_="_-_",m={},g={_measureElement:null,_map:m,_separator:_,transform:function(e,t){this.__currentElementProto=t,l.forRulesInStyles(e,this._boundFindDefinitions),l.forRulesInStyles(e,this._boundFindApplications),t&&(t.__applyShimInvalid=!1),this.__currentElementProto=null},_findDefinitions:function(e){var t=e.parsedCssText;t=t.replace(d,s),t=t.replace(u,o),e.cssText=t,":root"===e.selector&&(e.selector=":host > *")},_findApplications:function(e){e.cssText=h(e.cssText)},transformRule:function(e){this._findDefinitions(e),this._findApplications(e)},_getInitialValueForProperty:function(e){return this._measureElement||(this._measureElement=document.createElement("meta"),this._measureElement.style.all="initial",document.head.appendChild(this._measureElement)),window.getComputedStyle(this._measureElement).getPropertyValue(e)}};return g._boundTransformRule=g.transformRule.bind(g),g._boundFindDefinitions=g._findDefinitions.bind(g),g._boundFindApplications=g._findApplications.bind(g),g}(),function(){var e=Polymer.Base._prepElement,t=Polymer.Settings.useNativeShadow,i=Polymer.StyleUtil,n=Polymer.StyleTransformer,r=Polymer.StyleExtends,o=Polymer.ApplyShim,s=Polymer.Settings;Polymer.Base._addFeature({_prepElement:function(t){this._encapsulateStyle&&"shady"!==this.__cssBuild&&n.element(t,this.is,this._scopeCssViaAttr),e.call(this,t)},_prepStyles:function(){void 0===this._encapsulateStyle&&(this._encapsulateStyle=!t),t||(this._scopeStyle=i.applyStylePlaceHolder(this.is)),this.__cssBuild=i.cssBuildTypeForModule(this.is)},_prepShimStyles:function(){if(this._template){var e=i.isTargetedBuild(this.__cssBuild);if(s.useNativeCSSProperties&&"shadow"===this.__cssBuild&&e)return;this._styles=this._styles||this._collectStyles(),s.useNativeCSSProperties&&!this.__cssBuild&&o.transform(this._styles,this);var r=s.useNativeCSSProperties&&e?this._styles.length&&this._styles[0].textContent.trim():n.elementStyles(this);this._prepStyleProperties(),!this._needsStyleProperties()&&r&&i.applyCss(r,this.is,t?this._template.content:null,this._scopeStyle)}else this._styles=[]},_collectStyles:function(){var e=[],t="",n=this.styleModules;if(n)for(var o,s=0,a=n.length;s<a&&(o=n[s]);s++)t+=i.cssFromModule(o);t+=i.cssFromModule(this.is);var h=this._template&&this._template.parentNode;if(!this._template||h&&h.id.toLowerCase()===this.is||(t+=i.cssFromElement(this._template)),t){var l=document.createElement("style");l.textContent=t,r.hasExtends(l.textContent)&&(t=r.transform(l)),e.push(l)}return e},_elementAdd:function(e){this._encapsulateStyle&&(e.__styleScoped?e.__styleScoped=!1:n.dom(e,this.is,this._scopeCssViaAttr))},_elementRemove:function(e){this._encapsulateStyle&&n.dom(e,this.is,this._scopeCssViaAttr,!0)},scopeSubtree:function(e,i){if(!t){var n=this,r=function(e){if(e.nodeType===Node.ELEMENT_NODE){var t=e.getAttribute("class");e.setAttribute("class",n._scopeElementClass(e,t));for(var i,r=e.querySelectorAll("*"),o=0;o<r.length&&(i=r[o]);o++)t=i.getAttribute("class"),i.setAttribute("class",n._scopeElementClass(i,t))}};if(r(e),i){var o=new MutationObserver(function(e){for(var t,i=0;i<e.length&&(t=e[i]);i++)if(t.addedNodes)for(var n=0;n<t.addedNodes.length;n++)r(t.addedNodes[n])});return o.observe(e,{childList:!0,subtree:!0}),o}}}})}(),Polymer.StyleProperties=function(){"use strict";function e(e,t){var i=parseInt(e/32),n=1<<e%32;t[i]=(t[i]||0)|n}var t=Polymer.DomApi.matchesSelector,i=Polymer.StyleUtil,n=Polymer.StyleTransformer,r=navigator.userAgent.match("Trident"),o=Polymer.Settings;return{decorateStyles:function(e,t){var r=this,o={},s=[],a=0,h=n._calcHostScope(t.is,t.extends);i.forRulesInStyles(e,function(e,n){r.decorateRule(e),e.index=a++,r.whenHostOrRootRule(t,e,n,function(n){if(e.parent.type===i.ruleTypes.MEDIA_RULE&&(t.__notStyleScopeCacheable=!0),n.isHost){var r=n.selector.split(" ").some(function(e){return 0===e.indexOf(h)&&e.length!==h.length});t.__notStyleScopeCacheable=t.__notStyleScopeCacheable||r}}),r.collectPropertiesInCssText(e.propertyInfo.cssText,o)},function(e){s.push(e)}),e._keyframes=s;var l=[];for(var c in o)l.push(c);return l},decorateRule:function(e){if(e.propertyInfo)return e.propertyInfo;var t={},i={},n=this.collectProperties(e,i);return n&&(t.properties=i,e.rules=null),t.cssText=this.collectCssText(e),e.propertyInfo=t,t},collectProperties:function(e,t){var i=e.propertyInfo;if(!i){for(var n,r,o,s=this.rx.VAR_ASSIGN,a=e.parsedCssText;n=s.exec(a);)r=(n[2]||n[3]).trim(),"inherit"!==r&&(t[n[1].trim()]=r),o=!0;return o}if(i.properties)return Polymer.Base.mixin(t,i.properties),!0},collectCssText:function(e){return this.collectConsumingCssText(e.parsedCssText)},collectConsumingCssText:function(e){return e.replace(this.rx.BRACKETED,"").replace(this.rx.VAR_ASSIGN,"")},collectPropertiesInCssText:function(e,t){for(var i;i=this.rx.VAR_CONSUMED.exec(e);){var n=i[1];":"!==i[2]&&(t[n]=!0)}},reify:function(e){for(var t,i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++)t=i[n],e[t]=this.valueForProperty(e[t],e)},valueForProperty:function(e,t){if(e)if(e.indexOf(";")>=0)e=this.valueForProperties(e,t);else{var n=this,r=function(e,i,r,o){var s=n.valueForProperty(t[i],t);return s&&"initial"!==s?"apply-shim-inherit"===s&&(s="inherit"):s=n.valueForProperty(t[r]||r,t)||r,e+(s||"")+o};e=i.processVariableAndFallback(e,r)}return e&&e.trim()||""},valueForProperties:function(e,t){for(var i,n,r=e.split(";"),o=0;o<r.length;o++)if(i=r[o]){if(this.rx.MIXIN_MATCH.lastIndex=0,n=this.rx.MIXIN_MATCH.exec(i))i=this.valueForProperty(t[n[1]],t);else{var s=i.indexOf(":");if(s!==-1){var a=i.substring(s);a=a.trim(),a=this.valueForProperty(a,t)||a,i=i.substring(0,s)+a}}r[o]=i&&i.lastIndexOf(";")===i.length-1?i.slice(0,-1):i||""}return r.join(";")},applyProperties:function(e,t){var i="";e.propertyInfo||this.decorateRule(e),e.propertyInfo.cssText&&(i=this.valueForProperties(e.propertyInfo.cssText,t)),e.cssText=i},applyKeyframeTransforms:function(e,t){var i=e.cssText,n=e.cssText;if(null==e.hasAnimations&&(e.hasAnimations=this.rx.ANIMATION_MATCH.test(i)),e.hasAnimations){var r;if(null==e.keyframeNamesToTransform){e.keyframeNamesToTransform=[];for(var o in t)r=t[o],n=r(i),i!==n&&(i=n,e.keyframeNamesToTransform.push(o))}else{for(var s=0;s<e.keyframeNamesToTransform.length;++s)r=t[e.keyframeNamesToTransform[s]],i=r(i);n=i}}e.cssText=n},propertyDataFromStyles:function(n,r){var o={},s=this,a=[];return i.forActiveRulesInStyles(n,function(i){i.propertyInfo||s.decorateRule(i);var n=i.transformedSelector||i.parsedSelector;r&&i.propertyInfo.properties&&n&&t.call(r,n)&&(s.collectProperties(i,o),e(i.index,a))}),{properties:o,key:a}},_rootSelector:/:root|:host\s*>\s*\*/,_checkRoot:function(e,t){return Boolean(t.match(this._rootSelector))||"html"===e&&t.indexOf("html")>-1},whenHostOrRootRule:function(e,t,i,r){if(t.propertyInfo||self.decorateRule(t),t.propertyInfo.properties){var s=e.is?n._calcHostScope(e.is,e.extends):"html",a=t.parsedSelector,h=this._checkRoot(s,a),l=!h&&0===a.indexOf(":host"),c=e.__cssBuild||i.__cssBuild;if("shady"===c&&(h=a===s+" > *."+s||a.indexOf("html")>-1,l=!h&&0===a.indexOf(s)),h||l){var u=s;l&&(o.useNativeShadow&&!t.transformedSelector&&(t.transformedSelector=n._transformRuleCss(t,n._transformComplexSelector,e.is,s)),u=t.transformedSelector||t.parsedSelector),h&&"html"===s&&(u=t.transformedSelector||t.parsedSelector),r({selector:u,isHost:l,isRoot:h})}}},hostAndRootPropertiesForScope:function(e){var n={},r={},o=this;return i.forActiveRulesInStyles(e._styles,function(i,s){o.whenHostOrRootRule(e,i,s,function(s){var a=e._element||e;t.call(a,s.selector)&&(s.isHost?o.collectProperties(i,n):o.collectProperties(i,r))})}),{rootProps:r,hostProps:n}},transformStyles:function(e,t,i){var r=this,s=n._calcHostScope(e.is,e.extends),a=e.extends?"\\"+s.slice(0,-1)+"\\]":s,h=new RegExp(this.rx.HOST_PREFIX+a+this.rx.HOST_SUFFIX),l=this._elementKeyframeTransforms(e,i);return n.elementStyles(e,function(n){r.applyProperties(n,t),o.useNativeShadow||Polymer.StyleUtil.isKeyframesSelector(n)||!n.cssText||(r.applyKeyframeTransforms(n,l),r._scopeSelector(n,h,s,e._scopeCssViaAttr,i))})},_elementKeyframeTransforms:function(e,t){var i=e._styles._keyframes,n={};if(!o.useNativeShadow&&i)for(var r=0,s=i[r];r<i.length;s=i[++r])this._scopeKeyframes(s,t),n[s.keyframesName]=this._keyframesRuleTransformer(s);return n},_keyframesRuleTransformer:function(e){return function(t){return t.replace(e.keyframesNameRx,e.transformedKeyframesName)}},_scopeKeyframes:function(e,t){e.keyframesNameRx=new RegExp(e.keyframesName,"g"),e.transformedKeyframesName=e.keyframesName+"-"+t,e.transformedSelector=e.transformedSelector||e.selector,e.selector=e.transformedSelector.replace(e.keyframesName,e.transformedKeyframesName)},_scopeSelector:function(e,t,i,r,o){e.transformedSelector=e.transformedSelector||e.selector;for(var s,a=e.transformedSelector,h=r?"["+n.SCOPE_NAME+"~="+o+"]":"."+o,l=a.split(","),c=0,u=l.length;c<u&&(s=l[c]);c++)l[c]=s.match(t)?s.replace(i,h):h+" "+s;e.selector=l.join(",")},applyElementScopeSelector:function(e,t,i,r){var o=r?e.getAttribute(n.SCOPE_NAME):e.getAttribute("class")||"",s=i?o.replace(i,t):(o?o+" ":"")+this.XSCOPE_NAME+" "+t;o!==s&&(r?e.setAttribute(n.SCOPE_NAME,s):e.setAttribute("class",s))},applyElementStyle:function(e,t,n,s){var a=s?s.textContent||"":this.transformStyles(e,t,n),h=e._customStyle;return h&&!o.useNativeShadow&&h!==s&&(h._useCount--,h._useCount<=0&&h.parentNode&&h.parentNode.removeChild(h)),o.useNativeShadow?e._customStyle?(e._customStyle.textContent=a,s=e._customStyle):a&&(s=i.applyCss(a,n,e.root,e._scopeStyle)):s?s.parentNode||(r&&a.indexOf("@media")>-1&&(s.textContent=a),i.applyStyle(s,null,e._scopeStyle)):a&&(s=i.applyCss(a,n,null,e._scopeStyle)),s&&(s._useCount=s._useCount||0,e._customStyle!=s&&s._useCount++,e._customStyle=s),s},mixinCustomStyle:function(e,t){var i;for(var n in t)i=t[n],(i||0===i)&&(e[n]=i)},updateNativeStyleProperties:function(e,t){var i=e.__customStyleProperties;if(i)for(var n=0;n<i.length;n++)e.style.removeProperty(i[n]);var r=[];for(var o in t)null!==t[o]&&(e.style.setProperty(o,t[o]),r.push(o));e.__customStyleProperties=r},rx:i.rx,XSCOPE_NAME:"x-scope"}}(),function(){Polymer.StyleCache=function(){this.cache={}},Polymer.StyleCache.prototype={MAX:100,store:function(e,t,i,n){t.keyValues=i,t.styles=n;var r=this.cache[e]=this.cache[e]||[];r.push(t),r.length>this.MAX&&r.shift()},retrieve:function(e,t,i){var n=this.cache[e];if(n)for(var r,o=n.length-1;o>=0;o--)if(r=n[o],i===r.styles&&this._objectsEqual(t,r.keyValues))return r},clear:function(){this.cache={}},_objectsEqual:function(e,t){var i,n;for(var r in e)if(i=e[r],n=t[r],!("object"==typeof i&&i?this._objectsStrictlyEqual(i,n):i===n))return!1;return!Array.isArray(e)||e.length===t.length},_objectsStrictlyEqual:function(e,t){return this._objectsEqual(e,t)&&this._objectsEqual(t,e)}}}(),Polymer.StyleDefaults=function(){var e=Polymer.StyleProperties,t=Polymer.StyleCache,i=Polymer.Settings.useNativeCSSProperties,n={_styles:[],_properties:null,customStyle:{},_styleCache:new t,_element:Polymer.DomApi.wrap(document.documentElement),addStyle:function(e){this._styles.push(e),this._properties=null},get _styleProperties(){return this._properties||(e.decorateStyles(this._styles,this),this._styles._scopeStyleProperties=null,this._properties=e.hostAndRootPropertiesForScope(this).rootProps,e.mixinCustomStyle(this._properties,this.customStyle),e.reify(this._properties)),this._properties},hasStyleProperties:function(){return Boolean(this._properties)},_needsStyleProperties:function(){},_computeStyleProperties:function(){return this._styleProperties},updateStyles:function(t){this._properties=null,t&&Polymer.Base.mixin(this.customStyle,t),this._styleCache.clear();for(var n,r=0;r<this._styles.length;r++)n=this._styles[r],n=n.__importElement||n,n._apply();i&&e.updateNativeStyleProperties(document.documentElement,this.customStyle)}};return n}(),function(){"use strict";var e=Polymer.Base.serializeValueToAttribute,t=Polymer.StyleProperties,i=Polymer.StyleTransformer,n=Polymer.StyleDefaults,r=Polymer.Settings.useNativeShadow,o=Polymer.Settings.useNativeCSSProperties;Polymer.Base._addFeature({_prepStyleProperties:function(){o||(this._ownStylePropertyNames=this._styles&&this._styles.length?t.decorateStyles(this._styles,this):null)},customStyle:null,getComputedStyleValue:function(e){return!o&&this._styleProperties&&this._styleProperties[e]||getComputedStyle(this).getPropertyValue(e)},_setupStyleProperties:function(){this.customStyle={},this._styleCache=null,this._styleProperties=null,this._scopeSelector=null,this._ownStyleProperties=null,this._customStyle=null},_needsStyleProperties:function(){return Boolean(!o&&this._ownStylePropertyNames&&this._ownStylePropertyNames.length)},_validateApplyShim:function(){if(this.__applyShimInvalid){Polymer.ApplyShim.transform(this._styles,this.__proto__);var e=i.elementStyles(this);if(r){var t=this._template.content.querySelector("style");t&&(t.textContent=e)}else{var n=this._scopeStyle&&this._scopeStyle.nextSibling;n&&(n.textContent=e)}}},_beforeAttached:function(){this._scopeSelector&&!this.__stylePropertiesInvalid||!this._needsStyleProperties()||(this.__stylePropertiesInvalid=!1,this._updateStyleProperties())},_findStyleHost:function(){for(var e,t=this;e=Polymer.dom(t).getOwnerRoot();){if(Polymer.isInstance(e.host))return e.host;t=e.host}return n},_updateStyleProperties:function(){var e,i=this._findStyleHost();i._styleProperties||i._computeStyleProperties(),i._styleCache||(i._styleCache=new Polymer.StyleCache);var n=t.propertyDataFromStyles(i._styles,this),o=!this.__notStyleScopeCacheable;o&&(n.key.customStyle=this.customStyle,e=i._styleCache.retrieve(this.is,n.key,this._styles));var a=Boolean(e);a?this._styleProperties=e._styleProperties:this._computeStyleProperties(n.properties),this._computeOwnStyleProperties(),a||(e=s.retrieve(this.is,this._ownStyleProperties,this._styles));var h=Boolean(e)&&!a,l=this._applyStyleProperties(e);a||(l=l&&r?l.cloneNode(!0):l,e={style:l,_scopeSelector:this._scopeSelector,_styleProperties:this._styleProperties},o&&(n.key.customStyle={},this.mixin(n.key.customStyle,this.customStyle),i._styleCache.store(this.is,e,n.key,this._styles)),h||s.store(this.is,Object.create(e),this._ownStyleProperties,this._styles))},_computeStyleProperties:function(e){var i=this._findStyleHost();i._styleProperties||i._computeStyleProperties();var n=Object.create(i._styleProperties),r=t.hostAndRootPropertiesForScope(this);this.mixin(n,r.hostProps),e=e||t.propertyDataFromStyles(i._styles,this).properties,this.mixin(n,e),this.mixin(n,r.rootProps),t.mixinCustomStyle(n,this.customStyle),t.reify(n),this._styleProperties=n},_computeOwnStyleProperties:function(){for(var e,t={},i=0;i<this._ownStylePropertyNames.length;i++)e=this._ownStylePropertyNames[i],t[e]=this._styleProperties[e];this._ownStyleProperties=t},_scopeCount:0,_applyStyleProperties:function(e){var i=this._scopeSelector;this._scopeSelector=e?e._scopeSelector:this.is+"-"+this.__proto__._scopeCount++;
var n=t.applyElementStyle(this,this._styleProperties,this._scopeSelector,e&&e.style);return r||t.applyElementScopeSelector(this,this._scopeSelector,i,this._scopeCssViaAttr),n},serializeValueToAttribute:function(t,i,n){if(n=n||this,"class"===i&&!r){var o=n===this?this.domHost||this.dataHost:this;o&&(t=o._scopeElementClass(n,t))}n=this.shadyRoot&&this.shadyRoot._hasDistributed?Polymer.dom(n):n,e.call(this,t,i,n)},_scopeElementClass:function(e,t){return r||this._scopeCssViaAttr||(t=(t?t+" ":"")+a+" "+this.is+(e._scopeSelector?" "+h+" "+e._scopeSelector:"")),t},updateStyles:function(e){e&&this.mixin(this.customStyle,e),o?t.updateNativeStyleProperties(this,this.customStyle):(this.isAttached?this._needsStyleProperties()?this._updateStyleProperties():this._styleProperties=null:this.__stylePropertiesInvalid=!0,this._styleCache&&this._styleCache.clear(),this._updateRootStyles())},_updateRootStyles:function(e){e=e||this.root;for(var t,i=Polymer.dom(e)._query(function(e){return e.shadyRoot||e.shadowRoot}),n=0,r=i.length;n<r&&(t=i[n]);n++)t.updateStyles&&t.updateStyles()}}),Polymer.updateStyles=function(e){n.updateStyles(e),Polymer.Base._updateRootStyles(document)};var s=new Polymer.StyleCache;Polymer.customStyleCache=s;var a=i.SCOPE_NAME,h=t.XSCOPE_NAME}(),Polymer.Base._addFeature({_registerFeatures:function(){this._prepIs(),this._prepConstructor(),this._prepStyles()},_finishRegisterFeatures:function(){this._prepTemplate(),this._prepShimStyles(),this._prepAnnotations(),this._prepEffects(),this._prepBehaviors(),this._prepPropertyInfo(),this._prepBindings(),this._prepShady()},_prepBehavior:function(e){this._addPropertyEffects(e.properties),this._addComplexObserverEffects(e.observers),this._addHostAttributes(e.hostAttributes)},_initFeatures:function(){this._setupGestures(),this._setupConfigure(),this._setupStyleProperties(),this._setupDebouncers(),this._setupShady(),this._registerHost(),this._template&&(this._validateApplyShim(),this._poolContent(),this._beginHosting(),this._stampTemplate(),this._endHosting(),this._marshalAnnotationReferences()),this._marshalInstanceEffects(),this._marshalBehaviors(),this._marshalHostAttributes(),this._marshalAttributes(),this._tryReady()},_marshalBehavior:function(e){e.listeners&&this._listenListeners(e.listeners)}}),function(){var e,t=Polymer.StyleProperties,i=Polymer.StyleUtil,n=Polymer.CssParse,r=Polymer.StyleDefaults,o=Polymer.StyleTransformer,s=Polymer.ApplyShim,a=Polymer.Debounce,h=Polymer.Settings;Polymer({is:"custom-style",extends:"style",_template:null,properties:{include:String},ready:function(){this.__appliedElement=this.__appliedElement||this,this.__cssBuild=i.getCssBuildType(this),this.__appliedElement!==this&&(this.__appliedElement.__cssBuild=this.__cssBuild),this._tryApply()},attached:function(){this._tryApply()},_tryApply:function(){if(!this._appliesToDocument&&this.parentNode&&"dom-module"!==this.parentNode.localName){this._appliesToDocument=!0;var e=this.__appliedElement;if(h.useNativeCSSProperties||(this.__needsUpdateStyles=r.hasStyleProperties(),r.addStyle(e)),e.textContent||this.include)this._apply(!0);else{var t=this,i=new MutationObserver(function(){i.disconnect(),t._apply(!0)});i.observe(e,{childList:!0})}}},_updateStyles:function(){Polymer.updateStyles()},_apply:function(e){var t=this.__appliedElement;if(this.include&&(t.textContent=i.cssFromModules(this.include,!0)+t.textContent),t.textContent){var n=this.__cssBuild,r=i.isTargetedBuild(n);if(!h.useNativeCSSProperties||!r){var a=i.rulesForStyle(t);if(r||(i.forEachRule(a,function(e){o.documentRule(e)}),h.useNativeCSSProperties&&!n&&s.transform([t])),h.useNativeCSSProperties)t.textContent=i.toCssText(a);else{var l=this,c=function(){l._flushCustomProperties()};e?Polymer.RenderStatus.whenReady(c):c()}}}},_flushCustomProperties:function(){this.__needsUpdateStyles?(this.__needsUpdateStyles=!1,e=a(e,this._updateStyles)):this._applyCustomProperties()},_applyCustomProperties:function(){var e=this.__appliedElement;this._computeStyleProperties();var r=this._styleProperties,o=i.rulesForStyle(e);o&&(e.textContent=i.toCssText(o,function(e){var i=e.cssText=e.parsedCssText;e.propertyInfo&&e.propertyInfo.cssText&&(i=n.removeCustomPropAssignment(i),e.cssText=t.valueForProperties(i,r))}))}})}(),Polymer.Templatizer={properties:{__hideTemplateChildren__:{observer:"_showHideChildren"}},_instanceProps:Polymer.nob,_parentPropPrefix:"_parent_",templatize:function(e){if(this._templatized=e,e._content||(e._content=e.content),e._content._ctor)return this.ctor=e._content._ctor,void this._prepParentProperties(this.ctor.prototype,e);var t=Object.create(Polymer.Base);this._customPrepAnnotations(t,e),this._prepParentProperties(t,e),t._prepEffects(),this._customPrepEffects(t),t._prepBehaviors(),t._prepPropertyInfo(),t._prepBindings(),t._notifyPathUp=this._notifyPathUpImpl,t._scopeElementClass=this._scopeElementClassImpl,t.listen=this._listenImpl,t._showHideChildren=this._showHideChildrenImpl,t.__setPropertyOrig=this.__setProperty,t.__setProperty=this.__setPropertyImpl;var i=this._constructorImpl,n=function(e,t){i.call(this,e,t)};n.prototype=t,t.constructor=n,e._content._ctor=n,this.ctor=n},_getRootDataHost:function(){return this.dataHost&&this.dataHost._rootDataHost||this.dataHost},_showHideChildrenImpl:function(e){for(var t=this._children,i=0;i<t.length;i++){var n=t[i];Boolean(e)!=Boolean(n.__hideTemplateChildren__)&&(n.nodeType===Node.TEXT_NODE?e?(n.__polymerTextContent__=n.textContent,n.textContent=""):n.textContent=n.__polymerTextContent__:n.style&&(e?(n.__polymerDisplay__=n.style.display,n.style.display="none"):n.style.display=n.__polymerDisplay__)),n.__hideTemplateChildren__=e}},__setPropertyImpl:function(e,t,i,n){n&&n.__hideTemplateChildren__&&"textContent"==e&&(e="__polymerTextContent__"),this.__setPropertyOrig(e,t,i,n)},_debounceTemplate:function(e){Polymer.dom.addDebouncer(this.debounce("_debounceTemplate",e))},_flushTemplates:function(){Polymer.dom.flush()},_customPrepEffects:function(e){var t=e._parentProps;for(var i in t)e._addPropertyEffect(i,"function",this._createHostPropEffector(i));for(i in this._instanceProps)e._addPropertyEffect(i,"function",this._createInstancePropEffector(i))},_customPrepAnnotations:function(e,t){e._template=t;var i=t._content;if(!i._notes){var n=e._rootDataHost;n&&(Polymer.Annotations.prepElement=function(){n._prepElement()}),i._notes=Polymer.Annotations.parseAnnotations(t),Polymer.Annotations.prepElement=null,this._processAnnotations(i._notes)}e._notes=i._notes,e._parentProps=i._parentProps},_prepParentProperties:function(e,t){var i=this._parentProps=e._parentProps;if(this._forwardParentProp&&i){var n,r=e._parentPropProto;if(!r){for(n in this._instanceProps)delete i[n];r=e._parentPropProto=Object.create(null),t!=this&&(Polymer.Bind.prepareModel(r),Polymer.Base.prepareModelNotifyPath(r));for(n in i){var o=this._parentPropPrefix+n,s=[{kind:"function",effect:this._createForwardPropEffector(n),fn:Polymer.Bind._functionEffect},{kind:"notify",fn:Polymer.Bind._notifyEffect,effect:{event:Polymer.CaseMap.camelToDashCase(o)+"-changed"}}];Polymer.Bind._createAccessors(r,o,s)}}var a=this;t!=this&&(Polymer.Bind.prepareInstance(t),t._forwardParentProp=function(e,t){a._forwardParentProp(e,t)}),this._extendTemplate(t,r),t._pathEffector=function(e,t,i){return a._pathEffectorImpl(e,t,i)}}},_createForwardPropEffector:function(e){return function(t,i){this._forwardParentProp(e,i)}},_createHostPropEffector:function(e){var t=this._parentPropPrefix;return function(i,n){this.dataHost._templatized[t+e]=n}},_createInstancePropEffector:function(e){return function(t,i,n,r){r||this.dataHost._forwardInstanceProp(this,e,i)}},_extendTemplate:function(e,t){var i=Object.getOwnPropertyNames(t);t._propertySetter&&(e._propertySetter=t._propertySetter);for(var n,r=0;r<i.length&&(n=i[r]);r++){var o=e[n],s=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,s),void 0!==o&&e._propertySetter(n,o)}},_showHideChildren:function(e){},_forwardInstancePath:function(e,t,i){},_forwardInstanceProp:function(e,t,i){},_notifyPathUpImpl:function(e,t){var i=this.dataHost,n=Polymer.Path.root(e);i._forwardInstancePath.call(i,this,e,t),n in i._parentProps&&i._templatized._notifyPath(i._parentPropPrefix+e,t)},_pathEffectorImpl:function(e,t,i){if(this._forwardParentPath&&0===e.indexOf(this._parentPropPrefix)){var n=e.substring(this._parentPropPrefix.length),r=Polymer.Path.root(n);r in this._parentProps&&this._forwardParentPath(n,t)}Polymer.Base._pathEffector.call(this._templatized,e,t,i)},_constructorImpl:function(e,t){this._rootDataHost=t._getRootDataHost(),this._setupConfigure(e),this._registerHost(t),this._beginHosting(),this.root=this.instanceTemplate(this._template),this.root.__noContent=!this._notes._hasContent,this.root.__styleScoped=!0,this._endHosting(),this._marshalAnnotatedNodes(),this._marshalInstanceEffects(),this._marshalAnnotatedListeners();for(var i=[],n=this.root.firstChild;n;n=n.nextSibling)i.push(n),n._templateInstance=this;this._children=i,t.__hideTemplateChildren__&&this._showHideChildren(!0),this._tryReady()},_listenImpl:function(e,t,i){var n=this,r=this._rootDataHost,o=r._createEventHandler(e,t,i),s=function(e){e.model=n,o(e)};r._listen(e,t,s)},_scopeElementClassImpl:function(e,t){var i=this._rootDataHost;return i?i._scopeElementClass(e,t):t},stamp:function(e){if(e=e||{},this._parentProps){var t=this._templatized;for(var i in this._parentProps)void 0===e[i]&&(e[i]=t[this._parentPropPrefix+i])}return new this.ctor(e,this)},modelForElement:function(e){for(var t;e;)if(t=e._templateInstance){if(t.dataHost==this)return t;e=t.dataHost}else e=e.parentNode}},Polymer({is:"dom-template",extends:"template",_template:null,behaviors:[Polymer.Templatizer],ready:function(){this.templatize(this)}}),Polymer._collections=new WeakMap,Polymer.Collection=function(e){Polymer._collections.set(e,this),this.userArray=e,this.store=e.slice(),this.initMap()},Polymer.Collection.prototype={constructor:Polymer.Collection,initMap:function(){for(var e=this.omap=new WeakMap,t=this.pmap={},i=this.store,n=0;n<i.length;n++){var r=i[n];r&&"object"==typeof r?e.set(r,n):t[r]=n}},add:function(e){var t=this.store.push(e)-1;return e&&"object"==typeof e?this.omap.set(e,t):this.pmap[e]=t,"#"+t},removeKey:function(e){(e=this._parseKey(e))&&(this._removeFromMap(this.store[e]),delete this.store[e])},_removeFromMap:function(e){e&&"object"==typeof e?this.omap.delete(e):delete this.pmap[e]},remove:function(e){var t=this.getKey(e);return this.removeKey(t),t},getKey:function(e){var t;if(t=e&&"object"==typeof e?this.omap.get(e):this.pmap[e],void 0!=t)return"#"+t},getKeys:function(){return Object.keys(this.store).map(function(e){return"#"+e})},_parseKey:function(e){if(e&&"#"==e[0])return e.slice(1)},setItem:function(e,t){if(e=this._parseKey(e)){var i=this.store[e];i&&this._removeFromMap(i),t&&"object"==typeof t?this.omap.set(t,e):this.pmap[t]=e,this.store[e]=t}},getItem:function(e){if(e=this._parseKey(e))return this.store[e]},getItems:function(){var e=[],t=this.store;for(var i in t)e.push(t[i]);return e},_applySplices:function(e){for(var t,i,n={},r=0;r<e.length&&(i=e[r]);r++){i.addedKeys=[];for(var o=0;o<i.removed.length;o++)t=this.getKey(i.removed[o]),n[t]=n[t]?null:-1;for(o=0;o<i.addedCount;o++){var s=this.userArray[i.index+o];t=this.getKey(s),t=void 0===t?this.add(s):t,n[t]=n[t]?null:1,i.addedKeys.push(t)}}var a=[],h=[];for(t in n)n[t]<0&&(this.removeKey(t),a.push(t)),n[t]>0&&h.push(t);return[{removed:a,added:h}]}},Polymer.Collection.get=function(e){return Polymer._collections.get(e)||new Polymer.Collection(e)},Polymer.Collection.applySplices=function(e,t){var i=Polymer._collections.get(e);return i?i._applySplices(t):null},Polymer({is:"dom-repeat",extends:"template",_template:null,properties:{items:{type:Array},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},sort:{type:Function,observer:"_sortChanged"},filter:{type:Function,observer:"_filterChanged"},observe:{type:String,observer:"_observeChanged"},delay:Number,renderedItemCount:{type:Number,notify:!0,readOnly:!0},initialCount:{type:Number,observer:"_initializeChunking"},targetFramerate:{type:Number,value:20},_targetFrameTime:{type:Number,computed:"_computeFrameTime(targetFramerate)"}},behaviors:[Polymer.Templatizer],observers:["_itemsChanged(items.*)"],created:function(){this._instances=[],this._pool=[],this._limit=1/0;var e=this;this._boundRenderChunk=function(){e._renderChunk()}},detached:function(){this.__isDetached=!0;for(var e=0;e<this._instances.length;e++)this._detachInstance(e)},attached:function(){if(this.__isDetached){this.__isDetached=!1;for(var e=Polymer.dom(Polymer.dom(this).parentNode),t=0;t<this._instances.length;t++)this._attachInstance(t,e)}},ready:function(){this._instanceProps={__key__:!0},this._instanceProps[this.as]=!0,this._instanceProps[this.indexAs]=!0,this.ctor||this.templatize(this)},_sortChanged:function(e){var t=this._getRootDataHost();this._sortFn=e&&("function"==typeof e?e:function(){return t[e].apply(t,arguments)}),this._needFullRefresh=!0,this.items&&this._debounceTemplate(this._render)},_filterChanged:function(e){var t=this._getRootDataHost();this._filterFn=e&&("function"==typeof e?e:function(){return t[e].apply(t,arguments)}),this._needFullRefresh=!0,this.items&&this._debounceTemplate(this._render)},_computeFrameTime:function(e){return Math.ceil(1e3/e)},_initializeChunking:function(){this.initialCount&&(this._limit=this.initialCount,this._chunkCount=this.initialCount,this._lastChunkTime=performance.now())},_tryRenderChunk:function(){this.items&&this._limit<this.items.length&&this.debounce("renderChunk",this._requestRenderChunk)},_requestRenderChunk:function(){requestAnimationFrame(this._boundRenderChunk)},_renderChunk:function(){var e=performance.now(),t=this._targetFrameTime/(e-this._lastChunkTime);this._chunkCount=Math.round(this._chunkCount*t)||1,this._limit+=this._chunkCount,this._lastChunkTime=e,this._debounceTemplate(this._render)},_observeChanged:function(){this._observePaths=this.observe&&this.observe.replace(".*",".").split(" ")},_itemsChanged:function(e){if("items"==e.path)Array.isArray(this.items)?this.collection=Polymer.Collection.get(this.items):this.items?this._error(this._logf("dom-repeat","expected array for `items`, found",this.items)):this.collection=null,this._keySplices=[],this._indexSplices=[],this._needFullRefresh=!0,this._initializeChunking(),this._debounceTemplate(this._render);else if("items.splices"==e.path)this._keySplices=this._keySplices.concat(e.value.keySplices),this._indexSplices=this._indexSplices.concat(e.value.indexSplices),this._debounceTemplate(this._render);else{var t=e.path.slice(6);this._forwardItemPath(t,e.value),this._checkObservedPaths(t)}},_checkObservedPaths:function(e){if(this._observePaths){e=e.substring(e.indexOf(".")+1);for(var t=this._observePaths,i=0;i<t.length;i++)if(0===e.indexOf(t[i]))return this._needFullRefresh=!0,void(this.delay?this.debounce("render",this._render,this.delay):this._debounceTemplate(this._render))}},render:function(){this._needFullRefresh=!0,this._debounceTemplate(this._render),this._flushTemplates()},_render:function(){this._needFullRefresh?(this._applyFullRefresh(),this._needFullRefresh=!1):this._keySplices.length&&(this._sortFn?this._applySplicesUserSort(this._keySplices):this._filterFn?this._applyFullRefresh():this._applySplicesArrayOrder(this._indexSplices)),this._keySplices=[],this._indexSplices=[];for(var e=this._keyToInstIdx={},t=this._instances.length-1;t>=0;t--){var i=this._instances[t];i.isPlaceholder&&t<this._limit?i=this._insertInstance(t,i.__key__):!i.isPlaceholder&&t>=this._limit&&(i=this._downgradeInstance(t,i.__key__)),e[i.__key__]=t,i.isPlaceholder||i.__setProperty(this.indexAs,t,!0)}this._pool.length=0,this._setRenderedItemCount(this._instances.length),this.fire("dom-change"),this._tryRenderChunk()},_applyFullRefresh:function(){var e,t=this.collection;if(this._sortFn)e=t?t.getKeys():[];else{e=[];var i=this.items;if(i)for(var n=0;n<i.length;n++)e.push(t.getKey(i[n]))}var r=this;for(this._filterFn&&(e=e.filter(function(e){return r._filterFn(t.getItem(e))})),this._sortFn&&e.sort(function(e,i){return r._sortFn(t.getItem(e),t.getItem(i))}),n=0;n<e.length;n++){var o=e[n],s=this._instances[n];s?(s.__key__=o,!s.isPlaceholder&&n<this._limit&&s.__setProperty(this.as,t.getItem(o),!0)):n<this._limit?this._insertInstance(n,o):this._insertPlaceholder(n,o)}for(var a=this._instances.length-1;a>=n;a--)this._detachAndRemoveInstance(a)},_numericSort:function(e,t){return e-t},_applySplicesUserSort:function(e){for(var t,i,n=this.collection,r={},o=0;o<e.length&&(i=e[o]);o++){for(var s=0;s<i.removed.length;s++)t=i.removed[s],r[t]=r[t]?null:-1;for(s=0;s<i.added.length;s++)t=i.added[s],r[t]=r[t]?null:1}var a=[],h=[];for(t in r)r[t]===-1&&a.push(this._keyToInstIdx[t]),1===r[t]&&h.push(t);if(a.length)for(a.sort(this._numericSort),o=a.length-1;o>=0;o--){var l=a[o];void 0!==l&&this._detachAndRemoveInstance(l)}var c=this;if(h.length){this._filterFn&&(h=h.filter(function(e){return c._filterFn(n.getItem(e))})),h.sort(function(e,t){return c._sortFn(n.getItem(e),n.getItem(t))});var u=0;for(o=0;o<h.length;o++)u=this._insertRowUserSort(u,h[o])}},_insertRowUserSort:function(e,t){for(var i=this.collection,n=i.getItem(t),r=this._instances.length-1,o=-1;e<=r;){var s=e+r>>1,a=this._instances[s].__key__,h=this._sortFn(i.getItem(a),n);if(h<0)e=s+1;else{if(!(h>0)){o=s;break}r=s-1}}return o<0&&(o=r+1),this._insertPlaceholder(o,t),o},_applySplicesArrayOrder:function(e){for(var t,i=0;i<e.length&&(t=e[i]);i++){for(var n=0;n<t.removed.length;n++)this._detachAndRemoveInstance(t.index);for(n=0;n<t.addedKeys.length;n++)this._insertPlaceholder(t.index+n,t.addedKeys[n])}},_detachInstance:function(e){var t=this._instances[e];if(!t.isPlaceholder){for(var i=0;i<t._children.length;i++){var n=t._children[i];Polymer.dom(t.root).appendChild(n)}return t}},_attachInstance:function(e,t){var i=this._instances[e];i.isPlaceholder||t.insertBefore(i.root,this)},_detachAndRemoveInstance:function(e){var t=this._detachInstance(e);t&&this._pool.push(t),this._instances.splice(e,1)},_insertPlaceholder:function(e,t){this._instances.splice(e,0,{isPlaceholder:!0,__key__:t})},_stampInstance:function(e,t){var i={__key__:t};return i[this.as]=this.collection.getItem(t),i[this.indexAs]=e,this.stamp(i)},_insertInstance:function(e,t){var i=this._pool.pop();i?(i.__setProperty(this.as,this.collection.getItem(t),!0),i.__setProperty("__key__",t,!0)):i=this._stampInstance(e,t);var n=this._instances[e+1],r=n&&!n.isPlaceholder?n._children[0]:this,o=Polymer.dom(this).parentNode;return Polymer.dom(o).insertBefore(i.root,r),this._instances[e]=i,i},_downgradeInstance:function(e,t){var i=this._detachInstance(e);return i&&this._pool.push(i),i={isPlaceholder:!0,__key__:t},this._instances[e]=i,i},_showHideChildren:function(e){for(var t=0;t<this._instances.length;t++)this._instances[t]._showHideChildren(e)},_forwardInstanceProp:function(e,t,i){if(t==this.as){var n;n=this._sortFn||this._filterFn?this.items.indexOf(this.collection.getItem(e.__key__)):e[this.indexAs],this.set("items."+n,i)}},_forwardInstancePath:function(e,t,i){0===t.indexOf(this.as+".")&&this._notifyPath("items."+e.__key__+"."+t.slice(this.as.length+1),i)},_forwardParentProp:function(e,t){for(var i,n=this._instances,r=0;r<n.length&&(i=n[r]);r++)i.isPlaceholder||i.__setProperty(e,t,!0)},_forwardParentPath:function(e,t){for(var i,n=this._instances,r=0;r<n.length&&(i=n[r]);r++)i.isPlaceholder||i._notifyPath(e,t,!0)},_forwardItemPath:function(e,t){if(this._keyToInstIdx){var i=e.indexOf("."),n=e.substring(0,i<0?e.length:i),r=this._keyToInstIdx[n],o=this._instances[r];o&&!o.isPlaceholder&&(i>=0?(e=this.as+"."+e.substring(i+1),o._notifyPath(e,t,!0)):o.__setProperty(this.as,t,!0))}},itemForElement:function(e){var t=this.modelForElement(e);return t&&t[this.as]},keyForElement:function(e){var t=this.modelForElement(e);return t&&t.__key__},indexForElement:function(e){var t=this.modelForElement(e);return t&&t[this.indexAs]}}),Polymer({is:"array-selector",_template:null,properties:{items:{type:Array,observer:"clearSelection"},multi:{type:Boolean,value:!1,observer:"clearSelection"},selected:{type:Object,notify:!0},selectedItem:{type:Object,notify:!0},toggle:{type:Boolean,value:!1}},clearSelection:function(){if(Array.isArray(this.selected))for(var e=0;e<this.selected.length;e++)this.unlinkPaths("selected."+e);else this.unlinkPaths("selected"),this.unlinkPaths("selectedItem");this.multi?this.selected&&!this.selected.length||(this.selected=[],this._selectedColl=Polymer.Collection.get(this.selected)):(this.selected=null,this._selectedColl=null),this.selectedItem=null},isSelected:function(e){return this.multi?void 0!==this._selectedColl.getKey(e):this.selected==e},deselect:function(e){if(this.multi){if(this.isSelected(e)){var t=this._selectedColl.getKey(e);this.arrayDelete("selected",e),this.unlinkPaths("selected."+t)}}else this.selected=null,this.selectedItem=null,this.unlinkPaths("selected"),this.unlinkPaths("selectedItem")},select:function(e){var t=Polymer.Collection.get(this.items),i=t.getKey(e);if(this.multi)if(this.isSelected(e))this.toggle&&this.deselect(e);else{this.push("selected",e);var n=this._selectedColl.getKey(e);this.linkPaths("selected."+n,"items."+i)}else this.toggle&&e==this.selected?this.deselect():(this.selected=e,this.selectedItem=e,this.linkPaths("selected","items."+i),this.linkPaths("selectedItem","items."+i))}}),Polymer({is:"dom-if",extends:"template",_template:null,properties:{if:{type:Boolean,value:!1,observer:"_queueRender"},restamp:{type:Boolean,value:!1,observer:"_queueRender"}},behaviors:[Polymer.Templatizer],_queueRender:function(){this._debounceTemplate(this._render)},detached:function(){this.parentNode&&(this.parentNode.nodeType!=Node.DOCUMENT_FRAGMENT_NODE||Polymer.Settings.hasShadow&&this.parentNode instanceof ShadowRoot)||this._teardownInstance()},attached:function(){this.if&&this.ctor&&this.async(this._ensureInstance)},render:function(){this._flushTemplates()},_render:function(){this.if?(this.ctor||this.templatize(this),this._ensureInstance(),this._showHideChildren()):this.restamp&&this._teardownInstance(),!this.restamp&&this._instance&&this._showHideChildren(),this.if!=this._lastIf&&(this.fire("dom-change"),this._lastIf=this.if)},_ensureInstance:function(){var e=Polymer.dom(this).parentNode;if(e){var t=Polymer.dom(e);if(this._instance){var i=this._instance._children;if(i&&i.length){var n=Polymer.dom(this).previousSibling;if(n!==i[i.length-1])for(var r,o=0;o<i.length&&(r=i[o]);o++)t.insertBefore(r,this)}}else{this._instance=this.stamp();var s=this._instance.root;t.insertBefore(s,this)}}},_teardownInstance:function(){if(this._instance){var e=this._instance._children;if(e&&e.length)for(var t,i=Polymer.dom(Polymer.dom(e[0]).parentNode),n=0;n<e.length&&(t=e[n]);n++)i.removeChild(t);this._instance=null}},_showHideChildren:function(){var e=this.__hideTemplateChildren__||!this.if;this._instance&&this._instance._showHideChildren(e)},_forwardParentProp:function(e,t){this._instance&&this._instance.__setProperty(e,t,!0)},_forwardParentPath:function(e,t){this._instance&&this._instance._notifyPath(e,t,!0)}}),Polymer({is:"dom-bind",extends:"template",_template:null,created:function(){var e=this;Polymer.RenderStatus.whenReady(function(){"loading"==document.readyState?document.addEventListener("DOMContentLoaded",function(){e._markImportsReady()}):e._markImportsReady()})},_ensureReady:function(){this._readied||this._readySelf()},_markImportsReady:function(){this._importsReady=!0,this._ensureReady()},_registerFeatures:function(){this._prepConstructor()},_insertChildren:function(){var e=Polymer.dom(Polymer.dom(this).parentNode);e.insertBefore(this.root,this)},_removeChildren:function(){if(this._children)for(var e=0;e<this._children.length;e++)this.root.appendChild(this._children[e])},_initFeatures:function(){},_scopeElementClass:function(e,t){return this.dataHost?this.dataHost._scopeElementClass(e,t):t},_configureInstanceProperties:function(){},_prepConfigure:function(){var e={};for(var t in this._propertyEffects)e[t]=this[t];var i=this._setupConfigure;this._setupConfigure=function(){i.call(this,e)}},attached:function(){this._importsReady&&this.render()},detached:function(){this._removeChildren()},render:function(){this._ensureReady(),this._children||(this._template=this,this._prepAnnotations(),this._prepEffects(),this._prepBehaviors(),this._prepConfigure(),this._prepBindings(),this._prepPropertyInfo(),Polymer.Base._initFeatures.call(this),this._children=Polymer.TreeApi.arrayCopyChildNodes(this.root)),this._insertChildren(),this.fire("dom-change")}}),function(){"use strict";Polymer({is:"iron-location",properties:{path:{type:String,notify:!0,value:function(){return window.decodeURIComponent(window.location.pathname)}},query:{type:String,notify:!0,value:function(){return window.location.search.slice(1)}},hash:{type:String,notify:!0,value:function(){return window.decodeURIComponent(window.location.hash.slice(1))}},dwellTime:{type:Number,value:2e3},urlSpaceRegex:{type:String,value:""},_urlSpaceRegExp:{computed:"_makeRegExp(urlSpaceRegex)"},_lastChangedAt:{type:Number},_initialized:{type:Boolean,value:!1}},hostAttributes:{hidden:!0},observers:["_updateUrl(path, query, hash)"],attached:function(){this.listen(window,"hashchange","_hashChanged"),this.listen(window,"location-changed","_urlChanged"),this.listen(window,"popstate","_urlChanged"),this.listen(document.body,"click","_globalOnClick"),this._lastChangedAt=window.performance.now()-(this.dwellTime-200),this._initialized=!0,this._urlChanged()},detached:function(){this.unlisten(window,"hashchange","_hashChanged"),this.unlisten(window,"location-changed","_urlChanged"),this.unlisten(window,"popstate","_urlChanged"),this.unlisten(document.body,"click","_globalOnClick"),this._initialized=!1},_hashChanged:function(){this.hash=window.decodeURIComponent(window.location.hash.substring(1))},_urlChanged:function(){this._dontUpdateUrl=!0,this._hashChanged(),this.path=window.decodeURIComponent(window.location.pathname),this.query=window.location.search.substring(1),this._dontUpdateUrl=!1,this._updateUrl()},_getUrl:function(){var e=window.encodeURI(this.path).replace(/\#/g,"%23").replace(/\?/g,"%3F"),t="";this.query&&(t="?"+this.query.replace(/\#/g,"%23"));var i="";return this.hash&&(i="#"+window.encodeURI(this.hash)),e+t+i},_updateUrl:function(){if(!this._dontUpdateUrl&&this._initialized&&(this.path!==window.decodeURIComponent(window.location.pathname)||this.query!==window.location.search.substring(1)||this.hash!==window.decodeURIComponent(window.location.hash.substring(1)))){var e=this._getUrl(),t=new URL(e,window.location.protocol+"//"+window.location.host).href,i=window.performance.now(),n=this._lastChangedAt+this.dwellTime>i;this._lastChangedAt=i,n?window.history.replaceState({},"",t):window.history.pushState({},"",t),this.fire("location-changed",{},{node:window})}},_globalOnClick:function(e){if(!e.defaultPrevented){var t=this._getSameOriginLinkHref(e);t&&(e.preventDefault(),t!==window.location.href&&(window.history.pushState({},"",t),this.fire("location-changed",{},{node:window})))}},_getSameOriginLinkHref:function(e){if(0!==e.button)return null;if(e.metaKey||e.ctrlKey)return null;for(var t=Polymer.dom(e).path,i=null,n=0;n<t.length;n++){var r=t[n];if("A"===r.tagName&&r.href){i=r;break}}if(!i)return null;if("_blank"===i.target)return null;if(("_top"===i.target||"_parent"===i.target)&&window.top!==window)return null;var o,s=i.href;o=null!=document.baseURI?new URL(s,document.baseURI):new URL(s);var a;if(window.location.origin?a=window.location.origin:(a=window.location.protocol+"//"+window.location.hostname,window.location.port&&(a+=":"+window.location.port)),o.origin!==a)return null;var h=o.pathname+o.search+o.hash;if(this._urlSpaceRegExp&&!this._urlSpaceRegExp.test(h))return null;var l=new URL(h,window.location.href).href;return l},_makeRegExp:function(e){return RegExp(e)}})}(),Polymer({is:"iron-query-params",properties:{paramsString:{type:String,notify:!0,observer:"paramsStringChanged"},paramsObject:{type:Object,notify:!0,value:function(){return{}}},_dontReact:{type:Boolean,value:!1}},hostAttributes:{hidden:!0},observers:["paramsObjectChanged(paramsObject.*)"],paramsStringChanged:function(){this._dontReact=!0,this.paramsObject=this._decodeParams(this.paramsString),this._dontReact=!1},paramsObjectChanged:function(){this._dontReact||(this.paramsString=this._encodeParams(this.paramsObject).replace(/%3F/g,"?").replace(/%2F/g,"/"))},_encodeParams:function(e){var t=[];for(var i in e){var n=e[i];""===n?t.push(encodeURIComponent(i)):n&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(n.toString()))}return t.join("&")},_decodeParams:function(e){var t={};e=(e||"").replace(/\+/g,"%20");for(var i=e.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");r[0]&&(t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||""))}return t}}),function(){"use strict";Polymer.AppRouteConverterBehavior={properties:{route:{type:Object,notify:!0},queryParams:{type:Object,notify:!0},path:{type:String,notify:!0}},observers:["_locationChanged(path, queryParams)","_routeChanged(route.prefix, route.path)","_routeQueryParamsChanged(route.__queryParams)"],created:function(){this.linkPaths("route.__queryParams","queryParams"),this.linkPaths("queryParams","route.__queryParams")},_locationChanged:function(){this.route&&this.route.path===this.path&&this.queryParams===this.route.__queryParams||(this.route={prefix:"",path:this.path,__queryParams:this.queryParams})},_routeChanged:function(){this.route&&(this.path=this.route.prefix+this.route.path)},_routeQueryParamsChanged:function(e){this.route&&(this.queryParams=e)}}}(),function(){"use strict";Polymer({is:"app-location",properties:{route:{type:Object,notify:!0},useHashAsPath:{type:Boolean,value:!1},urlSpaceRegex:{type:String,notify:!0},__queryParams:{type:Object},__path:{type:String},__query:{type:String},__hash:{type:String},path:{type:String,observer:"__onPathChanged"}},behaviors:[Polymer.AppRouteConverterBehavior],observers:["__computeRoutePath(useHashAsPath, __hash, __path)"],__computeRoutePath:function(){this.path=this.useHashAsPath?this.__hash:this.__path},__onPathChanged:function(){this._readied&&(this.useHashAsPath?this.__hash=this.path:this.__path=this.path)}})}(),function(){var e={},t={},i=null;Polymer.IronMeta=Polymer({is:"iron-meta",properties:{type:{type:String,value:"default",observer:"_typeChanged"},key:{type:String,observer:"_keyChanged"},value:{type:Object,notify:!0,observer:"_valueChanged"},self:{type:Boolean,observer:"_selfChanged"},list:{type:Array,notify:!0}},hostAttributes:{hidden:!0},factoryImpl:function(e){if(e)for(var t in e)switch(t){case"type":case"key":case"value":this[t]=e[t]}},created:function(){this._metaDatas=e,this._metaArrays=t},_keyChanged:function(e,t){this._resetRegistration(t)},_valueChanged:function(e){this._resetRegistration(this.key)},_selfChanged:function(e){e&&(this.value=this)},_typeChanged:function(i){this._unregisterKey(this.key),e[i]||(e[i]={}),this._metaData=e[i],t[i]||(t[i]=[]),this.list=t[i],this._registerKeyValue(this.key,this.value)},byKey:function(e){return this._metaData&&this._metaData[e]},_resetRegistration:function(e){this._unregisterKey(e),this._registerKeyValue(this.key,this.value)},_unregisterKey:function(e){this._unregister(e,this._metaData,this.list)},_registerKeyValue:function(e,t){this._register(e,t,this._metaData,this.list)},_register:function(e,t,i,n){e&&i&&void 0!==t&&(i[e]=t,n.push(t))},_unregister:function(e,t,i){if(e&&t&&e in t){var n=t[e];delete t[e],this.arrayDelete(i,n)}}}),Polymer.IronMeta.getIronMeta=function(){return null===i&&(i=new Polymer.IronMeta),i},Polymer.IronMetaQuery=Polymer({is:"iron-meta-query",properties:{type:{type:String,value:"default",observer:"_typeChanged"},key:{type:String,observer:"_keyChanged"},value:{type:Object,notify:!0,readOnly:!0},list:{type:Array,notify:!0}},factoryImpl:function(e){if(e)for(var t in e)switch(t){case"type":case"key":this[t]=e[t]}},created:function(){
this._metaDatas=e,this._metaArrays=t},_keyChanged:function(e){this._setValue(this._metaData&&this._metaData[e])},_typeChanged:function(i){this._metaData=e[i],this.list=t[i],this.key&&this._keyChanged(this.key)},byKey:function(e){return this._metaData&&this._metaData[e]}})}(),Polymer({is:"iron-icon",properties:{icon:{type:String},theme:{type:String},src:{type:String},_meta:{value:Polymer.Base.create("iron-meta",{type:"iconset"})}},observers:["_updateIcon(_meta, isAttached)","_updateIcon(theme, isAttached)","_srcChanged(src, isAttached)","_iconChanged(icon, isAttached)"],_DEFAULT_ICONSET:"icons",_iconChanged:function(e){var t=(e||"").split(":");this._iconName=t.pop(),this._iconsetName=t.pop()||this._DEFAULT_ICONSET,this._updateIcon()},_srcChanged:function(e){this._updateIcon()},_usesIconset:function(){return this.icon||!this.src},_updateIcon:function(){this._usesIconset()?(this._img&&this._img.parentNode&&Polymer.dom(this.root).removeChild(this._img),""===this._iconName?this._iconset&&this._iconset.removeIcon(this):this._iconsetName&&this._meta&&(this._iconset=this._meta.byKey(this._iconsetName),this._iconset?(this._iconset.applyIcon(this,this._iconName,this.theme),this.unlisten(window,"iron-iconset-added","_updateIcon")):this.listen(window,"iron-iconset-added","_updateIcon"))):(this._iconset&&this._iconset.removeIcon(this),this._img||(this._img=document.createElement("img"),this._img.style.width="100%",this._img.style.height="100%",this._img.draggable=!1),this._img.src=this.src,Polymer.dom(this.root).appendChild(this._img))}}),Polymer({is:"iron-iconset-svg",properties:{name:{type:String,observer:"_nameChanged"},size:{type:Number,value:24},rtlMirroring:{type:Boolean,value:!1}},attached:function(){this.style.display="none"},getIconNames:function(){return this._icons=this._createIconMap(),Object.keys(this._icons).map(function(e){return this.name+":"+e},this)},applyIcon:function(e,t){e=e.root||e,this.removeIcon(e);var i=this._cloneIcon(t,this.rtlMirroring&&this._targetIsRTL(e));if(i){var n=Polymer.dom(e);return n.insertBefore(i,n.childNodes[0]),e._svgIcon=i}return null},removeIcon:function(e){e=e.root||e,e._svgIcon&&(Polymer.dom(e).removeChild(e._svgIcon),e._svgIcon=null)},_targetIsRTL:function(e){return null==this.__targetIsRTL&&(e&&e.nodeType!==Node.ELEMENT_NODE&&(e=e.host),this.__targetIsRTL=e&&"rtl"===window.getComputedStyle(e).direction),this.__targetIsRTL},_nameChanged:function(){new Polymer.IronMeta({type:"iconset",key:this.name,value:this}),this.async(function(){this.fire("iron-iconset-added",this,{node:window})})},_createIconMap:function(){var e=Object.create(null);return Polymer.dom(this).querySelectorAll("[id]").forEach(function(t){e[t.id]=t}),e},_cloneIcon:function(e,t){return this._icons=this._icons||this._createIconMap(),this._prepareSvgClone(this._icons[e],this.size,t)},_prepareSvgClone:function(e,t,i){if(e){var n=e.cloneNode(!0),r=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=n.getAttribute("viewBox")||"0 0 "+t+" "+t,s="pointer-events: none; display: block; width: 100%; height: 100%;";return i&&n.hasAttribute("mirror-in-rtl")&&(s+="-webkit-transform:scale(-1,1);transform:scale(-1,1);"),r.setAttribute("viewBox",o),r.setAttribute("preserveAspectRatio","xMidYMid meet"),r.style.cssText=s,r.appendChild(n).removeAttribute("id"),r}return null}}),Polymer.IronResizableBehavior={properties:{_parentResizable:{type:Object,observer:"_parentResizableChanged"},_notifyingDescendant:{type:Boolean,value:!1}},listeners:{"iron-request-resize-notifications":"_onIronRequestResizeNotifications"},created:function(){this._interestedResizables=[],this._boundNotifyResize=this.notifyResize.bind(this)},attached:function(){this.fire("iron-request-resize-notifications",null,{node:this,bubbles:!0,cancelable:!0}),this._parentResizable||(window.addEventListener("resize",this._boundNotifyResize),this.notifyResize())},detached:function(){this._parentResizable?this._parentResizable.stopResizeNotificationsFor(this):window.removeEventListener("resize",this._boundNotifyResize),this._parentResizable=null},notifyResize:function(){this.isAttached&&(this._interestedResizables.forEach(function(e){this.resizerShouldNotify(e)&&this._notifyDescendant(e)},this),this._fireResize())},assignParentResizable:function(e){this._parentResizable=e},stopResizeNotificationsFor:function(e){var t=this._interestedResizables.indexOf(e);t>-1&&(this._interestedResizables.splice(t,1),this.unlisten(e,"iron-resize","_onDescendantIronResize"))},resizerShouldNotify:function(e){return!0},_onDescendantIronResize:function(e){return this._notifyingDescendant?void e.stopPropagation():void(Polymer.Settings.useShadow||this._fireResize())},_fireResize:function(){this.fire("iron-resize",null,{node:this,bubbles:!1})},_onIronRequestResizeNotifications:function(e){var t=e.path?e.path[0]:e.target;t!==this&&(this._interestedResizables.indexOf(t)===-1&&(this._interestedResizables.push(t),this.listen(t,"iron-resize","_onDescendantIronResize")),t.assignParentResizable(this),this._notifyDescendant(t),e.stopPropagation())},_parentResizableChanged:function(e){e&&window.removeEventListener("resize",this._boundNotifyResize)},_notifyDescendant:function(e){this.isAttached&&(this._notifyingDescendant=!0,e.notifyResize(),this._notifyingDescendant=!1)}},Polymer.IronSelection=function(e){this.selection=[],this.selectCallback=e},Polymer.IronSelection.prototype={get:function(){return this.multi?this.selection.slice():this.selection[0]},clear:function(e){this.selection.slice().forEach(function(t){(!e||e.indexOf(t)<0)&&this.setItemSelected(t,!1)},this)},isSelected:function(e){return this.selection.indexOf(e)>=0},setItemSelected:function(e,t){if(null!=e&&t!==this.isSelected(e)){if(t)this.selection.push(e);else{var i=this.selection.indexOf(e);i>=0&&this.selection.splice(i,1)}this.selectCallback&&this.selectCallback(e,t)}},select:function(e){this.multi?this.toggle(e):this.get()!==e&&(this.setItemSelected(this.get(),!1),this.setItemSelected(e,!0))},toggle:function(e){this.setItemSelected(e,!this.isSelected(e))}},Polymer.IronSelectableBehavior={properties:{attrForSelected:{type:String,value:null},selected:{type:String,notify:!0},selectedItem:{type:Object,readOnly:!0,notify:!0},activateEvent:{type:String,value:"tap",observer:"_activateEventChanged"},selectable:String,selectedClass:{type:String,value:"iron-selected"},selectedAttribute:{type:String,value:null},fallbackSelection:{type:String,value:null},items:{type:Array,readOnly:!0,notify:!0,value:function(){return[]}},_excludedLocalNames:{type:Object,value:function(){return{template:1}}}},observers:["_updateAttrForSelected(attrForSelected)","_updateSelected(selected)","_checkFallback(fallbackSelection)"],created:function(){this._bindFilterItem=this._filterItem.bind(this),this._selection=new Polymer.IronSelection(this._applySelection.bind(this))},attached:function(){this._observer=this._observeItems(this),this._updateItems(),this._shouldUpdateSelection||this._updateSelected(),this._addListener(this.activateEvent)},detached:function(){this._observer&&Polymer.dom(this).unobserveNodes(this._observer),this._removeListener(this.activateEvent)},indexOf:function(e){return this.items.indexOf(e)},select:function(e){this.selected=e},selectPrevious:function(){var e=this.items.length,t=(Number(this._valueToIndex(this.selected))-1+e)%e;this.selected=this._indexToValue(t)},selectNext:function(){var e=(Number(this._valueToIndex(this.selected))+1)%this.items.length;this.selected=this._indexToValue(e)},selectIndex:function(e){this.select(this._indexToValue(e))},forceSynchronousItemUpdate:function(){this._updateItems()},get _shouldUpdateSelection(){return null!=this.selected},_checkFallback:function(){this._shouldUpdateSelection&&this._updateSelected()},_addListener:function(e){this.listen(this,e,"_activateHandler")},_removeListener:function(e){this.unlisten(this,e,"_activateHandler")},_activateEventChanged:function(e,t){this._removeListener(t),this._addListener(e)},_updateItems:function(){var e=Polymer.dom(this).queryDistributedElements(this.selectable||"*");e=Array.prototype.filter.call(e,this._bindFilterItem),this._setItems(e)},_updateAttrForSelected:function(){this._shouldUpdateSelection&&(this.selected=this._indexToValue(this.indexOf(this.selectedItem)))},_updateSelected:function(){this._selectSelected(this.selected)},_selectSelected:function(e){this._selection.select(this._valueToItem(this.selected)),this.fallbackSelection&&this.items.length&&void 0===this._selection.get()&&(this.selected=this.fallbackSelection)},_filterItem:function(e){return!this._excludedLocalNames[e.localName]},_valueToItem:function(e){return null==e?null:this.items[this._valueToIndex(e)]},_valueToIndex:function(e){if(!this.attrForSelected)return Number(e);for(var t,i=0;t=this.items[i];i++)if(this._valueForItem(t)==e)return i},_indexToValue:function(e){if(!this.attrForSelected)return e;var t=this.items[e];return t?this._valueForItem(t):void 0},_valueForItem:function(e){var t=e[Polymer.CaseMap.dashToCamelCase(this.attrForSelected)];return void 0!=t?t:e.getAttribute(this.attrForSelected)},_applySelection:function(e,t){this.selectedClass&&this.toggleClass(this.selectedClass,t,e),this.selectedAttribute&&this.toggleAttribute(this.selectedAttribute,t,e),this._selectionChange(),this.fire("iron-"+(t?"select":"deselect"),{item:e})},_selectionChange:function(){this._setSelectedItem(this._selection.get())},_observeItems:function(e){return Polymer.dom(e).observeNodes(function(e){this._updateItems(),this._shouldUpdateSelection&&this._updateSelected(),this.fire("iron-items-changed",e,{bubbles:!1,cancelable:!1})})},_activateHandler:function(e){for(var t=e.target,i=this.items;t&&t!=this;){var n=i.indexOf(t);if(n>=0){var r=this._indexToValue(n);return void this._itemActivate(r,t)}t=t.parentNode}},_itemActivate:function(e,t){this.fire("iron-activate",{selected:e,item:t},{cancelable:!0}).defaultPrevented||this.select(e)}},Polymer({is:"iron-pages",behaviors:[Polymer.IronResizableBehavior,Polymer.IronSelectableBehavior],properties:{activateEvent:{type:String,value:null}},observers:["_selectedPageChanged(selected)"],_selectedPageChanged:function(e,t){this.async(this.notifyResize)}}),Polymer({is:"iron-media-query",properties:{queryMatches:{type:Boolean,value:!1,readOnly:!0,notify:!0},query:{type:String,observer:"queryChanged"},full:{type:Boolean,value:!1},_boundMQHandler:{value:function(){return this.queryHandler.bind(this)}},_mq:{value:null}},attached:function(){this.style.display="none",this.queryChanged()},detached:function(){this._remove()},_add:function(){this._mq&&this._mq.addListener(this._boundMQHandler)},_remove:function(){this._mq&&this._mq.removeListener(this._boundMQHandler),this._mq=null},queryChanged:function(){this._remove();var e=this.query;e&&(this.full||"("===e[0]||(e="("+e+")"),this._mq=window.matchMedia(e),this._add(),this.queryHandler(this._mq))},queryHandler:function(e){this._setQueryMatches(e.matches)}}),Polymer.IronMultiSelectableBehaviorImpl={properties:{multi:{type:Boolean,value:!1,observer:"multiChanged"},selectedValues:{type:Array,notify:!0},selectedItems:{type:Array,readOnly:!0,notify:!0}},observers:["_updateSelected(selectedValues.splices)"],select:function(e){this.multi?this.selectedValues?this._toggleSelected(e):this.selectedValues=[e]:this.selected=e},multiChanged:function(e){this._selection.multi=e},get _shouldUpdateSelection(){return null!=this.selected||null!=this.selectedValues&&this.selectedValues.length},_updateAttrForSelected:function(){this.multi?this._shouldUpdateSelection&&(this.selectedValues=this.selectedItems.map(function(e){return this._indexToValue(this.indexOf(e))},this).filter(function(e){return null!=e},this)):Polymer.IronSelectableBehavior._updateAttrForSelected.apply(this)},_updateSelected:function(){this.multi?this._selectMulti(this.selectedValues):this._selectSelected(this.selected)},_selectMulti:function(e){if(e){var t=this._valuesToItems(e);this._selection.clear(t);for(var i=0;i<t.length;i++)this._selection.setItemSelected(t[i],!0);if(this.fallbackSelection&&this.items.length&&!this._selection.get().length){var n=this._valueToItem(this.fallbackSelection);n&&(this.selectedValues=[this.fallbackSelection])}}else this._selection.clear()},_selectionChange:function(){var e=this._selection.get();this.multi?this._setSelectedItems(e):(this._setSelectedItems([e]),this._setSelectedItem(e))},_toggleSelected:function(e){var t=this.selectedValues.indexOf(e),i=t<0;i?this.push("selectedValues",e):this.splice("selectedValues",t,1)},_valuesToItems:function(e){return null==e?null:e.map(function(e){return this._valueToItem(e)},this)}},Polymer.IronMultiSelectableBehavior=[Polymer.IronSelectableBehavior,Polymer.IronMultiSelectableBehaviorImpl],Polymer({is:"iron-selector",behaviors:[Polymer.IronMultiSelectableBehavior]}),function(){"use strict";function e(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&e[i]&&t.push(i);return t.join(" ")}var t=null;Polymer({is:"paper-drawer-panel",behaviors:[Polymer.IronResizableBehavior],properties:{defaultSelected:{type:String,value:"main"},disableEdgeSwipe:{type:Boolean,value:!1},disableSwipe:{type:Boolean,value:!1},dragging:{type:Boolean,value:!1,readOnly:!0,notify:!0},drawerWidth:{type:String,value:"256px"},edgeSwipeSensitivity:{type:Number,value:30},forceNarrow:{type:Boolean,value:!1},hasTransform:{type:Boolean,value:function(){return"transform"in this.style}},hasWillChange:{type:Boolean,value:function(){return"willChange"in this.style}},narrow:{reflectToAttribute:!0,type:Boolean,value:!1,readOnly:!0,notify:!0},peeking:{type:Boolean,value:!1,readOnly:!0,notify:!0},responsiveWidth:{type:String,value:"768px"},rightDrawer:{type:Boolean,value:!1},selected:{reflectToAttribute:!0,notify:!0,type:String,value:null},drawerToggleAttribute:{type:String,value:"paper-drawer-toggle"},drawerFocusSelector:{type:String,value:'a[href]:not([tabindex="-1"]),area[href]:not([tabindex="-1"]),input:not([disabled]):not([tabindex="-1"]),select:not([disabled]):not([tabindex="-1"]),textarea:not([disabled]):not([tabindex="-1"]),button:not([disabled]):not([tabindex="-1"]),iframe:not([tabindex="-1"]),[tabindex]:not([tabindex="-1"]),[contentEditable=true]:not([tabindex="-1"])'},_transition:{type:Boolean,value:!1}},listeners:{tap:"_onTap",track:"_onTrack",down:"_downHandler",up:"_upHandler",transitionend:"_onTransitionEnd"},observers:["_forceNarrowChanged(forceNarrow, defaultSelected)","_toggleFocusListener(selected)"],ready:function(){this._transition=!0,this._boundFocusListener=this._didFocus.bind(this)},togglePanel:function(){this._isMainSelected()?this.openDrawer():this.closeDrawer()},openDrawer:function(){this.selected="drawer"},closeDrawer:function(){this.selected="main"},_onTransitionEnd:function(e){var t=Polymer.dom(e).localTarget;if(t===this&&("left"!==e.propertyName&&"right"!==e.propertyName||this.notifyResize(),"transform"===e.propertyName&&"drawer"===this.selected)){var i=this._getAutoFocusedNode();i&&i.focus()}},_computeIronSelectorClass:function(t,i,n,r,o){return e({dragging:n,"narrow-layout":t,"right-drawer":r,"left-drawer":!r,transition:i,peeking:o})},_computeDrawerStyle:function(e){return"width:"+e+";"},_computeMainStyle:function(e,t,i){var n="";return n+="left:"+(e||t?"0":i)+";",t&&(n+="right:"+(e?"":i)+";"),n},_computeMediaQuery:function(e,t){return e?"":"(max-width: "+t+")"},_computeSwipeOverlayHidden:function(e,t){return!e||t},_onTrack:function(e){if(!t||this===t)switch(e.detail.state){case"start":this._trackStart(e);break;case"track":this._trackX(e);break;case"end":this._trackEnd(e)}},_responsiveChange:function(e){this._setNarrow(e),this.selected=this.narrow?this.defaultSelected:null,this.setScrollDirection(this._swipeAllowed()?"y":"all"),this.fire("paper-responsive-change",{narrow:this.narrow})},_onQueryMatchesChanged:function(e){this._responsiveChange(e.detail.value)},_forceNarrowChanged:function(){this._responsiveChange(this.forceNarrow||this.$.mq.queryMatches)},_swipeAllowed:function(){return this.narrow&&!this.disableSwipe},_isMainSelected:function(){return"main"===this.selected},_startEdgePeek:function(){this.width=this.$.drawer.offsetWidth,this._moveDrawer(this._translateXForDeltaX(this.rightDrawer?-this.edgeSwipeSensitivity:this.edgeSwipeSensitivity)),this._setPeeking(!0)},_stopEdgePeek:function(){this.peeking&&(this._setPeeking(!1),this._moveDrawer(null))},_downHandler:function(e){!this.dragging&&this._isMainSelected()&&this._isEdgeTouch(e)&&!t&&(this._startEdgePeek(),e.preventDefault(),t=this)},_upHandler:function(){this._stopEdgePeek(),t=null},_onTap:function(e){var t=Polymer.dom(e).localTarget,i=t&&this.drawerToggleAttribute&&t.hasAttribute(this.drawerToggleAttribute);i&&this.togglePanel()},_isEdgeTouch:function(e){var t=e.detail.x;return!this.disableEdgeSwipe&&this._swipeAllowed()&&(this.rightDrawer?t>=this.offsetWidth-this.edgeSwipeSensitivity:t<=this.edgeSwipeSensitivity)},_trackStart:function(e){this._swipeAllowed()&&(t=this,this._setDragging(!0),this._isMainSelected()&&this._setDragging(this.peeking||this._isEdgeTouch(e)),this.dragging&&(this.width=this.$.drawer.offsetWidth,this._transition=!1))},_translateXForDeltaX:function(e){var t=this._isMainSelected();return this.rightDrawer?Math.max(0,t?this.width+e:e):Math.min(0,t?e-this.width:e)},_trackX:function(e){if(this.dragging){var t=e.detail.dx;if(this.peeking){if(Math.abs(t)<=this.edgeSwipeSensitivity)return;this._setPeeking(!1)}this._moveDrawer(this._translateXForDeltaX(t))}},_trackEnd:function(e){if(this.dragging){var i=e.detail.dx>0;this._setDragging(!1),this._transition=!0,t=null,this._moveDrawer(null),this.rightDrawer?this[i?"closeDrawer":"openDrawer"]():this[i?"openDrawer":"closeDrawer"]()}},_transformForTranslateX:function(e){return null===e?"":this.hasWillChange?"translateX("+e+"px)":"translate3d("+e+"px, 0, 0)"},_moveDrawer:function(e){this.transform(this._transformForTranslateX(e),this.$.drawer)},_getDrawerContent:function(){return Polymer.dom(this.$.drawerContent).getDistributedNodes()[0]},_getAutoFocusedNode:function(){var e=this._getDrawerContent();return this.drawerFocusSelector?Polymer.dom(e).querySelector(this.drawerFocusSelector)||e:null},_toggleFocusListener:function(e){"drawer"===e?this.addEventListener("focus",this._boundFocusListener,!0):this.removeEventListener("focus",this._boundFocusListener,!0)},_didFocus:function(e){var t=this._getAutoFocusedNode();if(t){var i=Polymer.dom(e).path,n=(i[0],this._getDrawerContent()),r=i.indexOf(n)!==-1;r||(e.stopPropagation(),t.focus())}},_isDrawerClosed:function(e,t){return!e||"drawer"!==t}})}(),function(){"use strict";function e(e,t){var i="";if(e){var n=e.toLowerCase();" "===n||f.test(n)?i="space":p.test(n)?i="esc":1==n.length?t&&!c.test(n)||(i=n):i=d.test(n)?n.replace("arrow",""):"multiply"==n?"*":n}return i}function t(e){var t="";return e&&(e in a?t=a[e]:u.test(e)?(e=parseInt(e.replace("U+","0x"),16),t=String.fromCharCode(e).toLowerCase()):t=e.toLowerCase()),t}function i(e){var t="";return Number(e)&&(t=e>=65&&e<=90?String.fromCharCode(32+e):e>=112&&e<=123?"f"+(e-112):e>=48&&e<=57?String(e-48):e>=96&&e<=105?String(e-96):h[e]),t}function n(n,r){return n.key?e(n.key,r):n.detail&&n.detail.key?e(n.detail.key,r):t(n.keyIdentifier)||i(n.keyCode)||""}function r(e,t){var i=n(t,e.hasModifiers);return i===e.key&&(!e.hasModifiers||!!t.shiftKey==!!e.shiftKey&&!!t.ctrlKey==!!e.ctrlKey&&!!t.altKey==!!e.altKey&&!!t.metaKey==!!e.metaKey)}function o(e){return 1===e.length?{combo:e,key:e,event:"keydown"}:e.split("+").reduce(function(e,t){var i=t.split(":"),n=i[0],r=i[1];return n in l?(e[l[n]]=!0,e.hasModifiers=!0):(e.key=n,e.event=r||"keydown"),e},{combo:e.split(":").shift()})}function s(e){return e.trim().split(" ").map(function(e){return o(e)})}var a={"U+0008":"backspace","U+0009":"tab","U+001B":"esc","U+0020":"space","U+007F":"del"},h={8:"backspace",9:"tab",13:"enter",27:"esc",33:"pageup",34:"pagedown",35:"end",36:"home",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",106:"*"},l={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"},c=/[a-z0-9*]/,u=/U\+/,d=/^arrow/,f=/^space(bar)?/,p=/^escape$/;Polymer.IronA11yKeysBehavior={properties:{keyEventTarget:{type:Object,value:function(){return this}},stopKeyboardEventPropagation:{type:Boolean,value:!1},_boundKeyHandlers:{type:Array,value:function(){return[]}},_imperativeKeyBindings:{type:Object,value:function(){return{}}}},observers:["_resetKeyEventListeners(keyEventTarget, _boundKeyHandlers)"],keyBindings:{},registered:function(){this._prepKeyBindings()},attached:function(){this._listenKeyEventListeners()},detached:function(){this._unlistenKeyEventListeners()},addOwnKeyBinding:function(e,t){this._imperativeKeyBindings[e]=t,this._prepKeyBindings(),this._resetKeyEventListeners()},removeOwnKeyBindings:function(){this._imperativeKeyBindings={},this._prepKeyBindings(),this._resetKeyEventListeners()},keyboardEventMatchesKeys:function(e,t){for(var i=s(t),n=0;n<i.length;++n)if(r(i[n],e))return!0;return!1},_collectKeyBindings:function(){var e=this.behaviors.map(function(e){return e.keyBindings});return e.indexOf(this.keyBindings)===-1&&e.push(this.keyBindings),e},_prepKeyBindings:function(){this._keyBindings={},this._collectKeyBindings().forEach(function(e){for(var t in e)this._addKeyBinding(t,e[t])},this);for(var e in this._imperativeKeyBindings)this._addKeyBinding(e,this._imperativeKeyBindings[e]);for(var t in this._keyBindings)this._keyBindings[t].sort(function(e,t){var i=e[0].hasModifiers,n=t[0].hasModifiers;return i===n?0:i?-1:1})},_addKeyBinding:function(e,t){s(e).forEach(function(e){this._keyBindings[e.event]=this._keyBindings[e.event]||[],this._keyBindings[e.event].push([e,t])},this)},_resetKeyEventListeners:function(){this._unlistenKeyEventListeners(),this.isAttached&&this._listenKeyEventListeners()},_listenKeyEventListeners:function(){this.keyEventTarget&&Object.keys(this._keyBindings).forEach(function(e){var t=this._keyBindings[e],i=this._onKeyBindingEvent.bind(this,t);this._boundKeyHandlers.push([this.keyEventTarget,e,i]),this.keyEventTarget.addEventListener(e,i)},this)},_unlistenKeyEventListeners:function(){for(var e,t,i,n;this._boundKeyHandlers.length;)e=this._boundKeyHandlers.pop(),t=e[0],i=e[1],n=e[2],t.removeEventListener(i,n)},_onKeyBindingEvent:function(e,t){if(this.stopKeyboardEventPropagation&&t.stopPropagation(),!t.defaultPrevented)for(var i=0;i<e.length;i++){var n=e[i][0],o=e[i][1];if(r(n,t)&&(this._triggerKeyHandler(n,o,t),t.defaultPrevented))return}},_triggerKeyHandler:function(e,t,i){var n=Object.create(e);n.keyboardEvent=i;var r=new CustomEvent(e.event,{detail:n,cancelable:!0});this[t].call(this,r),r.defaultPrevented&&i.preventDefault()}}}(),Polymer.IronControlState={properties:{focused:{type:Boolean,value:!1,notify:!0,readOnly:!0,reflectToAttribute:!0},disabled:{type:Boolean,value:!1,notify:!0,observer:"_disabledChanged",reflectToAttribute:!0},_oldTabIndex:{type:Number},_boundFocusBlurHandler:{type:Function,value:function(){return this._focusBlurHandler.bind(this)}}},observers:["_changedControlState(focused, disabled)"],ready:function(){this.addEventListener("focus",this._boundFocusBlurHandler,!0),this.addEventListener("blur",this._boundFocusBlurHandler,!0)},_focusBlurHandler:function(e){if(e.target===this)this._setFocused("focus"===e.type);else if(!this.shadowRoot){var t=Polymer.dom(e).localTarget;this.isLightDescendant(t)||this.fire(e.type,{sourceEvent:e},{node:this,bubbles:e.bubbles,cancelable:e.cancelable})}},_disabledChanged:function(e,t){this.setAttribute("aria-disabled",e?"true":"false"),this.style.pointerEvents=e?"none":"",e?(this._oldTabIndex=this.tabIndex,this._setFocused(!1),this.tabIndex=-1,this.blur()):void 0!==this._oldTabIndex&&(this.tabIndex=this._oldTabIndex)},_changedControlState:function(){this._controlStateChanged&&this._controlStateChanged()}},Polymer.IronButtonStateImpl={properties:{pressed:{type:Boolean,readOnly:!0,value:!1,reflectToAttribute:!0,observer:"_pressedChanged"},toggles:{type:Boolean,value:!1,reflectToAttribute:!0},active:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0},pointerDown:{type:Boolean,readOnly:!0,value:!1},receivedFocusFromKeyboard:{type:Boolean,readOnly:!0},ariaActiveAttribute:{type:String,value:"aria-pressed",observer:"_ariaActiveAttributeChanged"}},listeners:{down:"_downHandler",up:"_upHandler",tap:"_tapHandler"},observers:["_detectKeyboardFocus(focused)","_activeChanged(active, ariaActiveAttribute)"],keyBindings:{"enter:keydown":"_asyncClick","space:keydown":"_spaceKeyDownHandler","space:keyup":"_spaceKeyUpHandler"},_mouseEventRe:/^mouse/,_tapHandler:function(){this.toggles?this._userActivate(!this.active):this.active=!1},_detectKeyboardFocus:function(e){this._setReceivedFocusFromKeyboard(!this.pointerDown&&e)},_userActivate:function(e){this.active!==e&&(this.active=e,this.fire("change"))},_downHandler:function(e){this._setPointerDown(!0),this._setPressed(!0),this._setReceivedFocusFromKeyboard(!1)},_upHandler:function(){this._setPointerDown(!1),this._setPressed(!1)},_spaceKeyDownHandler:function(e){var t=e.detail.keyboardEvent,i=Polymer.dom(t).localTarget;this.isLightDescendant(i)||(t.preventDefault(),t.stopImmediatePropagation(),this._setPressed(!0))},_spaceKeyUpHandler:function(e){var t=e.detail.keyboardEvent,i=Polymer.dom(t).localTarget;this.isLightDescendant(i)||(this.pressed&&this._asyncClick(),this._setPressed(!1))},_asyncClick:function(){this.async(function(){this.click()},1)},_pressedChanged:function(e){this._changedButtonState()},_ariaActiveAttributeChanged:function(e,t){t&&t!=e&&this.hasAttribute(t)&&this.removeAttribute(t)},_activeChanged:function(e,t){this.toggles?this.setAttribute(this.ariaActiveAttribute,e?"true":"false"):this.removeAttribute(this.ariaActiveAttribute),this._changedButtonState()},_controlStateChanged:function(){this.disabled?this._setPressed(!1):this._changedButtonState()},_changedButtonState:function(){this._buttonStateChanged&&this._buttonStateChanged()}},Polymer.IronButtonState=[Polymer.IronA11yKeysBehavior,Polymer.IronButtonStateImpl],function(){function e(e){this.element=e,this.width=this.boundingRect.width,this.height=this.boundingRect.height,this.size=Math.max(this.width,this.height)}function t(e){this.element=e,this.color=window.getComputedStyle(e).color,this.wave=document.createElement("div"),this.waveContainer=document.createElement("div"),this.wave.style.backgroundColor=this.color,this.wave.classList.add("wave"),this.waveContainer.classList.add("wave-container"),Polymer.dom(this.waveContainer).appendChild(this.wave),this.resetInteractionState()}var i={distance:function(e,t,i,n){var r=e-i,o=t-n;return Math.sqrt(r*r+o*o)},now:window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now};e.prototype={get boundingRect(){return this.element.getBoundingClientRect()},furthestCornerDistanceFrom:function(e,t){var n=i.distance(e,t,0,0),r=i.distance(e,t,this.width,0),o=i.distance(e,t,0,this.height),s=i.distance(e,t,this.width,this.height);return Math.max(n,r,o,s)}},t.MAX_RADIUS=300,t.prototype={get recenters(){return this.element.recenters},get center(){return this.element.center},get mouseDownElapsed(){var e;return this.mouseDownStart?(e=i.now()-this.mouseDownStart,this.mouseUpStart&&(e-=this.mouseUpElapsed),e):0},get mouseUpElapsed(){return this.mouseUpStart?i.now()-this.mouseUpStart:0},get mouseDownElapsedSeconds(){return this.mouseDownElapsed/1e3},get mouseUpElapsedSeconds(){return this.mouseUpElapsed/1e3},get mouseInteractionSeconds(){return this.mouseDownElapsedSeconds+this.mouseUpElapsedSeconds},get initialOpacity(){return this.element.initialOpacity},get opacityDecayVelocity(){return this.element.opacityDecayVelocity},get radius(){var e=this.containerMetrics.width*this.containerMetrics.width,i=this.containerMetrics.height*this.containerMetrics.height,n=1.1*Math.min(Math.sqrt(e+i),t.MAX_RADIUS)+5,r=1.1-.2*(n/t.MAX_RADIUS),o=this.mouseInteractionSeconds/r,s=n*(1-Math.pow(80,-o));return Math.abs(s)},get opacity(){return this.mouseUpStart?Math.max(0,this.initialOpacity-this.mouseUpElapsedSeconds*this.opacityDecayVelocity):this.initialOpacity},get outerOpacity(){var e=.3*this.mouseUpElapsedSeconds,t=this.opacity;return Math.max(0,Math.min(e,t))},get isOpacityFullyDecayed(){return this.opacity<.01&&this.radius>=Math.min(this.maxRadius,t.MAX_RADIUS)},get isRestingAtMaxRadius(){return this.opacity>=this.initialOpacity&&this.radius>=Math.min(this.maxRadius,t.MAX_RADIUS)},get isAnimationComplete(){return this.mouseUpStart?this.isOpacityFullyDecayed:this.isRestingAtMaxRadius},get translationFraction(){return Math.min(1,this.radius/this.containerMetrics.size*2/Math.sqrt(2))},get xNow(){return this.xEnd?this.xStart+this.translationFraction*(this.xEnd-this.xStart):this.xStart},get yNow(){return this.yEnd?this.yStart+this.translationFraction*(this.yEnd-this.yStart):this.yStart},get isMouseDown(){return this.mouseDownStart&&!this.mouseUpStart},resetInteractionState:function(){this.maxRadius=0,this.mouseDownStart=0,this.mouseUpStart=0,this.xStart=0,this.yStart=0,this.xEnd=0,this.yEnd=0,this.slideDistance=0,this.containerMetrics=new e(this.element)},draw:function(){var e,t,i;this.wave.style.opacity=this.opacity,e=this.radius/(this.containerMetrics.size/2),t=this.xNow-this.containerMetrics.width/2,i=this.yNow-this.containerMetrics.height/2,this.waveContainer.style.webkitTransform="translate("+t+"px, "+i+"px)",this.waveContainer.style.transform="translate3d("+t+"px, "+i+"px, 0)",this.wave.style.webkitTransform="scale("+e+","+e+")",this.wave.style.transform="scale3d("+e+","+e+",1)"},downAction:function(e){var t=this.containerMetrics.width/2,n=this.containerMetrics.height/2;this.resetInteractionState(),this.mouseDownStart=i.now(),this.center?(this.xStart=t,this.yStart=n,this.slideDistance=i.distance(this.xStart,this.yStart,this.xEnd,this.yEnd)):(this.xStart=e?e.detail.x-this.containerMetrics.boundingRect.left:this.containerMetrics.width/2,this.yStart=e?e.detail.y-this.containerMetrics.boundingRect.top:this.containerMetrics.height/2),this.recenters&&(this.xEnd=t,this.yEnd=n,this.slideDistance=i.distance(this.xStart,this.yStart,this.xEnd,this.yEnd)),this.maxRadius=this.containerMetrics.furthestCornerDistanceFrom(this.xStart,this.yStart),this.waveContainer.style.top=(this.containerMetrics.height-this.containerMetrics.size)/2+"px",this.waveContainer.style.left=(this.containerMetrics.width-this.containerMetrics.size)/2+"px",this.waveContainer.style.width=this.containerMetrics.size+"px",this.waveContainer.style.height=this.containerMetrics.size+"px"},upAction:function(e){this.isMouseDown&&(this.mouseUpStart=i.now())},remove:function(){Polymer.dom(this.waveContainer.parentNode).removeChild(this.waveContainer)}},Polymer({is:"paper-ripple",behaviors:[Polymer.IronA11yKeysBehavior],properties:{initialOpacity:{type:Number,value:.25},opacityDecayVelocity:{type:Number,value:.8},recenters:{type:Boolean,value:!1},center:{type:Boolean,value:!1},ripples:{type:Array,value:function(){return[]}},animating:{type:Boolean,readOnly:!0,reflectToAttribute:!0,value:!1},holdDown:{type:Boolean,value:!1,observer:"_holdDownChanged"},noink:{type:Boolean,value:!1},_animating:{type:Boolean},_boundAnimate:{type:Function,value:function(){return this.animate.bind(this)}}},get target(){return this.keyEventTarget},keyBindings:{"enter:keydown":"_onEnterKeydown","space:keydown":"_onSpaceKeydown","space:keyup":"_onSpaceKeyup"},attached:function(){11==this.parentNode.nodeType?this.keyEventTarget=Polymer.dom(this).getOwnerRoot().host:this.keyEventTarget=this.parentNode;var e=this.keyEventTarget;this.listen(e,"up","uiUpAction"),this.listen(e,"down","uiDownAction")},detached:function(){this.unlisten(this.keyEventTarget,"up","uiUpAction"),this.unlisten(this.keyEventTarget,"down","uiDownAction"),this.keyEventTarget=null},get shouldKeepAnimating(){for(var e=0;e<this.ripples.length;++e)if(!this.ripples[e].isAnimationComplete)return!0;return!1},simulatedRipple:function(){this.downAction(null),this.async(function(){this.upAction()},1)},uiDownAction:function(e){this.noink||this.downAction(e);
},downAction:function(e){if(!(this.holdDown&&this.ripples.length>0)){var t=this.addRipple();t.downAction(e),this._animating||(this._animating=!0,this.animate())}},uiUpAction:function(e){this.noink||this.upAction(e)},upAction:function(e){this.holdDown||(this.ripples.forEach(function(t){t.upAction(e)}),this._animating=!0,this.animate())},onAnimationComplete:function(){this._animating=!1,this.$.background.style.backgroundColor=null,this.fire("transitionend")},addRipple:function(){var e=new t(this);return Polymer.dom(this.$.waves).appendChild(e.waveContainer),this.$.background.style.backgroundColor=e.color,this.ripples.push(e),this._setAnimating(!0),e},removeRipple:function(e){var t=this.ripples.indexOf(e);t<0||(this.ripples.splice(t,1),e.remove(),this.ripples.length||this._setAnimating(!1))},animate:function(){if(this._animating){var e,t;for(e=0;e<this.ripples.length;++e)t=this.ripples[e],t.draw(),this.$.background.style.opacity=t.outerOpacity,t.isOpacityFullyDecayed&&!t.isRestingAtMaxRadius&&this.removeRipple(t);this.shouldKeepAnimating||0!==this.ripples.length?window.requestAnimationFrame(this._boundAnimate):this.onAnimationComplete()}},_onEnterKeydown:function(){this.uiDownAction(),this.async(this.uiUpAction,1)},_onSpaceKeydown:function(){this.uiDownAction()},_onSpaceKeyup:function(){this.uiUpAction()},_holdDownChanged:function(e,t){void 0!==t&&(e?this.downAction():this.upAction())}})}(),Polymer.PaperRippleBehavior={properties:{noink:{type:Boolean,observer:"_noinkChanged"},_rippleContainer:{type:Object}},_buttonStateChanged:function(){this.focused&&this.ensureRipple()},_downHandler:function(e){Polymer.IronButtonStateImpl._downHandler.call(this,e),this.pressed&&this.ensureRipple(e)},ensureRipple:function(e){if(!this.hasRipple()){this._ripple=this._createRipple(),this._ripple.noink=this.noink;var t=this._rippleContainer||this.root;if(t&&Polymer.dom(t).appendChild(this._ripple),e){var i=Polymer.dom(this._rippleContainer||this),n=Polymer.dom(e).rootTarget;i.deepContains(n)&&this._ripple.uiDownAction(e)}}},getRipple:function(){return this.ensureRipple(),this._ripple},hasRipple:function(){return Boolean(this._ripple)},_createRipple:function(){return document.createElement("paper-ripple")},_noinkChanged:function(e){this.hasRipple()&&(this._ripple.noink=e)}},Polymer.PaperInkyFocusBehaviorImpl={observers:["_focusedChanged(receivedFocusFromKeyboard)"],_focusedChanged:function(e){e&&this.ensureRipple(),this.hasRipple()&&(this._ripple.holdDown=e)},_createRipple:function(){var e=Polymer.PaperRippleBehavior._createRipple();return e.id="ink",e.setAttribute("center",""),e.classList.add("circle"),e}},Polymer.PaperInkyFocusBehavior=[Polymer.IronButtonState,Polymer.IronControlState,Polymer.PaperRippleBehavior,Polymer.PaperInkyFocusBehaviorImpl],Polymer({is:"paper-icon-button",hostAttributes:{role:"button",tabindex:"0"},behaviors:[Polymer.PaperInkyFocusBehavior],properties:{src:{type:String},icon:{type:String},alt:{type:String,observer:"_altChanged"}},_altChanged:function(e,t){var i=this.getAttribute("aria-label");i&&t!=i||this.setAttribute("aria-label",e)}}),Polymer({is:"paper-tab",behaviors:[Polymer.IronControlState,Polymer.IronButtonState,Polymer.PaperRippleBehavior],properties:{link:{type:Boolean,value:!1,reflectToAttribute:!0}},hostAttributes:{role:"tab"},listeners:{down:"_updateNoink",tap:"_onTap"},attached:function(){this._updateNoink()},get _parentNoink(){var e=Polymer.dom(this).parentNode;return!!e&&!!e.noink},_updateNoink:function(){this.noink=!!this.noink||!!this._parentNoink},_onTap:function(e){if(this.link){var t=this.queryEffectiveChildren("a");if(!t)return;if(e.target===t)return;t.click()}}}),Polymer.IronMenuBehaviorImpl={properties:{focusedItem:{observer:"_focusedItemChanged",readOnly:!0,type:Object},attrForItemTitle:{type:String}},_SEARCH_RESET_TIMEOUT_MS:1e3,hostAttributes:{role:"menu",tabindex:"0"},observers:["_updateMultiselectable(multi)"],listeners:{focus:"_onFocus",keydown:"_onKeydown","iron-items-changed":"_onIronItemsChanged"},keyBindings:{up:"_onUpKey",down:"_onDownKey",esc:"_onEscKey","shift+tab:keydown":"_onShiftTabDown"},attached:function(){this._resetTabindices()},select:function(e){this._defaultFocusAsync&&(this.cancelAsync(this._defaultFocusAsync),this._defaultFocusAsync=null);var t=this._valueToItem(e);t&&t.hasAttribute("disabled")||(this._setFocusedItem(t),Polymer.IronMultiSelectableBehaviorImpl.select.apply(this,arguments))},_resetTabindices:function(){var e=this.multi?this.selectedItems&&this.selectedItems[0]:this.selectedItem;this.items.forEach(function(t){t.setAttribute("tabindex",t===e?"0":"-1")},this)},_updateMultiselectable:function(e){e?this.setAttribute("aria-multiselectable","true"):this.removeAttribute("aria-multiselectable")},_focusWithKeyboardEvent:function(e){this.cancelDebouncer("_clearSearchText");var t=this._searchText||"",i=e.key&&1==e.key.length?e.key:String.fromCharCode(e.keyCode);t+=i.toLocaleLowerCase();for(var n,r=t.length,o=0;n=this.items[o];o++)if(!n.hasAttribute("disabled")){var s=this.attrForItemTitle||"textContent",a=(n[s]||n.getAttribute(s)||"").trim();if(!(a.length<r)&&a.slice(0,r).toLocaleLowerCase()==t){this._setFocusedItem(n);break}}this._searchText=t,this.debounce("_clearSearchText",this._clearSearchText,this._SEARCH_RESET_TIMEOUT_MS)},_clearSearchText:function(){this._searchText=""},_focusPrevious:function(){for(var e=this.items.length,t=Number(this.indexOf(this.focusedItem)),i=1;i<e+1;i++){var n=this.items[(t-i+e)%e];if(!n.hasAttribute("disabled")){var r=Polymer.dom(n).getOwnerRoot()||document;if(this._setFocusedItem(n),Polymer.dom(r).activeElement==n)return}}},_focusNext:function(){for(var e=this.items.length,t=Number(this.indexOf(this.focusedItem)),i=1;i<e+1;i++){var n=this.items[(t+i)%e];if(!n.hasAttribute("disabled")){var r=Polymer.dom(n).getOwnerRoot()||document;if(this._setFocusedItem(n),Polymer.dom(r).activeElement==n)return}}},_applySelection:function(e,t){t?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected"),Polymer.IronSelectableBehavior._applySelection.apply(this,arguments)},_focusedItemChanged:function(e,t){t&&t.setAttribute("tabindex","-1"),e&&(e.setAttribute("tabindex","0"),e.focus())},_onIronItemsChanged:function(e){e.detail.addedNodes.length&&this._resetTabindices()},_onShiftTabDown:function(e){var t=this.getAttribute("tabindex");Polymer.IronMenuBehaviorImpl._shiftTabPressed=!0,this._setFocusedItem(null),this.setAttribute("tabindex","-1"),this.async(function(){this.setAttribute("tabindex",t),Polymer.IronMenuBehaviorImpl._shiftTabPressed=!1},1)},_onFocus:function(e){if(!Polymer.IronMenuBehaviorImpl._shiftTabPressed){var t=Polymer.dom(e).rootTarget;(t===this||"undefined"==typeof t.tabIndex||this.isLightDescendant(t))&&(this._defaultFocusAsync=this.async(function(){var e=this.multi?this.selectedItems&&this.selectedItems[0]:this.selectedItem;this._setFocusedItem(null),e?this._setFocusedItem(e):this.items[0]&&this._focusNext()}))}},_onUpKey:function(e){this._focusPrevious(),e.detail.keyboardEvent.preventDefault()},_onDownKey:function(e){this._focusNext(),e.detail.keyboardEvent.preventDefault()},_onEscKey:function(e){this.focusedItem.blur()},_onKeydown:function(e){this.keyboardEventMatchesKeys(e,"up down esc")||this._focusWithKeyboardEvent(e),e.stopPropagation()},_activateHandler:function(e){Polymer.IronSelectableBehavior._activateHandler.call(this,e),e.stopPropagation()}},Polymer.IronMenuBehaviorImpl._shiftTabPressed=!1,Polymer.IronMenuBehavior=[Polymer.IronMultiSelectableBehavior,Polymer.IronA11yKeysBehavior,Polymer.IronMenuBehaviorImpl],Polymer.IronMenubarBehaviorImpl={hostAttributes:{role:"menubar"},keyBindings:{left:"_onLeftKey",right:"_onRightKey"},_onUpKey:function(e){this.focusedItem.click(),e.detail.keyboardEvent.preventDefault()},_onDownKey:function(e){this.focusedItem.click(),e.detail.keyboardEvent.preventDefault()},get _isRTL(){return"rtl"===window.getComputedStyle(this).direction},_onLeftKey:function(e){this._isRTL?this._focusNext():this._focusPrevious(),e.detail.keyboardEvent.preventDefault()},_onRightKey:function(e){this._isRTL?this._focusPrevious():this._focusNext(),e.detail.keyboardEvent.preventDefault()},_onKeydown:function(e){this.keyboardEventMatchesKeys(e,"up down left right esc")||this._focusWithKeyboardEvent(e)}},Polymer.IronMenubarBehavior=[Polymer.IronMenuBehavior,Polymer.IronMenubarBehaviorImpl],Polymer({is:"paper-tabs",behaviors:[Polymer.IronResizableBehavior,Polymer.IronMenubarBehavior],properties:{noink:{type:Boolean,value:!1,observer:"_noinkChanged"},noBar:{type:Boolean,value:!1},noSlide:{type:Boolean,value:!1},scrollable:{type:Boolean,value:!1},fitContainer:{type:Boolean,value:!1},disableDrag:{type:Boolean,value:!1},hideScrollButtons:{type:Boolean,value:!1},alignBottom:{type:Boolean,value:!1},selectable:{type:String,value:"paper-tab"},autoselect:{type:Boolean,value:!1},autoselectDelay:{type:Number,value:0},_step:{type:Number,value:10},_holdDelay:{type:Number,value:1},_leftHidden:{type:Boolean,value:!1},_rightHidden:{type:Boolean,value:!1},_previousTab:{type:Object}},hostAttributes:{role:"tablist"},listeners:{"iron-resize":"_onTabSizingChanged","iron-items-changed":"_onTabSizingChanged","iron-select":"_onIronSelect","iron-deselect":"_onIronDeselect"},keyBindings:{"left:keyup right:keyup":"_onArrowKeyup"},created:function(){this._holdJob=null,this._pendingActivationItem=void 0,this._pendingActivationTimeout=void 0,this._bindDelayedActivationHandler=this._delayedActivationHandler.bind(this),this.addEventListener("blur",this._onBlurCapture.bind(this),!0)},ready:function(){this.setScrollDirection("y",this.$.tabsContainer)},detached:function(){this._cancelPendingActivation()},_noinkChanged:function(e){var t=Polymer.dom(this).querySelectorAll("paper-tab");t.forEach(e?this._setNoinkAttribute:this._removeNoinkAttribute)},_setNoinkAttribute:function(e){e.setAttribute("noink","")},_removeNoinkAttribute:function(e){e.removeAttribute("noink")},_computeScrollButtonClass:function(e,t,i){return!t||i?"hidden":e?"not-visible":""},_computeTabsContentClass:function(e,t){return e?"scrollable"+(t?" fit-container":""):" fit-container"},_computeSelectionBarClass:function(e,t){return e?"hidden":t?"align-bottom":""},_onTabSizingChanged:function(){this.debounce("_onTabSizingChanged",function(){this._scroll(),this._tabChanged(this.selectedItem)},10)},_onIronSelect:function(e){this._tabChanged(e.detail.item,this._previousTab),this._previousTab=e.detail.item,this.cancelDebouncer("tab-changed")},_onIronDeselect:function(e){this.debounce("tab-changed",function(){this._tabChanged(null,this._previousTab),this._previousTab=null},1)},_activateHandler:function(){this._cancelPendingActivation(),Polymer.IronMenuBehaviorImpl._activateHandler.apply(this,arguments)},_scheduleActivation:function(e,t){this._pendingActivationItem=e,this._pendingActivationTimeout=this.async(this._bindDelayedActivationHandler,t)},_delayedActivationHandler:function(){var e=this._pendingActivationItem;this._pendingActivationItem=void 0,this._pendingActivationTimeout=void 0,e.fire(this.activateEvent,null,{bubbles:!0,cancelable:!0})},_cancelPendingActivation:function(){void 0!==this._pendingActivationTimeout&&(this.cancelAsync(this._pendingActivationTimeout),this._pendingActivationItem=void 0,this._pendingActivationTimeout=void 0)},_onArrowKeyup:function(e){this.autoselect&&this._scheduleActivation(this.focusedItem,this.autoselectDelay)},_onBlurCapture:function(e){e.target===this._pendingActivationItem&&this._cancelPendingActivation()},get _tabContainerScrollSize(){return Math.max(0,this.$.tabsContainer.scrollWidth-this.$.tabsContainer.offsetWidth)},_scroll:function(e,t){if(this.scrollable){var i=t&&-t.ddx||0;this._affectScroll(i)}},_down:function(e){this.async(function(){this._defaultFocusAsync&&(this.cancelAsync(this._defaultFocusAsync),this._defaultFocusAsync=null)},1)},_affectScroll:function(e){this.$.tabsContainer.scrollLeft+=e;var t=this.$.tabsContainer.scrollLeft;this._leftHidden=0===t,this._rightHidden=t===this._tabContainerScrollSize},_onLeftScrollButtonDown:function(){this._scrollToLeft(),this._holdJob=setInterval(this._scrollToLeft.bind(this),this._holdDelay)},_onRightScrollButtonDown:function(){this._scrollToRight(),this._holdJob=setInterval(this._scrollToRight.bind(this),this._holdDelay)},_onScrollButtonUp:function(){clearInterval(this._holdJob),this._holdJob=null},_scrollToLeft:function(){this._affectScroll(-this._step)},_scrollToRight:function(){this._affectScroll(this._step)},_tabChanged:function(e,t){if(!e)return this.$.selectionBar.classList.remove("expand"),this.$.selectionBar.classList.remove("contract"),void this._positionBar(0,0);var i=this.$.tabsContent.getBoundingClientRect(),n=i.width,r=e.getBoundingClientRect(),o=r.left-i.left;if(this._pos={width:this._calcPercent(r.width,n),left:this._calcPercent(o,n)},this.noSlide||null==t)return this.$.selectionBar.classList.remove("expand"),this.$.selectionBar.classList.remove("contract"),void this._positionBar(this._pos.width,this._pos.left);var s=t.getBoundingClientRect(),a=this.items.indexOf(t),h=this.items.indexOf(e),l=5;this.$.selectionBar.classList.add("expand");var c=a<h,u=this._isRTL;u&&(c=!c),c?this._positionBar(this._calcPercent(r.left+r.width-s.left,n)-l,this._left):this._positionBar(this._calcPercent(s.left+s.width-r.left,n)-l,this._calcPercent(o,n)+l),this.scrollable&&this._scrollToSelectedIfNeeded(r.width,o)},_scrollToSelectedIfNeeded:function(e,t){var i=t-this.$.tabsContainer.scrollLeft;i<0?this.$.tabsContainer.scrollLeft+=i:(i+=e-this.$.tabsContainer.offsetWidth,i>0&&(this.$.tabsContainer.scrollLeft+=i))},_calcPercent:function(e,t){return 100*e/t},_positionBar:function(e,t){e=e||0,t=t||0,this._width=e,this._left=t,this.transform("translateX("+t+"%) scaleX("+e/100+")",this.$.selectionBar)},_onBarTransitionEnd:function(e){var t=this.$.selectionBar.classList;t.contains("expand")?(t.remove("expand"),t.add("contract"),this._positionBar(this._pos.width,this._pos.left)):t.contains("contract")&&t.remove("contract")}}),Polymer({is:"iron-a11y-keys",behaviors:[Polymer.IronA11yKeysBehavior],properties:{target:{type:Object,observer:"_targetChanged"},keys:{type:String,reflectToAttribute:!0,observer:"_keysChanged"}},attached:function(){this.target||(this.target=this.parentNode)},_targetChanged:function(e){this.keyEventTarget=e},_keysChanged:function(){this.removeOwnKeyBindings(),this.addOwnKeyBinding(this.keys,"_fireKeysPressed")},_fireKeysPressed:function(e){this.fire("keys-pressed",e.detail,{})}});var polymer;!function(e){function t(){var t=function(){};window.polymer.Base=t,t.create=function(){throw"element not yet registered in Polymer"},t.register=function(t){t===!0?e.createClass(this):e.createElement(this)}}function i(e){function t(e,i){void 0!==i&&null!==i&&(Object.keys(i).map(function(t){e.hasOwnProperty(t)||(e[t]=i[t])}),t(e,i.__proto__))}if(void 0===e.prototype.is){var i=e.prototype,n=new e;if(!n.is)throw new Error("no name for "+e);i.is=n.is,n.extends&&(i.extends=n.extends),n.properties&&(i.properties=n.properties),n.listeners&&(i.listeners=n.listeners),n.observers&&(i.observers=n.observers),n.behaviors&&(i.behaviors=n.behaviors),n.hostAttributes&&(i.hostAttributes=n.hostAttributes),n.style&&(i.style=n.style),n.template&&(i.template=n.template)}var r=e.prototype;if(r.$custom_cons=function(){var t=this.$custom_cons_args;e.apply(this,t)},r.$custom_cons_args=[],void 0!==r.factoryImpl)throw"do not use factoryImpl() use constructor() instead";r.factoryImpl=function(){this.$custom_cons_args=arguments};var o="attached",s=r[o];return r[o]=function(){this.$custom_cons(),void 0!==s&&s.apply(this)},t(r,e.prototype.__proto__),r}function n(e){var t=document.createElement("dom-module"),i=e.prototype;t.id=i.is;var n="";void 0!==i.style&&(n+="<style>"+i.style+"</style>"),void 0!==i.template&&(n+="<template>"+i.template+"</template>"),t.innerHTML=n,t.createdCallback()}function r(t){if(e.isRegistered(t))throw"element already registered in Polymer";void 0===t.prototype.template&&void 0===t.prototype.style||e.createDomModule(t);var i=Polymer(e.prepareForRegistration(t));return t.create=function(){var e=Object.create(i.prototype);return i.apply(e,arguments)},i}function o(t){if(e.isRegistered(t))throw"element already registered in Polymer";void 0===t.prototype.template&&void 0===t.prototype.style||e.createDomModule(t);var i=Polymer.Class(e.prepareForRegistration(t));return t.create=function(){var e=Object.create(i.prototype);return i.apply(e,arguments)},i}function s(e){return void 0!==e.prototype.$custom_cons}e.createEs6PolymerBase=t,e.prepareForRegistration=i,e.createDomModule=n,e.createElement=r,e.createClass=o,e.isRegistered=s}(polymer||(polymer={})),polymer.createEs6PolymerBase();var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},WebRTCLobbyClient=function(e){function t(){e.apply(this,arguments),this.open=!1,this.curID=0,this.promises={},this.handlers={},this.debug=!1}return __extends(t,e),t.prototype.nextID=function(){return this.curID=(this.curID||0)+1,this.curID},t.prototype.onOpen=function(){this.open=!0},t.prototype.created=function(){this.getLocation()},t.prototype.send=function(e,t){var i=this,n=this.nextID(),r={method:e,params:[t],id:n},o=new Promise(function(e,t){i.promises||(i.promises={}),i.promises[n]={resolve:e,reject:t}});return this.sendRaw(r),o},t.prototype.getLocation=function(){var e=this;navigator.geolocation.getCurrentPosition(function(t){e.location=t.coords})},t.prototype.register=function(e,t){this.handlers||(this.handlers={}),this.handlers[e]=t},t.prototype.sendRaw=function(e){this.debug&&console.log("sending",e),this.$.socket.send(e)},t.prototype.message=function(e,t){var i=this;{if(!t.data.method){this.debug&&console.log("response",t.data);var n=this.promises[t.data.id];return delete this.promises[t.data.id],t.data.error?(this.error=t.data.error,void n.reject(t.data.error)):void n.resolve(t.data.result)}this.debug&&console.log("rpc",t.data);new Promise(function(e,n){var r=i.handlers[t.data.method];return r?void r(t.data.params[0],e,n):void n("unknown rpc call")}).then(function(e){i.sendRaw({id:t.data.id,error:null,result:e})}).catch(function(e){i.sendRaw({id:t.data.id,error:e.message||e,result:null})})}},__decorate([property({type:String})],t.prototype,"url",void 0),__decorate([property({type:String,notify:!0})],t.prototype,"error",void 0),__decorate([property({type:String})],t.prototype,"service",void 0),__decorate([property({type:Object,value:{}})],t.prototype,"location",void 0),__decorate([property({type:Boolean})],t.prototype,"open",void 0),t}(polymer.Base);!function(){XWebsocket=Polymer({is:"x-websocket",properties:{url:{type:String,notify:!0,observer:"urlChanged"},auto:{type:Boolean,notify:!0,value:!1},json:{type:Boolean,notify:!0,value:!1},jsonSend:{type:Boolean,notify:!0,value:!1},jsonReceive:{type:Boolean,notify:!0,value:!1}},_ws:null,send:function(e){if(!this._ws)throw new Error("x-websocket.send(...): not connected.");(this.json||this.jsonSend)&&(e=JSON.stringify(e)),this._ws.send(e)},open:function(){this._connect()},close:function(e){this._ws&&(this._ws.close(e),this._ws=null)},get readyState(){return this._ws?this._ws.readyState:-1},urlChanged:function(){this.auto&&this.open()},_connect:function(){if(!this.url)throw new Error("x-websocket.connect(...): no url.");if(this._ws)throw new Error("x-websocket.connect(...): already connected.");this._ws=new WebSocket(this.url),this._ws.onopen=this._onwsopen.bind(this),this._ws.onerror=this._onwserror.bind(this),this._ws.onmessage=this._onwsmessage.bind(this),this._ws.onclose=this._onwsclose.bind(this)},_onwsopen:function(){this.fire("open")},_onwserror:function(){this.fire("error")},_onwsmessage:function(e){var t=e.data;(this.json||this.jsonReceive)&&(t=JSON.parse(t)),this.fire("message",{data:t})},_onwsclose:function(e){this.fire("error",{code:e.code,reason:e.reason})}})}();var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},WebRTCLobbyList=function(e){function t(){e.apply(this,arguments),this.lobbies=[]}return __extends(t,e),t.prototype.refresh=function(){var e=this;this.open&&this.send("lobby.list",{Service:this.service}).then(function(t){e.lobbies=t.Lobbies||[]})},t.prototype.connect=function(e,t,i){return this.send("lobby.connect",{Id:e,Offer:t,Password:i})},__decorate([property({type:Array,notify:!0})],t.prototype,"lobbies",void 0),__decorate([observe("service,open,location")],t.prototype,"refresh",null),t=__decorate([component("webrtc-lobby-list")],t)}(WebRTCLobbyClient);WebRTCLobbyList.register();var __extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},__decorate=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(o<3?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},WebRTCLobbyHost=function(e){function t(){e.apply(this,arguments),this.token=this.generateToken()}return __extends(t,e),t.prototype.attached=function(){var e=this;this.register("client.connect",function(t,i,n){return e.password.length>0&&e.password!=t.Password&&n("invalid credentials"),"function"==typeof e.offer?void e.offer(t,i):void n("no offer handler available")})},t.prototype.refresh=function(){this.open&&this.send("lobby.new",{Service:this.service,ID:this.token,Name:this.name,Creator:this.creator,Hidden:this.hidden,RequiresPassword:this.password.length>0,People:this.people,Capacity:this.capacity,Location:this.location}).then(function(e){})},t.prototype.generateToken=function(e){void 0===e&&(e=10);var i=window.crypto||window.msCrypto,n=new Uint8Array(e);i.getRandomValues(n);for(var r="",o=0;o<n.length;o++){var s=n[o];r+=t.LETTERS[s%t.LETTERS.length]}return r},t.LETTERS="1234567890abcdefghijklmnopqrstuvwxyz",__decorate([property({type:String,notify:!0})],t.prototype,"token",void 0),__decorate([property({type:String})],t.prototype,"name",void 0),__decorate([property({type:String,value:""})],t.prototype,"creator",void 0),__decorate([property({type:String,value:""})],t.prototype,"password",void 0),__decorate([property({type:Number,value:0})],t.prototype,"people",void 0),__decorate([property({type:Number,value:0})],t.prototype,"capacity",void 0),__decorate([property({type:Boolean,value:!1})],t.prototype,"hidden",void 0),__decorate([property({type:Object,value:{}})],t.prototype,"location",void 0),__decorate([property({type:Function})],t.prototype,"offer",void 0),__decorate([observe("open,service,token,name,creator,hidden,password,people,capacity,location")],t.prototype,"refresh",null),t=__decorate([component("webrtc-lobby-host")],t)}(WebRTCLobbyClient);WebRTCLobbyHost.register(),Polymer.PaperButtonBehaviorImpl={properties:{elevation:{type:Number,reflectToAttribute:!0,readOnly:!0}},observers:["_calculateElevation(focused, disabled, active, pressed, receivedFocusFromKeyboard)","_computeKeyboardClass(receivedFocusFromKeyboard)"],hostAttributes:{role:"button",tabindex:"0",animated:!0},_calculateElevation:function(){var e=1;this.disabled?e=0:this.active||this.pressed?e=4:this.receivedFocusFromKeyboard&&(e=3),this._setElevation(e)},_computeKeyboardClass:function(e){this.toggleClass("keyboard-focus",e)},_spaceKeyDownHandler:function(e){Polymer.IronButtonStateImpl._spaceKeyDownHandler.call(this,e),this.hasRipple()&&this.getRipple().ripples.length<1&&this._ripple.uiDownAction()},_spaceKeyUpHandler:function(e){Polymer.IronButtonStateImpl._spaceKeyUpHandler.call(this,e),this.hasRipple()&&this._ripple.uiUpAction()}},Polymer.PaperButtonBehavior=[Polymer.IronButtonState,Polymer.IronControlState,Polymer.PaperRippleBehavior,Polymer.PaperButtonBehaviorImpl],Polymer({is:"paper-button",behaviors:[Polymer.PaperButtonBehavior],properties:{raised:{type:Boolean,reflectToAttribute:!0,value:!1,observer:"_calculateElevation"}},_calculateElevation:function(){this.raised?Polymer.PaperButtonBehaviorImpl._calculateElevation.apply(this):this._setElevation(0)}}),Polymer.IronFormElementBehavior={properties:{name:{type:String},value:{notify:!0,type:String},required:{type:Boolean,value:!1},_parentForm:{type:Object}},attached:function(){this.fire("iron-form-element-register")},detached:function(){this._parentForm&&this._parentForm.fire("iron-form-element-unregister",{target:this})}},function(){"use strict";Polymer.IronA11yAnnouncer=Polymer({is:"iron-a11y-announcer",properties:{mode:{type:String,value:"polite"},_text:{type:String,value:""}},created:function(){Polymer.IronA11yAnnouncer.instance||(Polymer.IronA11yAnnouncer.instance=this),document.body.addEventListener("iron-announce",this._onIronAnnounce.bind(this))},announce:function(e){this._text="",this.async(function(){this._text=e},100)},_onIronAnnounce:function(e){e.detail&&e.detail.text&&this.announce(e.detail.text)}}),Polymer.IronA11yAnnouncer.instance=null,Polymer.IronA11yAnnouncer.requestAvailability=function(){Polymer.IronA11yAnnouncer.instance||(Polymer.IronA11yAnnouncer.instance=document.createElement("iron-a11y-announcer")),document.body.appendChild(Polymer.IronA11yAnnouncer.instance)}}(),Polymer.IronValidatableBehaviorMeta=null,Polymer.IronValidatableBehavior={properties:{validator:{type:String},invalid:{notify:!0,reflectToAttribute:!0,type:Boolean,value:!1},_validatorMeta:{type:Object},validatorType:{type:String,value:"validator"},_validator:{type:Object,computed:"__computeValidator(validator)"}},observers:["_invalidChanged(invalid)"],registered:function(){Polymer.IronValidatableBehaviorMeta=new Polymer.IronMeta({type:"validator"})},_invalidChanged:function(){this.invalid?this.setAttribute("aria-invalid","true"):this.removeAttribute("aria-invalid")},hasValidator:function(){return null!=this._validator},validate:function(e){return this.invalid=!this._getValidity(e),!this.invalid},_getValidity:function(e){return!this.hasValidator()||this._validator.validate(e)},__computeValidator:function(){return Polymer.IronValidatableBehaviorMeta&&Polymer.IronValidatableBehaviorMeta.byKey(this.validator)}},Polymer({is:"iron-input",extends:"input",behaviors:[Polymer.IronValidatableBehavior],properties:{bindValue:{observer:"_bindValueChanged",type:String},preventInvalidInput:{type:Boolean},allowedPattern:{type:String,observer:"_allowedPatternChanged"},_previousValidInput:{type:String,value:""},_patternAlreadyChecked:{type:Boolean,value:!1}},listeners:{input:"_onInput",keypress:"_onKeypress"},registered:function(){this._canDispatchEventOnDisabled()||(this._origDispatchEvent=this.dispatchEvent,this.dispatchEvent=this._dispatchEventFirefoxIE)},created:function(){Polymer.IronA11yAnnouncer.requestAvailability()},_canDispatchEventOnDisabled:function(){var e=document.createElement("input"),t=!1;e.disabled=!0,e.addEventListener("feature-check-dispatch-event",function(){t=!0});try{e.dispatchEvent(new Event("feature-check-dispatch-event"))}catch(e){}return t},_dispatchEventFirefoxIE:function(){var e=this.disabled;this.disabled=!1,this._origDispatchEvent.apply(this,arguments),this.disabled=e},get _patternRegExp(){var e;if(this.allowedPattern)e=new RegExp(this.allowedPattern);else switch(this.type){case"number":e=/[0-9.,e-]/}return e},ready:function(){this.bindValue=this.value},_bindValueChanged:function(){this.value!==this.bindValue&&(this.value=this.bindValue||0===this.bindValue||this.bindValue===!1?this.bindValue:""),this.fire("bind-value-changed",{value:this.bindValue})},_allowedPatternChanged:function(){this.preventInvalidInput=!!this.allowedPattern},_onInput:function(){if(this.preventInvalidInput&&!this._patternAlreadyChecked){var e=this._checkPatternValidity();e||(this._announceInvalidCharacter("Invalid string of characters not entered."),this.value=this._previousValidInput)}this.bindValue=this.value,this._previousValidInput=this.value,this._patternAlreadyChecked=!1},_isPrintable:function(e){var t=8==e.keyCode||9==e.keyCode||13==e.keyCode||27==e.keyCode,i=19==e.keyCode||20==e.keyCode||45==e.keyCode||46==e.keyCode||144==e.keyCode||145==e.keyCode||e.keyCode>32&&e.keyCode<41||e.keyCode>111&&e.keyCode<124;return!(t||0==e.charCode&&i)},_onKeypress:function(e){if(this.preventInvalidInput||"number"===this.type){var t=this._patternRegExp;if(t&&!(e.metaKey||e.ctrlKey||e.altKey)){this._patternAlreadyChecked=!0;var i=String.fromCharCode(e.charCode);this._isPrintable(e)&&!t.test(i)&&(e.preventDefault(),this._announceInvalidCharacter("Invalid character "+i+" not entered."))}}},_checkPatternValidity:function(){var e=this._patternRegExp;if(!e)return!0;for(var t=0;t<this.value.length;t++)if(!e.test(this.value[t]))return!1;return!0},validate:function(){var e=this.checkValidity();return e&&(this.required&&""===this.value?e=!1:this.hasValidator()&&(e=Polymer.IronValidatableBehavior.validate.call(this,this.value))),this.invalid=!e,this.fire("iron-input-validate"),e},_announceInvalidCharacter:function(e){this.fire("iron-announce",{text:e})}}),Polymer.PaperInputHelper={},Polymer.PaperInputHelper.NextLabelID=1,Polymer.PaperInputHelper.NextAddonID=1,Polymer.PaperInputBehaviorImpl={properties:{label:{type:String},value:{notify:!0,type:String},disabled:{type:Boolean,value:!1},invalid:{type:Boolean,value:!1,notify:!0},preventInvalidInput:{type:Boolean},allowedPattern:{type:String},type:{type:String},list:{type:String},pattern:{type:String},required:{type:Boolean,value:!1},errorMessage:{type:String},charCounter:{type:Boolean,value:!1},noLabelFloat:{type:Boolean,value:!1},alwaysFloatLabel:{type:Boolean,value:!1},autoValidate:{type:Boolean,value:!1},validator:{type:String},autocomplete:{type:String,value:"off"},autofocus:{type:Boolean,observer:"_autofocusChanged"},inputmode:{type:String},minlength:{type:Number},maxlength:{type:Number},min:{type:String},max:{type:String},step:{type:String},name:{type:String},placeholder:{type:String,value:""},readonly:{type:Boolean,value:!1},size:{type:Number},autocapitalize:{type:String,value:"none"},autocorrect:{type:String,value:"off"},autosave:{type:String},results:{type:Number},accept:{type:String},multiple:{type:Boolean},_ariaDescribedBy:{type:String,value:""},_ariaLabelledBy:{type:String,value:""}},listeners:{"addon-attached":"_onAddonAttached"},keyBindings:{"shift+tab:keydown":"_onShiftTabDown"},hostAttributes:{tabindex:0},get inputElement(){return this.$.input},get _focusableElement(){return this.inputElement},registered:function(){this._typesThatHaveText=["date","datetime","datetime-local","month","time","week","file"]},attached:function(){this._updateAriaLabelledBy(),this.inputElement&&this._typesThatHaveText.indexOf(this.inputElement.type)!==-1&&(this.alwaysFloatLabel=!0)},_appendStringWithSpace:function(e,t){return e=e?e+" "+t:t},_onAddonAttached:function(e){var t=e.path?e.path[0]:e.target;if(t.id)this._ariaDescribedBy=this._appendStringWithSpace(this._ariaDescribedBy,t.id);else{var i="paper-input-add-on-"+Polymer.PaperInputHelper.NextAddonID++;
t.id=i,this._ariaDescribedBy=this._appendStringWithSpace(this._ariaDescribedBy,i)}},validate:function(){return this.inputElement.validate()},_focusBlurHandler:function(e){Polymer.IronControlState._focusBlurHandler.call(this,e),this.focused&&!this._shiftTabPressed&&this._focusableElement.focus()},_onShiftTabDown:function(e){var t=this.getAttribute("tabindex");this._shiftTabPressed=!0,this.setAttribute("tabindex","-1"),this.async(function(){this.setAttribute("tabindex",t),this._shiftTabPressed=!1},1)},_handleAutoValidate:function(){this.autoValidate&&this.validate()},updateValueAndPreserveCaret:function(e){try{var t=this.inputElement.selectionStart;this.value=e,this.inputElement.selectionStart=t,this.inputElement.selectionEnd=t}catch(t){this.value=e}},_computeAlwaysFloatLabel:function(e,t){return t||e},_updateAriaLabelledBy:function(){var e=Polymer.dom(this.root).querySelector("label");if(!e)return void(this._ariaLabelledBy="");var t;e.id?t=e.id:(t="paper-input-label-"+Polymer.PaperInputHelper.NextLabelID++,e.id=t),this._ariaLabelledBy=t},_onChange:function(e){this.shadowRoot&&this.fire(e.type,{sourceEvent:e},{node:this,bubbles:e.bubbles,cancelable:e.cancelable})},_autofocusChanged:function(){if(this.autofocus&&this._focusableElement){var e=document.activeElement,t=e instanceof HTMLElement,i=t&&e!==document.body&&e!==document.documentElement;i||this._focusableElement.focus()}}},Polymer.PaperInputBehavior=[Polymer.IronControlState,Polymer.IronA11yKeysBehavior,Polymer.PaperInputBehaviorImpl],Polymer.PaperInputAddonBehavior={hostAttributes:{"add-on":""},attached:function(){this.fire("addon-attached")},update:function(e){}},Polymer({is:"paper-input-char-counter",behaviors:[Polymer.PaperInputAddonBehavior],properties:{_charCounterStr:{type:String,value:"0"}},update:function(e){if(e.inputElement){e.value=e.value||"";var t=e.value.toString().length.toString();e.inputElement.hasAttribute("maxlength")&&(t+="/"+e.inputElement.getAttribute("maxlength")),this._charCounterStr=t}}}),Polymer({is:"paper-input-container",properties:{noLabelFloat:{type:Boolean,value:!1},alwaysFloatLabel:{type:Boolean,value:!1},attrForValue:{type:String,value:"bind-value"},autoValidate:{type:Boolean,value:!1},invalid:{observer:"_invalidChanged",type:Boolean,value:!1},focused:{readOnly:!0,type:Boolean,value:!1,notify:!0},_addons:{type:Array},_inputHasContent:{type:Boolean,value:!1},_inputSelector:{type:String,value:"input,textarea,.paper-input-input"},_boundOnFocus:{type:Function,value:function(){return this._onFocus.bind(this)}},_boundOnBlur:{type:Function,value:function(){return this._onBlur.bind(this)}},_boundOnInput:{type:Function,value:function(){return this._onInput.bind(this)}},_boundValueChanged:{type:Function,value:function(){return this._onValueChanged.bind(this)}}},listeners:{"addon-attached":"_onAddonAttached","iron-input-validate":"_onIronInputValidate"},get _valueChangedEvent(){return this.attrForValue+"-changed"},get _propertyForValue(){return Polymer.CaseMap.dashToCamelCase(this.attrForValue)},get _inputElement(){return Polymer.dom(this).querySelector(this._inputSelector)},get _inputElementValue(){return this._inputElement[this._propertyForValue]||this._inputElement.value},ready:function(){this._addons||(this._addons=[]),this.addEventListener("focus",this._boundOnFocus,!0),this.addEventListener("blur",this._boundOnBlur,!0)},attached:function(){this.attrForValue?this._inputElement.addEventListener(this._valueChangedEvent,this._boundValueChanged):this.addEventListener("input",this._onInput),""!=this._inputElementValue?this._handleValueAndAutoValidate(this._inputElement):this._handleValue(this._inputElement)},_onAddonAttached:function(e){this._addons||(this._addons=[]);var t=e.target;this._addons.indexOf(t)===-1&&(this._addons.push(t),this.isAttached&&this._handleValue(this._inputElement))},_onFocus:function(){this._setFocused(!0)},_onBlur:function(){this._setFocused(!1),this._handleValueAndAutoValidate(this._inputElement)},_onInput:function(e){this._handleValueAndAutoValidate(e.target)},_onValueChanged:function(e){this._handleValueAndAutoValidate(e.target)},_handleValue:function(e){var t=this._inputElementValue;t||0===t||"number"===e.type&&!e.checkValidity()?this._inputHasContent=!0:this._inputHasContent=!1,this.updateAddons({inputElement:e,value:t,invalid:this.invalid})},_handleValueAndAutoValidate:function(e){if(this.autoValidate){var t;t=e.validate?e.validate(this._inputElementValue):e.checkValidity(),this.invalid=!t}this._handleValue(e)},_onIronInputValidate:function(e){this.invalid=this._inputElement.invalid},_invalidChanged:function(){this._addons&&this.updateAddons({invalid:this.invalid})},updateAddons:function(e){for(var t,i=0;t=this._addons[i];i++)t.update(e)},_computeInputContentClass:function(e,t,i,n,r){var o="input-content";if(e)r&&(o+=" label-is-hidden");else{var s=this.querySelector("label");t||r?(o+=" label-is-floating",this.$.labelAndInputContainer.style.position="static",n?o+=" is-invalid":i&&(o+=" label-is-highlighted")):s&&(this.$.labelAndInputContainer.style.position="relative")}return o},_computeUnderlineClass:function(e,t){var i="underline";return t?i+=" is-invalid":e&&(i+=" is-highlighted"),i},_computeAddOnContentClass:function(e,t){var i="add-on-content";return t?i+=" is-invalid":e&&(i+=" is-highlighted"),i}}),Polymer({is:"paper-input-error",behaviors:[Polymer.PaperInputAddonBehavior],properties:{invalid:{readOnly:!0,reflectToAttribute:!0,type:Boolean}},update:function(e){this._setInvalid(e.invalid)}}),Polymer({is:"paper-input",behaviors:[Polymer.IronFormElementBehavior,Polymer.PaperInputBehavior]}),Polymer.PaperSpinnerBehavior={listeners:{animationend:"__reset",webkitAnimationEnd:"__reset"},properties:{active:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"__activeChanged"},alt:{type:String,value:"loading",observer:"__altChanged"},__coolingDown:{type:Boolean,value:!1}},__computeContainerClasses:function(e,t){return[e||t?"active":"",t?"cooldown":""].join(" ")},__activeChanged:function(e,t){this.__setAriaHidden(!e),this.__coolingDown=!e&&t},__altChanged:function(e){e===this.getPropertyInfo("alt").value?this.alt=this.getAttribute("aria-label")||e:(this.__setAriaHidden(""===e),this.setAttribute("aria-label",e))},__setAriaHidden:function(e){var t="aria-hidden";e?this.setAttribute(t,"true"):this.removeAttribute(t)},__reset:function(){this.active=!1,this.__coolingDown=!1}},Polymer({is:"paper-spinner-lite",behaviors:[Polymer.PaperSpinnerBehavior]}),Polymer.IronFitBehavior={properties:{sizingTarget:{type:Object,value:function(){return this}},fitInto:{type:Object,value:window},noOverlap:{type:Boolean},positionTarget:{type:Element},horizontalAlign:{type:String},verticalAlign:{type:String},dynamicAlign:{type:Boolean},horizontalOffset:{type:Number,value:0,notify:!0},verticalOffset:{type:Number,value:0,notify:!0},autoFitOnAttach:{type:Boolean,value:!1},_fitInfo:{type:Object}},get _fitWidth(){var e;return e=this.fitInto===window?this.fitInto.innerWidth:this.fitInto.getBoundingClientRect().width},get _fitHeight(){var e;return e=this.fitInto===window?this.fitInto.innerHeight:this.fitInto.getBoundingClientRect().height},get _fitLeft(){var e;return e=this.fitInto===window?0:this.fitInto.getBoundingClientRect().left},get _fitTop(){var e;return e=this.fitInto===window?0:this.fitInto.getBoundingClientRect().top},get _defaultPositionTarget(){var e=Polymer.dom(this).parentNode;return e&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e},get _localeHorizontalAlign(){if(this._isRTL){if("right"===this.horizontalAlign)return"left";if("left"===this.horizontalAlign)return"right"}return this.horizontalAlign},attached:function(){this._isRTL="rtl"==window.getComputedStyle(this).direction,this.positionTarget=this.positionTarget||this._defaultPositionTarget,this.autoFitOnAttach&&("none"===window.getComputedStyle(this).display?setTimeout(function(){this.fit()}.bind(this)):this.fit())},fit:function(){this.position(),this.constrain(),this.center()},_discoverInfo:function(){if(!this._fitInfo){var e=window.getComputedStyle(this),t=window.getComputedStyle(this.sizingTarget);this._fitInfo={inlineStyle:{top:this.style.top||"",left:this.style.left||"",position:this.style.position||""},sizerInlineStyle:{maxWidth:this.sizingTarget.style.maxWidth||"",maxHeight:this.sizingTarget.style.maxHeight||"",boxSizing:this.sizingTarget.style.boxSizing||""},positionedBy:{vertically:"auto"!==e.top?"top":"auto"!==e.bottom?"bottom":null,horizontally:"auto"!==e.left?"left":"auto"!==e.right?"right":null},sizedBy:{height:"none"!==t.maxHeight,width:"none"!==t.maxWidth,minWidth:parseInt(t.minWidth,10)||0,minHeight:parseInt(t.minHeight,10)||0},margin:{top:parseInt(e.marginTop,10)||0,right:parseInt(e.marginRight,10)||0,bottom:parseInt(e.marginBottom,10)||0,left:parseInt(e.marginLeft,10)||0}},this.verticalOffset&&(this._fitInfo.margin.top=this._fitInfo.margin.bottom=this.verticalOffset,this._fitInfo.inlineStyle.marginTop=this.style.marginTop||"",this._fitInfo.inlineStyle.marginBottom=this.style.marginBottom||"",this.style.marginTop=this.style.marginBottom=this.verticalOffset+"px"),this.horizontalOffset&&(this._fitInfo.margin.left=this._fitInfo.margin.right=this.horizontalOffset,this._fitInfo.inlineStyle.marginLeft=this.style.marginLeft||"",this._fitInfo.inlineStyle.marginRight=this.style.marginRight||"",this.style.marginLeft=this.style.marginRight=this.horizontalOffset+"px")}},resetFit:function(){var e=this._fitInfo||{};for(var t in e.sizerInlineStyle)this.sizingTarget.style[t]=e.sizerInlineStyle[t];for(var t in e.inlineStyle)this.style[t]=e.inlineStyle[t];this._fitInfo=null},refit:function(){var e=this.sizingTarget.scrollLeft,t=this.sizingTarget.scrollTop;this.resetFit(),this.fit(),this.sizingTarget.scrollLeft=e,this.sizingTarget.scrollTop=t},position:function(){if(this.horizontalAlign||this.verticalAlign){this._discoverInfo(),this.style.position="fixed",this.sizingTarget.style.boxSizing="border-box",this.style.left="0px",this.style.top="0px";var e=this.getBoundingClientRect(),t=this.__getNormalizedRect(this.positionTarget),i=this.__getNormalizedRect(this.fitInto),n=this._fitInfo.margin,r={width:e.width+n.left+n.right,height:e.height+n.top+n.bottom},o=this.__getPosition(this._localeHorizontalAlign,this.verticalAlign,r,t,i),s=o.left+n.left,a=o.top+n.top,h=Math.min(i.right-n.right,s+e.width),l=Math.min(i.bottom-n.bottom,a+e.height),c=this._fitInfo.sizedBy.minWidth,u=this._fitInfo.sizedBy.minHeight;s<n.left&&(s=n.left,h-s<c&&(s=h-c)),a<n.top&&(a=n.top,l-a<u&&(a=l-u)),this.sizingTarget.style.maxWidth=h-s+"px",this.sizingTarget.style.maxHeight=l-a+"px",this.style.left=s-e.left+"px",this.style.top=a-e.top+"px"}},constrain:function(){if(!this.horizontalAlign&&!this.verticalAlign){this._discoverInfo();var e=this._fitInfo;e.positionedBy.vertically||(this.style.position="fixed",this.style.top="0px"),e.positionedBy.horizontally||(this.style.position="fixed",this.style.left="0px"),this.sizingTarget.style.boxSizing="border-box";var t=this.getBoundingClientRect();e.sizedBy.height||this.__sizeDimension(t,e.positionedBy.vertically,"top","bottom","Height"),e.sizedBy.width||this.__sizeDimension(t,e.positionedBy.horizontally,"left","right","Width")}},_sizeDimension:function(e,t,i,n,r){this.__sizeDimension(e,t,i,n,r)},__sizeDimension:function(e,t,i,n,r){var o=this._fitInfo,s=this.__getNormalizedRect(this.fitInto),a="Width"===r?s.width:s.height,h=t===n,l=h?a-e[n]:e[i],c=o.margin[h?i:n],u="offset"+r,d=this[u]-this.sizingTarget[u];this.sizingTarget.style["max"+r]=a-c-l-d+"px"},center:function(){if(!this.horizontalAlign&&!this.verticalAlign){this._discoverInfo();var e=this._fitInfo.positionedBy;if(!e.vertically||!e.horizontally){this.style.position="fixed",e.vertically||(this.style.top="0px"),e.horizontally||(this.style.left="0px");var t=this.getBoundingClientRect(),i=this.__getNormalizedRect(this.fitInto);if(!e.vertically){var n=i.top-t.top+(i.height-t.height)/2;this.style.top=n+"px"}if(!e.horizontally){var r=i.left-t.left+(i.width-t.width)/2;this.style.left=r+"px"}}}},__getNormalizedRect:function(e){return e===document.documentElement||e===window?{top:0,left:0,width:window.innerWidth,height:window.innerHeight,right:window.innerWidth,bottom:window.innerHeight}:e.getBoundingClientRect()},__getCroppedArea:function(e,t,i){var n=Math.min(0,e.top)+Math.min(0,i.bottom-(e.top+t.height)),r=Math.min(0,e.left)+Math.min(0,i.right-(e.left+t.width));return Math.abs(n)*t.width+Math.abs(r)*t.height},__getPosition:function(e,t,i,n,r){var o=[{verticalAlign:"top",horizontalAlign:"left",top:n.top,left:n.left},{verticalAlign:"top",horizontalAlign:"right",top:n.top,left:n.right-i.width},{verticalAlign:"bottom",horizontalAlign:"left",top:n.bottom-i.height,left:n.left},{verticalAlign:"bottom",horizontalAlign:"right",top:n.bottom-i.height,left:n.right-i.width}];if(this.noOverlap){for(var s=0,a=o.length;s<a;s++){var h={};for(var l in o[s])h[l]=o[s][l];o.push(h)}o[0].top=o[1].top+=n.height,o[2].top=o[3].top-=n.height,o[4].left=o[6].left+=n.width,o[5].left=o[7].left-=n.width}t="auto"===t?null:t,e="auto"===e?null:e;for(var c,s=0;s<o.length;s++){var u=o[s];if(!this.dynamicAlign&&!this.noOverlap&&u.verticalAlign===t&&u.horizontalAlign===e){c=u;break}var d=!(t&&u.verticalAlign!==t||e&&u.horizontalAlign!==e);if(this.dynamicAlign||d){c=c||u,u.croppedArea=this.__getCroppedArea(u,i,r);var f=u.croppedArea-c.croppedArea;if((f<0||0===f&&d)&&(c=u),0===c.croppedArea&&d)break}}return c}},function(){"use strict";Polymer({is:"iron-overlay-backdrop",properties:{opened:{reflectToAttribute:!0,type:Boolean,value:!1,observer:"_openedChanged"}},listeners:{transitionend:"_onTransitionend"},created:function(){this.__openedRaf=null},attached:function(){this.opened&&this._openedChanged(this.opened)},prepare:function(){this.opened&&!this.parentNode&&Polymer.dom(document.body).appendChild(this)},open:function(){this.opened=!0},close:function(){this.opened=!1},complete:function(){this.opened||this.parentNode!==document.body||Polymer.dom(this.parentNode).removeChild(this)},_onTransitionend:function(e){e&&e.target===this&&this.complete()},_openedChanged:function(e){if(e)this.prepare();else{var t=window.getComputedStyle(this);"0s"!==t.transitionDuration&&0!=t.opacity||this.complete()}this.isAttached&&(this.__openedRaf&&(window.cancelAnimationFrame(this.__openedRaf),this.__openedRaf=null),this.scrollTop=this.scrollTop,this.__openedRaf=window.requestAnimationFrame(function(){this.__openedRaf=null,this.toggleClass("opened",this.opened)}.bind(this)))}})}(),Polymer.IronOverlayManagerClass=function(){this._overlays=[],this._minimumZ=101,this._backdropElement=null,Polymer.Gestures.add(document,"tap",this._onCaptureClick.bind(this)),document.addEventListener("focus",this._onCaptureFocus.bind(this),!0),document.addEventListener("keydown",this._onCaptureKeyDown.bind(this),!0)},Polymer.IronOverlayManagerClass.prototype={constructor:Polymer.IronOverlayManagerClass,get backdropElement(){return this._backdropElement||(this._backdropElement=document.createElement("iron-overlay-backdrop")),this._backdropElement},get deepActiveElement(){for(var e=document.activeElement||document.body;e.root&&Polymer.dom(e.root).activeElement;)e=Polymer.dom(e.root).activeElement;return e},_bringOverlayAtIndexToFront:function(e){var t=this._overlays[e];if(t){var i=this._overlays.length-1,n=this._overlays[i];if(n&&this._shouldBeBehindOverlay(t,n)&&i--,!(e>=i)){var r=Math.max(this.currentOverlayZ(),this._minimumZ);for(this._getZ(t)<=r&&this._applyOverlayZ(t,r);e<i;)this._overlays[e]=this._overlays[e+1],e++;this._overlays[i]=t}}},addOrRemoveOverlay:function(e){e.opened?this.addOverlay(e):this.removeOverlay(e)},addOverlay:function(e){var t=this._overlays.indexOf(e);if(t>=0)return this._bringOverlayAtIndexToFront(t),void this.trackBackdrop();var i=this._overlays.length,n=this._overlays[i-1],r=Math.max(this._getZ(n),this._minimumZ),o=this._getZ(e);if(n&&this._shouldBeBehindOverlay(e,n)){this._applyOverlayZ(n,r),i--;var s=this._overlays[i-1];r=Math.max(this._getZ(s),this._minimumZ)}o<=r&&this._applyOverlayZ(e,r),this._overlays.splice(i,0,e),this.trackBackdrop()},removeOverlay:function(e){var t=this._overlays.indexOf(e);t!==-1&&(this._overlays.splice(t,1),this.trackBackdrop())},currentOverlay:function(){var e=this._overlays.length-1;return this._overlays[e]},currentOverlayZ:function(){return this._getZ(this.currentOverlay())},ensureMinimumZ:function(e){this._minimumZ=Math.max(this._minimumZ,e)},focusOverlay:function(){var e=this.currentOverlay();e&&e._applyFocus()},trackBackdrop:function(){var e=this._overlayWithBackdrop();(e||this._backdropElement)&&(this.backdropElement.style.zIndex=this._getZ(e)-1,this.backdropElement.opened=!!e)},getBackdrops:function(){for(var e=[],t=0;t<this._overlays.length;t++)this._overlays[t].withBackdrop&&e.push(this._overlays[t]);return e},backdropZ:function(){return this._getZ(this._overlayWithBackdrop())-1},_overlayWithBackdrop:function(){for(var e=0;e<this._overlays.length;e++)if(this._overlays[e].withBackdrop)return this._overlays[e]},_getZ:function(e){var t=this._minimumZ;if(e){var i=Number(e.style.zIndex||window.getComputedStyle(e).zIndex);i===i&&(t=i)}return t},_setZ:function(e,t){e.style.zIndex=t},_applyOverlayZ:function(e,t){this._setZ(e,t+2)},_overlayInPath:function(e){e=e||[];for(var t=0;t<e.length;t++)if(e[t]._manager===this)return e[t]},_onCaptureClick:function(e){var t=this.currentOverlay();t&&this._overlayInPath(Polymer.dom(e).path)!==t&&t._onCaptureClick(e)},_onCaptureFocus:function(e){var t=this.currentOverlay();t&&t._onCaptureFocus(e)},_onCaptureKeyDown:function(e){var t=this.currentOverlay();t&&(Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(e,"esc")?t._onCaptureEsc(e):Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(e,"tab")&&t._onCaptureTab(e))},_shouldBeBehindOverlay:function(e,t){return!e.alwaysOnTop&&t.alwaysOnTop}},Polymer.IronOverlayManager=new Polymer.IronOverlayManagerClass,function(){"use strict";var e=Element.prototype,t=e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;Polymer.IronFocusablesHelper={getTabbableNodes:function(e){var t=[],i=this._collectTabbableNodes(e,t);return i?this._sortByTabIndex(t):t},isFocusable:function(e){return t.call(e,"input, select, textarea, button, object")?t.call(e,":not([disabled])"):t.call(e,"a[href], area[href], iframe, [tabindex], [contentEditable]")},isTabbable:function(e){return this.isFocusable(e)&&t.call(e,':not([tabindex="-1"])')&&this._isVisible(e)},_normalizedTabIndex:function(e){if(this.isFocusable(e)){var t=e.getAttribute("tabindex")||0;return Number(t)}return-1},_collectTabbableNodes:function(e,t){if(e.nodeType!==Node.ELEMENT_NODE||!this._isVisible(e))return!1;var i=e,n=this._normalizedTabIndex(i),r=n>0;n>=0&&t.push(i);var o;o="content"===i.localName?Polymer.dom(i).getDistributedNodes():Polymer.dom(i.root||i).children;for(var s=0;s<o.length;s++){var a=this._collectTabbableNodes(o[s],t);r=r||a}return r},_isVisible:function(e){var t=e.style;return"hidden"!==t.visibility&&"none"!==t.display&&(t=window.getComputedStyle(e),"hidden"!==t.visibility&&"none"!==t.display)},_sortByTabIndex:function(e){var t=e.length;if(t<2)return e;var i=Math.ceil(t/2),n=this._sortByTabIndex(e.slice(0,i)),r=this._sortByTabIndex(e.slice(i));return this._mergeSortByTabIndex(n,r)},_mergeSortByTabIndex:function(e,t){for(var i=[];e.length>0&&t.length>0;)this._hasLowerTabOrder(e[0],t[0])?i.push(t.shift()):i.push(e.shift());return i.concat(e,t)},_hasLowerTabOrder:function(e,t){var i=Math.max(e.tabIndex,0),n=Math.max(t.tabIndex,0);return 0===i||0===n?n>i:i>n}}}(),function(){"use strict";Polymer.IronOverlayBehaviorImpl={properties:{opened:{observer:"_openedChanged",type:Boolean,value:!1,notify:!0},canceled:{observer:"_canceledChanged",readOnly:!0,type:Boolean,value:!1},withBackdrop:{observer:"_withBackdropChanged",type:Boolean},noAutoFocus:{type:Boolean,value:!1},noCancelOnEscKey:{type:Boolean,value:!1},noCancelOnOutsideClick:{type:Boolean,value:!1},closingReason:{type:Object},restoreFocusOnClose:{type:Boolean,value:!1},alwaysOnTop:{type:Boolean},_manager:{type:Object,value:Polymer.IronOverlayManager},_focusedChild:{type:Object}},listeners:{"iron-resize":"_onIronResize"},get backdropElement(){return this._manager.backdropElement},get _focusNode(){return this._focusedChild||Polymer.dom(this).querySelector("[autofocus]")||this},get _focusableNodes(){return Polymer.IronFocusablesHelper.getTabbableNodes(this)},ready:function(){this.__isAnimating=!1,this.__shouldRemoveTabIndex=!1,this.__firstFocusableNode=this.__lastFocusableNode=null,this.__raf=null,this.__restoreFocusNode=null,this._ensureSetup()},attached:function(){this.opened&&this._openedChanged(this.opened),this._observer=Polymer.dom(this).observeNodes(this._onNodesChange)},detached:function(){Polymer.dom(this).unobserveNodes(this._observer),this._observer=null,this.__raf&&(window.cancelAnimationFrame(this.__raf),this.__raf=null),this._manager.removeOverlay(this)},toggle:function(){this._setCanceled(!1),this.opened=!this.opened},open:function(){this._setCanceled(!1),this.opened=!0},close:function(){this._setCanceled(!1),this.opened=!1},cancel:function(e){var t=this.fire("iron-overlay-canceled",e,{cancelable:!0});t.defaultPrevented||(this._setCanceled(!0),this.opened=!1)},invalidateTabbables:function(){this.__firstFocusableNode=this.__lastFocusableNode=null},_ensureSetup:function(){this._overlaySetup||(this._overlaySetup=!0,this.style.outline="none",this.style.display="none")},_openedChanged:function(e){e?this.removeAttribute("aria-hidden"):this.setAttribute("aria-hidden","true"),this.isAttached&&(this.__isAnimating=!0,this.__onNextAnimationFrame(this.__openedChanged))},_canceledChanged:function(){this.closingReason=this.closingReason||{},this.closingReason.canceled=this.canceled},_withBackdropChanged:function(){this.withBackdrop&&!this.hasAttribute("tabindex")?(this.setAttribute("tabindex","-1"),this.__shouldRemoveTabIndex=!0):this.__shouldRemoveTabIndex&&(this.removeAttribute("tabindex"),this.__shouldRemoveTabIndex=!1),this.opened&&this.isAttached&&this._manager.trackBackdrop()},_prepareRenderOpened:function(){this.__restoreFocusNode=this._manager.deepActiveElement,this._preparePositioning(),this.refit(),this._finishPositioning(),this.noAutoFocus&&document.activeElement===this._focusNode&&(this._focusNode.blur(),this.__restoreFocusNode.focus())},_renderOpened:function(){this._finishRenderOpened()},_renderClosed:function(){this._finishRenderClosed()},_finishRenderOpened:function(){this.notifyResize(),this.__isAnimating=!1,this.fire("iron-overlay-opened")},_finishRenderClosed:function(){this.style.display="none",this.style.zIndex="",this.notifyResize(),this.__isAnimating=!1,this.fire("iron-overlay-closed",this.closingReason)},_preparePositioning:function(){this.style.transition=this.style.webkitTransition="none",this.style.transform=this.style.webkitTransform="none",this.style.display=""},_finishPositioning:function(){this.style.display="none",this.scrollTop=this.scrollTop,this.style.transition=this.style.webkitTransition="",this.style.transform=this.style.webkitTransform="",this.style.display="",this.scrollTop=this.scrollTop},_applyFocus:function(){if(this.opened)this.noAutoFocus||this._focusNode.focus();else{this._focusNode.blur(),this._focusedChild=null,this.restoreFocusOnClose&&this.__restoreFocusNode&&this.__restoreFocusNode.focus(),this.__restoreFocusNode=null;var e=this._manager.currentOverlay();e&&this!==e&&e._applyFocus()}},_onCaptureClick:function(e){this.noCancelOnOutsideClick||this.cancel(e)},_onCaptureFocus:function(e){if(this.withBackdrop){var t=Polymer.dom(e).path;t.indexOf(this)===-1?(e.stopPropagation(),this._applyFocus()):this._focusedChild=t[0]}},_onCaptureEsc:function(e){this.noCancelOnEscKey||this.cancel(e)},_onCaptureTab:function(e){if(this.withBackdrop){this.__ensureFirstLastFocusables();var t=e.shiftKey,i=t?this.__firstFocusableNode:this.__lastFocusableNode,n=t?this.__lastFocusableNode:this.__firstFocusableNode,r=!1;if(i===n)r=!0;else{var o=this._manager.deepActiveElement;r=o===i||o===this}r&&(e.preventDefault(),this._focusedChild=n,this._applyFocus())}},_onIronResize:function(){this.opened&&!this.__isAnimating&&this.__onNextAnimationFrame(this.refit)},_onNodesChange:function(){this.opened&&!this.__isAnimating&&(this.invalidateTabbables(),this.notifyResize())},__ensureFirstLastFocusables:function(){if(!this.__firstFocusableNode||!this.__lastFocusableNode){var e=this._focusableNodes;this.__firstFocusableNode=e[0],this.__lastFocusableNode=e[e.length-1]}},__openedChanged:function(){this.opened?(this._prepareRenderOpened(),this._manager.addOverlay(this),this._applyFocus(),this._renderOpened()):(this._manager.removeOverlay(this),this._applyFocus(),this._renderClosed())},__onNextAnimationFrame:function(e){this.__raf&&window.cancelAnimationFrame(this.__raf);var t=this;this.__raf=window.requestAnimationFrame(function(){t.__raf=null,e.call(t)})}},Polymer.IronOverlayBehavior=[Polymer.IronFitBehavior,Polymer.IronResizableBehavior,Polymer.IronOverlayBehaviorImpl]}(),Polymer.NeonAnimatableBehavior={properties:{animationConfig:{type:Object},entryAnimation:{observer:"_entryAnimationChanged",type:String},exitAnimation:{observer:"_exitAnimationChanged",type:String}},_entryAnimationChanged:function(){this.animationConfig=this.animationConfig||{},this.animationConfig.entry=[{name:this.entryAnimation,node:this}]},_exitAnimationChanged:function(){this.animationConfig=this.animationConfig||{},this.animationConfig.exit=[{name:this.exitAnimation,node:this}]},_copyProperties:function(e,t){for(var i in t)e[i]=t[i]},_cloneConfig:function(e){var t={isClone:!0};return this._copyProperties(t,e),t},_getAnimationConfigRecursive:function(e,t,i){if(this.animationConfig){if(this.animationConfig.value&&"function"==typeof this.animationConfig.value)return void this._warn(this._logf("playAnimation","Please put 'animationConfig' inside of your components 'properties' object instead of outside of it."));var n;if(n=e?this.animationConfig[e]:this.animationConfig,Array.isArray(n)||(n=[n]),n)for(var r,o=0;r=n[o];o++)if(r.animatable)r.animatable._getAnimationConfigRecursive(r.type||e,t,i);else if(r.id){var s=t[r.id];s?(s.isClone||(t[r.id]=this._cloneConfig(s),s=t[r.id]),this._copyProperties(s,r)):t[r.id]=r}else i.push(r)}},getAnimationConfig:function(e){var t={},i=[];this._getAnimationConfigRecursive(e,t,i);for(var n in t)i.push(t[n]);return i}},Polymer.NeonAnimationRunnerBehaviorImpl={_configureAnimations:function(e){var t=[];if(e.length>0)for(var i,n=0;i=e[n];n++){var r=document.createElement(i.name);if(r.isNeonAnimation){var o=null;try{o=r.configure(i),"function"!=typeof o.cancel&&(o=document.timeline.play(o))}catch(e){o=null,console.warn("Couldnt play","(",i.name,").",e)}o&&t.push({neonAnimation:r,config:i,animation:o})}else console.warn(this.is+":",i.name,"not found!")}return t},_shouldComplete:function(e){for(var t=!0,i=0;i<e.length;i++)if("finished"!=e[i].animation.playState){t=!1;break}return t},_complete:function(e){for(var t=0;t<e.length;t++)e[t].neonAnimation.complete(e[t].config);for(var t=0;t<e.length;t++)e[t].animation.cancel()},playAnimation:function(e,t){var i=this.getAnimationConfig(e);if(i){this._active=this._active||{},this._active[e]&&(this._complete(this._active[e]),delete this._active[e]);var n=this._configureAnimations(i);if(0==n.length)return void this.fire("neon-animation-finish",t,{bubbles:!1});this._active[e]=n;for(var r=0;r<n.length;r++)n[r].animation.onfinish=function(){this._shouldComplete(n)&&(this._complete(n),delete this._active[e],this.fire("neon-animation-finish",t,{bubbles:!1}))}.bind(this)}},cancelAnimation:function(){for(var e in this._animations)this._animations[e].cancel();this._animations={}}},Polymer.NeonAnimationRunnerBehavior=[Polymer.NeonAnimatableBehavior,Polymer.NeonAnimationRunnerBehaviorImpl],Polymer.NeonAnimationBehavior={properties:{animationTiming:{type:Object,value:function(){return{duration:500,easing:"cubic-bezier(0.4, 0, 0.2, 1)",fill:"both"}}}},isNeonAnimation:!0,timingFromConfig:function(e){if(e.timing)for(var t in e.timing)this.animationTiming[t]=e.timing[t];return this.animationTiming},setPrefixedProperty:function(e,t,i){for(var n,r={transform:["webkitTransform"],transformOrigin:["mozTransformOrigin","webkitTransformOrigin"]},o=r[t],s=0;n=o[s];s++)e.style[n]=i;e.style[t]=i},complete:function(){}},!function(a,b){var c={},d={},e={},f=null;!function(e,t){function i(e){if("number"==typeof e)return e;var t={};for(var i in e)t[i]=e[i];return t}function n(){this._delay=0,this._endDelay=0,this._fill="none",this._iterationStart=0,this._iterations=1,this._duration=0,this._playbackRate=1,this._direction="normal",this._easing="linear",this._easingFunction=A}function r(){return e.isDeprecated("Invalid timing inputs","2016-03-02","TypeError exceptions will be thrown instead.",!0)}function o(t,i,r){var o=new n;return i&&(o.fill="both",o.duration="auto"),"number"!=typeof t||isNaN(t)?void 0!==t&&Object.getOwnPropertyNames(t).forEach(function(i){if("auto"!=t[i]){if(("number"==typeof o[i]||"duration"==i)&&("number"!=typeof t[i]||isNaN(t[i])))return;if("fill"==i&&x.indexOf(t[i])==-1)return;if("direction"==i&&P.indexOf(t[i])==-1)return;if("playbackRate"==i&&1!==t[i]&&e.isDeprecated("AnimationEffectTiming.playbackRate","2014-11-28","Use Animation.playbackRate instead."))return;o[i]=t[i]}}):o.duration=t,o}function s(e){return"number"==typeof e&&(e=isNaN(e)?{duration:0}:{duration:e}),e}function a(t,i){return t=e.numericTimingToObject(t),o(t,i)}function h(e,t,i,n){return e<0||e>1||i<0||i>1?A:function(r){function o(e,t,i){return 3*e*(1-i)*(1-i)*i+3*t*(1-i)*i*i+i*i*i}if(r<=0){var s=0;return e>0?s=t/e:!t&&i>0&&(s=n/i),s*r}if(r>=1){var a=0;return i<1?a=(n-1)/(i-1):1==i&&e<1&&(a=(t-1)/(e-1)),1+a*(r-1)}for(var h=0,l=1;h<l;){var c=(h+l)/2,u=o(e,i,c);if(Math.abs(r-u)<1e-5)return o(t,n,c);u<r?h=c:l=c}return o(t,n,c)}}function l(e,t){return function(i){if(i>=1)return 1;var n=1/e;return i+=t*n,i-i%n}}function c(e){M||(M=document.createElement("div").style),M.animationTimingFunction="",M.animationTimingFunction=e;var t=M.animationTimingFunction;if(""==t&&r())throw new TypeError(e+" is not a valid value for easing");return t}function u(e){if("linear"==e)return A;var t=w.exec(e);if(t)return h.apply(this,t.slice(1).map(Number));var i=R.exec(e);if(i)return l(Number(i[1]),{start:C,middle:E,end:T}[i[2]]);var n=S[e];return n?n:A}function d(e){return Math.abs(f(e)/e.playbackRate)}function f(e){return 0===e.duration||0===e.iterations?0:e.duration*e.iterations}function p(e,t,i){if(null==t)return D;var n=i.delay+e+i.endDelay;return t<Math.min(i.delay,n)?O:t>=Math.min(i.delay+e,n)?L:B}function _(e,t,i,n,r){switch(n){case O:return"backwards"==t||"both"==t?0:null;case B:return i-r;case L:return"forwards"==t||"both"==t?e:null;case D:return null}}function m(e,t,i,n,r){var o=r;return 0===e?t!==O&&(o+=i):o+=n/e,o}function g(e,t,i,n,r,o){var s=e===1/0?t%1:e%1;return 0!==s||i!==L||0===n||0===r&&0!==o||(s=1),s}function v(e,t,i,n){return e===L&&t===1/0?1/0:1===i?Math.floor(n)-1:Math.floor(n)}function y(e,t,i){var n=e;if("normal"!==e&&"reverse"!==e){var r=t;"alternate-reverse"===e&&(r+=1),n="normal",r!==1/0&&r%2!==0&&(n="reverse")}return"normal"===n?i:1-i}function b(e,t,i){var n=p(e,t,i),r=_(e,i.fill,t,n,i.delay);if(null===r)return null;var o=m(i.duration,n,i.iterations,r,i.iterationStart),s=g(o,i.iterationStart,n,i.iterations,r,i.duration),a=v(n,i.iterations,s,o),h=y(i.direction,a,s);return i._easingFunction(h)}var x="backwards|forwards|both|none".split("|"),P="reverse|alternate|alternate-reverse".split("|"),A=function(e){return e};n.prototype={_setMember:function(t,i){this["_"+t]=i,this._effect&&(this._effect._timingInput[t]=i,this._effect._timing=e.normalizeTimingInput(this._effect._timingInput),this._effect.activeDuration=e.calculateActiveDuration(this._effect._timing),this._effect._animation&&this._effect._animation._rebuildUnderlyingAnimation())},get playbackRate(){return this._playbackRate;
},set delay(e){this._setMember("delay",e)},get delay(){return this._delay},set endDelay(e){this._setMember("endDelay",e)},get endDelay(){return this._endDelay},set fill(e){this._setMember("fill",e)},get fill(){return this._fill},set iterationStart(e){if((isNaN(e)||e<0)&&r())throw new TypeError("iterationStart must be a non-negative number, received: "+timing.iterationStart);this._setMember("iterationStart",e)},get iterationStart(){return this._iterationStart},set duration(e){if("auto"!=e&&(isNaN(e)||e<0)&&r())throw new TypeError("duration must be non-negative or auto, received: "+e);this._setMember("duration",e)},get duration(){return this._duration},set direction(e){this._setMember("direction",e)},get direction(){return this._direction},set easing(e){this._easingFunction=u(c(e)),this._setMember("easing",e)},get easing(){return this._easing},set iterations(e){if((isNaN(e)||e<0)&&r())throw new TypeError("iterations must be non-negative, received: "+e);this._setMember("iterations",e)},get iterations(){return this._iterations}};var C=1,E=.5,T=0,S={ease:h(.25,.1,.25,1),"ease-in":h(.42,0,1,1),"ease-out":h(0,0,.58,1),"ease-in-out":h(.42,0,.58,1),"step-start":l(1,C),"step-middle":l(1,E),"step-end":l(1,T)},M=null,I="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",w=new RegExp("cubic-bezier\\("+I+","+I+","+I+","+I+"\\)"),R=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/,D=0,O=1,L=2,B=3;e.cloneTimingInput=i,e.makeTiming=o,e.numericTimingToObject=s,e.normalizeTimingInput=a,e.calculateActiveDuration=d,e.calculateIterationProgress=b,e.calculatePhase=p,e.normalizeEasing=c,e.parseEasingFunction=u}(c,f),function(e,t){function i(e,t){return e in c?c[e][t]||t:t}function n(e){return"display"===e||0===e.lastIndexOf("animation",0)||0===e.lastIndexOf("transition",0)}function r(e,t,r){if(!n(e)){var o=a[e];if(o){h.style[e]=t;for(var s in o){var l=o[s],c=h.style[l];r[l]=i(l,c)}}else r[e]=i(e,t)}}function o(e){var t=[];for(var i in e)if(!(i in["easing","offset","composite"])){var n=e[i];Array.isArray(n)||(n=[n]);for(var r,o=n.length,s=0;s<o;s++)r={},"offset"in e?r.offset=e.offset:1==o?r.offset=1:r.offset=s/(o-1),"easing"in e&&(r.easing=e.easing),"composite"in e&&(r.composite=e.composite),r[i]=n[s],t.push(r)}return t.sort(function(e,t){return e.offset-t.offset}),t}function s(t){function i(){var e=n.length;null==n[e-1].offset&&(n[e-1].offset=1),e>1&&null==n[0].offset&&(n[0].offset=0);for(var t=0,i=n[0].offset,r=1;r<e;r++){var o=n[r].offset;if(null!=o){for(var s=1;s<r-t;s++)n[t+s].offset=i+(o-i)*s/(r-t);t=r,i=o}}}if(null==t)return[];window.Symbol&&Symbol.iterator&&Array.prototype.from&&t[Symbol.iterator]&&(t=Array.from(t)),Array.isArray(t)||(t=o(t));for(var n=t.map(function(t){var i={};for(var n in t){var o=t[n];if("offset"==n){if(null!=o){if(o=Number(o),!isFinite(o))throw new TypeError("Keyframe offsets must be numbers.");if(o<0||o>1)throw new TypeError("Keyframe offsets must be between 0 and 1.")}}else if("composite"==n){if("add"==o||"accumulate"==o)throw{type:DOMException.NOT_SUPPORTED_ERR,name:"NotSupportedError",message:"add compositing is not supported"};if("replace"!=o)throw new TypeError("Invalid composite mode "+o+".")}else o="easing"==n?e.normalizeEasing(o):""+o;r(n,o,i)}return void 0==i.offset&&(i.offset=null),void 0==i.easing&&(i.easing="linear"),i}),s=!0,a=-(1/0),h=0;h<n.length;h++){var l=n[h].offset;if(null!=l){if(l<a)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");a=l}else s=!1}return n=n.filter(function(e){return e.offset>=0&&e.offset<=1}),s||i(),n}var a={background:["backgroundImage","backgroundPosition","backgroundSize","backgroundRepeat","backgroundAttachment","backgroundOrigin","backgroundClip","backgroundColor"],border:["borderTopColor","borderTopStyle","borderTopWidth","borderRightColor","borderRightStyle","borderRightWidth","borderBottomColor","borderBottomStyle","borderBottomWidth","borderLeftColor","borderLeftStyle","borderLeftWidth"],borderBottom:["borderBottomWidth","borderBottomStyle","borderBottomColor"],borderColor:["borderTopColor","borderRightColor","borderBottomColor","borderLeftColor"],borderLeft:["borderLeftWidth","borderLeftStyle","borderLeftColor"],borderRadius:["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],borderRight:["borderRightWidth","borderRightStyle","borderRightColor"],borderTop:["borderTopWidth","borderTopStyle","borderTopColor"],borderWidth:["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],flex:["flexGrow","flexShrink","flexBasis"],font:["fontFamily","fontSize","fontStyle","fontVariant","fontWeight","lineHeight"],margin:["marginTop","marginRight","marginBottom","marginLeft"],outline:["outlineColor","outlineStyle","outlineWidth"],padding:["paddingTop","paddingRight","paddingBottom","paddingLeft"]},h=document.createElementNS("http://www.w3.org/1999/xhtml","div"),l={thin:"1px",medium:"3px",thick:"5px"},c={borderBottomWidth:l,borderLeftWidth:l,borderRightWidth:l,borderTopWidth:l,fontSize:{"xx-small":"60%","x-small":"75%",small:"89%",medium:"100%",large:"120%","x-large":"150%","xx-large":"200%"},fontWeight:{normal:"400",bold:"700"},outlineWidth:l,textShadow:{none:"0px 0px 0px transparent"},boxShadow:{none:"0px 0px 0px 0px transparent"}};e.convertToArrayForm=o,e.normalizeKeyframes=s}(c,f),function(e){var t={};e.isDeprecated=function(e,i,n,r){var o=r?"are":"is",s=new Date,a=new Date(i);return a.setMonth(a.getMonth()+3),!(s<a&&(e in t||console.warn("Web Animations: "+e+" "+o+" deprecated and will stop working on "+a.toDateString()+". "+n),t[e]=!0,1))},e.deprecated=function(t,i,n,r){var o=r?"are":"is";if(e.isDeprecated(t,i,n,r))throw new Error(t+" "+o+" no longer supported. "+n)}}(c),function(){if(document.documentElement.animate){var a=document.documentElement.animate([],0),b=!0;if(a&&(b=!1,"play|currentTime|pause|reverse|playbackRate|cancel|finish|startTime|playState".split("|").forEach(function(e){void 0===a[e]&&(b=!0)})),!b)return}!function(e,t,i){function n(e){for(var t={},i=0;i<e.length;i++)for(var n in e[i])if("offset"!=n&&"easing"!=n&&"composite"!=n){var r={offset:e[i].offset,easing:e[i].easing,value:e[i][n]};t[n]=t[n]||[],t[n].push(r)}for(var o in t){var s=t[o];if(0!=s[0].offset||1!=s[s.length-1].offset)throw{type:DOMException.NOT_SUPPORTED_ERR,name:"NotSupportedError",message:"Partial keyframes are not supported"}}return t}function r(i){var n=[];for(var r in i)for(var o=i[r],s=0;s<o.length-1;s++){var a=s,h=s+1,l=o[a].offset,c=o[h].offset,u=l,d=c;0==s&&(u=-(1/0),0==c&&(h=a)),s==o.length-2&&(d=1/0,1==l&&(a=h)),n.push({applyFrom:u,applyTo:d,startOffset:o[a].offset,endOffset:o[h].offset,easingFunction:e.parseEasingFunction(o[a].easing),property:r,interpolation:t.propertyInterpolation(r,o[a].value,o[h].value)})}return n.sort(function(e,t){return e.startOffset-t.startOffset}),n}t.convertEffectInput=function(i){var o=e.normalizeKeyframes(i),s=n(o),a=r(s);return function(e,i){if(null!=i)a.filter(function(e){return i>=e.applyFrom&&i<e.applyTo}).forEach(function(n){var r=i-n.startOffset,o=n.endOffset-n.startOffset,s=0==o?0:n.easingFunction(r/o);t.apply(e,n.property,n.interpolation(s))});else for(var n in s)"offset"!=n&&"easing"!=n&&"composite"!=n&&t.clear(e,n)}}}(c,d,f),function(e,t,i){function n(e){return e.replace(/-(.)/g,function(e,t){return t.toUpperCase()})}function r(e,t,i){a[i]=a[i]||[],a[i].push([e,t])}function o(e,t,i){for(var o=0;o<i.length;o++){var s=i[o];r(e,t,n(s))}}function s(i,r,o){var s=i;/-/.test(i)&&!e.isDeprecated("Hyphenated property names","2016-03-22","Use camelCase instead.",!0)&&(s=n(i)),"initial"!=r&&"initial"!=o||("initial"==r&&(r=h[s]),"initial"==o&&(o=h[s]));for(var l=r==o?[]:a[s],c=0;l&&c<l.length;c++){var u=l[c][0](r),d=l[c][0](o);if(void 0!==u&&void 0!==d){var f=l[c][1](u,d);if(f){var p=t.Interpolation.apply(null,f);return function(e){return 0==e?r:1==e?o:p(e)}}}}return t.Interpolation(!1,!0,function(e){return e?o:r})}var a={};t.addPropertiesHandler=o;var h={backgroundColor:"transparent",backgroundPosition:"0% 0%",borderBottomColor:"currentColor",borderBottomLeftRadius:"0px",borderBottomRightRadius:"0px",borderBottomWidth:"3px",borderLeftColor:"currentColor",borderLeftWidth:"3px",borderRightColor:"currentColor",borderRightWidth:"3px",borderSpacing:"2px",borderTopColor:"currentColor",borderTopLeftRadius:"0px",borderTopRightRadius:"0px",borderTopWidth:"3px",bottom:"auto",clip:"rect(0px, 0px, 0px, 0px)",color:"black",fontSize:"100%",fontWeight:"400",height:"auto",left:"auto",letterSpacing:"normal",lineHeight:"120%",marginBottom:"0px",marginLeft:"0px",marginRight:"0px",marginTop:"0px",maxHeight:"none",maxWidth:"none",minHeight:"0px",minWidth:"0px",opacity:"1.0",outlineColor:"invert",outlineOffset:"0px",outlineWidth:"3px",paddingBottom:"0px",paddingLeft:"0px",paddingRight:"0px",paddingTop:"0px",right:"auto",textIndent:"0px",textShadow:"0px 0px 0px transparent",top:"auto",transform:"",verticalAlign:"0px",visibility:"visible",width:"auto",wordSpacing:"normal",zIndex:"auto"};t.propertyInterpolation=s}(c,d,f),function(e,t,i){function n(t){var i=e.calculateActiveDuration(t),n=function(n){return e.calculateIterationProgress(i,n,t)};return n._totalDuration=t.delay+i+t.endDelay,n}t.KeyframeEffect=function(i,r,o,s){var a,h=n(e.normalizeTimingInput(o)),l=t.convertEffectInput(r),c=function(){l(i,a)};return c._update=function(e){return a=h(e),null!==a},c._clear=function(){l(i,null)},c._hasSameTarget=function(e){return i===e},c._target=i,c._totalDuration=h._totalDuration,c._id=s,c},t.NullEffect=function(e){var t=function(){e&&(e(),e=null)};return t._update=function(){return null},t._totalDuration=0,t._hasSameTarget=function(){return!1},t}}(c,d,f),function(e,t){e.apply=function(t,i,n){t.style[e.propertyName(i)]=n},e.clear=function(t,i){t.style[e.propertyName(i)]=""}}(d,f),function(e){window.Element.prototype.animate=function(t,i){var n="";return i&&i.id&&(n=i.id),e.timeline._play(e.KeyframeEffect(this,t,i,n))}}(d),function(e,t){function i(e,t,n){if("number"==typeof e&&"number"==typeof t)return e*(1-n)+t*n;if("boolean"==typeof e&&"boolean"==typeof t)return n<.5?e:t;if(e.length==t.length){for(var r=[],o=0;o<e.length;o++)r.push(i(e[o],t[o],n));return r}throw"Mismatched interpolation arguments "+e+":"+t}e.Interpolation=function(e,t,n){return function(r){return n(i(e,t,r))}}}(d,f),function(e,t,i){e.sequenceNumber=0;var n=function(e,t,i){this.target=e,this.currentTime=t,this.timelineTime=i,this.type="finish",this.bubbles=!1,this.cancelable=!1,this.currentTarget=e,this.defaultPrevented=!1,this.eventPhase=Event.AT_TARGET,this.timeStamp=Date.now()};t.Animation=function(t){this.id="",t&&t._id&&(this.id=t._id),this._sequenceNumber=e.sequenceNumber++,this._currentTime=0,this._startTime=null,this._paused=!1,this._playbackRate=1,this._inTimeline=!0,this._finishedFlag=!0,this.onfinish=null,this._finishHandlers=[],this._effect=t,this._inEffect=this._effect._update(0),this._idle=!0,this._currentTimePending=!1},t.Animation.prototype={_ensureAlive:function(){this.playbackRate<0&&0===this.currentTime?this._inEffect=this._effect._update(-1):this._inEffect=this._effect._update(this.currentTime),this._inTimeline||!this._inEffect&&this._finishedFlag||(this._inTimeline=!0,t.timeline._animations.push(this))},_tickCurrentTime:function(e,t){e!=this._currentTime&&(this._currentTime=e,this._isFinished&&!t&&(this._currentTime=this._playbackRate>0?this._totalDuration:0),this._ensureAlive())},get currentTime(){return this._idle||this._currentTimePending?null:this._currentTime},set currentTime(e){e=+e,isNaN(e)||(t.restart(),this._paused||null==this._startTime||(this._startTime=this._timeline.currentTime-e/this._playbackRate),this._currentTimePending=!1,this._currentTime!=e&&(this._idle&&(this._idle=!1,this._paused=!0),this._tickCurrentTime(e,!0),t.applyDirtiedAnimation(this)))},get startTime(){return this._startTime},set startTime(e){e=+e,isNaN(e)||this._paused||this._idle||(this._startTime=e,this._tickCurrentTime((this._timeline.currentTime-this._startTime)*this.playbackRate),t.applyDirtiedAnimation(this))},get playbackRate(){return this._playbackRate},set playbackRate(e){if(e!=this._playbackRate){var i=this.currentTime;this._playbackRate=e,this._startTime=null,"paused"!=this.playState&&"idle"!=this.playState&&(this._finishedFlag=!1,this._idle=!1,this._ensureAlive(),t.applyDirtiedAnimation(this)),null!=i&&(this.currentTime=i)}},get _isFinished(){return!this._idle&&(this._playbackRate>0&&this._currentTime>=this._totalDuration||this._playbackRate<0&&this._currentTime<=0)},get _totalDuration(){return this._effect._totalDuration},get playState(){return this._idle?"idle":null==this._startTime&&!this._paused&&0!=this.playbackRate||this._currentTimePending?"pending":this._paused?"paused":this._isFinished?"finished":"running"},_rewind:function(){if(this._playbackRate>=0)this._currentTime=0;else{if(!(this._totalDuration<1/0))throw new DOMException("Unable to rewind negative playback rate animation with infinite duration","InvalidStateError");this._currentTime=this._totalDuration}},play:function(){this._paused=!1,(this._isFinished||this._idle)&&(this._rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this._ensureAlive(),t.applyDirtiedAnimation(this)},pause:function(){this._isFinished||this._paused||this._idle?this._idle&&(this._rewind(),this._idle=!1):this._currentTimePending=!0,this._startTime=null,this._paused=!0},finish:function(){this._idle||(this.currentTime=this._playbackRate>0?this._totalDuration:0,this._startTime=this._totalDuration-this.currentTime,this._currentTimePending=!1,t.applyDirtiedAnimation(this))},cancel:function(){this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._isFinished=!0,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this._effect._update(null),t.applyDirtiedAnimation(this))},reverse:function(){this.playbackRate*=-1,this.play()},addEventListener:function(e,t){"function"==typeof t&&"finish"==e&&this._finishHandlers.push(t)},removeEventListener:function(e,t){if("finish"==e){var i=this._finishHandlers.indexOf(t);i>=0&&this._finishHandlers.splice(i,1)}},_fireEvents:function(e){if(this._isFinished){if(!this._finishedFlag){var t=new n(this,this._currentTime,e),i=this._finishHandlers.concat(this.onfinish?[this.onfinish]:[]);setTimeout(function(){i.forEach(function(e){e.call(t.target,t)})},0),this._finishedFlag=!0}}else this._finishedFlag=!1},_tick:function(e,t){this._idle||this._paused||(null==this._startTime?t&&(this.startTime=e-this._currentTime/this.playbackRate):this._isFinished||this._tickCurrentTime((e-this._startTime)*this.playbackRate)),t&&(this._currentTimePending=!1,this._fireEvents(e))},get _needsTick(){return this.playState in{pending:1,running:1}||!this._finishedFlag},_targetAnimations:function(){var e=this._effect._target;return e._activeAnimations||(e._activeAnimations=[]),e._activeAnimations},_markTarget:function(){var e=this._targetAnimations();e.indexOf(this)===-1&&e.push(this)},_unmarkTarget:function(){var e=this._targetAnimations(),t=e.indexOf(this);t!==-1&&e.splice(t,1)}}}(c,d,f),function(e,t,i){function n(e){var t=l;l=[],e<m.currentTime&&(e=m.currentTime),m._animations.sort(r),m._animations=a(e,!0,m._animations)[0],t.forEach(function(t){t[1](e)}),s(),u=void 0}function r(e,t){return e._sequenceNumber-t._sequenceNumber}function o(){this._animations=[],this.currentTime=window.performance&&performance.now?performance.now():0}function s(){p.forEach(function(e){e()}),p.length=0}function a(e,i,n){_=!0,f=!1;var r=t.timeline;r.currentTime=e,d=!1;var o=[],s=[],a=[],h=[];return n.forEach(function(t){t._tick(e,i),t._inEffect?(s.push(t._effect),t._markTarget()):(o.push(t._effect),t._unmarkTarget()),t._needsTick&&(d=!0);var n=t._inEffect||t._needsTick;t._inTimeline=n,n?a.push(t):h.push(t)}),p.push.apply(p,o),p.push.apply(p,s),d&&requestAnimationFrame(function(){}),_=!1,[a,h]}var h=window.requestAnimationFrame,l=[],c=0;window.requestAnimationFrame=function(e){var t=c++;return 0==l.length&&h(n),l.push([t,e]),t},window.cancelAnimationFrame=function(e){l.forEach(function(t){t[0]==e&&(t[1]=function(){})})},o.prototype={_play:function(i){i._timing=e.normalizeTimingInput(i.timing);var n=new t.Animation(i);return n._idle=!1,n._timeline=this,this._animations.push(n),t.restart(),t.applyDirtiedAnimation(n),n}};var u=void 0,d=!1,f=!1;t.restart=function(){return d||(d=!0,requestAnimationFrame(function(){}),f=!0),f},t.applyDirtiedAnimation=function(e){if(!_){e._markTarget();var i=e._targetAnimations();i.sort(r);var n=a(t.timeline.currentTime,!1,i.slice())[1];n.forEach(function(e){var t=m._animations.indexOf(e);t!==-1&&m._animations.splice(t,1)}),s()}};var p=[],_=!1,m=new o;t.timeline=m}(c,d,f),function(e){function t(e,t){var i=e.exec(t);if(i)return i=e.ignoreCase?i[0].toLowerCase():i[0],[i,t.substr(i.length)]}function i(e,t){t=t.replace(/^\s*/,"");var i=e(t);if(i)return[i[0],i[1].replace(/^\s*/,"")]}function n(e,n,r){e=i.bind(null,e);for(var o=[];;){var s=e(r);if(!s)return[o,r];if(o.push(s[0]),r=s[1],s=t(n,r),!s||""==s[1])return[o,r];r=s[1]}}function r(e,t){for(var i=0,n=0;n<t.length&&(!/\s|,/.test(t[n])||0!=i);n++)if("("==t[n])i++;else if(")"==t[n]&&(i--,0==i&&n++,i<=0))break;var r=e(t.substr(0,n));return void 0==r?void 0:[r,t.substr(n)]}function o(e,t){for(var i=e,n=t;i&&n;)i>n?i%=n:n%=i;return i=e*t/(i+n)}function s(e){return function(t){var i=e(t);return i&&(i[0]=void 0),i}}function a(e,t){return function(i){var n=e(i);return n?n:[t,i]}}function h(t,i){for(var n=[],r=0;r<t.length;r++){var o=e.consumeTrimmed(t[r],i);if(!o||""==o[0])return;void 0!==o[0]&&n.push(o[0]),i=o[1]}if(""==i)return n}function l(e,t,i,n,r){for(var s=[],a=[],h=[],l=o(n.length,r.length),c=0;c<l;c++){var u=t(n[c%n.length],r[c%r.length]);if(!u)return;s.push(u[0]),a.push(u[1]),h.push(u[2])}return[s,a,function(t){var n=t.map(function(e,t){return h[t](e)}).join(i);return e?e(n):n}]}function c(e,t,i){for(var n=[],r=[],o=[],s=0,a=0;a<i.length;a++)if("function"==typeof i[a]){var h=i[a](e[s],t[s++]);n.push(h[0]),r.push(h[1]),o.push(h[2])}else!function(e){n.push(!1),r.push(!1),o.push(function(){return i[e]})}(a);return[n,r,function(e){for(var t="",i=0;i<e.length;i++)t+=o[i](e[i]);return t}]}e.consumeToken=t,e.consumeTrimmed=i,e.consumeRepeated=n,e.consumeParenthesised=r,e.ignore=s,e.optional=a,e.consumeList=h,e.mergeNestedRepeated=l.bind(null,null),e.mergeWrappedNestedRepeated=l,e.mergeList=c}(d),function(e){function t(t){function i(t){var i=e.consumeToken(/^inset/i,t);if(i)return n.inset=!0,i;var i=e.consumeLengthOrPercent(t);if(i)return n.lengths.push(i[0]),i;var i=e.consumeColor(t);return i?(n.color=i[0],i):void 0}var n={inset:!1,lengths:[],color:null},r=e.consumeRepeated(i,/^/,t);if(r&&r[0].length)return[n,r[1]]}function i(i){var n=e.consumeRepeated(t,/^,/,i);if(n&&""==n[1])return n[0]}function n(t,i){for(;t.lengths.length<Math.max(t.lengths.length,i.lengths.length);)t.lengths.push({px:0});for(;i.lengths.length<Math.max(t.lengths.length,i.lengths.length);)i.lengths.push({px:0});if(t.inset==i.inset&&!!t.color==!!i.color){for(var n,r=[],o=[[],0],s=[[],0],a=0;a<t.lengths.length;a++){var h=e.mergeDimensions(t.lengths[a],i.lengths[a],2==a);o[0].push(h[0]),s[0].push(h[1]),r.push(h[2])}if(t.color&&i.color){var l=e.mergeColors(t.color,i.color);o[1]=l[0],s[1]=l[1],n=l[2]}return[o,s,function(e){for(var i=t.inset?"inset ":" ",o=0;o<r.length;o++)i+=r[o](e[0][o])+" ";return n&&(i+=n(e[1])),i}]}}function r(t,i,n,r){function o(e){return{inset:e,color:[0,0,0,0],lengths:[{px:0},{px:0},{px:0},{px:0}]}}for(var s=[],a=[],h=0;h<n.length||h<r.length;h++){var l=n[h]||o(r[h].inset),c=r[h]||o(n[h].inset);s.push(l),a.push(c)}return e.mergeNestedRepeated(t,i,s,a)}var o=r.bind(null,n,", ");e.addPropertiesHandler(i,o,["box-shadow","text-shadow"])}(d),function(e,t){function i(e){return e.toFixed(3).replace(".000","")}function n(e,t,i){return Math.min(t,Math.max(e,i))}function r(e){if(/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e))return Number(e)}function o(e,t){return[e,t,i]}function s(e,t){if(0!=e)return h(0,1/0)(e,t)}function a(e,t){return[e,t,function(e){return Math.round(n(1,1/0,e))}]}function h(e,t){return function(r,o){return[r,o,function(r){return i(n(e,t,r))}]}}function l(e,t){return[e,t,Math.round]}e.clamp=n,e.addPropertiesHandler(r,h(0,1/0),["border-image-width","line-height"]),e.addPropertiesHandler(r,h(0,1),["opacity","shape-image-threshold"]),e.addPropertiesHandler(r,s,["flex-grow","flex-shrink"]),e.addPropertiesHandler(r,a,["orphans","widows"]),e.addPropertiesHandler(r,l,["z-index"]),e.parseNumber=r,e.mergeNumbers=o,e.numberToString=i}(d,f),function(e,t){function i(e,t){if("visible"==e||"visible"==t)return[0,1,function(i){return i<=0?e:i>=1?t:"visible"}]}e.addPropertiesHandler(String,i,["visibility"])}(d),function(e,t){function i(e){e=e.trim(),o.fillStyle="#000",o.fillStyle=e;var t=o.fillStyle;if(o.fillStyle="#fff",o.fillStyle=e,t==o.fillStyle){o.fillRect(0,0,1,1);var i=o.getImageData(0,0,1,1).data;o.clearRect(0,0,1,1);var n=i[3]/255;return[i[0]*n,i[1]*n,i[2]*n,n]}}function n(t,i){return[t,i,function(t){function i(e){return Math.max(0,Math.min(255,e))}if(t[3])for(var n=0;n<3;n++)t[n]=Math.round(i(t[n]/t[3]));return t[3]=e.numberToString(e.clamp(0,1,t[3])),"rgba("+t.join(",")+")"}]}var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=r.height=1;var o=r.getContext("2d");e.addPropertiesHandler(i,n,["background-color","border-bottom-color","border-left-color","border-right-color","border-top-color","color","outline-color","text-decoration-color"]),e.consumeColor=e.consumeParenthesised.bind(null,i),e.mergeColors=n}(d,f),function(a,b){function c(a,b){if(b=b.trim().toLowerCase(),"0"==b&&"px".search(a)>=0)return{px:0};if(/^[^(]*$|^calc/.test(b)){b=b.replace(/calc\(/g,"(");var c={};b=b.replace(a,function(e){return c[e]=null,"U"+e});for(var d="U("+a.source+")",e=b.replace(/[-+]?(\d*\.)?\d+/g,"N").replace(new RegExp("N"+d,"g"),"D").replace(/\s[+-]\s/g,"O").replace(/\s/g,""),f=[/N\*(D)/g,/(N|D)[*\/]N/g,/(N|D)O\1/g,/\((N|D)\)/g],g=0;g<f.length;)f[g].test(e)?(e=e.replace(f[g],"$1"),g=0):g++;if("D"==e){for(var h in c){var i=eval(b.replace(new RegExp("U"+h,"g"),"").replace(new RegExp(d,"g"),"*0"));if(!isFinite(i))return;c[h]=i}return c}}}function d(t,i){return e(t,i,!0)}function e(e,t,i){var n,r=[];for(n in e)r.push(n);for(n in t)r.indexOf(n)<0&&r.push(n);return e=r.map(function(t){return e[t]||0}),t=r.map(function(e){return t[e]||0}),[e,t,function(e){var t=e.map(function(t,n){return 1==e.length&&i&&(t=Math.max(t,0)),a.numberToString(t)+r[n]}).join(" + ");return e.length>1?"calc("+t+")":t}]}var f="px|em|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc",g=c.bind(null,new RegExp(f,"g")),h=c.bind(null,new RegExp(f+"|%","g")),i=c.bind(null,/deg|rad|grad|turn/g);a.parseLength=g,a.parseLengthOrPercent=h,a.consumeLengthOrPercent=a.consumeParenthesised.bind(null,h),a.parseAngle=i,a.mergeDimensions=e;var j=a.consumeParenthesised.bind(null,g),k=a.consumeRepeated.bind(void 0,j,/^/),l=a.consumeRepeated.bind(void 0,k,/^,/);a.consumeSizePairList=l;var m=function(e){var t=l(e);if(t&&""==t[1])return t[0]},n=a.mergeNestedRepeated.bind(void 0,d," "),o=a.mergeNestedRepeated.bind(void 0,n,",");a.mergeNonNegativeSizePair=n,a.addPropertiesHandler(m,o,["background-size"]),a.addPropertiesHandler(h,d,["border-bottom-width","border-image-width","border-left-width","border-right-width","border-top-width","flex-basis","font-size","height","line-height","max-height","max-width","outline-width","width"]),a.addPropertiesHandler(h,e,["border-bottom-left-radius","border-bottom-right-radius","border-top-left-radius","border-top-right-radius","bottom","left","letter-spacing","margin-bottom","margin-left","margin-right","margin-top","min-height","min-width","outline-offset","padding-bottom","padding-left","padding-right","padding-top","perspective","right","shape-margin","text-indent","top","vertical-align","word-spacing"])}(d,f),function(e,t){function i(t){return e.consumeLengthOrPercent(t)||e.consumeToken(/^auto/,t)}function n(t){var n=e.consumeList([e.ignore(e.consumeToken.bind(null,/^rect/)),e.ignore(e.consumeToken.bind(null,/^\(/)),e.consumeRepeated.bind(null,i,/^,/),e.ignore(e.consumeToken.bind(null,/^\)/))],t);if(n&&4==n[0].length)return n[0]}function r(t,i){return"auto"==t||"auto"==i?[!0,!1,function(n){var r=n?t:i;if("auto"==r)return"auto";var o=e.mergeDimensions(r,r);return o[2](o[0])}]:e.mergeDimensions(t,i)}function o(e){return"rect("+e+")"}var s=e.mergeWrappedNestedRepeated.bind(null,o,r,", ");e.parseBox=n,e.mergeBoxes=s,e.addPropertiesHandler(n,s,["clip"])}(d,f),function(e,t){function i(e){return function(t){var i=0;return e.map(function(e){return e===c?t[i++]:e})}}function n(e){return e}function r(t){if(t=t.toLowerCase().trim(),"none"==t)return[];for(var i,n=/\s*(\w+)\(([^)]*)\)/g,r=[],o=0;i=n.exec(t);){if(i.index!=o)return;o=i.index+i[0].length;var s=i[1],a=f[s];if(!a)return;var h=i[2].split(","),l=a[0];if(l.length<h.length)return;for(var c=[],p=0;p<l.length;p++){var _,m=h[p],g=l[p];if(_=m?{A:function(t){return"0"==t.trim()?d:e.parseAngle(t)},N:e.parseNumber,T:e.parseLengthOrPercent,L:e.parseLength}[g.toUpperCase()](m):{a:d,n:c[0],t:u}[g],void 0===_)return;c.push(_)}if(r.push({t:s,d:c}),n.lastIndex==t.length)return r}}function o(e){return e.toFixed(6).replace(".000000","")}function s(t,i){if(t.decompositionPair!==i){t.decompositionPair=i;var n=e.makeMatrixDecomposition(t)}if(i.decompositionPair!==t){i.decompositionPair=t;var r=e.makeMatrixDecomposition(i)}return null==n[0]||null==r[0]?[[!1],[!0],function(e){return e?i[0].d:t[0].d}]:(n[0].push(0),r[0].push(1),[n,r,function(t){var i=e.quat(n[0][3],r[0][3],t[5]),s=e.composeMatrix(t[0],t[1],t[2],i,t[4]),a=s.map(o).join(",");return a}])}function a(e){return e.replace(/[xy]/,"")}function h(e){return e.replace(/(x|y|z|3d)?$/,"3d")}function l(t,i){var n=e.makeMatrixDecomposition&&!0,r=!1;if(!t.length||!i.length){t.length||(r=!0,t=i,i=[]);for(var o=0;o<t.length;o++){var l=t[o].t,c=t[o].d,u="scale"==l.substr(0,5)?1:0;i.push({t:l,d:c.map(function(e){if("number"==typeof e)return u;var t={};for(var i in e)t[i]=u;return t})})}}var d=function(e,t){return"perspective"==e&&"perspective"==t||("matrix"==e||"matrix3d"==e)&&("matrix"==t||"matrix3d"==t)},p=[],_=[],m=[];if(t.length!=i.length){if(!n)return;var g=s(t,i);p=[g[0]],_=[g[1]],m=[["matrix",[g[2]]]]}else for(var o=0;o<t.length;o++){var l,v=t[o].t,y=i[o].t,b=t[o].d,x=i[o].d,P=f[v],A=f[y];if(d(v,y)){if(!n)return;var g=s([t[o]],[i[o]]);p.push(g[0]),_.push(g[1]),m.push(["matrix",[g[2]]])}else{if(v==y)l=v;else if(P[2]&&A[2]&&a(v)==a(y))l=a(v),b=P[2](b),x=A[2](x);else{if(!P[1]||!A[1]||h(v)!=h(y)){if(!n)return;var g=s(t,i);p=[g[0]],_=[g[1]],m=[["matrix",[g[2]]]];break}l=h(v),b=P[1](b),x=A[1](x)}for(var C=[],E=[],T=[],S=0;S<b.length;S++){var M="number"==typeof b[S]?e.mergeNumbers:e.mergeDimensions,g=M(b[S],x[S]);C[S]=g[0],E[S]=g[1],T.push(g[2])}p.push(C),_.push(E),m.push([l,T])}}if(r){var I=p;p=_,_=I}return[p,_,function(e){return e.map(function(e,t){var i=e.map(function(e,i){return m[t][1][i](e)}).join(",");return"matrix"==m[t][0]&&16==i.split(",").length&&(m[t][0]="matrix3d"),m[t][0]+"("+i+")"}).join(" ")}]}var c=null,u={px:0},d={deg:0},f={matrix:["NNNNNN",[c,c,0,0,c,c,0,0,0,0,1,0,c,c,0,1],n],matrix3d:["NNNNNNNNNNNNNNNN",n],rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",i([c,c,1]),n],scalex:["N",i([c,1,1]),i([c,1])],scaley:["N",i([1,c,1]),i([1,c])],scalez:["N",i([1,1,c])],scale3d:["NNN",n],skew:["Aa",null,n],skewx:["A",null,i([c,d])],skewy:["A",null,i([d,c])],translate:["Tt",i([c,c,u]),n],translatex:["T",i([c,u,u]),i([c,u])],translatey:["T",i([u,c,u]),i([u,c])],translatez:["L",i([u,u,c])],translate3d:["TTL",n]};e.addPropertiesHandler(r,l,["transform"])}(d,f),function(e,t){function i(e,t){t.concat([e]).forEach(function(t){t in document.documentElement.style&&(n[e]=t)})}var n={};i("transform",["webkitTransform","msTransform"]),i("transformOrigin",["webkitTransformOrigin"]),i("perspective",["webkitPerspective"]),i("perspectiveOrigin",["webkitPerspectiveOrigin"]),e.propertyName=function(e){return n[e]||e}}(d,f)}(),!function(){if(void 0===document.createElement("div").animate([]).oncancel){var e;if(window.performance&&performance.now)var e=function(){return performance.now()};else var e=function(){return Date.now()};var t=function(e,t,i){this.target=e,this.currentTime=t,this.timelineTime=i,this.type="cancel",this.bubbles=!1,this.cancelable=!1,this.currentTarget=e,this.defaultPrevented=!1,this.eventPhase=Event.AT_TARGET,this.timeStamp=Date.now()},i=window.Element.prototype.animate;window.Element.prototype.animate=function(n,r){var o=i.call(this,n,r);o._cancelHandlers=[],o.oncancel=null;var s=o.cancel;o.cancel=function(){s.call(this);var i=new t(this,null,e()),n=this._cancelHandlers.concat(this.oncancel?[this.oncancel]:[]);setTimeout(function(){n.forEach(function(e){e.call(i.target,i)})},0)};var a=o.addEventListener;o.addEventListener=function(e,t){"function"==typeof t&&"cancel"==e?this._cancelHandlers.push(t):a.call(this,e,t)};var h=o.removeEventListener;return o.removeEventListener=function(e,t){if("cancel"==e){var i=this._cancelHandlers.indexOf(t);i>=0&&this._cancelHandlers.splice(i,1)}else h.call(this,e,t)},o}}}(),function(e){var t=document.documentElement,i=null,n=!1;try{var r=getComputedStyle(t).getPropertyValue("opacity"),o="0"==r?"1":"0";i=t.animate({opacity:[o,o]},{duration:1}),i.currentTime=0,n=getComputedStyle(t).getPropertyValue("opacity")==o}catch(e){}finally{i&&i.cancel()}if(!n){var s=window.Element.prototype.animate;window.Element.prototype.animate=function(t,i){return window.Symbol&&Symbol.iterator&&Array.prototype.from&&t[Symbol.iterator]&&(t=Array.from(t)),Array.isArray(t)||null===t||(t=e.convertToArrayForm(t)),s.call(this,t,i)}}}(c),!function(e,t,i){function n(e){var i=t.timeline;i.currentTime=e,i._discardAnimations(),0==i._animations.length?o=!1:requestAnimationFrame(n)}var r=window.requestAnimationFrame;window.requestAnimationFrame=function(e){return r(function(i){t.timeline._updateAnimationsPromises(),e(i),t.timeline._updateAnimationsPromises()})},t.AnimationTimeline=function(){this._animations=[],this.currentTime=void 0},t.AnimationTimeline.prototype={getAnimations:function(){return this._discardAnimations(),this._animations.slice()},_updateAnimationsPromises:function(){t.animationsWithPromises=t.animationsWithPromises.filter(function(e){return e._updatePromises()})},_discardAnimations:function(){this._updateAnimationsPromises(),this._animations=this._animations.filter(function(e){return"finished"!=e.playState&&"idle"!=e.playState})},_play:function(e){var i=new t.Animation(e,this);return this._animations.push(i),t.restartWebAnimationsNextTick(),i._updatePromises(),i._animation.play(),i._updatePromises(),i},play:function(e){return e&&e.remove(),this._play(e)}};var o=!1;t.restartWebAnimationsNextTick=function(){o||(o=!0,requestAnimationFrame(n))};var s=new t.AnimationTimeline;t.timeline=s;try{Object.defineProperty(window.document,"timeline",{configurable:!0,get:function(){return s}})}catch(e){}try{window.document.timeline=s}catch(e){}}(c,e,f),function(e,t,i){t.animationsWithPromises=[],t.Animation=function(t,i){if(this.id="",t&&t._id&&(this.id=t._id),this.effect=t,t&&(t._animation=this),!i)throw new Error("Animation with null timeline is not supported");this._timeline=i,this._sequenceNumber=e.sequenceNumber++,this._holdTime=0,this._paused=!1,this._isGroup=!1,this._animation=null,this._childAnimations=[],this._callback=null,this._oldPlayState="idle",this._rebuildUnderlyingAnimation(),this._animation.cancel(),this._updatePromises()},t.Animation.prototype={_updatePromises:function(){var e=this._oldPlayState,t=this.playState;return this._readyPromise&&t!==e&&("idle"==t?(this._rejectReadyPromise(),this._readyPromise=void 0):"pending"==e?this._resolveReadyPromise():"pending"==t&&(this._readyPromise=void 0)),this._finishedPromise&&t!==e&&("idle"==t?(this._rejectFinishedPromise(),this._finishedPromise=void 0):"finished"==t?this._resolveFinishedPromise():"finished"==e&&(this._finishedPromise=void 0)),
this._oldPlayState=this.playState,this._readyPromise||this._finishedPromise},_rebuildUnderlyingAnimation:function(){this._updatePromises();var e,i,n,r,o=!!this._animation;o&&(e=this.playbackRate,i=this._paused,n=this.startTime,r=this.currentTime,this._animation.cancel(),this._animation._wrapper=null,this._animation=null),(!this.effect||this.effect instanceof window.KeyframeEffect)&&(this._animation=t.newUnderlyingAnimationForKeyframeEffect(this.effect),t.bindAnimationForKeyframeEffect(this)),(this.effect instanceof window.SequenceEffect||this.effect instanceof window.GroupEffect)&&(this._animation=t.newUnderlyingAnimationForGroup(this.effect),t.bindAnimationForGroup(this)),this.effect&&this.effect._onsample&&t.bindAnimationForCustomEffect(this),o&&(1!=e&&(this.playbackRate=e),null!==n?this.startTime=n:null!==r?this.currentTime=r:null!==this._holdTime&&(this.currentTime=this._holdTime),i&&this.pause()),this._updatePromises()},_updateChildren:function(){if(this.effect&&"idle"!=this.playState){var e=this.effect._timing.delay;this._childAnimations.forEach(function(i){this._arrangeChildren(i,e),this.effect instanceof window.SequenceEffect&&(e+=t.groupChildDuration(i.effect))}.bind(this))}},_setExternalAnimation:function(e){if(this.effect&&this._isGroup)for(var t=0;t<this.effect.children.length;t++)this.effect.children[t]._animation=e,this._childAnimations[t]._setExternalAnimation(e)},_constructChildAnimations:function(){if(this.effect&&this._isGroup){var e=this.effect._timing.delay;this._removeChildAnimations(),this.effect.children.forEach(function(i){var n=t.timeline._play(i);this._childAnimations.push(n),n.playbackRate=this.playbackRate,this._paused&&n.pause(),i._animation=this.effect._animation,this._arrangeChildren(n,e),this.effect instanceof window.SequenceEffect&&(e+=t.groupChildDuration(i))}.bind(this))}},_arrangeChildren:function(e,t){null===this.startTime?e.currentTime=this.currentTime-t/this.playbackRate:e.startTime!==this.startTime+t/this.playbackRate&&(e.startTime=this.startTime+t/this.playbackRate)},get timeline(){return this._timeline},get playState(){return this._animation?this._animation.playState:"idle"},get finished(){return window.Promise?(this._finishedPromise||(t.animationsWithPromises.indexOf(this)==-1&&t.animationsWithPromises.push(this),this._finishedPromise=new Promise(function(e,t){this._resolveFinishedPromise=function(){e(this)},this._rejectFinishedPromise=function(){t({type:DOMException.ABORT_ERR,name:"AbortError"})}}.bind(this)),"finished"==this.playState&&this._resolveFinishedPromise()),this._finishedPromise):(console.warn("Animation Promises require JavaScript Promise constructor"),null)},get ready(){return window.Promise?(this._readyPromise||(t.animationsWithPromises.indexOf(this)==-1&&t.animationsWithPromises.push(this),this._readyPromise=new Promise(function(e,t){this._resolveReadyPromise=function(){e(this)},this._rejectReadyPromise=function(){t({type:DOMException.ABORT_ERR,name:"AbortError"})}}.bind(this)),"pending"!==this.playState&&this._resolveReadyPromise()),this._readyPromise):(console.warn("Animation Promises require JavaScript Promise constructor"),null)},get onfinish(){return this._animation.onfinish},set onfinish(e){"function"==typeof e?this._animation.onfinish=function(t){t.target=this,e.call(this,t)}.bind(this):this._animation.onfinish=e},get oncancel(){return this._animation.oncancel},set oncancel(e){"function"==typeof e?this._animation.oncancel=function(t){t.target=this,e.call(this,t)}.bind(this):this._animation.oncancel=e},get currentTime(){this._updatePromises();var e=this._animation.currentTime;return this._updatePromises(),e},set currentTime(e){this._updatePromises(),this._animation.currentTime=isFinite(e)?e:Math.sign(e)*Number.MAX_VALUE,this._register(),this._forEachChild(function(t,i){t.currentTime=e-i}),this._updatePromises()},get startTime(){return this._animation.startTime},set startTime(e){this._updatePromises(),this._animation.startTime=isFinite(e)?e:Math.sign(e)*Number.MAX_VALUE,this._register(),this._forEachChild(function(t,i){t.startTime=e+i}),this._updatePromises()},get playbackRate(){return this._animation.playbackRate},set playbackRate(e){this._updatePromises();var t=this.currentTime;this._animation.playbackRate=e,this._forEachChild(function(t){t.playbackRate=e}),null!==t&&(this.currentTime=t),this._updatePromises()},play:function(){this._updatePromises(),this._paused=!1,this._animation.play(),this._timeline._animations.indexOf(this)==-1&&this._timeline._animations.push(this),this._register(),t.awaitStartTime(this),this._forEachChild(function(e){var t=e.currentTime;e.play(),e.currentTime=t}),this._updatePromises()},pause:function(){this._updatePromises(),this.currentTime&&(this._holdTime=this.currentTime),this._animation.pause(),this._register(),this._forEachChild(function(e){e.pause()}),this._paused=!0,this._updatePromises()},finish:function(){this._updatePromises(),this._animation.finish(),this._register(),this._updatePromises()},cancel:function(){this._updatePromises(),this._animation.cancel(),this._register(),this._removeChildAnimations(),this._updatePromises()},reverse:function(){this._updatePromises();var e=this.currentTime;this._animation.reverse(),this._forEachChild(function(e){e.reverse()}),null!==e&&(this.currentTime=e),this._updatePromises()},addEventListener:function(e,t){var i=t;"function"==typeof t&&(i=function(e){e.target=this,t.call(this,e)}.bind(this),t._wrapper=i),this._animation.addEventListener(e,i)},removeEventListener:function(e,t){this._animation.removeEventListener(e,t&&t._wrapper||t)},_removeChildAnimations:function(){for(;this._childAnimations.length;)this._childAnimations.pop().cancel()},_forEachChild:function(t){var i=0;if(this.effect.children&&this._childAnimations.length<this.effect.children.length&&this._constructChildAnimations(),this._childAnimations.forEach(function(e){t.call(this,e,i),this.effect instanceof window.SequenceEffect&&(i+=e.effect.activeDuration)}.bind(this)),"pending"!=this.playState){var n=this.effect._timing,r=this.currentTime;null!==r&&(r=e.calculateIterationProgress(e.calculateActiveDuration(n),r,n)),(null==r||isNaN(r))&&this._removeChildAnimations()}}},window.Animation=t.Animation}(c,e,f),function(e,t,i){function n(t){this._frames=e.normalizeKeyframes(t)}function r(){for(var e=!1;h.length;){var t=h.shift();t._updateChildren(),e=!0}return e}var o=function(e){if(e._animation=void 0,e instanceof window.SequenceEffect||e instanceof window.GroupEffect)for(var t=0;t<e.children.length;t++)o(e.children[t])};t.removeMulti=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];n._parent?(t.indexOf(n._parent)==-1&&t.push(n._parent),n._parent.children.splice(n._parent.children.indexOf(n),1),n._parent=null,o(n)):n._animation&&n._animation.effect==n&&(n._animation.cancel(),n._animation.effect=new KeyframeEffect(null,[]),n._animation._callback&&(n._animation._callback._animation=null),n._animation._rebuildUnderlyingAnimation(),o(n))}for(i=0;i<t.length;i++)t[i]._rebuild()},t.KeyframeEffect=function(t,i,r,o){return this.target=t,this._parent=null,r=e.numericTimingToObject(r),this._timingInput=e.cloneTimingInput(r),this._timing=e.normalizeTimingInput(r),this.timing=e.makeTiming(r,!1,this),this.timing._effect=this,"function"==typeof i?(e.deprecated("Custom KeyframeEffect","2015-06-22","Use KeyframeEffect.onsample instead."),this._normalizedKeyframes=i):this._normalizedKeyframes=new n(i),this._keyframes=i,this.activeDuration=e.calculateActiveDuration(this._timing),this._id=o,this},t.KeyframeEffect.prototype={getFrames:function(){return"function"==typeof this._normalizedKeyframes?this._normalizedKeyframes:this._normalizedKeyframes._frames},set onsample(e){if("function"==typeof this.getFrames())throw new Error("Setting onsample on custom effect KeyframeEffect is not supported.");this._onsample=e,this._animation&&this._animation._rebuildUnderlyingAnimation()},get parent(){return this._parent},clone:function(){if("function"==typeof this.getFrames())throw new Error("Cloning custom effects is not supported.");var t=new KeyframeEffect(this.target,[],e.cloneTimingInput(this._timingInput),this._id);return t._normalizedKeyframes=this._normalizedKeyframes,t._keyframes=this._keyframes,t},remove:function(){t.removeMulti([this])}};var s=Element.prototype.animate;Element.prototype.animate=function(e,i){var n="";return i&&i.id&&(n=i.id),t.timeline._play(new t.KeyframeEffect(this,e,i,n))};var a=document.createElementNS("http://www.w3.org/1999/xhtml","div");t.newUnderlyingAnimationForKeyframeEffect=function(e){if(e){var t=e.target||a,i=e._keyframes;"function"==typeof i&&(i=[]);var n=e._timingInput;n.id=e._id}else var t=a,i=[],n=0;return s.apply(t,[i,n])},t.bindAnimationForKeyframeEffect=function(e){e.effect&&"function"==typeof e.effect._normalizedKeyframes&&t.bindAnimationForCustomEffect(e)};var h=[];t.awaitStartTime=function(e){null===e.startTime&&e._isGroup&&(0==h.length&&requestAnimationFrame(r),h.push(e))};var l=window.getComputedStyle;Object.defineProperty(window,"getComputedStyle",{configurable:!0,enumerable:!0,value:function(){t.timeline._updateAnimationsPromises();var e=l.apply(this,arguments);return r()&&(e=l.apply(this,arguments)),t.timeline._updateAnimationsPromises(),e}}),window.KeyframeEffect=t.KeyframeEffect,window.Element.prototype.getAnimations=function(){return document.timeline.getAnimations().filter(function(e){return null!==e.effect&&e.effect.target==this}.bind(this))}}(c,e,f),function(e,t,i){function n(e){e._registered||(e._registered=!0,s.push(e),a||(a=!0,requestAnimationFrame(r)))}function r(e){var t=s;s=[],t.sort(function(e,t){return e._sequenceNumber-t._sequenceNumber}),t=t.filter(function(e){e();var t=e._animation?e._animation.playState:"idle";return"running"!=t&&"pending"!=t&&(e._registered=!1),e._registered}),s.push.apply(s,t),s.length?(a=!0,requestAnimationFrame(r)):a=!1}var o=(document.createElementNS("http://www.w3.org/1999/xhtml","div"),0);t.bindAnimationForCustomEffect=function(t){var i,r=t.effect.target,s="function"==typeof t.effect.getFrames();i=s?t.effect.getFrames():t.effect._onsample;var a=t.effect.timing,h=null;a=e.normalizeTimingInput(a);var l=function(){var n=l._animation?l._animation.currentTime:null;null!==n&&(n=e.calculateIterationProgress(e.calculateActiveDuration(a),n,a),isNaN(n)&&(n=null)),n!==h&&(s?i(n,r,t.effect):i(n,t.effect,t.effect._animation)),h=n};l._animation=t,l._registered=!1,l._sequenceNumber=o++,t._callback=l,n(l)};var s=[],a=!1;t.Animation.prototype._register=function(){this._callback&&n(this._callback)}}(c,e,f),function(e,t,i){function n(e){return e._timing.delay+e.activeDuration+e._timing.endDelay}function r(t,i,n){this._id=n,this._parent=null,this.children=t||[],this._reparent(this.children),i=e.numericTimingToObject(i),this._timingInput=e.cloneTimingInput(i),this._timing=e.normalizeTimingInput(i,!0),this.timing=e.makeTiming(i,!0,this),this.timing._effect=this,"auto"===this._timing.duration&&(this._timing.duration=this.activeDuration)}window.SequenceEffect=function(){r.apply(this,arguments)},window.GroupEffect=function(){r.apply(this,arguments)},r.prototype={_isAncestor:function(e){for(var t=this;null!==t;){if(t==e)return!0;t=t._parent}return!1},_rebuild:function(){for(var e=this;e;)"auto"===e.timing.duration&&(e._timing.duration=e.activeDuration),e=e._parent;this._animation&&this._animation._rebuildUnderlyingAnimation()},_reparent:function(e){t.removeMulti(e);for(var i=0;i<e.length;i++)e[i]._parent=this},_putChild:function(e,t){for(var i=t?"Cannot append an ancestor or self":"Cannot prepend an ancestor or self",n=0;n<e.length;n++)if(this._isAncestor(e[n]))throw{type:DOMException.HIERARCHY_REQUEST_ERR,name:"HierarchyRequestError",message:i};for(var n=0;n<e.length;n++)t?this.children.push(e[n]):this.children.unshift(e[n]);this._reparent(e),this._rebuild()},append:function(){this._putChild(arguments,!0)},prepend:function(){this._putChild(arguments,!1)},get parent(){return this._parent},get firstChild(){return this.children.length?this.children[0]:null},get lastChild(){return this.children.length?this.children[this.children.length-1]:null},clone:function(){for(var t=e.cloneTimingInput(this._timingInput),i=[],n=0;n<this.children.length;n++)i.push(this.children[n].clone());return this instanceof GroupEffect?new GroupEffect(i,t):new SequenceEffect(i,t)},remove:function(){t.removeMulti([this])}},window.SequenceEffect.prototype=Object.create(r.prototype),Object.defineProperty(window.SequenceEffect.prototype,"activeDuration",{get:function(){var e=0;return this.children.forEach(function(t){e+=n(t)}),Math.max(e,0)}}),window.GroupEffect.prototype=Object.create(r.prototype),Object.defineProperty(window.GroupEffect.prototype,"activeDuration",{get:function(){var e=0;return this.children.forEach(function(t){e=Math.max(e,n(t))}),e}}),t.newUnderlyingAnimationForGroup=function(i){var n,r=null,o=function(t){var i=n._wrapper;if(i&&"pending"!=i.playState&&i.effect)return null==t?void i._removeChildAnimations():0==t&&i.playbackRate<0&&(r||(r=e.normalizeTimingInput(i.effect.timing)),t=e.calculateIterationProgress(e.calculateActiveDuration(r),-1,r),isNaN(t)||null==t)?(i._forEachChild(function(e){e.currentTime=-1}),void i._removeChildAnimations()):void 0},s=new KeyframeEffect(null,[],i._timing,i._id);return s.onsample=o,n=t.timeline._play(s)},t.bindAnimationForGroup=function(e){e._animation._wrapper=e,e._isGroup=!0,t.awaitStartTime(e),e._constructChildAnimations(),e._setExternalAnimation(e)},t.groupChildDuration=n}(c,e,f),b.true=a}({},function(){return this}()),Polymer({is:"opaque-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function(e){var t=e.node;return this._effect=new KeyframeEffect(t,[{opacity:"1"},{opacity:"1"}],this.timingFromConfig(e)),t.style.opacity="0",this._effect},complete:function(e){e.node.style.opacity=""}}),function(){"use strict";var e={pageX:0,pageY:0},t=null,i=[];Polymer.IronDropdownScrollManager={get currentLockingElement(){return this._lockingElements[this._lockingElements.length-1]},elementIsScrollLocked:function(e){var t=this.currentLockingElement;if(void 0===t)return!1;var i;return!!this._hasCachedLockedElement(e)||!this._hasCachedUnlockedElement(e)&&(i=!!t&&t!==e&&!this._composedTreeContains(t,e),i?this._lockedElementCache.push(e):this._unlockedElementCache.push(e),i)},pushScrollLock:function(e){this._lockingElements.indexOf(e)>=0||(0===this._lockingElements.length&&this._lockScrollInteractions(),this._lockingElements.push(e),this._lockedElementCache=[],this._unlockedElementCache=[])},removeScrollLock:function(e){var t=this._lockingElements.indexOf(e);t!==-1&&(this._lockingElements.splice(t,1),this._lockedElementCache=[],this._unlockedElementCache=[],0===this._lockingElements.length&&this._unlockScrollInteractions())},_lockingElements:[],_lockedElementCache:null,_unlockedElementCache:null,_hasCachedLockedElement:function(e){return this._lockedElementCache.indexOf(e)>-1},_hasCachedUnlockedElement:function(e){return this._unlockedElementCache.indexOf(e)>-1},_composedTreeContains:function(e,t){var i,n,r,o;if(e.contains(t))return!0;for(i=Polymer.dom(e).querySelectorAll("content"),r=0;r<i.length;++r)for(n=Polymer.dom(i[r]).getDistributedNodes(),o=0;o<n.length;++o)if(this._composedTreeContains(n[o],t))return!0;return!1},_scrollInteractionHandler:function(t){if(t.cancelable&&this._shouldPreventScrolling(t)&&t.preventDefault(),t.targetTouches){var i=t.targetTouches[0];e.pageX=i.pageX,e.pageY=i.pageY}},_lockScrollInteractions:function(){this._boundScrollHandler=this._boundScrollHandler||this._scrollInteractionHandler.bind(this),document.addEventListener("wheel",this._boundScrollHandler,!0),document.addEventListener("mousewheel",this._boundScrollHandler,!0),document.addEventListener("DOMMouseScroll",this._boundScrollHandler,!0),document.addEventListener("touchstart",this._boundScrollHandler,!0),document.addEventListener("touchmove",this._boundScrollHandler,!0)},_unlockScrollInteractions:function(){document.removeEventListener("wheel",this._boundScrollHandler,!0),document.removeEventListener("mousewheel",this._boundScrollHandler,!0),document.removeEventListener("DOMMouseScroll",this._boundScrollHandler,!0),document.removeEventListener("touchstart",this._boundScrollHandler,!0),document.removeEventListener("touchmove",this._boundScrollHandler,!0)},_shouldPreventScrolling:function(e){var n=Polymer.dom(e).rootTarget;if("touchmove"!==e.type&&t!==n&&(t=n,i=this._getScrollableNodes(Polymer.dom(e).path)),!i.length)return!0;if("touchstart"===e.type)return!1;var r=this._getScrollInfo(e);return!this._getScrollingNode(i,r.deltaX,r.deltaY)},_getScrollableNodes:function(e){for(var t=[],i=e.indexOf(this.currentLockingElement),n=0;n<=i;n++){var r=e[n];if(11!==r.nodeType){var o=r.style;"scroll"!==o.overflow&&"auto"!==o.overflow&&(o=window.getComputedStyle(r)),"scroll"!==o.overflow&&"auto"!==o.overflow||t.push(r)}}return t},_getScrollingNode:function(e,t,i){if(t||i)for(var n=Math.abs(i)>=Math.abs(t),r=0;r<e.length;r++){var o=e[r],s=!1;if(s=n?i<0?o.scrollTop>0:o.scrollTop<o.scrollHeight-o.clientHeight:t<0?o.scrollLeft>0:o.scrollLeft<o.scrollWidth-o.clientWidth)return o}},_getScrollInfo:function(t){var i={deltaX:t.deltaX,deltaY:t.deltaY};if("deltaX"in t);else if("wheelDeltaX"in t)i.deltaX=-t.wheelDeltaX,i.deltaY=-t.wheelDeltaY;else if("axis"in t)i.deltaX=1===t.axis?t.detail:0,i.deltaY=2===t.axis?t.detail:0;else if(t.targetTouches){var n=t.targetTouches[0];i.deltaX=e.pageX-n.pageX,i.deltaY=e.pageY-n.pageY}return i}}}(),function(){"use strict";Polymer({is:"iron-dropdown",behaviors:[Polymer.IronControlState,Polymer.IronA11yKeysBehavior,Polymer.IronOverlayBehavior,Polymer.NeonAnimationRunnerBehavior],properties:{horizontalAlign:{type:String,value:"left",reflectToAttribute:!0},verticalAlign:{type:String,value:"top",reflectToAttribute:!0},openAnimationConfig:{type:Object},closeAnimationConfig:{type:Object},focusTarget:{type:Object},noAnimations:{type:Boolean,value:!1},allowOutsideScroll:{type:Boolean,value:!1},_boundOnCaptureScroll:{type:Function,value:function(){return this._onCaptureScroll.bind(this)}}},listeners:{"neon-animation-finish":"_onNeonAnimationFinish"},observers:["_updateOverlayPosition(positionTarget, verticalAlign, horizontalAlign, verticalOffset, horizontalOffset)"],get containedElement(){return Polymer.dom(this.$.content).getDistributedNodes()[0]},get _focusTarget(){return this.focusTarget||this.containedElement},ready:function(){this._scrollTop=0,this._scrollLeft=0,this._refitOnScrollRAF=null},attached:function(){this.sizingTarget&&this.sizingTarget!==this||(this.sizingTarget=this.containedElement)},detached:function(){this.cancelAnimation(),document.removeEventListener("scroll",this._boundOnCaptureScroll),Polymer.IronDropdownScrollManager.removeScrollLock(this)},_openedChanged:function(){this.opened&&this.disabled?this.cancel():(this.cancelAnimation(),this._updateAnimationConfig(),this._saveScrollPosition(),this.opened?(document.addEventListener("scroll",this._boundOnCaptureScroll),!this.allowOutsideScroll&&Polymer.IronDropdownScrollManager.pushScrollLock(this)):(document.removeEventListener("scroll",this._boundOnCaptureScroll),Polymer.IronDropdownScrollManager.removeScrollLock(this)),Polymer.IronOverlayBehaviorImpl._openedChanged.apply(this,arguments))},_renderOpened:function(){!this.noAnimations&&this.animationConfig.open?(this.$.contentWrapper.classList.add("animating"),this.playAnimation("open")):Polymer.IronOverlayBehaviorImpl._renderOpened.apply(this,arguments)},_renderClosed:function(){!this.noAnimations&&this.animationConfig.close?(this.$.contentWrapper.classList.add("animating"),this.playAnimation("close")):Polymer.IronOverlayBehaviorImpl._renderClosed.apply(this,arguments)},_onNeonAnimationFinish:function(){this.$.contentWrapper.classList.remove("animating"),this.opened?this._finishRenderOpened():this._finishRenderClosed()},_onCaptureScroll:function(){this.allowOutsideScroll?(this._refitOnScrollRAF&&window.cancelAnimationFrame(this._refitOnScrollRAF),this._refitOnScrollRAF=window.requestAnimationFrame(this.refit.bind(this))):this._restoreScrollPosition()},_saveScrollPosition:function(){document.scrollingElement?(this._scrollTop=document.scrollingElement.scrollTop,this._scrollLeft=document.scrollingElement.scrollLeft):(this._scrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop),this._scrollLeft=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft))},_restoreScrollPosition:function(){document.scrollingElement?(document.scrollingElement.scrollTop=this._scrollTop,document.scrollingElement.scrollLeft=this._scrollLeft):(document.documentElement.scrollTop=this._scrollTop,document.documentElement.scrollLeft=this._scrollLeft,document.body.scrollTop=this._scrollTop,document.body.scrollLeft=this._scrollLeft)},_updateAnimationConfig:function(){for(var e=(this.openAnimationConfig||[]).concat(this.closeAnimationConfig||[]),t=0;t<e.length;t++)e[t].node=this.containedElement;this.animationConfig={open:this.openAnimationConfig,close:this.closeAnimationConfig}},_updateOverlayPosition:function(){this.isAttached&&this.notifyResize()},_applyFocus:function(){var e=this.focusTarget||this.containedElement;e&&this.opened&&!this.noAutoFocus?e.focus():Polymer.IronOverlayBehaviorImpl._applyFocus.apply(this,arguments)}})}(),Polymer({is:"fade-in-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function(e){var t=e.node;return this._effect=new KeyframeEffect(t,[{opacity:"0"},{opacity:"1"}],this.timingFromConfig(e)),this._effect}}),Polymer({is:"fade-out-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function(e){var t=e.node;return this._effect=new KeyframeEffect(t,[{opacity:"1"},{opacity:"0"}],this.timingFromConfig(e)),this._effect}}),Polymer({is:"paper-menu-grow-height-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function(e){var t=e.node,i=t.getBoundingClientRect(),n=i.height;return this._effect=new KeyframeEffect(t,[{height:n/2+"px"},{height:n+"px"}],this.timingFromConfig(e)),this._effect}}),Polymer({is:"paper-menu-grow-width-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function(e){var t=e.node,i=t.getBoundingClientRect(),n=i.width;return this._effect=new KeyframeEffect(t,[{width:n/2+"px"},{width:n+"px"}],this.timingFromConfig(e)),this._effect}}),Polymer({is:"paper-menu-shrink-width-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function(e){var t=e.node,i=t.getBoundingClientRect(),n=i.width;return this._effect=new KeyframeEffect(t,[{width:n+"px"},{width:n-n/20+"px"}],this.timingFromConfig(e)),this._effect}}),Polymer({is:"paper-menu-shrink-height-animation",behaviors:[Polymer.NeonAnimationBehavior],configure:function(e){var t=e.node,i=t.getBoundingClientRect(),n=i.height;i.top;return this.setPrefixedProperty(t,"transformOrigin","0 0"),this._effect=new KeyframeEffect(t,[{height:n+"px",transform:"translateY(0)"},{height:n/2+"px",transform:"translateY(-20px)"}],this.timingFromConfig(e)),this._effect}}),function(){"use strict";var e={ANIMATION_CUBIC_BEZIER:"cubic-bezier(.3,.95,.5,1)",MAX_ANIMATION_TIME_MS:400},t=Polymer({is:"paper-menu-button",behaviors:[Polymer.IronA11yKeysBehavior,Polymer.IronControlState],properties:{opened:{type:Boolean,value:!1,notify:!0,observer:"_openedChanged"},horizontalAlign:{type:String,value:"left",reflectToAttribute:!0},verticalAlign:{type:String,value:"top",reflectToAttribute:!0},dynamicAlign:{type:Boolean},horizontalOffset:{type:Number,value:0,notify:!0},verticalOffset:{type:Number,value:0,notify:!0},noOverlap:{type:Boolean},noAnimations:{type:Boolean,value:!1},ignoreSelect:{type:Boolean,value:!1},closeOnActivate:{type:Boolean,value:!1},openAnimationConfig:{type:Object,value:function(){return[{name:"fade-in-animation",timing:{delay:100,duration:200}},{name:"paper-menu-grow-width-animation",timing:{delay:100,duration:150,easing:e.ANIMATION_CUBIC_BEZIER}},{name:"paper-menu-grow-height-animation",timing:{delay:100,duration:275,easing:e.ANIMATION_CUBIC_BEZIER}}]}},closeAnimationConfig:{type:Object,value:function(){return[{name:"fade-out-animation",timing:{duration:150}},{name:"paper-menu-shrink-width-animation",timing:{delay:100,duration:50,easing:e.ANIMATION_CUBIC_BEZIER}},{name:"paper-menu-shrink-height-animation",timing:{duration:200,easing:"ease-in"}}]}},allowOutsideScroll:{type:Boolean,value:!1},restoreFocusOnClose:{type:Boolean,value:!0},_dropdownContent:{type:Object}},hostAttributes:{role:"group","aria-haspopup":"true"},listeners:{"iron-activate":"_onIronActivate","iron-select":"_onIronSelect"},get contentElement(){return Polymer.dom(this.$.content).getDistributedNodes()[0]},toggle:function(){this.opened?this.close():this.open()},open:function(){this.disabled||this.$.dropdown.open()},close:function(){this.$.dropdown.close()},_onIronSelect:function(e){this.ignoreSelect||this.close()},_onIronActivate:function(e){this.closeOnActivate&&this.close()},_openedChanged:function(e,t){e?(this._dropdownContent=this.contentElement,this.fire("paper-dropdown-open")):null!=t&&this.fire("paper-dropdown-close")},_disabledChanged:function(e){Polymer.IronControlState._disabledChanged.apply(this,arguments),e&&this.opened&&this.close()},__onIronOverlayCanceled:function(e){var t=e.detail,i=(Polymer.dom(t).rootTarget,this.$.trigger),n=Polymer.dom(t).path;n.indexOf(i)>-1&&e.preventDefault()}});Object.keys(e).forEach(function(i){t[i]=e[i]}),Polymer.PaperMenuButton=t}(),function(){"use strict";Polymer({is:"paper-dropdown-menu-light",behaviors:[Polymer.IronButtonState,Polymer.IronControlState,Polymer.PaperRippleBehavior,Polymer.IronFormElementBehavior,Polymer.IronValidatableBehavior],properties:{selectedItemLabel:{type:String,notify:!0,readOnly:!0},selectedItem:{type:Object,notify:!0,readOnly:!0},value:{type:String,notify:!0,readOnly:!0,observer:"_valueChanged"},label:{type:String},placeholder:{type:String},opened:{type:Boolean,notify:!0,value:!1,observer:"_openedChanged"},allowOutsideScroll:{type:Boolean,value:!1},noLabelFloat:{type:Boolean,value:!1,reflectToAttribute:!0},alwaysFloatLabel:{type:Boolean,value:!1},noAnimations:{type:Boolean,value:!1},horizontalAlign:{type:String,value:"right"},verticalAlign:{type:String,value:"top"},hasContent:{type:Boolean,readOnly:!0}},listeners:{tap:"_onTap"},keyBindings:{"up down":"open",esc:"close"},hostAttributes:{tabindex:0,role:"combobox","aria-autocomplete":"none","aria-haspopup":"true"},observers:["_selectedItemChanged(selectedItem)"],attached:function(){var e=this.contentElement;e&&e.selectedItem&&this._setSelectedItem(e.selectedItem)},get contentElement(){return Polymer.dom(this.$.content).getDistributedNodes()[0]},open:function(){this.$.menuButton.open()},close:function(){this.$.menuButton.close()},_onIronSelect:function(e){this._setSelectedItem(e.detail.item)},_onIronDeselect:function(e){this._setSelectedItem(null)},_onTap:function(e){Polymer.Gestures.findOriginalTarget(e)===this&&this.open()},_selectedItemChanged:function(e){var t="";t=e?e.label||e.getAttribute("label")||e.textContent.trim():"",this._setValue(t),this._setSelectedItemLabel(t)},_computeMenuVerticalOffset:function(e){return e?-4:8},_getValidity:function(e){return this.disabled||!this.required||this.required&&!!this.value},_openedChanged:function(){var e=this.opened?"true":"false",t=this.contentElement;t&&t.setAttribute("aria-expanded",e)},_computeLabelClass:function(e,t,i){var n="";return e===!0?i?"label-is-hidden":"":((i||t===!0)&&(n+=" label-is-floating"),n)},_valueChanged:function(){this.$.input&&this.$.input.textContent!==this.value&&(this.$.input.textContent=this.value),this._setHasContent(!!this.value)}})}(),Polymer({is:"paper-item-body"}),Polymer.PaperItemBehaviorImpl={hostAttributes:{role:"option",tabindex:"0"}},Polymer.PaperItemBehavior=[Polymer.IronButtonState,Polymer.IronControlState,Polymer.PaperItemBehaviorImpl],Polymer({is:"paper-item",behaviors:[Polymer.PaperItemBehavior]}),function(){Polymer({is:"paper-listbox",behaviors:[Polymer.IronMenuBehavior],hostAttributes:{role:"listbox"}})}(),Polymer({is:"iron-localstorage",properties:{name:{type:String,value:""},value:{type:Object,notify:!0},useRaw:{type:Boolean,value:!1},autoSaveDisabled:{type:Boolean,value:!1},errorMessage:{type:String,notify:!0},_loaded:{type:Boolean,value:!1}},observers:["_debounceReload(name,useRaw)","_trySaveValue(autoSaveDisabled)","_trySaveValue(value.*)"],ready:function(){this._boundHandleStorage=this._handleStorage.bind(this)},attached:function(){window.addEventListener("storage",this._boundHandleStorage)},detached:function(){window.removeEventListener("storage",this._boundHandleStorage)},_handleStorage:function(e){e.key==this.name&&this._load(!0)},_trySaveValue:function(){this._doNotSave||this._loaded&&!this.autoSaveDisabled&&this.debounce("save",this.save)},_debounceReload:function(){this.debounce("reload",this.reload)},reload:function(){this._loaded=!1,this._load()},_load:function(e){try{var t=window.localStorage.getItem(this.name)}catch(e){this.errorMessage=e.message,this._error("Could not save to localStorage.  Try enabling cookies for this page.",e)}if(null===t)this._loaded=!0,this._doNotSave=!0,this.value=null,this._doNotSave=!1,this.fire("iron-localstorage-load-empty",{externalChange:e});else{if(!this.useRaw)try{t=JSON.parse(t)}catch(e){this.errorMessage="Could not parse local storage value",Polymer.Base._error("could not parse local storage value",t),t=null}this._loaded=!0,this._doNotSave=!0,this.value=t,this._doNotSave=!1,this.fire("iron-localstorage-load",{externalChange:e})}},save:function(){var e=this.useRaw?this.value:JSON.stringify(this.value);try{null===this.value||void 0===this.value?window.localStorage.removeItem(this.name):window.localStorage.setItem(this.name,e)}catch(e){this.errorMessage=e.message,Polymer.Base._error("Could not save to localStorage. Incognito mode may be blocking this action",e)}}}),Polymer.PaperDialogBehaviorImpl={hostAttributes:{role:"dialog",tabindex:"-1"},properties:{modal:{type:Boolean,value:!1}},observers:["_modalChanged(modal, _readied)"],listeners:{tap:"_onDialogClick"},ready:function(){this.__prevNoCancelOnOutsideClick=this.noCancelOnOutsideClick,this.__prevNoCancelOnEscKey=this.noCancelOnEscKey,this.__prevWithBackdrop=this.withBackdrop},_modalChanged:function(e,t){t&&(e?(this.__prevNoCancelOnOutsideClick=this.noCancelOnOutsideClick,this.__prevNoCancelOnEscKey=this.noCancelOnEscKey,this.__prevWithBackdrop=this.withBackdrop,this.noCancelOnOutsideClick=!0,this.noCancelOnEscKey=!0,this.withBackdrop=!0):(this.noCancelOnOutsideClick=this.noCancelOnOutsideClick&&this.__prevNoCancelOnOutsideClick,this.noCancelOnEscKey=this.noCancelOnEscKey&&this.__prevNoCancelOnEscKey,this.withBackdrop=this.withBackdrop&&this.__prevWithBackdrop))},_updateClosingReasonConfirmed:function(e){this.closingReason=this.closingReason||{},this.closingReason.confirmed=e},_onDialogClick:function(e){for(var t=Polymer.dom(e).path,i=0;i<t.indexOf(this);i++){var n=t[i];if(n.hasAttribute&&(n.hasAttribute("dialog-dismiss")||n.hasAttribute("dialog-confirm"))){this._updateClosingReasonConfirmed(n.hasAttribute("dialog-confirm")),this.close(),e.stopPropagation();break}}}},Polymer.PaperDialogBehavior=[Polymer.IronOverlayBehavior,Polymer.PaperDialogBehaviorImpl],function(){Polymer({is:"paper-dialog",behaviors:[Polymer.PaperDialogBehavior,Polymer.NeonAnimationRunnerBehavior],listeners:{"neon-animation-finish":"_onNeonAnimationFinish"},_renderOpened:function(){this.cancelAnimation(),this.playAnimation("entry")},_renderClosed:function(){this.cancelAnimation(),this.playAnimation("exit")},_onNeonAnimationFinish:function(){this.opened?this._finishRenderOpened():this._finishRenderClosed()}})}(),Polymer.IronCheckedElementBehaviorImpl={properties:{checked:{type:Boolean,value:!1,reflectToAttribute:!0,notify:!0,observer:"_checkedChanged"},toggles:{type:Boolean,value:!0,reflectToAttribute:!0},value:{type:String,value:"on",observer:"_valueChanged"}},observers:["_requiredChanged(required)"],created:function(){this._hasIronCheckedElementBehavior=!0},_getValidity:function(e){
return this.disabled||!this.required||this.checked},_requiredChanged:function(){this.required?this.setAttribute("aria-required","true"):this.removeAttribute("aria-required")},_checkedChanged:function(){this.active=this.checked,this.fire("iron-change")},_valueChanged:function(){void 0!==this.value&&null!==this.value||(this.value="on")}},Polymer.IronCheckedElementBehavior=[Polymer.IronFormElementBehavior,Polymer.IronValidatableBehavior,Polymer.IronCheckedElementBehaviorImpl],Polymer.PaperCheckedElementBehaviorImpl={_checkedChanged:function(){Polymer.IronCheckedElementBehaviorImpl._checkedChanged.call(this),this.hasRipple()&&(this.checked?this._ripple.setAttribute("checked",""):this._ripple.removeAttribute("checked"))},_buttonStateChanged:function(){Polymer.PaperRippleBehavior._buttonStateChanged.call(this),this.disabled||this.isAttached&&(this.checked=this.active)}},Polymer.PaperCheckedElementBehavior=[Polymer.PaperInkyFocusBehavior,Polymer.IronCheckedElementBehavior,Polymer.PaperCheckedElementBehaviorImpl],Polymer({is:"paper-toggle-button",behaviors:[Polymer.PaperCheckedElementBehavior],hostAttributes:{role:"button","aria-pressed":"false",tabindex:0},properties:{},listeners:{track:"_ontrack"},attached:function(){Polymer.RenderStatus.afterNextRender(this,function(){this.setScrollDirection("y")})},_ontrack:function(e){var t=e.detail;"start"===t.state?this._trackStart(t):"track"===t.state?this._trackMove(t):"end"===t.state&&this._trackEnd(t)},_trackStart:function(e){this._width=this.$.toggleBar.offsetWidth/2,this._trackChecked=this.checked,this.$.toggleButton.classList.add("dragging")},_trackMove:function(e){var t=e.dx;this._x=Math.min(this._width,Math.max(0,this._trackChecked?this._width+t:t)),this.translate3d(this._x+"px",0,0,this.$.toggleButton),this._userActivate(this._x>this._width/2)},_trackEnd:function(e){this.$.toggleButton.classList.remove("dragging"),this.transform("",this.$.toggleButton)},_createRipple:function(){this._rippleContainer=this.$.toggleButton;var e=Polymer.PaperRippleBehavior._createRipple();return e.id="ink",e.setAttribute("recenters",""),e.classList.add("circle","toggle-ink"),e}}),function(){Polymer({is:"paper-menu",behaviors:[Polymer.IronMenuBehavior]})}(),Polymer.IronRangeBehavior={properties:{value:{type:Number,value:0,notify:!0,reflectToAttribute:!0},min:{type:Number,value:0,notify:!0},max:{type:Number,value:100,notify:!0},step:{type:Number,value:1,notify:!0},ratio:{type:Number,value:0,readOnly:!0,notify:!0}},observers:["_update(value, min, max, step)"],_calcRatio:function(e){return(this._clampValue(e)-this.min)/(this.max-this.min)},_clampValue:function(e){return Math.min(this.max,Math.max(this.min,this._calcStep(e)))},_calcStep:function(e){if(e=parseFloat(e),!this.step)return e;var t=Math.round((e-this.min)/this.step);return this.step<1?t/(1/this.step)+this.min:t*this.step+this.min},_validateValue:function(){var e=this._clampValue(this.value);return this.value=this.oldValue=isNaN(e)?this.oldValue:e,this.value!==e},_update:function(){this._validateValue(),this._setRatio(100*this._calcRatio(this.value))}},Polymer({is:"paper-progress",behaviors:[Polymer.IronRangeBehavior],properties:{secondaryProgress:{type:Number,value:0},secondaryRatio:{type:Number,value:0,readOnly:!0},indeterminate:{type:Boolean,value:!1,observer:"_toggleIndeterminate"},disabled:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_disabledChanged"}},observers:["_progressChanged(secondaryProgress, value, min, max)"],hostAttributes:{role:"progressbar"},_toggleIndeterminate:function(e){this.toggleClass("indeterminate",e,this.$.primaryProgress)},_transformProgress:function(e,t){var i="scaleX("+t/100+")";e.style.transform=e.style.webkitTransform=i},_mainRatioChanged:function(e){this._transformProgress(this.$.primaryProgress,e)},_progressChanged:function(e,t,i,n){e=this._clampValue(e),t=this._clampValue(t);var r=100*this._calcRatio(e),o=100*this._calcRatio(t);this._setSecondaryRatio(r),this._transformProgress(this.$.secondaryProgress,r),this._transformProgress(this.$.primaryProgress,o),this.secondaryProgress=e,this.setAttribute("aria-valuenow",t),this.setAttribute("aria-valuemin",i),this.setAttribute("aria-valuemax",n)},_disabledChanged:function(e){this.setAttribute("aria-disabled",e?"true":"false")},_hideSecondaryProgress:function(e){return 0===e}}),Polymer({is:"paper-slider",behaviors:[Polymer.IronA11yKeysBehavior,Polymer.IronFormElementBehavior,Polymer.PaperInkyFocusBehavior,Polymer.IronRangeBehavior],properties:{snaps:{type:Boolean,value:!1,notify:!0},pin:{type:Boolean,value:!1,notify:!0},secondaryProgress:{type:Number,value:0,notify:!0,observer:"_secondaryProgressChanged"},editable:{type:Boolean,value:!1},immediateValue:{type:Number,value:0,readOnly:!0,notify:!0},maxMarkers:{type:Number,value:0,notify:!0},expand:{type:Boolean,value:!1,readOnly:!0},dragging:{type:Boolean,value:!1,readOnly:!0},transiting:{type:Boolean,value:!1,readOnly:!0},markers:{type:Array,readOnly:!0,value:function(){return[]}}},observers:["_updateKnob(value, min, max, snaps, step)","_valueChanged(value)","_immediateValueChanged(immediateValue)","_updateMarkers(maxMarkers, min, max, snaps)"],hostAttributes:{role:"slider",tabindex:0},keyBindings:{"left down pagedown home":"_decrementKey","right up pageup end":"_incrementKey"},increment:function(){this.value=this._clampValue(this.value+this.step)},decrement:function(){this.value=this._clampValue(this.value-this.step)},_updateKnob:function(e,t,i,n,r){this.setAttribute("aria-valuemin",t),this.setAttribute("aria-valuemax",i),this.setAttribute("aria-valuenow",e),this._positionKnob(this._calcRatio(e))},_valueChanged:function(){this.fire("value-change")},_immediateValueChanged:function(){this.dragging?this.fire("immediate-value-change"):this.value=this.immediateValue},_secondaryProgressChanged:function(){this.secondaryProgress=this._clampValue(this.secondaryProgress)},_expandKnob:function(){this._setExpand(!0)},_resetKnob:function(){this.cancelDebouncer("expandKnob"),this._setExpand(!1)},_positionKnob:function(e){this._setImmediateValue(this._calcStep(this._calcKnobPosition(e))),this._setRatio(this._calcRatio(this.immediateValue)),this.$.sliderKnob.style.left=100*this.ratio+"%",this.dragging&&(this._knobstartx=this.ratio*this._w,this.translate3d(0,0,0,this.$.sliderKnob))},_calcKnobPosition:function(e){return(this.max-this.min)*e+this.min},_onTrack:function(e){switch(e.stopPropagation(),e.detail.state){case"start":this._trackStart(e);break;case"track":this._trackX(e);break;case"end":this._trackEnd()}},_trackStart:function(e){this._w=this.$.sliderBar.offsetWidth,this._x=this.ratio*this._w,this._startx=this._x,this._knobstartx=this._startx,this._minx=-this._startx,this._maxx=this._w-this._startx,this.$.sliderKnob.classList.add("dragging"),this._setDragging(!0)},_trackX:function(e){this.dragging||this._trackStart(e);var t=Math.min(this._maxx,Math.max(this._minx,e.detail.dx));this._x=this._startx+t;var i=this._calcStep(this._calcKnobPosition(this._x/this._w));this._setImmediateValue(i);var n=this._calcRatio(this.immediateValue)*this._w-this._knobstartx;this.translate3d(n+"px",0,0,this.$.sliderKnob)},_trackEnd:function(){var e=this.$.sliderKnob.style;this.$.sliderKnob.classList.remove("dragging"),this._setDragging(!1),this._resetKnob(),this.value=this.immediateValue,e.transform=e.webkitTransform="",this.fire("change")},_knobdown:function(e){this._expandKnob(),e.preventDefault(),this.focus()},_bardown:function(e){this._w=this.$.sliderBar.offsetWidth;var t=this.$.sliderBar.getBoundingClientRect(),i=(e.detail.x-t.left)/this._w,n=this.ratio;this._setTransiting(!0),this._positionKnob(i),this.debounce("expandKnob",this._expandKnob,60),n===this.ratio&&this._setTransiting(!1),this.async(function(){this.fire("change")}),e.preventDefault(),this.focus()},_knobTransitionEnd:function(e){e.target===this.$.sliderKnob&&this._setTransiting(!1)},_updateMarkers:function(e,t,i,n){n||this._setMarkers([]);var r=Math.round((i-t)/this.step);r>e&&(r=e),this._setMarkers(new Array(r))},_mergeClasses:function(e){return Object.keys(e).filter(function(t){return e[t]}).join(" ")},_getClassNames:function(){return this._mergeClasses({disabled:this.disabled,pin:this.pin,snaps:this.snaps,ring:this.immediateValue<=this.min,expand:this.expand,dragging:this.dragging,transiting:this.transiting,editable:this.editable})},_incrementKey:function(e){this.disabled||("end"===e.detail.key?this.value=this.max:this.increment(),this.fire("change"))},_decrementKey:function(e){this.disabled||("home"===e.detail.key?this.value=this.min:this.decrement(),this.fire("change"))},_changeValue:function(e){this.value=e.target.value,this.fire("change")},_inputKeyDown:function(e){e.stopPropagation()},_createRipple:function(){return this._rippleContainer=this.$.sliderKnob,Polymer.PaperInkyFocusBehaviorImpl._createRipple.call(this)},_focusedChanged:function(e){e&&this.ensureRipple(),this.hasRipple()&&(e?this._ripple.style.display="":this._ripple.style.display="none",this._ripple.holdDown=e)}}),Polymer({is:"iron-image",properties:{src:{observer:"_srcChanged",type:String,value:""},alt:{type:String,value:null},preventLoad:{type:Boolean,value:!1,observer:"_preventLoadChanged"},sizing:{type:String,value:null,reflectToAttribute:!0},position:{type:String,value:"center"},preload:{type:Boolean,value:!1},placeholder:{type:String,value:null,observer:"_placeholderChanged"},fade:{type:Boolean,value:!1},loaded:{notify:!0,readOnly:!0,type:Boolean,value:!1},loading:{notify:!0,readOnly:!0,type:Boolean,value:!1},error:{notify:!0,readOnly:!0,type:Boolean,value:!1},width:{observer:"_widthChanged",type:Number,value:null},height:{observer:"_heightChanged",type:Number,value:null}},observers:["_transformChanged(sizing, position)"],ready:function(){var e=this.$.img;e.onload=function(){this.$.img.src===this._resolveSrc(this.src)&&(this._setLoading(!1),this._setLoaded(!0),this._setError(!1))}.bind(this),e.onerror=function(){this.$.img.src===this._resolveSrc(this.src)&&(this._reset(),this._setLoading(!1),this._setLoaded(!1),this._setError(!0))}.bind(this),this._resolvedSrc=""},_load:function(e){e?this.$.img.src=e:this.$.img.removeAttribute("src"),this.$.sizedImgDiv.style.backgroundImage=e?'url("'+e+'")':"",this._setLoading(!!e),this._setLoaded(!1),this._setError(!1)},_reset:function(){this.$.img.removeAttribute("src"),this.$.sizedImgDiv.style.backgroundImage="",this._setLoading(!1),this._setLoaded(!1),this._setError(!1)},_computePlaceholderHidden:function(){return!this.preload||!this.fade&&!this.loading&&this.loaded},_computePlaceholderClassName:function(){return this.preload&&this.fade&&!this.loading&&this.loaded?"faded-out":""},_computeImgDivHidden:function(){return!this.sizing},_computeImgDivARIAHidden:function(){return""===this.alt?"true":void 0},_computeImgDivARIALabel:function(){if(null!==this.alt)return this.alt;if(""===this.src)return"";var e=new URL(this._resolveSrc(this.src)).pathname.split("/");return e[e.length-1]},_computeImgHidden:function(){return!!this.sizing},_widthChanged:function(){this.style.width=isNaN(this.width)?this.width:this.width+"px"},_heightChanged:function(){this.style.height=isNaN(this.height)?this.height:this.height+"px"},_preventLoadChanged:function(){this.preventLoad||this.loaded||(this._reset(),this._load(this.src))},_srcChanged:function(e,t){var i=this._resolveSrc(e);i!==this._resolvedSrc&&(this._resolvedSrc=i,this._reset(),this.preventLoad||this._load(e))},_placeholderChanged:function(){this.$.placeholder.style.backgroundImage=this.placeholder?'url("'+this.placeholder+'")':""},_transformChanged:function(){var e=this.$.sizedImgDiv.style,t=this.$.placeholder.style;e.backgroundSize=t.backgroundSize=this.sizing,e.backgroundPosition=t.backgroundPosition=this.sizing?this.position:"",e.backgroundRepeat=t.backgroundRepeat=this.sizing?"no-repeat":""},_resolveSrc:function(e){var t=this.ownerDocument.baseURI;return new URL(Polymer.ResolveUrl.resolveUrl(e,t),t).href}}),Polymer({is:"paper-material",properties:{elevation:{type:Number,reflectToAttribute:!0,value:1},animated:{type:Boolean,reflectToAttribute:!0,value:!1}}}),Polymer({is:"paper-card",properties:{heading:{type:String,value:"",observer:"_headingChanged"},image:{type:String,value:""},alt:{type:String},preloadImage:{type:Boolean,value:!1},fadeImage:{type:Boolean,value:!1},placeholderImage:{type:String,value:null},elevation:{type:Number,value:1,reflectToAttribute:!0},animatedShadow:{type:Boolean,value:!1},animated:{type:Boolean,reflectToAttribute:!0,readOnly:!0,computed:"_computeAnimated(animatedShadow)"}},_isHidden:function(e){return e?"false":"true"},_headingChanged:function(e){this.getAttribute("aria-label");this.setAttribute("aria-label",e)},_computeHeadingClass:function(e){return e?" over-image":""},_computeAnimated:function(e){return e}}),"undefined"!=typeof module&&(module.exports=MakePromise),window.Promise||(window.Promise=MakePromise(Polymer.Base.async)),Polymer({is:"iron-request",hostAttributes:{hidden:!0},properties:{xhr:{type:Object,notify:!0,readOnly:!0,value:function(){return new XMLHttpRequest}},response:{type:Object,notify:!0,readOnly:!0,value:function(){return null}},status:{type:Number,notify:!0,readOnly:!0,value:0},statusText:{type:String,notify:!0,readOnly:!0,value:""},completes:{type:Object,readOnly:!0,notify:!0,value:function(){return new Promise(function(e,t){this.resolveCompletes=e,this.rejectCompletes=t}.bind(this))}},progress:{type:Object,notify:!0,readOnly:!0,value:function(){return{}}},aborted:{type:Boolean,notify:!0,readOnly:!0,value:!1},errored:{type:Boolean,notify:!0,readOnly:!0,value:!1},timedOut:{type:Boolean,notify:!0,readOnly:!0,value:!1}},get succeeded(){if(this.errored||this.aborted||this.timedOut)return!1;var e=this.xhr.status||0;return 0===e||e>=200&&e<300},send:function(e){var t=this.xhr;if(t.readyState>0)return null;t.addEventListener("progress",function(e){this._setProgress({lengthComputable:e.lengthComputable,loaded:e.loaded,total:e.total})}.bind(this)),t.addEventListener("error",function(e){this._setErrored(!0),this._updateStatus(),this.rejectCompletes(e)}.bind(this)),t.addEventListener("timeout",function(e){this._setTimedOut(!0),this._updateStatus(),this.rejectCompletes(e)}.bind(this)),t.addEventListener("abort",function(){this._updateStatus(),this.rejectCompletes(new Error("Request aborted."))}.bind(this)),t.addEventListener("loadend",function(){return this._updateStatus(),this._setResponse(this.parseResponse()),this.succeeded?void this.resolveCompletes(this):void this.rejectCompletes(new Error("The request failed with status code: "+this.xhr.status))}.bind(this)),this.url=e.url,t.open(e.method||"GET",e.url,e.async!==!1);var i={json:"application/json",text:"text/plain",html:"text/html",xml:"application/xml",arraybuffer:"application/octet-stream"}[e.handleAs],n=e.headers||Object.create(null),r=Object.create(null);for(var o in n)r[o.toLowerCase()]=n[o];if(n=r,i&&!n.accept&&(n.accept=i),Object.keys(n).forEach(function(e){/[A-Z]/.test(e)&&Polymer.Base._error("Headers must be lower case, got",e),t.setRequestHeader(e,n[e])},this),e.async!==!1){e.async&&(t.timeout=e.timeout);var s=e.handleAs;!e.jsonPrefix&&s||(s="text"),t.responseType=t._responseType=s,e.jsonPrefix&&(t._jsonPrefix=e.jsonPrefix)}t.withCredentials=!!e.withCredentials;var a=this._encodeBodyObject(e.body,n["content-type"]);return t.send(a),this.completes},parseResponse:function(){var e=this.xhr,t=e.responseType||e._responseType,i=!this.xhr.responseType,n=e._jsonPrefix&&e._jsonPrefix.length||0;try{switch(t){case"json":if(i||void 0===e.response)try{return JSON.parse(e.responseText)}catch(e){return null}return e.response;case"xml":return e.responseXML;case"blob":case"document":case"arraybuffer":return e.response;case"text":default:if(n)try{return JSON.parse(e.responseText.substring(n))}catch(e){return null}return e.responseText}}catch(e){this.rejectCompletes(new Error("Could not parse response. "+e.message))}},abort:function(){this._setAborted(!0),this.xhr.abort()},_encodeBodyObject:function(e,t){if("string"==typeof e)return e;var i=e;switch(t){case"application/json":return JSON.stringify(i);case"application/x-www-form-urlencoded":return this._wwwFormUrlEncode(i)}return e},_wwwFormUrlEncode:function(e){if(!e)return"";var t=[];return Object.keys(e).forEach(function(i){t.push(this._wwwFormUrlEncodePiece(i)+"="+this._wwwFormUrlEncodePiece(e[i]))},this),t.join("&")},_wwwFormUrlEncodePiece:function(e){return null===e?"":encodeURIComponent(e.toString().replace(/\r?\n/g,"\r\n")).replace(/%20/g,"+")},_updateStatus:function(){this._setStatus(this.xhr.status),this._setStatusText(void 0===this.xhr.statusText?"":this.xhr.statusText)}}),Polymer({is:"iron-ajax",hostAttributes:{hidden:!0},properties:{url:{type:String},params:{type:Object,value:function(){return{}}},method:{type:String,value:"GET"},headers:{type:Object,value:function(){return{}}},contentType:{type:String,value:null},body:{type:Object,value:null},sync:{type:Boolean,value:!1},handleAs:{type:String,value:"json"},withCredentials:{type:Boolean,value:!1},timeout:{type:Number,value:0},auto:{type:Boolean,value:!1},verbose:{type:Boolean,value:!1},lastRequest:{type:Object,notify:!0,readOnly:!0},loading:{type:Boolean,notify:!0,readOnly:!0},lastResponse:{type:Object,notify:!0,readOnly:!0},lastError:{type:Object,notify:!0,readOnly:!0},activeRequests:{type:Array,notify:!0,readOnly:!0,value:function(){return[]}},debounceDuration:{type:Number,value:0,notify:!0},jsonPrefix:{type:String,value:""},bubbles:{type:Boolean,value:!1},_boundHandleResponse:{type:Function,value:function(){return this._handleResponse.bind(this)}}},observers:["_requestOptionsChanged(url, method, params.*, headers, contentType, body, sync, handleAs, jsonPrefix, withCredentials, timeout, auto)"],get queryString(){var e,t,i=[];for(e in this.params)if(t=this.params[e],e=window.encodeURIComponent(e),Array.isArray(t))for(var n=0;n<t.length;n++)i.push(e+"="+window.encodeURIComponent(t[n]));else null!==t?i.push(e+"="+window.encodeURIComponent(t)):i.push(e);return i.join("&")},get requestUrl(){var e=this.queryString,t=this.url||"";if(e){var i=t.indexOf("?")>=0?"&":"?";return t+i+e}return t},get requestHeaders(){var e={},t=this.contentType;null==t&&"string"==typeof this.body&&(t="application/x-www-form-urlencoded"),t&&(e["content-type"]=t);var i;if(this.headers instanceof Object)for(i in this.headers)e[i]=this.headers[i].toString();return e},toRequestOptions:function(){return{url:this.requestUrl||"",method:this.method,headers:this.requestHeaders,body:this.body,async:!this.sync,handleAs:this.handleAs,jsonPrefix:this.jsonPrefix,withCredentials:this.withCredentials,timeout:this.timeout}},generateRequest:function(){var e=document.createElement("iron-request"),t=this.toRequestOptions();return this.push("activeRequests",e),e.completes.then(this._boundHandleResponse).catch(this._handleError.bind(this,e)).then(this._discardRequest.bind(this,e)),e.send(t),this._setLastRequest(e),this._setLoading(!0),this.fire("request",{request:e,options:t},{bubbles:this.bubbles}),this.fire("iron-ajax-request",{request:e,options:t},{bubbles:this.bubbles}),e},_handleResponse:function(e){e===this.lastRequest&&(this._setLastResponse(e.response),this._setLastError(null),this._setLoading(!1)),this.fire("response",e,{bubbles:this.bubbles}),this.fire("iron-ajax-response",e,{bubbles:this.bubbles})},_handleError:function(e,t){this.verbose&&Polymer.Base._error(t),e===this.lastRequest&&(this._setLastError({request:e,error:t,status:e.xhr.status,statusText:e.xhr.statusText,response:e.xhr.response}),this._setLastResponse(null),this._setLoading(!1)),this.fire("iron-ajax-error",{request:e,error:t},{bubbles:this.bubbles}),this.fire("error",{request:e,error:t},{bubbles:this.bubbles})},_discardRequest:function(e){var t=this.activeRequests.indexOf(e);t>-1&&this.splice("activeRequests",t,1)},_requestOptionsChanged:function(){this.debounce("generate-request",function(){null!=this.url&&this.auto&&this.generateRequest()},this.debounceDuration)}});var __decorate=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,s=3>o?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(3>o?r(s):o>3?r(t,i,s):r(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},BABYLON;!function(e){e.ToGammaSpace=1/2.2,e.ToLinearSpace=2.2,e.Epsilon=.001;var t=function(){function e(){}return e.WithinEpsilon=function(e,t,i){void 0===i&&(i=1.401298e-45);var n=e-t;return n>=-i&&i>=n},e.ToHex=function(e){var t=e.toString(16);return 15>=e?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=1),Math.min(i,Math.max(t,e))},e}();e.MathTools=t;var i=function(){function i(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),this.r=e,this.g=t,this.b=i}return i.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},i.prototype.getClassName=function(){return"Color3"},i.prototype.getHashCode=function(){var e=this.r||0;return e=397*e^(this.g||0),e=397*e^(this.b||0)},i.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},i.prototype.toColor4=function(e){return void 0===e&&(e=1),new n(this.r,this.g,this.b,e)},i.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},i.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},i.prototype.multiply=function(e){return new i(this.r*e.r,this.g*e.g,this.b*e.b)},i.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},i.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},i.prototype.equalsFloats=function(e,t,i){return this.r===e&&this.g===t&&this.b===i},i.prototype.scale=function(e){return new i(this.r*e,this.g*e,this.b*e)},i.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},i.prototype.add=function(e){return new i(this.r+e.r,this.g+e.g,this.b+e.b)},i.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},i.prototype.subtract=function(e){return new i(this.r-e.r,this.g-e.g,this.b-e.b)},i.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},i.prototype.clone=function(){return new i(this.r,this.g,this.b)},i.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},i.prototype.copyFromFloats=function(e,t,i){return this.r=e,this.g=t,this.b=i,this},i.prototype.toHexString=function(){var e=255*this.r|0,i=255*this.g|0,n=255*this.b|0;return"#"+t.ToHex(e)+t.ToHex(i)+t.ToHex(n)},i.prototype.toLinearSpace=function(){var e=new i;return this.toLinearSpaceToRef(e),e},i.prototype.toLinearSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToLinearSpace),t.g=Math.pow(this.g,e.ToLinearSpace),t.b=Math.pow(this.b,e.ToLinearSpace),this},i.prototype.toGammaSpace=function(){var e=new i;return this.toGammaSpaceToRef(e),e},i.prototype.toGammaSpaceToRef=function(t){return t.r=Math.pow(this.r,e.ToGammaSpace),t.g=Math.pow(this.g,e.ToGammaSpace),t.b=Math.pow(this.b,e.ToGammaSpace),this},i.FromHexString=function(e){if("#"!==e.substring(0,1)||7!==e.length)return new i(0,0,0);var t=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);return i.FromInts(t,n,r)},i.FromArray=function(e,t){return void 0===t&&(t=0),new i(e[t],e[t+1],e[t+2])},i.FromInts=function(e,t,n){return new i(e/255,t/255,n/255)},i.Lerp=function(e,t,n){var r=e.r+(t.r-e.r)*n,o=e.g+(t.g-e.g)*n,s=e.b+(t.b-e.b)*n;return new i(r,o,s)},i.Red=function(){return new i(1,0,0)},i.Green=function(){return new i(0,1,0)},i.Blue=function(){return new i(0,0,1)},i.Black=function(){return new i(0,0,0)},i.White=function(){return new i(1,1,1)},i.Purple=function(){return new i(.5,0,.5)},i.Magenta=function(){return new i(1,0,1)},i.Yellow=function(){return new i(1,1,0)},i.Gray=function(){return new i(.5,.5,.5)},i}();e.Color3=i;var n=function(){function e(e,t,i,n){this.r=e,this.g=t,this.b=i,this.a=n}return e.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){var e=this.r||0;return e=397*e^(this.g||0),e=397*e^(this.b||0),e=397*e^(this.a||0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.toHexString=function(){var e=255*this.r|0,i=255*this.g|0,n=255*this.b|0,r=255*this.a|0;return"#"+t.ToHex(e)+t.ToHex(i)+t.ToHex(n)+t.ToHex(r)},e.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length)return new e(0,0,0,0);var i=parseInt(t.substring(1,3),16),n=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16),o=parseInt(t.substring(7,9),16);return e.FromInts(i,n,r,o)},e.Lerp=function(t,i,n){var r=new e(0,0,0,0);return e.LerpToRef(t,i,n,r),r},e.LerpToRef=function(e,t,i,n){n.r=e.r+(t.r-e.r)*i,n.g=e.g+(t.g-e.g)*i,n.b=e.b+(t.b-e.b)*i,n.a=e.a+(t.a-e.a)*i},e.FromArray=function(t,i){return void 0===i&&(i=0),new e(t[i],t[i+1],t[i+2],t[i+3])},e.FromInts=function(t,i,n,r){return new e(t/255,i/255,n/255,r/255)},e.CheckColors4=function(e,t){if(e.length===3*t){for(var i=[],n=0;n<e.length;n+=3){var r=n/3*4;i[r]=e[n],i[r+1]=e[n+1],i[r+2]=e[n+2],i[r+3]=1}return i}return e},e}();e.Color4=n;var r=function(){function i(e,t){this.x=e,this.y=t}return i.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},i.prototype.getClassName=function(){return"Vector2"},i.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0)},i.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},i.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},i.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},i.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},i.prototype.add=function(e){return new i(this.x+e.x,this.y+e.y)},i.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},i.prototype.addVector3=function(e){return new i(this.x+e.x,this.y+e.y)},i.prototype.subtract=function(e){return new i(this.x-e.x,this.y-e.y)},i.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},i.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},i.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},i.prototype.multiply=function(e){return new i(this.x*e.x,this.y*e.y)},i.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},i.prototype.multiplyByFloats=function(e,t){return new i(this.x*e,this.y*t)},i.prototype.divide=function(e){return new i(this.x/e.x,this.y/e.y)},i.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},i.prototype.negate=function(){return new i(-this.x,-this.y)},i.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},i.prototype.scale=function(e){return new i(this.x*e,this.y*e)},i.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},i.prototype.equalsWithEpsilon=function(i,n){return void 0===n&&(n=e.Epsilon),i&&t.WithinEpsilon(this.x,i.x,n)&&t.WithinEpsilon(this.y,i.y,n)},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.Zero=function(){return new i(0,0)},i.FromArray=function(e,t){return void 0===t&&(t=0),new i(e[t],e[t+1])},i.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1]},i.CatmullRom=function(e,t,n,r,o){var s=o*o,a=o*s,h=.5*(2*t.x+(-e.x+n.x)*o+(2*e.x-5*t.x+4*n.x-r.x)*s+(-e.x+3*t.x-3*n.x+r.x)*a),l=.5*(2*t.y+(-e.y+n.y)*o+(2*e.y-5*t.y+4*n.y-r.y)*s+(-e.y+3*t.y-3*n.y+r.y)*a);return new i(h,l)},i.Clamp=function(e,t,n){var r=e.x;r=r>n.x?n.x:r,r=r<t.x?t.x:r;var o=e.y;return o=o>n.y?n.y:o,o=o<t.y?t.y:o,new i(r,o)},i.Hermite=function(e,t,n,r,o){var s=o*o,a=o*s,h=2*a-3*s+1,l=-2*a+3*s,c=a-2*s+o,u=a-s,d=e.x*h+n.x*l+t.x*c+r.x*u,f=e.y*h+n.y*l+t.y*c+r.y*u;return new i(d,f)},i.Lerp=function(e,t,n){var r=e.x+(t.x-e.x)*n,o=e.y+(t.y-e.y)*n;return new i(r,o)},i.Dot=function(e,t){return e.x*t.x+e.y*t.y},i.Normalize=function(e){var t=e.clone();return t.normalize(),t},i.Minimize=function(e,t){var n=e.x<t.x?e.x:t.x,r=e.y<t.y?e.y:t.y;return new i(n,r)},i.Maximize=function(e,t){var n=e.x>t.x?e.x:t.x,r=e.y>t.y?e.y:t.y;return new i(n,r)},i.Transform=function(e,t){var n=i.Zero();return i.TransformToRef(e,t,n),n},i.TransformToRef=function(e,t,i){var n=e.x*t.m[0]+e.y*t.m[4]+t.m[12],r=e.x*t.m[1]+e.y*t.m[5]+t.m[13];i.x=n,i.y=r},i.PointInTriangle=function(e,t,i,n){var r=.5*(-i.y*n.x+t.y*(-i.x+n.x)+t.x*(i.y-n.y)+i.x*n.y),o=0>r?-1:1,s=(t.y*n.x-t.x*n.y+(n.y-t.y)*e.x+(t.x-n.x)*e.y)*o,a=(t.x*i.y-t.y*i.x+(t.y-i.y)*e.x+(i.x-t.x)*e.y)*o;return s>0&&a>0&&2*r*o>s+a},i.Distance=function(e,t){return Math.sqrt(i.DistanceSquared(e,t))},i.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},i.DistanceOfPointFromSegment=function(e,t,n){var r=i.DistanceSquared(t,n);if(0===r)return i.Distance(e,t);var o=n.subtract(t),s=Math.max(0,Math.min(1,i.Dot(e.subtract(t),o)/r)),a=t.add(o.multiplyByFloats(s,s));return i.Distance(e,a)},i}();e.Vector2=r;var o=function(){function i(e,t,i){this.x=e,this.y=t,this.z=i}return i.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},i.prototype.getClassName=function(){return"Vector3"},i.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0),e=397*e^(this.z||0)},i.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},i.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,this},i.prototype.toQuaternion=function(){var e=new h(0,0,0,1),t=Math.cos(.5*(this.x+this.z)),i=Math.sin(.5*(this.x+this.z)),n=Math.cos(.5*(this.z-this.x)),r=Math.sin(.5*(this.z-this.x)),o=Math.cos(.5*this.y),s=Math.sin(.5*this.y);return e.x=n*s,e.y=-r*s,e.z=i*o,e.w=t*o,e},i.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},i.prototype.add=function(e){return new i(this.x+e.x,this.y+e.y,this.z+e.z)},i.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,this},i.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},i.prototype.subtract=function(e){return new i(this.x-e.x,this.y-e.y,this.z-e.z)},i.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,this},i.prototype.subtractFromFloats=function(e,t,n){return new i(this.x-e,this.y-t,this.z-n)},i.prototype.subtractFromFloatsToRef=function(e,t,i,n){
return n.x=this.x-e,n.y=this.y-t,n.z=this.z-i,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z)},i.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},i.prototype.scale=function(e){return new i(this.x*e,this.y*e,this.z*e)},i.prototype.scaleToRef=function(e,t){t.x=this.x*e,t.y=this.y*e,t.z=this.z*e},i.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z},i.prototype.equalsWithEpsilon=function(i,n){return void 0===n&&(n=e.Epsilon),i&&t.WithinEpsilon(this.x,i.x,n)&&t.WithinEpsilon(this.y,i.y,n)&&t.WithinEpsilon(this.z,i.z,n)},i.prototype.equalsToFloats=function(e,t,i){return this.x===e&&this.y===t&&this.z===i},i.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this},i.prototype.multiply=function(e){return new i(this.x*e.x,this.y*e.y,this.z*e.z)},i.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,this},i.prototype.multiplyByFloats=function(e,t,n){return new i(this.x*e,this.y*t,this.z*n)},i.prototype.divide=function(e){return new i(this.x/e.x,this.y/e.y,this.z/e.z)},i.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,this},i.prototype.MinimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),this},i.prototype.MaximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var e=this.length();if(0===e||1===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},i.prototype.copyFromFloats=function(e,t,i){return this.x=e,this.y=t,this.z=i,this},i.GetClipFactor=function(e,t,n,r){var o=i.Dot(e,n)-r,s=i.Dot(t,n)-r,a=o/(o-s);return a},i.FromArray=function(e,t){return t||(t=0),new i(e[t],e[t+1],e[t+2])},i.FromFloatArray=function(e,t){return t||(t=0),new i(e[t],e[t+1],e[t+2])},i.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},i.FromFloatArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2]},i.FromFloatsToRef=function(e,t,i,n){n.x=e,n.y=t,n.z=i},i.Zero=function(){return new i(0,0,0)},i.Up=function(){return new i(0,1,0)},i.TransformCoordinates=function(e,t){var n=i.Zero();return i.TransformCoordinatesToRef(e,t,n),n},i.TransformCoordinatesToRef=function(e,t,i){var n=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8]+t.m[12],r=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9]+t.m[13],o=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]+t.m[14],s=e.x*t.m[3]+e.y*t.m[7]+e.z*t.m[11]+t.m[15];i.x=n/s,i.y=r/s,i.z=o/s},i.TransformCoordinatesFromFloatsToRef=function(e,t,i,n,r){var o=e*n.m[0]+t*n.m[4]+i*n.m[8]+n.m[12],s=e*n.m[1]+t*n.m[5]+i*n.m[9]+n.m[13],a=e*n.m[2]+t*n.m[6]+i*n.m[10]+n.m[14],h=e*n.m[3]+t*n.m[7]+i*n.m[11]+n.m[15];r.x=o/h,r.y=s/h,r.z=a/h},i.TransformNormal=function(e,t){var n=i.Zero();return i.TransformNormalToRef(e,t,n),n},i.TransformNormalToRef=function(e,t,i){i.x=e.x*t.m[0]+e.y*t.m[4]+e.z*t.m[8],i.y=e.x*t.m[1]+e.y*t.m[5]+e.z*t.m[9],i.z=e.x*t.m[2]+e.y*t.m[6]+e.z*t.m[10]},i.TransformNormalFromFloatsToRef=function(e,t,i,n,r){r.x=e*n.m[0]+t*n.m[4]+i*n.m[8],r.y=e*n.m[1]+t*n.m[5]+i*n.m[9],r.z=e*n.m[2]+t*n.m[6]+i*n.m[10]},i.CatmullRom=function(e,t,n,r,o){var s=o*o,a=o*s,h=.5*(2*t.x+(-e.x+n.x)*o+(2*e.x-5*t.x+4*n.x-r.x)*s+(-e.x+3*t.x-3*n.x+r.x)*a),l=.5*(2*t.y+(-e.y+n.y)*o+(2*e.y-5*t.y+4*n.y-r.y)*s+(-e.y+3*t.y-3*n.y+r.y)*a),c=.5*(2*t.z+(-e.z+n.z)*o+(2*e.z-5*t.z+4*n.z-r.z)*s+(-e.z+3*t.z-3*n.z+r.z)*a);return new i(h,l,c)},i.Clamp=function(e,t,n){var r=e.x;r=r>n.x?n.x:r,r=r<t.x?t.x:r;var o=e.y;o=o>n.y?n.y:o,o=o<t.y?t.y:o;var s=e.z;return s=s>n.z?n.z:s,s=s<t.z?t.z:s,new i(r,o,s)},i.Hermite=function(e,t,n,r,o){var s=o*o,a=o*s,h=2*a-3*s+1,l=-2*a+3*s,c=a-2*s+o,u=a-s,d=e.x*h+n.x*l+t.x*c+r.x*u,f=e.y*h+n.y*l+t.y*c+r.y*u,p=e.z*h+n.z*l+t.z*c+r.z*u;return new i(d,f,p)},i.Lerp=function(e,t,n){var r=e.x+(t.x-e.x)*n,o=e.y+(t.y-e.y)*n,s=e.z+(t.z-e.z)*n;return new i(r,o,s)},i.Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},i.Cross=function(e,t){var n=i.Zero();return i.CrossToRef(e,t,n),n},i.CrossToRef=function(e,t,i){E.Vector3[0].x=e.y*t.z-e.z*t.y,E.Vector3[0].y=e.z*t.x-e.x*t.z,E.Vector3[0].z=e.x*t.y-e.y*t.x,i.copyFrom(E.Vector3[0])},i.Normalize=function(e){var t=i.Zero();return i.NormalizeToRef(e,t),t},i.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},i.Project=function(e,t,n,r){var o=r.width,s=r.height,a=r.x,h=r.y,c=l.FromValues(o/2,0,0,0,0,-s/2,0,0,0,0,1,0,a+o/2,s/2+h,0,1),u=t.multiply(n).multiply(c);return i.TransformCoordinates(e,u)},i.UnprojectFromTransform=function(e,n,r,o,s){var a=o.multiply(s);a.invert(),e.x=e.x/n*2-1,e.y=-(e.y/r*2-1);var h=i.TransformCoordinates(e,a),l=e.x*a.m[3]+e.y*a.m[7]+e.z*a.m[11]+a.m[15];return t.WithinEpsilon(l,1)&&(h=h.scale(1/l)),h},i.Unproject=function(e,n,r,o,s,a){var h=o.multiply(s).multiply(a);h.invert();var l=new i(e.x/n*2-1,-(e.y/r*2-1),e.z),c=i.TransformCoordinates(l,h),u=l.x*h.m[3]+l.y*h.m[7]+l.z*h.m[11]+h.m[15];return t.WithinEpsilon(u,1)&&(c=c.scale(1/u)),c},i.Minimize=function(e,t){var i=e.clone();return i.MinimizeInPlace(t),i},i.Maximize=function(e,t){var i=e.clone();return i.MaximizeInPlace(t),i},i.Distance=function(e,t){return Math.sqrt(i.DistanceSquared(e,t))},i.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z;return i*i+n*n+r*r},i.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},i.RotationFromAxis=function(e,t,n){var r=i.Zero();return i.RotationFromAxisToRef(e,t,n,r),r},i.RotationFromAxisToRef=function(n,r,o,s){var a=n.normalize(),h=o.normalize(),l=f.X,c=f.Y,u=0,d=0,p=0,_=0,m=0,g=0,v=0,y=-1,b=0,x=E.Vector3[0],P=0,A=E.Vector3[1];t.WithinEpsilon(h.z,0,e.Epsilon)?g=1:t.WithinEpsilon(h.x,0,e.Epsilon)?_=1:(v=h.z/h.x,_=-v*Math.sqrt(1/(1+v*v)),g=Math.sqrt(1/(1+v*v))),A.x=_,A.y=m,A.z=g,A.normalize(),i.CrossToRef(a,A,x),x.normalize(),i.Dot(h,x)<0&&(y=1),P=i.Dot(a,A),P=Math.min(1,Math.max(-1,P)),p=Math.acos(P)*y,i.Dot(A,l)<0&&(p=Math.PI+p,A=A.scaleInPlace(-1),b++);var C=E.Vector3[2],T=E.Vector3[3];_=0,m=0,g=0,y=-1,t.WithinEpsilon(h.z,0,e.Epsilon)?_=1:(v=A.z/A.x,_=-v*Math.sqrt(1/(1+v*v)),g=Math.sqrt(1/(1+v*v))),C.x=_,C.y=m,C.z=g,C.normalize(),i.CrossToRef(C,A,T),T.normalize(),i.CrossToRef(h,C,x),x.normalize(),i.Dot(A,x)<0&&(y=1),P=i.Dot(h,C),P=Math.min(1,Math.max(-1,P)),d=Math.acos(P)*y,i.Dot(T,c)<0&&(d=Math.PI+d,b++),y=-1,i.CrossToRef(l,A,x),x.normalize(),i.Dot(x,c)<0&&(y=1),P=i.Dot(A,l),P=Math.min(1,Math.max(-1,P)),u=-Math.acos(P)*y,0>P&&2>b&&(u=Math.PI+u),s.x=d,s.y=u,s.z=p},i}();e.Vector3=o;var s=function(){function i(e,t,i,n){this.x=e,this.y=t,this.z=i,this.w=n}return i.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},i.prototype.getClassName=function(){return"Vector4"},i.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0),e=397*e^(this.z||0),e=397*e^(this.w||0)},i.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},i.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},i.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},i.prototype.add=function(e){return new i(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},i.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},i.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},i.prototype.subtract=function(e){return new i(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},i.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},i.prototype.subtractFromFloats=function(e,t,n,r){return new i(this.x-e,this.y-t,this.z-n,this.w-r)},i.prototype.subtractFromFloatsToRef=function(e,t,i,n,r){return r.x=this.x-e,r.y=this.y-t,r.z=this.z-i,r.w=this.w-n,this},i.prototype.negate=function(){return new i(-this.x,-this.y,-this.z,-this.w)},i.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},i.prototype.scale=function(e){return new i(this.x*e,this.y*e,this.z*e,this.w*e)},i.prototype.scaleToRef=function(e,t){t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e},i.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},i.prototype.equalsWithEpsilon=function(i,n){return void 0===n&&(n=e.Epsilon),i&&t.WithinEpsilon(this.x,i.x,n)&&t.WithinEpsilon(this.y,i.y,n)&&t.WithinEpsilon(this.z,i.z,n)&&t.WithinEpsilon(this.w,i.w,n)},i.prototype.equalsToFloats=function(e,t,i,n){return this.x===e&&this.y===t&&this.z===i&&this.w===n},i.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},i.prototype.multiply=function(e){return new i(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},i.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},i.prototype.multiplyByFloats=function(e,t,n,r){return new i(this.x*e,this.y*t,this.z*n,this.w*r)},i.prototype.divide=function(e){return new i(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},i.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},i.prototype.MinimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},i.prototype.MaximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},i.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},i.prototype.toVector3=function(){return new o(this.x,this.y,this.z)},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},i.prototype.copyFromFloats=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},i.FromArray=function(e,t){return t||(t=0),new i(e[t],e[t+1],e[t+2],e[t+3])},i.FromArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},i.FromFloatArrayToRef=function(e,t,i){i.x=e[t],i.y=e[t+1],i.z=e[t+2],i.w=e[t+3]},i.FromFloatsToRef=function(e,t,i,n,r){r.x=e,r.y=t,r.z=i,r.w=n},i.Zero=function(){return new i(0,0,0,0)},i.Normalize=function(e){var t=i.Zero();return i.NormalizeToRef(e,t),t},i.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},i.Minimize=function(e,t){var i=e.clone();return i.MinimizeInPlace(t),i},i.Maximize=function(e,t){var i=e.clone();return i.MaximizeInPlace(t),i},i.Distance=function(e,t){return Math.sqrt(i.DistanceSquared(e,t))},i.DistanceSquared=function(e,t){var i=e.x-t.x,n=e.y-t.y,r=e.z-t.z,o=e.w-t.w;return i*i+n*n+r*r+o*o},i.Center=function(e,t){var i=e.add(t);return i.scaleInPlace(.5),i},i}();e.Vector4=s;var a=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){var e=this.width||0;return e=397*e^(this.height||0)},e.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(e){return!!e&&(this.width===e.width&&this.height===e.height)},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(t){var i=new e(this.width+t.width,this.height+t.height);return i},e.prototype.substract=function(t){var i=new e(this.width-t.width,this.height-t.height);return i},e.Lerp=function(t,i,n){var r=t.width+(i.width-t.width)*n,o=t.height+(i.height-t.height)*n;return new e(r,o)},e}();e.Size=a;var h=function(){function e(e,t,i,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=1),this.x=e,this.y=t,this.z=i,this.w=n}return e.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var e=this.x||0;return e=397*e^(this.y||0),e=397*e^(this.z||0),e=397*e^(this.w||0)},e.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.multiply=function(t){var i=new e(0,0,0,1);return this.multiplyToRef(t,i),i},e.prototype.multiplyToRef=function(e,t){var i=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,n=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,r=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,o=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;return t.copyFromFloats(i,n,r,o),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){var t=new e(-this.x,-this.y,-this.z,this.w);return t},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.normalize=function(){var e=1/this.length();return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.toEulerAngles=function(e){void 0===e&&(e="YZX");var t=o.Zero();return this.toEulerAnglesToRef(t,e),t},e.prototype.toEulerAnglesToRef=function(e,t){void 0===t&&(t="YZX");var i,n,r,o=this.x,s=this.y,a=this.z,h=this.w;switch(t){case"YZX":var l=o*s+a*h;if(l>.499&&(i=2*Math.atan2(o,h),n=Math.PI/2,r=0),-.499>l&&(i=-2*Math.atan2(o,h),n=-Math.PI/2,r=0),isNaN(i)){var c=o*o,u=s*s,d=a*a;i=Math.atan2(2*s*h-2*o*a,1-2*u-2*d),n=Math.asin(2*l),r=Math.atan2(2*o*h-2*s*a,1-2*c-2*d)}break;default:throw new Error("Euler order "+t+" not supported yet.")}return e.y=i,e.z=n,e.x=r,this},e.prototype.toRotationMatrix=function(e){var t=this.x*this.x,i=this.y*this.y,n=this.z*this.z,r=this.x*this.y,o=this.z*this.w,s=this.z*this.x,a=this.y*this.w,h=this.y*this.z,l=this.x*this.w;return e.m[0]=1-2*(i+n),e.m[1]=2*(r+o),e.m[2]=2*(s-a),e.m[3]=0,e.m[4]=2*(r-o),e.m[5]=1-2*(n+t),e.m[6]=2*(h+l),e.m[7]=0,e.m[8]=2*(s+a),e.m[9]=2*(h-l),e.m[10]=1-2*(i+t),e.m[11]=0,e.m[12]=0,e.m[13]=0,e.m[14]=0,e.m[15]=1,this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var i=new e;return e.FromRotationMatrixToRef(t,i),i},e.FromRotationMatrixToRef=function(e,t){var i,n=e.m,r=n[0],o=n[4],s=n[8],a=n[1],h=n[5],l=n[9],c=n[2],u=n[6],d=n[10],f=r+h+d;f>0?(i=.5/Math.sqrt(f+1),t.w=.25/i,t.x=(u-l)*i,t.y=(s-c)*i,t.z=(a-o)*i):r>h&&r>d?(i=2*Math.sqrt(1+r-h-d),t.w=(u-l)/i,t.x=.25*i,t.y=(o+a)/i,t.z=(s+c)/i):h>d?(i=2*Math.sqrt(1+h-r-d),t.w=(s-c)/i,t.x=(o+a)/i,t.y=.25*i,t.z=(l+u)/i):(i=2*Math.sqrt(1+d-r-h),t.w=(a-o)/i,t.x=(s+c)/i,t.y=(l+u)/i,t.z=.25*i)},e.Inverse=function(t){return new e(-t.x,-t.y,-t.z,t.w)},e.Identity=function(){return new e(0,0,0,1)},e.RotationAxis=function(t,i){var n=new e,r=Math.sin(i/2);return t.normalize(),n.w=Math.cos(i/2),n.x=t.x*r,n.y=t.y*r,n.z=t.z*r,n},e.FromArray=function(t,i){return i||(i=0),new e(t[i],t[i+1],t[i+2],t[i+3])},e.RotationYawPitchRoll=function(t,i,n){var r=new e;return e.RotationYawPitchRollToRef(t,i,n,r),r},e.RotationYawPitchRollToRef=function(e,t,i,n){var r=.5*i,o=.5*t,s=.5*e,a=Math.sin(r),h=Math.cos(r),l=Math.sin(o),c=Math.cos(o),u=Math.sin(s),d=Math.cos(s);n.x=d*l*h+u*c*a,n.y=u*c*h-d*l*a,n.z=d*c*a-u*l*h,n.w=d*c*h+u*l*a},e.RotationAlphaBetaGamma=function(t,i,n){var r=new e;return e.RotationAlphaBetaGammaToRef(t,i,n,r),r},e.RotationAlphaBetaGammaToRef=function(e,t,i,n){var r=.5*(i+e),o=.5*(i-e),s=.5*t;n.x=Math.cos(o)*Math.sin(s),n.y=Math.sin(o)*Math.sin(s),n.z=Math.sin(r)*Math.cos(s),n.w=Math.cos(r)*Math.cos(s)},e.Slerp=function(t,i,n){var r,o,s=n,a=t.x*i.x+t.y*i.y+t.z*i.z+t.w*i.w,h=!1;if(0>a&&(h=!0,a=-a),a>.999999)o=1-s,r=h?-s:s;else{var l=Math.acos(a),c=1/Math.sin(l);o=Math.sin((1-s)*l)*c,r=h?-Math.sin(s*l)*c:Math.sin(s*l)*c}return new e(o*t.x+r*i.x,o*t.y+r*i.y,o*t.z+r*i.z,o*t.w+r*i.w)},e}();e.Quaternion=h;var l=function(){function e(){this.m=new Float32Array(16)}return e.prototype.isIdentity=function(){return 1===this.m[0]&&1===this.m[5]&&1===this.m[10]&&1===this.m[15]&&(0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14])},e.prototype.determinant=function(){var e=this.m[10]*this.m[15]-this.m[11]*this.m[14],t=this.m[9]*this.m[15]-this.m[11]*this.m[13],i=this.m[9]*this.m[14]-this.m[10]*this.m[13],n=this.m[8]*this.m[15]-this.m[11]*this.m[12],r=this.m[8]*this.m[14]-this.m[10]*this.m[12],o=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*e-this.m[6]*t+this.m[7]*i)-this.m[1]*(this.m[4]*e-this.m[6]*n+this.m[7]*r)+this.m[2]*(this.m[4]*t-this.m[5]*n+this.m[7]*o)-this.m[3]*(this.m[4]*i-this.m[5]*r+this.m[6]*o)},e.prototype.toArray=function(){return this.m},e.prototype.asArray=function(){return this.toArray()},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){for(var e=0;16>e;e++)this.m[e]=0;return this},e.prototype.add=function(t){var i=new e;return this.addToRef(t,i),i},e.prototype.addToRef=function(e,t){for(var i=0;16>i;i++)t.m[i]=this.m[i]+e.m[i];return this},e.prototype.addToSelf=function(e){for(var t=0;16>t;t++)this.m[t]+=e.m[t];return this},e.prototype.invertToRef=function(e){var t=this.m[0],i=this.m[1],n=this.m[2],r=this.m[3],o=this.m[4],s=this.m[5],a=this.m[6],h=this.m[7],l=this.m[8],c=this.m[9],u=this.m[10],d=this.m[11],f=this.m[12],p=this.m[13],_=this.m[14],m=this.m[15],g=u*m-d*_,v=c*m-d*p,y=c*_-u*p,b=l*m-d*f,x=l*_-u*f,P=l*p-c*f,A=s*g-a*v+h*y,C=-(o*g-a*b+h*x),E=o*v-s*b+h*P,T=-(o*y-s*x+a*P),S=1/(t*A+i*C+n*E+r*T),M=a*m-h*_,I=s*m-h*p,w=s*_-a*p,R=o*m-h*f,D=o*_-a*f,O=o*p-s*f,L=a*d-h*u,B=s*d-h*c,N=s*u-a*c,F=o*d-h*l,V=o*u-a*l,k=o*c-s*l;return e.m[0]=A*S,e.m[4]=C*S,e.m[8]=E*S,e.m[12]=T*S,e.m[1]=-(i*g-n*v+r*y)*S,e.m[5]=(t*g-n*b+r*x)*S,e.m[9]=-(t*v-i*b+r*P)*S,e.m[13]=(t*y-i*x+n*P)*S,e.m[2]=(i*M-n*I+r*w)*S,e.m[6]=-(t*M-n*R+r*D)*S,e.m[10]=(t*I-i*R+r*O)*S,e.m[14]=-(t*w-i*D+n*O)*S,e.m[3]=-(i*L-n*B+r*N)*S,e.m[7]=(t*L-n*F+r*V)*S,e.m[11]=-(t*B-i*F+r*k)*S,e.m[15]=(t*N-i*V+n*k)*S,this},e.prototype.setTranslation=function(e){return this.m[12]=e.x,this.m[13]=e.y,this.m[14]=e.z,this},e.prototype.getTranslation=function(){return new o(this.m[12],this.m[13],this.m[14])},e.prototype.multiply=function(t){var i=new e;return this.multiplyToRef(t,i),i},e.prototype.copyFrom=function(e){for(var t=0;16>t;t++)this.m[t]=e.m[t];return this},e.prototype.copyToArray=function(e,t){void 0===t&&(t=0);for(var i=0;16>i;i++)e[t+i]=this.m[i];return this},e.prototype.multiplyToRef=function(e,t){return this.multiplyToArray(e,t.m,0),this},e.prototype.multiplyToArray=function(e,t,i){var n=this.m[0],r=this.m[1],o=this.m[2],s=this.m[3],a=this.m[4],h=this.m[5],l=this.m[6],c=this.m[7],u=this.m[8],d=this.m[9],f=this.m[10],p=this.m[11],_=this.m[12],m=this.m[13],g=this.m[14],v=this.m[15],y=e.m[0],b=e.m[1],x=e.m[2],P=e.m[3],A=e.m[4],C=e.m[5],E=e.m[6],T=e.m[7],S=e.m[8],M=e.m[9],I=e.m[10],w=e.m[11],R=e.m[12],D=e.m[13],O=e.m[14],L=e.m[15];return t[i]=n*y+r*A+o*S+s*R,t[i+1]=n*b+r*C+o*M+s*D,t[i+2]=n*x+r*E+o*I+s*O,t[i+3]=n*P+r*T+o*w+s*L,t[i+4]=a*y+h*A+l*S+c*R,t[i+5]=a*b+h*C+l*M+c*D,t[i+6]=a*x+h*E+l*I+c*O,t[i+7]=a*P+h*T+l*w+c*L,t[i+8]=u*y+d*A+f*S+p*R,t[i+9]=u*b+d*C+f*M+p*D,t[i+10]=u*x+d*E+f*I+p*O,t[i+11]=u*P+d*T+f*w+p*L,t[i+12]=_*y+m*A+g*S+v*R,t[i+13]=_*b+m*C+g*M+v*D,t[i+14]=_*x+m*E+g*I+v*O,t[i+15]=_*P+m*T+g*w+v*L,this},e.prototype.equals=function(e){return e&&this.m[0]===e.m[0]&&this.m[1]===e.m[1]&&this.m[2]===e.m[2]&&this.m[3]===e.m[3]&&this.m[4]===e.m[4]&&this.m[5]===e.m[5]&&this.m[6]===e.m[6]&&this.m[7]===e.m[7]&&this.m[8]===e.m[8]&&this.m[9]===e.m[9]&&this.m[10]===e.m[10]&&this.m[11]===e.m[11]&&this.m[12]===e.m[12]&&this.m[13]===e.m[13]&&this.m[14]===e.m[14]&&this.m[15]===e.m[15]},e.prototype.clone=function(){return e.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=this.m[0]||0,t=1;16>t;t++)e=397*e^(this.m[t]||0);return e},e.prototype.decompose=function(i,n,r){r.x=this.m[12],r.y=this.m[13],r.z=this.m[14];var o=t.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,s=t.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,a=t.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(i.x=o*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),i.y=s*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),i.z=a*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===i.x||0===i.y||0===i.z)return n.x=0,n.y=0,n.z=0,n.w=1,!1;var l=e.FromValues(this.m[0]/i.x,this.m[1]/i.x,this.m[2]/i.x,0,this.m[4]/i.y,this.m[5]/i.y,this.m[6]/i.y,0,this.m[8]/i.z,this.m[9]/i.z,this.m[10]/i.z,0,0,0,0,1);return h.FromRotationMatrixToRef(l,n),!0},e.FromArray=function(t,i){var n=new e;return i||(i=0),e.FromArrayToRef(t,i,n),n},e.FromArrayToRef=function(e,t,i){for(var n=0;16>n;n++)i.m[n]=e[n+t]},e.FromFloat32ArrayToRefScaled=function(e,t,i,n){for(var r=0;16>r;r++)n.m[r]=e[r+t]*i},e.FromValuesToRef=function(e,t,i,n,r,o,s,a,h,l,c,u,d,f,p,_,m){m.m[0]=e,m.m[1]=t,m.m[2]=i,m.m[3]=n,m.m[4]=r,m.m[5]=o,m.m[6]=s,m.m[7]=a,m.m[8]=h,m.m[9]=l,m.m[10]=c,m.m[11]=u,m.m[12]=d,m.m[13]=f,m.m[14]=p,m.m[15]=_},e.prototype.getRow=function(e){if(0>e||e>3)return null;var t=4*e;return new s(this.m[t+0],this.m[t+1],this.m[t+2],this.m[t+3])},e.prototype.setRow=function(e,t){if(0>e||e>3)return this;var i=4*e;return this.m[i+0]=t.x,this.m[i+1]=t.y,this.m[i+2]=t.z,this.m[i+3]=t.w,this},e.FromValues=function(t,i,n,r,o,s,a,h,l,c,u,d,f,p,_,m){var g=new e;return g.m[0]=t,g.m[1]=i,g.m[2]=n,g.m[3]=r,g.m[4]=o,g.m[5]=s,g.m[6]=a,g.m[7]=h,g.m[8]=l,g.m[9]=c,g.m[10]=u,g.m[11]=d,g.m[12]=f,g.m[13]=p,g.m[14]=_,g.m[15]=m,g},e.Compose=function(t,i,n){var r=e.FromValues(t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1),o=e.Identity();return i.toRotationMatrix(o),r=r.multiply(o),r.setTranslation(n),r},e.Identity=function(){return e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t)},e.Zero=function(){return e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},e.RotationX=function(t){var i=new e;return e.RotationXToRef(t,i),i},e.Invert=function(t){var i=new e;return t.invertToRef(i),i},e.RotationXToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);t.m[0]=1,t.m[15]=1,t.m[5]=n,t.m[10]=n,t.m[9]=-i,t.m[6]=i,t.m[1]=0,t.m[2]=0,t.m[3]=0,t.m[4]=0,t.m[7]=0,t.m[8]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},e.RotationY=function(t){var i=new e;return e.RotationYToRef(t,i),i},e.RotationYToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);t.m[5]=1,t.m[15]=1,t.m[0]=n,t.m[2]=-i,t.m[8]=i,t.m[10]=n,t.m[1]=0,t.m[3]=0,t.m[4]=0,t.m[6]=0,t.m[7]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},e.RotationZ=function(t){var i=new e;return e.RotationZToRef(t,i),i},e.RotationZToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);t.m[10]=1,t.m[15]=1,t.m[0]=n,t.m[1]=i,t.m[4]=-i,t.m[5]=n,t.m[2]=0,t.m[3]=0,t.m[6]=0,t.m[7]=0,t.m[8]=0,t.m[9]=0,t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0},e.RotationAxis=function(t,i){var n=e.Zero();return e.RotationAxisToRef(t,i,n),n},e.RotationAxisToRef=function(e,t,i){var n=Math.sin(-t),r=Math.cos(-t),o=1-r;e.normalize(),i.m[0]=e.x*e.x*o+r,i.m[1]=e.x*e.y*o-e.z*n,i.m[2]=e.x*e.z*o+e.y*n,i.m[3]=0,i.m[4]=e.y*e.x*o+e.z*n,i.m[5]=e.y*e.y*o+r,i.m[6]=e.y*e.z*o-e.x*n,i.m[7]=0,i.m[8]=e.z*e.x*o-e.y*n,i.m[9]=e.z*e.y*o+e.x*n,i.m[10]=e.z*e.z*o+r,i.m[11]=0,i.m[15]=1},e.RotationYawPitchRoll=function(t,i,n){var r=new e;return e.RotationYawPitchRollToRef(t,i,n,r),r},e.RotationYawPitchRollToRef=function(e,t,i,n){h.RotationYawPitchRollToRef(e,t,i,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(n)},e.Scaling=function(t,i,n){var r=e.Zero();return e.ScalingToRef(t,i,n,r),r},e.ScalingToRef=function(e,t,i,n){n.m[0]=e,n.m[1]=0,n.m[2]=0,n.m[3]=0,n.m[4]=0,n.m[5]=t,n.m[6]=0,n.m[7]=0,n.m[8]=0,n.m[9]=0,n.m[10]=i,n.m[11]=0,n.m[12]=0,n.m[13]=0,n.m[14]=0,n.m[15]=1},e.Translation=function(t,i,n){var r=e.Identity();return e.TranslationToRef(t,i,n,r),r},e.TranslationToRef=function(t,i,n,r){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,i,n,1,r)},e.Lerp=function(t,i,n){for(var r=e.Zero(),o=0;16>o;o++)r.m[o]=t.m[o]*(1-n)+i.m[o]*n;return r},e.DecomposeLerp=function(t,i,n){var r=new o(0,0,0),s=new h,a=new o(0,0,0);t.decompose(r,s,a);var l=new o(0,0,0),c=new h,u=new o(0,0,0);i.decompose(l,c,u);var d=o.Lerp(r,l,n),f=h.Slerp(s,c,n),p=o.Lerp(a,u,n);return e.Compose(d,f,p)},e.LookAtLH=function(t,i,n){var r=e.Zero();return e.LookAtLHToRef(t,i,n,r),r},e.LookAtLHToRef=function(t,i,n,r){i.subtractToRef(t,this._zAxis),this._zAxis.normalize(),o.CrossToRef(n,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),o.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var s=-o.Dot(this._xAxis,t),a=-o.Dot(this._yAxis,t),h=-o.Dot(this._zAxis,t);return e.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,s,a,h,1,r)},e.OrthoLH=function(t,i,n,r){var o=e.Zero();return e.OrthoLHToRef(t,i,n,r,o),o},e.OrthoLHToRef=function(t,i,n,r,o){var s=2/t,a=2/i,h=1/(r-n),l=n/(n-r);e.FromValuesToRef(s,0,0,0,0,a,0,0,0,0,h,0,0,0,l,1,o)},e.OrthoOffCenterLH=function(t,i,n,r,o,s){var a=e.Zero();return e.OrthoOffCenterLHToRef(t,i,n,r,o,s,a),a},e.OrthoOffCenterLHToRef=function(e,t,i,n,r,o,s){s.m[0]=2/(t-e),s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2/(n-i),s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-1/(r-o),s.m[8]=s.m[9]=s.m[11]=0,s.m[12]=(e+t)/(e-t),s.m[13]=(n+i)/(i-n),s.m[14]=r/(r-o),s.m[15]=1},e.PerspectiveLH=function(t,i,n,r){var o=e.Zero();return o.m[0]=2*n/t,o.m[1]=o.m[2]=o.m[3]=0,o.m[5]=2*n/i,o.m[4]=o.m[6]=o.m[7]=0,o.m[10]=-r/(n-r),o.m[8]=o.m[9]=0,o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*r/(n-r),o},e.PerspectiveFovLH=function(t,i,n,r){var o=e.Zero();return e.PerspectiveFovLHToRef(t,i,n,r,o),o},e.PerspectiveFovLHToRef=function(e,t,i,n,r,o){void 0===o&&(o=!0);var s=1/Math.tan(.5*e);o?r.m[0]=s/t:r.m[0]=s,r.m[1]=r.m[2]=r.m[3]=0,o?r.m[5]=s:r.m[5]=s*t,r.m[4]=r.m[6]=r.m[7]=0,r.m[8]=r.m[9]=0,r.m[10]=-n/(i-n),r.m[11]=1,r.m[12]=r.m[13]=r.m[15]=0,r.m[14]=i*n/(i-n)},e.GetFinalMatrix=function(t,i,n,r,o,s){var a=t.width,h=t.height,l=t.x,c=t.y,u=e.FromValues(a/2,0,0,0,0,-h/2,0,0,0,0,s-o,0,l+a/2,h/2+c,o,1);return i.multiply(n).multiply(r).multiply(u)},e.GetAsMatrix2x2=function(e){return new Float32Array([e.m[0],e.m[1],e.m[4],e.m[5]])},e.GetAsMatrix3x3=function(e){return new Float32Array([e.m[0],e.m[1],e.m[2],e.m[4],e.m[5],e.m[6],e.m[8],e.m[9],e.m[10]])},e.Transpose=function(t){var i=new e;return i.m[0]=t.m[0],i.m[1]=t.m[4],i.m[2]=t.m[8],i.m[3]=t.m[12],i.m[4]=t.m[1],i.m[5]=t.m[5],i.m[6]=t.m[9],i.m[7]=t.m[13],i.m[8]=t.m[2],i.m[9]=t.m[6],i.m[10]=t.m[10],i.m[11]=t.m[14],i.m[12]=t.m[3],i.m[13]=t.m[7],i.m[14]=t.m[11],i.m[15]=t.m[15],i},e.Reflection=function(t){var i=new e;return e.ReflectionToRef(t,i),i},e.ReflectionToRef=function(e,t){e.normalize();var i=e.normal.x,n=e.normal.y,r=e.normal.z,o=-2*i,s=-2*n,a=-2*r;t.m[0]=o*i+1,t.m[1]=s*i,t.m[2]=a*i,t.m[3]=0,t.m[4]=o*n,t.m[5]=s*n+1,t.m[6]=a*n,t.m[7]=0,t.m[8]=o*r,t.m[9]=s*r,t.m[10]=a*r+1,t.m[11]=0,t.m[12]=o*e.d,t.m[13]=s*e.d,t.m[14]=a*e.d,t.m[15]=1},e._tempQuaternion=new h,e._xAxis=o.Zero(),e._yAxis=o.Zero(),e._zAxis=o.Zero(),e}();e.Matrix=l;var c=function(){function e(e,t,i,n){this.normal=new o(e,t,i),this.d=n}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=397*e^(this.d||0)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var i=l.Transpose(t),n=this.normal.x,r=this.normal.y,o=this.normal.z,s=this.d,a=n*i.m[0]+r*i.m[1]+o*i.m[2]+s*i.m[3],h=n*i.m[4]+r*i.m[5]+o*i.m[6]+s*i.m[7],c=n*i.m[8]+r*i.m[9]+o*i.m[10]+s*i.m[11],u=n*i.m[12]+r*i.m[13]+o*i.m[14]+s*i.m[15];return new e(a,h,c,u)},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,i){var n,r=t.x-e.x,o=t.y-e.y,s=t.z-e.z,a=i.x-e.x,h=i.y-e.y,l=i.z-e.z,c=o*l-s*h,u=s*a-r*l,d=r*h-o*a,f=Math.sqrt(c*c+u*u+d*d);return n=0!==f?1/f:0,this.normal.x=c*n,this.normal.y=u*n,this.normal.z=d*n,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){var i=o.Dot(this.normal,e);return t>=i},e.prototype.signedDistanceTo=function(e){return o.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,i,n){var r=new e(0,0,0,0);return r.copyFromPoints(t,i,n),r},e.FromPositionAndNormal=function(t,i){var n=new e(0,0,0,0);return i.normalize(),n.normal=i,n.d=-(i.x*t.x+i.y*t.y+i.z*t.z),n},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,i){var n=-(t.x*e.x+t.y*e.y+t.z*e.z);return o.Dot(i,t)+n},e}();e.Plane=c;var u=function(){function e(e,t,i,n){this.x=e,this.y=t,this.width=i,this.height=n}return e.prototype.toGlobal=function(t,i){return new e(this.x*t,this.y*i,this.width*t,this.height*i)},e}();e.Viewport=u;var d=function(){function e(){}return e.GetPlanes=function(t){for(var i=[],n=0;6>n;n++)i.push(new c(0,0,0,0));return e.GetPlanesToRef(t,i),i},e.GetPlanesToRef=function(e,t){t[0].normal.x=e.m[3]+e.m[2],t[0].normal.y=e.m[7]+e.m[6],t[0].normal.z=e.m[11]+e.m[10],t[0].d=e.m[15]+e.m[14],t[0].normalize(),t[1].normal.x=e.m[3]-e.m[2],t[1].normal.y=e.m[7]-e.m[6],t[1].normal.z=e.m[11]-e.m[10],t[1].d=e.m[15]-e.m[14],t[1].normalize(),t[2].normal.x=e.m[3]+e.m[0],t[2].normal.y=e.m[7]+e.m[4],t[2].normal.z=e.m[11]+e.m[8],t[2].d=e.m[15]+e.m[12],t[2].normalize(),t[3].normal.x=e.m[3]-e.m[0],t[3].normal.y=e.m[7]-e.m[4],t[3].normal.z=e.m[11]-e.m[8],t[3].d=e.m[15]-e.m[12],t[3].normalize(),t[4].normal.x=e.m[3]-e.m[1],t[4].normal.y=e.m[7]-e.m[5],t[4].normal.z=e.m[11]-e.m[9],t[4].d=e.m[15]-e.m[13],t[4].normalize(),t[5].normal.x=e.m[3]+e.m[1],t[5].normal.y=e.m[7]+e.m[5],t[5].normal.z=e.m[11]+e.m[9],t[5].d=e.m[15]+e.m[13],t[5].normalize()},e}();e.Frustum=d,function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(e.Space||(e.Space={}));var f=(e.Space,function(){function e(){}return e.X=new o(1,0,0),e.Y=new o(0,1,0),e.Z=new o(0,0,1),e}());e.Axis=f;var p=function(){function e(){}return e.interpolate=function(e,t,i,n,r){for(var o=1-3*n+3*t,s=3*n-6*t,a=3*t,h=e,l=0;5>l;l++){
var c=h*h,u=c*h,d=o*u+s*c+a*h,f=1/(3*o*c+2*s*h+a);h-=(d-e)*f,h=Math.min(1,Math.max(0,h))}return 3*Math.pow(1-h,2)*h*i+3*(1-h)*Math.pow(h,2)*r+Math.pow(h,3)},e}();e.BezierCurve=p,function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(e.Orientation||(e.Orientation={}));var _=e.Orientation,m=function(){function e(e){var t=this;this.degrees=function(){return 180*t._radians/Math.PI},this.radians=function(){return t._radians},this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.BetweenTwoPoints=function(t,i){var n=i.subtract(t),r=Math.atan2(n.y,n.x);return new e(r)},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}();e.Angle=m;var g=function(){function e(e,t,i){this.startPoint=e,this.midPoint=t,this.endPoint=i;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,s=(n-Math.pow(i.x,2)-Math.pow(i.y,2))/2,a=(e.x-t.x)*(t.y-i.y)-(t.x-i.x)*(e.y-t.y);this.centerPoint=new r((o*(t.y-i.y)-s*(e.y-t.y))/a,((e.x-t.x)*s-(t.x-i.x)*o)/a),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=m.BetweenTwoPoints(this.centerPoint,this.startPoint);var h=this.startAngle.degrees(),l=m.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),c=m.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();l-h>180&&(l-=360),-180>l-h&&(l+=360),c-l>180&&(c-=360),-180>c-l&&(c+=360),this.orientation=0>l-h?_.CW:_.CCW,this.angle=m.FromDegrees(this.orientation===_.CW?h-c:c-h)}return e}();e.Arc2=g;var v=function(){function e(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new r(e,t))}return e.prototype.addLineTo=function(e,t){if(closed)return this;var i=new r(e,t),n=this._points[this._points.length-1];return this._points.push(i),this._length+=i.subtract(n).length(),this},e.prototype.addArcTo=function(e,t,i,n,o){if(void 0===o&&(o=36),closed)return this;var s=this._points[this._points.length-1],a=new r(e,t),h=new r(i,n),l=new g(s,a,h),c=l.angle.radians()/o;l.orientation===_.CW&&(c*=-1);for(var u=l.startAngle.radians()+c,d=0;o>d;d++){var f=Math.cos(u)*l.radius+l.centerPoint.x,p=Math.sin(u)*l.radius+l.centerPoint.y;this.addLineTo(f,p),u+=c}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var e=this._length;if(!this.closed){var t=this._points[this._points.length-1],i=this._points[0];e+=i.subtract(t).length()}return e},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(e){if(0>e||e>1)return r.Zero();for(var t=e*this.length(),i=0,n=0;n<this._points.length;n++){var o=(n+1)%this._points.length,s=this._points[n],a=this._points[o],h=a.subtract(s),l=h.length()+i;if(t>=i&&l>=t){var c=h.normalize(),u=t-i;return new r(s.x+c.x*u,s.y+c.y*u)}i=l}return r.Zero()},e.StartingAt=function(t,i){return new e(t,i)},e}();e.Path2=v;var y=function(){function i(e,t,i){this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var n=0;n<e.length;n++)this._curve[n]=e[n].clone();this._raw=i||!1,this._compute(t)}return i.prototype.getCurve=function(){return this._curve},i.prototype.getTangents=function(){return this._tangents},i.prototype.getNormals=function(){return this._normals},i.prototype.getBinormals=function(){return this._binormals},i.prototype.getDistances=function(){return this._distances},i.prototype.update=function(e,t){for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t),this},i.prototype._compute=function(e){var t=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[t-1]=this._curve[t-1].subtract(this._curve[t-2]),this._raw||this._tangents[t-1].normalize();var i=this._tangents[0],n=this._normalVector(this._curve[0],i,e);this._normals[0]=n,this._raw||this._normals[0].normalize(),this._binormals[0]=o.Cross(i,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var r,s,a,h,l=1;t>l;l++)r=this._getLastNonNullVector(l),t-1>l&&(s=this._getFirstNonNullVector(l),this._tangents[l]=r.add(s),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+r.length(),a=this._tangents[l],h=this._binormals[l-1],this._normals[l]=o.Cross(h,a),this._raw||this._normals[l].normalize(),this._binormals[l]=o.Cross(a,this._normals[l]),this._raw||this._binormals[l].normalize()},i.prototype._getFirstNonNullVector=function(e){for(var t=1,i=this._curve[e+t].subtract(this._curve[e]);0===i.length()&&e+t+1<this._curve.length;)t++,i=this._curve[e+t].subtract(this._curve[e]);return i},i.prototype._getLastNonNullVector=function(e){for(var t=1,i=this._curve[e].subtract(this._curve[e-t]);0===i.length()&&e>t+1;)t++,i=this._curve[e].subtract(this._curve[e-t]);return i},i.prototype._normalVector=function(i,n,r){var s;if(void 0===r||null===r){var a;t.WithinEpsilon(n.y,1,e.Epsilon)?t.WithinEpsilon(n.x,1,e.Epsilon)?t.WithinEpsilon(n.z,1,e.Epsilon)||(a=new o(0,0,1)):a=new o(1,0,0):a=new o(0,-1,0),s=o.Cross(n,a)}else s=o.Cross(n,r),o.CrossToRef(s,n,s);return s.normalize(),s},i}();e.Path3D=y;var b=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,i,n,r){r=r>2?r:3;for(var s=new Array,a=function(e,t,i,n){var r=(1-e)*(1-e)*t+2*e*(1-e)*i+e*e*n;return r},h=0;r>=h;h++)s.push(new o(a(h/r,t.x,i.x,n.x),a(h/r,t.y,i.y,n.y),a(h/r,t.z,i.z,n.z)));return new e(s)},e.CreateCubicBezier=function(t,i,n,r,s){s=s>3?s:4;for(var a=new Array,h=function(e,t,i,n,r){var o=(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*i+3*e*e*(1-e)*n+e*e*e*r;return o},l=0;s>=l;l++)a.push(new o(h(l/s,t.x,i.x,n.x,r.x),h(l/s,t.y,i.y,n.y,r.y),h(l/s,t.z,i.z,n.z,r.z)));return new e(a)},e.CreateHermiteSpline=function(t,i,n,r,s){for(var a=new Array,h=1/s,l=0;s>=l;l++)a.push(o.Hermite(t,i,n,r,l*h));return new e(a)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(t){for(var i=this._points[this._points.length-1],n=this._points.slice(),r=t.getPoints(),o=1;o<r.length;o++)n.push(r[o].subtract(r[0]).add(i));var s=new e(n);return s},e.prototype._computeLength=function(e){for(var t=0,i=1;i<e.length;i++)t+=e[i].subtract(e[i-1]).length();return t},e}();e.Curve3=b;var x=function(){function e(){this.L00=o.Zero(),this.L1_1=o.Zero(),this.L10=o.Zero(),this.L11=o.Zero(),this.L2_2=o.Zero(),this.L2_1=o.Zero(),this.L20=o.Zero(),this.L21=o.Zero(),this.L22=o.Zero()}return e.prototype.addLight=function(e,t,i){var n=new o(t.r,t.g,t.b),r=n.scale(i);this.L00=this.L00.add(r.scale(.282095)),this.L1_1=this.L1_1.add(r.scale(.488603*e.y)),this.L10=this.L10.add(r.scale(.488603*e.z)),this.L11=this.L11.add(r.scale(.488603*e.x)),this.L2_2=this.L2_2.add(r.scale(1.092548*e.x*e.y)),this.L2_1=this.L2_1.add(r.scale(1.092548*e.y*e.z)),this.L21=this.L21.add(r.scale(1.092548*e.x*e.z)),this.L20=this.L20.add(r.scale(.315392*(3*e.z*e.z-1))),this.L22=this.L22.add(r.scale(.546274*(e.x*e.x-e.y*e.y)))},e.prototype.scale=function(e){this.L00=this.L00.scale(e),this.L1_1=this.L1_1.scale(e),this.L10=this.L10.scale(e),this.L11=this.L11.scale(e),this.L2_2=this.L2_2.scale(e),this.L2_1=this.L2_1.scale(e),this.L20=this.L20.scale(e),this.L21=this.L21.scale(e),this.L22=this.L22.scale(e)},e}();e.SphericalHarmonics=x;var P=function(){function e(){this.x=o.Zero(),this.y=o.Zero(),this.z=o.Zero(),this.xx=o.Zero(),this.yy=o.Zero(),this.zz=o.Zero(),this.xy=o.Zero(),this.yz=o.Zero(),this.zx=o.Zero()}return e.prototype.addAmbient=function(e){var t=new o(e.r,e.g,e.b);this.xx=this.xx.add(t),this.yy=this.yy.add(t),this.zz=this.zz.add(t)},e.getSphericalPolynomialFromHarmonics=function(t){var i=new e;return i.x=t.L11.scale(1.02333),i.y=t.L1_1.scale(1.02333),i.z=t.L10.scale(1.02333),i.xx=t.L00.scale(.886277).subtract(t.L20.scale(.247708)).add(t.L22.scale(.429043)),i.yy=t.L00.scale(.886277).subtract(t.L20.scale(.247708)).subtract(t.L22.scale(.429043)),i.zz=t.L00.scale(.886277).add(t.L20.scale(.495417)),i.yz=t.L2_1.scale(.858086),i.zx=t.L21.scale(.858086),i.xy=t.L2_2.scale(.858086),i},e}();e.SphericalPolynomial=P;var A=function(){function e(e,t){void 0===e&&(e=o.Zero()),void 0===t&&(t=o.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();e.PositionNormalVertex=A;var C=function(){function e(e,t,i){void 0===e&&(e=o.Zero()),void 0===t&&(t=o.Up()),void 0===i&&(i=r.Zero()),this.position=e,this.normal=t,this.uv=i}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}();e.PositionNormalTextureVertex=C;var E=function(){function e(){}return e.Color3=[i.Black(),i.Black(),i.Black()],e.Vector2=[r.Zero(),r.Zero(),r.Zero()],e.Vector3=[o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero(),o.Zero()],e.Vector4=[s.Zero(),s.Zero(),s.Zero()],e.Quaternion=[new h(0,0,0,0)],e.Matrix=[l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero(),l.Zero()],e}();e.Tmp=E}(BABYLON||(BABYLON={}));var BABYLON;!function(e){function t(e,t){return function(i,n){i.__serializableMembers||(i.__serializableMembers={}),i.__serializableMembers[n]={type:e,sourceName:t}}}function i(e){return t(0,e)}function n(e){return t(1,e)}function r(e){return t(2,e)}function o(e){return t(3,e)}function s(e){return t(4,e)}function a(e){return t(5,e)}function h(e){return t(6,e)}function l(e){return t(7,e)}e.serialize=i,e.serializeAsTexture=n,e.serializeAsColor3=r,e.serializeAsFresnelParameters=o,e.serializeAsVector2=s,e.serializeAsVector3=a,e.serializeAsMeshReference=h,e.serializeAsColorCurves=l;var c=function(){function t(){}return t.Serialize=function(t,i){i||(i={}),i.tags=e.Tags.GetTags(t);for(var n in t.__serializableMembers){var r=t.__serializableMembers[n],o=r.sourceName||n,s=r.type,a=t[n];if(void 0!==a&&null!==a)switch(s){case 0:i[o]=a;break;case 1:i[o]=a.serialize();break;case 2:i[o]=a.asArray();break;case 3:i[o]=a.serialize();break;case 4:i[o]=a.asArray();break;case 5:i[o]=a.asArray();break;case 6:i[o]=a.id;break;case 7:i[o]=a.serialize()}}return i},t.Parse=function(t,i,n,r){var o=t();e.Tags.AddTagsTo(o,i.tags);for(var s in o.__serializableMembers){var a=o.__serializableMembers[s],h=i[a.sourceName||s],l=a.type;if(void 0!==h&&null!==h)switch(l){case 0:o[s]=h;break;case 1:o[s]=e.Texture.Parse(h,n,r);break;case 2:o[s]=e.Color3.FromArray(h);break;case 3:o[s]=e.FresnelParameters.Parse(h);break;case 4:o[s]=e.Vector2.FromArray(h);break;case 5:o[s]=e.Vector3.FromArray(h);break;case 6:o[s]=n.getLastMeshByID(h);break;case 7:o[s]=e.ColorCurves.Parse(h)}}return o},t.Clone=function(t,i){var n=t();e.Tags.AddTagsTo(n,i.tags);for(var r in n.__serializableMembers){var o=n.__serializableMembers[r],s=i[r],a=o.type;if(void 0!==s&&null!==s)switch(a){case 0:case 6:n[r]=s;break;case 1:case 2:case 3:case 4:case 5:case 7:n[r]=s.clone()}}return n},t}();e.SerializationHelper=c}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t){void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t}return e}();e.EventState=t;var i=function(){function e(e,t){this.callback=e,this.mask=t}return e}();e.Observer=i;var n=function(){function e(){this._observers=new Array}return e.prototype.add=function(e,t,n){if(void 0===t&&(t=-1),void 0===n&&(n=!1),!e)return null;var r=new i(e,t);return n?this._observers.unshift(r):this._observers.push(r),r},e.prototype.remove=function(e){var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.removeCallback=function(e){for(var t=0;t<this._observers.length;t++)if(this._observers[t].callback===e)return this._observers.splice(t,1),!0;return!1},e.prototype.notifyObservers=function(e,i){void 0===i&&(i=-1);for(var n=new t(i),r=0,o=this._observers;r<o.length;r++){var s=o[r];if(s.mask&i&&s.callback(e,n),n.skipNextObservers)break}},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e}();e.Observable=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,i){this.idbFactory=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,this.callbackManifestChecked=i,this.currentSceneUrl=t.ReturnFullUrlLocation(e),this.db=null,this.enableSceneOffline=!1,this.enableTexturesOffline=!1,this.manifestVersionFound=0,this.mustUpdateRessources=!1,this.hasReachedQuota=!1,t.IDBStorageEnabled?this.checkManifestFile():this.callbackManifestChecked(!0)}return t.prototype.checkManifestFile=function(){function t(){n.enableSceneOffline=!1,n.enableTexturesOffline=!1,n.callbackManifestChecked(!1)}var i=this,n=this,r=!1,o=this.currentSceneUrl+".manifest",s=new XMLHttpRequest;navigator.onLine&&(r=!0,o=o+(null==o.match(/\?/)?"?":"&")+(new Date).getTime()),s.open("GET",o,!0),s.addEventListener("load",function(){if(200===s.status||e.Tools.ValidateXHRData(s,1))try{var n=JSON.parse(s.response);i.enableSceneOffline=n.enableSceneOffline,i.enableTexturesOffline=n.enableTexturesOffline,n.version&&!isNaN(parseInt(n.version))&&(i.manifestVersionFound=n.version),i.callbackManifestChecked&&i.callbackManifestChecked(!0)}catch(e){t()}else t()},!1),s.addEventListener("error",function(e){if(r){r=!1;var n=i.currentSceneUrl+".manifest";s.open("GET",n,!0),s.send()}else t()},!1);try{s.send()}catch(t){e.Tools.Error("Error on XHR send request."),n.callbackManifestChecked(!1)}},t.prototype.openAsync=function(t,i){function n(){o.isSupported=!1,i&&i()}var r=this,o=this;if(this.idbFactory&&(this.enableSceneOffline||this.enableTexturesOffline))if(this.db)t&&t();else{this.hasReachedQuota=!1,this.isSupported=!0;var s=this.idbFactory.open("babylonjs",1);s.onerror=function(e){n()},s.onblocked=function(t){e.Tools.Error("IDB request blocked. Please reload the page."),n()},s.onsuccess=function(e){r.db=s.result,t()},s.onupgradeneeded=function(t){r.db=t.target.result;try{r.db.createObjectStore("scenes",{keyPath:"sceneUrl"}),r.db.createObjectStore("versions",{keyPath:"sceneUrl"}),r.db.createObjectStore("textures",{keyPath:"textureUrl"})}catch(t){e.Tools.Error("Error while creating object stores. Exception: "+t.message),n()}}}else this.isSupported=!1,i&&i()},t.prototype.loadImageFromDB=function(e,i){var n=this,r=t.ReturnFullUrlLocation(e),o=function(){n.hasReachedQuota||null===n.db?i.src=e:n._saveImageIntoDBAsync(r,i)};this.mustUpdateRessources?o():this._loadImageFromDBAsync(r,i,o)},t.prototype._loadImageFromDBAsync=function(t,i,n){if(this.isSupported&&null!==this.db){var r,o=this.db.transaction(["textures"]);o.onabort=function(e){i.src=t},o.oncomplete=function(o){var s;if(r){var a=window.URL||window.webkitURL;s=a.createObjectURL(r.data,{oneTimeOnly:!0}),i.onerror=function(){e.Tools.Error("Error loading image from blob URL: "+s+" switching back to web url: "+t),i.src=t},i.src=s}else n()};var s=o.objectStore("textures").get(t);s.onsuccess=function(e){r=e.target.result},s.onerror=function(n){e.Tools.Error("Error loading texture "+t+" from DB."),i.src=t}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i.src=t},t.prototype._saveImageIntoDBAsync=function(i,n){var r=this;if(this.isSupported){var o=function(){var e;if(s){var t=window.URL||window.webkitURL;try{e=t.createObjectURL(s,{oneTimeOnly:!0})}catch(i){e=t.createObjectURL(s)}}n.src=e};if(t.IsUASupportingBlobStorage){var s,a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="blob",a.addEventListener("load",function(){if(200===a.status){s=a.response;var e=r.db.transaction(["textures"],"readwrite");e.onabort=function(e){try{e.srcElement.error&&"QuotaExceededError"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(e){}o()},e.oncomplete=function(e){o()};var h={textureUrl:i,data:s};try{var l=e.objectStore("textures").put(h);l.onsuccess=function(e){},l.onerror=function(e){o()}}catch(e){25===e.code&&(t.IsUASupportingBlobStorage=!1),n.src=i}}else n.src=i},!1),a.addEventListener("error",function(t){e.Tools.Error("Error in XHR request in BABYLON.Database."),n.src=i},!1),a.send()}else n.src=i}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),n.src=i},t.prototype._checkVersionFromDB=function(e,t){var i=this,n=function(n){i._saveVersionIntoDBAsync(e,t)};this._loadVersionFromDBAsync(e,t,n)},t.prototype._loadVersionFromDBAsync=function(t,i,n){var r=this;if(this.isSupported){var o;try{var s=this.db.transaction(["versions"]);s.oncomplete=function(e){o?r.manifestVersionFound>o.data?(r.mustUpdateRessources=!0,n()):i(o.data):(r.mustUpdateRessources=!0,n())},s.onabort=function(e){i(-1)};var a=s.objectStore("versions").get(t);a.onsuccess=function(e){o=e.target.result},a.onerror=function(n){e.Tools.Error("Error loading version for scene "+t+" from DB."),i(-1)}}catch(t){e.Tools.Error("Error while accessing 'versions' object store (READ OP). Exception: "+t.message),i(-1)}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i(-1)},t.prototype._saveVersionIntoDBAsync=function(t,i){var n=this;if(this.isSupported&&!this.hasReachedQuota)try{var r=this.db.transaction(["versions"],"readwrite");r.onabort=function(e){try{e.srcElement.error&&"QuotaExceededError"===e.srcElement.error.name&&(n.hasReachedQuota=!0)}catch(e){}i(-1)},r.oncomplete=function(e){i(n.manifestVersionFound)};var o={sceneUrl:t,data:this.manifestVersionFound},s=r.objectStore("versions").put(o);s.onsuccess=function(e){},s.onerror=function(t){e.Tools.Error("Error in DB add version request in BABYLON.Database.")}}catch(t){e.Tools.Error("Error while accessing 'versions' object store (WRITE OP). Exception: "+t.message),i(-1)}else i(-1)},t.prototype.loadFileFromDB=function(e,i,n,r,o){var s=this,a=t.ReturnFullUrlLocation(e),h=function(e){s._saveFileIntoDBAsync(a,i,n)};this._checkVersionFromDB(a,function(e){-1!==e?s.mustUpdateRessources?s._saveFileIntoDBAsync(a,i,n,o):s._loadFileFromDBAsync(a,i,h,o):r()})},t.prototype._loadFileFromDBAsync=function(t,i,n,r){if(this.isSupported){var o;o=-1!==t.indexOf(".babylon")?"scenes":"textures";var s,a=this.db.transaction([o]);a.oncomplete=function(e){s?i(s.data):n()},a.onabort=function(e){n()};var h=a.objectStore(o).get(t);h.onsuccess=function(e){s=e.target.result},h.onerror=function(i){e.Tools.Error("Error loading file "+t+" from DB."),n()}}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t.prototype._saveFileIntoDBAsync=function(t,i,n,r){var o=this;if(this.isSupported){var s;s=-1!==t.indexOf(".babylon")?"scenes":"textures";var a,h=new XMLHttpRequest;h.open("GET",t,!0),r&&(h.responseType="arraybuffer"),h.onprogress=n,h.addEventListener("load",function(){if(200===h.status||e.Tools.ValidateXHRData(h,r?6:1))if(a=r?h.response:h.responseText,o.hasReachedQuota)i(a);else{var n=o.db.transaction([s],"readwrite");n.onabort=function(e){try{e.srcElement.error&&"QuotaExceededError"===e.srcElement.error.name&&(this.hasReachedQuota=!0)}catch(e){}i(a)},n.oncomplete=function(e){i(a)};var l;l="scenes"===s?{sceneUrl:t,data:a,version:o.manifestVersionFound}:{textureUrl:t,data:a};try{var c=n.objectStore(s).put(l);c.onsuccess=function(e){},c.onerror=function(t){e.Tools.Error("Error in DB add file request in BABYLON.Database.")}}catch(e){i(a)}}else i()},!1),h.addEventListener("error",function(t){e.Tools.Error("error on XHR request."),i()},!1),h.send()}else e.Tools.Error("Error: IndexedDB not supported by your browser or BabylonJS Database is not open."),i()},t.IsUASupportingBlobStorage=!0,t.IDBStorageEnabled=!0,t.parseURL=function(e){var t=document.createElement("a");t.href=e;var i=e.substring(0,e.lastIndexOf("#")),n=e.substring(i.lastIndexOf("/")+1,e.length),r=e.substring(0,e.indexOf(n,0));return r},t.ReturnFullUrlLocation=function(e){return-1===e.indexOf("http:/")?t.parseURL(window.location.href)+e:e},t}();e.Database=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.GetTGAHeader=function(e){var t=0,i={id_length:e[t++],colormap_type:e[t++],image_type:e[t++],colormap_index:e[t++]|e[t++]<<8,colormap_length:e[t++]|e[t++]<<8,colormap_size:e[t++],origin:[e[t++]|e[t++]<<8,e[t++]|e[t++]<<8],width:e[t++]|e[t++]<<8,height:e[t++]|e[t++]<<8,pixel_size:e[t++],flags:e[t++]};return i},t.UploadContent=function(i,n){if(n.length<19)return void e.Tools.Error("Unable to load TGA file - Not enough data to contain header");var r=18,o=t.GetTGAHeader(n);if(o.id_length+r>n.length)return void e.Tools.Error("Unable to load TGA file - Not enough data");r+=o.id_length;var s=!1,a=!1,h=!1,l=!1;switch(o.image_type){case t._TYPE_RLE_INDEXED:s=!0;case t._TYPE_INDEXED:a=!0;break;case t._TYPE_RLE_RGB:s=!0;case t._TYPE_RGB:h=!0;break;case t._TYPE_RLE_GREY:s=!0;case t._TYPE_GREY:l=!0}var c,u,d=(15&o.flags,o.pixel_size>>3),f=o.width*o.height*d;if(a&&(u=n.subarray(r,r+=o.colormap_length*(o.colormap_size>>3))),s){c=new Uint8Array(f);for(var p,_,m,g=0,v=new Uint8Array(d);f>r&&f>g;)if(p=n[r++],_=(127&p)+1,128&p){for(m=0;d>m;++m)v[m]=n[r++];for(m=0;_>m;++m)c.set(v,g+m*d);g+=d*_}else{for(_*=d,m=0;_>m;++m)c[g+m]=n[r++];g+=_}}else c=n.subarray(r,r+=a?o.width*o.height:f);var y,b,x,P,A,C;switch((o.flags&t._ORIGIN_MASK)>>t._ORIGIN_SHIFT){default:case t._ORIGIN_UL:y=0,x=1,C=o.width,b=0,P=1,A=o.height;break;case t._ORIGIN_BL:y=0,x=1,C=o.width,b=o.height-1,P=-1,A=-1;break;case t._ORIGIN_UR:y=o.width-1,x=-1,C=-1,b=0,P=1,A=o.height;break;case t._ORIGIN_BR:y=o.width-1,x=-1,C=-1,b=o.height-1,P=-1,A=-1}var E="_getImageData"+(l?"Grey":"")+o.pixel_size+"bits",T=t[E](o,u,c,b,P,A,y,x,C);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o.width,o.height,0,i.RGBA,i.UNSIGNED_BYTE,T)},t._getImageData8bits=function(e,t,i,n,r,o,s,a,h){var l,c,u,d=i,f=t,p=e.width,_=e.height,m=0,g=new Uint8Array(p*_*4);for(u=n;u!==o;u+=r)for(c=s;c!==h;c+=a,m++)l=d[m],g[4*(c+p*u)+3]=255,g[4*(c+p*u)+2]=f[3*l+0],g[4*(c+p*u)+1]=f[3*l+1],g[4*(c+p*u)+0]=f[3*l+2];return g},t._getImageData16bits=function(e,t,i,n,r,o,s,a,h){var l,c,u,d=i,f=e.width,p=e.height,_=0,m=new Uint8Array(f*p*4);for(u=n;u!==o;u+=r)for(c=s;c!==h;c+=a,_+=2)l=d[_+0]+(d[_+1]<<8),m[4*(c+f*u)+0]=(31744&l)>>7,m[4*(c+f*u)+1]=(992&l)>>2,m[4*(c+f*u)+2]=(31&l)>>3,m[4*(c+f*u)+3]=32768&l?0:255;return m},t._getImageData24bits=function(e,t,i,n,r,o,s,a,h){var l,c,u=i,d=e.width,f=e.height,p=0,_=new Uint8Array(d*f*4);for(c=n;c!==o;c+=r)for(l=s;l!==h;l+=a,p+=3)_[4*(l+d*c)+3]=255,_[4*(l+d*c)+2]=u[p+0],_[4*(l+d*c)+1]=u[p+1],_[4*(l+d*c)+0]=u[p+2];return _},t._getImageData32bits=function(e,t,i,n,r,o,s,a,h){var l,c,u=i,d=e.width,f=e.height,p=0,_=new Uint8Array(d*f*4);for(c=n;c!==o;c+=r)for(l=s;l!==h;l+=a,p+=4)_[4*(l+d*c)+2]=u[p+0],_[4*(l+d*c)+1]=u[p+1],_[4*(l+d*c)+0]=u[p+2],_[4*(l+d*c)+3]=u[p+3];return _},t._getImageDataGrey8bits=function(e,t,i,n,r,o,s,a,h){var l,c,u,d=i,f=e.width,p=e.height,_=0,m=new Uint8Array(f*p*4);for(u=n;u!==o;u+=r)for(c=s;c!==h;c+=a,_++)l=d[_],m[4*(c+f*u)+0]=l,m[4*(c+f*u)+1]=l,m[4*(c+f*u)+2]=l,m[4*(c+f*u)+3]=255;return m},t._getImageDataGrey16bits=function(e,t,i,n,r,o,s,a,h){var l,c,u=i,d=e.width,f=e.height,p=0,_=new Uint8Array(d*f*4);for(c=n;c!==o;c+=r)for(l=s;l!==h;l+=a,p+=2)_[4*(l+d*c)+0]=u[p+0],_[4*(l+d*c)+1]=u[p+0],_[4*(l+d*c)+2]=u[p+0],_[4*(l+d*c)+3]=u[p+1];return _},t._TYPE_NO_DATA=0,t._TYPE_INDEXED=1,t._TYPE_RGB=2,t._TYPE_GREY=3,t._TYPE_RLE_INDEXED=9,t._TYPE_RLE_RGB=10,t._TYPE_RLE_GREY=11,t._ORIGIN_MASK=48,t._ORIGIN_SHIFT=4,t._ORIGIN_BL=0,t._ORIGIN_BR=1,t._ORIGIN_UL=2,t._ORIGIN_UR=3,t}();t.TGATools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(t){this.length=0,this._duplicateId=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId},e.prototype.pushNoDuplicate=function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0,this._duplicateId++},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var i=(e.data||e)[t];this.pushNoDuplicate(i)}}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e._GlobalId=0,e}();e.SmartArray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._count=0,this._data={}}return e.prototype.get=function(e){var t=this._data[e];return void 0!==t?t:void 0},e.prototype.getOrAddWithFactory=function(e,t){var i=this.get(e);return void 0!==i?i:(i=t(e),i&&this.add(e,i),i)},e.prototype.getOrAdd=function(e,t){var i=this.get(e);return void 0!==i?i:(this.add(e,t),t)},e.prototype.contains=function(e){return void 0!==this._data[e]},e.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},e.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},e.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._data){var i=this._data[t];e(t,i)}},e.prototype.first=function(e){for(var t in this._data){var i=this._data[t],n=e(t,i);if(n)return n}return null},e}();e.StringDictionary=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){function t(e){return function(t){t.__bjsclassName__=e}}var i,n=function(t,i){return t?t instanceof e.Mesh?null:t instanceof e.SubMesh?t.clone(i):t.clone?t.clone():null:null},r=function(){function t(){}return t.Instantiate=function(e){for(var t=e.split("."),i=window||this,n=0,r=t.length;r>n;n++)i=i[t[n]];return"function"!=typeof i?null:i},t.SetImmediate=function(e){window.setImmediate?window.setImmediate(e):setTimeout(e,1)},t.IsExponentOfTwo=function(e){var t=1;do t*=2;while(e>t);return t===e},t.GetExponentOfTwo=function(e,t){var i=1;do i*=2;while(e>i);return i>t&&(i=t),i},t.GetFilename=function(e){var t=e.lastIndexOf("/");return 0>t?e:e.substring(t+1)},t.GetDOMTextContent=function(e){for(var t="",i=e.firstChild;i;)3===i.nodeType&&(t+=i.textContent),i=i.nextSibling;return t},t.ToDegrees=function(e){return 180*e/Math.PI},t.ToRadians=function(e){return e*Math.PI/180},t.EncodeArrayBufferTobase64=function(e){for(var t,i,n,r,o,s,a,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0,u=new Uint8Array(e);c<u.length;)t=u[c++],i=c<u.length?u[c++]:Number.NaN,n=c<u.length?u[c++]:Number.NaN,r=t>>2,o=(3&t)<<4|i>>4,s=(15&i)<<2|n>>6,a=63&n,isNaN(i)?s=a=64:isNaN(n)&&(a=64),l+=h.charAt(r)+h.charAt(o)+h.charAt(s)+h.charAt(a);return"data:image/png;base64,"+l},t.ExtractMinAndMaxIndexed=function(t,i,n,r,o){void 0===o&&(o=null);for(var s=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),h=n;n+r>h;h++){var l=new e.Vector3(t[3*i[h]],t[3*i[h]+1],t[3*i[h]+2]);s=e.Vector3.Minimize(l,s),a=e.Vector3.Maximize(l,a)}return o&&(s.x-=s.x*o.x+o.y,s.y-=s.y*o.x+o.y,s.z-=s.z*o.x+o.y,a.x+=a.x*o.x+o.y,a.y+=a.y*o.x+o.y,a.z+=a.z*o.x+o.y),{minimum:s,maximum:a}},t.ExtractMinAndMax=function(t,i,n,r,o){void 0===r&&(r=null);var s=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),a=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);o||(o=3);for(var h=i;i+n>h;h++){var l=new e.Vector3(t[h*o],t[h*o+1],t[h*o+2]);s=e.Vector3.Minimize(l,s),a=e.Vector3.Maximize(l,a)}return r&&(s.x-=s.x*r.x+r.y,s.y-=s.y*r.x+r.y,s.z-=s.z*r.x+r.y,a.x+=a.x*r.x+r.y,a.y+=a.y*r.x+r.y,a.z+=a.z*r.x+r.y),{minimum:s,maximum:a}},t.Vector2ArrayFeeder=function(t){return function(i){var n=void 0!==t.BYTES_PER_ELEMENT,r=n?t.length/2:t.length;if(i>=r)return null;if(n){var o=t;return new e.Vector2(o[2*i+0],o[2*i+1])}var s=t;return s[i]}},t.ExtractMinAndMaxVector2=function(t,i){void 0===i&&(i=null);for(var n=new e.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),r=new e.Vector2(-Number.MAX_VALUE,-Number.MAX_VALUE),o=0,s=t(o++);s;)n=e.Vector2.Minimize(s,n),r=e.Vector2.Maximize(s,r),s=t(o++);return i&&(n.x-=n.x*i.x+i.y,n.y-=n.y*i.x+i.y,r.x+=r.x*i.x+i.y,r.y+=r.y*i.x+i.y),{minimum:n,maximum:r}},t.MakeArray=function(e,t){return t===!0||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:void 0},t.GetPointerPrefix=function(){var e="pointer";return window.PointerEvent||navigator.pointerEnabled||(e="mouse"),e},t.QueueNewFrame=function(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.msRequestAnimationFrame?window.msRequestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):window.oRequestAnimationFrame?window.oRequestAnimationFrame(e):window.setTimeout(e,16)},t.RequestFullscreen=function(e,t){var i=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;i&&i.call(e,t)},t.ExitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msCancelFullScreen&&document.msCancelFullScreen()},t.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},t.LoadImage=function(i,n,r,o){i instanceof ArrayBuffer&&(i=t.EncodeArrayBufferTobase64(i)),i=t.CleanUrl(i);var s=new Image;if("data:"!==i.substr(0,5)&&t.CorsBehavior)switch(typeof t.CorsBehavior){case"function":var a=t.CorsBehavior(i);a&&(s.crossOrigin=a);break;case"string":default:s.crossOrigin=t.CorsBehavior}s.onload=function(){n(s)},s.onerror=function(e){t.Error("Error while trying to load texture: "+i),t.UseFallbackTexture?(s.src="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",
n(s)):r()};var h=function(){s.src=i},l=function(){o.loadImageFromDB(i,s)};if("data:"!==i.substr(0,5)&&o&&o.enableTexturesOffline&&e.Database.IsUASupportingBlobStorage)o.openAsync(l,h);else if(-1===i.indexOf("file:"))h();else try{var c,u=i.substring(5).toLowerCase();try{c=URL.createObjectURL(e.FilesInput.FilesTextures[u],{oneTimeOnly:!0})}catch(t){c=URL.createObjectURL(e.FilesInput.FilesTextures[u])}s.src=c}catch(e){s.src=null}return s},t.LoadFile=function(i,n,r,o,s,a){i=t.CleanUrl(i);var h=function(){var e=new XMLHttpRequest,o=t.BaseUrl+i;e.open("GET",o,!0),s&&(e.responseType="arraybuffer"),e.onprogress=r,e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status||t.ValidateXHRData(e,s?6:1))n(s?e.response:e.responseText);else{if(!a)throw new Error("Error status: "+e.status+" - Unable to load "+o);a()}},e.send(null)},l=function(){o.loadFileFromDB(i,n,r,h,s)};if(-1!==i.indexOf("file:")){var c=i.substring(5).toLowerCase();t.ReadFile(e.FilesInput.FilesToLoad[c],n,r,s)}else o&&o.enableSceneOffline?o.openAsync(l,h):h()},t.ReadFileAsDataURL=function(e,t,i){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.onprogress=i,n.readAsDataURL(e)},t.ReadFile=function(e,i,n,r){var o=new FileReader;o.onerror=function(n){t.Log("Error while reading file: "+e.name),i(JSON.stringify({autoClear:!0,clearColor:[1,0,0],ambientColor:[0,0,0],gravity:[0,-9.807,0],meshes:[],cameras:[],lights:[]}))},o.onload=function(e){i(e.target.result)},o.onprogress=n,r?o.readAsArrayBuffer(e):o.readAsText(e)},t.FileAsURL=function(e){var t=new Blob([e]),i=window.URL||window.webkitURL,n=i.createObjectURL(t);return n},t.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},t.CheckExtends=function(e,t,i){e.x<t.x&&(t.x=e.x),e.y<t.y&&(t.y=e.y),e.z<t.z&&(t.z=e.z),e.x>i.x&&(i.x=e.x),e.y>i.y&&(i.y=e.y),e.z>i.z&&(i.z=e.z)},t.DeepCopy=function(e,t,i,r){for(var o in e)if(("_"!==o[0]||r&&-1!==r.indexOf(o))&&(!i||-1===i.indexOf(o))){var s=e[o],a=typeof s;if("function"!==a)if("object"===a)if(s instanceof Array){if(t[o]=[],s.length>0)if("object"==typeof s[0])for(var h=0;h<s.length;h++){var l=n(s[h],t);-1===t[o].indexOf(l)&&t[o].push(l)}else t[o]=s.slice(0)}else t[o]=n(s,t);else t[o]=s}},t.IsEmpty=function(e){for(var t in e)return!1;return!0},t.RegisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(e){}}},t.UnregisterTopRootEvents=function(e){for(var t=0;t<e.length;t++){var i=e[t];window.removeEventListener(i.name,i.handler);try{window.parent&&window.parent.removeEventListener(i.name,i.handler)}catch(e){}}},t.DumpFramebuffer=function(e,t,n,r){for(var o=4*e,s=t/2,a=n.readPixels(0,0,e,t),h=0;s>h;h++)for(var l=0;o>l;l++){var c=l+h*o,u=t-h-1,d=l+u*o,f=a[c];a[c]=a[d],a[d]=f}i||(i=document.createElement("canvas")),i.width=e,i.height=t;var p=i.getContext("2d"),_=p.createImageData(e,t),m=_.data;m.set(a),p.putImageData(_,0,0);var g=i.toDataURL();if(r)r(g);else if("download"in document.createElement("a")){var v=window.document.createElement("a");v.href=g;var y=new Date,b=(y.getFullYear()+"-"+(y.getMonth()+1)).slice(-2)+"-"+y.getDate()+"_"+y.getHours()+"-"+("0"+y.getMinutes()).slice(-2);v.setAttribute("download","screenshot_"+b+".png"),window.document.body.appendChild(v),v.addEventListener("click",function(){v.parentElement.removeChild(v)}),v.click()}else{var x=window.open(""),P=x.document.createElement("img");P.src=g,x.document.body.appendChild(P)}},t.CreateScreenshot=function(i,n,r,o){var s,a;if(r.precision)s=Math.round(i.getRenderWidth()*r.precision),a=Math.round(s/i.getAspectRatio(n)),r={width:s,height:a};else if(r.width&&r.height)s=r.width,a=r.height;else if(r.width&&!r.height)s=r.width,a=Math.round(s/i.getAspectRatio(n)),r={width:s,height:a};else if(r.height&&!r.width)a=r.height,s=Math.round(a*i.getAspectRatio(n)),r={width:s,height:a};else{if(isNaN(r))return void t.Error("Invalid 'size' parameter !");a=r,s=r}var h=n.getScene(),l=null;h.activeCamera!==n&&(l=h.activeCamera,h.activeCamera=n);var c=new e.RenderTargetTexture("screenShot",r,h,!1,!1);c.renderList=h.meshes,c.onAfterRenderObservable.add(function(){t.DumpFramebuffer(s,a,i,o)}),h.incrementRenderId(),h.resetCachedMaterial(),c.render(!0),c.dispose(),l&&(h.activeCamera=l),n.getProjectionMatrix(!0)},t.ValidateXHRData=function(t,i){void 0===i&&(i=7);try{if(1&i){if(t.responseText&&t.responseText.length>0)return!0;if(1===i)return!1}if(2&i){var n=e.Internals.TGATools.GetTGAHeader(t.response);if(n.width&&n.height&&n.width>0&&n.height>0)return!0;if(2===i)return!1}if(4&i){var r=new Uint8Array(t.response,0,3);return 68===r[0]&&68===r[1]&&83===r[2]}}catch(e){}return!1},Object.defineProperty(t,"NoneLogLevel",{get:function(){return t._NoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MessageLogLevel",{get:function(){return t._MessageLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WarningLogLevel",{get:function(){return t._WarningLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ErrorLogLevel",{get:function(){return t._ErrorLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"AllLogLevel",{get:function(){return t._MessageLogLevel|t._WarningLogLevel|t._ErrorLogLevel},enumerable:!0,configurable:!0}),t._AddLogEntry=function(e){t._LogCache=e+t._LogCache,t.OnNewCacheEntry&&t.OnNewCacheEntry(e)},t._FormatMessage=function(e){var t=function(e){return 10>e?"0"+e:""+e},i=new Date;return"["+t(i.getHours())+":"+t(i.getMinutes())+":"+t(i.getSeconds())+"]: "+e},t._LogDisabled=function(e){},t._LogEnabled=function(e){var i=t._FormatMessage(e);console.log("BJS - "+i);var n="<div style='color:white'>"+i+"</div><br>";t._AddLogEntry(n)},t._WarnDisabled=function(e){},t._WarnEnabled=function(e){var i=t._FormatMessage(e);console.warn("BJS - "+i);var n="<div style='color:orange'>"+i+"</div><br>";t._AddLogEntry(n)},t._ErrorDisabled=function(e){},t._ErrorEnabled=function(e){t.errorsCount++;var i=t._FormatMessage(e);console.error("BJS - "+i);var n="<div style='color:red'>"+i+"</div><br>";t._AddLogEntry(n)},Object.defineProperty(t,"LogCache",{get:function(){return t._LogCache},enumerable:!0,configurable:!0}),t.ClearLogCache=function(){t._LogCache="",t.errorsCount=0},Object.defineProperty(t,"LogLevels",{set:function(e){(e&t.MessageLogLevel)===t.MessageLogLevel?t.Log=t._LogEnabled:t.Log=t._LogDisabled,(e&t.WarningLogLevel)===t.WarningLogLevel?t.Warn=t._WarnEnabled:t.Warn=t._WarnDisabled,(e&t.ErrorLogLevel)===t.ErrorLogLevel?t.Error=t._ErrorEnabled:t.Error=t._ErrorDisabled},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PerformanceNoneLogLevel",{get:function(){return t._PerformanceNoneLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PerformanceUserMarkLogLevel",{get:function(){return t._PerformanceUserMarkLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PerformanceConsoleLogLevel",{get:function(){return t._PerformanceConsoleLogLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PerformanceLogLevel",{set:function(e){return(e&t.PerformanceUserMarkLogLevel)===t.PerformanceUserMarkLogLevel?(t.StartPerformanceCounter=t._StartUserMark,void(t.EndPerformanceCounter=t._EndUserMark)):(e&t.PerformanceConsoleLogLevel)===t.PerformanceConsoleLogLevel?(t.StartPerformanceCounter=t._StartPerformanceConsole,void(t.EndPerformanceCounter=t._EndPerformanceConsole)):(t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,void(t.EndPerformanceCounter=t._EndPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),t._StartPerformanceCounterDisabled=function(e,t){},t._EndPerformanceCounterDisabled=function(e,t){},t._StartUserMark=function(e,i){void 0===i&&(i=!0),i&&t._performance.mark&&t._performance.mark(e+"-Begin")},t._EndUserMark=function(e,i){void 0===i&&(i=!0),i&&t._performance.mark&&(t._performance.mark(e+"-End"),t._performance.measure(e,e+"-Begin",e+"-End"))},t._StartPerformanceConsole=function(e,i){void 0===i&&(i=!0),i&&(t._StartUserMark(e,i),console.time&&console.time(e))},t._EndPerformanceConsole=function(e,i){void 0===i&&(i=!0),i&&(t._EndUserMark(e,i),console.time&&console.timeEnd(e))},Object.defineProperty(t,"Now",{get:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},enumerable:!0,configurable:!0}),t.getClassName=function(e,t){void 0===t&&(t=!1);var i=null;if(!t&&e.getClassName)i=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);i=n.constructor.__bjsclassName__}i||(i=typeof e)}return i},t.first=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(t(n))return n}},t.arrayOrStringFeeder=function(e){return function(i){if(i>=e.length)return null;var n=e.charCodeAt?e.charCodeAt(i):e[i];return n&&n.getHashCode&&(n=n.getHashCode()),"string"==typeof n?t.hashCodeFromStream(t.arrayOrStringFeeder(n)):n}},t.hashCodeFromStream=function(e){for(var t=0,i=0,n=e(i++);null!=n;)t=(t<<5)-t+n,t|=0,n=e(i++);return t},t.BaseUrl="",t.CorsBehavior="anonymous",t.UseFallbackTexture=!0,t._NoneLogLevel=0,t._MessageLogLevel=1,t._WarningLogLevel=2,t._ErrorLogLevel=4,t._LogCache="",t.errorsCount=0,t.Log=t._LogEnabled,t.Warn=t._WarnEnabled,t.Error=t._ErrorEnabled,t._PerformanceNoneLogLevel=0,t._PerformanceUserMarkLogLevel=1,t._PerformanceConsoleLogLevel=2,t._performance=window.performance,t.StartPerformanceCounter=t._StartPerformanceCounterDisabled,t.EndPerformanceCounter=t._EndPerformanceCounterDisabled,t}();e.Tools=r,e.className=t;var o=function(){function e(e,t,i,n){void 0===n&&(n=0),this.iterations=e,this._fn=t,this._successCallback=i,this.index=n-1,this._done=!1}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,i,n,r){void 0===r&&(r=0);var o=new e(t,i,n,r);return o.executeNext(),o},e.SyncAsyncForLoop=function(t,i,n,r,o,s){void 0===s&&(s=0),e.Run(Math.ceil(t/i),function(e){o&&o()?e.breakLoop():setTimeout(function(){for(var r=0;i>r;++r){var s=e.index*i+r;if(s>=t)break;if(n(s),o&&o()){e.breakLoop();break}}e.executeNext()},s)},r)},e}();e.AsyncLoop=o}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4)}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendFunctionParameters=function(e,t,i,n){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===i&&this._blendFunctionParameters[3]===n||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=i,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1))},e}();e._AlphaState=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1))},e}();e._DepthCullingState=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e,t,i,n){var r=e.createShader("vertex"===i?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(e.shaderSource(r,(n?n+"\n":"")+t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));return r},i=function(e,t){var i=e.UNSIGNED_BYTE;return t===l.TEXTURETYPE_FLOAT&&(i=e.FLOAT),i},n=function(t,i,n){var r=n.NEAREST,o=n.NEAREST;return t===e.Texture.BILINEAR_SAMPLINGMODE?(r=n.LINEAR,o=i?n.LINEAR_MIPMAP_NEAREST:n.LINEAR):t===e.Texture.TRILINEAR_SAMPLINGMODE?(r=n.LINEAR,o=i?n.LINEAR_MIPMAP_LINEAR:n.LINEAR):t===e.Texture.NEAREST_SAMPLINGMODE&&(r=n.NEAREST,o=i?n.NEAREST_MIPMAP_LINEAR:n.NEAREST),{min:o,mag:r}},r=function(t,i,r,o,s,a,h,l,c,u,d){void 0===d&&(d=e.Texture.TRILINEAR_SAMPLINGMODE);var f=r.getEngine(),p=e.Tools.GetExponentOfTwo(o,f.getCaps().maxTextureSize),_=e.Tools.GetExponentOfTwo(s,f.getCaps().maxTextureSize);i.bindTexture(i.TEXTURE_2D,t),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,void 0===a?1:a?1:0),t._baseWidth=o,t._baseHeight=s,t._width=p,t._height=_,t.isReady=!0,c(p,_);var m=n(d,!h,i);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,m.mag),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,m.min),h||l||i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null),f.resetTextureCache(),r._removePendingData(t),u&&u()},o=function(t,i,n,r,o){var s,a=function(){n[i]=s,n._internalCount++,r._removePendingData(s),6===n._internalCount&&o(n)},h=function(){r._removePendingData(s)};s=e.Tools.LoadImage(t,a,h,r.database),r._addPendingData(s)},s=function(e,t,i,n){var r=[];r._internalCount=0;for(var s=0;6>s;s++)o(n[s],s,r,t,i)},a=function(){function e(){}return e}();e.InstancingAttributeInfo=a;var h=function(){function e(){}return e}();e.EngineCapabilities=h;var l=function(){function o(t,i,n,r){var s=this;if(void 0===r&&(r=!0),this.isFullscreen=!1,this.isPointerLock=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.enableOfflineSupport=!0,this.scenes=new Array,this._windowIsBackground=!1,this._webGLVersion="1.0",this._drawCalls=0,this._renderingQueueLaunched=!1,this._activeRenderLoops=[],this.fpsRange=60,this.previousFramesDuration=[],this.fps=60,this.deltaTime=0,this._depthCullingState=new e.Internals._DepthCullingState,this._alphaState=new e.Internals._AlphaState,this._alphaMode=o.ALPHA_DISABLE,this._loadedTexturesCache=new Array,this._maxTextureChannels=16,this._activeTexturesCache=new Array(this._maxTextureChannels),this._compiledEffects={},this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._renderingCanvas=t,this._externalData=new e.StringDictionary,n=n||{},n.antialias=i,void 0===n.preserveDrawingBuffer&&(n.preserveDrawingBuffer=!1),!this._gl)try{this._gl=t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}catch(e){throw new Error("WebGL not supported")}if(!this._gl)throw new Error("WebGL not supported");this._onBlur=function(){s._windowIsBackground=!0},this._onFocus=function(){s._windowIsBackground=!1},window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus);var a=n.limitDeviceRatio||window.devicePixelRatio||1;this._hardwareScalingLevel=r?1/Math.min(a,window.devicePixelRatio||1):1,this.resize(),this._caps=new h,this._caps.maxTexturesImageUnits=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),this._caps.maxCubemapTextureSize=this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxRenderTextureSize=this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),this._glVersion=this._gl.getParameter(this._gl.VERSION);var l=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=l&&(this._glRenderer=this._gl.getParameter(l.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(l.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._caps.standardDerivatives=null!==this._gl.getExtension("OES_standard_derivatives"),this._caps.s3tc=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._caps.textureFloat=null!==this._gl.getExtension("OES_texture_float"),this._caps.textureAnisotropicFilterExtension=this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.instancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._caps.uintIndices=null!==this._gl.getExtension("OES_element_index_uint"),this._caps.fragmentDepthSupported=null!==this._gl.getExtension("EXT_frag_depth"),this._caps.highPrecisionShaderSupported=!0,this._caps.drawBuffersExtension=this._gl.getExtension("WEBGL_draw_buffers"),this._caps.textureFloatLinearFiltering=this._gl.getExtension("OES_texture_float_linear"),this._caps.textureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._gl.getShaderPrecisionFormat){var c=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);this._caps.highPrecisionShaderSupported=0!==c.precision}this.setDepthBuffer(!0),this.setDepthFunctionToLessOrEqual(),this.setDepthWrite(!0),this._onFullscreenChange=function(){void 0!==document.fullscreen?s.isFullscreen=document.fullscreen:void 0!==document.mozFullScreen?s.isFullscreen=document.mozFullScreen:void 0!==document.webkitIsFullScreen?s.isFullscreen=document.webkitIsFullScreen:void 0!==document.msIsFullScreen&&(s.isFullscreen=document.msIsFullScreen),s.isFullscreen&&s._pointerLockRequested&&(t.requestPointerLock=t.requestPointerLock||t.msRequestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock&&t.requestPointerLock())},document.addEventListener("fullscreenchange",this._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",this._onFullscreenChange,!1),this._onPointerLockChange=function(){s.isPointerLock=document.mozPointerLockElement===t||document.webkitPointerLockElement===t||document.msPointerLockElement===t||document.pointerLockElement===t},document.addEventListener("pointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",this._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",this._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,!1),e.AudioEngine&&!o.audioEngine&&(o.audioEngine=new e.AudioEngine),this._loadingScreen=new e.DefaultLoadingScreen(this._renderingCanvas),e.Tools.Log("Babylon.js engine (v"+o.Version+") launched")}return Object.defineProperty(o,"ALPHA_DISABLE",{get:function(){return o._ALPHA_DISABLE},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALPHA_ONEONE",{get:function(){return o._ALPHA_ONEONE},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALPHA_ADD",{get:function(){return o._ALPHA_ADD},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALPHA_COMBINE",{get:function(){return o._ALPHA_COMBINE},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALPHA_SUBTRACT",{get:function(){return o._ALPHA_SUBTRACT},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALPHA_MULTIPLY",{get:function(){return o._ALPHA_MULTIPLY},enumerable:!0,configurable:!0}),Object.defineProperty(o,"ALPHA_MAXIMIZED",{get:function(){return o._ALPHA_MAXIMIZED},enumerable:!0,configurable:!0}),Object.defineProperty(o,"DELAYLOADSTATE_NONE",{get:function(){return o._DELAYLOADSTATE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(o,"DELAYLOADSTATE_LOADED",{get:function(){return o._DELAYLOADSTATE_LOADED},enumerable:!0,configurable:!0}),Object.defineProperty(o,"DELAYLOADSTATE_LOADING",{get:function(){return o._DELAYLOADSTATE_LOADING},enumerable:!0,configurable:!0}),Object.defineProperty(o,"DELAYLOADSTATE_NOTLOADED",{get:function(){return o._DELAYLOADSTATE_NOTLOADED},enumerable:!0,configurable:!0}),Object.defineProperty(o,"TEXTUREFORMAT_ALPHA",{get:function(){return o._TEXTUREFORMAT_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(o,"TEXTUREFORMAT_LUMINANCE",{get:function(){return o._TEXTUREFORMAT_LUMINANCE},enumerable:!0,configurable:!0}),Object.defineProperty(o,"TEXTUREFORMAT_LUMINANCE_ALPHA",{get:function(){return o._TEXTUREFORMAT_LUMINANCE_ALPHA},enumerable:!0,configurable:!0}),Object.defineProperty(o,"TEXTUREFORMAT_RGB",{get:function(){return o._TEXTUREFORMAT_RGB},enumerable:!0,configurable:!0}),Object.defineProperty(o,"TEXTUREFORMAT_RGBA",{get:function(){return o._TEXTUREFORMAT_RGBA},enumerable:!0,configurable:!0}),Object.defineProperty(o,"TEXTURETYPE_UNSIGNED_INT",{get:function(){return o._TEXTURETYPE_UNSIGNED_INT},enumerable:!0,configurable:!0}),Object.defineProperty(o,"TEXTURETYPE_FLOAT",{get:function(){return o._TEXTURETYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(o,"Version",{get:function(){return"2.4.0"},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),o.prototype._prepareWorkingCanvas=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"),this._workingContext=this._workingCanvas.getContext("2d"))},o.prototype.resetTextureCache=function(){for(var e=0;e<this._maxTextureChannels;e++)this._activeTexturesCache[e]=null},o.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},o.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var i=e.viewport;return this.getRenderWidth(t)*i.width/(this.getRenderHeight(t)*i.height)},o.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget._width:this._renderingCanvas.width},o.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget._height:this._renderingCanvas.height},o.prototype.getRenderingCanvas=function(){return this._renderingCanvas},o.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas.getBoundingClientRect()},o.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},o.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},o.prototype.getLoadedTexturesCache=function(){return this._loadedTexturesCache},o.prototype.getCaps=function(){return this._caps},Object.defineProperty(o.prototype,"drawCalls",{get:function(){return this._drawCalls},enumerable:!0,configurable:!0}),o.prototype.resetDrawCalls=function(){this._drawCalls=0},o.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},o.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},o.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=this._gl.GREATER},o.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=this._gl.GEQUAL},o.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=this._gl.LESS},o.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=this._gl.LEQUAL},o.prototype.stopRenderLoop=function(e){if(!e)return void(this._activeRenderLoops=[]);var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)},o.prototype._renderLoop=function(){var t=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(t=!1),t){this.beginFrame();for(var i=0;i<this._activeRenderLoops.length;i++){var n=this._activeRenderLoops[i];n()}this.endFrame()}this._activeRenderLoops.length>0?e.Tools.QueueNewFrame(this._bindedRenderFunction):this._renderingQueueLaunched=!1},o.prototype.runRenderLoop=function(t){-1===this._activeRenderLoops.indexOf(t)&&(this._activeRenderLoops.push(t),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._bindedRenderFunction=this._renderLoop.bind(this),e.Tools.QueueNewFrame(this._bindedRenderFunction)))},o.prototype.switchFullscreen=function(t,i){this.isFullscreen?e.Tools.ExitFullscreen():(this._pointerLockRequested=t,e.Tools.RequestFullscreen(this._renderingCanvas,i))},o.prototype.clear=function(e,t,i){this.applyStates(),t&&this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),i&&this._depthCullingState.depthMask&&this._gl.clearDepth(1);var n=0;t&&(n|=this._gl.COLOR_BUFFER_BIT),i&&this._depthCullingState.depthMask&&(n|=this._gl.DEPTH_BUFFER_BIT),this._gl.clear(n)},o.prototype.scissorClear=function(e,t,i,n,r){var o=this._gl,s=o.getParameter(o.SCISSOR_TEST),a=o.getParameter(o.SCISSOR_BOX);o.enable(o.SCISSOR_TEST),o.scissor(e,t,i,n),this.clear(r,!0,!0),o.scissor(a[0],a[1],a[2],a[3]),s===!0?o.enable(o.SCISSOR_TEST):o.disable(o.SCISSOR_TEST)},o.prototype.setViewport=function(e,t,i){var n=t||(navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.width),r=i||(navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.height),o=e.x||0,s=e.y||0;this._cachedViewport=e,this._gl.viewport(o*n,s*r,n*e.width,r*e.height)},o.prototype.setDirectViewport=function(e,t,i,n){var r=this._cachedViewport;return this._cachedViewport=null,this._gl.viewport(e,t,i,n),r},o.prototype.beginFrame=function(){this._measureFps()},o.prototype.endFrame=function(){},o.prototype.resize=function(){var e=navigator.isCocoonJS?window.innerWidth:this._renderingCanvas.clientWidth,t=navigator.isCocoonJS?window.innerHeight:this._renderingCanvas.clientHeight;this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel);for(var i=0;i<this.scenes.length;i++){var n=this.scenes[i];n.debugLayer.isVisible()&&n.debugLayer._syncPositions()}},o.prototype.setSize=function(e,t){this._renderingCanvas.width=e,this._renderingCanvas.height=t;for(var i=0;i<this.scenes.length;i++)for(var n=this.scenes[i],r=0;r<n.cameras.length;r++){var o=n.cameras[r];o._currentRenderId=0}},o.prototype.bindFramebuffer=function(e,t,i,n){this._currentRenderTarget=e;var r=this._gl;r.bindFramebuffer(r.FRAMEBUFFER,e._framebuffer),e.isCube?r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+t,e,0):r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0),this._gl.viewport(0,0,i||e._width,n||e._height),this.wipeCaches()},o.prototype.unBindFramebuffer=function(e,t){if(void 0===t&&(t=!1),this._currentRenderTarget=null,e.generateMipMaps&&!t){var i=this._gl;i.bindTexture(i.TEXTURE_2D,e),i.generateMipmap(i.TEXTURE_2D),i.bindTexture(i.TEXTURE_2D,null)}this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)},o.prototype.generateMipMapsForCubemap=function(e){if(e.generateMipMaps){var t=this._gl;t.bindTexture(t.TEXTURE_CUBE_MAP,e),t.generateMipmap(t.TEXTURE_CUBE_MAP),t.bindTexture(t.TEXTURE_CUBE_MAP,null)}},o.prototype.flushFramebuffer=function(){this._gl.flush()},o.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this.setViewport(this._cachedViewport),this.wipeCaches()},o.prototype._resetVertexBufferBinding=function(){this.bindBuffer(null,this._gl.ARRAY_BUFFER),this._cachedVertexBuffers=null},o.prototype.createVertexBuffer=function(e){var t=this._gl.createBuffer();return this.bindBuffer(t,this._gl.ARRAY_BUFFER),e instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},o.prototype.createDynamicVertexBuffer=function(e){var t=this._gl.createBuffer();return this.bindBuffer(t,this._gl.ARRAY_BUFFER),e instanceof Float32Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this._resetVertexBufferBinding(),t.references=1,t},o.prototype.updateDynamicVertexBuffer=function(e,t,i,n){this.bindBuffer(e,this._gl.ARRAY_BUFFER),void 0===i&&(i=0),void 0===n?t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,t):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,i,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t.subarray(i,i+n)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(i,i+n)),this._resetVertexBufferBinding()},o.prototype._resetIndexBufferBinding=function(){this.bindBuffer(null,this._gl.ELEMENT_ARRAY_BUFFER),this._cachedIndexBuffer=null},o.prototype.createIndexBuffer=function(e){var t=this._gl.createBuffer();this.bindBuffer(t,this._gl.ELEMENT_ARRAY_BUFFER);var i,n=!1;if(this._caps.uintIndices){for(var r=0;r<e.length;r++)if(e[r]>65535){n=!0;break}i=n?new Uint32Array(e):new Uint16Array(e)}else i=new Uint16Array(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=n,t},o.prototype.bindArrayBuffer=function(e){this.bindBuffer(e,this._gl.ARRAY_BUFFER)},o.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},o.prototype.bindBuffer=function(e,t){this._currentBoundBuffer[t]!==e&&(this._gl.bindBuffer(t,e),
this._currentBoundBuffer[t]=e)},o.prototype.bindBuffersDirectly=function(e,t,i,n,r){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==r){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this.bindBuffer(e,this._gl.ARRAY_BUFFER);for(var o=0,s=0;s<i.length;s++){var a=r.getAttributeLocation(s);a>=0&&this._gl.vertexAttribPointer(a,i[s],this._gl.FLOAT,!1,n,o),o+=4*i[s]}}this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this.bindBuffer(t,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=t.is32Bits)},o.prototype.bindBuffers=function(e,t,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;for(var n=i.getAttributesNames(),r=0;r<n.length;r++){var o=i.getAttributeLocation(r);if(o>=0){var s=e[n[r]];if(!s)continue;var a=s.getBuffer();this.bindBuffer(a,this._gl.ARRAY_BUFFER),this._gl.vertexAttribPointer(o,s.getSize(),this._gl.FLOAT,!1,4*s.getStrideSize(),4*s.getOffset()),s.getIsInstanced()&&(this._caps.instancedArrays.vertexAttribDivisorANGLE(o,1),this._currentInstanceLocations.push(o),this._currentInstanceBuffers.push(a))}}}null!=t&&this._cachedIndexBuffer!==t&&(this._cachedIndexBuffer=t,this.bindBuffer(t,this._gl.ELEMENT_ARRAY_BUFFER),this._uintIndicesCurrentlySet=t.is32Bits)},o.prototype.unbindInstanceAttributes=function(){for(var e,t=0,i=this._currentInstanceLocations.length;i>t;t++){var n=this._currentInstanceBuffers[t];e!=n&&(e=n,this.bindBuffer(n,this._gl.ARRAY_BUFFER));var r=this._currentInstanceLocations[t];this._caps.instancedArrays.vertexAttribDivisorANGLE(r,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},o.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._gl.deleteBuffer(e),!0)},o.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();return t.capacity=e,this.bindBuffer(t,this._gl.ARRAY_BUFFER),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),t},o.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},o.prototype.updateAndBindInstancesBuffer=function(e,t,i){if(this.bindBuffer(e,this._gl.ARRAY_BUFFER),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==i[0].index){for(var n=0,r=0;r<i.length;r++){var o=i[r];n+=4*o.attributeSize}for(var r=0;r<i.length;r++){var o=i[r];this._gl.enableVertexAttribArray(o.index),this._gl.vertexAttribPointer(o.index,o.attributeSize,o.attribyteType||this._gl.FLOAT,o.normalized||!1,n,o.offset),this._caps.instancedArrays.vertexAttribDivisorANGLE(o.index,1),this._currentInstanceLocations.push(o.index),this._currentInstanceBuffers.push(e)}}else for(var s=0;4>s;s++){var a=i[s];this._gl.enableVertexAttribArray(a),this._gl.vertexAttribPointer(a,4,this._gl.FLOAT,!1,64,16*s),this._caps.instancedArrays.vertexAttribDivisorANGLE(a,1),this._currentInstanceLocations.push(a),this._currentInstanceBuffers.push(e)}},o.prototype.applyStates=function(){this._depthCullingState.apply(this._gl),this._alphaState.apply(this._gl)},o.prototype.draw=function(e,t,i,n){this.applyStates(),this._drawCalls++;var r=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;return n?void this._caps.instancedArrays.drawElementsInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,i,r,t*o,n):void this._gl.drawElements(e?this._gl.TRIANGLES:this._gl.LINES,i,r,t*o)},o.prototype.drawPointClouds=function(e,t,i){return this.applyStates(),this._drawCalls++,i?void this._caps.instancedArrays.drawArraysInstancedANGLE(this._gl.POINTS,e,t,i):void this._gl.drawArrays(this._gl.POINTS,e,t)},o.prototype.drawUnIndexed=function(e,t,i,n){return this.applyStates(),this._drawCalls++,n?void this._caps.instancedArrays.drawArraysInstancedANGLE(e?this._gl.TRIANGLES:this._gl.LINES,t,i,n):void this._gl.drawArrays(e?this._gl.TRIANGLES:this._gl.LINES,t,i)},o.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],e.getProgram()&&this._gl.deleteProgram(e.getProgram()))},o.prototype.createEffect=function(t,i,n,r,o,s,a,h,l){var c=t.vertexElement||t.vertex||t,u=t.fragmentElement||t.fragment||t,d=c+"+"+u+"@"+o;if(this._compiledEffects[d])return this._compiledEffects[d];var f=new e.Effect(t,i,n,r,this,o,s,a,h,l);return f._key=d,this._compiledEffects[d]=f,f},o.prototype.createEffectForParticles=function(e,t,i,n,r,o,s){return void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n=""),this.createEffect({vertex:"particles",fragmentElement:e},["position","color","options"],["view","projection"].concat(t),["diffuseSampler"].concat(i),n,r,o,s)},o.prototype.createShaderProgram=function(e,i,n){var r=t(this._gl,e,"vertex",n),o=t(this._gl,i,"fragment",n),s=this._gl.createProgram();this._gl.attachShader(s,r),this._gl.attachShader(s,o),this._gl.linkProgram(s);var a=this._gl.getProgramParameter(s,this._gl.LINK_STATUS);if(!a){var h=this._gl.getProgramInfoLog(s);if(h)throw new Error(h)}return this._gl.deleteShader(r),this._gl.deleteShader(o),s},o.prototype.getUniforms=function(e,t){for(var i=[],n=0;n<t.length;n++)i.push(this._gl.getUniformLocation(e,t[n]));return i},o.prototype.getAttributes=function(e,t){for(var i=[],n=0;n<t.length;n++)try{i.push(this._gl.getAttribLocation(e,t[n]))}catch(e){i.push(-1)}return i},o.prototype.enableEffect=function(e){if(!e||!e.getAttributesCount()||this._currentEffect===e)return void(e&&e.onBind&&e.onBind(e));this._vertexAttribArraysToUse=this._vertexAttribArraysToUse||[],this._vertexAttribArraysEnabled=this._vertexAttribArraysEnabled||[],this._gl.useProgram(e.getProgram());var t,i;for(t=0,i=this._vertexAttribArraysToUse.length;i>t;t++)this._vertexAttribArraysToUse[t]=!1;var n=e.getAttributesCount();for(t=0;n>t;t++){var r=e.getAttributeLocation(t);r>=0&&(this._vertexAttribArraysToUse[r]=!0)}for(t=0,i=this._vertexAttribArraysEnabled.length;i>t;t++)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[t]||this._vertexAttribArraysToUse[t]||(this._vertexAttribArraysEnabled[t]=!1,this._gl.disableVertexAttribArray(t));for(t=0,i=this._vertexAttribArraysToUse.length;i>t;t++)this._vertexAttribArraysToUse[t]&&!this._vertexAttribArraysEnabled[t]&&(this._vertexAttribArraysEnabled[t]=!0,this._gl.enableVertexAttribArray(t));this._currentEffect=e,e.onBind&&e.onBind(e)},o.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},o.prototype.setArray2=function(e,t){e&&t.length%2===0&&this._gl.uniform2fv(e,t)},o.prototype.setArray3=function(e,t){e&&t.length%3===0&&this._gl.uniform3fv(e,t)},o.prototype.setArray4=function(e,t){e&&t.length%4===0&&this._gl.uniform4fv(e,t)},o.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},o.prototype.setMatrix=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t.toArray())},o.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},o.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},o.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},o.prototype.setFloat2=function(e,t,i){e&&this._gl.uniform2f(e,t,i)},o.prototype.setFloat3=function(e,t,i,n){e&&this._gl.uniform3f(e,t,i,n)},o.prototype.setBool=function(e,t){e&&this._gl.uniform1i(e,t)},o.prototype.setFloat4=function(e,t,i,n,r){e&&this._gl.uniform4f(e,t,i,n,r)},o.prototype.setColor3=function(e,t){e&&this._gl.uniform3f(e,t.r,t.g,t.b)},o.prototype.setColor4=function(e,t,i){e&&this._gl.uniform4f(e,t.r,t.g,t.b,i)},o.prototype.setState=function(e,t,i,n){void 0===t&&(t=0),void 0===n&&(n=!1);var r=n?this._gl.FRONT:this._gl.BACK,o=n?this._gl.BACK:this._gl.FRONT,s=this.cullBackFaces?r:o;(this._depthCullingState.cull!==e||i||this._depthCullingState.cullFace!==s)&&(e?(this._depthCullingState.cullFace=s,this._depthCullingState.cull=!0):this._depthCullingState.cull=!1),this._depthCullingState.zOffset=t},o.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},o.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},o.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},o.prototype.setColorWrite=function(e){this._gl.colorMask(e,e,e,e)},o.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case o.ALPHA_DISABLE:this._alphaState.alphaBlend=!1;break;case o.ALPHA_COMBINE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case o.ALPHA_ONEONE:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case o.ALPHA_ADD:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case o.ALPHA_SUBTRACT:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case o.ALPHA_MULTIPLY:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case o.ALPHA_MAXIMIZED:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0}t||this.setDepthWrite(e===o.ALPHA_DISABLE),this._alphaMode=e}},o.prototype.getAlphaMode=function(){return this._alphaMode},o.prototype.setAlphaTesting=function(e){this._alphaTest=e},o.prototype.getAlphaTesting=function(){return this._alphaTest},o.prototype.wipeCaches=function(){this.resetTextureCache(),this._currentEffect=null,this._depthCullingState.reset(),this.setDepthFunctionToLessOrEqual(),this._alphaState.reset(),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null},o.prototype.setSamplingMode=function(t,i){var n=this._gl;n.bindTexture(n.TEXTURE_2D,t);var r=n.NEAREST,o=n.NEAREST;i===e.Texture.BILINEAR_SAMPLINGMODE?(r=n.LINEAR,o=n.LINEAR):i===e.Texture.TRILINEAR_SAMPLINGMODE&&(r=n.LINEAR,o=n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,o),n.bindTexture(n.TEXTURE_2D,null),t.samplingMode=i},o.prototype.createTexture=function(t,i,n,o,s,a,h,l){var c=this;void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),void 0===l&&(l=null);var u,d=this._gl.createTexture(),f=!1;if("data:"===t.substr(0,5)&&(f=!0),f){var p=t;f=p.split(":"),t=p,u=f[1].substr(f[1].length-4,4).toLowerCase()}else u=t.substr(t.length-4,4).toLowerCase();var _=this.getCaps().s3tc&&".dds"===u,m=".tga"===u;o._addPendingData(d),d.url=t,d.noMipmap=i,d.references=1,d.samplingMode=s,this._loadedTexturesCache.push(d);var g,v=function(){o._removePendingData(d),h&&h()};if(m)g=function(t){var h=new Uint8Array(t),l=e.Internals.TGATools.GetTGAHeader(h);r(d,c._gl,o,l.width,l.height,n,i,!1,function(){e.Internals.TGATools.UploadContent(c._gl,h)},a,s)},f instanceof Array?g(l):e.Tools.LoadFile(t,function(e){g(e)},v,o.database,!0);else if(_)g=function(t){var h=e.Internals.DDSTools.GetDDSInfo(t),l=(h.isRGB||h.isLuminance||h.mipmapCount>1)&&!i&&h.width>>h.mipmapCount-1===1;r(d,c._gl,o,h.width,h.height,n,!l,h.isFourCC,function(){e.Internals.DDSTools.UploadDDSLevels(c._gl,c.getCaps().s3tc,t,h,l,1)},a,s)},f instanceof Array?g(l):e.Tools.LoadFile(t,function(e){g(e)},v,o.database,!0);else{var y=function(t){r(d,c._gl,o,t.width,t.height,n,i,!1,function(i,n){var r=t.width===i&&t.height===n;r||(c._prepareWorkingCanvas(),c._workingCanvas.width=i,c._workingCanvas.height=n,s===e.Texture.NEAREST_SAMPLINGMODE&&(c._workingContext.imageSmoothingEnabled=!1,c._workingContext.mozImageSmoothingEnabled=!1,c._workingContext.oImageSmoothingEnabled=!1,c._workingContext.webkitImageSmoothingEnabled=!1,c._workingContext.msImageSmoothingEnabled=!1),c._workingContext.drawImage(t,0,0,t.width,t.height,0,0,i,n),s===e.Texture.NEAREST_SAMPLINGMODE&&(c._workingContext.imageSmoothingEnabled=!0,c._workingContext.mozImageSmoothingEnabled=!0,c._workingContext.oImageSmoothingEnabled=!0,c._workingContext.webkitImageSmoothingEnabled=!0,c._workingContext.msImageSmoothingEnabled=!0)),c._gl.texImage2D(c._gl.TEXTURE_2D,0,c._gl.RGBA,c._gl.RGBA,c._gl.UNSIGNED_BYTE,r?t:c._workingCanvas)},a,s)};f instanceof Array?e.Tools.LoadImage(l,y,v,o.database):e.Tools.LoadImage(t,y,v,o.database)}return d},o.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case o.TEXTUREFORMAT_ALPHA:t=this._gl.ALPHA;break;case o.TEXTUREFORMAT_LUMINANCE:t=this._gl.LUMINANCE;break;case o.TEXTUREFORMAT_LUMINANCE_ALPHA:t=this._gl.LUMINANCE_ALPHA;break;case o.TEXTUREFORMAT_RGB:t=this._gl.RGB;break;case o.TEXTUREFORMAT_RGBA:t=this._gl.RGBA}return t},o.prototype.updateRawTexture=function(e,t,i,n,r){void 0===r&&(r=null);var o=this._getInternalFormat(i);this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,void 0===n?1:n?1:0),e._width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),r?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[r],e._width,e._height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,o,e._width,e._height,0,o,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),e.isReady=!0},o.prototype.createRawTexture=function(e,t,i,r,o,s,a,h){void 0===h&&(h=null);var l=this._gl.createTexture();l._baseWidth=t,l._baseHeight=i,l._width=t,l._height=i,l.references=1,this.updateRawTexture(l,e,r,s,h),this._gl.bindTexture(this._gl.TEXTURE_2D,l);var c=n(a,o,this._gl);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,c.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,c.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null),l.samplingMode=a,this._loadedTexturesCache.push(l),l},o.prototype.createDynamicTexture=function(t,i,n,r){var o=this._gl.createTexture();return o._baseWidth=t,o._baseHeight=i,n&&(t=e.Tools.GetExponentOfTwo(t,this._caps.maxTextureSize),i=e.Tools.GetExponentOfTwo(i,this._caps.maxTextureSize)),this.resetTextureCache(),o._width=t,o._height=i,o.isReady=!1,o.generateMipMaps=n,o.references=1,o.samplingMode=r,this.updateTextureSamplingMode(r,o),this._loadedTexturesCache.push(o),o},o.prototype.updateTextureSamplingMode=function(e,t){var i=n(e,t.generateMipMaps,this._gl);t.isCube?(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,t),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null)):(this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,i.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,i.min),this._gl.bindTexture(this._gl.TEXTURE_2D,null))},o.prototype.updateDynamicTexture=function(e,t,i,n){void 0===n&&(n=!1),this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?1:0),n&&this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),e.isReady=!0},o.prototype.updateVideoTexture=function(e,t,i){if(!e._isDisabled){this._gl.bindTexture(this._gl.TEXTURE_2D,e),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,i?0:1);try{void 0===this._videoTextureSupported&&(this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t),0!==this._gl.getError()?this._videoTextureSupported=!1:this._videoTextureSupported=!0),this._videoTextureSupported?this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t):(e._workingCanvas||(e._workingCanvas=document.createElement("canvas"),e._workingContext=e._workingCanvas.getContext("2d"),e._workingCanvas.width=e._width,e._workingCanvas.height=e._height),e._workingContext.drawImage(t,0,0,t.videoWidth,t.videoHeight,0,0,e._width,e._height),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,e._workingCanvas)),e.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this.resetTextureCache(),e.isReady=!0}catch(t){e._isDisabled=!0}}},o.prototype.createRenderTargetTexture=function(t,r){var s=!1,a=!0,h=o.TEXTURETYPE_UNSIGNED_INT,l=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==r&&(s=void 0===r.generateMipMaps?r:r.generateMipMaps,a=void 0===r.generateDepthBuffer||r.generateDepthBuffer,h=void 0===r.type?h:r.type,void 0!==r.samplingMode&&(l=r.samplingMode),h===o.TEXTURETYPE_FLOAT&&(l=e.Texture.NEAREST_SAMPLINGMODE));var c=this._gl,u=c.createTexture();c.bindTexture(c.TEXTURE_2D,u);var d=t.width||t,f=t.height||t,p=n(l,s,c);h!==o.TEXTURETYPE_FLOAT||this._caps.textureFloat||(h=o.TEXTURETYPE_UNSIGNED_INT,e.Tools.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,p.mag),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,p.min),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,d,f,0,c.RGBA,i(c,h),null);var _;a&&(_=c.createRenderbuffer(),c.bindRenderbuffer(c.RENDERBUFFER,_),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,d,f));var m=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,m),a&&c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,_),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,null),c.bindFramebuffer(c.FRAMEBUFFER,null),u._framebuffer=m,a&&(u._depthBuffer=_),u._baseWidth=d,u._baseHeight=f,u._width=d,u._height=f,u.isReady=!0,u.generateMipMaps=s,u.references=1,u.samplingMode=l,this.resetTextureCache(),this._loadedTexturesCache.push(u),u},o.prototype.createRenderTargetCubeTexture=function(t,i){var r=this._gl,o=r.createTexture(),s=!0,a=e.Texture.TRILINEAR_SAMPLINGMODE;void 0!==i&&(s=void 0===i.generateMipMaps?i:i.generateMipMaps,void 0!==i.samplingMode&&(a=i.samplingMode)),o.isCube=!0,o.references=1,o.generateMipMaps=s,o.references=1,o.samplingMode=a;var h=n(a,s,r);r.bindTexture(r.TEXTURE_CUBE_MAP,o);for(var l=0;6>l;l++)r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,r.RGBA,t,t,0,r.RGBA,r.UNSIGNED_BYTE,null);r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,h.mag),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,h.min),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);var c=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,c),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,t,t);var u=r.createFramebuffer();return r.bindFramebuffer(r.FRAMEBUFFER,u),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,c),o.generateMipMaps&&(r.bindTexture(r.TEXTURE_CUBE_MAP,o),r.generateMipmap(r.TEXTURE_CUBE_MAP)),r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),o._framebuffer=u,o._depthBuffer=c,this.resetTextureCache(),o._width=t,o._height=t,o.isReady=!0,o},o.prototype.createCubeTexture=function(t,i,n,r){var o=this,a=this._gl,h=a.createTexture();h.isCube=!0,h.url=t,h.references=1;var l=t.substr(t.length-4,4).toLowerCase(),c=this.getCaps().s3tc&&".dds"===l;return c?e.Tools.LoadFile(t,function(t){var i=e.Internals.DDSTools.GetDDSInfo(t),n=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&!r;a.bindTexture(a.TEXTURE_CUBE_MAP,h),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1),e.Internals.DDSTools.UploadDDSLevels(o._gl,o.getCaps().s3tc,t,i,n,6),r||i.isFourCC||1!==i.mipmapCount||a.generateMipmap(a.TEXTURE_CUBE_MAP),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,n?a.LINEAR_MIPMAP_LINEAR:a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_CUBE_MAP,null),o.resetTextureCache(),h._width=i.width,h._height=i.height,h.isReady=!0},null,null,!0):s(t,i,function(t){var i=e.Tools.GetExponentOfTwo(t[0].width,o._caps.maxCubemapTextureSize),n=i;o._prepareWorkingCanvas(),o._workingCanvas.width=i,o._workingCanvas.height=n;var s=[a.TEXTURE_CUBE_MAP_POSITIVE_X,a.TEXTURE_CUBE_MAP_POSITIVE_Y,a.TEXTURE_CUBE_MAP_POSITIVE_Z,a.TEXTURE_CUBE_MAP_NEGATIVE_X,a.TEXTURE_CUBE_MAP_NEGATIVE_Y,a.TEXTURE_CUBE_MAP_NEGATIVE_Z];a.bindTexture(a.TEXTURE_CUBE_MAP,h),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,0);for(var l=0;l<s.length;l++)o._workingContext.drawImage(t[l],0,0,t[l].width,t[l].height,0,0,i,n),a.texImage2D(s[l],0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,o._workingCanvas);r||a.generateMipmap(a.TEXTURE_CUBE_MAP),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,r?a.LINEAR:a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindTexture(a.TEXTURE_CUBE_MAP,null),o.resetTextureCache(),h._width=i,h._height=n,h.isReady=!0},n),h},o.prototype.updateTextureSize=function(e,t,i){e._width=t,e._height=i,e._size=t*i,e._baseWidth=t,e._baseHeight=i},o.prototype.createRawCubeTexture=function(t,i,n,r,s,a,h,l){var c=this,u=this._gl,d=u.createTexture();i._addPendingData(d),d.isCube=!0,d.references=1,d.url=t;var f=this._getInternalFormat(r),p=u.UNSIGNED_BYTE;s===o.TEXTURETYPE_FLOAT&&(p=u.FLOAT);var _=n,m=_,g=e.Tools.IsExponentOfTwo(_)&&e.Tools.IsExponentOfTwo(m);d._width=_,d._height=m;var v=function(){i._removePendingData(d)},y=function(t){var n=h(t),r=[u.TEXTURE_CUBE_MAP_POSITIVE_X,u.TEXTURE_CUBE_MAP_POSITIVE_Y,u.TEXTURE_CUBE_MAP_POSITIVE_Z,u.TEXTURE_CUBE_MAP_NEGATIVE_X,u.TEXTURE_CUBE_MAP_NEGATIVE_Y,u.TEXTURE_CUBE_MAP_NEGATIVE_Z];if(_=d._width,m=d._height,g=e.Tools.IsExponentOfTwo(_)&&e.Tools.IsExponentOfTwo(m),u.bindTexture(u.TEXTURE_CUBE_MAP,d),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,0),!a&&g)if(l){var o=[];o.push(n[0]),o.push(n[3]),o.push(n[1]),o.push(n[4]),o.push(n[2]),o.push(n[5]);for(var s=l(o),v=0;v<s.length;v++){var y=_>>v;u.texImage2D(r[0],v,f,y,y,0,f,p,s[v][0]),u.texImage2D(r[1],v,f,y,y,0,f,p,s[v][2]),u.texImage2D(r[2],v,f,y,y,0,f,p,s[v][4]),u.texImage2D(r[3],v,f,y,y,0,f,p,s[v][1]),u.texImage2D(r[4],v,f,y,y,0,f,p,s[v][3]),u.texImage2D(r[5],v,f,y,y,0,f,p,s[v][5])}}else{for(var b=0;b<r.length;b++){var x=n[b];u.texImage2D(r[b],0,f,_,m,0,f,p,x)}if(u.generateMipmap(u.TEXTURE_CUBE_MAP),p===u.FLOAT&&f===u.RGB&&1282===u.getError()){e.Tools.Log("RGB32F not renderable on Firefox, trying fallback to RGBA32F.");for(var b=0;b<r.length;b++){for(var x=n[b],P=new Float32Array(_*m*4),A=0;_>A;A++)for(var C=0;m>C;C++){var E=3*(C*_+A),T=4*(C*_+A);P[T+0]=x[E+0],P[T+1]=x[E+1],P[T+2]=x[E+2],P[T+3]=1}u.texImage2D(r[b],0,u.RGBA,_,m,0,u.RGBA,p,P)}u.generateMipmap(u.TEXTURE_CUBE_MAP)}}else a=!0;p!==u.FLOAT||c._caps.textureFloatLinearFiltering?(u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MIN_FILTER,a?u.LINEAR:u.LINEAR_MIPMAP_LINEAR)):(u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_MIN_FILTER,u.NEAREST)),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_CUBE_MAP,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.bindTexture(u.TEXTURE_CUBE_MAP,null),d.isReady=!0,c.resetTextureCache(),i._removePendingData(d)};return e.Tools.LoadFile(t,function(e){y(e)},v,i.database,!0),d},o.prototype._releaseTexture=function(e){var t=this._gl;e._framebuffer&&t.deleteFramebuffer(e._framebuffer),e._depthBuffer&&t.deleteRenderbuffer(e._depthBuffer),t.deleteTexture(e),this.unbindAllTextures();var i=this._loadedTexturesCache.indexOf(e);-1!==i&&this._loadedTexturesCache.splice(i,1)},o.prototype.bindSamplers=function(e){this._gl.useProgram(e.getProgram());for(var t=e.getSamplers(),i=0;i<t.length;i++){var n=e.getUniform(t[i]);this._gl.uniform1i(n,i)}this._currentEffect=null},o.prototype._bindTexture=function(e,t){0>e||(this._gl.activeTexture(this._gl["TEXTURE"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,t),this._activeTexturesCache[e]=null)},o.prototype.setTextureFromPostProcess=function(e,t){this._bindTexture(e,t._textures.data[t._currentRenderTextureInd])},o.prototype.unbindAllTextures=function(){for(var e=0;e<this._caps.maxTexturesImageUnits;e++)this._gl.activeTexture(this._gl["TEXTURE"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[e]=null},o.prototype.setTexture=function(t,i){if(!(0>t)){if(!i||!i.isReady())return void(null!=this._activeTexturesCache[t]&&(this._gl.activeTexture(this._gl["TEXTURE"+t]),this._gl.bindTexture(this._gl.TEXTURE_2D,null),this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,null),this._activeTexturesCache[t]=null));var n=!1;if(i instanceof e.VideoTexture)this._gl.activeTexture(this._gl["TEXTURE"+t]),n=!0,i.update();else if(i.delayLoadState===o.DELAYLOADSTATE_NOTLOADED)return void i.delayLoad();if(this._activeTexturesCache[t]!==i){this._activeTexturesCache[t]=i;var r=i.getInternalTexture();if(n||this._gl.activeTexture(this._gl["TEXTURE"+t]),r.isCube){if(this._gl.bindTexture(this._gl.TEXTURE_CUBE_MAP,r),r._cachedCoordinatesMode!==i.coordinatesMode){r._cachedCoordinatesMode=i.coordinatesMode;var s=i.coordinatesMode!==e.Texture.CUBIC_MODE&&i.coordinatesMode!==e.Texture.SKYBOX_MODE?this._gl.REPEAT:this._gl.CLAMP_TO_EDGE;this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_S,s),this._gl.texParameteri(this._gl.TEXTURE_CUBE_MAP,this._gl.TEXTURE_WRAP_T,s)}this._setAnisotropicLevel(this._gl.TEXTURE_CUBE_MAP,i)}else{if(this._gl.bindTexture(this._gl.TEXTURE_2D,r),r._cachedWrapU!==i.wrapU)switch(r._cachedWrapU=i.wrapU,i.wrapU){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.MIRRORED_REPEAT)}if(r._cachedWrapV!==i.wrapV)switch(r._cachedWrapV=i.wrapV,i.wrapV){case e.Texture.WRAP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.REPEAT);break;case e.Texture.CLAMP_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);break;case e.Texture.MIRROR_ADDRESSMODE:this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.MIRRORED_REPEAT)}this._setAnisotropicLevel(this._gl.TEXTURE_2D,i)}}}},o.prototype._setAnisotropicLevel=function(t,i){var n=this._caps.textureAnisotropicFilterExtension,r=i.anisotropicFilteringLevel;i.getInternalTexture().samplingMode===e.Texture.NEAREST_SAMPLINGMODE&&(r=1),n&&i._cachedAnisotropicFilteringLevel!==r&&(this._gl.texParameterf(t,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy)),i._cachedAnisotropicFilteringLevel=r)},o.prototype.readPixels=function(e,t,i,n){var r=new Uint8Array(n*i*4);return this._gl.readPixels(e,t,i,n,this._gl.RGBA,this._gl.UNSIGNED_BYTE,r),r},o.prototype.addExternalData=function(e,t){return this._externalData.add(e,t)},o.prototype.getExternalData=function(e){return this._externalData.get(e)},o.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData.getOrAddWithFactory(e,t)},o.prototype.removeExternalData=function(e){return this._externalData.remove(e)},o.prototype.releaseInternalTexture=function(e){if(e&&(e.references--,0===e.references)){var t=this.getLoadedTexturesCache(),i=t.indexOf(e);i>-1&&t.splice(i,1),this._releaseTexture(e)}},o.prototype.dispose=function(){for(this.hideLoadingUI(),this.stopRenderLoop();this.scenes.length;)this.scenes[0].dispose();o.audioEngine.dispose();for(var e in this._compiledEffects)this._gl.deleteProgram(this._compiledEffects[e]._program);if(this._vertexAttribArraysEnabled)for(var t=0,i=this._vertexAttribArraysEnabled.length;i>t;t++)t>this._gl.VERTEX_ATTRIB_ARRAY_ENABLED||!this._vertexAttribArraysEnabled[t]||this._gl.disableVertexAttribArray(t);this._gl=null,window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange)},o.prototype.displayLoadingUI=function(){this._loadingScreen.displayLoadingUI()},o.prototype.hideLoadingUI=function(){this._loadingScreen.hideLoadingUI()},Object.defineProperty(o.prototype,"loadingScreen",{get:function(){return this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"loadingUIText",{set:function(e){this._loadingScreen.loadingUIText=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"loadingUIBackgroundColor",{set:function(e){this._loadingScreen.loadingUIBackgroundColor=e},enumerable:!0,configurable:!0}),o.prototype.getFps=function(){return this.fps},o.prototype.getDeltaTime=function(){return this.deltaTime},o.prototype._measureFps=function(){this.previousFramesDuration.push(e.Tools.Now);var t=this.previousFramesDuration.length;if(t>=2&&(this.deltaTime=this.previousFramesDuration[t-1]-this.previousFramesDuration[t-2]),t>=this.fpsRange){t>this.fpsRange&&(this.previousFramesDuration.splice(0,1),t=this.previousFramesDuration.length);for(var i=0,n=0;t-1>n;n++)i+=this.previousFramesDuration[n+1]-this.previousFramesDuration[n];this.fps=1e3/(i/(t-1))}},o.isSupported=function(){try{if(navigator.isCocoonJS)return!0;var e=document.createElement("canvas"),t=e.getContext("webgl")||e.getContext("experimental-webgl");return null!=t&&!!window.WebGLRenderingContext}catch(e){return!1}},o._ALPHA_DISABLE=0,o._ALPHA_ADD=1,o._ALPHA_COMBINE=2,o._ALPHA_SUBTRACT=3,o._ALPHA_MULTIPLY=4,o._ALPHA_MAXIMIZED=5,o._ALPHA_ONEONE=6,o._DELAYLOADSTATE_NONE=0,o._DELAYLOADSTATE_LOADED=1,o._DELAYLOADSTATE_LOADING=2,o._DELAYLOADSTATE_NOTLOADED=4,o._TEXTUREFORMAT_ALPHA=0,o._TEXTUREFORMAT_LUMINANCE=1,o._TEXTUREFORMAT_LUMINANCE_ALPHA=2,o._TEXTUREFORMAT_RGB=4,o._TEXTUREFORMAT_RGBA=5,o._TEXTURETYPE_UNSIGNED_INT=0,o._TEXTURETYPE_FLOAT=1,o.CollisionsEpsilon=.001,o.CodeRepository="src/",o.ShadersRepository="src/Shaders/",o}();e.Engine=l}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.state="",this.animations=new Array,this._ranges={},this._childrenFlag=-1,this._isEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentRenderId=-1,this.name=e,this.id=e,this._scene=t,this._initCache()}return Object.defineProperty(t.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){if(this._parentNode){var t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1)}this._parentNode=e,this._parentNode&&(this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this))}},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene;
},t.prototype.getEngine=function(){return this._scene.getEngine()},t.prototype.getWorldMatrix=function(){return e.Matrix.Identity()},t.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},t.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},t.prototype._updateCache=function(e){},t.prototype._isSynchronized=function(){return!0},t.prototype._markSyncedWithParent=function(){this._parentRenderId=this.parent._currentRenderId},t.prototype.isSynchronizedWithParent=function(){return!this.parent||this._parentRenderId===this.parent._currentRenderId&&this.parent.isSynchronized()},t.prototype.isSynchronized=function(e){var t=this.hasNewParent();return t=t||!this.isSynchronizedWithParent(),t=t||!this._isSynchronized(),e&&this.updateCache(!0),!t},t.prototype.hasNewParent=function(e){return this._cache.parent!==this.parent&&(e&&(this._cache.parent=this.parent),!0)},t.prototype.isReady=function(){return this._isReady},t.prototype.isEnabled=function(){return!!this._isEnabled&&(!this.parent||this.parent.isEnabled())},t.prototype.setEnabled=function(e){this._isEnabled=e},t.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},t.prototype._getDescendants=function(e,t,i){if(void 0===t&&(t=!1),this._children)for(var n=0;n<this._children.length;n++){var r=this._children[n];i&&!i(r)||e.push(r),t||r._getDescendants(e,!1,i)}},t.prototype.getDescendants=function(e,t){var i=[];return this._getDescendants(i,e,t),i},t.prototype.getChildren=function(e){return this.getDescendants(!0,e)},t.prototype.getChildMeshes=function(t,i){var n=[];return this._getDescendants(n,t,function(t){return(!i||i(t))&&t instanceof e.AbstractMesh}),n},t.prototype._setReady=function(e){if(e!==this._isReady){if(!e)return void(this._isReady=!1);this._isReady=!0,this.onReady&&this.onReady(this)}},t.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var i=this.animations[t];if(i.name===e)return i}return null},t.prototype.createAnimationRange=function(t,i,n){if(!this._ranges[t]){this._ranges[t]=new e.AnimationRange(t,i,n);for(var r=0,o=this.animations.length;o>r;r++)this.animations[r]&&this.animations[r].createRange(t,i,n)}},t.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,n=this.animations.length;n>i;i++)this.animations[i]&&this.animations[i].deleteRange(e,t);this._ranges[e]=void 0},t.prototype.getAnimationRange=function(e){return this._ranges[e]},t.prototype.beginAnimation=function(e,t,i,n){var r=this.getAnimationRange(e);return r?void this._scene.beginAnimation(this,r.from,r.to,t,i,n):null},t.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var i={};i.name=t,i.from=this._ranges[t].from,i.to=this._ranges[t].to,e.push(i)}return e},t.prototype.dispose=function(){this.parent=null},t.ParseAnimationRanges=function(e,t,i){if(t.ranges)for(var n=0;n<t.ranges.length;n++){var r=t.ranges[n];e.createAnimationRange(r.name,r.from,r.to)}},__decorate([e.serialize()],t.prototype,"name",void 0),__decorate([e.serialize()],t.prototype,"id",void 0),__decorate([e.serialize()],t.prototype,"uniqueId",void 0),__decorate([e.serialize()],t.prototype,"state",void 0),t}();e.Node=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,n,r,o,s,a){this._engine=e,this._canvas=i,this._currentScene=t,this._sceneLoadedCallback=n,this._progressCallback=r,this._additionnalRenderLoopLogicCallback=o,this._textureLoadingCallback=s,this._startingProcessingFilesCallback=a}return t.prototype.monitorElementForDragNDrop=function(e){var t=this;e&&(this._elementToMonitor=e,this._elementToMonitor.addEventListener("dragenter",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener("dragover",function(e){t.drag(e)},!1),this._elementToMonitor.addEventListener("drop",function(e){t.drop(e)},!1))},t.prototype.renderFunction=function(){if(this._additionnalRenderLoopLogicCallback&&this._additionnalRenderLoopLogicCallback(),this._currentScene){if(this._textureLoadingCallback){var e=this._currentScene.getWaitingItemsCount();e>0&&this._textureLoadingCallback(e)}this._currentScene.render()}},t.prototype.drag=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.drop=function(e){e.stopPropagation(),e.preventDefault(),this.loadFiles(e)},t.prototype.loadFiles=function(e){if(this._startingProcessingFilesCallback&&this._startingProcessingFilesCallback(),e&&e.dataTransfer&&e.dataTransfer.files&&(this._filesToLoad=e.dataTransfer.files),e&&e.target&&e.target.files&&(this._filesToLoad=e.target.files),this._filesToLoad&&this._filesToLoad.length>0){for(var i=0;i<this._filesToLoad.length;i++)switch(this._filesToLoad[i].type){case"image/jpeg":case"image/png":case"image/bmp":t.FilesTextures[this._filesToLoad[i].name.toLowerCase()]=this._filesToLoad[i];break;case"image/targa":case"image/vnd.ms-dds":case"audio/wav":case"audio/x-wav":case"audio/mp3":case"audio/mpeg":case"audio/mpeg3":case"audio/x-mpeg-3":case"audio/ogg":t.FilesToLoad[this._filesToLoad[i].name.toLowerCase()]=this._filesToLoad[i];break;default:-1!==this._filesToLoad[i].name.indexOf(".mtl")?t.FilesToLoad[this._filesToLoad[i].name.toLowerCase()]=this._filesToLoad[i]:-1===this._filesToLoad[i].name.indexOf(".babylon")&&-1===this._filesToLoad[i].name.indexOf(".stl")&&-1===this._filesToLoad[i].name.indexOf(".obj")||-1!==this._filesToLoad[i].name.indexOf(".manifest")||-1!==this._filesToLoad[i].name.indexOf(".incremental")||-1!==this._filesToLoad[i].name.indexOf(".babylonmeshdata")||-1!==this._filesToLoad[i].name.indexOf(".babylongeometrydata")||-1!==this._filesToLoad[i].name.indexOf(".babylonbinarymeshdata")||-1!==this._filesToLoad[i].name.indexOf(".binary.babylon")||(this._sceneFileToLoad=this._filesToLoad[i])}this.reload()}},t.prototype.reload=function(){var t=this,i=this;this._sceneFileToLoad?(this._currentScene&&(e.Tools.errorsCount>0&&(e.Tools.ClearLogCache(),e.Tools.Log("Babylon.js engine (v"+e.Engine.Version+") launched")),this._engine.stopRenderLoop(),this._currentScene.dispose()),e.SceneLoader.Load("file:",this._sceneFileToLoad,this._engine,function(e){i._currentScene=e,i._currentScene.executeWhenReady(function(){i._currentScene.activeCamera&&0!==i._currentScene.lights.length||i._currentScene.createDefaultCameraOrLight(),i._currentScene.activeCamera.attachControl(i._canvas),i._sceneLoadedCallback&&i._sceneLoadedCallback(t._sceneFileToLoad,i._currentScene),i._engine.runRenderLoop(function(){i.renderFunction()})})},function(e){t._progressCallback&&t._progressCallback(e)})):e.Tools.Error("Please provide a valid .babylon file.")},t.FilesTextures=new Array,t.FilesToLoad=new Array,t}();e.FilesInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.bu=e,this.bv=t,this.distance=i,this.faceId=0,this.subMeshId=0}return e}();e.IntersectionInfo=t;var i=function(){function t(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.pickedSprite=null}return t.prototype.getNormal=function(t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.NormalKind))return null;var n,r=this.pickedMesh.getIndices();if(i){var o=this.pickedMesh.getVerticesData(e.VertexBuffer.NormalKind),s=e.Vector3.FromArray(o,3*r[3*this.faceId]),a=e.Vector3.FromArray(o,3*r[3*this.faceId+1]),h=e.Vector3.FromArray(o,3*r[3*this.faceId+2]);s=s.scale(this.bu),a=a.scale(this.bv),h=h.scale(1-this.bu-this.bv),n=new e.Vector3(s.x+a.x+h.x,s.y+a.y+h.y,s.z+a.z+h.z)}else{var l=this.pickedMesh.getVerticesData(e.VertexBuffer.PositionKind),c=e.Vector3.FromArray(l,3*r[3*this.faceId]),u=e.Vector3.FromArray(l,3*r[3*this.faceId+1]),d=e.Vector3.FromArray(l,3*r[3*this.faceId+2]),f=c.subtract(u),p=d.subtract(u);n=e.Vector3.Cross(f,p)}return t&&(n=e.Vector3.TransformNormal(n,this.pickedMesh.getWorldMatrix())),e.Vector3.Normalize(n)},t.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(e.VertexBuffer.UVKind))return null;var t=this.pickedMesh.getIndices(),i=this.pickedMesh.getVerticesData(e.VertexBuffer.UVKind),n=e.Vector2.FromArray(i,2*t[3*this.faceId]),r=e.Vector2.FromArray(i,2*t[3*this.faceId+1]),o=e.Vector2.FromArray(i,2*t[3*this.faceId+2]);return n=n.scale(1-this.bu-this.bv),r=r.scale(this.bu),o=o.scale(this.bv),new e.Vector2(n.x+r.x+o.x,n.y+r.y+o.y)},t}();e.PickingInfo=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this._tempRadiusVector=e.Vector3.Zero();var n=e.Vector3.Distance(t,i);this.center=e.Vector3.Lerp(t,i,.5),this.radius=.5*n,this.centerWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype._update=function(t){e.Vector3.TransformCoordinatesToRef(this.center,t,this.centerWorld),e.Vector3.TransformNormalFromFloatsToRef(1,1,1,t,this._tempRadiusVector),this.radiusWorld=Math.max(Math.abs(this._tempRadiusVector.x),Math.abs(this._tempRadiusVector.y),Math.abs(this._tempRadiusVector.z))*this.radius},t.prototype.isInFrustum=function(e){for(var t=0;6>t;t++)if(e[t].dotCoordinate(this.centerWorld)<=-this.radiusWorld)return!1;return!0},t.prototype.intersectsPoint=function(t){var i=this.centerWorld.x-t.x,n=this.centerWorld.y-t.y,r=this.centerWorld.z-t.z,o=Math.sqrt(i*i+n*n+r*r);return!(Math.abs(this.radiusWorld-o)<e.Epsilon)},t.Intersects=function(e,t){var i=e.centerWorld.x-t.centerWorld.x,n=e.centerWorld.y-t.centerWorld.y,r=e.centerWorld.z-t.centerWorld.z,o=Math.sqrt(i*i+n*n+r*r);return!(e.radiusWorld+t.radiusWorld<o)},t}();e.BoundingSphere=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.minimum=t,this.maximum=i,this.vectors=new Array,this.vectorsWorld=new Array,this.vectors.push(this.minimum.clone()),this.vectors.push(this.maximum.clone()),this.vectors.push(this.minimum.clone()),this.vectors[2].x=this.maximum.x,this.vectors.push(this.minimum.clone()),this.vectors[3].y=this.maximum.y,this.vectors.push(this.minimum.clone()),this.vectors[4].z=this.maximum.z,this.vectors.push(this.maximum.clone()),this.vectors[5].z=this.minimum.z,this.vectors.push(this.maximum.clone()),this.vectors[6].x=this.minimum.x,this.vectors.push(this.maximum.clone()),this.vectors[7].y=this.minimum.y,this.center=this.maximum.add(this.minimum).scale(.5),this.extendSize=this.maximum.subtract(this.minimum).scale(.5),this.directions=[e.Vector3.Zero(),e.Vector3.Zero(),e.Vector3.Zero()];for(var n=0;n<this.vectors.length;n++)this.vectorsWorld[n]=e.Vector3.Zero();this.minimumWorld=e.Vector3.Zero(),this.maximumWorld=e.Vector3.Zero(),this._update(e.Matrix.Identity())}return t.prototype.getWorldMatrix=function(){return this._worldMatrix},t.prototype.setWorldMatrix=function(e){return this._worldMatrix.copyFrom(e),this},t.prototype._update=function(t){e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimumWorld),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximumWorld);for(var i=0;i<this.vectors.length;i++){var n=this.vectorsWorld[i];e.Vector3.TransformCoordinatesToRef(this.vectors[i],t,n),n.x<this.minimumWorld.x&&(this.minimumWorld.x=n.x),n.y<this.minimumWorld.y&&(this.minimumWorld.y=n.y),n.z<this.minimumWorld.z&&(this.minimumWorld.z=n.z),n.x>this.maximumWorld.x&&(this.maximumWorld.x=n.x),n.y>this.maximumWorld.y&&(this.maximumWorld.y=n.y),n.z>this.maximumWorld.z&&(this.maximumWorld.z=n.z)}this.maximumWorld.addToRef(this.minimumWorld,this.center),this.center.scaleInPlace(.5),e.Vector3.FromFloatArrayToRef(t.m,0,this.directions[0]),e.Vector3.FromFloatArrayToRef(t.m,4,this.directions[1]),e.Vector3.FromFloatArrayToRef(t.m,8,this.directions[2]),this._worldMatrix=t},t.prototype.isInFrustum=function(e){return t.IsInFrustum(this.vectorsWorld,e)},t.prototype.isCompletelyInFrustum=function(e){return t.IsCompletelyInFrustum(this.vectorsWorld,e)},t.prototype.intersectsPoint=function(t){var i=-e.Epsilon;return!(this.maximumWorld.x-t.x<i||i>t.x-this.minimumWorld.x)&&(!(this.maximumWorld.y-t.y<i||i>t.y-this.minimumWorld.y)&&!(this.maximumWorld.z-t.z<i||i>t.z-this.minimumWorld.z))},t.prototype.intersectsSphere=function(e){return t.IntersectsSphere(this.minimumWorld,this.maximumWorld,e.centerWorld,e.radiusWorld)},t.prototype.intersectsMinMax=function(e,t){return!(this.maximumWorld.x<e.x||this.minimumWorld.x>t.x)&&(!(this.maximumWorld.y<e.y||this.minimumWorld.y>t.y)&&!(this.maximumWorld.z<e.z||this.minimumWorld.z>t.z))},t.Intersects=function(e,t){return!(e.maximumWorld.x<t.minimumWorld.x||e.minimumWorld.x>t.maximumWorld.x)&&(!(e.maximumWorld.y<t.minimumWorld.y||e.minimumWorld.y>t.maximumWorld.y)&&!(e.maximumWorld.z<t.minimumWorld.z||e.minimumWorld.z>t.maximumWorld.z))},t.IntersectsSphere=function(t,i,n,r){var o=e.Vector3.Clamp(n,t,i),s=e.Vector3.DistanceSquared(n,o);return r*r>=s},t.IsCompletelyInFrustum=function(e,t){for(var i=0;6>i;i++)for(var n=0;8>n;n++)if(t[i].dotCoordinate(e[n])<0)return!1;return!0},t.IsInFrustum=function(e,t){for(var i=0;6>i;i++){for(var n=8,r=0;8>r&&t[i].dotCoordinate(e[r])<0;r++)--n;if(0===n)return!1}return!0},t}();e.BoundingBox=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t,i){var n=e.Vector3.Dot(i.center,t),r=Math.abs(e.Vector3.Dot(i.directions[0],t))*i.extendSize.x,o=Math.abs(e.Vector3.Dot(i.directions[1],t))*i.extendSize.y,s=Math.abs(e.Vector3.Dot(i.directions[2],t))*i.extendSize.z,a=r+o+s;return{min:n-a,max:n+a}},i=function(e,t,i,n){return!(e>n||i>t)},n=function(e,n,r){var o=t(e,n),s=t(e,r);return i(o.min,o.max,s.min,s.max)},r=function(){function t(t,i){this.minimum=t,this.maximum=i,this._isLocked=!1,this.boundingBox=new e.BoundingBox(t,i),this.boundingSphere=new e.BoundingSphere(t,i)}return Object.defineProperty(t.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},t.prototype.isInFrustum=function(e){return!!this.boundingSphere.isInFrustum(e)&&this.boundingBox.isInFrustum(e)},t.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},t.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},t.prototype.intersectsPoint=function(e){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(e))&&!!this.boundingBox.intersectsPoint(e)},t.prototype.intersects=function(t,i){if(!this.boundingSphere.centerWorld||!t.boundingSphere.centerWorld)return!1;if(!e.BoundingSphere.Intersects(this.boundingSphere,t.boundingSphere))return!1;if(!e.BoundingBox.Intersects(this.boundingBox,t.boundingBox))return!1;if(!i)return!0;var r=this.boundingBox,o=t.boundingBox;return!!(n(r.directions[0],r,o)&&n(r.directions[1],r,o)&&n(r.directions[2],r,o)&&n(o.directions[0],r,o)&&n(o.directions[1],r,o)&&n(o.directions[2],r,o)&&n(e.Vector3.Cross(r.directions[0],o.directions[0]),r,o)&&n(e.Vector3.Cross(r.directions[0],o.directions[1]),r,o)&&n(e.Vector3.Cross(r.directions[0],o.directions[2]),r,o)&&n(e.Vector3.Cross(r.directions[1],o.directions[0]),r,o)&&n(e.Vector3.Cross(r.directions[1],o.directions[1]),r,o)&&n(e.Vector3.Cross(r.directions[1],o.directions[2]),r,o)&&n(e.Vector3.Cross(r.directions[2],o.directions[0]),r,o)&&n(e.Vector3.Cross(r.directions[2],o.directions[1]),r,o))&&!!n(e.Vector3.Cross(r.directions[2],o.directions[2]),r,o)},t}();e.BoundingInfo=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i){void 0===i&&(i=Number.MAX_VALUE),this.origin=e,this.direction=t,this.length=i}return t.prototype.intersectsBoxMinMax=function(e,t){var i,n,r,o,s=0,a=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<e.x||this.origin.x>t.x)return!1}else if(i=1/this.direction.x,n=(e.x-this.origin.x)*i,r=(t.x-this.origin.x)*i,r===-(1/0)&&(r=1/0),n>r&&(o=n,n=r,r=o),s=Math.max(n,s),a=Math.min(r,a),s>a)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<e.y||this.origin.y>t.y)return!1}else if(i=1/this.direction.y,n=(e.y-this.origin.y)*i,r=(t.y-this.origin.y)*i,r===-(1/0)&&(r=1/0),n>r&&(o=n,n=r,r=o),s=Math.max(n,s),a=Math.min(r,a),s>a)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<e.z||this.origin.z>t.z)return!1}else if(i=1/this.direction.z,n=(e.z-this.origin.z)*i,r=(t.z-this.origin.z)*i,r===-(1/0)&&(r=1/0),n>r&&(o=n,n=r,r=o),s=Math.max(n,s),a=Math.min(r,a),s>a)return!1;return!0},t.prototype.intersectsBox=function(e){return this.intersectsBoxMinMax(e.minimum,e.maximum)},t.prototype.intersectsSphere=function(e){var t=e.center.x-this.origin.x,i=e.center.y-this.origin.y,n=e.center.z-this.origin.z,r=t*t+i*i+n*n,o=e.radius*e.radius;if(o>=r)return!0;var s=t*this.direction.x+i*this.direction.y+n*this.direction.z;if(0>s)return!1;var a=r-s*s;return o>=a},t.prototype.intersectsTriangle=function(t,i,n){this._edge1||(this._edge1=e.Vector3.Zero(),this._edge2=e.Vector3.Zero(),this._pvec=e.Vector3.Zero(),this._tvec=e.Vector3.Zero(),this._qvec=e.Vector3.Zero()),i.subtractToRef(t,this._edge1),n.subtractToRef(t,this._edge2),e.Vector3.CrossToRef(this.direction,this._edge2,this._pvec);var r=e.Vector3.Dot(this._edge1,this._pvec);if(0===r)return null;var o=1/r;this.origin.subtractToRef(t,this._tvec);var s=e.Vector3.Dot(this._tvec,this._pvec)*o;if(0>s||s>1)return null;e.Vector3.CrossToRef(this._tvec,this._edge1,this._qvec);var a=e.Vector3.Dot(this.direction,this._qvec)*o;if(0>a||s+a>1)return null;var h=e.Vector3.Dot(this._edge2,this._qvec)*o;return h>this.length?null:new e.IntersectionInfo(s,a,h)},t.prototype.intersectsPlane=function(t){var i,n=e.Vector3.Dot(t.normal,this.direction);if(Math.abs(n)<9.99999997475243e-7)return null;var r=e.Vector3.Dot(t.normal,this.origin);return i=(-t.d-r)/n,0>i?-9.99999997475243e-7>i?null:0:i},t.prototype.intersectionSegment=function(i,n,r){var o,s,a,h,l=this.origin.add(this.direction.multiplyByFloats(t.rayl,t.rayl,t.rayl)),c=n.subtract(i),u=l.subtract(this.origin),d=i.subtract(this.origin),f=e.Vector3.Dot(c,c),p=e.Vector3.Dot(c,u),_=e.Vector3.Dot(u,u),m=e.Vector3.Dot(c,d),g=e.Vector3.Dot(u,d),v=f*_-p*p,y=v,b=v;v<t.smallnum?(s=0,y=1,h=g,b=_):(s=p*g-_*m,h=f*g-p*m,0>s?(s=0,h=g,b=_):s>y&&(s=y,h=g+p,b=_)),0>h?(h=0,0>-m?s=0:-m>f?s=y:(s=-m,y=f)):h>b&&(h=b,0>-m+p?s=0:-m+p>f?s=y:(s=-m+p,y=f)),o=Math.abs(s)<t.smallnum?0:s/y,a=Math.abs(h)<t.smallnum?0:h/b;var x=u.multiplyByFloats(a,a,a),P=d.add(c.multiplyByFloats(o,o,o)).subtract(x),A=a>0&&a<=this.length&&P.lengthSquared()<r*r;return A?x.length():-1},t.CreateNew=function(i,n,r,o,s,a,h){var l=e.Vector3.Unproject(new e.Vector3(i,n,0),r,o,s,a,h),c=e.Vector3.Unproject(new e.Vector3(i,n,1),r,o,s,a,h),u=c.subtract(l);return u.normalize(),new t(l,u)},t.CreateNewFromTo=function(i,n,r){void 0===r&&(r=e.Matrix.Identity());var o=n.subtract(i),s=Math.sqrt(o.x*o.x+o.y*o.y+o.z*o.z);return o.normalize(),t.Transform(new t(i,o,s),r)},t.Transform=function(i,n){var r=e.Vector3.TransformCoordinates(i.origin,n),o=e.Vector3.TransformNormal(i.direction,n);return o.normalize(),new t(r,o,i.length)},t.smallnum=1e-8,t.rayl=1e9,t}();e.Ray=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(n,r){var o=this;t.call(this,n,r),this.onDisposeObservable=new e.Observable,this.onCollideObservable=new e.Observable,this.onCollisionPositionChangeObservable=new e.Observable,this.onAfterWorldMatrixUpdateObservable=new e.Observable,this.definedFacingForward=!0,this.position=new e.Vector3(0,0,0),this._rotation=new e.Vector3(0,0,0),this._scaling=new e.Vector3(1,1,1),this.billboardMode=i.BILLBOARDMODE_NONE,this.visibility=1,this.alphaIndex=Number.MAX_VALUE,this.infiniteDistance=!1,this.isVisible=!0,this.isPickable=!0,this.showBoundingBox=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.renderingGroupId=0,this.receiveShadows=!1,this.renderOutline=!1,this.outlineColor=e.Color3.Red(),this.outlineWidth=.02,this.renderOverlay=!1,this.overlayColor=e.Color3.Red(),this.overlayAlpha=.5,this.hasVertexAlpha=!1,this.useVertexColors=!0,this.applyFog=!0,this.computeBonesUsingShaders=!0,this.scalingDeterminant=1,this.numBoneInfluencers=4,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.layerMask=268435455,this.alwaysSelectAsActiveMesh=!1,this._checkCollisions=!1,this.ellipsoid=new e.Vector3(.5,1,.5),this.ellipsoidOffset=new e.Vector3(0,0,0),this._collider=new e.Collider,this._oldPositionForCollisions=new e.Vector3(0,0,0),this._diffPositionForCollisions=new e.Vector3(0,0,0),this._newPositionForCollisions=new e.Vector3(0,0,0),this.edgesWidth=1,this.edgesColor=new e.Color4(1,0,0,1),this._localWorld=e.Matrix.Zero(),this._worldMatrix=e.Matrix.Zero(),this._rotateYByPI=e.Matrix.RotationY(Math.PI),this._absolutePosition=e.Vector3.Zero(),this._collisionsTransformMatrix=e.Matrix.Zero(),this._collisionsScalingMatrix=e.Matrix.Zero(),this._isDirty=!1,this._pivotMatrix=e.Matrix.Identity(),this._isDisposed=!1,this._renderId=0,this._intersectionsInProgress=new Array,this._isWorldMatrixFrozen=!1,this._unIndexed=!1,this._onCollisionPositionChange=function(t,i,n){void 0===n&&(n=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius),i.subtractToRef(o._oldPositionForCollisions,o._diffPositionForCollisions),o._diffPositionForCollisions.length()>e.Engine.CollisionsEpsilon&&o.position.addInPlace(o._diffPositionForCollisions),n&&o.onCollideObservable.notifyObservers(n),o.onCollisionPositionChangeObservable.notifyObservers(o.position)},r.addMesh(this)}return __extends(i,t),Object.defineProperty(i,"BILLBOARDMODE_NONE",{get:function(){return i._BILLBOARDMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_X",{get:function(){return i._BILLBOARDMODE_X},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Y",{get:function(){return i._BILLBOARDMODE_Y},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_Z",{get:function(){return i._BILLBOARDMODE_Z},enumerable:!0,configurable:!0}),Object.defineProperty(i,"BILLBOARDMODE_ALL",{get:function(){return i._BILLBOARDMODE_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onCollide",{set:function(e){this._onCollideObserver&&this.onCollideObservable.remove(this._onCollideObserver),this._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onCollisionPositionChange",{set:function(e){this._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._onCollisionPositionChangeObserver),this._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._skeleton},set:function(e){this._skeleton&&this._skeleton.needInitialSkinMatrix&&this._skeleton._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._skeleton=e,this._skeleton||(this._bonesTransformMatrices=null)},enumerable:!0,configurable:!0}),i.prototype.toString=function(t){var i="Name: "+this.name+", isInstance: "+(this instanceof e.InstancedMesh?"YES":"NO");return i+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0),this._skeleton&&(i+=", skeleton: "+this._skeleton.name),t&&(i+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],i+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingFreezeWorldMatrix?"YES":"NO")),i},Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this.physicsImpostor&&this.physicsImpostor.forceUpdate()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this.rotation.length()&&this.rotation.copyFromFloats(0,0,0)},enumerable:!0,configurable:!0}),i.prototype.updatePoseMatrix=function(e){this._poseMatrix.copyFrom(e)},i.prototype.getPoseMatrix=function(){return this._poseMatrix},i.prototype.disableEdgesRendering=function(){void 0!==this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=void 0)},i.prototype.enableEdgesRendering=function(t,i){void 0===t&&(t=.95),void 0===i&&(i=!1),this.disableEdgesRendering(),this._edgesRenderer=new e.EdgesRenderer(this,t,i)},Object.defineProperty(i.prototype,"isBlocked",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.getLOD=function(e){return this},i.prototype.getTotalVertices=function(){return 0},i.prototype.getIndices=function(){return null},i.prototype.getVerticesData=function(e){return null},i.prototype.isVerticesDataPresent=function(e){return!1},i.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},Object.defineProperty(i.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)},enumerable:!0,configurable:!0}),i.prototype._preActivate=function(){},i.prototype._preActivateForIntermediateRendering=function(e){},i.prototype._activate=function(e){this._renderId=e},i.prototype.getWorldMatrix=function(){return this._masterMesh?this._masterMesh.getWorldMatrix():(this._currentRenderId!==this.getScene().getRenderId()&&this.computeWorldMatrix(),this._worldMatrix)},Object.defineProperty(i.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!0,configurable:!0}),i.prototype.freezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this._isWorldMatrixFrozen=!0},i.prototype.unfreezeWorldMatrix=function(){this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)},Object.defineProperty(i.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!0,configurable:!0}),i.prototype.rotate=function(t,i,n){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation=e.Vector3.Zero());var r;if(n&&n!==e.Space.LOCAL){if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert(),t=e.Vector3.TransformNormal(t,o)}r=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=r.multiply(this.rotationQuaternion)}else r=e.Quaternion.RotationAxis(t,i),this.rotationQuaternion=this.rotationQuaternion.multiply(r)},i.prototype.translate=function(t,i,n){var r=t.scale(i);if(n&&n!==e.Space.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(r));else{var o=this.getPositionExpressedInLocalSpace().add(r);this.setPositionWithLocalVector(o)}},i.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},i.prototype.setAbsolutePosition=function(t){if(t){var i,n,r;if(void 0===t.x){if(arguments.length<3)return;i=arguments[0],n=arguments[1],r=arguments[2]}else i=t.x,n=t.y,r=t.z;if(this.parent){var o=this.parent.getWorldMatrix().clone();o.invert();var s=new e.Vector3(i,n,r);this.position=e.Vector3.TransformCoordinates(s,o)}else this.position.x=i,this.position.y=n,this.position.z=r}},i.prototype.movePOV=function(e,t,i){this.position.addInPlace(this.calcMovePOV(e,t,i))},i.prototype.calcMovePOV=function(t,i,n){var r=new e.Matrix,o=this.rotationQuaternion?this.rotationQuaternion:e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);o.toRotationMatrix(r);var s=e.Vector3.Zero(),a=this.definedFacingForward?-1:1;return e.Vector3.TransformCoordinatesFromFloatsToRef(t*a,i,n*a,r,s),s},i.prototype.rotatePOV=function(e,t,i){this.rotation.addInPlace(this.calcRotatePOV(e,t,i))},i.prototype.calcRotatePOV=function(t,i,n){var r=this.definedFacingForward?1:-1;return new e.Vector3(t*r,i,n*r)},i.prototype.setPivotMatrix=function(e){this._pivotMatrix=e,this._cache.pivotMatrixUpdated=!0},i.prototype.getPivotMatrix=function(){return this._pivotMatrix},i.prototype._isSynchronized=function(){if(this._isDirty)return!1;if(this.billboardMode!==this._cache.billboardMode||this.billboardMode!==i.BILLBOARDMODE_NONE)return!1;if(this._cache.pivotMatrixUpdated)return!1;if(this.infiniteDistance)return!1;if(!this._cache.position.equals(this.position))return!1;if(this.rotationQuaternion){if(!this._cache.rotationQuaternion.equals(this.rotationQuaternion))return!1}else if(!this._cache.rotation.equals(this.rotation))return!1;return!!this._cache.scaling.equals(this.scaling)},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.localMatrixUpdated=!1,this._cache.position=e.Vector3.Zero(),this._cache.scaling=e.Vector3.Zero(),this._cache.rotation=e.Vector3.Zero(),this._cache.rotationQuaternion=new e.Quaternion(0,0,0,0),this._cache.billboardMode=-1},i.prototype.markAsDirty=function(e){"rotation"===e&&(this.rotationQuaternion=null),this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0},i.prototype._updateBoundingInfo=function(){this._boundingInfo=this._boundingInfo||new e.BoundingInfo(this.absolutePosition,this.absolutePosition),this._boundingInfo.update(this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)},i.prototype._updateSubMeshesBoundingInfo=function(e){if(this.subMeshes)for(var t=0;t<this.subMeshes.length;t++){var i=this.subMeshes[t];i.IsGlobal||i.updateBoundingInfo(e)}},i.prototype.computeWorldMatrix=function(t){if(this._isWorldMatrixFrozen)return this._worldMatrix;if(!t&&(this._currentRenderId===this.getScene().getRenderId()||this.isSynchronized(!0)))return this._currentRenderId=this.getScene().getRenderId(),this._worldMatrix;if(this._cache.position.copyFrom(this.position),this._cache.scaling.copyFrom(this.scaling),this._cache.pivotMatrixUpdated=!1,this._cache.billboardMode=this.billboardMode,this._currentRenderId=this.getScene().getRenderId(),this._isDirty=!1,e.Matrix.ScalingToRef(this.scaling.x*this.scalingDeterminant,this.scaling.y*this.scalingDeterminant,this.scaling.z*this.scalingDeterminant,e.Tmp.Matrix[1]),this.rotationQuaternion){var n=this.rotation.length();n&&(this.rotationQuaternion.multiplyInPlace(e.Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)),this.rotation.copyFromFloats(0,0,0))}if(this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(e.Tmp.Matrix[0]),this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)):(e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,e.Tmp.Matrix[0]),this._cache.rotation.copyFrom(this.rotation)),this.infiniteDistance&&!this.parent){var r=this.getScene().activeCamera;if(r){var o=r.getWorldMatrix(),s=new e.Vector3(o.m[12],o.m[13],o.m[14]);e.Matrix.TranslationToRef(this.position.x+s.x,this.position.y+s.y,this.position.z+s.z,e.Tmp.Matrix[2])}}else e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,e.Tmp.Matrix[2]);if(this._pivotMatrix.multiplyToRef(e.Tmp.Matrix[1],e.Tmp.Matrix[4]),e.Tmp.Matrix[4].multiplyToRef(e.Tmp.Matrix[0],e.Tmp.Matrix[5]),this.billboardMode!==i.BILLBOARDMODE_NONE&&this.getScene().activeCamera){e.Tmp.Vector3[0].copyFrom(this.position);var a=e.Tmp.Vector3[0];if(this.parent&&this.parent.getWorldMatrix){this._markSyncedWithParent();
var h;this._meshToBoneReferal?(this.parent.getWorldMatrix().multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),e.Tmp.Matrix[6]),h=e.Tmp.Matrix[6]):h=this.parent.getWorldMatrix(),e.Vector3.TransformNormalToRef(a,h,e.Tmp.Vector3[1]),a=e.Tmp.Vector3[1]}var l=this.getScene().activeCamera.globalPosition.clone();this.parent&&this.parent.position&&(a.addInPlace(this.parent.position),e.Matrix.TranslationToRef(a.x,a.y,a.z,e.Tmp.Matrix[2])),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL&&(this.billboardMode&i.BILLBOARDMODE_X&&(l.x=a.x+e.Epsilon),this.billboardMode&i.BILLBOARDMODE_Y&&(l.y=a.y+e.Epsilon),this.billboardMode&i.BILLBOARDMODE_Z&&(l.z=a.z+e.Epsilon)),e.Matrix.LookAtLHToRef(a,l,e.Vector3.Up(),e.Tmp.Matrix[3]),e.Tmp.Matrix[3].m[12]=e.Tmp.Matrix[3].m[13]=e.Tmp.Matrix[3].m[14]=0,e.Tmp.Matrix[3].invert(),e.Tmp.Matrix[5].multiplyToRef(e.Tmp.Matrix[3],this._localWorld),this._rotateYByPI.multiplyToRef(this._localWorld,e.Tmp.Matrix[5])}return e.Tmp.Matrix[5].multiplyToRef(e.Tmp.Matrix[2],this._localWorld),this.parent&&this.parent.getWorldMatrix&&this.billboardMode===i.BILLBOARDMODE_NONE?(this._markSyncedWithParent(),this._meshToBoneReferal?(this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),e.Tmp.Matrix[6]),e.Tmp.Matrix[6].multiplyToRef(this._meshToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localWorld.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix)):this._worldMatrix.copyFrom(this._localWorld),this._updateBoundingInfo(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=e.Matrix.Invert(this._worldMatrix)),this._worldMatrix},i.prototype.registerAfterWorldMatrixUpdate=function(e){this.onAfterWorldMatrixUpdateObservable.add(e)},i.prototype.unregisterAfterWorldMatrixUpdate=function(e){this.onAfterWorldMatrixUpdateObservable.removeCallback(e)},i.prototype.setPositionWithLocalVector=function(t){this.computeWorldMatrix(),this.position=e.Vector3.TransformNormal(t,this._localWorld)},i.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var t=this._localWorld.clone();return t.invert(),e.Vector3.TransformNormal(this.position,t)},i.prototype.locallyTranslate=function(t){this.computeWorldMatrix(!0),this.position=e.Vector3.TransformCoordinates(t,this._localWorld)},i.prototype.lookAt=function(t,i,n,r){i=i||0,n=n||0,r=r||0;var o=t.subtract(this.position),s=-Math.atan2(o.z,o.x)-Math.PI/2,a=Math.sqrt(o.x*o.x+o.z*o.z),h=Math.atan2(o.y,a);this.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(s+i,h+n,r)},i.prototype.attachToBone=function(e,t){this._meshToBoneReferal=t,this.parent=e,e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1)},i.prototype.detachFromBone=function(){this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._meshToBoneReferal=null,this.parent=null},i.prototype.isInFrustum=function(e){return this._boundingInfo.isInFrustum(e)},i.prototype.isCompletelyInFrustum=function(t){t||(t=this.getScene().activeCamera);var i=t.getViewMatrix().multiply(t.getProjectionMatrix());return!!this._boundingInfo.isCompletelyInFrustum(e.Frustum.GetPlanes(i))},i.prototype.intersectsMesh=function(e,t){return!(!this._boundingInfo||!e._boundingInfo)&&this._boundingInfo.intersects(e._boundingInfo,t)},i.prototype.intersectsPoint=function(e){return!!this._boundingInfo&&this._boundingInfo.intersectsPoint(e)},i.prototype.setPhysicsState=function(t,i){return t.impostor&&(i=t,t=t.impostor),this.physicsImpostor=new e.PhysicsImpostor(this,t,i,this.getScene()),this.physicsImpostor.physicsBody},i.prototype.getPhysicsImpostor=function(){return this.physicsImpostor},i.prototype.getPhysicsMass=function(){return this.physicsImpostor.getParam("mass")},i.prototype.getPhysicsFriction=function(){return this.physicsImpostor.getParam("friction")},i.prototype.getPhysicsRestitution=function(){return this.physicsImpostor.getParam("resitution")},i.prototype.getPositionInCameraSpace=function(t){return t||(t=this.getScene().activeCamera),e.Vector3.TransformCoordinates(this.absolutePosition,t.getViewMatrix())},i.prototype.getDistanceToCamera=function(e){return e||(e=this.getScene().activeCamera),this.absolutePosition.subtract(e.position).length()},i.prototype.applyImpulse=function(e,t){this.physicsImpostor&&this.physicsImpostor.applyImpulse(e,t)},i.prototype.setPhysicsLinkWith=function(t,i,n,r){this.physicsImpostor&&t.physicsImpostor&&this.physicsImpostor.createJoint(t.physicsImpostor,e.PhysicsJoint.HingeJoint,{mainPivot:i,connectedPivot:n,nativeParams:r})},i.prototype.updatePhysicsBodyPosition=function(){e.Tools.Warn("updatePhysicsBodyPosition() is deprecated, please use updatePhysicsBody()"),this.updatePhysicsBody()},i.prototype.updatePhysicsBody=function(){},Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return this._checkCollisions},set:function(e){this._checkCollisions=e,this.getScene().workerCollisions&&this.getScene().collisionCoordinator.onMeshUpdated(this)},enumerable:!0,configurable:!0}),i.prototype.moveWithCollisions=function(e){var t=this.getAbsolutePosition();t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPositionForCollisions),this._oldPositionForCollisions.addInPlace(this.ellipsoidOffset),this._collider.radius=this.ellipsoid,this.getScene().collisionCoordinator.getNewPosition(this._oldPositionForCollisions,e,this._collider,3,this,this._onCollisionPositionChange,this.uniqueId)},i.prototype.createOrUpdateSubmeshesOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._submeshesOctree||(this._submeshesOctree=new e.Octree(e.Octree.CreationFuncForSubMeshes,t,i)),this.computeWorldMatrix(!0);var n=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(n.minimumWorld,n.maximumWorld,this.subMeshes),this._submeshesOctree},i.prototype._collideForSubMesh=function(t,i,n){if(this._generatePointsArray(),!t._lastColliderWorldVertices||!t._lastColliderTransformMatrix.equals(i)){t._lastColliderTransformMatrix=i.clone(),t._lastColliderWorldVertices=[],t._trianglePlanes=[];for(var r=t.verticesStart,o=t.verticesStart+t.verticesCount,s=r;o>s;s++)t._lastColliderWorldVertices.push(e.Vector3.TransformCoordinates(this._positions[s],i))}n._collide(t._trianglePlanes,t._lastColliderWorldVertices,this.getIndices(),t.indexStart,t.indexStart+t.indexCount,t.verticesStart,!!t.getMaterial()),n.collisionFound&&(n.collidedMesh=this)},i.prototype._processCollisionsForSubMeshes=function(e,t){var i,n;if(this._submeshesOctree&&this.useOctreeForCollisions){var r=e.velocityWorldLength+Math.max(e.radius.x,e.radius.y,e.radius.z),o=this._submeshesOctree.intersects(e.basePointWorld,r);n=o.length,i=o.data}else i=this.subMeshes,n=i.length;for(var s=0;n>s;s++){var a=i[s];n>1&&!a._checkCollision(e)||this._collideForSubMesh(a,t,e)}},i.prototype._checkCollision=function(t){this._boundingInfo._checkCollision(t)&&(e.Matrix.ScalingToRef(1/t.radius.x,1/t.radius.y,1/t.radius.z,this._collisionsScalingMatrix),this.worldMatrixFromCache.multiplyToRef(this._collisionsScalingMatrix,this._collisionsTransformMatrix),this._processCollisionsForSubMeshes(t,this._collisionsTransformMatrix))},i.prototype._generatePointsArray=function(){return!1},i.prototype.intersects=function(t,i){var n=new e.PickingInfo;if(!(this.subMeshes&&this._boundingInfo&&t.intersectsSphere(this._boundingInfo.boundingSphere)&&t.intersectsBox(this._boundingInfo.boundingBox)))return n;if(!this._generatePointsArray())return n;var r,o,s=null;if(this._submeshesOctree&&this.useOctreeForPicking){var a=e.Ray.Transform(t,this.getWorldMatrix()),h=this._submeshesOctree.intersectsRay(a);o=h.length,r=h.data}else r=this.subMeshes,o=r.length;for(var l=0;o>l;l++){var c=r[l];if(!(o>1)||c.canIntersects(t)){var u=c.intersects(t,this._positions,this.getIndices(),i);if(u&&(i||!s||u.distance<s.distance)&&(s=u,s.subMeshId=l,i))break}}if(s){var d=this.getWorldMatrix(),f=e.Vector3.TransformCoordinates(t.origin,d),p=t.direction.clone();p=p.scale(s.distance);var _=e.Vector3.TransformNormal(p,d),m=f.add(_);return n.hit=!0,n.distance=e.Vector3.Distance(f,m),n.pickedPoint=m,n.pickedMesh=this,n.bu=s.bu,n.bv=s.bv,n.faceId=s.faceId,n.subMeshId=s.subMeshId,n}return n},i.prototype.clone=function(e,t,i){return null},i.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array},i.prototype.dispose=function(e){var i,n=this;for(this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this.skeleton=null,this.getScene().stopAnimation(this),this.physicsImpostor&&this.physicsImpostor.dispose(),i=0;i<this._intersectionsInProgress.length;i++){var r=this._intersectionsInProgress[i],o=r._intersectionsInProgress.indexOf(this);r._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress=[];var s=this.getScene().lights;if(s.forEach(function(e){var t=e.includedOnlyMeshes.indexOf(n);-1!==t&&e.includedOnlyMeshes.splice(t,1),t=e.excludedMeshes.indexOf(n),-1!==t&&e.excludedMeshes.splice(t,1)}),this._edgesRenderer&&(this._edgesRenderer.dispose(),this._edgesRenderer=null),this.releaseSubMeshes(),this.getScene().removeMesh(this),e){var a=this.getChildMeshes(!0);for(i=0;i<a.length;i++){var h=a[i];h.parent=null,h.computeWorldMatrix(!0)}}else{for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);var l=this.getDescendants(!0);for(i=0;i<l.length;i++)l[i].dispose()}t.prototype.dispose.call(this),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this._isDisposed=!0,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i._BILLBOARDMODE_NONE=0,i._BILLBOARDMODE_X=1,i._BILLBOARDMODE_Y=2,i._BILLBOARDMODE_Z=4,i._BILLBOARDMODE_ALL=7,i}(e.Node);e.AbstractMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n){t.call(this,i,n),this.diffuse=new e.Color3(1,1,1),this.specular=new e.Color3(1,1,1),this.intensity=1,this.range=Number.MAX_VALUE,this.includeOnlyWithLayerMask=0,this.includedOnlyMeshes=new Array,this.excludedMeshes=new Array,this.excludeWithLayerMask=0,this.radius=1e-5,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,n.addLight(this)}return __extends(i,t),i.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},i.prototype.getShadowGenerator=function(){return this._shadowGenerator},i.prototype.getAbsolutePosition=function(){return e.Vector3.Zero()},i.prototype.transferToEffect=function(e,t,i){},i.prototype._getWorldMatrix=function(){return e.Matrix.Identity()},i.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},i.prototype.getWorldMatrix=function(){this._currentRenderId=this.getScene().getRenderId();var t=this._getWorldMatrix();return this.parent&&this.parent.getWorldMatrix?(this._parentedWorldMatrix||(this._parentedWorldMatrix=e.Matrix.Identity()),t.multiplyToRef(this.parent.getWorldMatrix(),this._parentedWorldMatrix),this._markSyncedWithParent(),this._parentedWorldMatrix):t},i.prototype.dispose=function(){this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this.getScene().removeLight(this),t.prototype.dispose.call(this)},i.prototype.getTypeID=function(){return 0},i.prototype.clone=function(t){return e.SerializationHelper.Clone(i.GetConstructorFromName(this.getTypeID(),t,this.getScene()),this)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getTypeID(),this.parent&&(t.parentId=this.parent.id),this.excludedMeshes.length>0&&(t.excludedMeshesIds=[],this.excludedMeshes.forEach(function(e){t.excludedMeshesIds.push(e.id)})),this.includedOnlyMeshes.length>0&&(t.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(e){t.includedOnlyMeshesIds.push(e.id)})),e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.GetConstructorFromName=function(t,i,n){switch(t){case 0:return function(){return new e.PointLight(i,e.Vector3.Zero(),n)};case 1:return function(){return new e.DirectionalLight(i,e.Vector3.Zero(),n)};case 2:return function(){return new e.SpotLight(i,e.Vector3.Zero(),e.Vector3.Zero(),0,0,n)};case 3:return function(){return new e.HemisphericLight(i,e.Vector3.Zero(),n)}}},i.Parse=function(t,n){var r=e.SerializationHelper.Parse(i.GetConstructorFromName(t.type,t.name,n),t,n);if(t.excludedMeshesIds&&(r._excludedMeshesIds=t.excludedMeshesIds),t.includedOnlyMeshesIds&&(r._includedOnlyMeshesIds=t.includedOnlyMeshesIds),t.parentId&&(r._waitingParentId=t.parentId),t.animations){for(var o=0;o<t.animations.length;o++){var s=t.animations[o];r.animations.push(e.Animation.Parse(s))}e.Node.ParseAnimationRanges(r,t,n)}return t.autoAnimate&&n.beginAnimation(r,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),r},__decorate([e.serializeAsColor3()],i.prototype,"diffuse",void 0),__decorate([e.serializeAsColor3()],i.prototype,"specular",void 0),__decorate([e.serialize()],i.prototype,"intensity",void 0),__decorate([e.serialize()],i.prototype,"range",void 0),__decorate([e.serialize()],i.prototype,"includeOnlyWithLayerMask",void 0),__decorate([e.serialize()],i.prototype,"excludeWithLayerMask",void 0),__decorate([e.serialize()],i.prototype,"radius",void 0),i}(e.Node);e.Light=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,n){t.call(this,e,n),this.position=i}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.computeTransformedPosition=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0)},i.prototype.transferToEffect=function(e,t){return this.parent&&this.parent.getWorldMatrix?(this.computeTransformedPosition(),void e.setFloat4(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0)):void e.setFloat4(t,this.position.x,this.position.y,this.position.z,0)},i.prototype.needCube=function(){return!0},i.prototype.supportsVSM=function(){return!1},i.prototype.needRefreshPerFrame=function(){return!1},i.prototype.getShadowDirection=function(t){switch(t){case 0:return new e.Vector3(1,0,0);case 1:return new e.Vector3(-1,0,0);case 2:return new e.Vector3(0,-1,0);case 3:return new e.Vector3(0,1,0);case 4:return new e.Vector3(0,0,1);case 5:return new e.Vector3(0,0,-1)}return e.Vector3.Zero()},i.prototype.setShadowProjectionMatrix=function(t,i,n){var r=this.getScene().activeCamera;e.Matrix.PerspectiveFovLHToRef(Math.PI/2,1,r.minZ,r.maxZ,t)},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i.prototype.getTypeID=function(){return 0},__decorate([e.serializeAsVector3()],i.prototype,"position",void 0),i}(e.Light);e.PointLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,n,r,o,s){t.call(this,e,s),this.position=i,this.direction=n,this.angle=r,this.exponent=o}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setShadowProjectionMatrix=function(t,i,n){var r=this.getScene().activeCamera;e.Matrix.PerspectiveFovLHToRef(this.angle,1,r.minZ,r.maxZ,t)},i.prototype.needCube=function(){return!1},i.prototype.supportsVSM=function(){return!0},i.prototype.needRefreshPerFrame=function(){return!1},i.prototype.getShadowDirection=function(e){return this.direction},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.computeTransformedPosition=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0)},i.prototype.transferToEffect=function(t,i,n){var r;this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),this.computeTransformedPosition(),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),t.setFloat4(i,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent),r=e.Vector3.Normalize(this._transformedDirection)):(t.setFloat4(i,this.position.x,this.position.y,this.position.z,this.exponent),r=e.Vector3.Normalize(this.direction)),t.setFloat4(n,r.x,r.y,r.z,Math.cos(.5*this.angle))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i.prototype.getTypeID=function(){return 2},__decorate([e.serializeAsVector3()],i.prototype,"position",void 0),__decorate([e.serializeAsVector3()],i.prototype,"direction",void 0),__decorate([e.serialize()],i.prototype,"angle",void 0),__decorate([e.serialize()],i.prototype,"exponent",void 0),i}(e.Light);e.SpotLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r){t.call(this,i,r),this.groundColor=new e.Color3(0,0,0),this.direction=n}return __extends(i,t),i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(e.Vector3.Zero())),this.direction},i.prototype.getShadowGenerator=function(){return null},i.prototype.transferToEffect=function(t,i,n){var r=e.Vector3.Normalize(this.direction);t.setFloat4(i,r.x,r.y,r.z,0),t.setColor3(n,this.groundColor.scale(this.intensity))},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._worldMatrix},i.prototype.getTypeID=function(){return 3},__decorate([e.serializeAsColor3()],i.prototype,"groundColor",void 0),__decorate([e.serializeAsVector3()],i.prototype,"direction",void 0),i}(e.Light);e.HemisphericLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,n){t.call(this,e,n),this.shadowOrthoScale=.5,this.autoUpdateExtends=!0,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=i.scale(-1),this.direction=i}return __extends(i,t),i.prototype.getAbsolutePosition=function(){return this.transformedPosition?this.transformedPosition:this.position},i.prototype.setDirectionToTarget=function(t){return this.direction=e.Vector3.Normalize(t.subtract(this.position)),this.direction},i.prototype.setShadowProjectionMatrix=function(t,i,n){var r=this.getScene().activeCamera;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var o=e.Vector3.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE;for(var s=0;s<n.length;s++){var a=n[s];if(a){var h=a.getBoundingInfo();if(h)for(var l=h.boundingBox,c=0;c<l.vectorsWorld.length;c++)e.Vector3.TransformCoordinatesToRef(l.vectorsWorld[c],i,o),o.x<this._orthoLeft&&(this._orthoLeft=o.x),o.y<this._orthoBottom&&(this._orthoBottom=o.y),o.x>this._orthoRight&&(this._orthoRight=o.x),o.y>this._orthoTop&&(this._orthoTop=o.y)}}}var u=this._orthoRight-this._orthoLeft,d=this._orthoTop-this._orthoBottom;e.Matrix.OrthoOffCenterLHToRef(this._orthoLeft-u*this.shadowOrthoScale,this._orthoRight+u*this.shadowOrthoScale,this._orthoBottom-d*this.shadowOrthoScale,this._orthoTop+d*this.shadowOrthoScale,-r.maxZ,r.maxZ,t)},i.prototype.supportsVSM=function(){return!0},i.prototype.needRefreshPerFrame=function(){return!0},i.prototype.needCube=function(){return!1},i.prototype.getShadowDirection=function(e){return this.direction},i.prototype.computeTransformedPosition=function(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=e.Vector3.Zero()),e.Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),!0)},i.prototype.transferToEffect=function(t,i){return this.parent&&this.parent.getWorldMatrix?(this._transformedDirection||(this._transformedDirection=e.Vector3.Zero()),e.Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this._transformedDirection),void t.setFloat4(i,this._transformedDirection.x,this._transformedDirection.y,this._transformedDirection.z,1)):void t.setFloat4(i,this.direction.x,this.direction.y,this.direction.z,1)},i.prototype._getWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),e.Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this._worldMatrix},i.prototype.getTypeID=function(){return 1},__decorate([e.serializeAsVector3()],i.prototype,"position",void 0),__decorate([e.serializeAsVector3()],i.prototype,"direction",void 0),__decorate([e.serialize()],i.prototype,"shadowOrthoScale",void 0),__decorate([e.serialize()],i.prototype,"autoUpdateExtends",void 0),i}(e.Light);e.DirectionalLight=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i,n){var r=this;this._filter=t.FILTER_NONE,this.blurScale=2,this._blurBoxOffset=0,this._bias=5e-5,this._lightDirection=e.Vector3.Zero(),this.forceBackFacesOnly=!1,this._darkness=0,this._transparencyShadow=!1,this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._currentFaceIndex=0,this._currentFaceIndexCache=0,this._light=n,this._scene=n.getScene(),this._mapSize=i,n._shadowGenerator=this,this._shadowMap=new e.RenderTargetTexture(n.name+"_shadowMap",i,this._scene,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT,n.needCube()),this._shadowMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE),this._shadowMap.renderParticles=!1,this._shadowMap.onBeforeRenderObservable.add(function(e){r._currentFaceIndex=e}),this._shadowMap.onAfterUnbindObservable.add(function(){r.useBlurVarianceShadowMap&&(r._shadowMap2||(r._shadowMap2=new e.RenderTargetTexture(n.name+"_shadowMap",i,r._scene,!1),r._shadowMap2.wrapU=e.Texture.CLAMP_ADDRESSMODE,r._shadowMap2.wrapV=e.Texture.CLAMP_ADDRESSMODE,r._shadowMap2.updateSamplingMode(e.Texture.TRILINEAR_SAMPLINGMODE),r._downSamplePostprocess=new e.PassPostProcess("downScale",1/r.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,r._scene.getEngine()),r._downSamplePostprocess.onApplyObservable.add(function(e){e.setTexture("textureSampler",r._shadowMap)}),r.blurBoxOffset=1),r._scene.postProcessManager.directRender([r._downSamplePostprocess,r._boxBlurPostprocess],r._shadowMap2.getInternalTexture()))});var o=function(t){var i=t.getRenderingMesh(),n=r._scene,o=n.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id]&&void 0!==s.visibleInstances[t._id];if(r.isReady(t,a)){o.enableEffect(r._effect),i._bind(t,r._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(r._effect.setMatrix("viewProjection",r.getTransformMatrix()),r._effect.setVector3("lightPosition",r.getLight().position),r.getLight().needCube()&&r._effect.setFloat2("depthValues",n.activeCamera.minZ,n.activeCamera.maxZ),h&&h.needAlphaTesting()){var l=h.getAlphaTestTexture();r._effect.setTexture("diffuseSampler",l),r._effect.setMatrix("diffuseMatrix",l.getTextureMatrix())}i.useBones&&i.computeBonesUsingShaders&&r._effect.setMatrices("mBones",i.skeleton.getTransformMatrices(i)),r.forceBackFacesOnly&&o.setState(!0,0,!1,!0),i._processRendering(t,r._effect,e.Material.TriangleFillMode,s,a,function(e,t){return r._effect.setMatrix("world",t)}),r.forceBackFacesOnly&&o.setState(!0,0,!1,!1)}else r._shadowMap.resetRefreshCounter()}};this._shadowMap.customRenderFunction=function(e,t,i){var n;for(n=0;n<e.length;n++)o(e.data[n]);for(n=0;n<t.length;n++)o(t.data[n]);if(r._transparencyShadow)for(n=0;n<i.length;n++)o(i.data[n])},this._shadowMap.onClearObservable.add(function(t){r.useBlurVarianceShadowMap||r.useVarianceShadowMap?t.clear(new e.Color4(0,0,0,0),!0,!0):t.clear(new e.Color4(1,1,1,1),!0,!0)})}return Object.defineProperty(t,"FILTER_NONE",{get:function(){return t._FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_VARIANCESHADOWMAP",{get:function(){return t._FILTER_VARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_POISSONSAMPLING",{get:function(){return t._FILTER_POISSONSAMPLING},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FILTER_BLURVARIANCESHADOWMAP",{get:function(){return t._FILTER_BLURVARIANCESHADOWMAP},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bias",{get:function(){return this._bias},set:function(e){this._bias=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"blurBoxOffset",{get:function(){return this._blurBoxOffset},set:function(t){var i=this;this._blurBoxOffset!==t&&(this._blurBoxOffset=t,this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose(),this._boxBlurPostprocess=new e.PostProcess("DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1/this.blurScale,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define OFFSET "+t),this._boxBlurPostprocess.onApplyObservable.add(function(e){e.setFloat2("screenSize",i._mapSize/i.blurScale,i._mapSize/i.blurScale)}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filter",{get:function(){return this._filter},set:function(t){this._filter!==t&&(this._filter=t,this.useVarianceShadowMap||this.useBlurVarianceShadowMap||this.usePoissonSampling?(this._shadowMap.anisotropicFilteringLevel=16,this._shadowMap.updateSamplingMode(e.Texture.BILINEAR_SAMPLINGMODE)):(this._shadowMap.anisotropicFilteringLevel=1,this._shadowMap.updateSamplingMode(e.Texture.NEAREST_SAMPLINGMODE)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useVarianceShadowMap",{get:function(){return this.filter===t.FILTER_VARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_VARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usePoissonSampling",{get:function(){return this.filter===t.FILTER_POISSONSAMPLING||!this._light.supportsVSM()&&(this.filter===t.FILTER_VARIANCESHADOWMAP||this.filter===t.FILTER_BLURVARIANCESHADOWMAP)},set:function(e){this.filter=e?t.FILTER_POISSONSAMPLING:t.FILTER_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useBlurVarianceShadowMap",{get:function(){return this.filter===t.FILTER_BLURVARIANCESHADOWMAP&&this._light.supportsVSM()},set:function(e){this.filter=e?t.FILTER_BLURVARIANCESHADOWMAP:t.FILTER_NONE},enumerable:!0,configurable:!0}),t.prototype.isReady=function(t,i){var n=[];(this.useVarianceShadowMap||this.useBlurVarianceShadowMap)&&n.push("#define VSM"),this.getLight().needCube()&&n.push("#define CUBEMAP");var r=[e.VertexBuffer.PositionKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(r.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(r.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders?(r.push(e.VertexBuffer.MatricesIndicesKind),r.push(e.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(r.push(e.VertexBuffer.MatricesIndicesExtraKind),r.push(e.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton.bones.length+1))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("shadowMap",r,["world","mBones","viewProjection","diffuseMatrix","lightPosition","depthValues"],["diffuseSampler"],a)),this._effect.isReady()},t.prototype.getShadowMap=function(){return this._shadowMap},t.prototype.getShadowMapForRendering=function(){return this._shadowMap2?this._shadowMap2:this._shadowMap},t.prototype.getLight=function(){return this._light},t.prototype.getTransformMatrix=function(){var t=this._scene;if(this._currentRenderID===t.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex)return this._transformMatrix;this._currentRenderID=t.getRenderId(),this._currentFaceIndexCache=this._currentFaceIndex;var i=this._light.position;return e.Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection),1===Math.abs(e.Vector3.Dot(this._lightDirection,e.Vector3.Up()))&&(this._lightDirection.z=1e-13),this._light.computeTransformedPosition()&&(i=this._light.transformedPosition),!this._light.needRefreshPerFrame()&&this._cachedPosition&&this._cachedDirection&&i.equals(this._cachedPosition)&&this._lightDirection.equals(this._cachedDirection)||(this._cachedPosition=i.clone(),this._cachedDirection=this._lightDirection.clone(),e.Matrix.LookAtLHToRef(i,i.add(this._lightDirection),e.Vector3.Up(),this._viewMatrix),this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,this.getShadowMap().renderList),this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)),this._transformMatrix},t.prototype.getDarkness=function(){return this._darkness},t.prototype.setDarkness=function(e){e>=1?this._darkness=1:0>=e?this._darkness=0:this._darkness=e},t.prototype.setTransparencyShadow=function(e){this._transparencyShadow=e},t.prototype._packHalf=function(t){var i=255*t,n=i-Math.floor(i);return new e.Vector2(t-n/255,n)},t.prototype.dispose=function(){this._shadowMap.dispose(),this._shadowMap2&&this._shadowMap2.dispose(),this._downSamplePostprocess&&this._downSamplePostprocess.dispose(),this._boxBlurPostprocess&&this._boxBlurPostprocess.dispose()},t.prototype.serialize=function(){var e={};e.lightId=this._light.id,e.mapSize=this.getShadowMap().getRenderSize(),e.useVarianceShadowMap=this.useVarianceShadowMap,e.usePoissonSampling=this.usePoissonSampling,e.forceBackFacesOnly=this.forceBackFacesOnly,e.renderList=[];for(var t=0;t<this.getShadowMap().renderList.length;t++){var i=this.getShadowMap().renderList[t];e.renderList.push(i.id)}return e},t.Parse=function(e,i){for(var n=i.getLightByID(e.lightId),r=new t(e.mapSize,n),o=0;o<e.renderList.length;o++){var s=i.getMeshesByID(e.renderList[o]);s.forEach(function(e){r.getShadowMap().renderList.push(e)})}return e.usePoissonSampling?r.usePoissonSampling=!0:e.useVarianceShadowMap?r.useVarianceShadowMap=!0:e.useBlurVarianceShadowMap&&(r.useBlurVarianceShadowMap=!0,e.blurScale&&(r.blurScale=e.blurScale),e.blurBoxOffset&&(r.blurBoxOffset=e.blurBoxOffset)),void 0!==e.bias&&(r.bias=e.bias),r.forceBackFacesOnly=e.forceBackFacesOnly,r},t._FILTER_NONE=0,t._FILTER_VARIANCESHADOWMAP=1,t._FILTER_POISSONSAMPLING=2,t._FILTER_BLURVARIANCESHADOWMAP=3,
t}();e.ShadowGenerator=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e,t,i,n){return!(e.x>i.x+n)&&(!(i.x-n>t.x)&&(!(e.y>i.y+n)&&(!(i.y-n>t.y)&&(!(e.z>i.z+n)&&!(i.z-n>t.z)))))},i=function(e,t,i,n){var r=t*t-4*e*i,o={root:0,found:!1};if(0>r)return o;var s=Math.sqrt(r),a=(-t-s)/(2*e),h=(-t+s)/(2*e);if(a>h){var l=h;h=a,a=l}return a>0&&n>a?(o.root=a,o.found=!0,o):h>0&&n>h?(o.root=h,o.found=!0,o):o},n=function(){function n(){this.radius=new e.Vector3(1,1,1),this.retry=0,this.basePointWorld=e.Vector3.Zero(),this.velocityWorld=e.Vector3.Zero(),this.normalizedVelocity=e.Vector3.Zero(),this._collisionPoint=e.Vector3.Zero(),this._planeIntersectionPoint=e.Vector3.Zero(),this._tempVector=e.Vector3.Zero(),this._tempVector2=e.Vector3.Zero(),this._tempVector3=e.Vector3.Zero(),this._tempVector4=e.Vector3.Zero(),this._edge=e.Vector3.Zero(),this._baseToVertex=e.Vector3.Zero(),this._destinationPoint=e.Vector3.Zero(),this._slidePlaneNormal=e.Vector3.Zero(),this._displacementVector=e.Vector3.Zero()}return n.prototype._initialize=function(t,i,n){this.velocity=i,e.Vector3.NormalizeToRef(i,this.normalizedVelocity),this.basePoint=t,t.multiplyToRef(this.radius,this.basePointWorld),i.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=n,this.collisionFound=!1},n.prototype._checkPointInTriangle=function(t,i,n,r,o){i.subtractToRef(t,this._tempVector),n.subtractToRef(t,this._tempVector2),e.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var s=e.Vector3.Dot(this._tempVector4,o);return!(0>s)&&(r.subtractToRef(t,this._tempVector3),e.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),!(0>s)&&(e.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),s=e.Vector3.Dot(this._tempVector4,o),s>=0))},n.prototype._canDoCollision=function(i,n,r,o){var s=e.Vector3.Distance(this.basePointWorld,i),a=Math.max(this.radius.x,this.radius.y,this.radius.z);return!(s>this.velocityWorldLength+a+n)&&!!t(r,o,this.basePointWorld,this.velocityWorldLength+a)},n.prototype._testTriangle=function(t,n,r,o,s,a){var h,l=!1;n||(n=[]),n[t]||(n[t]=new e.Plane(0,0,0,0),n[t].copyFromPoints(r,o,s));var c=n[t];if(a||c.isFrontFacingTo(this.normalizedVelocity,0)){var u=c.signedDistanceTo(this.basePoint),d=e.Vector3.Dot(c.normal,this.velocity);if(0==d){if(Math.abs(u)>=1)return;l=!0,h=0}else{h=(-1-u)/d;var f=(1-u)/d;if(h>f){var p=f;f=h,h=p}if(h>1||0>f)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var _=!1,m=1;if(l||(this.basePoint.subtractToRef(c.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,r,o,s,c.normal)&&(_=!0,m=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!_){var g=this.velocity.lengthSquared(),v=g;this.basePoint.subtractToRef(r,this._tempVector);var y=2*e.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,x=i(v,y,b,m);x.found&&(m=x.root,_=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(o,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,x=i(v,y,b,m),x.found&&(m=x.root,_=!0,this._collisionPoint.copyFrom(o)),this.basePoint.subtractToRef(s,this._tempVector),y=2*e.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,x=i(v,y,b,m),x.found&&(m=x.root,_=!0,this._collisionPoint.copyFrom(s)),o.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex);var P=this._edge.lengthSquared(),A=e.Vector3.Dot(this._edge,this.velocity),C=e.Vector3.Dot(this._edge,this._baseToVertex);if(v=P*-g+A*A,y=P*(2*e.Vector3.Dot(this.velocity,this._baseToVertex))-2*A*C,b=P*(1-this._baseToVertex.lengthSquared())+C*C,x=i(v,y,b,m),x.found){var E=(A*x.root-C)/P;E>=0&&1>=E&&(m=x.root,_=!0,this._edge.scaleInPlace(E),r.addToRef(this._edge,this._collisionPoint))}s.subtractToRef(o,this._edge),o.subtractToRef(this.basePoint,this._baseToVertex),P=this._edge.lengthSquared(),A=e.Vector3.Dot(this._edge,this.velocity),C=e.Vector3.Dot(this._edge,this._baseToVertex),v=P*-g+A*A,y=P*(2*e.Vector3.Dot(this.velocity,this._baseToVertex))-2*A*C,b=P*(1-this._baseToVertex.lengthSquared())+C*C,x=i(v,y,b,m),x.found&&(E=(A*x.root-C)/P,E>=0&&1>=E&&(m=x.root,_=!0,this._edge.scaleInPlace(E),o.addToRef(this._edge,this._collisionPoint))),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex),P=this._edge.lengthSquared(),A=e.Vector3.Dot(this._edge,this.velocity),C=e.Vector3.Dot(this._edge,this._baseToVertex),v=P*-g+A*A,y=P*(2*e.Vector3.Dot(this.velocity,this._baseToVertex))-2*A*C,b=P*(1-this._baseToVertex.lengthSquared())+C*C,x=i(v,y,b,m),x.found&&(E=(A*x.root-C)/P,E>=0&&1>=E&&(m=x.root,_=!0,this._edge.scaleInPlace(E),s.addToRef(this._edge,this._collisionPoint)))}if(_){var T=m*this.velocity.length();(!this.collisionFound||T<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=T,this.collisionFound=!0)}}},n.prototype._collide=function(e,t,i,n,r,o,s){for(var a=n;r>a;a+=3){var h=t[i[a]-o],l=t[i[a+1]-o],c=t[i[a+2]-o];this._testTriangle(a,e,c,l,h,s)}},n.prototype._getResponse=function(t,i){t.addToRef(i,this._destinationPoint),i.scaleInPlace(this.nearestDistance/i.length()),this.basePoint.addToRef(i,t),t.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),t.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(e.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,i)},n}();e.Collider=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var t=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,n=function(){function n(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=n.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=n.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:t.UPDATE},n=[];for(var o in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(o)&&(n.push(i.payload.updatedGeometries[o].indices.buffer),n.push(i.payload.updatedGeometries[o].normals.buffer),n.push(i.payload.updatedGeometries[o].positions.buffer));r._worker.postMessage(i,n),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(n){var o=n.data;if(o.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(o.taskType){case t.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case t.UPDATE:r._runningUpdated--;break;case t.COLLIDE:r._runningCollisionTask=!1;var s=o.payload;if(!r._collisionsCallbackArray[s.collisionId])return;r._collisionsCallbackArray[s.collisionId](s.collisionId,e.Vector3.FromArray(s.newPosition),r._scene.getMeshByUniqueID(s.collidedMeshUniqueId)),r._collisionsCallbackArray[s.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return n.prototype.getNewPosition=function(e,i,n,r,o,s,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(n.radius,this._scaledPosition),i.divideToRef(n.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=s;var h={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:n.radius.asArray()},collisionId:a,excludedMeshUniqueId:o?o.uniqueId:null,maximumRetry:r},l={payload:h,taskType:t.COLLIDE};this._worker.postMessage(l)}},n.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var n=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(n),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:t.INIT};this._worker.postMessage(r)},n.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},n.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},n.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},n.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},n.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},n.SerializeMesh=function(t){var i=[];t.subMeshes&&(i=t.subMeshes.map(function(e,t){return{position:t,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var n=null;return t instanceof e.Mesh?n=t.geometry?t.geometry.id:null:t instanceof e.InstancedMesh&&(n=t.sourceMesh&&t.sourceMesh.geometry?t.sourceMesh.geometry.id:null),{uniqueId:t.uniqueId,id:t.id,name:t.name,geometryId:n,sphereCenter:t.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:t.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:t.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:t.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:t.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:t.checkCollisions}},n.SerializeGeometry=function(t){return{id:t.id,positions:new Float32Array(t.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(t.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(t.getIndices()||[])}},n}();e.CollisionCoordinatorWorker=n;var r=function(){function t(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return t.prototype.getNewPosition=function(e,t,i,n,r,o,s){e.divideToRef(i.radius,this._scaledPosition),t.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,n,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),o(s,this._finalPosition,i.collidedMesh)},t.prototype.init=function(e){this._scene=e},t.prototype.destroy=function(){},t.prototype.onMeshAdded=function(e){},t.prototype.onMeshUpdated=function(e){},t.prototype.onMeshRemoved=function(e){},t.prototype.onGeometryAdded=function(e){},t.prototype.onGeometryUpdated=function(e){},t.prototype.onGeometryDeleted=function(e){},t.prototype._collideWithWorld=function(t,i,n,r,o,s){void 0===s&&(s=null);var a=10*e.Engine.CollisionsEpsilon;if(n.retry>=r)return void o.copyFrom(t);n._initialize(t,i,a);for(var h=0;h<this._scene.meshes.length;h++){var l=this._scene.meshes[h];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==s&&l._checkCollision(n)}return n.collisionFound?(0===i.x&&0===i.y&&0===i.z||n._getResponse(t,i),i.length()<=a?void o.copyFrom(t):(n.retry++,void this._collideWithWorld(t,i,n,r,o,s))):void t.addToRef(i,o)},t}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(n,r,o){t.call(this,n,o),this.upVector=e.Vector3.Up(),this.orthoLeft=null,this.orthoRight=null,this.orthoBottom=null,this.orthoTop=null,this.fov=.8,this.minZ=1,this.maxZ=1e4,this.inertia=.9,this.mode=i.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new e.Viewport(0,0,1,1),this.layerMask=268435455,this.fovMode=i.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=i.RIG_MODE_NONE,this._rigCameras=new Array,this._computedViewMatrix=e.Matrix.Identity(),this._projectionMatrix=new e.Matrix,this._postProcesses=new Array,this._activeMeshes=new e.SmartArray(256),this._globalPosition=e.Vector3.Zero(),o.addCamera(this),o.activeCamera||(o.activeCamera=this),this.position=r}return __extends(i,t),Object.defineProperty(i,"PERSPECTIVE_CAMERA",{get:function(){return i._PERSPECTIVE_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ORTHOGRAPHIC_CAMERA",{get:function(){return i._ORTHOGRAPHIC_CAMERA},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOVMODE_VERTICAL_FIXED",{get:function(){return i._FOVMODE_VERTICAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOVMODE_HORIZONTAL_FIXED",{get:function(){return i._FOVMODE_HORIZONTAL_FIXED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_NONE",{get:function(){return i._RIG_MODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_ANAGLYPH",{get:function(){return i._RIG_MODE_STEREOSCOPIC_ANAGLYPH},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL",{get:function(){return i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED",{get:function(){return i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_STEREOSCOPIC_OVERUNDER",{get:function(){return i._RIG_MODE_STEREOSCOPIC_OVERUNDER},enumerable:!0,configurable:!0}),Object.defineProperty(i,"RIG_MODE_VR",{get:function(){return i._RIG_MODE_VR},enumerable:!0,configurable:!0}),i.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getTypeName(),this.animations)for(var i=0;i<this.animations.length;i++)t+=", animation[0]: "+this.animations[i].toString(e);return t},Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!0,configurable:!0}),i.prototype.getActiveMeshes=function(){return this._activeMeshes},i.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.position=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this.getEngine();this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector),this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._cache.fov=this.fov,this._cache.aspectRatio=i.getAspectRatio(this),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=i.getRenderWidth(),this._cache.renderHeight=i.getRenderHeight()},i.prototype._updateFromScene=function(){this.updateCache(),this._update()},i.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},i.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},i.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var t=this.getEngine();return e=this.mode===i.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.aspectRatio===t.getAspectRatio(this):this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight()},i.prototype.attachControl=function(e,t){},i.prototype.detachControl=function(e){},i.prototype._update=function(){this.cameraRigMode!==i.RIG_MODE_NONE&&this._updateRigCameras(),this._checkInputs()},i.prototype._checkInputs=function(){},i.prototype._cascadePostProcessesToRigCams=function(){this._postProcesses.length>0&&this._postProcesses[0].markTextureDirty();for(var t=0,i=this._rigCameras.length;i>t;t++){var n=this._rigCameras[t],r=n._rigPostProcess;if(r){var o=r instanceof e.PassPostProcess;o&&(n.isIntermediate=0===this._postProcesses.length),n._postProcesses=this._postProcesses.slice(0).concat(r),r.markTextureDirty()}else n._postProcesses=this._postProcesses.slice(0)}},i.prototype.attachPostProcess=function(t,i){return void 0===i&&(i=null),!t.isReusable()&&this._postProcesses.indexOf(t)>-1?(e.Tools.Error("You're trying to reuse a post process not defined as reusable."),0):(null==i||0>i?this._postProcesses.push(t):this._postProcesses.splice(i,0,t),this._cascadePostProcessesToRigCams(),this._postProcesses.indexOf(t))},i.prototype.detachPostProcess=function(e,t){void 0===t&&(t=null);var i,n,r=[];if(t)for(t=t instanceof Array?t:[t],i=t.length-1;i>=0;i--)this._postProcesses[t[i]]===e?this._postProcesses.splice(n,1):r.push(i);else{var o=this._postProcesses.indexOf(e);-1!==o&&this._postProcesses.splice(o,1)}return this._cascadePostProcessesToRigCams(),r},i.prototype.getWorldMatrix=function(){this._worldMatrix||(this._worldMatrix=e.Matrix.Identity());var t=this.getViewMatrix();return t.invertToRef(this._worldMatrix),this._worldMatrix},i.prototype._getViewMatrix=function(){return e.Matrix.Identity()},i.prototype.getViewMatrix=function(t){return this._computedViewMatrix=this._computeViewMatrix(t),!t&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.parent&&this.parent.getWorldMatrix?(this._worldMatrix||(this._worldMatrix=e.Matrix.Identity()),this._computedViewMatrix.invertToRef(this._worldMatrix),this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._computedViewMatrix),this._globalPosition.copyFromFloats(this._computedViewMatrix.m[12],this._computedViewMatrix.m[13],this._computedViewMatrix.m[14]),this._computedViewMatrix.invert(),this._markSyncedWithParent()):this._globalPosition.copyFrom(this.position),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},i.prototype._computeViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._computedViewMatrix)},i.prototype.getProjectionMatrix=function(t){if(!t&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;var n=this.getEngine();if(this.mode===i.PERSPECTIVE_CAMERA)return this.minZ<=0&&(this.minZ=.1),e.Matrix.PerspectiveFovLHToRef(this.fov,n.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===i.FOVMODE_VERTICAL_FIXED),this._projectionMatrix;var r=n.getRenderWidth()/2,o=n.getRenderHeight()/2;return e.Matrix.OrthoOffCenterLHToRef(this.orthoLeft||-r,this.orthoRight||r,this.orthoBottom||-o,this.orthoTop||o,this.minZ,this.maxZ,this._projectionMatrix),this._projectionMatrix},i.prototype.dispose=function(){for(this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;)this._rigCameras.pop().dispose();for(var e=0;e<this._postProcesses.length;++e)this._postProcesses[e].dispose(this);t.prototype.dispose.call(this)},i.prototype.setCameraRigMode=function(t,n){for(;this._rigCameras.length>0;)this._rigCameras.pop().dispose();switch(this.cameraRigMode=t,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=n.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==i.RIG_MODE_NONE&&(this._rigCameras.push(this.createRigCamera(this.name+"_L",0)),this._rigCameras.push(this.createRigCamera(this.name+"_R",1))),this.cameraRigMode){case i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:this._rigCameras[0]._rigPostProcess=new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new e.AnaglyphPostProcess(this.name+"_anaglyph",1,this._rigCameras);break;case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.RIG_MODE_STEREOSCOPIC_OVERUNDER:var r=this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL||this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED;this._rigCameras[0]._rigPostProcess=new e.PassPostProcess(this.name+"_passthru",1,this._rigCameras[0]),this._rigCameras[1]._rigPostProcess=new e.StereoscopicInterlacePostProcess(this.name+"_stereoInterlace",this._rigCameras,r);break;case i.RIG_MODE_VR:var o=n.vrCameraMetrics||e.VRCameraMetrics.GetDefault();this._rigCameras[0]._cameraRigParams.vrMetrics=o,this._rigCameras[0].viewport=new e.Viewport(0,0,.5,1),this._rigCameras[0]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[0]._cameraRigParams.vrHMatrix=o.leftHMatrix,this._rigCameras[0]._cameraRigParams.vrPreViewMatrix=o.leftPreViewMatrix,this._rigCameras[0].getProjectionMatrix=this._rigCameras[0]._getVRProjectionMatrix,this._rigCameras[1]._cameraRigParams.vrMetrics=o,this._rigCameras[1].viewport=new e.Viewport(.5,0,.5,1),this._rigCameras[1]._cameraRigParams.vrWorkMatrix=new e.Matrix,this._rigCameras[1]._cameraRigParams.vrHMatrix=o.rightHMatrix,this._rigCameras[1]._cameraRigParams.vrPreViewMatrix=o.rightPreViewMatrix,this._rigCameras[1].getProjectionMatrix=this._rigCameras[1]._getVRProjectionMatrix,o.compensateDistortion&&(this._rigCameras[0]._rigPostProcess=new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Left",this._rigCameras[0],!1,o),this._rigCameras[1]._rigPostProcess=new e.VRDistortionCorrectionPostProcess("VR_Distort_Compensation_Right",this._rigCameras[1],!0,o))}this._cascadePostProcessesToRigCams(),this._update()},i.prototype._getVRProjectionMatrix=function(){return e.Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},i.prototype.setCameraRigParameter=function(t,i){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[t]=i,"interaxialDistance"===t&&(this._cameraRigParams.stereoHalfAngle=e.Tools.ToRadians(i/.0637))},i.prototype.createRigCamera=function(e,t){return null},i.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov;this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},i.prototype._setupInputs=function(){},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.type=this.getTypeName(),this.parent&&(t.parentId=this.parent.id),this.inputs&&this.inputs.serialize(t),e.Animation.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t},i.prototype.getTypeName=function(){return"Camera"},i.prototype.clone=function(t){return e.SerializationHelper.Clone(i.GetConstructorFromName(this.getTypeName(),t,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},i.GetConstructorFromName=function(t,i,n,r,o){switch(void 0===r&&(r=0),void 0===o&&(o=!0),t){case"ArcRotateCamera":return function(){return new e.ArcRotateCamera(i,0,0,1,e.Vector3.Zero(),n)};case"DeviceOrientationCamera":return function(){return new e.DeviceOrientationCamera(i,e.Vector3.Zero(),n)};case"FollowCamera":return function(){return new e.FollowCamera(i,e.Vector3.Zero(),n)};case"ArcFollowCamera":return function(){return new e.ArcFollowCamera(i,0,0,1,null,n)};case"GamepadCamera":return function(){return new e.GamepadCamera(i,e.Vector3.Zero(),n)};case"TouchCamera":return function(){return new e.TouchCamera(i,e.Vector3.Zero(),n)};case"VirtualJoysticksCamera":return function(){return new e.VirtualJoysticksCamera(i,e.Vector3.Zero(),n)};case"WebVRFreeCamera":return function(){return new e.WebVRFreeCamera(i,e.Vector3.Zero(),n)};case"VRDeviceOrientationFreeCamera":return function(){return new e.VRDeviceOrientationFreeCamera(i,e.Vector3.Zero(),n)};case"AnaglyphArcRotateCamera":return function(){return new e.AnaglyphArcRotateCamera(i,0,0,1,e.Vector3.Zero(),r,n)};case"AnaglyphFreeCamera":return function(){return new e.AnaglyphFreeCamera(i,e.Vector3.Zero(),r,n)};case"AnaglyphGamepadCamera":return function(){return new e.AnaglyphGamepadCamera(i,e.Vector3.Zero(),r,n)};case"AnaglyphUniversalCamera":return function(){return new e.AnaglyphUniversalCamera(i,e.Vector3.Zero(),r,n)};case"StereoscopicArcRotateCamera":return function(){return new e.StereoscopicArcRotateCamera(i,0,0,1,e.Vector3.Zero(),r,o,n)};case"StereoscopicFreeCamera":return function(){return new e.StereoscopicFreeCamera(i,e.Vector3.Zero(),r,o,n)};case"StereoscopicGamepadCamera":return function(){return new e.StereoscopicGamepadCamera(i,e.Vector3.Zero(),r,o,n)};case"StereoscopicUniversalCamera":return function(){return new e.StereoscopicUniversalCamera(i,e.Vector3.Zero(),r,o,n)};case"FreeCamera":return function(){return new e.UniversalCamera(i,e.Vector3.Zero(),n)};default:return function(){return new e.UniversalCamera(i,e.Vector3.Zero(),n)}}},i.Parse=function(t,n){var r=t.type,o=i.GetConstructorFromName(r,t.name,n,t.interaxial_distance,t.isStereoscopicSideBySide),s=e.SerializationHelper.Parse(o,t,n);if(t.parentId&&(s._waitingParentId=t.parentId),s.inputs&&(s.inputs.parse(t),s._setupInputs()),t.target&&s.setTarget&&s.setTarget(e.Vector3.FromArray(t.target)),t.cameraRigMode){var a=t.interaxial_distance?{interaxialDistance:t.interaxial_distance}:{};s.setCameraRigMode(t.cameraRigMode,a)}if(t.animations){for(var h=0;h<t.animations.length;h++){var l=t.animations[h];s.animations.push(e.Animation.Parse(l))}e.Node.ParseAnimationRanges(s,t,n)}return t.autoAnimate&&n.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),s},i._PERSPECTIVE_CAMERA=0,i._ORTHOGRAPHIC_CAMERA=1,i._FOVMODE_VERTICAL_FIXED=0,i._FOVMODE_HORIZONTAL_FIXED=1,i._RIG_MODE_NONE=0,i._RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,i._RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,i._RIG_MODE_STEREOSCOPIC_OVERUNDER=13,i._RIG_MODE_VR=20,i.ForceAttachControlToAlwaysPreventDefault=!1,__decorate([e.serializeAsVector3()],i.prototype,"position",void 0),__decorate([e.serializeAsVector3()],i.prototype,"upVector",void 0),__decorate([e.serialize()],i.prototype,"orthoLeft",void 0),__decorate([e.serialize()],i.prototype,"orthoRight",void 0),__decorate([e.serialize()],i.prototype,"orthoBottom",void 0),__decorate([e.serialize()],i.prototype,"orthoTop",void 0),__decorate([e.serialize()],i.prototype,"fov",void 0),__decorate([e.serialize()],i.prototype,"minZ",void 0),__decorate([e.serialize()],i.prototype,"maxZ",void 0),__decorate([e.serialize()],i.prototype,"inertia",void 0),__decorate([e.serialize()],i.prototype,"mode",void 0),__decorate([e.serialize()],i.prototype,"layerMask",void 0),__decorate([e.serialize()],i.prototype,"fovMode",void 0),__decorate([e.serialize()],i.prototype,"cameraRigMode",void 0),__decorate([e.serialize()],i.prototype,"interaxialDistance",void 0),__decorate([e.serialize()],i.prototype,"isStereoscopicSideBySide",void 0),i}(e.Node);e.Camera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CameraInputTypes={};var t=function(){function t(e){this.attached={},this.camera=e,this.checkInputs=function(){}}return t.prototype.add=function(t){var i=t.getSimpleName();return this.attached[i]?void e.Tools.Warn("camera input of type "+i+" already exists on camera"):(this.attached[i]=t,t.camera=this.camera,t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t))),void(this.attachedElement&&t.attachControl(this.attachedElement)))},t.prototype.remove=function(e){for(var t in this.attached){var i=this.attached[t];i===e&&(i.detachControl(this.attachedElement),delete this.attached[t],this.rebuildInputCheck())}},t.prototype.removeByType=function(e){for(var t in this.attached){var i=this.attached[t];i.getTypeName()===e&&(i.detachControl(this.attachedElement),delete this.attached[t],this.rebuildInputCheck())}},t.prototype._addCheckInputs=function(e){var t=this.checkInputs;return function(){t(),e()}},t.prototype.attachInput=function(e){e.attachControl(this.attachedElement,this.noPreventDefault)},t.prototype.attachElement=function(t,i){if(!this.attachedElement){i=!e.Camera.ForceAttachControlToAlwaysPreventDefault&&i,this.attachedElement=t,this.noPreventDefault=i;for(var n in this.attached)this.attached[n],this.attached[n].attachControl(t,i)}},t.prototype.detachElement=function(e){if(this.attachedElement===e){for(var t in this.attached)this.attached[t],this.attached[t].detachControl(e);this.attachedElement=null}},t.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var e in this.attached){var t=this.attached[e];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}},t.prototype.clear=function(){this.attachedElement&&this.detachElement(this.attachedElement),this.attached={},this.attachedElement=null,this.checkInputs=function(){}},t.prototype.serialize=function(t){var i={};for(var n in this.attached){var r=this.attached[n],o=e.SerializationHelper.Serialize(r);i[r.getTypeName()]=o}t.inputsmgr=i},t.prototype.parse=function(t){var i=t.inputsmgr;if(i){this.clear();for(var n in i){var r=e.CameraInputTypes[n];if(r){var o=i[n],s=e.SerializationHelper.Parse(function(){return new r},o,null);this.add(s)}}}else for(var n in this.attached){var r=e.CameraInputTypes[this.attached[n].getTypeName()];if(r){var s=e.SerializationHelper.Parse(function(){return new r},t,null);this.remove(this.attached[n]),this.add(s)}}},t}();e.CameraInputsManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){void 0===e&&(e=!0),this.touchEnabled=e,this.angularSensibility=2e3}return t.prototype.attachControl=function(t,i){var n=this;if(!this._pointerInput){var r=this.camera,o=this.camera.getEngine();this._pointerInput=function(t,s){var a=t.event;if(n.touchEnabled||"touch"!==a.pointerType)if(t.type===e.PointerEventTypes.POINTERDOWN){try{a.srcElement.setPointerCapture(a.pointerId)}catch(e){}n.previousPosition={x:a.clientX,y:a.clientY},i||a.preventDefault()}else if(t.type===e.PointerEventTypes.POINTERUP){
try{a.srcElement.releasePointerCapture(a.pointerId)}catch(e){}n.previousPosition=null,i||a.preventDefault()}else if(t.type===e.PointerEventTypes.POINTERMOVE){if(!n.previousPosition&&!o.isPointerLock)return;var h,l;o.isPointerLock?(h=a.movementX||a.mozMovementX||a.webkitMovementX||a.msMovementX||0,l=a.movementY||a.mozMovementY||a.webkitMovementY||a.msMovementY||0):(h=a.clientX-n.previousPosition.x,l=a.clientY-n.previousPosition.y),r.cameraRotation.y+=h/n.angularSensibility,r.cameraRotation.x+=l/n.angularSensibility,n.previousPosition={x:a.clientX,y:a.clientY},i||a.preventDefault()}}}this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE)},t.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.previousPosition=null)},t.prototype.getTypeName=function(){return"FreeCameraMouseInput"},t.prototype.getSimpleName=function(){return"mouse"},__decorate([e.serialize()],t.prototype,"angularSensibility",void 0),t}();e.FreeCameraMouseInput=t,e.CameraInputTypes.FreeCameraMouseInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._keys=[],this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39]}return t.prototype.attachControl=function(t,i){var n=this;this._onKeyDown||(this._onKeyDown=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);-1===t&&n._keys.push(e.keyCode),i||e.preventDefault()}},this._onKeyUp=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);t>=0&&n._keys.splice(t,1),i||e.preventDefault()}},e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]))},t.prototype.detachControl=function(t){this._onKeyDown&&(e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null)},t.prototype.checkInputs=function(){if(this._onKeyDown)for(var t=this.camera,i=0;i<this._keys.length;i++){var n=this._keys[i],r=t._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(n)?t._localDirection.copyFromFloats(-r,0,0):-1!==this.keysUp.indexOf(n)?t._localDirection.copyFromFloats(0,0,r):-1!==this.keysRight.indexOf(n)?t._localDirection.copyFromFloats(r,0,0):-1!==this.keysDown.indexOf(n)&&t._localDirection.copyFromFloats(0,0,-r),t.getViewMatrix().invertToRef(t._cameraTransformMatrix),e.Vector3.TransformNormalToRef(t._localDirection,t._cameraTransformMatrix,t._transformedDirection),t.cameraDirection.addInPlace(t._transformedDirection)}},t.prototype.getTypeName=function(){return"FreeCameraKeyboardMoveInput"},t.prototype._onLostFocus=function(e){this._keys=[]},t.prototype.getSimpleName=function(){return"keyboard"},__decorate([e.serialize()],t.prototype,"keysUp",void 0),__decorate([e.serialize()],t.prototype,"keysDown",void 0),__decorate([e.serialize()],t.prototype,"keysLeft",void 0),__decorate([e.serialize()],t.prototype,"keysRight",void 0),t}();e.FreeCameraKeyboardMoveInput=t,e.CameraInputTypes.FreeCameraKeyboardMoveInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._offsetX=null,this._offsetY=null,this._pointerCount=0,this._pointerPressed=[],this.touchAngularSensibility=2e5,this.touchMoveSensibility=250}return t.prototype.attachControl=function(t,i){var n,r=this;void 0===this._pointerInput&&(this._onLostFocus=function(e){r._offsetX=null,r._offsetY=null},this._pointerInput=function(t,o){var s=t.event;if("mouse"!==s.pointerType)if(t.type===e.PointerEventTypes.POINTERDOWN){if(i||s.preventDefault(),r._pointerPressed.push(s.pointerId),1!==r._pointerPressed.length)return;n={x:s.clientX,y:s.clientY}}else if(t.type===e.PointerEventTypes.POINTERUP){i||s.preventDefault();var a=r._pointerPressed.indexOf(s.pointerId);if(-1===a)return;if(r._pointerPressed.splice(a,1),0!=a)return;n=null,r._offsetX=null,r._offsetY=null}else if(t.type===e.PointerEventTypes.POINTERMOVE){if(i||s.preventDefault(),!n)return;var a=r._pointerPressed.indexOf(s.pointerId);if(0!=a)return;r._offsetX=s.clientX-n.x,r._offsetY=-(s.clientY-n.y)}}),this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE),t.addEventListener("blur",this._onLostFocus)},t.prototype.detachControl=function(e){this._pointerInput&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,e.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null,this._pointerPressed=[],this._offsetX=null,this._offsetY=null,this._pointerCount=0)},t.prototype.checkInputs=function(){if(this._offsetX){var t=this.camera;if(t.cameraRotation.y+=this._offsetX/this.touchAngularSensibility,this._pointerPressed.length>1)t.cameraRotation.x+=-this._offsetY/this.touchAngularSensibility;else{var i=t._computeLocalCameraSpeed(),n=new e.Vector3(0,0,i*this._offsetY/this.touchMoveSensibility);e.Matrix.RotationYawPitchRollToRef(t.rotation.y,t.rotation.x,0,t._cameraRotationMatrix),t.cameraDirection.addInPlace(e.Vector3.TransformCoordinates(n,t._cameraRotationMatrix))}}},t.prototype.getTypeName=function(){return"FreeCameraTouchInput"},t.prototype.getSimpleName=function(){return"touch"},__decorate([e.serialize()],t.prototype,"touchAngularSensibility",void 0),__decorate([e.serialize()],t.prototype,"touchMoveSensibility",void 0),t}();e.FreeCameraTouchInput=t,e.CameraInputTypes.FreeCameraTouchInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){var t=this;this._screenOrientationAngle=0,this._screenQuaternion=new e.Quaternion,this._alpha=0,this._beta=0,this._gamma=0,this._orientationChanged=function(){t._screenOrientationAngle=void 0!==window.orientation?+window.orientation:window.screen.orientation&&window.screen.orientation.angle?window.screen.orientation.angle:0,t._screenOrientationAngle=-e.Tools.ToRadians(t._screenOrientationAngle/2),t._screenQuaternion.copyFromFloats(0,Math.sin(t._screenOrientationAngle),0,Math.cos(t._screenOrientationAngle))},this._deviceOrientation=function(e){t._alpha=e.alpha,t._beta=e.beta,t._gamma=e.gamma},this._constantTranform=new e.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this._orientationChanged()}return Object.defineProperty(t.prototype,"camera",{get:function(){return this._camera},set:function(t){this._camera=t,this._camera.rotationQuaternion||(this._camera.rotationQuaternion=new e.Quaternion)},enumerable:!0,configurable:!0}),t.prototype.attachControl=function(e,t){window.addEventListener("orientationchange",this._orientationChanged),window.addEventListener("deviceorientation",this._deviceOrientation)},t.prototype.detachControl=function(e){window.removeEventListener("orientationchange",this._orientationChanged),window.removeEventListener("deviceorientation",this._deviceOrientation)},t.prototype.checkInputs=function(){e.Quaternion.RotationYawPitchRollToRef(e.Tools.ToRadians(this._alpha),e.Tools.ToRadians(this._beta),-e.Tools.ToRadians(this._gamma),this.camera.rotationQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._screenQuaternion),this._camera.rotationQuaternion.multiplyInPlace(this._constantTranform),this._camera.rotationQuaternion.z*=-1,this._camera.rotationQuaternion.w*=-1},t.prototype.getTypeName=function(){return"FreeCameraDeviceOrientationInput"},t.prototype.getSimpleName=function(){return"deviceOrientation"},t}();e.FreeCameraDeviceOrientationInput=t,e.CameraInputTypes.FreeCameraDeviceOrientationInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._beta=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(e,t){window.addEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype._onOrientationEvent=function(e){this.camera,this._alpha=e.alpha,this._beta=e.beta,this._gamma=e.gamma,this._dirty=!0},e.prototype.checkInputs=function(){if(this._dirty){this._dirty=!1;var e=this._gamma;e=0>e?90+e:270-e,this.camera.rotation.x=this.gammaCorrection*e/180*Math.PI,this.camera.rotation.y=this.alphaCorrection*-this._alpha/180*Math.PI,this.camera.rotation.z=this.betaCorrection*this._beta/180*Math.PI}},e.prototype.detachControl=function(e){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getTypeName=function(){return"FreeCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();e.FreeCameraVRDeviceOrientationInput=t,e.CameraInputTypes.FreeCameraVRDeviceOrientationInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.gamepadAngularSensibility=200,this.gamepadMoveSensibility=40}return t.prototype.attachControl=function(t,i){var n=this;this._gamepads=new e.Gamepads(function(e){n._onNewGameConnected(e)})},t.prototype.detachControl=function(e){this._gamepads&&this._gamepads.dispose(),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad){var t=this.camera,i=this.gamepad.leftStick,n=i.x/this.gamepadMoveSensibility,r=i.y/this.gamepadMoveSensibility;i.x=Math.abs(n)>.005?0+n:0,i.y=Math.abs(r)>.005?0+r:0;var o=this.gamepad.rightStick,s=o.x/this.gamepadAngularSensibility,a=o.y/this.gamepadAngularSensibility;o.x=Math.abs(s)>.001?0+s:0,o.y=Math.abs(a)>.001?0+a:0;var h=e.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),l=50*t._computeLocalCameraSpeed(),c=e.Vector3.TransformCoordinates(new e.Vector3(i.x*l,0,-i.y*l),h);t.cameraDirection=t.cameraDirection.add(c),t.cameraRotation=t.cameraRotation.add(new e.Vector2(o.y,o.x))}},t.prototype._onNewGameConnected=function(e){0===e.index&&(this.gamepad=e)},t.prototype.getTypeName=function(){return"FreeCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},__decorate([e.serialize()],t.prototype,"gamepadAngularSensibility",void 0),__decorate([e.serialize()],t.prototype,"gamepadMoveSensibility",void 0),t}();e.FreeCameraGamepadInput=t,e.CameraInputTypes.FreeCameraGamepadInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._keys=[],this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39]}return t.prototype.attachControl=function(t,i){var n=this;this._onKeyDown=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);-1===t&&n._keys.push(e.keyCode),e.preventDefault&&(i||e.preventDefault())}},this._onKeyUp=function(e){if(-1!==n.keysUp.indexOf(e.keyCode)||-1!==n.keysDown.indexOf(e.keyCode)||-1!==n.keysLeft.indexOf(e.keyCode)||-1!==n.keysRight.indexOf(e.keyCode)){var t=n._keys.indexOf(e.keyCode);t>=0&&n._keys.splice(t,1),e.preventDefault&&(i||e.preventDefault())}},this._onLostFocus=function(){n._keys=[]},e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},t.prototype.detachControl=function(t){e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}]),this._keys=[],this._onKeyDown=null,this._onKeyUp=null,this._onLostFocus=null},t.prototype.checkInputs=function(){if(this._onKeyDown)for(var e=this.camera,t=0;t<this._keys.length;t++){var i=this._keys[t];-1!==this.keysLeft.indexOf(i)?e.inertialAlphaOffset-=.01:-1!==this.keysUp.indexOf(i)?e.inertialBetaOffset-=.01:-1!==this.keysRight.indexOf(i)?e.inertialAlphaOffset+=.01:-1!==this.keysDown.indexOf(i)&&(e.inertialBetaOffset+=.01)}},t.prototype.getTypeName=function(){return"ArcRotateCameraKeyboardMoveInput"},t.prototype.getSimpleName=function(){return"keyboard"},__decorate([e.serialize()],t.prototype,"keysUp",void 0),__decorate([e.serialize()],t.prototype,"keysDown",void 0),__decorate([e.serialize()],t.prototype,"keysLeft",void 0),__decorate([e.serialize()],t.prototype,"keysRight",void 0),t}();e.ArcRotateCameraKeyboardMoveInput=t,e.CameraInputTypes.ArcRotateCameraKeyboardMoveInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.wheelPrecision=3}return t.prototype.attachControl=function(t,i){var n=this;this._wheel=function(t,r){if(t.type===e.PointerEventTypes.POINTERWHEEL){var o=t.event,s=0;o.wheelDelta?s=o.wheelDelta/(40*n.wheelPrecision):o.detail&&(s=-o.detail/n.wheelPrecision),s&&(n.camera.inertialRadiusOffset+=s),o.preventDefault&&(i||o.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,e.PointerEventTypes.POINTERWHEEL)},t.prototype.detachControl=function(e){this._observer&&e&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},t.prototype.getTypeName=function(){return"ArcRotateCameraMouseWheelInput"},t.prototype.getSimpleName=function(){return"mousewheel"},__decorate([e.serialize()],t.prototype,"wheelPrecision",void 0),t}();e.ArcRotateCameraMouseWheelInput=t,e.CameraInputTypes.ArcRotateCameraMouseWheelInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=(e.Tools.GetPointerPrefix(),function(){function t(){this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=6,this.panningSensibility=50,this._isRightClick=!1,this._isCtrlPushed=!1,this.pinchInwards=!0}return t.prototype.attachControl=function(t,i){var n,r,o,s=this,a=this.camera.getEngine(),h=0;this._pointerInput=function(t,a){var l=t.event;if(t.type===e.PointerEventTypes.POINTERDOWN){try{l.srcElement.setPointerCapture(l.pointerId)}catch(e){}s._isRightClick=2===l.button,n={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType},void 0===r?r=n:void 0===o&&(o=n),i||l.preventDefault()}else if(t.type===e.PointerEventTypes.POINTERUP){try{l.srcElement.releasePointerCapture(l.pointerId)}catch(e){}n=null,h=0,r=o=void 0,i||l.preventDefault()}else if(t.type===e.PointerEventTypes.POINTERMOVE)if(i||l.preventDefault(),r&&void 0===o){if(0!==s.panningSensibility&&(s._isCtrlPushed&&s.camera._useCtrlForPanning||!s.camera._useCtrlForPanning&&s._isRightClick))s.camera.inertialPanningX+=-(l.clientX-n.x)/s.panningSensibility,s.camera.inertialPanningY+=(l.clientY-n.y)/s.panningSensibility;else{var c=l.clientX-n.x,u=l.clientY-n.y;s.camera.inertialAlphaOffset-=c/s.angularSensibilityX,s.camera.inertialBetaOffset-=u/s.angularSensibilityY}n.x=l.clientX,n.y=l.clientY}else if(r&&o){var d=r.pointerId===l.pointerId?r:o;d.x=l.clientX,d.y=l.clientY;var f=s.pinchInwards?1:-1,p=r.x-o.x,_=r.y-o.y,m=p*p+_*_;if(0===h)return void(h=m);m!==h&&(s.camera.inertialRadiusOffset+=(m-h)/(s.pinchPrecision*((s.angularSensibilityX+s.angularSensibilityY)/2)*f),h=m)}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,e.PointerEventTypes.POINTERDOWN|e.PointerEventTypes.POINTERUP|e.PointerEventTypes.POINTERMOVE),this._onContextMenu=function(e){e.preventDefault()},this.camera._useCtrlForPanning||t.addEventListener("contextmenu",this._onContextMenu,!1),this._onLostFocus=function(){r=o=void 0,h=0,n=null},this._onKeyDown=function(e){s._isCtrlPushed=e.ctrlKey},this._onKeyUp=function(e){s._isCtrlPushed=e.ctrlKey},this._onMouseMove=function(e){if(a.isPointerLock){var t=e.movementX||e.mozMovementX||e.webkitMovementX||e.msMovementX||0,n=e.movementY||e.mozMovementY||e.webkitMovementY||e.msMovementY||0;s.camera.inertialAlphaOffset-=t/s.angularSensibilityX,s.camera.inertialBetaOffset-=n/s.angularSensibilityY,i||e.preventDefault()}},this._onGestureStart=function(e){void 0!==window.MSGesture&&(s._MSGestureHandler||(s._MSGestureHandler=new MSGesture,s._MSGestureHandler.target=t),s._MSGestureHandler.addPointer(e.pointerId))},this._onGesture=function(e){s.camera.radius*=e.scale,e.preventDefault&&(i||(e.stopPropagation(),e.preventDefault()))},t.addEventListener("mousemove",this._onMouseMove,!1),t.addEventListener("MSPointerDown",this._onGestureStart,!1),t.addEventListener("MSGestureChange",this._onGesture,!1),e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},t.prototype.detachControl=function(t){t&&this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,t.removeEventListener("contextmenu",this._onContextMenu),t.removeEventListener("mousemove",this._onMouseMove),t.removeEventListener("MSPointerDown",this._onGestureStart),t.removeEventListener("MSGestureChange",this._onGesture),this._isRightClick=!1,this._isCtrlPushed=!1,this.pinchInwards=!0,this._onKeyDown=null,this._onKeyUp=null,this._onMouseMove=null,this._onGestureStart=null,this._onGesture=null,this._MSGestureHandler=null,this._onLostFocus=null,this._onContextMenu=null),e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp},{name:"blur",handler:this._onLostFocus}])},t.prototype.getTypeName=function(){return"ArcRotateCameraPointersInput"},t.prototype.getSimpleName=function(){return"pointers"},__decorate([e.serialize()],t.prototype,"angularSensibilityX",void 0),__decorate([e.serialize()],t.prototype,"angularSensibilityY",void 0),__decorate([e.serialize()],t.prototype,"pinchPrecision",void 0),__decorate([e.serialize()],t.prototype,"panningSensibility",void 0),t}());e.ArcRotateCameraPointersInput=t,e.CameraInputTypes.ArcRotateCameraPointersInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.gamepadRotationSensibility=80,this.gamepadMoveSensibility=40}return t.prototype.attachControl=function(t,i){var n=this;this._gamepads=new e.Gamepads(function(e){n._onNewGameConnected(e)})},t.prototype.detachControl=function(e){this._gamepads&&this._gamepads.dispose(),this.gamepad=null},t.prototype.checkInputs=function(){if(this.gamepad){var e=this.camera,t=this.gamepad.rightStick;if(0!=t.x){var i=t.x/this.gamepadRotationSensibility;0!=i&&Math.abs(i)>.005&&(e.inertialAlphaOffset+=i)}if(0!=t.y){var n=t.y/this.gamepadRotationSensibility;0!=n&&Math.abs(n)>.005&&(e.inertialBetaOffset+=n)}var r=this.gamepad.leftStick;if(0!=r.y){var o=r.y/this.gamepadMoveSensibility;0!=o&&Math.abs(o)>.005&&(this.camera.inertialRadiusOffset-=o)}}},t.prototype._onNewGameConnected=function(e){0===e.index&&(this.gamepad=e)},t.prototype.getTypeName=function(){return"ArcRotateCameraGamepadInput"},t.prototype.getSimpleName=function(){return"gamepad"},__decorate([e.serialize()],t.prototype,"gamepadRotationSensibility",void 0),__decorate([e.serialize()],t.prototype,"gamepadMoveSensibility",void 0),t}();e.ArcRotateCameraGamepadInput=t,e.CameraInputTypes.ArcRotateCameraGamepadInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this.alphaCorrection=1,this.betaCorrection=1,this.gammaCorrection=1,this._alpha=0,this._beta=0,this._gamma=0,this._dirty=!1,this._deviceOrientationHandler=this._onOrientationEvent.bind(this)}return e.prototype.attachControl=function(e,t){this.camera.attachControl(e,t),window.addEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype._onOrientationEvent=function(e){this.camera,this._alpha=0|+e.alpha,this._beta=0|+e.beta,this._gamma=0|+e.gamma,this._dirty=!0},e.prototype.checkInputs=function(){this._dirty&&(this._dirty=!1,this._gamma<0&&(this._gamma=180+this._gamma),this.camera.alpha=-this._alpha/180*Math.PI%Math.PI*2,this.camera.beta=this._gamma/180*Math.PI)},e.prototype.detachControl=function(e){window.removeEventListener("deviceorientation",this._deviceOrientationHandler)},e.prototype.getTypeName=function(){return"ArcRotateCameraVRDeviceOrientationInput"},e.prototype.getSimpleName=function(){return"VRDeviceOrientation"},e}();e.ArcRotateCameraVRDeviceOrientationInput=t,e.CameraInputTypes.ArcRotateCameraVRDeviceOrientationInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r){t.call(this,i,n,r),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0),this.rotation=new e.Vector3(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.lockedTarget=null,this._currentTarget=e.Vector3.Zero(),this._viewMatrix=e.Matrix.Zero(),this._camMatrix=e.Matrix.Zero(),this._cameraTransformMatrix=e.Matrix.Zero(),this._cameraRotationMatrix=e.Matrix.Zero(),this._referencePoint=new e.Vector3(0,0,1),this._defaultUpVector=new e.Vector3(0,1,0),this._transformedReferencePoint=e.Vector3.Zero(),this._lookAtTemp=e.Matrix.Zero(),this._tempMatrix=e.Matrix.Zero()}return __extends(i,t),i.prototype.getFrontPosition=function(e){var t=this.getTarget().subtract(this.position);return t.normalize(),t.scaleInPlace(e),this.globalPosition.add(t)},i.prototype._getLockedTargetPosition=function(){return this.lockedTarget?this.lockedTarget.position||this.lockedTarget:null},i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.lockedTarget=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new e.Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this);var i=this._getLockedTargetPosition();i?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(i):this._cache.lockedTarget=i.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},i.prototype._isSynchronizedViewMatrix=function(){if(!t.prototype._isSynchronizedViewMatrix.call(this))return!1;var e=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(e):!e)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},i.prototype._computeLocalCameraSpeed=function(){var e=this.getEngine();return this.speed*(e.getDeltaTime()/(10*e.getFps()))},i.prototype.setTarget=function(t){this.upVector.normalize(),e.Matrix.LookAtLHToRef(this.position,t,this._defaultUpVector,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var i=t.subtract(this.position);i.x>=0?this.rotation.y=-Math.atan(i.z/i.x)+Math.PI/2:this.rotation.y=-Math.atan(i.z/i.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&e.Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},i.prototype.getTarget=function(){return this._currentTarget},i.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.position.addInPlace(this.cameraDirection)},i.prototype._checkInputs=function(){var i=this._decideIfNeedsToMove(),n=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(i&&this._updatePosition(),n&&(this.rotation.x+=this.cameraRotation.x,this.rotation.y+=this.cameraRotation.y,!this.noRotationConstraint)){var r=Math.PI/2*.95;this.rotation.x>r&&(this.rotation.x=r),this.rotation.x<-r&&(this.rotation.x=-r)}i&&(Math.abs(this.cameraDirection.x)<e.Epsilon&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<e.Epsilon&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<e.Epsilon&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),n&&(Math.abs(this.cameraRotation.x)<e.Epsilon&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<e.Epsilon&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),t.prototype._checkInputs.call(this)},i.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?(this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix),e.Vector3.TransformNormalToRef(this._defaultUpVector,this._cameraRotationMatrix,this.upVector)):e.Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},i.prototype._getViewMatrix=function(){return this.lockedTarget?this._currentTarget.copyFrom(this._getLockedTargetPosition()):(this._updateCameraRotationMatrix(),e.Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget)),e.Matrix.LookAtLHToRef(this.position,this._currentTarget,this.upVector,this._viewMatrix),this._viewMatrix},i.prototype.createRigCamera=function(t,n){if(this.cameraRigMode!==e.Camera.RIG_MODE_NONE){var r=new i(t,this.position.clone(),this.getScene());return this.cameraRigMode===e.Camera.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new e.Quaternion),r._cameraRigParams={},r.rotationQuaternion=new e.Quaternion),r}return null},i.prototype._updateRigCameras=function(){var i=this._rigCameras[0],n=this._rigCameras[1];switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:var r=this.cameraRigMode===e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,o=this.cameraRigMode===e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*r,i.position),this._getRigCamPosition(this._cameraRigParams.stereoHalfAngle*o,n.position),i.setTarget(this.getTarget()),n.setTarget(this.getTarget());break;case e.Camera.RIG_MODE_VR:i.rotationQuaternion.copyFrom(this.rotationQuaternion),n.rotationQuaternion.copyFrom(this.rotationQuaternion),i.position.copyFrom(this.position),n.position.copyFrom(this.position)}t.prototype._updateRigCameras.call(this)},i.prototype._getRigCamPosition=function(t,i){this._rigCamTransformMatrix||(this._rigCamTransformMatrix=new e.Matrix);var n=this.getTarget();e.Matrix.Translation(-n.x,-n.y,-n.z).multiplyToRef(e.Matrix.RotationY(t),this._rigCamTransformMatrix),this._rigCamTransformMatrix=this._rigCamTransformMatrix.multiply(e.Matrix.Translation(n.x,n.y,n.z)),e.Vector3.TransformCoordinatesToRef(this.position,this._rigCamTransformMatrix,i)},i.prototype.getTypeName=function(){return"TargetCamera"},__decorate([e.serializeAsVector3()],i.prototype,"rotation",void 0),__decorate([e.serialize()],i.prototype,"speed",void 0),__decorate([e.serializeAsMeshReference("lockedTargetId")],i.prototype,"lockedTarget",void 0),i}(e.Camera);e.TargetCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r){var o=this;t.call(this,i,n,r),this.ellipsoid=new e.Vector3(.5,1,.5),this.checkCollisions=!1,this.applyGravity=!1,this._collider=new e.Collider,this._needMoveForGravity=!1,this._oldPosition=e.Vector3.Zero(),this._diffPosition=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,i,n){void 0===n&&(n=null),o.getScene().workerCollisions&&i.multiplyInPlace(o._collider.radius);var r=function(t){o._newPosition.copyFrom(t),o._newPosition.subtractToRef(o._oldPosition,o._diffPosition),o.position.clone(),o._diffPosition.length()>e.Engine.CollisionsEpsilon&&(o.position.addInPlace(o._diffPosition),o.onCollide&&n&&o.onCollide(n))};r(i)},this.inputs=new e.FreeCameraInputsManager(this),this.inputs.addKeyboard().addMouse()}return __extends(i,t),Object.defineProperty(i.prototype,"angularSensibility",{get:function(){var e=this.inputs.attached.mouse;return e?e.angularSensibility:void 0},set:function(e){var t=this.inputs.attached.mouse;t&&(t.angularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),i.prototype.attachControl=function(e,t){this.inputs.attachElement(e,t)},i.prototype.detachControl=function(t){this.inputs.detachElement(t),this.cameraDirection=new e.Vector3(0,0,0),this.cameraRotation=new e.Vector2(0,0)},i.prototype._collideWithWorld=function(t){var i;i=this.parent?e.Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,i.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._collider.radius=this.ellipsoid;var n=t;this.applyGravity&&(n=t.add(this.getScene().gravity)),this.getScene().collisionCoordinator.getNewPosition(this._oldPosition,n,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)},i.prototype._checkInputs=function(){this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero()),this.inputs.checkInputs(),t.prototype._checkInputs.call(this)},i.prototype._decideIfNeedsToMove=function(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},i.prototype._updatePosition=function(){this.checkCollisions&&this.getScene().collisionsEnabled?this._collideWithWorld(this.cameraDirection):this.position.addInPlace(this.cameraDirection)},i.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},i.prototype.getTypeName=function(){return"FreeCamera"},__decorate([e.serializeAsVector3()],i.prototype,"ellipsoid",void 0),__decorate([e.serialize()],i.prototype,"checkCollisions",void 0),__decorate([e.serialize()],i.prototype,"applyGravity",void 0),i}(e.TargetCamera);e.FreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e){t.call(this,e)}return __extends(i,t),i.prototype.addKeyboard=function(){return this.add(new e.FreeCameraKeyboardMoveInput),this},i.prototype.addMouse=function(t){return void 0===t&&(t=!0),this.add(new e.FreeCameraMouseInput(t)),this},i.prototype.addGamepad=function(){return this.add(new e.FreeCameraGamepadInput),this},i.prototype.addDeviceOrientation=function(){return this.add(new e.FreeCameraDeviceOrientationInput),this},i.prototype.addVRDeviceOrientation=function(){return this.add(new e.FreeCameraVRDeviceOrientationInput),this},i.prototype.addTouch=function(){return this.add(new e.FreeCameraTouchInput),this},i.prototype.addVirtualJoystick=function(){return this.add(new e.FreeCameraVirtualJoystickInput),this},i}(e.CameraInputsManager);e.FreeCameraInputsManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,n,r){t.call(this,e,i,n),this.radius=12,this.rotationOffset=0,this.heightOffset=4,this.cameraAcceleration=.05,this.maxCameraSpeed=20,this.target=r}return __extends(i,t),i.prototype.getRadians=function(e){return e*Math.PI/180;
},i.prototype.follow=function(t){if(t){var i;if(t.rotationQuaternion){var n=new e.Matrix;t.rotationQuaternion.toRotationMatrix(n),i=Math.atan2(n.m[8],n.m[10])}else i=t.rotation.y;var r=this.getRadians(this.rotationOffset)+i,o=t.position.x+Math.sin(r)*this.radius,s=t.position.z+Math.cos(r)*this.radius,a=o-this.position.x,h=t.position.y+this.heightOffset-this.position.y,l=s-this.position.z,c=a*this.cameraAcceleration*2,u=h*this.cameraAcceleration,d=l*this.cameraAcceleration*2;(c>this.maxCameraSpeed||c<-this.maxCameraSpeed)&&(c=1>c?-this.maxCameraSpeed:this.maxCameraSpeed),(u>this.maxCameraSpeed||u<-this.maxCameraSpeed)&&(u=1>u?-this.maxCameraSpeed:this.maxCameraSpeed),(d>this.maxCameraSpeed||d<-this.maxCameraSpeed)&&(d=1>d?-this.maxCameraSpeed:this.maxCameraSpeed),this.position=new e.Vector3(this.position.x+c,this.position.y+u,this.position.z+d),this.setTarget(t.position)}},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.follow(this.target)},i.prototype.getTypeName=function(){return"FollowCamera"},__decorate([e.serialize()],i.prototype,"radius",void 0),__decorate([e.serialize()],i.prototype,"rotationOffset",void 0),__decorate([e.serialize()],i.prototype,"heightOffset",void 0),__decorate([e.serialize()],i.prototype,"cameraAcceleration",void 0),__decorate([e.serialize()],i.prototype,"maxCameraSpeed",void 0),__decorate([e.serializeAsMeshReference("lockedTargetId")],i.prototype,"target",void 0),i}(e.TargetCamera);e.FollowCamera=t;var i=function(t){function i(i,n,r,o,s,a){t.call(this,i,e.Vector3.Zero(),a),this.alpha=n,this.beta=r,this.radius=o,this.target=s,this._cartesianCoordinates=e.Vector3.Zero(),this.follow()}return __extends(i,t),i.prototype.follow=function(){this._cartesianCoordinates.x=this.radius*Math.cos(this.alpha)*Math.cos(this.beta),this._cartesianCoordinates.y=this.radius*Math.sin(this.beta),this._cartesianCoordinates.z=this.radius*Math.sin(this.alpha)*Math.cos(this.beta),this.position=this.target.position.add(this._cartesianCoordinates),this.setTarget(this.target.position)},i.prototype._checkInputs=function(){t.prototype._checkInputs.call(this),this.follow()},i.prototype.getTypeName=function(){return"ArcFollowCamera"},i}(e.TargetCamera);e.ArcFollowCamera=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.inputs.addTouch(),this._setupInputs()}return __extends(t,e),Object.defineProperty(t.prototype,"touchAngularSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchAngularSensibility:void 0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"touchMoveSensibility",{get:function(){var e=this.inputs.attached.touch;return e?e.touchMoveSensibility:void 0},set:function(e){var t=this.inputs.attached.touch;t&&(t.touchMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getTypeName=function(){return"TouchCamera"},t.prototype._setupInputs=function(){var e=this.inputs.attached.mouse;e&&(e.touchEnabled=!1)},t}(e.FreeCamera);e.TouchCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a){var h=this;t.call(this,i,e.Vector3.Zero(),a),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.zoomOnFactor=1,this.targetScreenOffset=e.Vector2.Zero(),this.allowUpsideDown=!0,this._viewMatrix=new e.Matrix,this.panningAxis=new e.Vector3(1,1,0),this.checkCollisions=!1,this.collisionRadius=new e.Vector3(.5,.5,.5),this._collider=new e.Collider,this._previousPosition=e.Vector3.Zero(),this._collisionVelocity=e.Vector3.Zero(),this._newPosition=e.Vector3.Zero(),this._onCollisionPositionChange=function(t,i,n){void 0===n&&(n=null),h.getScene().workerCollisions&&h.checkCollisions&&i.multiplyInPlace(h._collider.radius),n?(h.setPosition(i),h.onCollide&&h.onCollide(n)):h._previousPosition.copyFrom(h.position);var r=Math.cos(h.alpha),o=Math.sin(h.alpha),s=Math.cos(h.beta),a=Math.sin(h.beta);0===a&&(a=1e-4);var l=h._getTargetPosition();l.addToRef(new e.Vector3(h.radius*r*a,h.radius*s,h.radius*o*a),h._newPosition),h.position.copyFrom(h._newPosition);var c=h.upVector;h.allowUpsideDown&&h.beta<0&&(c=c.clone(),c=c.negate()),e.Matrix.LookAtLHToRef(h.position,l,c,h._viewMatrix),h._viewMatrix.m[12]+=h.targetScreenOffset.x,h._viewMatrix.m[13]+=h.targetScreenOffset.y,h._collisionTriggered=!1},s?this.target=s:this.target=e.Vector3.Zero(),this.alpha=n,this.beta=r,this.radius=o,this.getViewMatrix(),this.inputs=new e.ArcRotateCameraInputsManager(this),this.inputs.addKeyboard().addMouseWheel().addPointers().addGamepad()}return __extends(i,t),Object.defineProperty(i.prototype,"angularSensibilityX",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityX:void 0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"angularSensibilityY",{get:function(){var e=this.inputs.attached.pointers;return e?e.angularSensibilityY:void 0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pinchPrecision",{get:function(){var e=this.inputs.attached.pointers;return e?e.pinchPrecision:void 0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.pinchPrecision=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"panningSensibility",{get:function(){var e=this.inputs.attached.pointers;return e?e.panningSensibility:void 0},set:function(e){var t=this.inputs.attached.pointers;t&&(t.panningSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysUp",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysUp:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysUp=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysDown",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysDown:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysDown=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysLeft",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysLeft:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysLeft=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keysRight",{get:function(){var e=this.inputs.attached.keyboard;return e?e.keysRight:void 0},set:function(e){var t=this.inputs.attached.keyboard;t&&(t.keysRight=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wheelPrecision",{get:function(){var e=this.inputs.attached.mousewheel;return e?e.wheelPrecision:void 0},set:function(e){var t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=e)},enumerable:!0,configurable:!0}),i.prototype._initCache=function(){t.prototype._initCache.call(this),this._cache.target=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=e.Vector2.Zero()},i.prototype._updateCache=function(e){e||t.prototype._updateCache.call(this),this._cache.target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},i.prototype._getTargetPosition=function(){return this.target.getAbsolutePosition?this.target.getAbsolutePosition():this.target},i.prototype._isSynchronizedViewMatrix=function(){return!!t.prototype._isSynchronizedViewMatrix.call(this)&&(this._cache.target.equals(this.target)&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))},i.prototype.attachControl=function(e,t,i){var n=this;void 0===i&&(i=!0),this._useCtrlForPanning=i,this.inputs.attachElement(e,t),this._reset=function(){n.inertialAlphaOffset=0,n.inertialBetaOffset=0,n.inertialRadiusOffset=0}},i.prototype.detachControl=function(e){this.inputs.detachElement(e),this._reset&&this._reset()},i.prototype._checkInputs=function(){this._collisionTriggered||(this.inputs.checkInputs(),0===this.inertialAlphaOffset&&0===this.inertialBetaOffset&&0===this.inertialRadiusOffset||(this.alpha+=this.beta<=0?-this.inertialAlphaOffset:this.inertialAlphaOffset,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<e.Epsilon&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<e.Epsilon&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<e.Epsilon&&(this.inertialRadiusOffset=0)),0===this.inertialPanningX&&0===this.inertialPanningY||(this._localDirection||(this._localDirection=e.Vector3.Zero(),this._transformedDirection=e.Vector3.Zero()),this.inertialPanningX*=this.inertia,this.inertialPanningY*=this.inertia,Math.abs(this.inertialPanningX)<e.Epsilon&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<e.Epsilon&&(this.inertialPanningY=0),this._localDirection.copyFromFloats(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY),this._localDirection.multiplyInPlace(this.panningAxis),this._viewMatrix.invertToRef(this._cameraTransformMatrix),e.Vector3.TransformNormalToRef(this._localDirection,this._cameraTransformMatrix,this._transformedDirection),this.panningAxis.y||(this._transformedDirection.y=0),this.target.getAbsolutePosition||this.target.addInPlace(this._transformedDirection)),this._checkLimits(),t.prototype._checkInputs.call(this))},i.prototype._checkLimits=function(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit),this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit)},i.prototype.rebuildAnglesAndRadius=function(){var e=this.position.subtract(this._getTargetPosition());this.radius=e.length(),this.alpha=Math.acos(e.x/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2))),e.z<0&&(this.alpha=2*Math.PI-this.alpha),this.beta=Math.acos(e.y/this.radius),this._checkLimits()},i.prototype.setPosition=function(e){this.position.equals(e)||(this.position=e,this.rebuildAnglesAndRadius())},i.prototype.setTarget=function(e){this._getTargetPosition().equals(e)||(this.target=e,this.rebuildAnglesAndRadius())},i.prototype._getViewMatrix=function(){var t=Math.cos(this.alpha),i=Math.sin(this.alpha),n=Math.cos(this.beta),r=Math.sin(this.beta);0===r&&(r=1e-4);var o=this._getTargetPosition();if(o.addToRef(new e.Vector3(this.radius*t*r,this.radius*n,this.radius*i*r),this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions)this._collider.radius=this.collisionRadius,this._newPosition.subtractToRef(this.position,this._collisionVelocity),this._collisionTriggered=!0,this.getScene().collisionCoordinator.getNewPosition(this.position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);else{this.position.copyFrom(this._newPosition);var s=this.upVector;this.allowUpsideDown&&this.beta<0&&(s=s.clone(),s=s.negate()),e.Matrix.LookAtLHToRef(this.position,o,s,this._viewMatrix),this._viewMatrix.m[12]+=this.targetScreenOffset.x,this._viewMatrix.m[13]+=this.targetScreenOffset.y}return this._viewMatrix},i.prototype.zoomOn=function(t,i){void 0===i&&(i=!1),t=t||this.getScene().meshes;var n=e.Mesh.MinMax(t),r=e.Vector3.Distance(n.min,n.max);this.radius=r*this.zoomOnFactor,this.focusOn({min:n.min,max:n.max,distance:r},i)},i.prototype.focusOn=function(t,i){void 0===i&&(i=!1);var n,r;void 0===t.min?(n=t||this.getScene().meshes,n=e.Mesh.MinMax(n),r=e.Vector3.Distance(n.min,n.max)):(n=t,r=t.distance),this.target=e.Mesh.Center(n),i||(this.maxZ=2*r)},i.prototype.createRigCamera=function(t,n){var r;switch(this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:r=this._cameraRigParams.stereoHalfAngle*(0===n?1:-1);break;case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:r=this._cameraRigParams.stereoHalfAngle*(0===n?-1:1)}var o=new i(t,this.alpha+r,this.beta,this.radius,this.target,this.getScene());return o._cameraRigParams={},o},i.prototype._updateRigCameras=function(){var i=this._rigCameras[0],n=this._rigCameras[1];switch(i.beta=n.beta=this.beta,i.radius=n.radius=this.radius,this.cameraRigMode){case e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case e.Camera.RIG_MODE_VR:i.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:i.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,n.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}t.prototype._updateRigCameras.call(this)},i.prototype.dispose=function(){this.inputs.clear(),t.prototype.dispose.call(this)},i.prototype.getTypeName=function(){return"ArcRotateCamera"},__decorate([e.serialize()],i.prototype,"alpha",void 0),__decorate([e.serialize()],i.prototype,"beta",void 0),__decorate([e.serialize()],i.prototype,"radius",void 0),__decorate([e.serializeAsVector3()],i.prototype,"target",void 0),__decorate([e.serialize()],i.prototype,"inertialAlphaOffset",void 0),__decorate([e.serialize()],i.prototype,"inertialBetaOffset",void 0),__decorate([e.serialize()],i.prototype,"inertialRadiusOffset",void 0),__decorate([e.serialize()],i.prototype,"lowerAlphaLimit",void 0),__decorate([e.serialize()],i.prototype,"upperAlphaLimit",void 0),__decorate([e.serialize()],i.prototype,"lowerBetaLimit",void 0),__decorate([e.serialize()],i.prototype,"upperBetaLimit",void 0),__decorate([e.serialize()],i.prototype,"lowerRadiusLimit",void 0),__decorate([e.serialize()],i.prototype,"upperRadiusLimit",void 0),__decorate([e.serialize()],i.prototype,"inertialPanningX",void 0),__decorate([e.serialize()],i.prototype,"inertialPanningY",void 0),__decorate([e.serialize()],i.prototype,"zoomOnFactor",void 0),__decorate([e.serialize()],i.prototype,"allowUpsideDown",void 0),i}(e.TargetCamera);e.ArcRotateCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e){t.call(this,e)}return __extends(i,t),i.prototype.addMouseWheel=function(){return this.add(new e.ArcRotateCameraMouseWheelInput),this},i.prototype.addPointers=function(){return this.add(new e.ArcRotateCameraPointersInput),this},i.prototype.addKeyboard=function(){return this.add(new e.ArcRotateCameraKeyboardMoveInput),this},i.prototype.addGamepad=function(){return this.add(new e.ArcRotateCameraGamepadInput),this},i.prototype.addVRDeviceOrientation=function(){return this.add(new e.ArcRotateCameraVRDeviceOrientationInput),this},i}(e.CameraInputsManager);e.ArcRotateCameraInputsManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._renderingGroups=new Array,this._scene=e}return t.prototype._renderParticles=function(t,i){if(0!==this._scene._activeParticleSystems.length){for(var n=this._scene.activeCamera,r=e.Tools.Now,o=0;o<this._scene._activeParticleSystems.length;o++){var s=this._scene._activeParticleSystems.data[o];s.renderingGroupId===t&&0!==(n.layerMask&s.layerMask)&&(this._clearDepthBuffer(),s.emitter.position&&i&&-1===i.indexOf(s.emitter)||(this._scene._activeParticles+=s.render()))}this._scene._particlesDuration+=e.Tools.Now-r}},t.prototype._renderSprites=function(t){if(this._scene.spritesEnabled&&0!==this._scene.spriteManagers.length){for(var i=this._scene.activeCamera,n=e.Tools.Now,r=0;r<this._scene.spriteManagers.length;r++){var o=this._scene.spriteManagers[r];o.renderingGroupId===t&&0!==(i.layerMask&o.layerMask)&&(this._clearDepthBuffer(),o.render())}this._scene._spritesDuration+=e.Tools.Now-n}},t.prototype._clearDepthBuffer=function(){this._depthBufferAlreadyCleaned||(this._scene.getEngine().clear(0,!1,!0),this._depthBufferAlreadyCleaned=!0)},t.prototype._renderSpritesAndParticles=function(){this._currentRenderSprites&&this._renderSprites(this._currentIndex),this._currentRenderParticles&&this._renderParticles(this._currentIndex,this._currentActiveMeshes)},t.prototype.render=function(e,i,n,r){this._currentActiveMeshes=i,this._currentRenderParticles=n,this._currentRenderSprites=r;for(var o=0;o<t.MAX_RENDERINGGROUPS;o++){this._depthBufferAlreadyCleaned=0==o;var s=this._renderingGroups[o],a=!1;this._currentIndex=o,s?(this._clearDepthBuffer(),s.onBeforeTransparentRendering||(s.onBeforeTransparentRendering=this._renderSpritesAndParticles.bind(this)),s.render(e)||(this._renderingGroups.splice(o,1),a=!0,this._renderSpritesAndParticles())):this._renderSpritesAndParticles(),a&&o--}},t.prototype.reset=function(){this._renderingGroups.forEach(function(e,t,i){e&&e.prepare()})},t.prototype.dispatch=function(t){var i=t.getMesh(),n=i.renderingGroupId||0;this._renderingGroups[n]||(this._renderingGroups[n]=new e.RenderingGroup(n,this._scene)),this._renderingGroups[n].dispatch(t)},t.MAX_RENDERINGGROUPS=4,t}();e.RenderingManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.index=t,this._opaqueSubMeshes=new e.SmartArray(256),this._transparentSubMeshes=new e.SmartArray(256),this._alphaTestSubMeshes=new e.SmartArray(256),this._scene=i}return t.prototype.render=function(t){if(t)return t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes),!0;if(0===this._opaqueSubMeshes.length&&0===this._alphaTestSubMeshes.length&&0===this._transparentSubMeshes.length)return this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),!1;var i,n,r=this._scene.getEngine();for(i=0;i<this._opaqueSubMeshes.length;i++)n=this._opaqueSubMeshes.data[i],n.render(!1);for(r.setAlphaTesting(!0),i=0;i<this._alphaTestSubMeshes.length;i++)n=this._alphaTestSubMeshes.data[i],n.render(!1);if(r.setAlphaTesting(!1),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length){for(i=0;i<this._transparentSubMeshes.length;i++)n=this._transparentSubMeshes.data[i],n._alphaIndex=n.getMesh().alphaIndex,n._distanceToCamera=n.getBoundingInfo().boundingSphere.centerWorld.subtract(this._scene.activeCamera.globalPosition).length();var o=this._transparentSubMeshes.data.slice(0,this._transparentSubMeshes.length);for(o.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),i=0;i<o.length;i++)n=o[i],n.render(!0);r.setAlphaMode(e.Engine.ALPHA_DISABLE)}return!0},t.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset()},t.prototype.dispatch=function(e){var t=e.getMaterial(),i=e.getMesh();t.needAlphaBlending()||i.visibility<1||i.hasVertexAlpha?this._transparentSubMeshes.push(e):t.needAlphaTesting()?this._alphaTestSubMeshes.push(e):this._opaqueSubMeshes.push(e)},t}();e.RenderingGroup=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){}return Object.defineProperty(e,"POINTERDOWN",{get:function(){return e._POINTERDOWN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERUP",{get:function(){return e._POINTERUP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERMOVE",{get:function(){return e._POINTERMOVE},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERWHEEL",{get:function(){return e._POINTERWHEEL},enumerable:!0,configurable:!0}),Object.defineProperty(e,"POINTERPICK",{get:function(){return e._POINTERPICK},enumerable:!0,configurable:!0}),e._POINTERDOWN=1,e._POINTERUP=2,e._POINTERMOVE=4,e._POINTERWHEEL=8,e._POINTERPICK=16,e}();e.PointerEventTypes=t;var i=function(){function e(e,t){this.type=e,this.event=t}return e}();e.PointerInfoBase=i;var n=function(t){function i(i,n,r,o){t.call(this,i,n),this.skipOnPointerObservable=!1,this.localPosition=new e.Vector2(r,o)}return __extends(i,t),i}(i);e.PointerInfoPre=n;var r=function(e){function t(t,i,n){e.call(this,t,i),this.pickInfo=n}return __extends(t,e),t}(i);e.PointerInfo=r;var o=function(){function i(t){this.autoClear=!0,this.clearColor=new e.Color3(.2,.2,.3),this.ambientColor=new e.Color3(0,0,0),this.forceWireframe=!1,this.forcePointsCloud=!1,this.forceShowBoundingBoxes=!1,this.animationsEnabled=!0,this.constantlyUpdateMeshUnderPointer=!1,this.onDisposeObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,this.onReadyObservable=new e.Observable,this.onBeforeCameraRenderObservable=new e.Observable,this.onAfterCameraRenderObservable=new e.Observable,this.onNewCameraAddedObservable=new e.Observable,this.onCameraRemovedObservable=new e.Observable,this.onNewLightAddedObservable=new e.Observable,this.onLightRemovedObservable=new e.Observable,this.onNewGeometryAddedObservable=new e.Observable,this.onGeometryRemovedObservable=new e.Observable,this.onNewMeshAddedObservable=new e.Observable,this.onMeshRemovedObservable=new e.Observable,this.animations=[],this.onPrePointerObservable=new e.Observable,this.onPointerObservable=new e.Observable,this.cameraToUseForPointers=null,this._startingPointerPosition=new e.Vector2(0,0),this._startingPointerTime=0,this.fogEnabled=!0,this.fogMode=i.FOGMODE_NONE,this.fogColor=new e.Color3(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.shadowsEnabled=!0,this.lightsEnabled=!0,this.lights=new Array,this.cameras=new Array,this.activeCameras=new Array,this.meshes=new Array,this._geometries=new Array,this.materials=new Array,this.multiMaterials=new Array,this.defaultMaterial=new e.StandardMaterial("default material",this),this.texturesEnabled=!0,this.textures=new Array,this.particlesEnabled=!0,this.particleSystems=new Array,this.spritesEnabled=!0,this.spriteManagers=new Array,this.layers=new Array,this.skeletonsEnabled=!0,this.skeletons=new Array,this.lensFlaresEnabled=!0,this.lensFlareSystems=new Array,this.collisionsEnabled=!0,this.gravity=new e.Vector3(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=new Array,this.importedMeshesFiles=new Array,this.probesEnabled=!0,this.reflectionProbes=new Array,this._actionManagers=new Array,this._meshesForIntersections=new e.SmartArray(256),this.proceduralTexturesEnabled=!0,this._proceduralTextures=new Array,this.soundTracks=new Array,this._audioEnabled=!0,this._headphone=!1,this._totalVertices=0,this._activeIndices=0,this._activeParticles=0,this._lastFrameDuration=0,this._evaluateActiveMeshesDuration=0,this._renderTargetsDuration=0,this._particlesDuration=0,this._renderDuration=0,this._spritesDuration=0,this._animationRatio=0,this._renderId=0,this._executeWhenReadyTimeoutId=-1,this._intermediateRendering=!1,this._toBeDisposed=new e.SmartArray(256),this._pendingData=[],this._activeMeshes=new e.SmartArray(256),this._processedMaterials=new e.SmartArray(256),this._renderTargets=new e.SmartArray(256),this._activeParticleSystems=new e.SmartArray(256),this._activeSkeletons=new e.SmartArray(32),this._softwareSkinnedMeshes=new e.SmartArray(32),this._activeBones=0,this._activeAnimatables=new Array,this._transformMatrix=e.Matrix.Zero(),this._edgesRenderers=new e.SmartArray(16),this._uniqueIdCounter=0,this._engine=t,t.scenes.push(this),this._renderingManager=new e.RenderingManager(this),this.postProcessManager=new e.PostProcessManager(this),this.postProcessRenderPipelineManager=new e.PostProcessRenderPipelineManager,this._boundingBoxRenderer=new e.BoundingBoxRenderer(this),e.OutlineRenderer&&(this._outlineRenderer=new e.OutlineRenderer(this)),this.attachControl(),e.SoundTrack&&(this.mainSoundTrack=new e.SoundTrack(this,{mainTrack:!0})),e.SimplificationQueue&&(this.simplificationQueue=new e.SimplificationQueue),this.workerCollisions=!1}return Object.defineProperty(i,"FOGMODE_NONE",{get:function(){return i._FOGMODE_NONE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOGMODE_EXP",{get:function(){return i._FOGMODE_EXP},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOGMODE_EXP2",{get:function(){return i._FOGMODE_EXP2},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FOGMODE_LINEAR",{get:function(){return i._FOGMODE_LINEAR},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"unTranslatedPointer",{get:function(){return new e.Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"debugLayer",{get:function(){return this._debugLayer||(this._debugLayer=new e.DebugLayer(this)),this._debugLayer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"workerCollisions",{get:function(){return this._workerCollisions},set:function(t){t=t&&!!Worker,this._workerCollisions=t,this.collisionCoordinator&&this.collisionCoordinator.destroy(),this.collisionCoordinator=t?new e.CollisionCoordinatorWorker:new e.CollisionCoordinatorLegacy,this.collisionCoordinator.init(this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"SelectionOctree",{get:function(){return this._selectionOctree},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pointerX",{get:function(){return this._pointerX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pointerY",{get:function(){return this._pointerY},enumerable:!0,configurable:!0}),i.prototype.getCachedMaterial=function(){return this._cachedMaterial},i.prototype.getBoundingBoxRenderer=function(){return this._boundingBoxRenderer},i.prototype.getOutlineRenderer=function(){return this._outlineRenderer},i.prototype.getEngine=function(){return this._engine},i.prototype.getTotalVertices=function(){return this._totalVertices},i.prototype.getActiveIndices=function(){return this._activeIndices},i.prototype.getActiveParticles=function(){return this._activeParticles},i.prototype.getActiveBones=function(){return this._activeBones},i.prototype.getLastFrameDuration=function(){return this._lastFrameDuration},i.prototype.getEvaluateActiveMeshesDuration=function(){return this._evaluateActiveMeshesDuration},i.prototype.getActiveMeshes=function(){return this._activeMeshes},i.prototype.getRenderTargetsDuration=function(){return this._renderTargetsDuration},i.prototype.getRenderDuration=function(){return this._renderDuration},i.prototype.getParticlesDuration=function(){return this._particlesDuration},i.prototype.getSpritesDuration=function(){return this._spritesDuration},i.prototype.getAnimationRatio=function(){return this._animationRatio},i.prototype.getRenderId=function(){return this._renderId},i.prototype.incrementRenderId=function(){this._renderId++},i.prototype._updatePointerPosition=function(e){var t=this._engine.getRenderingCanvasClientRect();this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY,this.cameraToUseForPointers&&(this._pointerX=this._pointerX-this.cameraToUseForPointers.viewport.x*this._engine.getRenderWidth(),this._pointerY=this._pointerY-this.cameraToUseForPointers.viewport.y*this._engine.getRenderHeight())},i.prototype.attachControl=function(i,o,s){var a=this;void 0===i&&(i=!0),void 0===o&&(o=!0),void 0===s&&(s=!0);var h=function(e){return e.isPickable&&e.actionManager&&e.actionManager.hasPointerTriggers};this._onPointerMove=function(e){if(a._updatePointerPosition(e),a.onPrePointerObservable.hasObservers()){var i="mousewheel"===e.type||"DOMMouseScroll"===e.type?t.POINTERWHEEL:t.POINTERMOVE,o=new n(i,e,a._unTranslatedPointerX,a._unTranslatedPointerY);if(a.onPrePointerObservable.notifyObservers(o,i),o.skipOnPointerObservable)return}if(a.cameraToUseForPointers||a.activeCamera){var s=a._engine.getRenderingCanvas();a.pointerMovePredicate||(a.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&(a.constantlyUpdateMeshUnderPointer||null!==e.actionManager&&void 0!==e.actionManager)});var l=a.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,a.pointerMovePredicate,!1,a.cameraToUseForPointers);if(l.hit&&l.pickedMesh?(a.setPointerOverSprite(null),a.setPointerOverMesh(l.pickedMesh),a._pointerOverMesh.actionManager&&a._pointerOverMesh.actionManager.hasPointerTriggers?s.style.cursor="pointer":s.style.cursor=""):(a.setPointerOverMesh(null),l=a.pickSprite(a._unTranslatedPointerX,a._unTranslatedPointerY,h,!1,a.cameraToUseForPointers),l.hit&&l.pickedSprite?(s.style.cursor="pointer",a.setPointerOverSprite(l.pickedSprite)):(a.setPointerOverSprite(null),s.style.cursor="")),a.onPointerMove&&a.onPointerMove(e,l),a.onPointerObservable.hasObservers()){var i="mousewheel"===e.type||"DOMMouseScroll"===e.type?t.POINTERWHEEL:t.POINTERMOVE,o=new r(i,e,l);a.onPointerObservable.notifyObservers(o,i)}}},this._onPointerDown=function(i){if(a._updatePointerPosition(i),a.onPrePointerObservable.hasObservers()){var o=t.POINTERDOWN,s=new n(o,i,a._unTranslatedPointerX,a._unTranslatedPointerY);if(a.onPrePointerObservable.notifyObservers(s,o),s.skipOnPointerObservable)return}if(a.cameraToUseForPointers||a.activeCamera){a._startingPointerPosition.x=a._pointerX,a._startingPointerPosition.y=a._pointerY,a._startingPointerTime=(new Date).getTime(),a.pointerDownPredicate||(a.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&(!e.actionManager||e.actionManager.hasPointerTriggers)}),a._pickedDownMesh=null;var l=a.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,a.pointerDownPredicate,!1,a.cameraToUseForPointers);if(l.hit&&l.pickedMesh&&l.pickedMesh.actionManager){if(a._pickedDownMesh=l.pickedMesh,
l.pickedMesh.actionManager.hasPickTriggers){switch(i.button){case 0:l.pickedMesh.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNew(l.pickedMesh,i));break;case 1:l.pickedMesh.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNew(l.pickedMesh,i));break;case 2:l.pickedMesh.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNew(l.pickedMesh,i))}l.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger,e.ActionEvent.CreateNew(l.pickedMesh,i))}if(l.pickedMesh.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)){var c=a;window.setTimeout(function(){var t=c.pick(c._unTranslatedPointerX,c._unTranslatedPointerY,function(t){return t.isPickable&&t.isVisible&&t.isReady()&&t.actionManager&&t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)},!1,c.cameraToUseForPointers);t.hit&&t.pickedMesh&&t.pickedMesh.actionManager&&0!==c._startingPointerTime&&(new Date).getTime()-c._startingPointerTime>e.ActionManager.LongPressDelay&&Math.abs(c._startingPointerPosition.x-c._pointerX)<e.ActionManager.DragMovementThreshold&&Math.abs(c._startingPointerPosition.y-c._pointerY)<e.ActionManager.DragMovementThreshold&&(c._startingPointerTime=0,t.pickedMesh.actionManager.processTrigger(e.ActionManager.OnLongPressTrigger,e.ActionEvent.CreateNew(t.pickedMesh,i)))},e.ActionManager.LongPressDelay)}}if(a.onPointerDown&&a.onPointerDown(i,l),a.onPointerObservable.hasObservers()){var o=t.POINTERDOWN,s=new r(o,i,l);a.onPointerObservable.notifyObservers(s,o)}if(a._pickedDownSprite=null,a.spriteManagers.length>0&&(l=a.pickSprite(a._unTranslatedPointerX,a._unTranslatedPointerY,h,!1,a.cameraToUseForPointers),l.hit&&l.pickedSprite&&l.pickedSprite.actionManager)){switch(a._pickedDownSprite=l.pickedSprite,i.button){case 0:l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,a,i));break;case 1:l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,a,i));break;case 2:l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,a,i))}l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,a,i))}}},this._onPointerUp=function(i){if(a._updatePointerPosition(i),a.onPrePointerObservable.hasObservers()){var o=t.POINTERUP,s=new n(o,i,a._unTranslatedPointerX,a._unTranslatedPointerY);if(a.onPrePointerObservable.notifyObservers(s,o),s.skipOnPointerObservable)return}if(a.cameraToUseForPointers||a.activeCamera){a.pointerUpPredicate||(a.pointerUpPredicate=function(t){return t.isPickable&&t.isVisible&&t.isReady()&&(!t.actionManager||t.actionManager.hasPickTriggers||t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger))});var l=a.pick(a._unTranslatedPointerX,a._unTranslatedPointerY,a.pointerUpPredicate,!1,a.cameraToUseForPointers);if(l.hit&&l.pickedMesh){if(null!=a._pickedDownMesh&&l.pickedMesh==a._pickedDownMesh&&(a.onPointerPick&&a.onPointerPick(i,l),a.onPointerObservable.hasObservers())){var o=t.POINTERPICK,s=new r(o,i,l);a.onPointerObservable.notifyObservers(s,o)}l.pickedMesh.actionManager&&(l.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNew(l.pickedMesh,i)),Math.abs(a._startingPointerPosition.x-a._pointerX)<e.ActionManager.DragMovementThreshold&&Math.abs(a._startingPointerPosition.y-a._pointerY)<e.ActionManager.DragMovementThreshold&&l.pickedMesh.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNew(l.pickedMesh,i)))}if(a._pickedDownMesh&&a._pickedDownMesh!==l.pickedMesh&&a._pickedDownMesh.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,e.ActionEvent.CreateNew(a._pickedDownMesh,i)),a.onPointerUp&&a.onPointerUp(i,l),a.onPointerObservable.hasObservers()){var o=t.POINTERUP,s=new r(o,i,l);a.onPointerObservable.notifyObservers(s,o)}a._startingPointerTime=0,a.spriteManagers.length>0&&(l=a.pickSprite(a._unTranslatedPointerX,a._unTranslatedPointerY,h,!1,a.cameraToUseForPointers),l.hit&&l.pickedSprite&&l.pickedSprite.actionManager&&(l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,a,i)),Math.abs(a._startingPointerPosition.x-a._pointerX)<e.ActionManager.DragMovementThreshold&&Math.abs(a._startingPointerPosition.y-a._pointerY)<e.ActionManager.DragMovementThreshold&&l.pickedSprite.actionManager.processTrigger(e.ActionManager.OnPickTrigger,e.ActionEvent.CreateNewFromSprite(l.pickedSprite,a,i))),a._pickedDownSprite&&a._pickedDownSprite!==l.pickedSprite&&a._pickedDownSprite.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,e.ActionEvent.CreateNewFromSprite(a._pickedDownSprite,a,i)))}},this._onKeyDown=function(t){a.actionManager&&a.actionManager.processTrigger(e.ActionManager.OnKeyDownTrigger,e.ActionEvent.CreateNewFromScene(a,t))},this._onKeyUp=function(t){a.actionManager&&a.actionManager.processTrigger(e.ActionManager.OnKeyUpTrigger,e.ActionEvent.CreateNewFromScene(a,t))};var l=e.Tools.GetPointerPrefix();s&&(this._engine.getRenderingCanvas().addEventListener(l+"move",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("mousewheel",this._onPointerMove,!1),this._engine.getRenderingCanvas().addEventListener("DOMMouseScroll",this._onPointerMove,!1)),o&&this._engine.getRenderingCanvas().addEventListener(l+"down",this._onPointerDown,!1),i&&this._engine.getRenderingCanvas().addEventListener(l+"up",this._onPointerUp,!1),e.Tools.RegisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},i.prototype.detachControl=function(){var t=e.Tools.GetPointerPrefix();this._engine.getRenderingCanvas().removeEventListener(t+"move",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener(t+"down",this._onPointerDown),this._engine.getRenderingCanvas().removeEventListener(t+"up",this._onPointerUp),this._engine.getRenderingCanvas().removeEventListener("mousewheel",this._onPointerMove),this._engine.getRenderingCanvas().removeEventListener("DOMMouseScroll",this._onPointerMove),e.Tools.UnregisterTopRootEvents([{name:"keydown",handler:this._onKeyDown},{name:"keyup",handler:this._onKeyUp}])},i.prototype.isReady=function(){if(this._pendingData.length>0)return!1;var t;for(t=0;t<this._geometries.length;t++){var i=this._geometries[t];if(i.delayLoadState===e.Engine.DELAYLOADSTATE_LOADING)return!1}for(t=0;t<this.meshes.length;t++){var n=this.meshes[t];if(!n.isReady())return!1;var r=n.material;if(r&&!r.isReady(n))return!1}return!0},i.prototype.resetCachedMaterial=function(){this._cachedMaterial=null},i.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},i.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},i.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},i.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},i.prototype._addPendingData=function(e){this._pendingData.push(e)},i.prototype._removePendingData=function(e){var t=this._pendingData.indexOf(e);-1!==t&&this._pendingData.splice(t,1)},i.prototype.getWaitingItemsCount=function(){return this._pendingData.length},i.prototype.executeWhenReady=function(e){var t=this;this.onReadyObservable.add(e),-1===this._executeWhenReadyTimeoutId&&(this._executeWhenReadyTimeoutId=setTimeout(function(){t._checkIsReady()},150))},i.prototype._checkIsReady=function(){var e=this;return this.isReady()?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=-1)):void(this._executeWhenReadyTimeoutId=setTimeout(function(){e._checkIsReady()},150))},i.prototype.beginAnimation=function(t,i,n,r,o,s,a){if(void 0===o&&(o=1),this.stopAnimation(t),a||(a=new e.Animatable(this,t,i,n,r,o,s)),t.animations&&a.appendAnimations(t,t.animations),t.getAnimatables)for(var h=t.getAnimatables(),l=0;l<h.length;l++)this.beginAnimation(h[l],i,n,r,o,s,a);return a.reset(),a},i.prototype.beginDirectAnimation=function(t,i,n,r,o,s,a){void 0===s&&(s=1);var h=new e.Animatable(this,t,n,r,o,s,a,i);return h},i.prototype.getAnimatableByTarget=function(e){for(var t=0;t<this._activeAnimatables.length;t++)if(this._activeAnimatables[t].target===e)return this._activeAnimatables[t];return null},Object.defineProperty(i.prototype,"Animatables",{get:function(){return this._activeAnimatables},enumerable:!0,configurable:!0}),i.prototype.stopAnimation=function(e){var t=this.getAnimatableByTarget(e);t&&t.stop()},i.prototype._animate=function(){if(this.animationsEnabled&&0!==this._activeAnimatables.length){if(!this._animationStartDate){if(this._pendingData.length>0)return;this._animationStartDate=e.Tools.Now}for(var t=e.Tools.Now,i=t-this._animationStartDate,n=0;n<this._activeAnimatables.length;n++)this._activeAnimatables[n]._animate(i)}},i.prototype.getViewMatrix=function(){return this._viewMatrix},i.prototype.getProjectionMatrix=function(){return this._projectionMatrix},i.prototype.getTransformMatrix=function(){return this._transformMatrix},i.prototype.setTransformMatrix=function(e,t){this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix)},i.prototype.addMesh=function(e){e.uniqueId=this._uniqueIdCounter++,this.meshes.push(e),this.collisionCoordinator.onMeshAdded(e),this.onNewMeshAddedObservable.notifyObservers(e)},i.prototype.removeMesh=function(e){var t=this.meshes.indexOf(e);return-1!==t&&this.meshes.splice(t,1),this.collisionCoordinator.onMeshRemoved(e),this.onMeshRemovedObservable.notifyObservers(e),t},i.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&this.skeletons.splice(t,1),t},i.prototype.removeLight=function(e){var t=this.lights.indexOf(e);return-1!==t&&this.lights.splice(t,1),this.onLightRemovedObservable.notifyObservers(e),t},i.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);-1!==t&&this.cameras.splice(t,1);var i=this.activeCameras.indexOf(e);return-1!==i&&this.activeCameras.splice(i,1),this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},i.prototype.addLight=function(e){e.uniqueId=this._uniqueIdCounter++,this.lights.push(e),this.onNewLightAddedObservable.notifyObservers(e)},i.prototype.addCamera=function(e){e.uniqueId=this._uniqueIdCounter++,this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e)},i.prototype.swithActiveCamera=function(e,t){void 0===t&&(t=!0);var i=this._engine.getRenderingCanvas();this.activeCamera.detachControl(i),this.activeCamera=e,t&&e.attachControl(i)},i.prototype.setActiveCameraByID=function(e){var t=this.getCameraByID(e);return t?(this.activeCamera=t,t):null},i.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},i.prototype.getMaterialByID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},i.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},i.prototype.getLensFlareSystemByName=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].name===e)return this.lensFlareSystems[t];return null},i.prototype.getLensFlareSystemByID=function(e){for(var t=0;t<this.lensFlareSystems.length;t++)if(this.lensFlareSystems[t].id===e)return this.lensFlareSystems[t];return null},i.prototype.getCameraByID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},i.prototype.getCameraByUniqueID=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},i.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},i.prototype.getBoneByID=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],n=0;n<i.bones.length;n++)if(i.bones[n].id===e)return i.bones[n];return null},i.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var i=this.skeletons[t],n=0;n<i.bones.length;n++)if(i.bones[n].name===e)return i.bones[n];return null},i.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},i.prototype.getLightByID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},i.prototype.getLightByUniqueID=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},i.prototype.getParticleSystemByID=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},i.prototype.getGeometryByID=function(e){for(var t=0;t<this._geometries.length;t++)if(this._geometries[t].id===e)return this._geometries[t];return null},i.prototype.pushGeometry=function(e,t){return!(!t&&this.getGeometryByID(e.id))&&(this._geometries.push(e),this.collisionCoordinator.onGeometryAdded(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},i.prototype.removeGeometry=function(e){var t=this._geometries.indexOf(e);return t>-1&&(this._geometries.splice(t,1),this.collisionCoordinator.onGeometryDeleted(e),this.onGeometryRemovedObservable.notifyObservers(e),!0)},i.prototype.getGeometries=function(){return this._geometries},i.prototype.getMeshByID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},i.prototype.getMeshesByID=function(e){return this.meshes.filter(function(t){return t.id===e})},i.prototype.getMeshByUniqueID=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},i.prototype.getLastMeshByID=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},i.prototype.getLastEntryByID=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},i.prototype.getNodeByID=function(e){var t=this.getMeshByID(e);if(t)return t;var i=this.getLightByID(e);if(i)return i;var n=this.getCameraByID(e);if(n)return n;var r=this.getBoneByID(e);return r},i.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var i=this.getLightByName(e);if(i)return i;var n=this.getCameraByName(e);if(n)return n;var r=this.getBoneByName(e);return r},i.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},i.prototype.getSoundByName=function(t){var i;if(e.AudioEngine){for(i=0;i<this.mainSoundTrack.soundCollection.length;i++)if(this.mainSoundTrack.soundCollection[i].name===t)return this.mainSoundTrack.soundCollection[i];for(var n=0;n<this.soundTracks.length;n++)for(i=0;i<this.soundTracks[n].soundCollection.length;i++)if(this.soundTracks[n].soundCollection[i].name===t)return this.soundTracks[n].soundCollection[i]}return null},i.prototype.getLastSkeletonByID=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},i.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},i.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},i.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},i.prototype._evaluateSubMesh=function(e,t){if(t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){var i=e.getMaterial();t.showSubMeshesBoundingBox&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),i&&(i.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(i)&&(this._processedMaterials.push(i),this._renderTargets.concatWithNoDuplicate(i.getRenderTargetTextures())),this._activeIndices+=e.indexCount,this._renderingManager.dispatch(e))}},i.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},i.prototype._evaluateActiveMeshes=function(){this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._boundingBoxRenderer.reset(),this._edgesRenderers.reset(),this._frustumPlanes?e.Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=e.Frustum.GetPlanes(this._transformMatrix);var t,i;if(this._selectionOctree){var n=this._selectionOctree.select(this._frustumPlanes);t=n.data,i=n.length}else i=this.meshes.length,t=this.meshes;for(var r=0;i>r;r++){var o=t[r];if(!o.isBlocked&&(this._totalVertices+=o.getTotalVertices(),o.isReady()&&o.isEnabled())){o.computeWorldMatrix(),o.actionManager&&o.actionManager.hasSpecificTriggers([e.ActionManager.OnIntersectionEnterTrigger,e.ActionManager.OnIntersectionExitTrigger])&&this._meshesForIntersections.pushNoDuplicate(o);var s=o.getLOD(this.activeCamera);s&&(o._preActivate(),(o.alwaysSelectAsActiveMesh||o.isVisible&&o.visibility>0&&0!==(o.layerMask&this.activeCamera.layerMask)&&o.isInFrustum(this._frustumPlanes))&&(this._activeMeshes.push(o),this.activeCamera._activeMeshes.push(o),o._activate(this._renderId),this._activeMesh(s)))}}var a=e.Tools.Now;if(this.particlesEnabled){e.Tools.StartPerformanceCounter("Particles",this.particleSystems.length>0);for(var h=0;h<this.particleSystems.length;h++){var l=this.particleSystems[h];l.isStarted()&&(!l.emitter.position||l.emitter&&l.emitter.isEnabled())&&(this._activeParticleSystems.push(l),l.animate())}e.Tools.EndPerformanceCounter("Particles",this.particleSystems.length>0)}this._particlesDuration+=e.Tools.Now-a},i.prototype._activeMesh=function(e){if(e.skeleton&&this.skeletonsEnabled&&(this._activeSkeletons.pushNoDuplicate(e.skeleton)&&e.skeleton.prepare(),e.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(e)),(e.showBoundingBox||this.forceShowBoundingBoxes)&&this._boundingBoxRenderer.renderList.push(e.getBoundingInfo().boundingBox),e._edgesRenderer&&this._edgesRenderers.push(e._edgesRenderer),e&&e.subMeshes){var t,i;if(e._submeshesOctree&&e.useOctreeForRenderingSelection){var n=e._submeshesOctree.select(this._frustumPlanes);t=n.length,i=n.data}else i=e.subMeshes,t=i.length;for(var r=0;t>r;r++){var o=i[r];this._evaluateSubMesh(o,e)}}},i.prototype.updateTransformMatrix=function(e){this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},i.prototype._renderForCamera=function(t){var i=this._engine;if(this.activeCamera=t,!this.activeCamera)throw new Error("Active camera not set");e.Tools.StartPerformanceCounter("Rendering camera "+this.activeCamera.name),i.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera);var n=e.Tools.Now;e.Tools.StartPerformanceCounter("Active meshes evaluation"),this._evaluateActiveMeshes(),this._evaluateActiveMeshesDuration+=e.Tools.Now-n,e.Tools.EndPerformanceCounter("Active meshes evaluation");for(var r=0;r<this._softwareSkinnedMeshes.length;r++){var o=this._softwareSkinnedMeshes.data[r];o.applySkeleton(o.skeleton)}var s=e.Tools.Now;if(this.renderTargetsEnabled&&this._renderTargets.length>0){this._intermediateRendering=!0,e.Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var a=0;a<this._renderTargets.length;a++){var h=this._renderTargets.data[a];if(h._shouldRender()){this._renderId++;var l=h.activeCamera&&h.activeCamera!==this.activeCamera;h.render(l,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._intermediateRendering=!1,this._renderId++,i.restoreDefaultFramebuffer()}this._renderTargetsDuration+=e.Tools.Now-s,this.postProcessManager._prepareFrame();var c,u,d=e.Tools.Now;if(this.layers.length){for(i.setDepthBuffer(!1),c=0;c<this.layers.length;c++)u=this.layers[c],u.isBackground&&u.render();i.setDepthBuffer(!0)}e.Tools.StartPerformanceCounter("Main render"),this._renderingManager.render(null,null,!0,!0),e.Tools.EndPerformanceCounter("Main render"),this._boundingBoxRenderer.render();for(var f=0;f<this._edgesRenderers.length;f++)this._edgesRenderers.data[f].render();if(this.lensFlaresEnabled){e.Tools.StartPerformanceCounter("Lens flares",this.lensFlareSystems.length>0);for(var p=0;p<this.lensFlareSystems.length;p++){var _=this.lensFlareSystems[p];0!==(t.layerMask&_.layerMask)&&_.render()}e.Tools.EndPerformanceCounter("Lens flares",this.lensFlareSystems.length>0)}if(this.layers.length){for(i.setDepthBuffer(!1),c=0;c<this.layers.length;c++)u=this.layers[c],u.isBackground||u.render();i.setDepthBuffer(!0)}this._renderDuration+=e.Tools.Now-d,this.postProcessManager._finalizeFrame(t.isIntermediate),this.activeCamera._updateFromScene(),this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera),e.Tools.EndPerformanceCounter("Rendering camera "+this.activeCamera.name)},i.prototype._processSubCameras=function(t){if(t.cameraRigMode===e.Camera.RIG_MODE_NONE)return void this._renderForCamera(t);for(var i=0;i<t._rigCameras.length;i++)this._renderForCamera(t._rigCameras[i]);this.activeCamera=t,this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix()),this.activeCamera._updateFromScene()},i.prototype._checkIntersections=function(){for(var t=0;t<this._meshesForIntersections.length;t++)for(var i=this._meshesForIntersections.data[t],n=0;n<i.actionManager.actions.length;n++){var r=i.actionManager.actions[n];if(r.trigger===e.ActionManager.OnIntersectionEnterTrigger||r.trigger===e.ActionManager.OnIntersectionExitTrigger){var o=r.getTriggerParameter(),s=o instanceof e.AbstractMesh?o:o.mesh,a=s.intersectsMesh(i,o.usePreciseIntersection),h=i._intersectionsInProgress.indexOf(s);a&&-1===h?r.trigger===e.ActionManager.OnIntersectionEnterTrigger?(r._executeCurrent(e.ActionEvent.CreateNew(i,null,s)),i._intersectionsInProgress.push(s)):r.trigger===e.ActionManager.OnIntersectionExitTrigger&&i._intersectionsInProgress.push(s):!a&&h>-1&&(r.trigger===e.ActionManager.OnIntersectionExitTrigger&&r._executeCurrent(e.ActionEvent.CreateNew(i,null,s)),i.actionManager.hasSpecificTrigger(e.ActionManager.OnIntersectionExitTrigger)&&r.trigger!==e.ActionManager.OnIntersectionExitTrigger||i._intersectionsInProgress.splice(h,1))}}},i.prototype.render=function(){var t=e.Tools.Now;this._particlesDuration=0,this._spritesDuration=0,this._activeParticles=0,this._renderDuration=0,this._renderTargetsDuration=0,this._evaluateActiveMeshesDuration=0,this._totalVertices=0,this._activeIndices=0,this._activeBones=0,this.getEngine().resetDrawCalls(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),e.Tools.StartPerformanceCounter("Scene rendering"),this.actionManager&&this.actionManager.processTrigger(e.ActionManager.OnEveryFrameTrigger,null),this.simplificationQueue&&!this.simplificationQueue.running&&this.simplificationQueue.executeNext();var n=Math.max(i.MinDeltaTime,Math.min(this._engine.getDeltaTime(),i.MaxDeltaTime));this._animationRatio=.06*n,this._animate(),this._physicsEngine&&(e.Tools.StartPerformanceCounter("Physics"),this._physicsEngine._step(n/1e3),e.Tools.EndPerformanceCounter("Physics")),this.onBeforeRenderObservable.notifyObservers(this);var r=e.Tools.Now,o=this.getEngine(),s=this.activeCamera;if(this.renderTargetsEnabled){e.Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(var a=0;a<this.customRenderTargets.length;a++){var h=this.customRenderTargets[a];if(h._shouldRender()){if(this._renderId++,this.activeCamera=h.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");o.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),h.render(s!==this.activeCamera,this.dumpNextRenderTargets)}}e.Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}if(this.customRenderTargets.length>0&&o.restoreDefaultFramebuffer(),this._renderTargetsDuration+=e.Tools.Now-r,this.activeCamera=s,this.proceduralTexturesEnabled){e.Tools.StartPerformanceCounter("Procedural textures",this._proceduralTextures.length>0);for(var l=0;l<this._proceduralTextures.length;l++){var c=this._proceduralTextures[l];c._shouldRender()&&c.render()}e.Tools.EndPerformanceCounter("Procedural textures",this._proceduralTextures.length>0)}if(this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,!0),this.shadowsEnabled)for(var u=0;u<this.lights.length;u++){var d=this.lights[u],f=d.getShadowGenerator();d.isEnabled()&&f&&-1!==f.getShadowMap().getScene().textures.indexOf(f.getShadowMap())&&this._renderTargets.push(f.getShadowMap())}if(this._depthRenderer&&this._renderTargets.push(this._depthRenderer.getDepthMap()),this.postProcessRenderPipelineManager.update(),this.activeCameras.length>0)for(var p=this._renderId,_=0;_<this.activeCameras.length;_++)this._renderId=p,_>0&&this._engine.clear(0,!1,!0),this._processSubCameras(this.activeCameras[_]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections(),e.AudioEngine&&this._updateAudioParameters(),this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this);for(var m=0;m<this._toBeDisposed.length;m++)this._toBeDisposed.data[m].dispose(),this._toBeDisposed[m]=null;this._toBeDisposed.reset(),this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),e.Tools.EndPerformanceCounter("Scene rendering"),this._lastFrameDuration=e.Tools.Now-t},i.prototype._updateAudioParameters=function(){if(this.audioEnabled&&(0!==this.mainSoundTrack.soundCollection.length||1!==this.soundTracks.length)){var t,i=e.Engine.audioEngine;if(t=this.activeCameras.length>0?this.activeCameras[0]:this.activeCamera,t&&i.canUseWebAudio){i.audioContext.listener.setPosition(t.position.x,t.position.y,t.position.z);var n=e.Matrix.Invert(t.getViewMatrix()),r=e.Vector3.TransformNormal(new e.Vector3(0,0,-1),n);r.normalize(),i.audioContext.listener.setOrientation(r.x,r.y,r.z,0,1,0);var o;for(o=0;o<this.mainSoundTrack.soundCollection.length;o++){var s=this.mainSoundTrack.soundCollection[o];s.useCustomAttenuation&&s.updateDistanceFromListener()}for(o=0;o<this.soundTracks.length;o++)for(var a=0;a<this.soundTracks[o].soundCollection.length;a++)s=this.soundTracks[o].soundCollection[a],s.useCustomAttenuation&&s.updateDistanceFromListener()}}},Object.defineProperty(i.prototype,"audioEnabled",{get:function(){return this._audioEnabled},set:function(t){this._audioEnabled=t,e.AudioEngine&&(this._audioEnabled?this._enableAudio():this._disableAudio())},enumerable:!0,configurable:!0}),i.prototype._disableAudio=function(){var e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].pause();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].pause()},i.prototype._enableAudio=function(){var e;for(e=0;e<this.mainSoundTrack.soundCollection.length;e++)this.mainSoundTrack.soundCollection[e].isPaused&&this.mainSoundTrack.soundCollection[e].play();for(e=0;e<this.soundTracks.length;e++)for(var t=0;t<this.soundTracks[e].soundCollection.length;t++)this.soundTracks[e].soundCollection[t].isPaused&&this.soundTracks[e].soundCollection[t].play()},Object.defineProperty(i.prototype,"headphone",{get:function(){return this._headphone},set:function(t){this._headphone=t,e.AudioEngine&&(this._headphone?this._switchAudioModeForHeadphones():this._switchAudioModeForNormalSpeakers())},enumerable:!0,configurable:!0}),i.prototype._switchAudioModeForHeadphones=function(){this.mainSoundTrack.switchPanningModelToHRTF();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToHRTF()},i.prototype._switchAudioModeForNormalSpeakers=function(){this.mainSoundTrack.switchPanningModelToEqualPower();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].switchPanningModelToEqualPower()},i.prototype.enableDepthRenderer=function(){return this._depthRenderer?this._depthRenderer:(this._depthRenderer=new e.DepthRenderer(this),this._depthRenderer)},i.prototype.disableDepthRenderer=function(){this._depthRenderer&&(this._depthRenderer.dispose(),this._depthRenderer=null)},i.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},i.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},i.prototype.dispose=function(){this.beforeRender=null,this.afterRender=null,this.skeletons=[],this._boundingBoxRenderer.dispose(),this._depthRenderer&&this._depthRenderer.dispose(),this._debugLayer&&this._debugLayer.hide(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.detachControl(),e.AudioEngine&&this.disposeSounds();var t,i=this._engine.getRenderingCanvas();for(t=0;t<this.cameras.length;t++)this.cameras[t].detachControl(i);for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.spriteManagers.length;)this.spriteManagers[0].dispose();for(;this.layers.length;)this.layers[0].dispose();for(;this.textures.length;)this.textures[0].dispose();this.postProcessManager.dispose(),this._physicsEngine&&this.disablePhysicsEngine(),t=this._engine.scenes.indexOf(this),t>-1&&this._engine.scenes.splice(t,1),this._engine.wipeCaches()},i.prototype.disposeSounds=function(){this.mainSoundTrack.dispose();for(var e=0;e<this.soundTracks.length;e++)this.soundTracks[e].dispose()},i.prototype.getWorldExtends=function(){for(var t=new e.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new e.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n=0;n<this.meshes.length;n++){var r=this.meshes[n];r.computeWorldMatrix(!0);var o=r.getBoundingInfo().boundingBox.minimumWorld,s=r.getBoundingInfo().boundingBox.maximumWorld;e.Tools.CheckExtends(o,t,i),e.Tools.CheckExtends(s,t,i)}return{min:t,max:i}},i.prototype.createOrUpdateSelectionOctree=function(t,i){void 0===t&&(t=64),void 0===i&&(i=2),this._selectionOctree||(this._selectionOctree=new e.Octree(e.Octree.CreationFuncForMeshes,t,i));var n=this.getWorldExtends();return this._selectionOctree.update(n.min,n.max,this.meshes),this._selectionOctree},i.prototype.createPickingRay=function(t,i,n,r,o){void 0===o&&(o=!1);var s=this._engine;if(!r){if(!this.activeCamera)throw new Error("Active camera not set");r=this.activeCamera}var a=r.viewport,h=a.toGlobal(s.getRenderWidth(),s.getRenderHeight());return t=t/this._engine.getHardwareScalingLevel()-h.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-h.y-h.height),e.Ray.CreateNew(t,i,h.width,h.height,n?n:e.Matrix.Identity(),o?e.Matrix.Identity():r.getViewMatrix(),r.getProjectionMatrix())},i.prototype.createPickingRayInCameraSpace=function(t,i,n){
var r=this._engine;if(!n){if(!this.activeCamera)throw new Error("Active camera not set");n=this.activeCamera}var o=n.viewport,s=o.toGlobal(r.getRenderWidth(),r.getRenderHeight()),a=e.Matrix.Identity();return t=t/this._engine.getHardwareScalingLevel()-s.x,i=i/this._engine.getHardwareScalingLevel()-(this._engine.getRenderHeight()-s.y-s.height),e.Ray.CreateNew(t,i,s.width,s.height,a,a,n.getProjectionMatrix())},i.prototype._internalPick=function(t,i,n){for(var r=null,o=0;o<this.meshes.length;o++){var s=this.meshes[o];if(i){if(!i(s))continue}else if(!s.isEnabled()||!s.isVisible||!s.isPickable)continue;var a=s.getWorldMatrix(),h=t(a),l=s.intersects(h,n);if(l&&l.hit&&(n||null==r||!(l.distance>=r.distance))&&(r=l,n))break}return r||new e.PickingInfo},i.prototype._internalPickSprites=function(t,i,n,r){var o=null;if(r=r||this.activeCamera,this.spriteManagers.length>0)for(var s=0;s<this.spriteManagers.length;s++){var a=this.spriteManagers[s];if(a.isPickable){var h=a.intersects(t,r,i,n);if(h&&h.hit&&(n||null==o||!(h.distance>=o.distance))&&(o=h,n))break}}return o||new e.PickingInfo},i.prototype.pick=function(e,t,i,n,r){var o=this;return this._internalPick(function(i){return o.createPickingRay(e,t,i,r)},i,n)},i.prototype.pickSprite=function(e,t,i,n,r){return this._internalPickSprites(this.createPickingRayInCameraSpace(e,t,r),i,n,r)},i.prototype.pickWithRay=function(t,i,n){var r=this;return this._internalPick(function(i){return r._pickWithRayInverseMatrix||(r._pickWithRayInverseMatrix=e.Matrix.Identity()),i.invertToRef(r._pickWithRayInverseMatrix),e.Ray.Transform(t,r._pickWithRayInverseMatrix)},i,n)},i.prototype.setPointerOverMesh=function(t){this._pointerOverMesh!==t&&(this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)),this._pointerOverMesh=t,this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNew(this._pointerOverMesh)))},i.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},i.prototype.setPointerOverSprite=function(t){this._pointerOverSprite!==t&&(this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)),this._pointerOverSprite=t,this._pointerOverSprite&&this._pointerOverSprite.actionManager&&this._pointerOverSprite.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,e.ActionEvent.CreateNewFromSprite(this._pointerOverSprite,this)))},i.prototype.getPointerOverSprite=function(){return this._pointerOverSprite},i.prototype.getPhysicsEngine=function(){return this._physicsEngine},i.prototype.enablePhysics=function(t,i){if(this._physicsEngine)return!0;try{return this._physicsEngine=new e.PhysicsEngine(t,i),!0}catch(t){return e.Tools.Error(t.message),!1}},i.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=void 0)},i.prototype.isPhysicsEnabled=function(){return void 0!==this._physicsEngine},i.prototype.setGravity=function(t){e.Tools.Warn("Deprecated, please use 'scene.getPhysicsEngine().setGravity()'"),this._physicsEngine&&this._physicsEngine.setGravity(t)},i.prototype.createCompoundImpostor=function(t,i){e.Tools.Warn("Scene.createCompoundImpostor is deprecated. Please use PhysicsImpostor parent/child"),t.parts&&(i=t,t=t.parts);var n=t[0].mesh;n.physicsImpostor=new e.PhysicsImpostor(n,t[0].impostor,i,this);for(var r=1;r<t.length;r++){var o=t[r].mesh;o.parent!==n&&(o.position=o.position.subtract(n.position),o.parent=n),o.physicsImpostor=new e.PhysicsImpostor(o,t[r].impostor,i,this)}n.physicsImpostor.forceUpdate()},i.prototype.deleteCompoundImpostor=function(e){var t=e.parts[0].mesh;t.physicsImpostor.dispose(),t.physicsImpostor=null},i.prototype.createDefaultCameraOrLight=function(){if(0===this.lights.length&&new e.HemisphericLight("default light",e.Vector3.Up(),this),!this.activeCamera){var t=new e.FreeCamera("default camera",e.Vector3.Zero(),this),i=this.getWorldExtends(),n=i.min.add(i.max.subtract(i.min).scale(.5));t.position=new e.Vector3(n.x,n.y,i.min.z-(i.max.z-i.min.z)),t.setTarget(n),this.activeCamera=t}},i.prototype._getByTags=function(t,i,n){if(void 0===i)return t;var r=[];n=n||function(e){};for(var o in t){var s=t[o];e.Tags.MatchesQuery(s,i)&&(r.push(s),n(s))}return r},i.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},i.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},i.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},i.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},i._FOGMODE_NONE=0,i._FOGMODE_EXP=1,i._FOGMODE_EXP2=2,i._FOGMODE_LINEAR=3,i.MinDeltaTime=1,i.MaxDeltaTime=1e3,i}();e.Scene=o}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o,s){t instanceof e.Mesh?this._engine=t.getScene().getEngine():this._engine=t,this._updatable=n,this._data=i,this._strideSize=r,o||this.create(),this._instanced=s}return t.prototype.createVertexBuffer=function(t,i,n,r){return new e.VertexBuffer(this._engine,this,t,this._updatable,!0,r?r:this._strideSize,this._instanced,i,n)},t.prototype.isUpdatable=function(){return this._updatable},t.prototype.getData=function(){return this._data},t.prototype.getBuffer=function(){return this._buffer},t.prototype.getStrideSize=function(){return this._strideSize},t.prototype.getIsInstanced=function(){return this._instanced},t.prototype.create=function(e){!e&&this._buffer||(e=e||this._data,this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},t.prototype.update=function(e){this.create(e)},t.prototype.updateDirectly=function(e,t,i){this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,t,i?i*this.getStrideSize():void 0),this._data=null)},t.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},t}();e.Buffer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(i,n,r,o,s,a,h,l,c){if(!a)switch(r){case t.PositionKind:a=3;break;case t.NormalKind:a=3;break;case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:a=2;break;case t.ColorKind:a=4;break;case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:a=4;break;case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:a=4}n instanceof e.Buffer?(a||(a=n.getStrideSize()),this._buffer=n,this._ownsBuffer=!1):(this._buffer=new e.Buffer(i,n,o,a,s,h),this._ownsBuffer=!0),this._stride=a,this._offset=l?l:0,this._size=c?c:a,this._kind=r}return t.prototype.getKind=function(){return this._kind},t.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},t.prototype.getData=function(){return this._buffer.getData()},t.prototype.getBuffer=function(){return this._buffer.getBuffer()},t.prototype.getStrideSize=function(){return this._stride},t.prototype.getOffset=function(){return this._offset},t.prototype.getSize=function(){return this._size},t.prototype.getIsInstanced=function(){return this._buffer.getIsInstanced()},t.prototype.create=function(e){return this._buffer.create(e)},t.prototype.update=function(e){return this._buffer.update(e)},t.prototype.updateDirectly=function(e,t){return this._buffer.updateDirectly(e,t)},t.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},Object.defineProperty(t,"PositionKind",{get:function(){return t._PositionKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NormalKind",{get:function(){return t._NormalKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UVKind",{get:function(){return t._UVKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV2Kind",{get:function(){return t._UV2Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV3Kind",{get:function(){return t._UV3Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV4Kind",{get:function(){return t._UV4Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV5Kind",{get:function(){return t._UV5Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"UV6Kind",{get:function(){return t._UV6Kind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColorKind",{get:function(){return t._ColorKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesIndicesKind",{get:function(){return t._MatricesIndicesKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesWeightsKind",{get:function(){return t._MatricesWeightsKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesIndicesExtraKind",{get:function(){return t._MatricesIndicesExtraKind},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MatricesWeightsExtraKind",{get:function(){return t._MatricesWeightsExtraKind},enumerable:!0,configurable:!0}),t._PositionKind="position",t._NormalKind="normal",t._UVKind="uv",t._UV2Kind="uv2",t._UV3Kind="uv3",t._UV4Kind="uv4",t._UV5Kind="uv5",t._UV6Kind="uv6",t._ColorKind="color",t._MatricesIndicesKind="matricesIndices",t._MatricesWeightsKind="matricesWeights",t._MatricesIndicesExtraKind="matricesIndicesExtra",t._MatricesWeightsExtraKind="matricesWeightsExtra",t}();e.VertexBuffer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i){t.call(this,e,i.getScene()),i.instances.push(this),this._sourceMesh=i,this.position.copyFrom(i.position),this.rotation.copyFrom(i.rotation),this.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(this.rotationQuaternion=i.rotationQuaternion.clone()),this.infiniteDistance=i.infiniteDistance,this.setPivotMatrix(i.getPivotMatrix()),this.refreshBoundingInfo(),this._syncSubMeshes()}return __extends(i,t),Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},enumerable:!0,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},Object.defineProperty(i.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),i.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},i.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),i.prototype.refreshBoundingInfo=function(){var t=this._sourceMesh.getBoundingInfo();this._boundingInfo=new e.BoundingInfo(t.minimum.clone(),t.maximum.clone()),this._updateBoundingInfo()},i.prototype._preActivate=function(){this._currentLOD&&this._currentLOD._preActivate()},i.prototype._activate=function(e){this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e)},i.prototype.getLOD=function(e){return this._currentLOD=this.sourceMesh.getLOD(this.getScene().activeCamera,this.getBoundingInfo().boundingSphere),this._currentLOD===this.sourceMesh?this:this._currentLOD},i.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh)},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype.clone=function(t,i,n){var r=this._sourceMesh.createInstance(t);if(e.Tools.DeepCopy(this,r,["name","subMeshes"],[]),this.refreshBoundingInfo(),i&&(r.parent=i),!n)for(var o=0;o<this.getScene().meshes.length;o++){var s=this.getScene().meshes[o];s.parent===this&&s.clone(s.name,r)}return r.computeWorldMatrix(!0),r},i.prototype.dispose=function(e){var i=this._sourceMesh.instances.indexOf(this);this._sourceMesh.instances.splice(i,1),t.prototype.dispose.call(this,e)},i}(e.AbstractMesh);e.InstancedMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array}return e}();e._InstancesBatch=t;var i=function(i){function n(r,o,s,a,h,l){if(void 0===s&&(s=null),void 0===l&&(l=!0),i.call(this,r,o),this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,this.onBeforeDrawObservable=new e.Observable,this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.instances=new Array,this._LODLevels=new Array,this._visibleInstances={},this._renderIdForInstances=new Array,this._batchCache=new t,this._instancesBufferSize=2048,this._sideOrientation=n._DEFAULTSIDE,this._areNormalsFrozen=!1,a){a._geometry&&a._geometry.applyToMesh(this),e.Tools.DeepCopy(a,this,["name","material","skeleton","instances"],["_poseMatrix"]),this.setPivotMatrix(a.getPivotMatrix()),this.id=r+"."+a.id,this.material=a.material;var c;if(!h)for(c=0;c<o.meshes.length;c++){var u=o.meshes[c];u.parent===a&&u.clone(r+"."+u.name,this,h)}var d=this.getScene().getPhysicsEngine();if(l&&d){var f=d.getImpostorForPhysicsObject(a);f&&(this.physicsImpostor=f.clone(this))}for(c=0;c<o.particleSystems.length;c++){var p=o.particleSystems[c];p.emitter===a&&p.clone(p.name,this)}this.computeWorldMatrix(!0)}null!==s&&(this.parent=s)}return __extends(n,i),Object.defineProperty(n,"FRONTSIDE",{get:function(){return n._FRONTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BACKSIDE",{get:function(){return n._BACKSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DOUBLESIDE",{get:function(){return n._DOUBLESIDE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"DEFAULTSIDE",{get:function(){return n._DEFAULTSIDE},enumerable:!0,configurable:!0}),Object.defineProperty(n,"NO_CAP",{get:function(){return n._NO_CAP},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CAP_START",{get:function(){return n._CAP_START},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CAP_END",{get:function(){return n._CAP_END},enumerable:!0,configurable:!0}),Object.defineProperty(n,"CAP_ALL",{get:function(){return n._CAP_ALL},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){var n=i.prototype.toString.call(this,t);if(n+=", n vertices: "+this.getTotalVertices(),n+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var r=0;r<this.animations.length;r++)n+=", animation[0]: "+this.animations[r].toString(t);return t&&(n+=", flat shading: "+(this._geometry?this.getVerticesData(e.VertexBuffer.PositionKind).length/3===this.getIndices().length?"YES":"NO":"UNKNOWN")),n},Object.defineProperty(n.prototype,"hasLODLevels",{get:function(){return this._LODLevels.length>0},enumerable:!0,configurable:!0}),n.prototype._sortLODLevels=function(){this._LODLevels.sort(function(e,t){return e.distance<t.distance?1:e.distance>t.distance?-1:0})},n.prototype.addLODLevel=function(t,i){if(i&&i._masterMesh)return e.Tools.Warn("You cannot use a mesh as LOD level twice"),this;var n=new e.Internals.MeshLODLevel(t,i);return this._LODLevels.push(n),i&&(i._masterMesh=this),this._sortLODLevels(),this},n.prototype.getLODLevelAtDistance=function(e){for(var t=0;t<this._LODLevels.length;t++){var i=this._LODLevels[t];if(i.distance===e)return i.mesh}return null},n.prototype.removeLODLevel=function(e){for(var t=0;t<this._LODLevels.length;t++)this._LODLevels[t].mesh===e&&(this._LODLevels.splice(t,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},n.prototype.getLOD=function(e,t){if(!this._LODLevels||0===this._LODLevels.length)return this;var i=(t?t:this.getBoundingInfo().boundingSphere).centerWorld.subtract(e.globalPosition).length();if(this._LODLevels[this._LODLevels.length-1].distance>i)return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this._LODLevels[this._LODLevels.length-1].mesh),this;for(var n=0;n<this._LODLevels.length;n++){var r=this._LODLevels[n];if(r.distance<i)return r.mesh&&(r.mesh._preActivate(),r.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)),this.onLODLevelSelection&&this.onLODLevelSelection(i,this,r.mesh),r.mesh}return this.onLODLevelSelection&&this.onLODLevelSelection(i,this,this),this},Object.defineProperty(n.prototype,"geometry",{get:function(){return this._geometry},enumerable:!0,configurable:!0}),n.prototype.getTotalVertices=function(){return this._geometry?this._geometry.getTotalVertices():0},n.prototype.getVerticesData=function(e,t){return this._geometry?this._geometry.getVerticesData(e,t):null},n.prototype.getVertexBuffer=function(e){return this._geometry?this._geometry.getVertexBuffer(e):void 0},n.prototype.isVerticesDataPresent=function(e){return this._geometry?this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},n.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=[];if(this._delayInfo)for(var t in this._delayInfo)e.push(t);return e}return this._geometry.getVerticesDataKinds()},n.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},n.prototype.getIndices=function(e){return this._geometry?this._geometry.getIndices(e):[]},Object.defineProperty(n.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!0,configurable:!0}),n.prototype.isReady=function(){return this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING&&i.prototype.isReady.call(this)},n.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(n.prototype,"sideOrientation",{get:function(){return this._sideOrientation},set:function(e){this._sideOrientation=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"areNormalsFrozen",{get:function(){return this._areNormalsFrozen},enumerable:!0,configurable:!0}),n.prototype.freezeNormals=function(){this._areNormalsFrozen=!0},n.prototype.unfreezeNormals=function(){this._areNormalsFrozen=!1},Object.defineProperty(n.prototype,"overridenInstanceCount",{set:function(e){this._overridenInstanceCount=e},enumerable:!0,configurable:!0}),n.prototype._preActivate=function(){var e=this.getScene().getRenderId();this._preActivateId!==e&&(this._preActivateId=e,this._visibleInstances=null)},n.prototype._preActivateForIntermediateRendering=function(e){this._visibleInstances&&(this._visibleInstances.intermediateDefaultRenderId=e)},n.prototype._registerInstanceForRenderId=function(e,t){this._visibleInstances||(this._visibleInstances={},this._visibleInstances.defaultRenderId=t,this._visibleInstances.selfDefaultRenderId=this._renderId),this._visibleInstances[t]||(this._visibleInstances[t]=new Array),this._visibleInstances[t].push(e)},n.prototype.refreshBoundingInfo=function(){if(!this._boundingInfo.isLocked){var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(t){var i=e.Tools.ExtractMinAndMax(t,0,this.getTotalVertices());this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}if(this.subMeshes)for(var n=0;n<this.subMeshes.length;n++)this.subMeshes[n].refreshBoundingInfo();this._updateBoundingInfo()}},n.prototype._createGlobalSubMesh=function(){var t=this.getTotalVertices();return t&&this.getIndices()?(this.releaseSubMeshes(),new e.SubMesh(0,0,t,0,this.getTotalIndices(),this)):null},n.prototype.subdivide=function(t){if(!(1>t)){for(var i=this.getTotalIndices(),n=i/t|0,r=0;n%3!==0;)n++;this.releaseSubMeshes();for(var o=0;t>o&&!(r>=i);o++)e.SubMesh.CreateFromIndices(0,r,Math.min(n,i-r),this),r+=n;this.synchronizeInstances()}},n.prototype.setVerticesData=function(t,i,n,r){if(this._geometry)this._geometry.setVerticesData(t,i,n,r);else{var o=new e.VertexData;o.set(i,t);var s=this.getScene();new e.Geometry(e.Geometry.RandomId(),s,o,n,this)}},n.prototype.setVerticesBuffer=function(t){if(!this._geometry){var i=this.getScene();new e.Geometry(e.Geometry.RandomId(),i).applyToMesh(this)}this._geometry.setVerticesBuffer(t)},n.prototype.updateVerticesData=function(e,t,i,n){this._geometry&&(n?(this.makeGeometryUnique(),this.updateVerticesData(e,t,i,!1)):this._geometry.updateVerticesData(e,t,i))},n.prototype.updateVerticesDataDirectly=function(t,i,n,r){e.Tools.Warn("Mesh.updateVerticesDataDirectly deprecated since 2.3."),this._geometry&&(r?(this.makeGeometryUnique(),this.updateVerticesDataDirectly(t,i,n,!1)):this._geometry.updateVerticesDataDirectly(t,i,n))},n.prototype.updateMeshPositions=function(t,i){void 0===i&&(i=!0);var n=this.getVerticesData(e.VertexBuffer.PositionKind);if(t(n),this.updateVerticesData(e.VertexBuffer.PositionKind,n,!1,!1),i){var r=this.getIndices(),o=this.getVerticesData(e.VertexBuffer.NormalKind);e.VertexData.ComputeNormals(n,r,o),this.updateVerticesData(e.VertexBuffer.NormalKind,o,!1,!1)}},n.prototype.makeGeometryUnique=function(){if(this._geometry){var t=this._geometry.copy(e.Geometry.RandomId());t.applyToMesh(this)}},n.prototype.setIndices=function(t,i){if(this._geometry)this._geometry.setIndices(t,i);else{var n=new e.VertexData;n.indices=t;var r=this.getScene();new e.Geometry(e.Geometry.RandomId(),r,n,!1,this)}},n.prototype.toLeftHanded=function(){this._geometry&&this._geometry.toLeftHanded()},n.prototype._bind=function(t,i,n){var r,o=this.getScene().getEngine();if(this._unIndexed)r=null;else switch(n){case e.Material.PointFillMode:r=null;break;case e.Material.WireFrameFillMode:r=t.getLinesIndexBuffer(this.getIndices(),o);break;default:case e.Material.TriangleFillMode:r=this._unIndexed?null:this._geometry.getIndexBuffer()}o.bindBuffers(this._geometry.getVertexBuffers(),r,i)},n.prototype._draw=function(t,i,n){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeDrawObservable.notifyObservers(this);var r=this.getScene().getEngine();switch(i){case e.Material.PointFillMode:r.drawPointClouds(t.verticesStart,t.verticesCount,n);break;case e.Material.WireFrameFillMode:this._unIndexed?r.drawUnIndexed(!1,t.verticesStart,t.verticesCount,n):r.draw(!1,0,n>0?t.linesIndexCount/2:t.linesIndexCount,n);break;default:this._unIndexed?r.drawUnIndexed(!0,t.verticesStart,t.verticesCount,n):r.draw(!0,t.indexStart,t.indexCount,n)}}},n.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},n.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},n.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},n.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},n.prototype._getInstancesRenderList=function(e){var t=this.getScene();if(this._batchCache.mustReturn=!1,this._batchCache.renderSelf[e]=this.isEnabled()&&this.isVisible,this._batchCache.visibleInstances[e]=null,this._visibleInstances){var i=t.getRenderId(),n=t._isInIntermediateRendering()?this._visibleInstances.intermediateDefaultRenderId:this._visibleInstances.defaultRenderId;this._batchCache.visibleInstances[e]=this._visibleInstances[i];var r=this._renderId;if(!this._batchCache.visibleInstances[e]&&n&&(this._batchCache.visibleInstances[e]=this._visibleInstances[n],i=Math.max(n,i),r=Math.max(this._visibleInstances.selfDefaultRenderId,i)),this._batchCache.visibleInstances[e]&&this._batchCache.visibleInstances[e].length){if(this._renderIdForInstances[e]===i)return this._batchCache.mustReturn=!0,this._batchCache;i!==r&&(this._batchCache.renderSelf[e]=!1)}this._renderIdForInstances[e]=i}return this._batchCache},n.prototype._renderWithInstances=function(t,i,n,r,o){for(var s=n.visibleInstances[t._id],a=s.length+1,h=16*a*4,l=this._instancesBufferSize,c=this._instancesBuffer;this._instancesBufferSize<h;)this._instancesBufferSize*=2;this._instancesData&&l==this._instancesBufferSize||(this._instancesData=new Float32Array(this._instancesBufferSize/4));var u=0,d=0,f=this.getWorldMatrix();if(n.renderSelf[t._id]&&(f.copyToArray(this._instancesData,u),u+=16,d++),s)for(var p=0;p<s.length;p++){var _=s[p];_.getWorldMatrix().copyToArray(this._instancesData,u),u+=16,d++}c&&l==this._instancesBufferSize?c.updateDirectly(this._instancesData,0,d):(c&&c.dispose(),c=new e.Buffer(o,this._instancesData,!0,16,!1,!0),this._instancesBuffer=c,this.setVerticesBuffer(c.createVertexBuffer("world0",0,4)),this.setVerticesBuffer(c.createVertexBuffer("world1",4,4)),this.setVerticesBuffer(c.createVertexBuffer("world2",8,4)),this.setVerticesBuffer(c.createVertexBuffer("world3",12,4))),o.bindBuffers(this.geometry.getVertexBuffers(),this.geometry.getIndexBuffer(),r),this._draw(t,i,d),o.unbindInstanceAttributes()},n.prototype._processRendering=function(e,t,i,n,r,o){var s=this.getScene(),a=s.getEngine();if(r)this._renderWithInstances(e,i,n,t,a);else if(n.renderSelf[e._id]&&(o&&o(!1,this.getWorldMatrix()),this._draw(e,i,this._overridenInstanceCount)),n.visibleInstances[e._id])for(var h=0;h<n.visibleInstances[e._id].length;h++){var l=n.visibleInstances[e._id][h],c=l.getWorldMatrix();o&&o(!0,c),this._draw(e,i)}},n.prototype.render=function(t,i){var n=this.getScene(),r=this._getInstancesRenderList(t._id);if(!r.mustReturn&&this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){this.onBeforeRenderObservable.notifyObservers(this);var o=n.getEngine(),s=null!==o.getCaps().instancedArrays&&null!==r.visibleInstances[t._id]&&void 0!==r.visibleInstances[t._id],a=t.getMaterial();if(a&&a.isReady(this,s)){var h=o.getDepthWrite();this.renderOutline&&(o.setDepthWrite(!1),n.getOutlineRenderer().render(t,r),o.setDepthWrite(h)),a._preBind();var l=a.getEffect(),c=n.forcePointsCloud?e.Material.PointFillMode:n.forceWireframe?e.Material.WireFrameFillMode:a.fillMode;this._bind(t,l,c);var u=this.getWorldMatrix();if(a.bind(u,this),i&&o.setAlphaMode(a.alphaMode),this._processRendering(t,l,c,r,s,function(e,t){e&&a.bindOnlyWorldMatrix(t)}),a.unbind(),this.renderOutline&&h&&(o.setDepthWrite(!0),o.setColorWrite(!1),n.getOutlineRenderer().render(t,r),o.setColorWrite(!0)),this.renderOverlay){var d=o.getAlphaMode();o.setAlphaMode(e.Engine.ALPHA_COMBINE),n.getOutlineRenderer().render(t,r,!0),o.setAlphaMode(d)}this.onAfterRenderObservable.notifyObservers(this)}}},n.prototype.getEmittedParticleSystems=function(){for(var e=new Array,t=0;t<this.getScene().particleSystems.length;t++){var i=this.getScene().particleSystems[t];i.emitter===this&&e.push(i)}return e},n.prototype.getHierarchyEmittedParticleSystems=function(){var e=new Array,t=this.getDescendants();t.push(this);for(var i=0;i<this.getScene().particleSystems.length;i++){var n=this.getScene().particleSystems[i];-1!==t.indexOf(n.emitter)&&e.push(n)}return e},n.prototype._checkDelayState=function(){var t=this,i=this,n=this.getScene();if(this._geometry)this._geometry.load(n);else if(i.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED){i.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,n._addPendingData(i);var r=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");e.Tools.LoadFile(this.delayLoadingFile,function(i){i instanceof ArrayBuffer?t._delayLoadingFunction(i,t):t._delayLoadingFunction(JSON.parse(i),t),t.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,n._removePendingData(t)},function(){},n.database,r)}},n.prototype.isInFrustum=function(t){return this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING&&(!!i.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0))},n.prototype.setMaterialByID=function(e){var t,i=this.getScene().materials;for(t=0;t<i.length;t++)if(i[t].id===e)return void(this.material=i[t]);var n=this.getScene().multiMaterials;for(t=0;t<n.length;t++)if(n[t].id===e)return void(this.material=n[t])},n.prototype.getAnimatables=function(){var e=[];return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},n.prototype.bakeTransformIntoVertices=function(t){if(this.isVerticesDataPresent(e.VertexBuffer.PositionKind)){var i=this.subMeshes.splice(0);this._resetPointsArrayCache();var n,r=this.getVerticesData(e.VertexBuffer.PositionKind),o=[];for(n=0;n<r.length;n+=3)e.Vector3.TransformCoordinates(e.Vector3.FromArray(r,n),t).toArray(o,n);if(this.setVerticesData(e.VertexBuffer.PositionKind,o,this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)){for(r=this.getVerticesData(e.VertexBuffer.NormalKind),o=[],n=0;n<r.length;n+=3)e.Vector3.TransformNormal(e.Vector3.FromArray(r,n),t).normalize().toArray(o,n);this.setVerticesData(e.VertexBuffer.NormalKind,o,this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable()),t.m[0]*t.m[5]*t.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=i}}},n.prototype.bakeCurrentTransformIntoVertices=function(){this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=e.Quaternion.Identity()),this._worldMatrix=e.Matrix.Identity()},n.prototype._resetPointsArrayCache=function(){this._positions=null},n.prototype._generatePointsArray=function(){if(this._positions)return!0;this._positions=[];var t=this.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return!1;for(var i=0;i<t.length;i+=3)this._positions.push(e.Vector3.FromArray(t,i));return!0},n.prototype.clone=function(e,t,i,r){return void 0===r&&(r=!0),new n(e,this.getScene(),t,this,i,r)},n.prototype.dispose=function(e){for(this._geometry&&this._geometry.releaseForMesh(this,!0),this._instancesBuffer&&(this._instancesBuffer.dispose(),this._instancesBuffer=null);this.instances.length;)this.instances[0].dispose();i.prototype.dispose.call(this,e)},n.prototype.applyDisplacementMap=function(t,i,n,r){var o=this,s=this.getScene(),a=function(e){var t=document.createElement("canvas"),s=t.getContext("2d"),a=e.width,h=e.height;t.width=a,t.height=h,s.drawImage(e,0,0);var l=s.getImageData(0,0,a,h).data;o.applyDisplacementMapFromBuffer(l,a,h,i,n),r&&r(o)};e.Tools.LoadImage(t,a,function(){},s.database)},n.prototype.applyDisplacementMapFromBuffer=function(t,i,n,r,o){if(!this.isVerticesDataPresent(e.VertexBuffer.PositionKind)||!this.isVerticesDataPresent(e.VertexBuffer.NormalKind)||!this.isVerticesDataPresent(e.VertexBuffer.UVKind))return void e.Tools.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");for(var s=this.getVerticesData(e.VertexBuffer.PositionKind),a=this.getVerticesData(e.VertexBuffer.NormalKind),h=this.getVerticesData(e.VertexBuffer.UVKind),l=e.Vector3.Zero(),c=e.Vector3.Zero(),u=e.Vector2.Zero(),d=0;d<s.length;d+=3){e.Vector3.FromArrayToRef(s,d,l),e.Vector3.FromArrayToRef(a,d,c),e.Vector2.FromArrayToRef(h,d/3*2,u);var f=Math.abs(u.x)*i%i|0,p=Math.abs(u.y)*n%n|0,_=4*(f+p*i),m=t[_]/255,g=t[_+1]/255,v=t[_+2]/255,y=.3*m+.59*g+.11*v;c.normalize(),c.scaleInPlace(r+(o-r)*y),l=l.add(c),l.toArray(s,d)}e.VertexData.ComputeNormals(s,this.getIndices(),a),this.updateVerticesData(e.VertexBuffer.PositionKind,s),this.updateVerticesData(e.VertexBuffer.NormalKind,a)},n.prototype.convertToFlatShadedMesh=function(){var t,i,n=this.getVerticesDataKinds(),r=[],o=[],s=[],a=!1;for(t=0;t<n.length;t++){
i=n[t];var h=this.getVertexBuffer(i);i!==e.VertexBuffer.NormalKind?(r[i]=h,o[i]=r[i].getData(),s[i]=[]):(a=h.isUpdatable(),n.splice(t,1),t--)}var l,c=this.subMeshes.slice(0),u=this.getIndices(),d=this.getTotalIndices();for(l=0;d>l;l++){var f=u[l];for(t=0;t<n.length;t++){i=n[t];for(var p=r[i].getStrideSize(),_=0;p>_;_++)s[i].push(o[i][f*p+_])}}var m=[],g=s[e.VertexBuffer.PositionKind];for(l=0;d>l;l+=3){u[l]=l,u[l+1]=l+1,u[l+2]=l+2;for(var v=e.Vector3.FromArray(g,3*l),y=e.Vector3.FromArray(g,3*(l+1)),b=e.Vector3.FromArray(g,3*(l+2)),x=v.subtract(y),P=b.subtract(y),A=e.Vector3.Normalize(e.Vector3.Cross(x,P)),C=0;3>C;C++)m.push(A.x),m.push(A.y),m.push(A.z)}for(this.setIndices(u),this.setVerticesData(e.VertexBuffer.NormalKind,m,a),t=0;t<n.length;t++)i=n[t],this.setVerticesData(i,s[i],r[i].isUpdatable());this.releaseSubMeshes();for(var E=0;E<c.length;E++){var T=c[E];new e.SubMesh(T.materialIndex,T.indexStart,T.indexCount,T.indexStart,T.indexCount,this)}this.synchronizeInstances()},n.prototype.convertToUnIndexedMesh=function(){var t,i,n=this.getVerticesDataKinds(),r=[],o=[],s=[];for(t=0;t<n.length;t++){i=n[t];var a=this.getVertexBuffer(i);r[i]=a,o[i]=r[i].getData(),s[i]=[]}var h,l=this.subMeshes.slice(0),c=this.getIndices(),u=this.getTotalIndices();for(h=0;u>h;h++){var d=c[h];for(t=0;t<n.length;t++){i=n[t];for(var f=r[i].getStrideSize(),p=0;f>p;p++)s[i].push(o[i][d*f+p])}}for(h=0;u>h;h+=3)c[h]=h,c[h+1]=h+1,c[h+2]=h+2;for(this.setIndices(c),t=0;t<n.length;t++)i=n[t],this.setVerticesData(i,s[i],r[i].isUpdatable());this.releaseSubMeshes();for(var _=0;_<l.length;_++){var m=l[_];new e.SubMesh(m.materialIndex,m.indexStart,m.indexCount,m.indexStart,m.indexCount,this)}this._unIndexed=!0,this.synchronizeInstances()},n.prototype.flipFaces=function(t){void 0===t&&(t=!1);var i,n=e.VertexData.ExtractFromMesh(this);if(t&&this.isVerticesDataPresent(e.VertexBuffer.NormalKind))for(i=0;i<n.normals.length;i++)n.normals[i]*=-1;var r;for(i=0;i<n.indices.length;i+=3)r=n.indices[i+1],n.indices[i+1]=n.indices[i+2],n.indices[i+2]=r;n.applyToMesh(this)},n.prototype.createInstance=function(t){return new e.InstancedMesh(t,this)},n.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){var t=this.instances[e];t._syncSubMeshes()}},n.prototype.simplify=function(t,i,n,r){void 0===i&&(i=!0),void 0===n&&(n=e.SimplificationType.QUADRATIC),this.getScene().simplificationQueue.addTask({settings:t,parallelProcessing:i,mesh:this,simplificationType:n,successCallback:r})},n.prototype.optimizeIndices=function(t){for(var i=this,n=this.getIndices(),r=this.getVerticesData(e.VertexBuffer.PositionKind),o=[],s=0;s<r.length;s+=3)o.push(e.Vector3.FromArray(r,s));var a=[];e.AsyncLoop.SyncAsyncForLoop(o.length,40,function(e){for(var t=o.length-1-e,i=o[t],n=0;t>n;++n){var r=o[n];if(i.equals(r)){a[t]=n;break}}},function(){for(var e=0;e<n.length;++e)n[e]=a[n[e]]||n[e];var r=i.subMeshes.slice(0);i.setIndices(n),i.subMeshes=r,t&&t(i)})},n.Parse=function(t,i,r){var o=new n(t.name,i);if(o.id=t.id,e.Tags.AddTagsTo(o,t.tags),o.position=e.Vector3.FromArray(t.position),t.rotationQuaternion?o.rotationQuaternion=e.Quaternion.FromArray(t.rotationQuaternion):t.rotation&&(o.rotation=e.Vector3.FromArray(t.rotation)),o.scaling=e.Vector3.FromArray(t.scaling),t.localMatrix?o.setPivotMatrix(e.Matrix.FromArray(t.localMatrix)):t.pivotMatrix&&o.setPivotMatrix(e.Matrix.FromArray(t.pivotMatrix)),o.setEnabled(t.isEnabled),o.isVisible=t.isVisible,o.infiniteDistance=t.infiniteDistance,o.showBoundingBox=t.showBoundingBox,o.showSubMeshesBoundingBox=t.showSubMeshesBoundingBox,void 0!==t.applyFog&&(o.applyFog=t.applyFog),void 0!==t.pickable&&(o.isPickable=t.pickable),void 0!==t.alphaIndex&&(o.alphaIndex=t.alphaIndex),o.receiveShadows=t.receiveShadows,o.billboardMode=t.billboardMode,void 0!==t.visibility&&(o.visibility=t.visibility),o.checkCollisions=t.checkCollisions,o._shouldGenerateFlatShading=t.useFlatShading,t.freezeWorldMatrix&&(o._waitingFreezeWorldMatrix=t.freezeWorldMatrix),t.parentId&&(o._waitingParentId=t.parentId),void 0!==t.actions&&(o._waitingActions=t.actions),o.hasVertexAlpha=t.hasVertexAlpha,t.delayLoadingFile?(o.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,o.delayLoadingFile=r+t.delayLoadingFile,o._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(t.boundingBoxMinimum),e.Vector3.FromArray(t.boundingBoxMaximum)),t._binaryInfo&&(o._binaryInfo=t._binaryInfo),o._delayInfo=[],t.hasUVs&&o._delayInfo.push(e.VertexBuffer.UVKind),t.hasUVs2&&o._delayInfo.push(e.VertexBuffer.UV2Kind),t.hasUVs3&&o._delayInfo.push(e.VertexBuffer.UV3Kind),t.hasUVs4&&o._delayInfo.push(e.VertexBuffer.UV4Kind),t.hasUVs5&&o._delayInfo.push(e.VertexBuffer.UV5Kind),t.hasUVs6&&o._delayInfo.push(e.VertexBuffer.UV6Kind),t.hasColors&&o._delayInfo.push(e.VertexBuffer.ColorKind),t.hasMatricesIndices&&o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),t.hasMatricesWeights&&o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),o._delayLoadingFunction=e.Geometry.ImportGeometry,e.SceneLoader.ForceFullSceneLoadingForIncremental&&o._checkDelayState()):e.Geometry.ImportGeometry(t,o),t.materialId?o.setMaterialByID(t.materialId):o.material=null,t.skeletonId>-1&&(o.skeleton=i.getLastSkeletonByID(t.skeletonId),t.numBoneInfluencers&&(o.numBoneInfluencers=t.numBoneInfluencers)),t.animations){for(var s=0;s<t.animations.length;s++){var a=t.animations[s];o.animations.push(e.Animation.Parse(a))}e.Node.ParseAnimationRanges(o,t,i)}if(t.autoAnimate&&i.beginAnimation(o,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),t.layerMask&&!isNaN(t.layerMask)?o.layerMask=Math.abs(parseInt(t.layerMask)):o.layerMask=268435455,t.physicsImpostor&&(o.physicsImpostor=new e.PhysicsImpostor(o,t.physicsImpostor,{mass:t.physicsMass,friction:t.physicsFriction,restitution:t.physicsRestitution},i)),t.instances)for(var h=0;h<t.instances.length;h++){var l=t.instances[h],c=o.createInstance(l.name);if(e.Tags.AddTagsTo(c,l.tags),c.position=e.Vector3.FromArray(l.position),l.rotationQuaternion?c.rotationQuaternion=e.Quaternion.FromArray(l.rotationQuaternion):l.rotation&&(c.rotation=e.Vector3.FromArray(l.rotation)),c.scaling=e.Vector3.FromArray(l.scaling),c.checkCollisions=o.checkCollisions,t.animations){for(s=0;s<t.animations.length;s++)a=t.animations[s],c.animations.push(e.Animation.Parse(a));e.Node.ParseAnimationRanges(c,t,i)}}return o},n.CreateRibbon=function(t,i,n,r,o,s,a,h,l){return e.MeshBuilder.CreateRibbon(t,{pathArray:i,closeArray:n,closePath:r,offset:o,updatable:a,sideOrientation:h,instance:l},s)},n.CreateDisc=function(t,i,n,r,o,s){var a={radius:i,tessellation:n,sideOrientation:s,updatable:o};return e.MeshBuilder.CreateDisc(t,a,r)},n.CreateBox=function(t,i,n,r,o){var s={size:i,sideOrientation:o,updatable:r};return e.MeshBuilder.CreateBox(t,s,n)},n.CreateSphere=function(t,i,n,r,o,s){var a={segments:i,diameterX:n,diameterY:n,diameterZ:n,sideOrientation:s,updatable:o};return e.MeshBuilder.CreateSphere(t,a,r)},n.CreateCylinder=function(t,i,r,o,s,a,h,l,c){void 0!==h&&h instanceof e.Scene||(void 0!==h&&(c=l||n.DEFAULTSIDE,l=h),h=a,a=1);var u={height:i,diameterTop:r,diameterBottom:o,tessellation:s,subdivisions:a,sideOrientation:c,updatable:l};return e.MeshBuilder.CreateCylinder(t,u,h)},n.CreateTorus=function(t,i,n,r,o,s,a){var h={diameter:i,thickness:n,tessellation:r,sideOrientation:a,updatable:s};return e.MeshBuilder.CreateTorus(t,h,o)},n.CreateTorusKnot=function(t,i,n,r,o,s,a,h,l,c){var u={radius:i,tube:n,radialSegments:r,tubularSegments:o,p:s,q:a,sideOrientation:c,updatable:l};return e.MeshBuilder.CreateTorusKnot(t,u,h)},n.CreateLines=function(t,i,n,r,o){var s={points:i,updatable:r,instance:o};return e.MeshBuilder.CreateLines(t,s,n)},n.CreateDashedLines=function(t,i,n,r,o,s,a,h){var l={points:i,dashSize:n,gapSize:r,dashNb:o,updatable:a};return e.MeshBuilder.CreateDashedLines(t,l,s)},n.ExtrudeShape=function(t,i,r,o,s,a,h,l,c,u){var d={shape:i,path:r,scale:o,rotation:s,cap:0===a?0:a||n.NO_CAP,sideOrientation:c,instance:u,updatable:l};return e.MeshBuilder.ExtrudeShape(t,d,h)},n.ExtrudeShapeCustom=function(t,i,r,o,s,a,h,l,c,u,d,f){var p={shape:i,path:r,scaleFunction:o,rotationFunction:s,ribbonCloseArray:a,ribbonClosePath:h,cap:0===l?0:l||n.NO_CAP,sideOrientation:d,instance:f,updatable:u};return e.MeshBuilder.ExtrudeShapeCustom(t,p,c)},n.CreateLathe=function(t,i,n,r,o,s,a){var h={shape:i,radius:n,tessellation:r,sideOrientation:a,updatable:s};return e.MeshBuilder.CreateLathe(t,h,o)},n.CreatePlane=function(t,i,n,r,o){var s={size:i,width:i,height:i,sideOrientation:o,updatable:r};return e.MeshBuilder.CreatePlane(t,s,n)},n.CreateGround=function(t,i,n,r,o,s){var a={width:i,height:n,subdivisions:r,updatable:s};return e.MeshBuilder.CreateGround(t,a,o)},n.CreateTiledGround=function(t,i,n,r,o,s,a,h,l){var c={xmin:i,zmin:n,xmax:r,zmax:o,subdivisions:s,precision:a,updatable:l};return e.MeshBuilder.CreateTiledGround(t,c,h)},n.CreateGroundFromHeightMap=function(t,i,n,r,o,s,a,h,l,c){var u={width:n,height:r,subdivisions:o,minHeight:s,maxHeight:a,updatable:l,onReady:c};return e.MeshBuilder.CreateGroundFromHeightMap(t,i,u,h)},n.CreateTube=function(t,i,n,r,o,s,a,h,l,c){var u={path:i,radius:n,tessellation:r,radiusFunction:o,arc:1,cap:s,updatable:h,sideOrientation:l,instance:c};return e.MeshBuilder.CreateTube(t,u,a)},n.CreatePolyhedron=function(t,i,n){return e.MeshBuilder.CreatePolyhedron(t,i,n)},n.CreateIcoSphere=function(t,i,n){return e.MeshBuilder.CreateIcoSphere(t,i,n)},n.CreateDecal=function(t,i,n,r,o,s){var a={position:n,normal:r,size:o,angle:s};return e.MeshBuilder.CreateDecal(t,i,a)},n.prototype.setPositionsForCPUSkinning=function(){var t;return this._sourcePositions||(t=this.getVerticesData(e.VertexBuffer.PositionKind),this._sourcePositions=new Float32Array(t),this.getVertexBuffer(e.VertexBuffer.PositionKind).isUpdatable()||this.setVerticesData(e.VertexBuffer.PositionKind,t,!0)),this._sourcePositions},n.prototype.setNormalsForCPUSkinning=function(){var t;return this._sourceNormals||(t=this.getVerticesData(e.VertexBuffer.NormalKind),this._sourceNormals=new Float32Array(t),this.getVertexBuffer(e.VertexBuffer.NormalKind).isUpdatable()||this.setVerticesData(e.VertexBuffer.NormalKind,t,!0)),this._sourceNormals},n.prototype.applySkeleton=function(t){if(this.geometry&&this.geometry._softwareSkinningRenderId!=this.getScene().getRenderId()){if(this.geometry._softwareSkinningRenderId=this.getScene().getRenderId(),!this.isVerticesDataPresent(e.VertexBuffer.PositionKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.NormalKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind))return this;this._sourcePositions||this.setPositionsForCPUSkinning(),this._sourceNormals||this.setNormalsForCPUSkinning();var i=this.getVerticesData(e.VertexBuffer.PositionKind);i instanceof Float32Array||(i=new Float32Array(i));var n=this.getVerticesData(e.VertexBuffer.NormalKind);n instanceof Float32Array||(n=new Float32Array(n));for(var r,o=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),s=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind),a=this.numBoneInfluencers>4,h=a?this.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind):null,l=a?this.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind):null,c=t.getTransformMatrices(this),u=e.Vector3.Zero(),d=new e.Matrix,f=new e.Matrix,p=0,_=0;_<i.length;_+=3,p+=4){var m;for(r=0;4>r&&(m=s[p+r],m>0);r++)e.Matrix.FromFloat32ArrayToRefScaled(c,16*o[p+r],m,f),d.addToSelf(f);if(a)for(r=0;4>r&&(m=l[p+r],m>0);r++)e.Matrix.FromFloat32ArrayToRefScaled(c,16*h[p+r],m,f),d.addToSelf(f);e.Vector3.TransformCoordinatesFromFloatsToRef(this._sourcePositions[_],this._sourcePositions[_+1],this._sourcePositions[_+2],d,u),u.toArray(i,_),e.Vector3.TransformNormalFromFloatsToRef(this._sourceNormals[_],this._sourceNormals[_+1],this._sourceNormals[_+2],d,u),u.toArray(n,_),d.reset()}return this.updateVerticesData(e.VertexBuffer.PositionKind,i),this.updateVerticesData(e.VertexBuffer.NormalKind,n),this}},n.MinMax=function(e){var t=null,i=null;for(var n in e){var r=e[n],o=r.getBoundingInfo().boundingBox;t?(t.MinimizeInPlace(o.minimumWorld),i.MaximizeInPlace(o.maximumWorld)):(t=o.minimumWorld,i=o.maximumWorld)}return{min:t,max:i}},n.Center=function(t){var i=void 0!==t.min?t:n.MinMax(t);return e.Vector3.Center(i.min,i.max)},n.MergeMeshes=function(t,i,r,o){void 0===i&&(i=!0);var s;if(!r){var a=0;for(s=0;s<t.length;s++)if(t[s]&&(a+=t[s].getTotalVertices(),a>65536))return e.Tools.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}var h,l,c;for(s=0;s<t.length;s++)t[s]&&(t[s].computeWorldMatrix(!0),l=e.VertexData.ExtractFromMesh(t[s],!0),l.transform(t[s].getWorldMatrix()),h?h.merge(l):(h=l,c=t[s]));if(o||(o=new n(c.name+"_merged",c.getScene())),h.applyToMesh(o),o.material=c.material,o.checkCollisions=c.checkCollisions,i)for(s=0;s<t.length;s++)t[s]&&t[s].dispose();return o},n._FRONTSIDE=0,n._BACKSIDE=1,n._DOUBLESIDE=2,n._DEFAULTSIDE=0,n._NO_CAP=0,n._CAP_START=1,n._CAP_END=2,n._CAP_ALL=3,n}(e.AbstractMesh);e.Mesh=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,n,r,o,s,a){void 0===a&&(a=!0),this.materialIndex=e,this.verticesStart=t,this.verticesCount=i,this.indexStart=n,this.indexCount=r,this._renderId=0,this._mesh=o,this._renderingMesh=s||o,o.subMeshes.push(this),this._trianglePlanes=[],this._id=o.subMeshes.length-1,a&&(this.refreshBoundingInfo(),o.computeWorldMatrix(!0))}return Object.defineProperty(t.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount==this._mesh.getTotalVertices()},enumerable:!0,configurable:!0}),t.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},t.prototype.getMesh=function(){return this._mesh},t.prototype.getRenderingMesh=function(){return this._renderingMesh},t.prototype.getMaterial=function(){var t=this._renderingMesh.material;if(t&&t instanceof e.MultiMaterial){var i=t;return i.getSubMaterial(this.materialIndex)}return t?t:this._mesh.getScene().defaultMaterial},t.prototype.refreshBoundingInfo=function(){if(this._lastColliderWorldVertices=null,!this.IsGlobal){var t=this._renderingMesh.getVerticesData(e.VertexBuffer.PositionKind);if(!t)return void(this._boundingInfo=this._mesh._boundingInfo);var i,n=this._renderingMesh.getIndices();i=0===this.indexStart&&this.indexCount===n.length?{minimum:this._renderingMesh.getBoundingInfo().minimum.clone(),maximum:this._renderingMesh.getBoundingInfo().maximum.clone()}:e.Tools.ExtractMinAndMaxIndexed(t,n,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias),this._boundingInfo=new e.BoundingInfo(i.minimum,i.maximum)}},t.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},t.prototype.updateBoundingInfo=function(e){this.getBoundingInfo()||this.refreshBoundingInfo(),this.getBoundingInfo().update(e)},t.prototype.isInFrustum=function(e){return this.getBoundingInfo().isInFrustum(e)},t.prototype.render=function(e){this._renderingMesh.render(this,e)},t.prototype.getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var i=[],n=this.indexStart;n<this.indexStart+this.indexCount;n+=3)i.push(e[n],e[n+1],e[n+1],e[n+2],e[n+2],e[n]);this._linesIndexBuffer=t.createIndexBuffer(i),this.linesIndexCount=i.length}return this._linesIndexBuffer},t.prototype.canIntersects=function(e){return e.intersectsBox(this.getBoundingInfo().boundingBox)},t.prototype.intersects=function(t,i,n,r){var o=null;if(this._mesh instanceof e.LinesMesh)for(var s=this._mesh,a=this.indexStart;a<this.indexStart+this.indexCount;a+=2){var h=i[n[a]],l=i[n[a+1]],c=t.intersectionSegment(h,l,s.intersectionThreshold);if(!(0>c)&&(r||!o||c<o.distance)&&(o=new e.IntersectionInfo(null,null,c),r))break}else for(var a=this.indexStart;a<this.indexStart+this.indexCount;a+=3){var h=i[n[a]],l=i[n[a+1]],u=i[n[a+2]],d=t.intersectsTriangle(h,l,u);if(d){if(d.distance<0)continue;if((r||!o||d.distance<o.distance)&&(o=d,o.faceId=a/3,r))break}}return o},t.prototype.clone=function(i,n){var r=new t(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,i,n,!1);return this.IsGlobal||(r._boundingInfo=new e.BoundingInfo(this.getBoundingInfo().minimum,this.getBoundingInfo().maximum)),r},t.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1)},t.CreateFromIndices=function(e,i,n,r,o){var s=Number.MAX_VALUE,a=-Number.MAX_VALUE;o=o||r;for(var h=o.getIndices(),l=i;i+n>l;l++){var c=h[l];s>c&&(s=c),c>a&&(a=c)}return new t(e,s,a-s+1,i,n,r,o)},t}();e.SubMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.CreateBox=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateBox(i);return o.applyToMesh(r,i.updatable),r},t.CreateSphere=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateSphere(i);return o.applyToMesh(r,i.updatable),r},t.CreateDisc=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateDisc(i);return o.applyToMesh(r,i.updatable),r},t.CreateIcoSphere=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateIcoSphere(i);return o.applyToMesh(r,i.updatable),r},t.CreateRibbon=function(t,i,n){var r=i.pathArray,o=i.closeArray,s=i.closePath,a=(i.offset,i.sideOrientation),h=i.instance,l=i.updatable;if(h){var c=function(t){for(var i=r[0].length,n=0,o=h.sideOrientation===e.Mesh.DOUBLESIDE?2:1,s=1;o>=s;s++)for(var a=0;a<r.length;a++){var l=r[a],c=l.length;i=c>i?i:c;for(var u=0;i>u;)t[n]=l[u].x,t[n+1]=l[u].y,t[n+2]=l[u].z,u++,n+=3;h._closePath&&(t[n]=l[0].x,t[n+1]=l[0].y,t[n+2]=l[0].z,n+=3)}},u=h.getVerticesData(e.VertexBuffer.PositionKind);if(c(u),h.updateVerticesData(e.VertexBuffer.PositionKind,u,!1,!1),!h.areNormalsFrozen){var d=h.getIndices(),f=h.getVerticesData(e.VertexBuffer.NormalKind);if(e.VertexData.ComputeNormals(u,d,f),h._closePath)for(var p=0,_=0,m=0;m<r.length;m++)p=3*h._idx[m],_=m+1<r.length?3*(h._idx[m+1]-1):f.length-3,f[p]=.5*(f[p]+f[_]),f[p+1]=.5*(f[p+1]+f[_+1]),f[p+2]=.5*(f[p+2]+f[_+2]),f[_]=f[p],f[_+1]=f[p+1],f[_+2]=f[p+2];h.updateVerticesData(e.VertexBuffer.NormalKind,f,!1,!1)}return h}var g=new e.Mesh(t,n);g.sideOrientation=a;var v=e.VertexData.CreateRibbon(i);return s&&(g._idx=v._idx),g._closePath=s,g._closeArray=o,v.applyToMesh(g,l),g},t.CreateCylinder=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateCylinder(i);return o.applyToMesh(r,i.updatable),r},t.CreateTorus=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateTorus(i);return o.applyToMesh(r,i.updatable),r},t.CreateTorusKnot=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateTorusKnot(i);return o.applyToMesh(r,i.updatable),r},t.CreateLineSystem=function(t,i,n){var r=i.instance,o=i.lines;if(r){var s=function(e){for(var t=0,i=0;i<o.length;i++)for(var n=o[i],r=0;r<n.length;r++)e[t]=n[r].x,e[t+1]=n[r].y,e[t+2]=n[r].z,t+=3};return r.updateMeshPositions(s,!1),r}var a=new e.LinesMesh(t,n),h=e.VertexData.CreateLineSystem(i);return h.applyToMesh(a,i.updatable),a},t.CreateLines=function(e,i,n){var r=t.CreateLineSystem(e,{lines:[i.points],updatable:i.updatable,instance:i.instance},n);return r},t.CreateDashedLines=function(t,i,n){var r=i.points,o=i.instance,s=i.gapSize,a=(i.dashNb,i.dashSize);if(o){var h=function(t){var i=e.Vector3.Zero(),n=t.length/6,s=0,a=0,h=0,l=0,c=0,u=0,d=0,f=0;for(d=0;d<r.length-1;d++)r[d+1].subtractToRef(r[d],i),s+=i.length();for(h=s/n,l=o.dashSize*h/(o.dashSize+o.gapSize),d=0;d<r.length-1;d++)for(r[d+1].subtractToRef(r[d],i),a=Math.floor(i.length()/h),i.normalize(),f=0;a>f&&u<t.length;)c=h*f,t[u]=r[d].x+c*i.x,t[u+1]=r[d].y+c*i.y,t[u+2]=r[d].z+c*i.z,t[u+3]=r[d].x+(c+l)*i.x,t[u+4]=r[d].y+(c+l)*i.y,t[u+5]=r[d].z+(c+l)*i.z,u+=6,f++;for(;u<t.length;)t[u]=r[d].x,t[u+1]=r[d].y,t[u+2]=r[d].z,u+=3};return o.updateMeshPositions(h,!1),o}var l=new e.LinesMesh(t,n),c=e.VertexData.CreateDashedLines(i);return c.applyToMesh(l,i.updatable),l.dashSize=a,l.gapSize=s,l},t.ExtrudeShape=function(i,n,r){var o=n.path,s=n.shape,a=n.scale||1,h=n.rotation||0,l=0===n.cap?0:n.cap||e.Mesh.NO_CAP,c=n.updatable,u=0===n.sideOrientation?0:n.sideOrientation||e.Mesh.DEFAULTSIDE,d=n.instance;return t._ExtrudeShapeGeneric(i,s,o,a,h,null,null,!1,!1,l,!1,r,c,u,d)},t.ExtrudeShapeCustom=function(i,n,r){var o=n.path,s=n.shape,a=n.scaleFunction||function(){return 1},h=n.rotationFunction||function(){return 0},l=n.ribbonCloseArray||!1,c=n.ribbonClosePath||!1,u=0===n.cap?0:n.cap||e.Mesh.NO_CAP,d=n.updatable,f=0===n.sideOrientation?0:n.sideOrientation||e.Mesh.DEFAULTSIDE,p=n.instance;return t._ExtrudeShapeGeneric(i,s,o,null,null,a,h,l,c,u,!0,r,d,f,p)},t.CreateLathe=function(i,n,r){var o,s=n.arc<=0||n.arc>1?1:n.arc||1,a=void 0===n.closed||n.closed,h=n.shape,l=n.radius||1,c=n.tessellation||64,u=n.updatable,d=0===n.sideOrientation?0:n.sideOrientation||e.Mesh.DEFAULTSIDE,f=n.cap||e.Mesh.NO_CAP,p=2*Math.PI,_=new Array,m=0,g=0,v=p/c*s,y=new Array;for(m=0;c>=m;m++){var y=[];for(f!=e.Mesh.CAP_START&&f!=e.Mesh.CAP_ALL||(y.push(new e.Vector3(0,h[0].y,0)),y.push(new e.Vector3(Math.cos(m*v)*h[0].x*l,h[0].y,Math.sin(m*v)*h[0].x*l))),g=0;g<h.length;g++)o=new e.Vector3(Math.cos(m*v)*h[g].x*l,h[g].y,Math.sin(m*v)*h[g].x*l),y.push(o);f!=e.Mesh.CAP_END&&f!=e.Mesh.CAP_ALL||(y.push(new e.Vector3(Math.cos(m*v)*h[h.length-1].x*l,h[h.length-1].y,Math.sin(m*v)*h[h.length-1].x*l)),y.push(new e.Vector3(0,h[h.length-1].y,0))),_.push(y)}var b=t.CreateRibbon(i,{pathArray:_,closeArray:a,sideOrientation:d,updatable:u},r);return b},t.CreatePlane=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreatePlane(i);if(o.applyToMesh(r,i.updatable),i.sourcePlane){r.translate(i.sourcePlane.normal,i.sourcePlane.d);var s=Math.acos(e.Vector3.Dot(i.sourcePlane.normal,e.Axis.Z)),a=e.Vector3.Cross(e.Axis.Z,i.sourcePlane.normal);r.rotate(a,s)}return r},t.CreateGround=function(t,i,n){var r=new e.GroundMesh(t,n);r._setReady(!1),r._subdivisions=i.subdivisions||1,r._width=i.width||1,r._height=i.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ;var o=e.VertexData.CreateGround(i);return o.applyToMesh(r,i.updatable),r._setReady(!0),r},t.CreateTiledGround=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreateTiledGround(i);return o.applyToMesh(r,i.updatable),r},t.CreateGroundFromHeightMap=function(t,i,n,r){var o=n.width||10,s=n.height||10,a=n.subdivisions||1,h=n.minHeight,l=n.maxHeight||10,c=n.updatable,u=n.onReady,d=new e.GroundMesh(t,r);d._subdivisions=a,d._width=o,d._height=s,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1);var f=function(t){var i=document.createElement("canvas"),n=i.getContext("2d"),r=t.width,f=t.height;i.width=r,i.height=f,n.drawImage(t,0,0);var p=n.getImageData(0,0,r,f).data,_=e.VertexData.CreateGroundFromHeightMap({width:o,height:s,subdivisions:a,minHeight:h,maxHeight:l,buffer:p,bufferWidth:r,bufferHeight:f});_.applyToMesh(d,c),d._setReady(!0),u&&u(d)};return e.Tools.LoadImage(i,f,function(){},r.database),d},t.CreateTube=function(i,n,r){var o=n.path,s=n.radius||1,a=n.tessellation||64,h=n.radiusFunction,l=n.cap||e.Mesh.NO_CAP,c=n.updatable,u=n.sideOrientation||e.Mesh.DEFAULTSIDE,d=n.instance;n.arc=n.arc<=0||n.arc>1?1:n.arc||1;var f,p,_=function(t,i,n,r,o,s,a,h){for(var l,c,u,d,f=i.getTangents(),p=i.getNormals(),_=i.getDistances(),m=2*Math.PI,g=m/o*h,v=function(){return r},y=s||v,b=e.Tmp.Matrix[0],x=a===e.Mesh._NO_CAP||a===e.Mesh.CAP_END?0:2,P=0;P<t.length;P++){c=y(P,_[P]),l=Array(),u=p[P];for(var A=0;o>A;A++)e.Matrix.RotationAxisToRef(f[P],g*A,b),d=l[A]?l[A]:e.Vector3.Zero(),e.Vector3.TransformCoordinatesToRef(u,b,d),d.scaleInPlace(c).addInPlace(t[P]),l[A]=d;n[x]=l,x++}var C=function(e,i){for(var n=Array(),r=0;e>r;r++)n.push(t[i]);return n};switch(a){case e.Mesh.NO_CAP:break;case e.Mesh.CAP_START:n[0]=C(o,0),n[1]=n[2].slice(0);break;case e.Mesh.CAP_END:n[x]=n[x-1].slice(0),n[x+1]=C(o,t.length-1);break;case e.Mesh.CAP_ALL:n[0]=C(o,0),n[1]=n[2].slice(0),n[x]=n[x-1].slice(0),n[x+1]=C(o,t.length-1)}return n};if(d){var m=n.arc||d.arc;return f=d.path3D.update(o),p=_(o,f,d.pathArray,s,d.tessellation,h,d.cap,m),d=t.CreateRibbon(null,{pathArray:p,instance:d}),d.path3D=f,d.pathArray=p,d.arc=m,d}f=new e.Path3D(o);var g=new Array;l=0>l||l>3?0:l,p=_(o,f,g,s,a,h,l,n.arc);var v=t.CreateRibbon(i,{pathArray:p,closePath:!0,closeArray:!1,updatable:c,sideOrientation:u},r);return v.pathArray=p,v.path3D=f,v.tessellation=a,v.cap=l,v.arc=n.arc,v},t.CreatePolyhedron=function(t,i,n){var r=new e.Mesh(t,n),o=e.VertexData.CreatePolyhedron(i);return o.applyToMesh(r,i.updatable),r},t.CreateDecal=function(t,i,n){var r=i.getIndices(),o=i.getVerticesData(e.VertexBuffer.PositionKind),s=i.getVerticesData(e.VertexBuffer.NormalKind),a=n.position||e.Vector3.Zero(),h=n.normal||e.Vector3.Up(),l=n.size||new e.Vector3(1,1,1),c=n.angle||0;if(!h){var u=new e.Vector3(0,0,1),d=i.getScene().activeCamera,f=e.Vector3.TransformCoordinates(u,d.getWorldMatrix());h=d.globalPosition.subtract(f)}var p=-Math.atan2(h.z,h.x)-Math.PI/2,_=Math.sqrt(h.x*h.x+h.z*h.z),m=Math.atan2(h.y,_),g=e.Matrix.RotationYawPitchRoll(p,m,c).multiply(e.Matrix.Translation(a.x,a.y,a.z)),v=e.Matrix.Invert(g),y=i.getWorldMatrix(),b=y.multiply(v),x=new e.VertexData;x.indices=[],x.positions=[],x.normals=[],x.uvs=[];for(var P=0,A=function(t){var i=r[t],n=new e.PositionNormalVertex;return n.position=new e.Vector3(o[3*i],o[3*i+1],o[3*i+2]),n.position=e.Vector3.TransformCoordinates(n.position,b),n.normal=new e.Vector3(s[3*i],s[3*i+1],s[3*i+2]),n},C=function(t,i){if(0===t.length)return t;for(var n=.5*Math.abs(e.Vector3.Dot(l,i)),r=function(t,r){var o=e.Vector3.GetClipFactor(t.position,r.position,i,n);return new e.PositionNormalVertex(e.Vector3.Lerp(t.position,r.position,o),e.Vector3.Lerp(t.normal,r.normal,o))},o=new Array,s=0;s<t.length;s+=3){var a,h,c,u,d,f,p,_=0,m=e.Vector3.Dot(t[s].position,i)-n,g=e.Vector3.Dot(t[s+1].position,i)-n,v=e.Vector3.Dot(t[s+2].position,i)-n;switch(a=m>0,h=g>0,c=v>0,_=(a?1:0)+(h?1:0)+(c?1:0)){case 0:o.push(t[s]),o.push(t[s+1]),o.push(t[s+2]);break;case 1:if(a&&(u=t[s+1],d=t[s+2],f=r(t[s],u),p=r(t[s],d)),h){u=t[s],d=t[s+2],f=r(t[s+1],u),p=r(t[s+1],d),o.push(f),o.push(d.clone()),o.push(u.clone()),o.push(d.clone()),o.push(f.clone()),o.push(p);break}c&&(u=t[s],d=t[s+1],f=r(t[s+2],u),p=r(t[s+2],d)),o.push(u.clone()),o.push(d.clone()),o.push(f),o.push(p),o.push(f.clone()),o.push(d.clone());break;case 2:a||(u=t[s].clone(),d=r(u,t[s+1]),f=r(u,t[s+2]),o.push(u),o.push(d),o.push(f)),h||(u=t[s+1].clone(),d=r(u,t[s+2]),f=r(u,t[s]),o.push(u),o.push(d),o.push(f)),c||(u=t[s+2].clone(),d=r(u,t[s]),f=r(u,t[s+1]),o.push(u),o.push(d),o.push(f));break;case 3:}}return o},E=0;E<r.length;E+=3){var T=new Array;if(T.push(A(E)),T.push(A(E+1)),T.push(A(E+2)),T=C(T,new e.Vector3(1,0,0)),T=C(T,new e.Vector3(-1,0,0)),T=C(T,new e.Vector3(0,1,0)),T=C(T,new e.Vector3(0,-1,0)),T=C(T,new e.Vector3(0,0,1)),T=C(T,new e.Vector3(0,0,-1)),0!==T.length)for(var S=0;S<T.length;S++){var M=T[S];x.indices.push(P),M.position.toArray(x.positions,3*P),M.normal.toArray(x.normals,3*P),x.uvs.push(.5+M.position.x/l.x),x.uvs.push(.5+M.position.y/l.y),P++}}var I=new e.Mesh(t,i.getScene());return x.applyToMesh(I),I.position=a.clone(),I.rotation=new e.Vector3(m,p,c),I},t._ExtrudeShapeGeneric=function(t,i,n,r,o,s,a,h,l,c,u,d,f,p,_){var m,g,v=function(t,i,n,r,o,s,a,h,l,c){for(var u=n.getTangents(),d=n.getNormals(),f=n.getBinormals(),p=n.getDistances(),_=0,m=function(){return o},g=function(){return s},v=c?h:g,y=c?a:m,b=l===e.Mesh.NO_CAP||l===e.Mesh.CAP_END?0:2,x=e.Tmp.Matrix[0],P=0;P<i.length;P++){for(var A=new Array,C=v(P,p[P]),E=y(P,p[P]),T=0;T<t.length;T++){e.Matrix.RotationAxisToRef(u[P],_,x);var S=u[P].scale(t[T].z).add(d[P].scale(t[T].x)).add(f[P].scale(t[T].y)),M=A[T]?A[T]:e.Vector3.Zero();e.Vector3.TransformCoordinatesToRef(S,x,M),M.scaleInPlace(E).addInPlace(i[P]),A[T]=M}r[b]=A,_+=C,b++}var I=function(t){var i,n=Array(),r=e.Vector3.Zero();for(i=0;i<t.length;i++)r.addInPlace(t[i]);for(r.scaleInPlace(1/t.length),i=0;i<t.length;i++)n.push(r);return n};switch(l){case e.Mesh.NO_CAP:break;case e.Mesh.CAP_START:r[0]=I(r[2]),r[1]=r[2].slice(0);break;case e.Mesh.CAP_END:r[b]=r[b-1],r[b+1]=I(r[b-1]);break;case e.Mesh.CAP_ALL:r[0]=I(r[2]),r[1]=r[2].slice(0),r[b]=r[b-1],r[b+1]=I(r[b-1])}return r};if(_)return m=_.path3D.update(n),g=v(i,n,_.path3D,_.pathArray,r,o,s,a,_.cap,u),_=e.Mesh.CreateRibbon(null,g,null,null,null,null,null,null,_);m=new e.Path3D(n);var y=new Array;c=0>c||c>3?0:c,g=v(i,n,m,y,r,o,s,a,c,u);var b=e.Mesh.CreateRibbon(t,g,h,l,0,d,f,p);return b.pathArray=g,b.path3D=m,b.cap=c,b},t}();e.MeshBuilder=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.hasAlpha=!1,this.getAlphaFromRGB=!1,this.level=1,this.coordinatesIndex=0,this.coordinatesMode=e.Texture.EXPLICIT_MODE,this.wrapU=e.Texture.WRAP_ADDRESSMODE,this.wrapV=e.Texture.WRAP_ADDRESSMODE,this.anisotropicFilteringLevel=4,this.isCube=!1,this.isRenderTarget=!1,this.animations=new Array,this.onDisposeObservable=new e.Observable,this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._scene=t,this._scene.textures.push(this)}return t.prototype.toString=function(){return this.name},Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getTextureMatrix=function(){return null},t.prototype.getReflectionTextureMatrix=function(){return null},t.prototype.getInternalTexture=function(){return this._texture},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED||!!this._texture&&this._texture.isReady},t.prototype.getSize=function(){return this._texture._width?{width:this._texture._width,height:this._texture._height}:this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:0,height:0}},t.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?{width:this._texture._size,height:this._texture._size}:{width:this._texture._baseWidth,height:this._texture._baseHeight}:{width:0,height:0}},t.prototype.scale=function(e){},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._removeFromCache=function(e,t){for(var i=this._scene.getEngine().getLoadedTexturesCache(),n=0;n<i.length;n++){var r=i[n];if(r.url===e&&r.noMipmap===t)return void i.splice(n,1)}},t.prototype._getFromCache=function(e,t,i){for(var n=this._scene.getEngine().getLoadedTexturesCache(),r=0;r<n.length;r++){var o=n[r];if(o.url===e&&o.noMipmap===t&&(!i||i===o.samplingMode))return o.references++,o}return null},t.prototype.delayLoad=function(){},t.prototype.clone=function(){return null},t.prototype.releaseInternalTexture=function(){this._texture&&(this._scene.getEngine().releaseInternalTexture(this._texture),delete this._texture)},t.prototype.dispose=function(){this.getScene().stopAnimation(this);var e=this._scene.textures.indexOf(this);e>=0&&this._scene.textures.splice(e,1),void 0!==this._texture&&(this.releaseInternalTexture(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear())},t.prototype.serialize=function(){if(!this.name)return null;var t=e.SerializationHelper.Serialize(this);return e.Animation.AppendSerializedAnimations(this,t),t},__decorate([e.serialize()],t.prototype,"name",void 0),__decorate([e.serialize()],t.prototype,"hasAlpha",void 0),__decorate([e.serialize()],t.prototype,"getAlphaFromRGB",void 0),__decorate([e.serialize()],t.prototype,"level",void 0),__decorate([e.serialize()],t.prototype,"coordinatesIndex",void 0),__decorate([e.serialize()],t.prototype,"coordinatesMode",void 0),__decorate([e.serialize()],t.prototype,"wrapU",void 0),
__decorate([e.serialize()],t.prototype,"wrapV",void 0),__decorate([e.serialize()],t.prototype,"anisotropicFilteringLevel",void 0),__decorate([e.serialize()],t.prototype,"isCube",void 0),__decorate([e.serialize()],t.prototype,"isRenderTarget",void 0),t}();e.BaseTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(n,r,o,s,a,h,l,c,u){void 0===a&&(a=i.TRILINEAR_SAMPLINGMODE),void 0===h&&(h=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===u&&(u=!1),t.call(this,r),this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.name=n,this.url=n,this._noMipmap=o,this._invertY=s,this._samplingMode=a,this._buffer=c,this._deleteBuffer=u,n&&(this._texture=this._getFromCache(n,o,a),this._texture?e.Tools.SetImmediate(function(){h&&h()}):r.useDelayedTextureLoading?(this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,this._delayedOnLoad=h,this._delayedOnError=l):(this._texture=r.getEngine().createTexture(n,o,s,r,this._samplingMode,h,l,this._buffer),u&&delete this._buffer))}return __extends(i,t),Object.defineProperty(i.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!0,configurable:!0}),i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap,this._samplingMode),this._texture||(this._texture=this.getScene().getEngine().createTexture(this.url,this._noMipmap,this._invertY,this.getScene(),this._samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer),this._deleteBuffer&&delete this._buffer))},i.prototype.updateSamplingMode=function(e){this._texture&&(this._samplingMode=e,this.getScene().getEngine().updateTextureSamplingMode(e,this._texture))},i.prototype._prepareRowForTextureGeneration=function(t,i,n,r){t*=this.uScale,i*=this.vScale,t-=.5*this.uScale,i-=.5*this.vScale,n-=.5,e.Vector3.TransformCoordinatesFromFloatsToRef(t,i,n,this._rowGenerationMatrix,r),r.x+=.5*this.uScale+this.uOffset,r.y+=.5*this.vScale+this.vOffset,r.z+=.5},i.prototype.getTextureMatrix=function(){return this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng?this._cachedTextureMatrix:(this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._rowGenerationMatrix=new e.Matrix,this._t0=e.Vector3.Zero(),this._t1=e.Vector3.Zero(),this._t2=e.Vector3.Zero()),e.Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix.m[0]=this._t1.x,this._cachedTextureMatrix.m[1]=this._t1.y,this._cachedTextureMatrix.m[2]=this._t1.z,this._cachedTextureMatrix.m[4]=this._t2.x,this._cachedTextureMatrix.m[5]=this._t2.y,this._cachedTextureMatrix.m[6]=this._t2.z,this._cachedTextureMatrix.m[8]=this._t0.x,this._cachedTextureMatrix.m[9]=this._t0.y,this._cachedTextureMatrix.m[10]=this._t0.z,this._cachedTextureMatrix)},i.prototype.getReflectionTextureMatrix=function(){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=e.Matrix.Zero(),this._projectionModeMatrix=e.Matrix.Zero()),this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case i.PLANAR_MODE:e.Matrix.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case i.PROJECTION_MODE:e.Matrix.IdentityToRef(this._projectionModeMatrix),this._projectionModeMatrix.m[0]=.5,this._projectionModeMatrix.m[5]=-.5,this._projectionModeMatrix.m[10]=0,this._projectionModeMatrix.m[12]=.5,this._projectionModeMatrix.m[13]=.5,this._projectionModeMatrix.m[14]=1,this._projectionModeMatrix.m[15]=1,this.getScene().getProjectionMatrix().multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:e.Matrix.IdentityToRef(this._cachedTextureMatrix)}return this._cachedTextureMatrix},i.prototype.clone=function(){var t=this;return e.SerializationHelper.Clone(function(){return new i(t._texture.url,t.getScene(),t._noMipmap,t._invertY,t._samplingMode)},this)},i.CreateFromBase64String=function(e,t,n,r,o,s,a,h){return void 0===s&&(s=i.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===h&&(h=null),new i("data:"+t,n,r,o,s,a,h,e)},i.Parse=function(t,n,r){if(t.isCube)return e.CubeTexture.Parse(t,n,r);if(!t.name&&!t.isRenderTarget)return null;var o=e.SerializationHelper.Parse(function(){if(t.mirrorPlane){var o=new e.MirrorTexture(t.name,t.renderTargetSize,n);return o._waitingRenderList=t.renderList,o.mirrorPlane=e.Plane.FromArray(t.mirrorPlane),o}if(t.isRenderTarget){var s=new e.RenderTargetTexture(t.name,t.renderTargetSize,n);return s._waitingRenderList=t.renderList,s}var a;return a=t.base64String?i.CreateFromBase64String(t.base64String,t.name,n):new i(r+t.name,n)},t,n);if(t.animations)for(var s=0;s<t.animations.length;s++){var a=t.animations[s];o.animations.push(e.Animation.Parse(a))}return o},i.NEAREST_SAMPLINGMODE=1,i.BILINEAR_SAMPLINGMODE=2,i.TRILINEAR_SAMPLINGMODE=3,i.EXPLICIT_MODE=0,i.SPHERICAL_MODE=1,i.PLANAR_MODE=2,i.CUBIC_MODE=3,i.PROJECTION_MODE=4,i.SKYBOX_MODE=5,i.INVCUBIC_MODE=6,i.EQUIRECTANGULAR_MODE=7,i.FIXED_EQUIRECTANGULAR_MODE=8,i.CLAMP_ADDRESSMODE=0,i.WRAP_ADDRESSMODE=1,i.MIRROR_ADDRESSMODE=2,__decorate([e.serialize()],i.prototype,"url",void 0),__decorate([e.serialize()],i.prototype,"uOffset",void 0),__decorate([e.serialize()],i.prototype,"vOffset",void 0),__decorate([e.serialize()],i.prototype,"uScale",void 0),__decorate([e.serialize()],i.prototype,"vScale",void 0),__decorate([e.serialize()],i.prototype,"uAng",void 0),__decorate([e.serialize()],i.prototype,"vAng",void 0),__decorate([e.serialize()],i.prototype,"wAng",void 0),i}(e.BaseTexture);e.Texture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s){if(t.call(this,n),this.coordinatesMode=e.Texture.CUBIC_MODE,this.name=i,this.url=i,this._noMipmap=o,this.hasAlpha=!1,i||s){if(this._texture=this._getFromCache(i,o),!s){r||(r=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),s=[];for(var a=0;a<r.length;a++)s.push(i+r[a]);this._extensions=r}this._files=s,this._texture||(n.useDelayedTextureLoading?this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:this._texture=n.getEngine().createCubeTexture(i,n,s,o)),this.isCube=!0,this._textureMatrix=e.Matrix.Identity()}}return __extends(i,t),i.CreateFromImages=function(e,t,n){return new i("",t,null,n,e)},i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||(this._texture=this.getScene().getEngine().createCubeTexture(this.url,this.getScene(),this._extensions)))},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i.Parse=function(t,i,n){var r=e.SerializationHelper.Parse(function(){return new e.CubeTexture(n+t.name,i,t.extensions)},t,i);if(t.animations)for(var o=0;o<t.animations.length;o++){var s=t.animations[o];r.animations.push(e.Animation.Parse(s))}return r},i.prototype.clone=function(){var t=this;return e.SerializationHelper.Clone(function(){return new i(t.url,t.getScene(),t._extensions,t._noMipmap,t._files)},this)},i}(e.BaseTexture);e.CubeTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a,h,l){void 0===s&&(s=!0),void 0===a&&(a=e.Engine.TEXTURETYPE_UNSIGNED_INT),void 0===h&&(h=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,r,!o),this.isCube=h,this.renderList=new Array,this.renderParticles=!0,this.renderSprites=!1,this.coordinatesMode=e.Texture.PROJECTION_MODE,this.onAfterUnbindObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,this.onClearObservable=new e.Observable,this._currentRefreshId=-1,this._refreshRate=1,this.name=i,this.isRenderTarget=!0,this._size=n,this._generateMipMaps=o,this._doNotChangeAspectRatio=s,l===e.Texture.NEAREST_SAMPLINGMODE&&(this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE),h?(this._texture=r.getEngine().createRenderTargetCubeTexture(n,{generateMipMaps:o,samplingMode:l}),this.coordinatesMode=e.Texture.INVCUBIC_MODE,this._textureMatrix=e.Matrix.Identity()):this._texture=r.getEngine().createRenderTargetTexture(n,{generateMipMaps:o,type:a,samplingMode:l}),this._renderingManager=new e.RenderingManager(r)}return __extends(i,t),Object.defineProperty(i,"REFRESHRATE_RENDER_ONCE",{get:function(){return i._REFRESHRATE_RENDER_ONCE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"REFRESHRATE_RENDER_ONEVERYFRAME",{get:function(){return i._REFRESHRATE_RENDER_ONEVERYFRAME},enumerable:!0,configurable:!0}),Object.defineProperty(i,"REFRESHRATE_RENDER_ONEVERYTWOFRAMES",{get:function(){return i._REFRESHRATE_RENDER_ONEVERYTWOFRAMES},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!0,configurable:!0}),i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype._shouldRender=function(){return-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},i.prototype.isReady=function(){return!!this.getScene().renderTargetsEnabled&&t.prototype.isReady.call(this)},i.prototype.getRenderSize=function(){return this._size},Object.defineProperty(i.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype.scale=function(e){var t=this._size*e;this.resize(t,this._generateMipMaps)},i.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:t.prototype.getReflectionTextureMatrix.call(this)},i.prototype.resize=function(e,t){this.releaseInternalTexture(),this.isCube?this._texture=this.getScene().getEngine().createRenderTargetCubeTexture(e):this._texture=this.getScene().getEngine().createRenderTargetTexture(e,t)},i.prototype.render=function(e,t){var i=this.getScene();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this.activeCamera&&this.activeCamera!==i.activeCamera&&i.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0)),this._waitingRenderList){this.renderList=[];for(var n=0;n<this._waitingRenderList.length;n++){var r=this._waitingRenderList[n];this.renderList.push(i.getMeshByID(r))}delete this._waitingRenderList}if(this.renderListPredicate){this.renderList.splice(0);for(var o=this.getScene().meshes,n=0;n<o.length;n++){var s=o[n];this.renderListPredicate(s)&&this.renderList.push(s)}}if(!this.renderList||0!==this.renderList.length){this._renderingManager.reset();for(var a=this.renderList?this.renderList:i.getActiveMeshes().data,h=i.getRenderId(),l=0;l<a.length;l++){var s=a[l];if(s){if(!s.isReady()){this.resetRefreshCounter();continue}if(s._preActivateForIntermediateRendering(h),s.isEnabled()&&s.isVisible&&s.subMeshes&&0!==(s.layerMask&i.activeCamera.layerMask)){s._activate(h);for(var c=0;c<s.subMeshes.length;c++){var u=s.subMeshes[c];i._activeIndices+=u.indexCount,this._renderingManager.dispatch(u)}}}}if(this.isCube)for(var d=0;6>d;d++)this.renderToTarget(d,a,e,t),i.incrementRenderId(),i.resetCachedMaterial();else this.renderToTarget(0,a,e,t);this.onAfterUnbindObservable.notifyObservers(this),this.activeCamera&&this.activeCamera!==i.activeCamera&&i.setTransformMatrix(i.activeCamera.getViewMatrix(),i.activeCamera.getProjectionMatrix(!0)),i.resetCachedMaterial()}},i.prototype.renderToTarget=function(t,i,n,r){var o=this.getScene(),s=o.getEngine();n&&o.postProcessManager._prepareFrame(this._texture)||(this.isCube?s.bindFramebuffer(this._texture,t):s.bindFramebuffer(this._texture)),this.onBeforeRenderObservable.notifyObservers(t),this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(s):s.clear(o.clearColor,!0,!0),this._doNotChangeAspectRatio||o.updateTransformMatrix(!0),this._renderingManager.render(this.customRenderFunction,i,this.renderParticles,this.renderSprites),n&&o.postProcessManager._finalizeFrame(!1,this._texture,t),this._doNotChangeAspectRatio||o.updateTransformMatrix(!0),this.onAfterRenderObservable.notifyObservers(t),r&&e.Tools.DumpFramebuffer(this._size,this._size,s),this.isCube&&5!==t||(this.isCube&&5===t&&s.generateMipMapsForCubemap(this._texture),s.unBindFramebuffer(this._texture,this.isCube))},i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t.renderList=this.renderList.slice(0),t},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);e.renderTargetSize=this.getRenderSize(),e.renderList=[];for(var i=0;i<this.renderList.length;i++)e.renderList.push(this.renderList[i].id);return e},i._REFRESHRATE_RENDER_ONCE=0,i._REFRESHRATE_RENDER_ONEVERYFRAME=1,i._REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,i}(e.Texture);e.RenderTargetTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a,h){void 0===a&&(a=!0),void 0===h&&(h=!1),t.call(this,null,o,!a),this.isCube=h,this.isEnabled=!0,this._currentRefreshId=-1,this._refreshRate=1,this._vertexBuffers={},this._uniforms=new Array,this._samplers=new Array,this._textures=new Array,this._floats=new Array,this._floatsArrays={},this._colors3=new Array,this._colors4=new Array,this._vectors2=new Array,this._vectors3=new Array,this._matrices=new Array,this._fallbackTextureUsed=!1,o._proceduralTextures.push(this),this.name=i,this.isRenderTarget=!0,this._size=n,this._generateMipMaps=a,this.setFragment(r),this._fallbackTexture=s;var l=o.getEngine();h?(this._texture=l.createRenderTargetCubeTexture(n,{generateMipMaps:a}),this.setFloat("face",0)):this._texture=l.createRenderTargetTexture(n,a);var c=[];c.push(1,1),c.push(-1,1),c.push(-1,-1),c.push(1,-1),this._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(l,c,e.VertexBuffer.PositionKind,!1,!1,2);var u=[];u.push(0),u.push(1),u.push(2),u.push(0),u.push(2),u.push(3),this._indexBuffer=l.createIndexBuffer(u)}return __extends(i,t),i.prototype.reset=function(){if(void 0!==this._effect){var e=this.getScene().getEngine();e._releaseEffect(this._effect)}},i.prototype.isReady=function(){var t,i=this,n=this.getScene().getEngine();return!!this._fragment&&(!!this._fallbackTextureUsed||(t=void 0!==this._fragment.fragmentElement?{vertex:"procedural",fragmentElement:this._fragment.fragmentElement}:{vertex:"procedural",fragment:this._fragment},this._effect=n.createEffect(t,[e.VertexBuffer.PositionKind],this._uniforms,this._samplers,"",null,null,function(){i.releaseInternalTexture(),i._fallbackTexture&&(i._texture=i._fallbackTexture._texture,i._texture.references++),i._fallbackTextureUsed=!0}),this._effect.isReady()))},i.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},i.prototype.setFragment=function(e){this._fragment=e},Object.defineProperty(i.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!0,configurable:!0}),i.prototype._shouldRender=function(){return!!(this.isEnabled&&this.isReady()&&this._texture)&&(!this._fallbackTextureUsed&&(-1===this._currentRefreshId?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)))},i.prototype.getRenderSize=function(){return this._size},i.prototype.resize=function(e,t){this._fallbackTextureUsed||(this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createRenderTargetTexture(e,t))},i.prototype._checkUniform=function(e){-1===this._uniforms.indexOf(e)&&this._uniforms.push(e)},i.prototype.setTexture=function(e,t){return-1===this._samplers.indexOf(e)&&this._samplers.push(e),this._textures[e]=t,this},i.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},i.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},i.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},i.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},i.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},i.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},i.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},i.prototype.render=function(e){var t=this.getScene(),i=t.getEngine();i.enableEffect(this._effect),i.setState(!1);for(var n in this._textures)this._effect.setTexture(n,this._textures[n]);for(n in this._floats)this._effect.setFloat(n,this._floats[n]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[n]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[n]);for(n in this._colors4){var r=this._colors4[n];this._effect.setFloat4(n,r.r,r.g,r.b,r.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[n]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[n]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[n]);if(i.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect),this.isCube)for(var o=0;6>o;o++)i.bindFramebuffer(this._texture,o),this._effect.setFloat("face",o),i.clear(t.clearColor,!0,!0),i.draw(!0,0,6),5===o&&i.generateMipMapsForCubemap(this._texture);else i.bindFramebuffer(this._texture),i.clear(t.clearColor,!0,!0),i.draw(!0,0,6);i.unBindFramebuffer(this._texture,this.isCube),this.onGenerated&&this.onGenerated()},i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e.width,this._fragment,this.getScene(),this._fallbackTexture,this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,t},i.prototype.dispose=function(){var i=this.getScene()._proceduralTextures.indexOf(this);i>=0&&this.getScene()._proceduralTextures.splice(i,1);var n=this._vertexBuffers[e.VertexBuffer.PositionKind];n&&(n.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&this.getScene().getEngine()._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),t.prototype.dispose.call(this)},i}(e.Texture);e.ProceduralTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){var s=this;t.call(this,i,n,r,o,!0),this.mirrorPlane=new e.Plane(0,1,0,1),this._transformMatrix=e.Matrix.Zero(),this._mirrorMatrix=e.Matrix.Zero(),this.onBeforeRenderObservable.add(function(){e.Matrix.ReflectionToRef(s.mirrorPlane,s._mirrorMatrix),s._savedViewMatrix=r.getViewMatrix(),s._mirrorMatrix.multiplyToRef(s._savedViewMatrix,s._transformMatrix),r.setTransformMatrix(s._transformMatrix,r.getProjectionMatrix()),r.clipPlane=s.mirrorPlane,r.getEngine().cullBackFaces=!1,r._mirroredCameraPosition=e.Vector3.TransformCoordinates(r.activeCamera.position,s._mirrorMatrix)}),this.onAfterRenderObservable.add(function(){r.setTransformMatrix(s._savedViewMatrix,r.getProjectionMatrix()),r.getEngine().cullBackFaces=!0,r._mirroredCameraPosition=null,delete r.clipPlane})}return __extends(i,t),i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.mirrorPlane=this.mirrorPlane.clone(),t.renderList=this.renderList.slice(0),t},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);return e.mirrorPlane=this.mirrorPlane.asArray(),e},i}(e.RenderTargetTexture);e.MirrorTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){var s=this;t.call(this,i,n,r,o,!0),this.refractionPlane=new e.Plane(0,1,0,1),this.depth=2,this.onBeforeRenderObservable.add(function(){r.clipPlane=s.refractionPlane}),this.onAfterRenderObservable.add(function(){delete r.clipPlane})}return __extends(i,t),i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e.width,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.refractionPlane=this.refractionPlane.clone(),t.renderList=this.renderList.slice(0),t.depth=this.depth,t},i.prototype.serialize=function(){if(!this.name)return null;var e=t.prototype.serialize.call(this);return e.mirrorPlane=this.refractionPlane.asArray(),e.depth=this.depth,e},i}(e.RenderTargetTexture);e.RefractionTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,r,!o),this.name=i,this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=o,n.getContext?(this._canvas=n,this._texture=r.getEngine().createDynamicTexture(n.width,n.height,o,s)):(this._canvas=document.createElement("canvas"),n.width?this._texture=r.getEngine().createDynamicTexture(n.width,n.height,o,s):this._texture=r.getEngine().createDynamicTexture(n,n,o,s));var a=this.getSize();this._canvas.width=a.width,this._canvas.height=a.height,this._context=this._canvas.getContext("2d")}return __extends(i,t),Object.defineProperty(i.prototype,"canRescale",{get:function(){return!0},enumerable:!0,configurable:!0}),i.prototype.scale=function(e){var t=this.getSize();t.width*=e,t.height*=e,this._canvas.width=t.width,this._canvas.height=t.height,this.releaseInternalTexture(),this._texture=this.getScene().getEngine().createDynamicTexture(t.width,t.height,this._generateMipMaps,this._samplingMode)},i.prototype.getContext=function(){return this._context},i.prototype.clear=function(){var e=this.getSize();this._context.fillRect(0,0,e.width,e.height)},i.prototype.update=function(e){this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===e||e)},i.prototype.drawText=function(e,t,i,n,r,o,s,a){void 0===a&&(a=!0);var h=this.getSize();if(o&&(this._context.fillStyle=o,this._context.fillRect(0,0,h.width,h.height)),this._context.font=n,null===t){var l=this._context.measureText(e);t=(h.width-l.width)/2}this._context.fillStyle=r,this._context.fillText(e,t,i),a&&this.update(s)},i.prototype.clone=function(){var e=this.getSize(),t=new i(this.name,e,this.getScene(),this._generateMipMaps);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t},i}(e.Texture);e.DynamicTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a){var h=this;void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,r,!o,s),this._autoLaunch=!0;var l;this.name=i,n instanceof HTMLVideoElement?this.video=n:(l=n,this.video=document.createElement("video"),this.video.autoplay=!1,this.video.loop=!0),this._generateMipMaps=o,this._samplingMode=a,e.Tools.IsExponentOfTwo(this.video.videoWidth)&&e.Tools.IsExponentOfTwo(this.video.videoHeight)?(this.wrapU=e.Texture.WRAP_ADDRESSMODE,this.wrapV=e.Texture.WRAP_ADDRESSMODE):(this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._generateMipMaps=!1),l?(this.video.addEventListener("canplaythrough",function(){h._createTexture()}),l.forEach(function(e){var t=document.createElement("source");t.src=e,h.video.appendChild(t)})):this._createTexture(),this._lastUpdate=e.Tools.Now}return __extends(i,t),i.prototype._createTexture=function(){this._texture=this.getScene().getEngine().createDynamicTexture(this.video.videoWidth,this.video.videoHeight,this._generateMipMaps,this._samplingMode),this._texture.isReady=!0},i.prototype.update=function(){this._autoLaunch&&(this._autoLaunch=!1,this.video.play());var t=e.Tools.Now;return!(t-this._lastUpdate<15||this.video.readyState!==this.video.HAVE_ENOUGH_DATA)&&(this._lastUpdate=t,this.getScene().getEngine().updateVideoTexture(this._texture,this.video,this._invertY),!0)},i}(e.Texture);e.VideoTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,n,r,o,s){t.call(this,e,n,null,r,o,s),this._animate=!0,this._time=0,this._texturePath=i,this.loadJson(i),this.refreshRate=1}return __extends(i,t),i.prototype.loadJson=function(t){function i(){e.Tools.Log("No config file found in "+t+" trying to use ShadersStore or DOM element");try{r.setFragment(r._texturePath)}catch(t){e.Tools.Error("No json or ShaderStore or DOM element found for CustomProceduralTexture")}}var n=this,r=this,o=t+"/config.json",s=new XMLHttpRequest;s.open("GET",o,!0),s.addEventListener("load",function(){if(200===s.status||e.Tools.ValidateXHRData(s,1))try{n._config=JSON.parse(s.response),n.updateShaderUniforms(),n.updateTextures(),n.setFragment(n._texturePath+"/custom"),n._animate=n._config.animate,n.refreshRate=n._config.refreshrate}catch(e){i()}else i()},!1),s.addEventListener("error",function(){i()},!1);try{s.send()}catch(t){e.Tools.Error("CustomProceduralTexture: Error on XHR send request.")}},i.prototype.isReady=function(){if(!t.prototype.isReady.call(this))return!1;for(var e in this._textures){var i=this._textures[e];if(!i.isReady())return!1}return!0},i.prototype.render=function(e){this._animate&&(this._time+=.03*this.getScene().getAnimationRatio(),this.updateShaderUniforms()),t.prototype.render.call(this,e)},i.prototype.updateTextures=function(){for(var t=0;t<this._config.sampler2Ds.length;t++)this.setTexture(this._config.sampler2Ds[t].sample2Dname,new e.Texture(this._texturePath+"/"+this._config.sampler2Ds[t].textureRelativeUrl,this.getScene()))},i.prototype.updateShaderUniforms=function(){if(this._config)for(var t=0;t<this._config.uniforms.length;t++){var i=this._config.uniforms[t];switch(i.type){case"float":this.setFloat(i.name,i.value);break;case"color3":this.setColor3(i.name,new e.Color3(i.r,i.g,i.b));break;case"color4":this.setColor4(i.name,new e.Color4(i.r,i.g,i.b,i.a));break;case"vector2":this.setVector2(i.name,new e.Vector2(i.x,i.y));break;case"vector3":this.setVector3(i.name,new e.Vector3(i.x,i.y,i.z))}}this.setFloat("time",this._time)},Object.defineProperty(i.prototype,"animate",{get:function(){return this._animate},set:function(e){this._animate=e},enumerable:!0,configurable:!0}),i}(e.ProceduralTexture);e.CustomProceduralTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._defines={},this._currentRank=32,this._maxRank=-1}return t.prototype.addFallback=function(e,t){this._defines[e]||(e<this._currentRank&&(this._currentRank=e),e>this._maxRank&&(this._maxRank=e),this._defines[e]=new Array),this._defines[e].push(t)},t.prototype.addCPUSkinningFallback=function(e,t){this._meshRank=e,this._mesh=t,e>this._maxRank&&(this._maxRank=e)},Object.defineProperty(t.prototype,"isMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!0,configurable:!0}),t.prototype.reduce=function(t){for(var i=this._defines[this._currentRank],n=0;n<i.length;n++)t=t.replace("#define "+i[n],"");return this._mesh&&this._currentRank===this._meshRank&&(this._mesh.computeBonesUsingShaders=!1,t=t.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),e.Tools.Log("Falling back to CPU skinning for "+this._mesh.name)),this._currentRank++,t},t}();e.EffectFallbacks=t;var i=function(){function t(e,t,i,n,r,o,s,a,h,l){var c=this;this._isReady=!1,this._compilationError="",this._valueCache=[],this._engine=r,this.name=e,this.defines=o,this._uniformsNames=i.concat(n),this._samplers=n,this._attributesNames=t,this.onError=h,this.onCompiled=a,this._indexParameters=l;var u,d;e.vertexElement?(u=document.getElementById(e.vertexElement),u||(u=e.vertexElement)):u=e.vertex||e,e.fragmentElement?(d=document.getElementById(e.fragmentElement),d||(d=e.fragmentElement)):d=e.fragment||e,this._loadVertexShader(u,function(e){c._processIncludes(e,function(e){c._loadFragmentShader(d,function(i){c._processIncludes(i,function(i){c._prepareEffect(e,i,t,o,s)})})})})}return t.prototype.isReady=function(){return this._isReady},t.prototype.getProgram=function(){return this._program},t.prototype.getAttributesNames=function(){return this._attributesNames},t.prototype.getAttributeLocation=function(e){return this._attributes[e]},t.prototype.getAttributeLocationByName=function(e){var t=this._attributesNames.indexOf(e);return this._attributes[t]},t.prototype.getAttributesCount=function(){return this._attributes.length},t.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},t.prototype.getUniform=function(e){return this._uniforms[this._uniformsNames.indexOf(e)]},t.prototype.getSamplers=function(){return this._samplers},t.prototype.getCompilationError=function(){return this._compilationError},t.prototype._loadVertexShader=function(i,n){if(i instanceof HTMLElement){var r=e.Tools.GetDOMTextContent(i);return void n(r)}if(t.ShadersStore[i+"VertexShader"])return void n(t.ShadersStore[i+"VertexShader"]);var o;o="."===i[0]||"/"===i[0]||i.indexOf("http")>-1?i:e.Engine.ShadersRepository+i,e.Tools.LoadFile(o+".vertex.fx",n)},t.prototype._loadFragmentShader=function(i,n){if(i instanceof HTMLElement){var r=e.Tools.GetDOMTextContent(i);return void n(r)}if(t.ShadersStore[i+"PixelShader"])return void n(t.ShadersStore[i+"PixelShader"]);if(t.ShadersStore[i+"FragmentShader"])return void n(t.ShadersStore[i+"FragmentShader"]);var o;o="."===i[0]||"/"===i[0]||i.indexOf("http")>-1?i:e.Engine.ShadersRepository+i,e.Tools.LoadFile(o+".fragment.fx",n)},t.prototype._dumpShadersName=function(){this.name.vertexElement?(e.Tools.Error("Vertex shader:"+this.name.vertexElement),e.Tools.Error("Fragment shader:"+this.name.fragmentElement)):this.name.vertex?(e.Tools.Error("Vertex shader:"+this.name.vertex),e.Tools.Error("Fragment shader:"+this.name.fragment)):(e.Tools.Error("Vertex shader:"+this.name),e.Tools.Error("Fragment shader:"+this.name))},t.prototype._processIncludes=function(i,n){for(var r=this,o=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,s=o.exec(i),a=new String(i);null!=s;){var h=s[1];if(!t.IncludesShadersStore[h]){
var l=e.Engine.ShadersRepository+"ShadersInclude/"+h+".fx";return void e.Tools.LoadFile(l,function(e){t.IncludesShadersStore[h]=e,r._processIncludes(a,n)})}var c=t.IncludesShadersStore[h];if(s[2])for(var u=s[3].split(","),d=0;d<u.length;d+=2){var f=new RegExp(u[d],"g"),p=u[d+1];c=c.replace(f,p)}if(s[4]){var _=s[5];if(-1!==_.indexOf("..")){var m=_.split(".."),g=parseInt(m[0]),v=parseInt(m[1]),y=c.slice(0);c="",isNaN(v)&&(v=this._indexParameters[m[1]]);for(var b=g;v>=b;b++)c+=y.replace(/\{X\}/g,b)+"\n"}else c=c.replace(/\{X\}/g,_)}a=a.replace(s[0],c),s=o.exec(i)}n(a)},t.prototype._processPrecision=function(e){return-1===e.indexOf("precision highp float")?e=this._engine.getCaps().highPrecisionShaderSupported?"precision highp float;\n"+e:"precision mediump float;\n"+e:this._engine.getCaps().highPrecisionShaderSupported||(e=e.replace("precision highp float","precision mediump float")),e},t.prototype._prepareEffect=function(t,i,n,r,o){try{var s=this._engine;t=this._processPrecision(t),i=this._processPrecision(i),this._program=s.createShaderProgram(t,i,r),this._uniforms=s.getUniforms(this._program,this._uniformsNames),this._attributes=s.getAttributes(this._program,n);for(var a=0;a<this._samplers.length;a++){var h=this.getUniform(this._samplers[a]);null==h&&(this._samplers.splice(a,1),a--)}s.bindSamplers(this),this._isReady=!0,this.onCompiled&&this.onCompiled(this)}catch(s){if(-1!==s.message.indexOf("highp"))return t=t.replace("precision highp float","precision mediump float"),i=i.replace("precision highp float","precision mediump float"),void this._prepareEffect(t,i,n,r,o);o&&o.isMoreFallbacks?(e.Tools.Error("Unable to compile effect with current defines. Trying next fallback."),this._dumpShadersName(),r=o.reduce(r),this._prepareEffect(t,i,n,r,o)):(e.Tools.Error("Unable to compile effect: "),this._dumpShadersName(),e.Tools.Error("Defines: "+r),e.Tools.Error("Error: "+s.message),this._compilationError=s.message,this.onError&&this.onError(this,this._compilationError))}},Object.defineProperty(t.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),t.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers.indexOf(e),t)},t.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers.indexOf(e),t)},t.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers.indexOf(e),t)},t.prototype._cacheMatrix=function(t,i){this._valueCache[t]||(this._valueCache[t]=new e.Matrix);for(var n=0;16>n;n++)this._valueCache[t].m[n]=i.m[n]},t.prototype._cacheFloat2=function(e,t,i){return this._valueCache[e]?(this._valueCache[e][0]=t,void(this._valueCache[e][1]=i)):void(this._valueCache[e]=[t,i])},t.prototype._cacheFloat3=function(e,t,i,n){return this._valueCache[e]?(this._valueCache[e][0]=t,this._valueCache[e][1]=i,void(this._valueCache[e][2]=n)):void(this._valueCache[e]=[t,i,n])},t.prototype._cacheFloat4=function(e,t,i,n,r){return this._valueCache[e]?(this._valueCache[e][0]=t,this._valueCache[e][1]=i,this._valueCache[e][2]=n,void(this._valueCache[e][3]=r)):void(this._valueCache[e]=[t,i,n,r])},t.prototype.setArray=function(e,t){return this._engine.setArray(this.getUniform(e),t),this},t.prototype.setArray2=function(e,t){return this._engine.setArray2(this.getUniform(e),t),this},t.prototype.setArray3=function(e,t){return this._engine.setArray3(this.getUniform(e),t),this},t.prototype.setArray4=function(e,t){return this._engine.setArray4(this.getUniform(e),t),this},t.prototype.setMatrices=function(e,t){return this._engine.setMatrices(this.getUniform(e),t),this},t.prototype.setMatrix=function(e,t){return this._engine.setMatrix(this.getUniform(e),t),this},t.prototype.setMatrix3x3=function(e,t){return this._engine.setMatrix3x3(this.getUniform(e),t),this},t.prototype.setMatrix2x2=function(e,t){return this._engine.setMatrix2x2(this.getUniform(e),t),this},t.prototype.setFloat=function(e,t){return this._valueCache[e]&&this._valueCache[e]===t?this:(this._valueCache[e]=t,this._engine.setFloat(this.getUniform(e),t),this)},t.prototype.setBool=function(e,t){return this._valueCache[e]&&this._valueCache[e]===t?this:(this._valueCache[e]=t,this._engine.setBool(this.getUniform(e),t?1:0),this)},t.prototype.setVector2=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.x&&this._valueCache[e][1]===t.y?this:(this._cacheFloat2(e,t.x,t.y),this._engine.setFloat2(this.getUniform(e),t.x,t.y),this)},t.prototype.setFloat2=function(e,t,i){return this._valueCache[e]&&this._valueCache[e][0]===t&&this._valueCache[e][1]===i?this:(this._cacheFloat2(e,t,i),this._engine.setFloat2(this.getUniform(e),t,i),this)},t.prototype.setVector3=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.x&&this._valueCache[e][1]===t.y&&this._valueCache[e][2]===t.z?this:(this._cacheFloat3(e,t.x,t.y,t.z),this._engine.setFloat3(this.getUniform(e),t.x,t.y,t.z),this)},t.prototype.setFloat3=function(e,t,i,n){return this._valueCache[e]&&this._valueCache[e][0]===t&&this._valueCache[e][1]===i&&this._valueCache[e][2]===n?this:(this._cacheFloat3(e,t,i,n),this._engine.setFloat3(this.getUniform(e),t,i,n),this)},t.prototype.setVector4=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.x&&this._valueCache[e][1]===t.y&&this._valueCache[e][2]===t.z&&this._valueCache[e][3]===t.w?this:(this._cacheFloat4(e,t.x,t.y,t.z,t.w),this._engine.setFloat4(this.getUniform(e),t.x,t.y,t.z,t.w),this)},t.prototype.setFloat4=function(e,t,i,n,r){return this._valueCache[e]&&this._valueCache[e][0]===t&&this._valueCache[e][1]===i&&this._valueCache[e][2]===n&&this._valueCache[e][3]===r?this:(this._cacheFloat4(e,t,i,n,r),this._engine.setFloat4(this.getUniform(e),t,i,n,r),this)},t.prototype.setColor3=function(e,t){return this._valueCache[e]&&this._valueCache[e][0]===t.r&&this._valueCache[e][1]===t.g&&this._valueCache[e][2]===t.b?this:(this._cacheFloat3(e,t.r,t.g,t.b),this._engine.setColor3(this.getUniform(e),t),this)},t.prototype.setColor4=function(e,t,i){return this._valueCache[e]&&this._valueCache[e][0]===t.r&&this._valueCache[e][1]===t.g&&this._valueCache[e][2]===t.b&&this._valueCache[e][3]===i?this:(this._cacheFloat4(e,t.r,t.g,t.b,i),this._engine.setColor4(this.getUniform(e),t,i),this)},t.ShadersStore={},t.IncludesShadersStore={},t}();e.Effect=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.PrepareDefinesForLights=function(t,i,n,r){void 0===r&&(r=4);for(var o=0,s=!1,a=!1,h=0;h<t.lights.length;h++){var l=t.lights[h];if(l.isEnabled()){if(l._excludedMeshesIds.length>0){for(var c=0;c<l._excludedMeshesIds.length;c++){var u=t.getMeshByID(l._excludedMeshesIds[c]);u&&l.excludedMeshes.push(u)}l._excludedMeshesIds=[]}if(l._includedOnlyMeshesIds.length>0){for(var d=0;d<l._includedOnlyMeshesIds.length;d++){var f=t.getMeshByID(l._includedOnlyMeshesIds[d]);f&&l.includedOnlyMeshes.push(f)}l._includedOnlyMeshesIds=[]}if(l.canAffectMesh(i)){s=!0,void 0===n["LIGHT"+o]&&(a=!0),n["LIGHT"+o]=!0;var p;if(p=l instanceof e.SpotLight?"SPOTLIGHT"+o:l instanceof e.HemisphericLight?"HEMILIGHT"+o:l instanceof e.PointLight?"POINTLIGHT"+o:"DIRLIGHT"+o,void 0===n[p]&&(a=!0),n[p]=!0,l.specular.equalsFloats(0,0,0)||void 0===n.SPECULARTERM||(n.SPECULARTERM=!0),t.shadowsEnabled){var _=l.getShadowGenerator();i&&i.receiveShadows&&_&&(void 0===n["SHADOW"+o]&&(a=!0),n["SHADOW"+o]=!0,n.SHADOWS=!0,(_.useVarianceShadowMap||_.useBlurVarianceShadowMap)&&(void 0===n["SHADOWVSM"+o]&&(a=!0),n["SHADOWVSM"+o]=!0),_.usePoissonSampling&&(void 0===n["SHADOWPCF"+o]&&(a=!0),n["SHADOWPCF"+o]=!0))}if(o++,o===r)break}}}return a&&n.rebuild(),s},t.PrepareUniformsAndSamplersList=function(e,t,i,n){void 0===n&&(n=4);for(var r=0;n>r&&i["LIGHT"+r];r++)e.push("vLightData"+r,"vLightDiffuse"+r,"vLightSpecular"+r,"vLightDirection"+r,"vLightGround"+r,"lightMatrix"+r,"shadowsInfo"+r),t.push("shadowSampler"+r)},t.HandleFallbacksForShadows=function(e,t,i){void 0===i&&(i=4);for(var n=0;i>n&&e["LIGHT"+n];n++)n>0&&t.addFallback(n,"LIGHT"+n),e["SHADOW"+n]&&t.addFallback(0,"SHADOW"+n),e["SHADOWPCF"+n]&&t.addFallback(0,"SHADOWPCF"+n),e["SHADOWVSM"+n]&&t.addFallback(0,"SHADOWVSM"+n)},t.PrepareAttributesForBones=function(t,i,n,r){n.NUM_BONE_INFLUENCERS>0&&(r.addCPUSkinningFallback(0,i),t.push(e.VertexBuffer.MatricesIndicesKind),t.push(e.VertexBuffer.MatricesWeightsKind),n.NUM_BONE_INFLUENCERS>4&&(t.push(e.VertexBuffer.MatricesIndicesExtraKind),t.push(e.VertexBuffer.MatricesWeightsExtraKind)))},t.PrepareAttributesForInstances=function(e,t){t.INSTANCES&&(e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"))},t.BindLightShadow=function(e,t,i,n,r,o){var s=e.getShadowGenerator();return i.receiveShadows&&s&&(e.needCube()?o||(o=!0,r.setFloat2("depthValues",t.activeCamera.minZ,t.activeCamera.maxZ)):r.setMatrix("lightMatrix"+n,s.getTransformMatrix()),r.setTexture("shadowSampler"+n,s.getShadowMapForRendering()),r.setFloat3("shadowsInfo"+n,s.getDarkness(),s.blurScale/s.getShadowMap().getSize().width,s.bias)),o},t.BindLightProperties=function(t,i,n){t instanceof e.PointLight?t.transferToEffect(i,"vLightData"+n):t instanceof e.DirectionalLight?t.transferToEffect(i,"vLightData"+n):t instanceof e.SpotLight?t.transferToEffect(i,"vLightData"+n,"vLightDirection"+n):t instanceof e.HemisphericLight&&t.transferToEffect(i,"vLightData"+n,"vLightGround"+n)},t.BindLights=function(i,n,r,o,s){void 0===s&&(s=4);for(var a=0,h=!1,l=0;l<i.lights.length;l++){var c=i.lights[l];if(c.isEnabled()&&c.canAffectMesh(n)&&(t.BindLightProperties(c,r,a),c.diffuse.scaleToRef(c.intensity,e.Tmp.Color3[0]),r.setColor4("vLightDiffuse"+a,e.Tmp.Color3[0],c.range),o.SPECULARTERM&&(c.specular.scaleToRef(c.intensity,e.Tmp.Color3[1]),r.setColor3("vLightSpecular"+a,e.Tmp.Color3[1])),i.shadowsEnabled&&(h=this.BindLightShadow(c,i,n,a,r,h)),a++,a===s))break}},t.BindFogParameters=function(t,i,n){t.fogEnabled&&i.applyFog&&t.fogMode!==e.Scene.FOGMODE_NONE&&(n.setFloat4("vFogInfos",t.fogMode,t.fogStart,t.fogEnd,t.fogDensity),n.setColor3("vFogColor",t.fogColor))},t.BindBonesParameters=function(e,t){e&&e.useBones&&e.computeBonesUsingShaders&&t.setMatrices("mBones",e.skeleton.getTransformMatrices(e))},t.BindLogDepth=function(e,t,i){e.LOGARITHMICDEPTH&&t.setFloat("logarithmicDepthConstant",2/(Math.log(i.activeCamera.maxZ+1)/Math.LN2))},t.BindClipPlane=function(e,t){if(t.clipPlane){var i=t.clipPlane;e.setFloat4("vClipPlane",i.normal.x,i.normal.y,i.normal.z,i.d)}},t}();e.MaterialHelper=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.isEnabled=!0,this.leftColor=e.Color3.White(),this.rightColor=e.Color3.Black(),this.bias=0,this.power=1}return t.prototype.clone=function(){var i=new t;return e.Tools.DeepCopy(this,i),new t},t.prototype.serialize=function(){var e={};return e.isEnabled=this.isEnabled,e.leftColor=this.leftColor,e.rightColor=this.rightColor,e.bias=this.bias,e.power=this.power,e},t.Parse=function(i){var n=new t;return n.isEnabled=i.isEnabled,n.leftColor=e.Color3.FromArray(i.leftColor),n.rightColor=e.Color3.FromArray(i.rightColor),n.bias=i.bias,n.power=i.power||1,n},t}();e.FresnelParameters=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){}return e.prototype.rebuild=function(){this._keys&&delete this._keys,this._keys=Object.keys(this)},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var i=this._keys[t];if(this[i]!==e[i])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var i=this._keys[t];e[i]=this[i]}},e.prototype.reset=function(){for(var e=0;e<this._keys.length;e++){var t=this._keys[e];"number"==typeof this[t]?this[t]=0:this[t]=!1}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var i=this._keys[t];"number"==typeof this[i]?e+="#define "+i+" "+this[i]+"\n":this[i]&&(e+="#define "+i+"\n")}return e},e}();e.MaterialDefines=t;var i=function(){function t(i,n,r){this.name=i,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this.alpha=1,this.backFaceCulling=!0,this.sideOrientation=t.CounterClockWiseSideOrientation,this.onDisposeObservable=new e.Observable,this.onBindObservable=new e.Observable,this.alphaMode=e.Engine.ALPHA_COMBINE,this.disableDepthWrite=!1,this.fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._wasPreviouslyReady=!1,this._fillMode=t.TriangleFillMode,this.id=i,this._scene=n,r||n.materials.push(this)}return Object.defineProperty(t,"TriangleFillMode",{get:function(){return t._TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WireFrameFillMode",{get:function(){return t._WireFrameFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointFillMode",{get:function(){return t._PointFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ClockWiseSideOrientation",{get:function(){return t._ClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CounterClockWiseSideOrientation",{get:function(){return t._CounterClockWiseSideOrientation},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wireframe",{get:function(){return this._fillMode===t.WireFrameFillMode},set:function(e){this._fillMode=e?t.WireFrameFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pointsCloud",{get:function(){return this._fillMode===t.PointFillMode},set:function(e){this._fillMode=e?t.PointFillMode:t.TriangleFillMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillMode",{get:function(){return this._fillMode},set:function(e){this._fillMode=e},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){var t="Name: "+this.name;return t},Object.defineProperty(t.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!0,configurable:!0}),t.prototype.freeze=function(){this.checkReadyOnlyOnce=!0},t.prototype.unfreeze=function(){this.checkReadyOnlyOnce=!1},t.prototype.isReady=function(e,t){return!0},t.prototype.getEffect=function(){return this._effect},t.prototype.getScene=function(){return this._scene},t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.markDirty=function(){this._wasPreviouslyReady=!1},t.prototype._preBind=function(){var e=this._scene.getEngine();e.enableEffect(this._effect),e.setState(this.backFaceCulling,this.zOffset,!1,this.sideOrientation===t.ClockWiseSideOrientation)},t.prototype.bind=function(e,t){if(this._scene._cachedMaterial=this,this.onBindObservable.notifyObservers(t),this.disableDepthWrite){var i=this._scene.getEngine();this._cachedDepthWriteState=i.getDepthWrite(),i.setDepthWrite(!1)}},t.prototype.bindOnlyWorldMatrix=function(e){},t.prototype.unbind=function(){if(this.disableDepthWrite){var e=this._scene.getEngine();e.setDepthWrite(this._cachedDepthWriteState)}},t.prototype.clone=function(e){return null},t.prototype.getBindedMeshes=function(){for(var e=new Array,t=0;t<this._scene.meshes.length;t++){var i=this._scene.meshes[t];i.material===this&&e.push(i)}return e},t.prototype.dispose=function(e,t){this.getScene().stopAnimation(this);var i=this._scene.materials.indexOf(this);for(i>=0&&this._scene.materials.splice(i,1),e&&this._effect&&(this._scene.getEngine()._releaseEffect(this._effect),this._effect=null),i=0;i<this._scene.meshes.length;i++){var n=this._scene.meshes[i];n.material===this&&(n.material=null)}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBindObservable.clear()},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.ParseMultiMaterial=function(t,i){var n=new e.MultiMaterial(t.name,i);n.id=t.id,e.Tags.AddTagsTo(n,t.tags);for(var r=0;r<t.materials.length;r++){var o=t.materials[r];o?n.subMaterials.push(i.getMaterialByID(o)):n.subMaterials.push(null)}return n},t.Parse=function(t,i,n){if(!t.customType)return e.StandardMaterial.Parse(t,i,n);var r=e.Tools.Instantiate(t.customType);return r.Parse(t,i,n)},t._TriangleFillMode=0,t._WireFrameFillMode=1,t._PointFillMode=2,t._ClockWiseSideOrientation=0,t._CounterClockWiseSideOrientation=1,__decorate([e.serialize()],t.prototype,"id",void 0),__decorate([e.serialize()],t.prototype,"checkReadyOnEveryCall",void 0),__decorate([e.serialize()],t.prototype,"checkReadyOnlyOnce",void 0),__decorate([e.serialize()],t.prototype,"state",void 0),__decorate([e.serialize()],t.prototype,"alpha",void 0),__decorate([e.serialize()],t.prototype,"backFaceCulling",void 0),__decorate([e.serialize()],t.prototype,"sideOrientation",void 0),__decorate([e.serialize()],t.prototype,"alphaMode",void 0),__decorate([e.serialize()],t.prototype,"disableDepthWrite",void 0),__decorate([e.serialize()],t.prototype,"fogEnabled",void 0),__decorate([e.serialize()],t.prototype,"pointSize",void 0),__decorate([e.serialize()],t.prototype,"zOffset",void 0),__decorate([e.serialize()],t.prototype,"wireframe",null),__decorate([e.serialize()],t.prototype,"pointsCloud",null),__decorate([e.serialize()],t.prototype,"fillMode",null),t}();e.Material=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(){e.call(this),this.DIFFUSE=!1,this.AMBIENT=!1,this.OPACITY=!1,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.SPECULAR=!1,this.BUMP=!1,this.PARALLAX=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.ALPHATEST=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.INVERTNORMALMAPX=!1,this.INVERTNORMALMAPY=!1,this.rebuild()}return __extends(t,e),t}(e.MaterialDefines),i=function(i){function n(n,r){var o=this;i.call(this,n,r),this.ambientColor=new e.Color3(0,0,0),this.diffuseColor=new e.Color3(1,1,1),this.specularColor=new e.Color3(1,1,1),this.emissiveColor=new e.Color3(0,0,0),this.specularPower=64,this.useAlphaFromDiffuseTexture=!1,this.useEmissiveAsIllumination=!1,this.linkEmissiveWithDiffuse=!1,this.useReflectionFresnelFromSpecular=!1,this.useSpecularOverAlpha=!1,this.useReflectionOverAlpha=!1,this.disableLighting=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.useLightmapAsShadowmap=!1,this.useGlossinessFromSpecularMapAlpha=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this._renderTargets=new e.SmartArray(16),this._worldViewProjectionMatrix=e.Matrix.Zero(),this._globalAmbientColor=new e.Color3(0,0,0),this._defines=new t,this._cachedDefines=new t,this._cachedDefines.BonesPerMesh=-1,this.getRenderTargetTextures=function(){return o._renderTargets.reset(),o.reflectionTexture&&o.reflectionTexture.isRenderTarget&&o._renderTargets.push(o.reflectionTexture),o.refractionTexture&&o.refractionTexture.isRenderTarget&&o._renderTargets.push(o.refractionTexture),o._renderTargets}}return __extends(n,i),Object.defineProperty(n.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),n.prototype.needAlphaBlending=function(){return this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled},n.prototype.needAlphaTesting=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha},n.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this.diffuseTexture&&this.diffuseTexture.hasAlpha&&this.useAlphaFromDiffuseTexture},n.prototype.getAlphaTestTexture=function(){return this.diffuseTexture},n.prototype._checkCache=function(e,t,i){return!t||this._defines.INSTANCES===i&&!(!t._materialDefines||!t._materialDefines.isEqual(this._defines))},n.prototype.isReady=function(i,r){if(this.isFrozen&&this._wasPreviouslyReady)return!0;var o=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===o.getRenderId()&&this._checkCache(o,i,r))return!0;var s=o.getEngine(),a=!1,h=!1;if(this._defines.reset(),o.texturesEnabled){if(this.diffuseTexture&&n.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;h=!0,this._defines.DIFFUSE=!0}if(this.ambientTexture&&n.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;h=!0,this._defines.AMBIENT=!0}if(this.opacityTexture&&n.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;h=!0,this._defines.OPACITY=!0,this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=!0)}if(this.reflectionTexture&&n.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(a=!0,this._defines.REFLECTION=!0,this.roughness>0&&(this._defines.ROUGHNESS=!0),this.useReflectionOverAlpha&&(this._defines.REFLECTIONOVERALPHA=!0),this.reflectionTexture.coordinatesMode===e.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case e.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case e.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case e.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case e.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case e.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case e.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case e.Texture.FIXED_EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0}}if(this.emissiveTexture&&n.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;h=!0,this._defines.EMISSIVE=!0}if(this.lightmapTexture&&n.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;h=!0,this._defines.LIGHTMAP=!0,this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.specularTexture&&n.SpecularTextureEnabled){if(!this.specularTexture.isReady())return!1;h=!0,this._defines.SPECULAR=!0,this._defines.GLOSSINESS=this.useGlossinessFromSpecularMapAlpha}if(o.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&n.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;h=!0,this._defines.BUMP=!0,this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0)),this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0),this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&n.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;h=!0,this._defines.REFRACTION=!0,this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube}}if(o.clipPlane&&(this._defines.CLIPPLANE=!0),s.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromDiffuseTexture()&&(this._defines.ALPHAFROMDIFFUSE=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithDiffuse&&(this._defines.LINKEMISSIVEWITHDIFFUSE=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),(this.pointsCloud||o.forcePointsCloud)&&(this._defines.POINTSIZE=!0),o.fogEnabled&&i&&i.applyFog&&o.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),o.lightsEnabled&&!this.disableLighting&&(a=e.MaterialHelper.PrepareDefinesForLights(o,i,this._defines,this.maxSimultaneousLights)),n.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled||this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled||this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled)&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._defines.DIFFUSEFRESNEL=!0),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._defines.REFLECTIONFRESNEL=!0,this.useReflectionFresnelFromSpecular&&(this._defines.REFLECTIONFRESNELFROMSPECULAR=!0)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._defines.REFRACTIONFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),a=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),i&&(a&&i.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),h&&(i.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(this._defines.UV1=!0),i.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),i.useVertexColors&&i.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,i.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),i.useBones&&i.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=i.numBoneInfluencers,this._defines.BonesPerMesh=i.skeleton.bones.length+1),r&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines),o.resetCachedMaterial();var l=new e.EffectFallbacks;this._defines.REFLECTION&&l.addFallback(0,"REFLECTION"),this._defines.SPECULAR&&l.addFallback(0,"SPECULAR"),this._defines.BUMP&&l.addFallback(0,"BUMP"),this._defines.PARALLAX&&l.addFallback(1,"PARALLAX"),this._defines.PARALLAXOCCLUSION&&l.addFallback(0,"PARALLAXOCCLUSION"),this._defines.SPECULAROVERALPHA&&l.addFallback(0,"SPECULAROVERALPHA"),this._defines.FOG&&l.addFallback(1,"FOG"),this._defines.POINTSIZE&&l.addFallback(0,"POINTSIZE"),this._defines.LOGARITHMICDEPTH&&l.addFallback(0,"LOGARITHMICDEPTH"),e.MaterialHelper.HandleFallbacksForShadows(this._defines,l,this.maxSimultaneousLights),this._defines.SPECULARTERM&&l.addFallback(0,"SPECULARTERM"),this._defines.DIFFUSEFRESNEL&&l.addFallback(1,"DIFFUSEFRESNEL"),this._defines.OPACITYFRESNEL&&l.addFallback(2,"OPACITYFRESNEL"),this._defines.REFLECTIONFRESNEL&&l.addFallback(3,"REFLECTIONFRESNEL"),this._defines.EMISSIVEFRESNEL&&l.addFallback(4,"EMISSIVEFRESNEL"),this._defines.FRESNEL&&l.addFallback(4,"FRESNEL");var c=[e.VertexBuffer.PositionKind];this._defines.NORMAL&&c.push(e.VertexBuffer.NormalKind),this._defines.UV1&&c.push(e.VertexBuffer.UVKind),this._defines.UV2&&c.push(e.VertexBuffer.UV2Kind),this._defines.VERTEXCOLOR&&c.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(c,i,this._defines,l),e.MaterialHelper.PrepareAttributesForInstances(c,this._defines);var u="default";o.getEngine().getCaps().standardDerivatives||(u="legacydefault");var d=this._defines.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","depthValues","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","logarithmicDepthConstant"],p=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler"];e.MaterialHelper.PrepareUniformsAndSamplersList(f,p,this._defines,this.maxSimultaneousLights),this._effect=o.getEngine().createEffect(u,c,f,p,d,l,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights-1})}return!!this._effect.isReady()&&(this._renderId=o.getRenderId(),this._wasPreviouslyReady=!0,i&&(i._materialDefines||(i._materialDefines=new t),this._defines.cloneTo(i._materialDefines)),!0)},n.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null),this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null),i.prototype.unbind.call(this)},n.prototype.bindOnlyWorldMatrix=function(e){this._effect.setMatrix("world",e)},n.prototype.bind=function(t,r){var o=this.getScene();if(this.bindOnlyWorldMatrix(t),e.MaterialHelper.BindBonesParameters(r,this._effect),o.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",o.getTransformMatrix()),n.FresnelEnabled&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(this._effect.setColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),this._effect.setColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(this._effect.setColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),this._effect.setColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(this._effect.setColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),this._effect.setColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),o.texturesEnabled&&(this.diffuseTexture&&n.DiffuseTextureEnabled&&(this._effect.setTexture("diffuseSampler",this.diffuseTexture),this._effect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._effect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),
this.ambientTexture&&n.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&n.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&n.ReflectionTextureEnabled&&(this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,this.roughness)),this.emissiveTexture&&n.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),this.lightmapTexture&&n.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.specularTexture&&n.SpecularTextureEnabled&&(this._effect.setTexture("specularSampler",this.specularTexture),this._effect.setFloat2("vSpecularInfos",this.specularTexture.coordinatesIndex,this.specularTexture.level),this._effect.setMatrix("specularMatrix",this.specularTexture.getTextureMatrix())),this.bumpTexture&&o.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&n.RefractionTextureEnabled)){var s=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(s=this.refractionTexture.depth)),this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,s,this.invertRefractionY?-1:1)}e.MaterialHelper.BindClipPlane(this._effect,o),this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize),o.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this._effect.setVector3("vEyePosition",o._mirroredCameraPosition?o._mirroredCameraPosition:o.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._defines.SPECULARTERM&&this._effect.setColor4("vSpecularColor",this.specularColor,this.specularPower),this._effect.setColor3("vEmissiveColor",this.emissiveColor)}o.getCachedMaterial()===this&&this.isFrozen||(this._effect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*r.visibility),o.lightsEnabled&&!this.disableLighting&&e.MaterialHelper.BindLights(o,r,this._effect,this._defines,this.maxSimultaneousLights),(o.fogEnabled&&r.applyFog&&o.fogMode!==e.Scene.FOGMODE_NONE||this.reflectionTexture||this.refractionTexture)&&this._effect.setMatrix("view",o.getViewMatrix()),e.MaterialHelper.BindFogParameters(o,r,this._effect),e.MaterialHelper.BindLogDepth(this._defines,this._effect,o)),i.prototype.bind.call(this,t,r)},n.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.ambientTexture&&this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&e.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&e.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&e.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&e.push(this.emissiveTexture),this.specularTexture&&this.specularTexture.animations&&this.specularTexture.animations.length>0&&e.push(this.specularTexture),this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&this.lightmapTexture.animations.length>0&&e.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&this.refractionTexture.animations.length>0&&e.push(this.refractionTexture),e},n.prototype.dispose=function(e,t){t&&(this.diffuseTexture&&this.diffuseTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.specularTexture&&this.specularTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose()),i.prototype.dispose.call(this,e,t)},n.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new n(t,i.getScene())},this)},n.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},n.Parse=function(t,i,r){return e.SerializationHelper.Parse(function(){return new n(t.name,i)},t,i,r)},n.DiffuseTextureEnabled=!0,n.AmbientTextureEnabled=!0,n.OpacityTextureEnabled=!0,n.ReflectionTextureEnabled=!0,n.EmissiveTextureEnabled=!0,n.SpecularTextureEnabled=!0,n.BumpTextureEnabled=!0,n.FresnelEnabled=!0,n.LightmapTextureEnabled=!0,n.RefractionTextureEnabled=!0,__decorate([e.serializeAsTexture()],n.prototype,"diffuseTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"ambientTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"opacityTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"reflectionTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"emissiveTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"specularTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"bumpTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"lightmapTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"refractionTexture",void 0),__decorate([e.serializeAsColor3("ambient")],n.prototype,"ambientColor",void 0),__decorate([e.serializeAsColor3("diffuse")],n.prototype,"diffuseColor",void 0),__decorate([e.serializeAsColor3("specular")],n.prototype,"specularColor",void 0),__decorate([e.serializeAsColor3("emissive")],n.prototype,"emissiveColor",void 0),__decorate([e.serialize()],n.prototype,"specularPower",void 0),__decorate([e.serialize()],n.prototype,"useAlphaFromDiffuseTexture",void 0),__decorate([e.serialize()],n.prototype,"useEmissiveAsIllumination",void 0),__decorate([e.serialize()],n.prototype,"linkEmissiveWithDiffuse",void 0),__decorate([e.serialize()],n.prototype,"useReflectionFresnelFromSpecular",void 0),__decorate([e.serialize()],n.prototype,"useSpecularOverAlpha",void 0),__decorate([e.serialize()],n.prototype,"useReflectionOverAlpha",void 0),__decorate([e.serialize()],n.prototype,"disableLighting",void 0),__decorate([e.serialize()],n.prototype,"useParallax",void 0),__decorate([e.serialize()],n.prototype,"useParallaxOcclusion",void 0),__decorate([e.serialize()],n.prototype,"parallaxScaleBias",void 0),__decorate([e.serialize()],n.prototype,"roughness",void 0),__decorate([e.serialize()],n.prototype,"indexOfRefraction",void 0),__decorate([e.serialize()],n.prototype,"invertRefractionY",void 0),__decorate([e.serialize()],n.prototype,"useLightmapAsShadowmap",void 0),__decorate([e.serializeAsFresnelParameters()],n.prototype,"diffuseFresnelParameters",void 0),__decorate([e.serializeAsFresnelParameters()],n.prototype,"opacityFresnelParameters",void 0),__decorate([e.serializeAsFresnelParameters()],n.prototype,"reflectionFresnelParameters",void 0),__decorate([e.serializeAsFresnelParameters()],n.prototype,"refractionFresnelParameters",void 0),__decorate([e.serializeAsFresnelParameters()],n.prototype,"emissiveFresnelParameters",void 0),__decorate([e.serialize()],n.prototype,"useGlossinessFromSpecularMapAlpha",void 0),__decorate([e.serialize()],n.prototype,"maxSimultaneousLights",void 0),__decorate([e.serialize()],n.prototype,"invertNormalMapX",void 0),__decorate([e.serialize()],n.prototype,"invertNormalMapY",void 0),__decorate([e.serialize()],n.prototype,"useLogarithmicDepth",null),n}(e.Material);e.StandardMaterial=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i){t.call(this,e,i,!0),this.subMaterials=new Array,i.multiMaterials.push(this)}return __extends(i,t),i.prototype.getSubMaterial=function(e){return 0>e||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},i.prototype.isReady=function(e){for(var t=0;t<this.subMaterials.length;t++){var i=this.subMaterials[t];if(i&&!this.subMaterials[t].isReady(e))return!1}return!0},i.prototype.clone=function(e,t){for(var n=new i(e,this.getScene()),r=0;r<this.subMaterials.length;r++){var o=null;o=t?this.subMaterials[r].clone(e+"-"+this.subMaterials[r].name):this.subMaterials[r],n.subMaterials.push(o)}return n},i.prototype.serialize=function(){var t={};t.name=this.name,t.id=this.id,t.tags=e.Tags.GetTags(this),t.materials=[];for(var i=0;i<this.subMaterials.length;i++){var n=this.subMaterials[i];n?t.materials.push(n.id):t.materials.push(null)}return t},i}(e.Material);e.MultiMaterial=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return Object.defineProperty(t,"NO_LOGGING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MINIMAL_LOGGING",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SUMMARY_LOGGING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"DETAILED_LOGGING",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ForceFullSceneLoadingForIncremental",{get:function(){return t._ForceFullSceneLoadingForIncremental},set:function(e){t._ForceFullSceneLoadingForIncremental=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ShowLoadingScreen",{get:function(){return t._ShowLoadingScreen},set:function(e){t._ShowLoadingScreen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"loggingLevel",{get:function(){return t._loggingLevel},set:function(e){t._loggingLevel=e},enumerable:!0,configurable:!0}),t._getPluginForFilename=function(e){var t=e.lastIndexOf("."),i=e.indexOf("?");-1===i&&(i=e.length);for(var n=e.substring(t,i).toLowerCase(),r=0;r<this._registeredPlugins.length;r++){var o=this._registeredPlugins[r];if(-1!==o.extensions.indexOf(n))return o}return this._registeredPlugins[0]},t.GetPluginForExtension=function(e){for(var t=0;t<this._registeredPlugins.length;t++){var i=this._registeredPlugins[t];if(-1!==i.extensions.indexOf(e))return i}return null},t.RegisterPlugin=function(e){e.extensions=e.extensions.toLowerCase(),t._registeredPlugins.push(e)},t.ImportMesh=function(i,n,r,o,s,a,h){if(r.substr&&"/"===r.substr(0,1))return void e.Tools.Error("Wrong sceneFilename parameter");if(r.substr&&"/"===r.substr(0,1))return void e.Tools.Error("Wrong sceneFilename parameter");var l={};o._addPendingData(l);var c=function(c){o.database=u;var d=t._getPluginForFilename(r),f=function(e){var t=[],a=[],c=[];try{if(d.importMesh){var u=d;if(!u.importMesh(i,o,e,n,t,a,c))return h&&h(o,"Unable to import meshes from "+n+r),void o._removePendingData(l);s&&(o.importedMeshesFiles.push(n+r),s(t,a,c),o._removePendingData(l))}else{var f=d;f.importMeshAsync(i,o,e,n,function(e,t,i){s&&(o.importedMeshesFiles.push(n+r),s(e,t,i),o._removePendingData(l))},function(){h&&h(o,"Unable to import meshes from "+n+r),o._removePendingData(l)})}}catch(e){h&&h(o,"Unable to import meshes from "+n+r,e),o._removePendingData(l)}};return r.substr&&"data:"===r.substr(0,5)?void f(r.substr(5)):void e.Tools.LoadFile(n+r,function(e){f(e)},a,u)};if(!o.getEngine().enableOfflineSupport||r.substr&&"data:"===r.substr(0,5))c(!0);else var u=new e.Database(n+r,c)},t.Load=function(i,n,r,o,s,a){t.Append(i,n,new e.Scene(r),o,s,a)},t.Append=function(i,n,r,o,s,a){if(n.substr&&"/"===n.substr(0,1))return void e.Tools.Error("Wrong sceneFilename parameter");var h,l=this._getPluginForFilename(n.name||n),c={};r._addPendingData(c),t.ShowLoadingScreen&&r.getEngine().displayLoadingUI();var u=function(e){if(r.database=h,l.load){var n=l;if(!n.load(r,e,i))return a&&a(r),r._removePendingData(c),void r.getEngine().hideLoadingUI();o&&o(r),r._removePendingData(c)}else{var s=l;s.loadAsync(r,e,i,function(){o&&o(r)},function(){a&&a(r),r._removePendingData(c),r.getEngine().hideLoadingUI()})}t.ShowLoadingScreen&&r.executeWhenReady(function(){r.getEngine().hideLoadingUI()})},d=function(t){e.Tools.LoadFile(i+n,u,s,h)};return n.substr&&"data:"===n.substr(0,5)?void u(n.substr(5)):void(-1===i.indexOf("file:")?r.getEngine().enableOfflineSupport?h=new e.Database(i+n,d):d(!0):e.Tools.ReadFile(n,u,s))},t._ForceFullSceneLoadingForIncremental=!1,t._ShowLoadingScreen=!0,t._loggingLevel=t.NO_LOGGING,t._registeredPlugins=new Array,t}();e.SceneLoader=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(t,i,n,r){for(var o=0,s=i.materials.length;s>o;o++){var a=i.materials[o];if(a.id===t)return e.Material.Parse(a,n,r)}return null},n=function(e,t,i){t=t instanceof Array?t:[t];for(var n in t)if(e.name===t[n])return i.push(e.id),!0;return!(!e.parentId||-1===i.indexOf(e.parentId))&&(i.push(e.id),!0)},r=function(e,t){return e+" of "+(t?t.file+" from "+t.name+" version: "+t.version+", exporter version: "+t.exporter_version:"unknown")};e.SceneLoader.RegisterPlugin({extensions:".babylon",importMesh:function(t,o,s,a,h,l,c){var u="importMesh has failed JSON parse";try{var d=JSON.parse(s);u="";var f,p,_=e.SceneLoader.loggingLevel===e.SceneLoader.DETAILED_LOGGING,m=[],g=[],v=[];for(f=0,p=d.meshes.length;p>f;f++){var y=d.meshes[f];if(!t||n(y,t,v)){if(t instanceof Array&&delete t[t.indexOf(y.name)],y.geometryId&&d.geometries){var b=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(t){!b&&d.geometries[t]&&d.geometries[t]instanceof Array&&d.geometries[t].forEach(function(i){if(i.id===y.geometryId){switch(t){case"boxes":e.Geometry.Primitives.Box.Parse(i,o);break;case"spheres":e.Geometry.Primitives.Sphere.Parse(i,o);break;case"cylinders":e.Geometry.Primitives.Cylinder.Parse(i,o);break;case"toruses":e.Geometry.Primitives.Torus.Parse(i,o);break;case"grounds":e.Geometry.Primitives.Ground.Parse(i,o);break;case"planes":e.Geometry.Primitives.Plane.Parse(i,o);break;case"torusKnots":e.Geometry.Primitives.TorusKnot.Parse(i,o);break;case"vertexData":e.Geometry.Parse(i,o,a)}b=!0}})}),b||e.Tools.Warn("Geometry not found for mesh "+y.id)}if(y.materialId){var x=-1!==g.indexOf(y.materialId);if(!x&&d.multiMaterials)for(var P=0,A=d.multiMaterials.length;A>P;P++){var C=d.multiMaterials[P];if(C.id===y.materialId){for(var E=0,T=C.materials.length;T>E;E++){var S=C.materials[E];g.push(S);var M=i(S,d,o,a);u+="\n\tMaterial "+M.toString(_)}g.push(C.id);var I=e.Material.ParseMultiMaterial(C,o);x=!0,u+="\n\tMulti-Material "+I.toString(_);break}}if(!x){g.push(y.materialId);var M=i(y.materialId,d,o,a);M?u+="\n\tMaterial "+M.toString(_):e.Tools.Warn("Material not found for mesh "+y.id)}}if(y.skeletonId>-1&&o.skeletons){var w=m.indexOf(y.skeletonId)>-1;if(!w)for(var R=0,D=d.skeletons.length;D>R;R++){var O=d.skeletons[R];if(O.id===y.skeletonId){var L=e.Skeleton.Parse(O,o);c.push(L),m.push(O.id),u+="\n\tSkeleton "+L.toString(_)}}}var B=e.Mesh.Parse(y,o,a);h.push(B),u+="\n\tMesh "+B.toString(_)}}var N;for(f=0,p=o.meshes.length;p>f;f++)N=o.meshes[f],N._waitingParentId&&(N.parent=o.getLastEntryByID(N._waitingParentId),N._waitingParentId=void 0);for(f=0,p=o.meshes.length;p>f;f++)N=o.meshes[f],N._waitingFreezeWorldMatrix?(N.freezeWorldMatrix(),N._waitingFreezeWorldMatrix=void 0):N.computeWorldMatrix(!0);if(d.particleSystems)for(f=0,p=d.particleSystems.length;p>f;f++){var F=d.particleSystems[f];-1!==v.indexOf(F.emitterId)&&l.push(e.ParticleSystem.Parse(F,o,a))}return!0}catch(t){throw e.Tools.Log(r("importMesh",d.producer)+u),u=null,t}finally{null!==u&&e.SceneLoader.loggingLevel!==e.SceneLoader.NO_LOGGING&&e.Tools.Log(r("importMesh",d.producer)+(e.SceneLoader.loggingLevel!==e.SceneLoader.MINIMAL_LOGGING?u:""))}},load:function(t,i,n){var o="importScene has failed JSON parse";try{var s=JSON.parse(i);o="";var a=e.SceneLoader.loggingLevel===e.SceneLoader.DETAILED_LOGGING;if(t.useDelayedTextureLoading=s.useDelayedTextureLoading&&!e.SceneLoader.ForceFullSceneLoadingForIncremental,t.autoClear=s.autoClear,t.clearColor=e.Color4.FromArray(s.clearColor),t.ambientColor=e.Color3.FromArray(s.ambientColor),s.gravity&&(t.gravity=e.Vector3.FromArray(s.gravity)),s.fogMode&&0!==s.fogMode)switch(t.fogMode=s.fogMode,t.fogColor=e.Color3.FromArray(s.fogColor),t.fogStart=s.fogStart,t.fogEnd=s.fogEnd,t.fogDensity=s.fogDensity,o+="\tFog mode for scene:  ",t.fogMode){case 1:o+="exp\n";break;case 2:o+="exp2\n";break;case 3:o+="linear\n"}if(s.physicsEnabled){var h;"cannon"===s.physicsEngine?h=new e.CannonJSPlugin:"oimo"===s.physicsEngine&&(h=new e.OimoJSPlugin),o="\tPhysics engine "+(s.physicsEngine?s.physicsEngine:"oimo")+" enabled\n";var l=s.physicsGravity?e.Vector3.FromArray(s.physicsGravity):null;t.enablePhysics(l,h)}void 0!=s.collisionsEnabled&&(t.collisionsEnabled=s.collisionsEnabled),t.workerCollisions=!!s.workerCollisions;var c,u;for(c=0,u=s.lights.length;u>c;c++){var d=s.lights[c],f=e.Light.Parse(d,t);o+=0===c?"\n\tLights:":"",o+="\n\t\t"+f.toString(a)}if(s.animations)for(c=0,u=s.animations.length;u>c;c++){var p=s.animations[c],_=e.Animation.Parse(p);t.animations.push(_),o+=0===c?"\n\tAnimations:":"",o+="\n\t\t"+_.toString(a)}if(s.autoAnimate&&t.beginAnimation(t,s.autoAnimateFrom,s.autoAnimateTo,s.autoAnimateLoop,s.autoAnimateSpeed||1),s.materials)for(c=0,u=s.materials.length;u>c;c++){var m=s.materials[c],g=e.Material.Parse(m,t,n);o+=0===c?"\n\tMaterials:":"",o+="\n\t\t"+g.toString(a)}if(s.multiMaterials)for(c=0,u=s.multiMaterials.length;u>c;c++){var v=s.multiMaterials[c],y=e.Material.ParseMultiMaterial(v,t);o+=0===c?"\n\tMultiMaterials:":"",o+="\n\t\t"+y.toString(a)}if(s.skeletons)for(c=0,u=s.skeletons.length;u>c;c++){var b=s.skeletons[c],x=e.Skeleton.Parse(b,t);o+=0===c?"\n\tSkeletons:":"",o+="\n\t\t"+x.toString(a)}var P=s.geometries;if(P){var A=P.boxes;if(A)for(c=0,u=A.length;u>c;c++){var C=A[c];e.Geometry.Primitives.Box.Parse(C,t)}var E=P.spheres;if(E)for(c=0,u=E.length;u>c;c++){var T=E[c];e.Geometry.Primitives.Sphere.Parse(T,t)}var S=P.cylinders;if(S)for(c=0,u=S.length;u>c;c++){var M=S[c];e.Geometry.Primitives.Cylinder.Parse(M,t)}var I=P.toruses;if(I)for(c=0,u=I.length;u>c;c++){var w=I[c];e.Geometry.Primitives.Torus.Parse(w,t)}var R=P.grounds;if(R)for(c=0,u=R.length;u>c;c++){var D=R[c];e.Geometry.Primitives.Ground.Parse(D,t)}var O=P.planes;if(O)for(c=0,u=O.length;u>c;c++){var L=O[c];e.Geometry.Primitives.Plane.Parse(L,t)}var B=P.torusKnots;if(B)for(c=0,u=B.length;u>c;c++){var N=B[c];e.Geometry.Primitives.TorusKnot.Parse(N,t)}var F=P.vertexData;if(F)for(c=0,u=F.length;u>c;c++){var V=F[c];e.Geometry.Parse(V,t,n)}}for(c=0,u=s.meshes.length;u>c;c++){var k=s.meshes[c],z=e.Mesh.Parse(k,t,n);o+=0===c?"\n\tMeshes:":"",o+="\n\t\t"+z.toString(a)}for(c=0,u=s.cameras.length;u>c;c++){var U=s.cameras[c],G=e.Camera.Parse(U,t);o+=0===c?"\n\tCameras:":"",o+="\n\t\t"+G.toString(a)}for(s.activeCameraID&&t.setActiveCameraByID(s.activeCameraID),c=0,u=t.cameras.length;u>c;c++){var G=t.cameras[c];G._waitingParentId&&(G.parent=t.getLastEntryByID(G._waitingParentId),G._waitingParentId=void 0)}for(c=0,u=t.lights.length;u>c;c++){var f=t.lights[c];f._waitingParentId&&(f.parent=t.getLastEntryByID(f._waitingParentId),f._waitingParentId=void 0)}var j,W=[];if(e.AudioEngine&&s.sounds)for(c=0,u=s.sounds.length;u>c;c++){var H=s.sounds[c];e.Engine.audioEngine.canUseWebAudio?(H.url||(H.url=H.name),W[H.url]?e.Sound.Parse(H,t,n,W[H.url]):(j=e.Sound.Parse(H,t,n),W[H.url]=j)):new e.Sound(H.name,null,t)}for(W=[],c=0,u=t.meshes.length;u>c;c++){var z=t.meshes[c];z._waitingParentId&&(z.parent=t.getLastEntryByID(z._waitingParentId),z._waitingParentId=void 0),z._waitingActions&&(e.ActionManager.Parse(z._waitingActions,z,t),z._waitingActions=void 0)}for(c=0,u=t.meshes.length;u>c;c++){var Y=t.meshes[c];Y._waitingFreezeWorldMatrix?(Y.freezeWorldMatrix(),Y._waitingFreezeWorldMatrix=void 0):Y.computeWorldMatrix(!0)}if(s.particleSystems)for(c=0,u=s.particleSystems.length;u>c;c++){var K=s.particleSystems[c];e.ParticleSystem.Parse(K,t,n)}if(s.lensFlareSystems)for(c=0,u=s.lensFlareSystems.length;u>c;c++){var X=s.lensFlareSystems[c];e.LensFlareSystem.Parse(X,t,n)}if(s.shadowGenerators)for(c=0,u=s.shadowGenerators.length;u>c;c++){var q=s.shadowGenerators[c];e.ShadowGenerator.Parse(q,t)}return s.actions&&e.ActionManager.Parse(s.actions,null,t),!0}catch(t){throw e.Tools.Log(r("importScene",s.producer)+o),o=null,t}finally{null!==o&&e.SceneLoader.loggingLevel!==e.SceneLoader.NO_LOGGING&&e.Tools.Log(r("importScene",s.producer)+(e.SceneLoader.loggingLevel!==e.SceneLoader.MINIMAL_LOGGING?o:""))}}})}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o,s,a){void 0===a&&(a=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.cellSize=r,this.sprites=new Array,this.renderingGroupId=0,this.layerMask=268435455,this.fogEnabled=!0,this.isPickable=!1,this.onDisposeObservable=new e.Observable,this._vertexBuffers={},this._capacity=n,this._spriteTexture=new e.Texture(i,o,!0,!1,a),this._spriteTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._spriteTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._epsilon=void 0===s?.01:s,this._scene=o,this._scene.spriteManagers.push(this);for(var h=[],l=0,c=0;n>c;c++)h.push(l),h.push(l+1),h.push(l+2),h.push(l),h.push(l+2),h.push(l+3),l+=4;this._indexBuffer=o.getEngine().createIndexBuffer(h),this._vertexData=new Float32Array(16*n*4),this._buffer=new e.Buffer(o.getEngine(),this._vertexData,!0,16);var u=this._buffer.createVertexBuffer(e.VertexBuffer.PositionKind,0,4),d=this._buffer.createVertexBuffer("options",4,4),f=this._buffer.createVertexBuffer("cellInfo",8,4),p=this._buffer.createVertexBuffer(e.VertexBuffer.ColorKind,12,4);this._vertexBuffers[e.VertexBuffer.PositionKind]=u,this._vertexBuffers.options=d,this._vertexBuffers.cellInfo=f,this._vertexBuffers[e.VertexBuffer.ColorKind]=p,this._effectBase=this._scene.getEngine().createEffect("sprites",[e.VertexBuffer.PositionKind,"options","cellInfo",e.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest"],["diffuseSampler"],""),this._effectFog=this._scene.getEngine().createEffect("sprites",[e.VertexBuffer.PositionKind,"options","cellInfo",e.VertexBuffer.ColorKind],["view","projection","textureInfos","alphaTest","vFogInfos","vFogColor"],["diffuseSampler"],"#define FOG")}return Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._spriteTexture},set:function(e){this._spriteTexture=e},enumerable:!0,configurable:!0}),t.prototype._appendSpriteVertex=function(e,t,i,n,r){var o=16*e;0===i?i=this._epsilon:1===i&&(i=1-this._epsilon),0===n?n=this._epsilon:1===n&&(n=1-this._epsilon),this._vertexData[o]=t.position.x,this._vertexData[o+1]=t.position.y,this._vertexData[o+2]=t.position.z,this._vertexData[o+3]=t.angle,this._vertexData[o+4]=t.width,this._vertexData[o+5]=t.height,this._vertexData[o+6]=i,this._vertexData[o+7]=n,this._vertexData[o+8]=t.invertU?1:0,this._vertexData[o+9]=t.invertV?1:0;var s=t.cellIndex/r>>0;this._vertexData[o+10]=t.cellIndex-s*r,this._vertexData[o+11]=s,this._vertexData[o+12]=t.color.r,this._vertexData[o+13]=t.color.g,this._vertexData[o+14]=t.color.b,this._vertexData[o+15]=t.color.a},t.prototype.intersects=function(t,i,n,r){for(var o,s=Math.min(this._capacity,this.sprites.length),a=e.Vector3.Zero(),h=e.Vector3.Zero(),l=Number.MAX_VALUE,c=e.Vector3.Zero(),u=i.getViewMatrix(),d=0;s>d;d++){var f=this.sprites[d];if(f){if(n){if(!n(f))continue}else if(!f.isPickable)continue;if(e.Vector3.TransformCoordinatesToRef(f.position,u,c),a.copyFromFloats(c.x-f.width/2,c.y-f.height/2,c.z),h.copyFromFloats(c.x+f.width/2,c.y+f.height/2,c.z),t.intersectsBoxMinMax(a,h)){var p=e.Vector3.Distance(c,t.origin);if(l>p&&(l=p,o=f,r))break}}}if(o){var _=new e.PickingInfo;return _.hit=!0,_.pickedSprite=o,_.distance=l,_}return null},t.prototype.render=function(){if(this._effectBase.isReady()&&this._effectFog.isReady()&&this._spriteTexture&&this._spriteTexture.isReady()){for(var t=this._scene.getEngine(),i=this._spriteTexture.getBaseSize(),n=t.getDeltaTime(),r=Math.min(this._capacity,this.sprites.length),o=i.width/this.cellSize,s=0,a=0;r>a;a++){var h=this.sprites[a];h&&(h._animate(n),this._appendSpriteVertex(s++,h,0,0,o),this._appendSpriteVertex(s++,h,1,0,o),this._appendSpriteVertex(s++,h,1,1,o),this._appendSpriteVertex(s++,h,0,1,o))}this._buffer.update(this._vertexData);var l=this._effectBase;this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(l=this._effectFog),t.enableEffect(l);var c=this._scene.getViewMatrix();l.setTexture("diffuseSampler",this._spriteTexture),l.setMatrix("view",c),l.setMatrix("projection",this._scene.getProjectionMatrix()),l.setFloat2("textureInfos",this.cellSize/i.width,this.cellSize/i.height),this._scene.fogEnabled&&this._scene.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(l.setFloat4("vFogInfos",this._scene.fogMode,this._scene.fogStart,this._scene.fogEnd,this._scene.fogDensity),l.setColor3("vFogColor",this._scene.fogColor)),t.bindBuffers(this._vertexBuffers,this._indexBuffer,l),t.setDepthFunctionToLessOrEqual(),l.setBool("alphaTest",!0),t.setColorWrite(!1),t.draw(!0,0,6*r),t.setColorWrite(!0),l.setBool("alphaTest",!1),t.setAlphaMode(e.Engine.ALPHA_COMBINE),t.draw(!0,0,6*r),t.setAlphaMode(e.Engine.ALPHA_DISABLE)}},t.prototype.dispose=function(){this._buffer&&(this._buffer.dispose(),this._buffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._spriteTexture&&(this._spriteTexture.dispose(),this._spriteTexture=null);var e=this._scene.spriteManagers.indexOf(this);this._scene.spriteManagers.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},t}();e.SpriteManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){this.name=t,this.color=new e.Color4(1,1,1,1),this.width=1,this.height=1,this.angle=0,this.cellIndex=0,this.invertU=0,this.invertV=0,this.animations=new Array,this.isPickable=!1,this._animationStarted=!1,this._loopAnimation=!1,this._fromIndex=0,this._toIndex=0,this._delay=0,this._direction=1,this._frameCount=0,this._time=0,this._manager=i,this._manager.sprites.push(this),this.position=e.Vector3.Zero()}return Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e,this.height=e},enumerable:!0,configurable:!0}),t.prototype.playAnimation=function(e,t,i,n){this._fromIndex=e,this._toIndex=t,this._loopAnimation=i,this._delay=n,this._animationStarted=!0,this._direction=t>e?1:-1,this.cellIndex=e,this._time=0},t.prototype.stopAnimation=function(){this._animationStarted=!1},t.prototype._animate=function(e){this._animationStarted&&(this._time+=e,this._time>this._delay&&(this._time=this._time%this._delay,this.cellIndex+=this._direction,this.cellIndex==this._toIndex&&(this._loopAnimation?this.cellIndex=this._fromIndex:(this._animationStarted=!1,this.disposeWhenFinishedAnimating&&this.dispose()))))},t.prototype.dispose=function(){for(var e=0;e<this._manager.sprites.length;e++)this._manager.sprites[e]==this&&this._manager.sprites.splice(e,1)},t}();e.Sprite=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o){this.name=t,this.scale=new e.Vector2(1,1),this.offset=new e.Vector2(0,0),this.alphaBlendingMode=e.Engine.ALPHA_COMBINE,this._vertexBuffers={},this.onDisposeObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,this.texture=i?new e.Texture(i,n,!0):null,this.isBackground=void 0===r||r,this.color=void 0===o?new e.Color4(1,1,1,1):o,this._scene=n,this._scene.layers.push(this);var s=n.getEngine(),a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1);var h=new e.VertexBuffer(s,a,e.VertexBuffer.PositionKind,!1,!1,2);this._vertexBuffers[e.VertexBuffer.PositionKind]=h;var l=[];l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),this._indexBuffer=s.createIndexBuffer(l),this._effect=s.createEffect("layer",[e.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],""),this._alphaTestEffect=s.createEffect("layer",[e.VertexBuffer.PositionKind],["textureMatrix","color","scale","offset"],["textureSampler"],"#define ALPHATEST")}return Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype.render=function(){var t=this.alphaTest?this._alphaTestEffect:this._effect;if(t.isReady()&&this.texture&&this.texture.isReady()){var i=this._scene.getEngine();this.onBeforeRenderObservable.notifyObservers(this),i.enableEffect(t),i.setState(!1),t.setTexture("textureSampler",this.texture),t.setMatrix("textureMatrix",this.texture.getTextureMatrix()),t.setFloat4("color",this.color.r,this.color.g,this.color.b,this.color.a),t.setVector2("offset",this.offset),t.setVector2("scale",this.scale),i.bindBuffers(this._vertexBuffers,this._indexBuffer,t),this._alphaTestEffect?i.draw(!0,0,6):(i.setAlphaMode(this.alphaBlendingMode),i.draw(!0,0,6),i.setAlphaMode(e.Engine.ALPHA_DISABLE)),this.onAfterRenderObservable.notifyObservers(this)}},t.prototype.dispose=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.texture&&(this.texture.dispose(),this.texture=null);var i=this._scene.layers.indexOf(this);this._scene.layers.splice(i,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderObservable.clear()},t}();e.Layer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.position=e.Vector3.Zero(),this.direction=e.Vector3.Zero(),this.color=new e.Color4(0,0,0,0),this.colorStep=new e.Color4(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,
this.angle=0,this.angularSpeed=0}return t.prototype.copyTo=function(e){e.position.copyFrom(this.position),e.direction.copyFrom(this.direction),e.color.copyFrom(this.color),e.colorStep.copyFrom(this.colorStep),e.lifeTime=this.lifeTime,e.age=this.age,e.size=this.size,e.angle=this.angle,e.angularSpeed=this.angularSpeed},t}();e.Particle=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e,t){if(e===t)return e;var i=Math.random();return i*(t-e)+e},i=function(){function i(n,r,o,s){var a=this;this.name=n,this.animations=[],this.renderingGroupId=0,this.emitter=null,this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.onDisposeObservable=new e.Observable,this.blendMode=i.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.gravity=e.Vector3.Zero(),this.direction1=new e.Vector3(0,1,0),this.direction2=new e.Vector3(0,1,0),this.minEmitBox=new e.Vector3(-.5,-.5,-.5),this.maxEmitBox=new e.Vector3(.5,.5,.5),this.color1=new e.Color4(1,1,1,1),this.color2=new e.Color4(1,1,1,1),this.colorDead=new e.Color4(0,0,0,1),this.textureMask=new e.Color4(1,1,1,1),this.particles=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new e.Color4(0,0,0,0),this._colorDiff=new e.Color4(0,0,0,0),this._scaledDirection=e.Vector3.Zero(),this._scaledGravity=e.Vector3.Zero(),this._currentRenderId=-1,this._started=!1,this._stopped=!1,this._actualFrame=0,this.id=n,this._capacity=r,this._scene=o,this._customEffect=s,o.particleSystems.push(this);for(var h=[],l=0,c=0;r>c;c++)h.push(l),h.push(l+1),h.push(l+2),h.push(l),h.push(l+2),h.push(l+3),l+=4;this._indexBuffer=o.getEngine().createIndexBuffer(h),this._vertexData=new Float32Array(11*r*4),this._vertexBuffer=new e.Buffer(o.getEngine(),this._vertexData,!0,11);var u=this._vertexBuffer.createVertexBuffer(e.VertexBuffer.PositionKind,0,3),d=this._vertexBuffer.createVertexBuffer(e.VertexBuffer.ColorKind,3,4),f=this._vertexBuffer.createVertexBuffer("options",7,4);this._vertexBuffers[e.VertexBuffer.PositionKind]=u,this._vertexBuffers[e.VertexBuffer.ColorKind]=d,this._vertexBuffers.options=f,this.startDirectionFunction=function(i,n,r,o){var s=t(a.direction1.x,a.direction2.x),h=t(a.direction1.y,a.direction2.y),l=t(a.direction1.z,a.direction2.z);e.Vector3.TransformNormalFromFloatsToRef(s*i,h*i,l*i,n,r)},this.startPositionFunction=function(i,n,r){var o=t(a.minEmitBox.x,a.maxEmitBox.x),s=t(a.minEmitBox.y,a.maxEmitBox.y),h=t(a.minEmitBox.z,a.maxEmitBox.z);e.Vector3.TransformCoordinatesFromFloatsToRef(o,s,h,i,n)},this.updateFunction=function(e){for(var t=0;t<e.length;t++){var i=e[t];i.age+=a._scaledUpdateSpeed,i.age>=i.lifeTime?(a.recycleParticle(i),t--):(i.colorStep.scaleToRef(a._scaledUpdateSpeed,a._scaledColorStep),i.color.addInPlace(a._scaledColorStep),i.color.a<0&&(i.color.a=0),i.angle+=i.angularSpeed*a._scaledUpdateSpeed,i.direction.scaleToRef(a._scaledUpdateSpeed,a._scaledDirection),i.position.addInPlace(a._scaledDirection),a.gravity.scaleToRef(a._scaledUpdateSpeed,a._scaledGravity),i.direction.addInPlace(a._scaledGravity))}}}return Object.defineProperty(i.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),i.prototype.recycleParticle=function(e){var t=this.particles.pop();t!==e&&(t.copyTo(e),this._stockParticles.push(t))},i.prototype.getCapacity=function(){return this._capacity},i.prototype.isAlive=function(){return this._alive},i.prototype.isStarted=function(){return this._started},i.prototype.start=function(){this._started=!0,this._stopped=!1,this._actualFrame=0},i.prototype.stop=function(){this._stopped=!0},i.prototype._appendParticleVertex=function(e,t,i,n){var r=11*e;this._vertexData[r]=t.position.x,this._vertexData[r+1]=t.position.y,this._vertexData[r+2]=t.position.z,this._vertexData[r+3]=t.color.r,this._vertexData[r+4]=t.color.g,this._vertexData[r+5]=t.color.b,this._vertexData[r+6]=t.color.a,this._vertexData[r+7]=t.angle,this._vertexData[r+8]=t.size,this._vertexData[r+9]=i,this._vertexData[r+10]=n},i.prototype._update=function(i){this._alive=this.particles.length>0,this.updateFunction(this.particles);var n;n=this.emitter.position?this.emitter.getWorldMatrix():e.Matrix.Translation(this.emitter.x,this.emitter.y,this.emitter.z);for(var r,o=0;i>o&&this.particles.length!==this._capacity;o++){0!==this._stockParticles.length?(r=this._stockParticles.pop(),r.age=0):r=new e.Particle,this.particles.push(r);var s=t(this.minEmitPower,this.maxEmitPower);this.startDirectionFunction(s,n,r.direction,r),r.lifeTime=t(this.minLifeTime,this.maxLifeTime),r.size=t(this.minSize,this.maxSize),r.angularSpeed=t(this.minAngularSpeed,this.maxAngularSpeed),this.startPositionFunction(n,r.position,r);var a=t(0,1);e.Color4.LerpToRef(this.color1,this.color2,a,r.color),this.colorDead.subtractToRef(r.color,this._colorDiff),this._colorDiff.scaleToRef(1/r.lifeTime,r.colorStep)}},i.prototype._getEffect=function(){if(this._customEffect)return this._customEffect;var t=[];this._scene.clipPlane&&t.push("#define CLIPPLANE");var i=t.join("\n");return this._cachedDefines!==i&&(this._cachedDefines=i,this._effect=this._scene.getEngine().createEffect("particles",[e.VertexBuffer.PositionKind,e.VertexBuffer.ColorKind,"options"],["invView","view","projection","vClipPlane","textureMask"],["diffuseSampler"],i)),this._effect},i.prototype.animate=function(){if(this._started){var e=this._getEffect();if(this.emitter&&e.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this._currentRenderId!==this._scene.getRenderId()){this._currentRenderId=this._scene.getRenderId(),this._scaledUpdateSpeed=this.updateSpeed*this._scene.getAnimationRatio();var t;this.manualEmitCount>-1?(t=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0):(t=this.emitRate*this._scaledUpdateSpeed>>0,this._newPartsExcess+=this.emitRate*this._scaledUpdateSpeed-t),this._newPartsExcess>1&&(t+=this._newPartsExcess>>0,this._newPartsExcess-=this._newPartsExcess>>0),this._alive=!1,this._stopped?t=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(t),this._stopped&&(this._alive||(this._started=!1,this.disposeOnStop&&this._scene._toBeDisposed.push(this)));for(var i=0,n=0;n<this.particles.length;n++){var r=this.particles[n];this._appendParticleVertex(i++,r,0,0),this._appendParticleVertex(i++,r,1,0),this._appendParticleVertex(i++,r,1,1),this._appendParticleVertex(i++,r,0,1)}this._vertexBuffer.update(this._vertexData)}}},i.prototype.render=function(){var t=this._getEffect();if(!(this.emitter&&t.isReady()&&this.particleTexture&&this.particleTexture.isReady()&&this.particles.length))return 0;var n=this._scene.getEngine();n.enableEffect(t),n.setState(!1);var r=this._scene.getViewMatrix();if(t.setTexture("diffuseSampler",this.particleTexture),t.setMatrix("view",r),t.setMatrix("projection",this._scene.getProjectionMatrix()),t.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._scene.clipPlane){var o=this._scene.clipPlane,s=r.clone();s.invert(),t.setMatrix("invView",s),t.setFloat4("vClipPlane",o.normal.x,o.normal.y,o.normal.z,o.d)}return n.bindBuffers(this._vertexBuffers,this._indexBuffer,t),this.blendMode===i.BLENDMODE_ONEONE?n.setAlphaMode(e.Engine.ALPHA_ONEONE):n.setAlphaMode(e.Engine.ALPHA_COMBINE),this.forceDepthWrite&&n.setDepthWrite(!0),n.draw(!0,0,6*this.particles.length),n.setAlphaMode(e.Engine.ALPHA_DISABLE),this.particles.length},i.prototype.dispose=function(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null);var e=this._scene.particleSystems.indexOf(this);this._scene.particleSystems.splice(e,1),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},i.prototype.clone=function(t,n){var r=new i(t,this._capacity,this._scene);return e.Tools.DeepCopy(this,r,["particles"]),void 0===n&&(n=this.emitter),r.emitter=n,this.particleTexture&&(r.particleTexture=new e.Texture(this.particleTexture.url,this._scene)),r.start(),r},i.prototype.serialize=function(){var t={};return t.name=this.name,t.id=this.id,this.emitter.position?t.emitterId=this.emitter.id:t.emitter=this.emitter.asArray(),t.capacity=this.getCapacity(),this.particleTexture&&(t.textureName=this.particleTexture.name),e.Animation.AppendSerializedAnimations(this,t),t.minAngularSpeed=this.minAngularSpeed,t.maxAngularSpeed=this.maxAngularSpeed,t.minSize=this.minSize,t.maxSize=this.maxSize,t.minEmitPower=this.minEmitPower,t.maxEmitPower=this.maxEmitPower,t.minLifeTime=this.minLifeTime,t.maxLifeTime=this.maxLifeTime,t.emitRate=this.emitRate,t.minEmitBox=this.minEmitBox.asArray(),t.maxEmitBox=this.maxEmitBox.asArray(),t.gravity=this.gravity.asArray(),t.direction1=this.direction1.asArray(),t.direction2=this.direction2.asArray(),t.color1=this.color1.asArray(),t.color2=this.color2.asArray(),t.colorDead=this.colorDead.asArray(),t.updateSpeed=this.updateSpeed,t.targetStopDuration=this.targetStopDuration,t.textureMask=this.textureMask.asArray(),t.blendMode=this.blendMode,t},i.Parse=function(t,n,r){var o=t.name,s=new i(o,t.capacity,n);if(t.id&&(s.id=t.id),t.textureName&&(s.particleTexture=new e.Texture(r+t.textureName,n),s.particleTexture.name=t.textureName),t.emitterId?s.emitter=n.getLastMeshByID(t.emitterId):s.emitter=e.Vector3.FromArray(t.emitter),t.animations)for(var a=0;a<t.animations.length;a++){var h=t.animations[a];s.animations.push(e.Animation.Parse(h))}return t.autoAnimate&&n.beginAnimation(s,t.autoAnimateFrom,t.autoAnimateTo,t.autoAnimateLoop,t.autoAnimateSpeed||1),s.minAngularSpeed=t.minAngularSpeed,s.maxAngularSpeed=t.maxAngularSpeed,s.minSize=t.minSize,s.maxSize=t.maxSize,s.minLifeTime=t.minLifeTime,s.maxLifeTime=t.maxLifeTime,s.minEmitPower=t.minEmitPower,s.maxEmitPower=t.maxEmitPower,s.emitRate=t.emitRate,s.minEmitBox=e.Vector3.FromArray(t.minEmitBox),s.maxEmitBox=e.Vector3.FromArray(t.maxEmitBox),s.gravity=e.Vector3.FromArray(t.gravity),s.direction1=e.Vector3.FromArray(t.direction1),s.direction2=e.Vector3.FromArray(t.direction2),s.color1=e.Color4.FromArray(t.color1),s.color2=e.Color4.FromArray(t.color2),s.colorDead=e.Color4.FromArray(t.colorDead),s.updateSpeed=t.updateSpeed,s.targetStopDuration=t.targetStopDuration,s.textureMask=e.Color4.FromArray(t.textureMask),s.blendMode=t.blendMode,t.preventAutoStart||s.start(),s},i.BLENDMODE_ONEONE=0,i.BLENDMODE_STANDARD=1,i}();e.ParticleSystem=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.name=e,this.from=t,this.to=i}return e.prototype.clone=function(){return new e(this.name,this.from,this.to)},e}();e.AnimationRange=t;var i=function(){function e(e,t,i){this.frame=e,this.action=t,this.onlyOnce=i,this.isDone=!1}return e}();e.AnimationEvent=i;var n=function(){function t(e){this.path=e,this._onchange=new Array,this.value=0,this.animations=new Array}return t.prototype.getPoint=function(){var t=this.path.getPointAtLengthPosition(this.value);return new e.Vector3(t.x,0,t.y)},t.prototype.moveAhead=function(e){return void 0===e&&(e=.002),this.move(e),this},t.prototype.moveBack=function(e){return void 0===e&&(e=.002),this.move(-e),this},t.prototype.move=function(e){if(Math.abs(e)>1)throw"step size should be less than 1.";return this.value+=e,this.ensureLimits(),this.raiseOnChange(),this},t.prototype.ensureLimits=function(){for(;this.value>1;)this.value-=1;for(;this.value<0;)this.value+=1;return this},t.prototype.markAsDirty=function(e){return this.ensureLimits(),this.raiseOnChange(),this},t.prototype.raiseOnChange=function(){var e=this;return this._onchange.forEach(function(t){return t(e)}),this},t.prototype.onchange=function(e){return this._onchange.push(e),this},t}();e.PathCursor=n;var r=function(){function i(e,t,n,r,o,s){this.name=e,this.targetProperty=t,this.framePerSecond=n,this.dataType=r,this.loopMode=o,this.enableBlending=s,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._events=new Array,this.allowMatricesInterpolation=!1,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=r,this.loopMode=void 0===o?i.ANIMATIONLOOPMODE_CYCLE:o}return i._PrepareAnimation=function(t,n,r,o,s,a,h,l){var c=void 0;if(!isNaN(parseFloat(s))&&isFinite(s)?c=i.ANIMATIONTYPE_FLOAT:s instanceof e.Quaternion?c=i.ANIMATIONTYPE_QUATERNION:s instanceof e.Vector3?c=i.ANIMATIONTYPE_VECTOR3:s instanceof e.Vector2?c=i.ANIMATIONTYPE_VECTOR2:s instanceof e.Color3?c=i.ANIMATIONTYPE_COLOR3:s instanceof e.Size&&(c=i.ANIMATIONTYPE_SIZE),void 0==c)return null;var u=new i(t,n,r,c,h),d=[];return d.push({frame:0,value:s}),d.push({frame:o,value:a}),u.setKeys(d),void 0!==l&&u.setEasingFunction(l),u},i.CreateAndStartAnimation=function(e,t,n,r,o,s,a,h,l,c){var u=i._PrepareAnimation(e,n,r,o,s,a,h,l);return t.getScene().beginDirectAnimation(t,[u],0,o,1===u.loopMode,1,c)},i.CreateMergeAndStartAnimation=function(e,t,n,r,o,s,a,h,l,c){var u=i._PrepareAnimation(e,n,r,o,s,a,h,l);return t.animations.push(u),t.getScene().beginAnimation(t,0,o,1===u.loopMode,1,c)},i.prototype.toString=function(e){var t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var n in this._ranges)i&&(t+=", ",i=!1),t+=n;t+="}"}return t},i.prototype.addEvent=function(e){this._events.push(e)},i.prototype.removeEvents=function(e){for(var t=0;t<this._events.length;t++)this._events[t].frame===e&&(this._events.splice(t,1),t--)},i.prototype.createRange=function(e,i,n){this._ranges[e]||(this._ranges[e]=new t(e,i,n))},i.prototype.deleteRange=function(e,t){if(void 0===t&&(t=!0),this._ranges[e]){if(t)for(var i=this._ranges[e].from,n=this._ranges[e].to,r=this._keys.length-1;r>=0;r--)this._keys[r].frame>=i&&this._keys[r].frame<=n&&this._keys.splice(r,1);this._ranges[e]=void 0}},i.prototype.getRange=function(e){return this._ranges[e]},i.prototype.reset=function(){this._offsetsCache={},this._highLimitsCache={},this.currentFrame=0,this._blendingFactor=0,this._originalBlendValue=null},i.prototype.isStopped=function(){return this._stopped},i.prototype.getKeys=function(){return this._keys},i.prototype.getHighestFrame=function(){for(var e=0,t=0,i=this._keys.length;i>t;t++)e<this._keys[t].frame&&(e=this._keys[t].frame);return e},i.prototype.getEasingFunction=function(){return this._easingFunction},i.prototype.setEasingFunction=function(e){this._easingFunction=e},i.prototype.floatInterpolateFunction=function(e,t,i){return e+(t-e)*i},i.prototype.quaternionInterpolateFunction=function(t,i,n){return e.Quaternion.Slerp(t,i,n)},i.prototype.vector3InterpolateFunction=function(t,i,n){return e.Vector3.Lerp(t,i,n)},i.prototype.vector2InterpolateFunction=function(t,i,n){return e.Vector2.Lerp(t,i,n)},i.prototype.sizeInterpolateFunction=function(t,i,n){return e.Size.Lerp(t,i,n)},i.prototype.color3InterpolateFunction=function(t,i,n){return e.Color3.Lerp(t,i,n)},i.prototype.matrixInterpolateFunction=function(t,i,n){return e.Matrix.Lerp(t,i,n)},i.prototype.clone=function(){var e=new i(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(var t in this._ranges)e._ranges[t]=this._ranges[t].clone()}return e},i.prototype.setKeys=function(e){this._keys=e.slice(0),this._offsetsCache={},this._highLimitsCache={}},i.prototype._getKeyValue=function(e){return"function"==typeof e?e():e},i.prototype._interpolate=function(e,t,n,r,o){if(n===i.ANIMATIONLOOPMODE_CONSTANT&&t>0)return o.clone?o.clone():o;this.currentFrame=e;var s=Math.max(0,Math.min(this._keys.length-1,Math.floor(this._keys.length*(e-this._keys[0].frame)/(this._keys[this._keys.length-1].frame-this._keys[0].frame))-1));if(this._keys[s].frame>=e)for(;s-1>=0&&this._keys[s].frame>=e;)s--;for(var a=s;a<this._keys.length;a++)if(this._keys[a+1].frame>=e){var h=this._getKeyValue(this._keys[a].value),l=this._getKeyValue(this._keys[a+1].value),c=(e-this._keys[a].frame)/(this._keys[a+1].frame-this._keys[a].frame);switch(null!=this._easingFunction&&(c=this._easingFunction.ease(c)),this.dataType){case i.ANIMATIONTYPE_FLOAT:switch(n){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.floatInterpolateFunction(h,l,c);case i.ANIMATIONLOOPMODE_RELATIVE:return r*t+this.floatInterpolateFunction(h,l,c)}break;case i.ANIMATIONTYPE_QUATERNION:var u=null;switch(n){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:u=this.quaternionInterpolateFunction(h,l,c);break;case i.ANIMATIONLOOPMODE_RELATIVE:u=this.quaternionInterpolateFunction(h,l,c).add(r.scale(t))}return u;case i.ANIMATIONTYPE_VECTOR3:switch(n){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.vector3InterpolateFunction(h,l,c);case i.ANIMATIONLOOPMODE_RELATIVE:return this.vector3InterpolateFunction(h,l,c).add(r.scale(t))}case i.ANIMATIONTYPE_VECTOR2:switch(n){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.vector2InterpolateFunction(h,l,c);case i.ANIMATIONLOOPMODE_RELATIVE:return this.vector2InterpolateFunction(h,l,c).add(r.scale(t))}case i.ANIMATIONTYPE_SIZE:switch(n){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(h,l,c);case i.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(h,l,c).add(r.scale(t))}case i.ANIMATIONTYPE_COLOR3:switch(n){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(h,l,c);case i.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(h,l,c).add(r.scale(t))}case i.ANIMATIONTYPE_MATRIX:switch(n){case i.ANIMATIONLOOPMODE_CYCLE:case i.ANIMATIONLOOPMODE_CONSTANT:if(this.allowMatricesInterpolation)return this.matrixInterpolateFunction(h,l,c);case i.ANIMATIONLOOPMODE_RELATIVE:return h}}break}return this._getKeyValue(this._keys[this._keys.length-1].value)},i.prototype.setValue=function(t,i){void 0===i&&(i=!1);var n,r;if(this.targetPropertyPath.length>1){for(var o=this._target[this.targetPropertyPath[0]],s=1;s<this.targetPropertyPath.length-1;s++)o=o[this.targetPropertyPath[s]];n=this.targetPropertyPath[this.targetPropertyPath.length-1],r=o}else n=this.targetPropertyPath[0],r=this._target;this.enableBlending&&this._blendingFactor<=1?(this._originalBlendValue||(r[n].clone?this._originalBlendValue=r[n].clone():this._originalBlendValue=r[n]),this._originalBlendValue.prototype?this._originalBlendValue.prototype.Lerp?r[n]=this._originalBlendValue.construtor.prototype.Lerp(t,this._originalBlendValue,this._blendingFactor):r[n]=t:this._originalBlendValue.m?r[n]=e.Matrix.Lerp(this._originalBlendValue,t,this._blendingFactor):r[n]=this._originalBlendValue*(1-this._blendingFactor)+this._blendingFactor*t,this._blendingFactor+=this.blendingSpeed):r[n]=t,this._target.markAsDirty&&this._target.markAsDirty(this.targetProperty)},i.prototype.goToFrame=function(e){e<this._keys[0].frame?e=this._keys[0].frame:e>this._keys[this._keys.length-1].frame&&(e=this._keys[this._keys.length-1].frame);var t=this._interpolate(e,0,this.loopMode);this.setValue(t)},i.prototype.animate=function(t,n,r,o,s,a){if(void 0===a&&(a=!1),!this.targetPropertyPath||this.targetPropertyPath.length<1)return this._stopped=!0,!1;var h=!0;if(0!==this._keys[0].frame){var l={frame:0,value:this._keys[0].value};this._keys.splice(0,0,l)}(n<this._keys[0].frame||n>this._keys[this._keys.length-1].frame)&&(n=this._keys[0].frame),(r<this._keys[0].frame||r>this._keys[this._keys.length-1].frame)&&(r=this._keys[this._keys.length-1].frame);var c,u=r-n,d=t*(this.framePerSecond*s)/1e3,f=0;if(d>u&&!o)h=!1,f=this._getKeyValue(this._keys[this._keys.length-1].value);else if(this.loopMode!==i.ANIMATIONLOOPMODE_CYCLE){var p=r.toString()+n.toString();if(!this._offsetsCache[p]){var _=this._interpolate(n,0,i.ANIMATIONLOOPMODE_CYCLE),m=this._interpolate(r,0,i.ANIMATIONLOOPMODE_CYCLE);switch(this.dataType){case i.ANIMATIONTYPE_FLOAT:this._offsetsCache[p]=m-_;break;case i.ANIMATIONTYPE_QUATERNION:this._offsetsCache[p]=m.subtract(_);break;case i.ANIMATIONTYPE_VECTOR3:this._offsetsCache[p]=m.subtract(_);case i.ANIMATIONTYPE_VECTOR2:this._offsetsCache[p]=m.subtract(_);case i.ANIMATIONTYPE_SIZE:this._offsetsCache[p]=m.subtract(_);case i.ANIMATIONTYPE_COLOR3:this._offsetsCache[p]=m.subtract(_)}this._highLimitsCache[p]=m}f=this._highLimitsCache[p],c=this._offsetsCache[p]}if(void 0===c)switch(this.dataType){case i.ANIMATIONTYPE_FLOAT:c=0;break;case i.ANIMATIONTYPE_QUATERNION:c=new e.Quaternion(0,0,0,0);break;case i.ANIMATIONTYPE_VECTOR3:c=e.Vector3.Zero();break;case i.ANIMATIONTYPE_VECTOR2:c=e.Vector2.Zero();break;case i.ANIMATIONTYPE_SIZE:c=e.Size.Zero();break;case i.ANIMATIONTYPE_COLOR3:c=e.Color3.Black()}var g=d/u>>0,v=h?n+d%u:r,y=this._interpolate(v,g,this.loopMode,c,f);this.setValue(y);for(var b=0;b<this._events.length;b++)if(v>=this._events[b].frame){var x=this._events[b];x.isDone||(x.onlyOnce&&(this._events.splice(b,1),b--),x.isDone=!0,x.action())}else this._events[b].isDone&&!this._events[b].onlyOnce&&(this._events[b].isDone=!1);return h||(this._stopped=!0),h},i.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode;var t=this.dataType;e.keys=[];for(var n=this.getKeys(),r=0;r<n.length;r++){var o=n[r],s={};switch(s.frame=o.frame,t){case i.ANIMATIONTYPE_FLOAT:s.values=[o.value];break;case i.ANIMATIONTYPE_QUATERNION:case i.ANIMATIONTYPE_MATRIX:case i.ANIMATIONTYPE_VECTOR3:case i.ANIMATIONTYPE_COLOR3:s.values=o.value.asArray()}e.keys.push(s)}e.ranges=[];for(var a in this._ranges){var h={};h.name=a,h.from=this._ranges[a].from,h.to=this._ranges[a].to,e.ranges.push(h)}return e},Object.defineProperty(i,"ANIMATIONTYPE_FLOAT",{get:function(){return i._ANIMATIONTYPE_FLOAT},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_VECTOR3",{get:function(){return i._ANIMATIONTYPE_VECTOR3},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_VECTOR2",{get:function(){return i._ANIMATIONTYPE_VECTOR2},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_SIZE",{get:function(){return i._ANIMATIONTYPE_SIZE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_QUATERNION",{get:function(){return i._ANIMATIONTYPE_QUATERNION},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_MATRIX",{get:function(){return i._ANIMATIONTYPE_MATRIX},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONTYPE_COLOR3",{get:function(){return i._ANIMATIONTYPE_COLOR3},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_RELATIVE",{get:function(){return i._ANIMATIONLOOPMODE_RELATIVE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_CYCLE",{get:function(){return i._ANIMATIONLOOPMODE_CYCLE},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ANIMATIONLOOPMODE_CONSTANT",{get:function(){return i._ANIMATIONLOOPMODE_CONSTANT},enumerable:!0,configurable:!0}),i.Parse=function(t){var n,r,o=new i(t.name,t.property,t.framePerSecond,t.dataType,t.loopBehavior),s=t.dataType,a=[];for(r=0;r<t.keys.length;r++){var h=t.keys[r];switch(s){case i.ANIMATIONTYPE_FLOAT:n=h.values[0];break;case i.ANIMATIONTYPE_QUATERNION:n=e.Quaternion.FromArray(h.values);break;case i.ANIMATIONTYPE_MATRIX:n=e.Matrix.FromArray(h.values);break;case i.ANIMATIONTYPE_COLOR3:n=e.Color3.FromArray(h.values);break;case i.ANIMATIONTYPE_VECTOR3:default:n=e.Vector3.FromArray(h.values)}a.push({frame:h.frame,value:n})}if(o.setKeys(a),t.ranges)for(r=0;r<t.ranges.length;r++)n=t.ranges[r],o.createRange(n.name,n.from,n.to);return o},i.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var i=0;i<e.animations.length;i++){var n=e.animations[i];t.animations.push(n.serialize())}}},i._ANIMATIONTYPE_FLOAT=0,i._ANIMATIONTYPE_VECTOR3=1,i._ANIMATIONTYPE_QUATERNION=2,i._ANIMATIONTYPE_MATRIX=3,i._ANIMATIONTYPE_COLOR3=4,i._ANIMATIONTYPE_VECTOR2=5,i._ANIMATIONTYPE_SIZE=6,i._ANIMATIONLOOPMODE_RELATIVE=0,i._ANIMATIONLOOPMODE_CYCLE=1,i._ANIMATIONLOOPMODE_CONSTANT=2,i}();e.Animation=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i,n,r,o,s,a){void 0===i&&(i=0),void 0===n&&(n=100),void 0===r&&(r=!1),void 0===o&&(o=1),this.target=t,this.fromFrame=i,this.toFrame=n,this.loopAnimation=r,this.speedRatio=o,this.onAnimationEnd=s,this._animations=new Array,this._paused=!1,this.animationStarted=!1,a&&this.appendAnimations(t,a),this._scene=e,e._activeAnimatables.push(this)}return e.prototype.getAnimations=function(){return this._animations},e.prototype.appendAnimations=function(e,t){for(var i=0;i<t.length;i++){var n=t[i];n._target=e,this._animations.push(n)}},e.prototype.getAnimationByTargetProperty=function(e){for(var t=this._animations,i=0;i<t.length;i++)if(t[i].targetProperty===e)return t[i];return null},e.prototype.reset=function(){for(var e=this._animations,t=0;t<e.length;t++)e[t].reset();this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(e){for(var t=this._animations,i=0;i<t.length;i++)t[i].enableBlending=!0,t[i].blendingSpeed=e},e.prototype.disableBlending=function(){for(var e=this._animations,t=0;t<e.length;t++)e[t].enableBlending=!1},e.prototype.goToFrame=function(e){for(var t=this._animations,i=0;i<t.length;i++)t[i].goToFrame(e)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype.stop=function(){var e=this._scene._activeAnimatables.indexOf(this);if(e>-1){this._scene._activeAnimatables.splice(e,1);for(var t=this._animations,e=0;e<t.length;e++)t[e].reset();this.onAnimationEnd&&this.onAnimationEnd()}},e.prototype._animate=function(e){if(this._paused)return this.animationStarted=!1,this._pausedDelay||(this._pausedDelay=e),!0;this._localDelayOffset?this._pausedDelay&&(this._localDelayOffset+=e-this._pausedDelay,this._pausedDelay=null):this._localDelayOffset=e;var t,i=!1,n=this._animations;for(t=0;t<n.length;t++){var r=n[t],o=r.animate(e-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this.speedRatio);i=i||o}return this.animationStarted=i,i||(t=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(t,1)),!i&&this.onAnimationEnd&&(this.onAnimationEnd(),this.onAnimationEnd=null),i},e}();e.Animatable=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._easingMode=e.EASINGMODE_EASEIN}return Object.defineProperty(e,"EASINGMODE_EASEIN",{get:function(){return e._EASINGMODE_EASEIN},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEOUT",{get:function(){return e._EASINGMODE_EASEOUT},enumerable:!0,configurable:!0}),Object.defineProperty(e,"EASINGMODE_EASEINOUT",{get:function(){return e._EASINGMODE_EASEINOUT},enumerable:!0,configurable:!0}),e.prototype.setEasingMode=function(e){var t=Math.min(Math.max(e,0),2);this._easingMode=t},e.prototype.getEasingMode=function(){return this._easingMode},e.prototype.easeInCore=function(e){throw new Error("You must implement this method")},e.prototype.ease=function(t){switch(this._easingMode){case e.EASINGMODE_EASEIN:return this.easeInCore(t);case e.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-t)}return t>=.5?.5*(1-this.easeInCore(2*(1-t)))+.5:.5*this.easeInCore(2*t)},e._EASINGMODE_EASEIN=0,e._EASINGMODE_EASEOUT=1,e._EASINGMODE_EASEINOUT=2,e}();e.EasingFunction=t;var i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.easeInCore=function(e){return e=Math.max(0,Math.min(1,e)),1-Math.sqrt(1-e*e)},t}(t);e.CircleEase=i;var n=function(e){function t(t){void 0===t&&(t=1),e.call(this),this.amplitude=t}return __extends(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.amplitude);return Math.pow(e,3)-e*t*Math.sin(3.141592653589793*e)},t}(t);e.BackEase=n;var r=function(e){function t(t,i){void 0===t&&(t=3),void 0===i&&(i=2),e.call(this),this.bounces=t,this.bounciness=i}return __extends(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.bounces),i=this.bounciness;1>=i&&(i=1.001);var n=Math.pow(i,t),r=1-i,o=(1-n)/r+.5*n,s=e*o,a=Math.log(-s*(1-i)+1)/Math.log(i),h=Math.floor(a),l=h+1,c=(1-Math.pow(i,h))/(r*o),u=(1-Math.pow(i,l))/(r*o),d=.5*(c+u),f=e-d,p=d-c;return-Math.pow(1/i,t-h)/(p*p)*(f-p)*(f+p)},t}(t);e.BounceEase=r;var o=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.easeInCore=function(e){return e*e*e},t}(t);e.CubicEase=o;var s=function(e){function t(t,i){void 0===t&&(t=3),void 0===i&&(i=3),e.call(this),this.oscillations=t,this.springiness=i}return __extends(t,e),t.prototype.easeInCore=function(e){var t,i=Math.max(0,this.oscillations),n=Math.max(0,this.springiness);return t=0==n?e:(Math.exp(n*e)-1)/(Math.exp(n)-1),t*Math.sin((6.283185307179586*i+1.5707963267948966)*e)},t}(t);e.ElasticEase=s;var a=function(e){function t(t){void 0===t&&(t=2),e.call(this),this.exponent=t}return __extends(t,e),t.prototype.easeInCore=function(e){return this.exponent<=0?e:(Math.exp(this.exponent*e)-1)/(Math.exp(this.exponent)-1)},t}(t);e.ExponentialEase=a;var h=function(e){function t(t){void 0===t&&(t=2),e.call(this),this.power=t}return __extends(t,e),t.prototype.easeInCore=function(e){var t=Math.max(0,this.power);return Math.pow(e,t)},t}(t);e.PowerEase=h;var l=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.easeInCore=function(e){return e*e},t}(t);e.QuadraticEase=l;var c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.easeInCore=function(e){return e*e*e*e},t}(t);e.QuarticEase=c;var u=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.easeInCore=function(e){return e*e*e*e*e},t}(t);e.QuinticEase=u;var d=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.easeInCore=function(e){return 1-Math.sin(1.5707963267948966*(1-e))},t}(t);e.SineEase=d;var f=function(t){function i(e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=1),t.call(this),this.x1=e,this.y1=i,this.x2=n,this.y2=r}return __extends(i,t),i.prototype.easeInCore=function(t){return e.BezierCurve.interpolate(t,this.x1,this.y1,this.x2,this.y2)},i}(t);e.BezierCurveEase=f}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s){t.call(this,i,n.getScene()),this.name=i,this.children=new Array,this.animations=new Array,this._worldTransform=new e.Matrix,this._absoluteTransform=new e.Matrix,this._invertedAbsoluteTransform=new e.Matrix,this._skeleton=n,this._matrix=o,this._baseMatrix=o,this._restPose=s?s:o.clone(),n.bones.push(this),r?(this._parent=r,r.children.push(this)):this._parent=null,this._updateDifferenceMatrix()}return __extends(i,t),i.prototype.getParent=function(){return this._parent},i.prototype.getLocalMatrix=function(){return this._matrix},i.prototype.getBaseMatrix=function(){return this._baseMatrix},i.prototype.getRestPose=function(){return this._restPose},i.prototype.returnToRest=function(){this.updateMatrix(this._restPose.clone())},i.prototype.getWorldMatrix=function(){return this._worldTransform},i.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},i.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},i.prototype.updateMatrix=function(e){this._baseMatrix=e.clone(),
this._matrix=e.clone(),this._skeleton._markAsDirty(),this._updateDifferenceMatrix()},i.prototype._updateDifferenceMatrix=function(e){e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);for(var t=0;t<this.children.length;t++)this.children[t]._updateDifferenceMatrix()},i.prototype.markAsDirty=function(){this._currentRenderId++,this._skeleton._markAsDirty()},i.prototype.copyAnimationRange=function(t,i,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=null),0===this.animations.length&&(this.animations.push(new e.Animation(this.name,"_matrix",t.animations[0].framePerSecond,e.Animation.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var s=t.animations[0].getRange(i);if(!s)return!1;for(var a,h,l,c=s.from,u=s.to,d=t.animations[0].getKeys(),f=t.length,p=t.getParent(),_=this.getParent(),m=r&&p&&f&&this.length&&f!==this.length,g=m?_.length/p.length:null,v=r&&!_&&o&&(1!==o.x||1!==o.y||1!==o.z),y=this.animations[0].getKeys(),b=0,x=d.length;x>b;b++)a=d[b],a.frame>=c&&a.frame<=u&&(r?(l=a.value.clone(),m?(h=l.getTranslation(),l.setTranslation(h.scaleInPlace(g))):v?(h=l.getTranslation(),l.setTranslation(h.multiplyInPlace(o))):l=a.value):l=a.value,y.push({frame:a.frame+n,value:l}));return this.animations[0].createRange(i,c+n,u+n),!0},i}(e.Node);e.Bone=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n){this.name=t,this.id=i,this.bones=new Array,this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=e.Matrix.Identity(),this._ranges={},this.bones=[],this._scene=n,n.skeletons.push(this),this._isDirty=!0}return t.prototype.getTransformMatrices=function(e){return this.needInitialSkinMatrix&&e._bonesTransformMatrices?e._bonesTransformMatrices:this._transformMatrices},t.prototype.getScene=function(){return this._scene},t.prototype.toString=function(e){var t="Name: "+this.name+", nBones: "+this.bones.length;if(t+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){t+=", Ranges: {";var i=!0;for(var n in this._ranges)i&&(t+=", ",i=!1),t+=n;t+="}"}return t},t.prototype.getBoneIndexByName=function(e){for(var t=0,i=this.bones.length;i>t;t++)if(this.bones[t].name===e)return t;return-1},t.prototype.createAnimationRange=function(t,i,n){if(!this._ranges[t]){this._ranges[t]=new e.AnimationRange(t,i,n);for(var r=0,o=this.bones.length;o>r;r++)this.bones[r].animations[0]&&this.bones[r].animations[0].createRange(t,i,n)}},t.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var i=0,n=this.bones.length;n>i;i++)this.bones[i].animations[0]&&this.bones[i].animations[0].deleteRange(e,t);this._ranges[e]=void 0},t.prototype.getAnimationRange=function(e){return this._ranges[e]},t.prototype.getAnimationRanges=function(){var e,t=[],i=0;for(e in this._ranges)t[i]=this._ranges[e],i++;return t},t.prototype.copyAnimationRange=function(t,i,n){if(void 0===n&&(n=!1),this._ranges[i]||!t.getAnimationRange(i))return!1;var r,o,s=!0,a=this._getHighestAnimationFrame()+1,h={},l=t.bones;for(o=0,r=l.length;r>o;o++)h[l[o].name]=l[o];this.bones.length!==l.length&&(e.Tools.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+l.length),s=!1);var c=n&&this.dimensionsAtRest&&t.dimensionsAtRest?this.dimensionsAtRest.divide(t.dimensionsAtRest):null;for(o=0,r=this.bones.length;r>o;o++){var u=this.bones[o].name,d=h[u];d?s=s&&this.bones[o].copyAnimationRange(d,i,a,n,c):(e.Tools.Warn("copyAnimationRange: not same rig, missing source bone "+u),s=!1)}var f=t.getAnimationRange(i);return this._ranges[i]=new e.AnimationRange(i,f.from+a,f.to+a),s},t.prototype.returnToRest=function(){for(var e=0;e<this.bones.length;e++)this.bones[e].returnToRest()},t.prototype._getHighestAnimationFrame=function(){for(var e=0,t=0,i=this.bones.length;i>t;t++)if(this.bones[t].animations[0]){var n=this.bones[t].animations[0].getHighestFrame();n>e&&(e=n)}return e},t.prototype.beginAnimation=function(e,t,i,n){var r=this.getAnimationRange(e);return r?this._scene.beginAnimation(this,r.from,r.to,t,i,n):null},t.prototype._markAsDirty=function(){this._isDirty=!0},t.prototype._registerMeshWithPoseMatrix=function(e){this._meshesWithPoseMatrix.push(e)},t.prototype._unregisterMeshWithPoseMatrix=function(e){var t=this._meshesWithPoseMatrix.indexOf(e);t>-1&&this._meshesWithPoseMatrix.splice(t,1)},t.prototype._computeTransformMatrices=function(e,t){for(var i=0;i<this.bones.length;i++){var n=this.bones[i],r=n.getParent();r?n.getLocalMatrix().multiplyToRef(r.getWorldMatrix(),n.getWorldMatrix()):t?n.getLocalMatrix().multiplyToRef(t,n.getWorldMatrix()):n.getWorldMatrix().copyFrom(n.getLocalMatrix()),n.getInvertedAbsoluteTransform().multiplyToArray(n.getWorldMatrix(),e,16*i)}this._identity.copyToArray(e,16*this.bones.length)},t.prototype.prepare=function(){if(this._isDirty){if(this.needInitialSkinMatrix)for(var t=0;t<this._meshesWithPoseMatrix.length;t++){var i=this._meshesWithPoseMatrix[t];i._bonesTransformMatrices&&i._bonesTransformMatrices.length===16*(this.bones.length+1)||(i._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)));for(var n=i.getPoseMatrix(),r=0;r<this.bones.length;r++){var o=this.bones[r];if(!o.getParent()){var s=o.getBaseMatrix();s.multiplyToRef(n,e.Tmp.Matrix[0]),o._updateDifferenceMatrix(e.Tmp.Matrix[0])}}this._computeTransformMatrices(i._bonesTransformMatrices,n)}else this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1))),this._computeTransformMatrices(this._transformMatrices,null);this._isDirty=!1,this._scene._activeBones+=this.bones.length}},t.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var e=0;e<this.bones.length;e++)this._animatables.push(this.bones[e])}return this._animatables},t.prototype.clone=function(i,n){var r=new t(i,n||i,this._scene);r.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var o=0;o<this.bones.length;o++){var s=this.bones[o],a=null;if(s.getParent()){var h=this.bones.indexOf(s.getParent());a=r.bones[h]}var l=new e.Bone(s.name,r,a,s.getBaseMatrix().clone(),s.getRestPose().clone());e.Tools.DeepCopy(s.animations,l.animations)}if(this._ranges){r._ranges={};for(var c in this._ranges)r._ranges[c]=this._ranges[c].clone()}return this._isDirty=!0,r},t.prototype.enableBlending=function(e){void 0===e&&(e=.01),this.bones.forEach(function(t){t.animations.forEach(function(t){t.enableBlending=!0,t.blendingSpeed=e})})},t.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this)},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,e.dimensionsAtRest=this.dimensionsAtRest,e.bones=[],e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var t=0;t<this.bones.length;t++){var i=this.bones[t],n={parentBoneIndex:i.getParent()?this.bones.indexOf(i.getParent()):-1,name:i.name,matrix:i.getLocalMatrix().toArray(),rest:i.getRestPose().toArray()};e.bones.push(n),i.length&&(n.length=i.length),i.animations&&i.animations.length>0&&(n.animation=i.animations[0].serialize()),e.ranges=[];for(var r in this._ranges){var o={};o.name=r,o.from=this._ranges[r].from,o.to=this._ranges[r].to,e.ranges.push(o)}}return e},t.Parse=function(i,n){var r=new t(i.name,i.id,n);i.dimensionsAtRest&&(r.dimensionsAtRest=e.Vector3.FromArray(i.dimensionsAtRest)),r.needInitialSkinMatrix=i.needInitialSkinMatrix;var o;for(o=0;o<i.bones.length;o++){var s=i.bones[o],a=null;s.parentBoneIndex>-1&&(a=r.bones[s.parentBoneIndex]);var h=s.rest?e.Matrix.FromArray(s.rest):null,l=new e.Bone(s.name,r,a,e.Matrix.FromArray(s.matrix),h);s.length&&(l.length=s.length),s.animation&&l.animations.push(e.Animation.Parse(s.animation))}if(i.ranges)for(o=0;o<i.ranges.length;o++){var c=i.ranges[o];r.createAnimationRange(c.name,c.from,c.to)}return r},t}();e.Skeleton=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o,s,a,h,l,c,u){void 0===a&&(a=e.Texture.NEAREST_SAMPLINGMODE),void 0===u&&(u=e.Engine.TEXTURETYPE_UNSIGNED_INT),this.name=t,this.width=-1,this.height=-1,this.enablePixelPerfectMode=!1,this._reusable=!1,this._textures=new e.SmartArray(2),this._currentRenderTextureInd=0,this._scaleRatio=new e.Vector2(1,1),this.onActivateObservable=new e.Observable,this.onSizeChangedObservable=new e.Observable,this.onApplyObservable=new e.Observable,this.onBeforeRenderObservable=new e.Observable,this.onAfterRenderObservable=new e.Observable,null!=s?(this._camera=s,this._scene=s.getScene(),s.attachPostProcess(this),this._engine=this._scene.getEngine()):this._engine=h,this._options=o,this.renderTargetSamplingMode=a?a:e.Texture.NEAREST_SAMPLINGMODE,this._reusable=l||!1,this._textureType=u,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=i,this._parameters=n||[],this._parameters.push("scale"),this.updateEffect(c)}return Object.defineProperty(t.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),this._onActivateObserver=this.onActivateObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!0,configurable:!0}),t.prototype.updateEffect=function(e){this._effect=this._engine.createEffect({vertex:"postprocess",fragment:this._fragmentUrl},["position"],this._parameters,this._samplers,void 0!==e?e:"")},t.prototype.isReusable=function(){return this._reusable},t.prototype.markTextureDirty=function(){this.width=-1},t.prototype.activate=function(t,i){t=t||this._camera;var n=t.getScene(),r=t.getEngine().getCaps().maxTextureSize,o=(i?i._width:this._engine.getRenderingCanvas().width)*this._options|0,s=(i?i._height:this._engine.getRenderingCanvas().height)*this._options|0,a=this._options.width||o,h=this._options.height||s;if(this.renderTargetSamplingMode!==e.Texture.NEAREST_SAMPLINGMODE&&(this._options.width||(a=e.Tools.GetExponentOfTwo(a,r)),this._options.height||(h=e.Tools.GetExponentOfTwo(h,r))),this.width!==a||this.height!==h){if(this._textures.length>0){for(var l=0;l<this._textures.length;l++)this._engine._releaseTexture(this._textures.data[l]);this._textures.reset()}this.width=a,this.height=h,this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===t._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType})),this._reusable&&this._textures.push(this._engine.createRenderTargetTexture({width:this.width,height:this.height},{generateMipMaps:!1,generateDepthBuffer:0===t._postProcesses.indexOf(this),samplingMode:this.renderTargetSamplingMode,type:this._textureType})),this.onSizeChangedObservable.notifyObservers(this)}this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(o/a,s/h),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd],0,o,s)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(this._textures.data[this._currentRenderTextureInd])),this.onActivateObservable.notifyObservers(t),this.clearColor?this._engine.clear(this.clearColor,!0,!0):this._engine.clear(n.clearColor,n.autoClear||n.forceWireframe,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2)},Object.defineProperty(t.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!0,configurable:!0}),t.prototype.apply=function(){return this._effect.isReady()?(this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setAlphaMode(e.Engine.ALPHA_DISABLE),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._effect._bindTexture("textureSampler",this._textures.data[this._currentRenderTextureInd]),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect):null},t.prototype.dispose=function(e){if(e=e||this._camera,this._textures.length>0){for(var t=0;t<this._textures.length;t++)this._engine._releaseTexture(this._textures.data[t]);this._textures.reset()}if(e){e.detachPostProcess(this);var i=e._postProcesses.indexOf(this);0===i&&e._postProcesses.length>0&&this._camera._postProcesses[0].markTextureDirty(),this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},t}();e.PostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._vertexBuffers={},this._scene=e}return t.prototype._prepareBuffers=function(){if(!this._vertexBuffers[e.VertexBuffer.PositionKind]){var t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(this._scene.getEngine(),t,e.VertexBuffer.PositionKind,!1,!1,2);var i=[];i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(i)}},t.prototype._prepareFrame=function(e){var t=this._scene.activeCamera._postProcesses;return!(0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(this._scene.activeCamera,e),!0)},t.prototype.directRender=function(e,t){for(var i=this._scene.getEngine(),n=0;n<e.length;n++){n<e.length-1?e[n+1].activate(this._scene.activeCamera,t):t?i.bindFramebuffer(t):i.restoreDefaultFramebuffer();var r=e[n],o=r.apply();o&&(r.onBeforeRenderObservable.notifyObservers(o),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,o),i.draw(!0,0,6),r.onAfterRenderObservable.notifyObservers(o))}i.setDepthBuffer(!0),i.setDepthWrite(!0)},t.prototype._finalizeFrame=function(e,t,i,n){if(n=n||this._scene.activeCamera._postProcesses,0!==n.length&&this._scene.postProcessesEnabled){for(var r=this._scene.getEngine(),o=0,s=n.length;s>o&&(s-1>o?n[o+1].activate(this._scene.activeCamera,t):t?r.bindFramebuffer(t,i):r.restoreDefaultFramebuffer(),!e);o++){var a=n[o],h=a.apply();h&&(a.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,h),r.draw(!0,0,6),a.onAfterRenderObservable.notifyObservers(h))}r.setDepthBuffer(!0),r.setDepthWrite(!0)}},t.prototype.dispose=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},t}();e.PostProcessManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n,r,o,s){e.call(this,t,"pass",null,null,i,n,r,o,s)}return __extends(t,e),t}(e.PostProcess);e.PassPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t){this.type=e,this.jointData=t,t.nativeParams=t.nativeParams||{}}return Object.defineProperty(e.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(e){this._physicsJoint,this._physicsJoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"physicsPlugin",{set:function(e){this._physicsPlugin=e},enumerable:!0,configurable:!0}),e.prototype.executeNativeFunction=function(e){e(this._physicsPlugin.world,this._physicsJoint)},e.DistanceJoint=0,e.HingeJoint=1,e.BallAndSocketJoint=2,e.WheelJoint=3,e.SliderJoint=4,e.PrismaticJoint=5,e.UniversalJoint=6,e.Hinge2Joint=e.WheelJoint,e.PointToPointJoint=8,e.SpringJoint=9,e.LockJoint=10,e}();e.PhysicsJoint=t;var i=function(e){function i(i){e.call(this,t.DistanceJoint,i)}return __extends(i,e),i.prototype.updateDistance=function(e,t){this._physicsPlugin.updateDistanceJoint(this,e,t)},i}(t);e.DistanceJoint=i;var n=function(e){function t(t,i){e.call(this,t,i)}return __extends(t,e),t.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e,t)},t.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},t}(t);e.MotorEnabledJoint=n;var r=function(e){function i(i){e.call(this,t.HingeJoint,i)}return __extends(i,e),i.prototype.setMotor=function(e,t){this._physicsPlugin.setMotor(this,e,t)},i.prototype.setLimit=function(e,t){this._physicsPlugin.setLimit(this,e,t)},i}(n);e.HingeJoint=r;var o=function(e){function i(i){e.call(this,t.Hinge2Joint,i)}return __extends(i,e),i.prototype.setMotor=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setMotor(this,e,t,i)},i.prototype.setLimit=function(e,t,i){void 0===i&&(i=0),this._physicsPlugin.setLimit(this,e,t,i)},i}(n);e.Hinge2Joint=o}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r){var o=this;return void 0===n&&(n={mass:0}),this.object=t,this.type=i,this._options=n,this._scene=r,this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=e.Vector3.Zero(),this._tmpPositionWithDelta=e.Vector3.Zero(),this._tmpRotationWithDelta=new e.Quaternion,this.beforeStep=function(){o.object.position.subtractToRef(o._deltaPosition,o._tmpPositionWithDelta),o._deltaRotationConjugated?o.object.rotationQuaternion.multiplyToRef(o._deltaRotationConjugated,o._tmpRotationWithDelta):o._tmpRotationWithDelta.copyFrom(o.object.rotationQuaternion),o._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(o,o._tmpPositionWithDelta,o._tmpRotationWithDelta),o._onBeforePhysicsStepCallbacks.forEach(function(e){e(o)})},this.afterStep=function(){o._onAfterPhysicsStepCallbacks.forEach(function(e){e(o)}),o._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(o),o.object.position.addInPlace(o._deltaPosition),o._deltaRotation&&o.object.rotationQuaternion.multiplyInPlace(o._deltaRotation)},this.onCollide=function(e){if(o._onPhysicsCollideCallbacks.length){var t=o._physicsEngine.getImpostorWithPhysicsBody(e.body);t&&o._onPhysicsCollideCallbacks.filter(function(e){return-1!==e.otherImpostors.indexOf(t)}).forEach(function(e){e.callback(o,t)})}},this.object?(!this._scene&&t.getScene&&(this._scene=t.getScene()),this._physicsEngine=this._scene.getPhysicsEngine(),void(this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=e.Quaternion.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new e.Quaternion),this._options.mass=void 0===n.mass?0:n.mass,this._options.friction=void 0===n.friction?.2:n.friction,this._options.restitution=void 0===n.restitution?.2:n.restitution,this._joints=[],this.object.parent||this._init()):e.Tools.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))):void e.Tools.Error("No object was provided. A physics object is obligatory")}return t.prototype._init=function(){this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),this.parent||this._physicsEngine.addImpostor(this)},t.prototype._getPhysicsParent=function(){if(this.object.parent instanceof e.AbstractMesh){var t=this.object.parent;return t.physicsImpostor}},t.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},t.prototype.setScalingUpdated=function(e){this.forceUpdate()},t.prototype.forceUpdate=function(){this._init(),this.parent&&this.parent.forceUpdate()},Object.defineProperty(t.prototype,"physicsBody",{get:function(){return this._parent?this._parent.physicsBody:this._physicsBody},set:function(e){this._physicsBody&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=e,this.resetUpdateFlags()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),t.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},t.prototype.getObjectExtendSize=function(){return this.object.getBoundingInfo?(this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),this.object.getBoundingInfo().boundingBox.extendSize.scale(2).multiply(this.object.scaling)):t.DEFAULT_OBJECT_SIZE},t.prototype.getObjectCenter=function(){return this.object.getBoundingInfo?this.object.getBoundingInfo().boundingBox.center:this.object.position},t.prototype.getParam=function(e){return this._options[e]},t.prototype.setParam=function(e,t){this._options[e]=t,this._bodyUpdateRequired=!0},t.prototype.setMass=function(e){this.getParam("mass")!==e&&this.setParam("mass",e),this._physicsEngine.getPhysicsPlugin().setBodyMass(this,e)},t.prototype.getLinearVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this)},t.prototype.setLinearVelocity=function(e){this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,e)},t.prototype.getAngularVelocity=function(){return this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this)},t.prototype.setAngularVelocity=function(e){this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,e)},t.prototype.executeNativeFunction=function(e){e(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},t.prototype.registerBeforePhysicsStep=function(e){this._onBeforePhysicsStepCallbacks.push(e)},t.prototype.unregisterBeforePhysicsStep=function(t){var i=this._onBeforePhysicsStepCallbacks.indexOf(t);i>-1?this._onBeforePhysicsStepCallbacks.splice(i,1):e.Tools.Warn("Function to remove was not found")},t.prototype.registerAfterPhysicsStep=function(e){this._onAfterPhysicsStepCallbacks.push(e)},t.prototype.unregisterAfterPhysicsStep=function(t){var i=this._onAfterPhysicsStepCallbacks.indexOf(t);i>-1?this._onAfterPhysicsStepCallbacks.splice(i,1):e.Tools.Warn("Function to remove was not found")},t.prototype.registerOnPhysicsCollide=function(e,t){var i=e instanceof Array?e:[e];this._onPhysicsCollideCallbacks.push({callback:t,otherImpostors:i})},t.prototype.unregisterOnPhysicsCollide=function(t,i){var n=t instanceof Array?t:[t],r=this._onPhysicsCollideCallbacks.indexOf({callback:i,otherImpostors:n});r>-1?this._onPhysicsCollideCallbacks.splice(r,1):e.Tools.Warn("Function to remove was not found")},t.prototype.applyForce=function(e,t){this._physicsEngine.getPhysicsPlugin().applyForce(this,e,t)},t.prototype.applyImpulse=function(e,t){this._physicsEngine.getPhysicsPlugin().applyImpulse(this,e,t)},t.prototype.createJoint=function(t,i,n){var r=new e.PhysicsJoint(i,n);this.addJoint(t,r)},t.prototype.addJoint=function(e,t){this._joints.push({otherImpostor:e,joint:t}),this._physicsEngine.addJoint(this,e,t)},t.prototype.sleep=function(){this._physicsEngine.getPhysicsPlugin().sleepBody(this)},t.prototype.wakeUp=function(){this._physicsEngine.getPhysicsPlugin().wakeUpBody(this)},t.prototype.clone=function(e){return e?new t(e,this.type,this._options,this._scene):null},t.prototype.dispose=function(){var e=this;this._physicsEngine&&(this._joints.forEach(function(t){e._physicsEngine.removeJoint(e,t.otherImpostor,t.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate())},t.prototype.setDeltaPosition=function(e){this._deltaPosition.copyFrom(e)},t.prototype.setDeltaRotation=function(t){this._deltaRotation||(this._deltaRotation=new e.Quaternion),this._deltaRotation.copyFrom(t),this._deltaRotationConjugated=this._deltaRotation.conjugate()},t.DEFAULT_OBJECT_SIZE=new e.Vector3(1,1,1),t.NoImpostor=0,t.SphereImpostor=1,t.BoxImpostor=2,t.PlaneImpostor=3,t.MeshImpostor=4,t.CylinderImpostor=7,t.ParticleImpostor=8,t.HeightmapImpostor=9,t}();e.PhysicsImpostor=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){if(void 0===i&&(i=new e.CannonJSPlugin),this._physicsPlugin=i,this._impostors=[],this._joints=[],!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");t=t||new e.Vector3(0,-9.807,0),this.setGravity(t),this.setTimeStep()}return t.prototype.setGravity=function(e){this.gravity=e,this._physicsPlugin.setGravity(this.gravity)},t.prototype.setTimeStep=function(e){void 0===e&&(e=1/60),this._physicsPlugin.setTimeStep(e)},t.prototype.dispose=function(){this._impostors.forEach(function(e){e.dispose()}),this._physicsPlugin.dispose()},t.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},t.prototype.addImpostor=function(e){e.uniqueId=this._impostors.push(e),e.parent||this._physicsPlugin.generatePhysicsBody(e)},t.prototype.removeImpostor=function(e){var t=this._impostors.indexOf(e);if(t>-1){var i=this._impostors.splice(t,1);i.length&&(i[0].physicsBody=null)}},t.prototype.addJoint=function(e,t,i){var n={mainImpostor:e,connectedImpostor:t,joint:i};i.physicsPlugin=this._physicsPlugin,this._joints.push(n),this._physicsPlugin.generateJoint(n)},t.prototype.removeJoint=function(e,t,i){var n=this._joints.filter(function(n){return n.connectedImpostor===t&&n.joint===i&&n.mainImpostor===e});n.length&&this._physicsPlugin.removeJoint(n[0])},t.prototype._step=function(e){var t=this;this._impostors.forEach(function(e){e.isBodyInitRequired()&&t._physicsPlugin.generatePhysicsBody(e)}),e>.1?e=.1:0>=e&&(e=1/60),this._physicsPlugin.executeStep(e,this._impostors)},t.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},t.prototype.getImpostorForPhysicsObject=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].object===e)return this._impostors[t]},t.prototype.getImpostorWithPhysicsBody=function(e){for(var t=0;t<this._impostors.length;++t)if(this._impostors[t].physicsBody===e)return this._impostors[t]},t.NoImpostor=e.PhysicsImpostor.NoImpostor,t.SphereImpostor=e.PhysicsImpostor.SphereImpostor,t.BoxImpostor=e.PhysicsImpostor.BoxImpostor,t.PlaneImpostor=e.PhysicsImpostor.PlaneImpostor,t.MeshImpostor=e.PhysicsImpostor.MeshImpostor,t.CylinderImpostor=e.PhysicsImpostor.CylinderImpostor,t.HeightmapImpostor=e.PhysicsImpostor.HeightmapImpostor,t.CapsuleImpostor=-1,t.ConeImpostor=-1,t.ConvexHullImpostor=-1,t.Epsilon=.001,t}();e.PhysicsEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.prototype.set=function(t,i){switch(i){case e.VertexBuffer.PositionKind:this.positions=t;break;case e.VertexBuffer.NormalKind:this.normals=t;break;case e.VertexBuffer.UVKind:this.uvs=t;break;case e.VertexBuffer.UV2Kind:this.uvs2=t;break;case e.VertexBuffer.UV3Kind:this.uvs3=t;break;case e.VertexBuffer.UV4Kind:this.uvs4=t;break;case e.VertexBuffer.UV5Kind:this.uvs5=t;break;case e.VertexBuffer.UV6Kind:this.uvs6=t;break;case e.VertexBuffer.ColorKind:this.colors=t;break;case e.VertexBuffer.MatricesIndicesKind:this.matricesIndices=t;break;case e.VertexBuffer.MatricesWeightsKind:this.matricesWeights=t;break;case e.VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=t;break;case e.VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=t}},t.prototype.applyToMesh=function(e,t){this._applyTo(e,t)},t.prototype.applyToGeometry=function(e,t){this._applyTo(e,t)},t.prototype.updateMesh=function(e,t,i){this._update(e)},t.prototype.updateGeometry=function(e,t,i){this._update(e)},t.prototype._applyTo=function(t,i){this.positions&&t.setVerticesData(e.VertexBuffer.PositionKind,this.positions,i),this.normals&&t.setVerticesData(e.VertexBuffer.NormalKind,this.normals,i),this.uvs&&t.setVerticesData(e.VertexBuffer.UVKind,this.uvs,i),this.uvs2&&t.setVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,i),this.uvs3&&t.setVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,i),this.uvs4&&t.setVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,i),this.uvs5&&t.setVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,i),this.uvs6&&t.setVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,i),this.colors&&t.setVerticesData(e.VertexBuffer.ColorKind,this.colors,i),this.matricesIndices&&t.setVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i),this.matricesWeights&&t.setVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i),this.matricesIndicesExtra&&t.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i),this.matricesWeightsExtra&&t.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i),this.indices&&t.setIndices(this.indices)},t.prototype._update=function(t,i,n){this.positions&&t.updateVerticesData(e.VertexBuffer.PositionKind,this.positions,i,n),this.normals&&t.updateVerticesData(e.VertexBuffer.NormalKind,this.normals,i,n),this.uvs&&t.updateVerticesData(e.VertexBuffer.UVKind,this.uvs,i,n),this.uvs2&&t.updateVerticesData(e.VertexBuffer.UV2Kind,this.uvs2,i,n),this.uvs3&&t.updateVerticesData(e.VertexBuffer.UV3Kind,this.uvs3,i,n),this.uvs4&&t.updateVerticesData(e.VertexBuffer.UV4Kind,this.uvs4,i,n),this.uvs5&&t.updateVerticesData(e.VertexBuffer.UV5Kind,this.uvs5,i,n),this.uvs6&&t.updateVerticesData(e.VertexBuffer.UV6Kind,this.uvs6,i,n),this.colors&&t.updateVerticesData(e.VertexBuffer.ColorKind,this.colors,i,n),this.matricesIndices&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesKind,this.matricesIndices,i,n),this.matricesWeights&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsKind,this.matricesWeights,i,n),this.matricesIndicesExtra&&t.updateVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,i,n),this.matricesWeightsExtra&&t.updateVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,i,n),this.indices&&t.setIndices(this.indices)},t.prototype.transform=function(t){var i,n=e.Vector3.Zero();if(this.positions){var r=e.Vector3.Zero();for(i=0;i<this.positions.length;i+=3)e.Vector3.FromArrayToRef(this.positions,i,r),e.Vector3.TransformCoordinatesToRef(r,t,n),this.positions[i]=n.x,this.positions[i+1]=n.y,this.positions[i+2]=n.z}if(this.normals){var o=e.Vector3.Zero();for(i=0;i<this.normals.length;i+=3)e.Vector3.FromArrayToRef(this.normals,i,o),e.Vector3.TransformNormalToRef(o,t,n),this.normals[i]=n.x,this.normals[i+1]=n.y,this.normals[i+2]=n.z}},t.prototype.merge=function(e){if(e.indices){this.indices||(this.indices=[]);for(var t=this.positions?this.positions.length/3:0,i=0;i<e.indices.length;i++)this.indices.push(e.indices[i]+t)}this.positions=this._mergeElement(this.positions,e.positions),this.normals=this._mergeElement(this.normals,e.normals),this.uvs=this._mergeElement(this.uvs,e.uvs),this.uvs2=this._mergeElement(this.uvs2,e.uvs2),this.uvs3=this._mergeElement(this.uvs3,e.uvs3),this.uvs4=this._mergeElement(this.uvs4,e.uvs4),this.uvs5=this._mergeElement(this.uvs5,e.uvs5),this.uvs6=this._mergeElement(this.uvs6,e.uvs6),this.colors=this._mergeElement(this.colors,e.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,e.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,e.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,e.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,e.matricesWeightsExtra)},t.prototype._mergeElement=function(e,t){if(!t)return e;if(!e)return t;var i=t.length+e.length,n=e instanceof Float32Array,r=t instanceof Float32Array;
if(n){var o=new Float32Array(i);return o.set(e),o.set(t,e.length),o}if(r){for(var s=e.slice(0),a=0,i=t.length;i>a;a++)s.push(t[a]);return s}return e.concat(t)},t.prototype.serialize=function(){var e=this.serialize();return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},t.ExtractFromMesh=function(e,i){return t._ExtractFrom(e,i)},t.ExtractFromGeometry=function(e,i){return t._ExtractFrom(e,i)},t._ExtractFrom=function(i,n){var r=new t;return i.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(r.positions=i.getVerticesData(e.VertexBuffer.PositionKind,n)),i.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(r.normals=i.getVerticesData(e.VertexBuffer.NormalKind,n)),i.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(r.uvs=i.getVerticesData(e.VertexBuffer.UVKind,n)),i.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(r.uvs2=i.getVerticesData(e.VertexBuffer.UV2Kind,n)),i.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(r.uvs3=i.getVerticesData(e.VertexBuffer.UV3Kind,n)),i.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(r.uvs4=i.getVerticesData(e.VertexBuffer.UV4Kind,n)),i.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(r.uvs5=i.getVerticesData(e.VertexBuffer.UV5Kind,n)),i.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(r.uvs6=i.getVerticesData(e.VertexBuffer.UV6Kind,n)),i.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(r.colors=i.getVerticesData(e.VertexBuffer.ColorKind,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(r.matricesIndices=i.getVerticesData(e.VertexBuffer.MatricesIndicesKind,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(r.matricesWeights=i.getVerticesData(e.VertexBuffer.MatricesWeightsKind,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesExtraKind)&&(r.matricesIndicesExtra=i.getVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,n)),i.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsExtraKind)&&(r.matricesWeightsExtra=i.getVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,n)),r.indices=i.getIndices(n),r},t.CreateRibbon=function(i){var n=i.pathArray,r=i.closeArray||!1,o=i.closePath||!1,s=Math.floor(n[0].length/2),a=i.offset||s;a=a>s?s:Math.floor(a);var h,l,c,u,d=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,f=[],p=[],_=[],m=[],g=[],v=[],y=[],b=[],x=[],P=[];if(n.length<2){var A=[],C=[];for(c=0;c<n[0].length-a;c++)A.push(n[0][c]),C.push(n[0][c+a]);n=[A,C]}var E,T,S=0,M=o?1:0;h=n[0].length;var I,w;for(l=0;l<n.length;l++){for(y[l]=0,g[l]=[0],E=n[l],T=E.length,h=T>h?h:T,u=0;T>u;)f.push(E[u].x,E[u].y,E[u].z),u>0&&(I=E[u].subtract(E[u-1]).length(),w=I+y[l],g[l].push(w),y[l]=w),u++;o&&(u--,f.push(E[0].x,E[0].y,E[0].z),I=E[u].subtract(E[0]).length(),w=I+y[l],g[l].push(w),y[l]=w),x[l]=T+M,P[l]=S,S+=T+M}var R,D,O,L;for(c=0;h+M>c;c++){for(b[c]=0,v[c]=[0],l=0;l<n.length-1;l++)R=n[l],D=n[l+1],c===h?(O=R[0],L=D[0]):(O=R[c],L=D[c]),I=L.subtract(O).length(),w=I+b[c],v[c].push(w),b[c]=w;r&&(R=n[l],D=n[0],c===h&&(L=D[0]),I=L.subtract(O).length(),w=I+b[c],b[c]=w)}var B,N;for(l=0;l<n.length;l++)for(c=0;h+M>c;c++)B=g[l][c]/y[l],N=v[c][l]/b[c],m.push(B,N);l=0;for(var F=0,V=x[l]-1,k=x[l+1]-1,z=k>V?V:k,U=P[1]-P[0],G=r?x.length:x.length-1;z>=F&&G>l;)p.push(F,F+U,F+1),p.push(F+U+1,F+1,F+U),F+=1,F===z&&(l++,l===x.length-1?(U=P[0]-P[l],V=x[l]-1,k=x[0]-1):(U=P[l+1]-P[l],V=x[l]-1,k=x[l+1]-1),F=P[l],z=k>V?V+F:k+F);if(t.ComputeNormals(f,p,_),o){var j=0,W=0;for(l=0;l<n.length;l++)j=3*P[l],W=l+1<n.length?3*(P[l+1]-1):_.length-3,_[j]=.5*(_[j]+_[W]),_[j+1]=.5*(_[j+1]+_[W+1]),_[j+2]=.5*(_[j+2]+_[W+2]),_[W]=_[j],_[W+1]=_[j+1],_[W+2]=_[j+2]}t._ComputeSides(d,f,p,_,m);var H=new t;return H.indices=p,H.positions=f,H.normals=_,H.uvs=m,o&&(H._idx=P),H},t.CreateBox=function(i){for(var n=[new e.Vector3(0,0,1),new e.Vector3(0,0,-1),new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0)],r=[],o=[],s=[],a=[],h=i.width||i.size||1,l=i.height||i.size||1,c=i.depth||i.size||1,u=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,d=i.faceUV||new Array(6),f=i.faceColors,p=[],_=0;6>_;_++)void 0===d[_]&&(d[_]=new e.Vector4(0,0,1,1)),f&&void 0===f[_]&&(f[_]=new e.Color4(1,1,1,1));for(var m=new e.Vector3(h/2,l/2,c/2),g=0;g<n.length;g++){var v=n[g],y=new e.Vector3(v.y,v.z,v.x),b=e.Vector3.Cross(v,y),x=o.length/3;r.push(x),r.push(x+1),r.push(x+2),r.push(x),r.push(x+2),r.push(x+3);var P=v.subtract(y).subtract(b).multiply(m);o.push(P.x,P.y,P.z),s.push(v.x,v.y,v.z),a.push(d[g].z,d[g].w),f&&p.push(f[g].r,f[g].g,f[g].b,f[g].a),P=v.subtract(y).add(b).multiply(m),o.push(P.x,P.y,P.z),s.push(v.x,v.y,v.z),a.push(d[g].x,d[g].w),f&&p.push(f[g].r,f[g].g,f[g].b,f[g].a),P=v.add(y).add(b).multiply(m),o.push(P.x,P.y,P.z),s.push(v.x,v.y,v.z),a.push(d[g].x,d[g].y),f&&p.push(f[g].r,f[g].g,f[g].b,f[g].a),P=v.add(y).subtract(b).multiply(m),o.push(P.x,P.y,P.z),s.push(v.x,v.y,v.z),a.push(d[g].z,d[g].y),f&&p.push(f[g].r,f[g].g,f[g].b,f[g].a)}t._ComputeSides(u,o,r,s,a);var A=new t;if(A.indices=r,A.positions=o,A.normals=s,A.uvs=a,f){var C=u===e.Mesh.DOUBLESIDE?p.concat(p):p;A.colors=C}return A},t.CreateSphere=function(i){for(var n=i.segments||32,r=i.diameterX||i.diameter||1,o=i.diameterY||i.diameter||1,s=i.diameterZ||i.diameter||1,a=i.arc<=0||i.arc>1?1:i.arc||1,h=i.slice<=0?1:i.slice||1,l=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,c=new e.Vector3(r/2,o/2,s/2),u=2+n,d=2*u,f=[],p=[],_=[],m=[],g=0;u>=g;g++){for(var v=g/u,y=v*Math.PI*h,b=0;d>=b;b++){var x=b/d,P=x*Math.PI*2*a,A=e.Matrix.RotationZ(-y),C=e.Matrix.RotationY(P),E=e.Vector3.TransformCoordinates(e.Vector3.Up(),A),T=e.Vector3.TransformCoordinates(E,C),S=T.multiply(c),M=T.divide(c).normalize();p.push(S.x,S.y,S.z),_.push(M.x,M.y,M.z),m.push(x,v)}if(g>0)for(var I=p.length/3,w=I-2*(d+1);I>w+d+2;w++)f.push(w),f.push(w+1),f.push(w+d+1),f.push(w+d+1),f.push(w+1),f.push(w+d+2)}t._ComputeSides(l,p,f,_,m);var R=new t;return R.indices=f,R.positions=p,R.normals=_,R.uvs=m,R},t.CreateCylinder=function(i){var n,r=i.height||2,o=0===i.diameterTop?0:i.diameterTop||i.diameter||1,s=i.diameterBottom||i.diameter||1,a=i.tessellation||24,h=i.subdivisions||1,l=i.hasRings,c=i.enclose,u=i.arc<=0||i.arc>1?1:i.arc||1,d=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,f=i.faceUV||new Array(3),p=i.faceColors,_=1!==u&&c?2:0,m=l?h:1,g=2+(1+_)*m;for(n=0;g>n;n++)p&&void 0===p[n]&&(p[n]=new e.Color4(1,1,1,1));for(n=0;g>n;n++)f&&void 0===f[n]&&(f[n]=new e.Vector4(0,0,1,1));var v,y,b,x,P,A,C=[],E=[],T=[],S=[],M=[],I=2*Math.PI*u/a,w=(s-o)/2/r,R=e.Vector3.Zero(),D=e.Vector3.Zero(),O=e.Vector3.Zero(),L=e.Vector3.Zero(),B=e.Vector3.Zero(),N=e.Axis.Y,F=1,V=1,k=0,z=0;for(x=0;h>=x;x++)for(y=x/h,b=(y*(o-s)+s)/2,F=l&&0!==x&&x!==h?2:1,A=0;F>A;A++){for(l&&(V+=A),c&&(V+=2*A),P=0;a>=P;P++)v=P*I,R.x=Math.cos(-v)*b,R.y=-r/2+y*r,R.z=Math.sin(-v)*b,0===o&&x===h?(D.x=T[T.length-3*(a+1)],D.y=T[T.length-3*(a+1)+1],D.z=T[T.length-3*(a+1)+2]):(D.x=R.x,D.z=R.z,D.y=Math.sqrt(D.x*D.x+D.z*D.z)*w,D.normalize()),0===P&&(O.copyFrom(R),L.copyFrom(D)),E.push(R.x,R.y,R.z),T.push(D.x,D.y,D.z),z=l?k!==V?f[V].y:f[V].w:f[V].y+(f[V].w-f[V].y)*y,S.push(f[V].x+(f[V].z-f[V].x)*P/a,z),p&&M.push(p[V].r,p[V].g,p[V].b,p[V].a);1!==u&&c&&(E.push(R.x,R.y,R.z),E.push(0,R.y,0),E.push(0,R.y,0),E.push(O.x,O.y,O.z),e.Vector3.CrossToRef(N,D,B),B.normalize(),T.push(B.x,B.y,B.z,B.x,B.y,B.z),e.Vector3.CrossToRef(L,N,B),B.normalize(),T.push(B.x,B.y,B.z,B.x,B.y,B.z),z=l?k!==V?f[V+1].y:f[V+1].w:f[V+1].y+(f[V+1].w-f[V+1].y)*y,S.push(f[V+1].x,z),S.push(f[V+1].z,z),z=l?k!==V?f[V+2].y:f[V+2].w:f[V+2].y+(f[V+2].w-f[V+2].y)*y,S.push(f[V+2].x,z),S.push(f[V+2].z,z),p&&(M.push(p[V+1].r,p[V+1].g,p[V+1].b,p[V+1].a),M.push(p[V+1].r,p[V+1].g,p[V+1].b,p[V+1].a),M.push(p[V+2].r,p[V+2].g,p[V+2].b,p[V+2].a),M.push(p[V+2].r,p[V+2].g,p[V+2].b,p[V+2].a))),k!==V&&(k=V)}var V,U=1!==u&&c?a+4:a;for(x=0,V=0;h>V;V++){for(P=0;a>P;P++){var G=x*(U+1)+P,j=(x+1)*(U+1)+P,W=x*(U+1)+(P+1),H=(x+1)*(U+1)+(P+1);C.push(G,j,W),C.push(H,W,j)}1!==u&&c&&(C.push(G+2,j+2,W+2),C.push(H+2,W+2,j+2),C.push(G+4,j+4,W+4),C.push(H+4,W+4,j+4)),x=l?x+2:x+1}var Y=function(t){var i=t?o/2:s/2;if(0!==i){var n,h,l,c,d=t?f[g-1]:f[0];p&&(c=t?p[g-1]:p[0]);var _=E.length/3,m=t?r/2:-r/2,v=new e.Vector3(0,m,0);E.push(v.x,v.y,v.z),T.push(0,t?1:-1,0),S.push(d.x+.5*(d.z-d.x),d.y+.5*(d.w-d.y)),p&&M.push(c.r,c.g,c.b,c.a);var y=new e.Vector2(.5,.5);for(l=0;a>=l;l++){n=2*Math.PI*l*u/a;var b=Math.cos(-n),x=Math.sin(-n);h=new e.Vector3(b*i,m,x*i);var P=new e.Vector2(b*y.x+.5,x*y.y+.5);E.push(h.x,h.y,h.z),T.push(0,t?1:-1,0),S.push(d.x+(d.z-d.x)*P.x,d.y+(d.w-d.y)*P.y),p&&M.push(c.r,c.g,c.b,c.a)}for(l=0;a>l;l++)t?(C.push(_),C.push(_+(l+2)),C.push(_+(l+1))):(C.push(_),C.push(_+(l+1)),C.push(_+(l+2)))}};Y(!1),Y(!0),t._ComputeSides(d,E,C,T,S);var K=new t;return K.indices=C,K.positions=E,K.normals=T,K.uvs=S,p&&(K.colors=M),K},t.CreateTorus=function(i){for(var n=[],r=[],o=[],s=[],a=i.diameter||1,h=i.thickness||.5,l=i.tessellation||16,c=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,u=l+1,d=0;l>=d;d++)for(var f=d/l,p=d*Math.PI*2/l-Math.PI/2,_=e.Matrix.Translation(a/2,0,0).multiply(e.Matrix.RotationY(p)),m=0;l>=m;m++){var g=1-m/l,v=m*Math.PI*2/l+Math.PI,y=Math.cos(v),b=Math.sin(v),x=new e.Vector3(y,b,0),P=x.scale(h/2),A=new e.Vector2(f,g);P=e.Vector3.TransformCoordinates(P,_),x=e.Vector3.TransformNormal(x,_),r.push(P.x,P.y,P.z),o.push(x.x,x.y,x.z),s.push(A.x,A.y);var C=(d+1)%u,E=(m+1)%u;n.push(d*u+m),n.push(d*u+E),n.push(C*u+m),n.push(d*u+E),n.push(C*u+E),n.push(C*u+m)}t._ComputeSides(c,r,n,o,s);var T=new t;return T.indices=n,T.positions=r,T.normals=o,T.uvs=s,T},t.CreateLineSystem=function(e){for(var i=[],n=[],r=e.lines,o=0,s=0;s<r.length;s++)for(var a=r[s],h=0;h<a.length;h++)n.push(a[h].x,a[h].y,a[h].z),h>0&&(i.push(o-1),i.push(o)),o++;var l=new t;return l.indices=i,l.positions=n,l},t.CreateDashedLines=function(i){var n=i.dashSize||3,r=i.gapSize||1,o=i.dashNb||200,s=i.points,a=new Array,h=new Array,l=e.Vector3.Zero(),c=0,u=0,d=0,f=0,p=0,_=0,m=0;for(m=0;m<s.length-1;m++)s[m+1].subtractToRef(s[m],l),c+=l.length();for(d=c/o,f=n*d/(n+r),m=0;m<s.length-1;m++){s[m+1].subtractToRef(s[m],l),u=Math.floor(l.length()/d),l.normalize();for(var g=0;u>g;g++)p=d*g,a.push(s[m].x+p*l.x,s[m].y+p*l.y,s[m].z+p*l.z),a.push(s[m].x+(p+f)*l.x,s[m].y+(p+f)*l.y,s[m].z+(p+f)*l.z),h.push(_,_+1),_+=2}var v=new t;return v.positions=a,v.indices=h,v},t.CreateGround=function(i){var n,r,o=[],s=[],a=[],h=[],l=i.width||1,c=i.height||1,u=i.subdivisions||1;for(n=0;u>=n;n++)for(r=0;u>=r;r++){var d=new e.Vector3(r*l/u-l/2,0,(u-n)*c/u-c/2),f=new e.Vector3(0,1,0);s.push(d.x,d.y,d.z),a.push(f.x,f.y,f.z),h.push(r/u,1-n/u)}for(n=0;u>n;n++)for(r=0;u>r;r++)o.push(r+1+(n+1)*(u+1)),o.push(r+1+n*(u+1)),o.push(r+n*(u+1)),o.push(r+(n+1)*(u+1)),o.push(r+1+(n+1)*(u+1)),o.push(r+n*(u+1));var p=new t;return p.indices=o,p.positions=s,p.normals=a,p.uvs=h,p},t.CreateTiledGround=function(i){function n(t,i,n,s){var a=_.length/3,h=f.w+1;for(r=0;r<f.h;r++)for(o=0;o<f.w;o++){var l=[a+o+r*h,a+(o+1)+r*h,a+(o+1)+(r+1)*h,a+o+(r+1)*h];p.push(l[1]),p.push(l[2]),p.push(l[3]),p.push(l[0]),p.push(l[1]),p.push(l[3])}var c=e.Vector3.Zero(),u=new e.Vector3(0,1,0);for(r=0;r<=f.h;r++)for(c.z=r*(s-i)/f.h+i,o=0;o<=f.w;o++)c.x=o*(n-t)/f.w+t,c.y=0,_.push(c.x,c.y,c.z),m.push(u.x,u.y,u.z),g.push(o/f.w,r/f.h)}var r,o,s,a,h=i.xmin,l=i.zmin,c=i.xmax,u=i.zmax,d=i.subdivisions||{w:1,h:1},f=i.precision||{w:1,h:1},p=[],_=[],m=[],g=[];d.h=d.w<1?1:d.h,d.w=d.w<1?1:d.w,f.w=f.w<1?1:f.w,f.h=f.h<1?1:f.h;var v={w:(c-h)/d.w,h:(u-l)/d.h};for(s=0;s<d.h;s++)for(a=0;a<d.w;a++)n(h+a*v.w,l+s*v.h,h+(a+1)*v.w,l+(s+1)*v.h);var y=new t;return y.indices=p,y.positions=_,y.normals=m,y.uvs=g,y},t.CreateGroundFromHeightMap=function(i){var n,r,o=[],s=[],a=[],h=[];for(n=0;n<=i.subdivisions;n++)for(r=0;r<=i.subdivisions;r++){var l=new e.Vector3(r*i.width/i.subdivisions-i.width/2,0,(i.subdivisions-n)*i.height/i.subdivisions-i.height/2),c=(l.x+i.width/2)/i.width*(i.bufferWidth-1)|0,u=(1-(l.z+i.height/2)/i.height)*(i.bufferHeight-1)|0,d=4*(c+u*i.bufferWidth),f=i.buffer[d]/255,p=i.buffer[d+1]/255,_=i.buffer[d+2]/255,m=.3*f+.59*p+.11*_;l.y=i.minHeight+(i.maxHeight-i.minHeight)*m,s.push(l.x,l.y,l.z),a.push(0,0,0),h.push(r/i.subdivisions,1-n/i.subdivisions)}for(n=0;n<i.subdivisions;n++)for(r=0;r<i.subdivisions;r++)o.push(r+1+(n+1)*(i.subdivisions+1)),o.push(r+1+n*(i.subdivisions+1)),o.push(r+n*(i.subdivisions+1)),o.push(r+(n+1)*(i.subdivisions+1)),o.push(r+1+(n+1)*(i.subdivisions+1)),o.push(r+n*(i.subdivisions+1));t.ComputeNormals(s,o,a);var g=new t;return g.indices=o,g.positions=s,g.normals=a,g.uvs=h,g},t.CreatePlane=function(i){var n=[],r=[],o=[],s=[],a=i.width||i.size||1,h=i.height||i.size||1,l=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,c=a/2,u=h/2;r.push(-c,-u,0),o.push(0,0,-1),s.push(0,0),r.push(c,-u,0),o.push(0,0,-1),s.push(1,0),r.push(c,u,0),o.push(0,0,-1),s.push(1,1),r.push(-c,u,0),o.push(0,0,-1),s.push(0,1),n.push(0),n.push(1),n.push(2),n.push(0),n.push(2),n.push(3),t._ComputeSides(l,r,n,o,s);var d=new t;return d.indices=n,d.positions=r,d.normals=o,d.uvs=s,d},t.CreateDisc=function(i){var n=[],r=[],o=[],s=[],a=i.radius||.5,h=i.tessellation||64,l=i.arc<=0||i.arc>1?1:i.arc||1,c=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE;n.push(0,0,0),s.push(.5,.5);for(var u=2*Math.PI*l,d=u/h,f=0;u>f;f+=d){var p=Math.cos(f),_=Math.sin(f),m=(p+1)/2,g=(1-_)/2;n.push(a*p,a*_,0),s.push(m,g)}1===l&&(n.push(n[3],n[4],n[5]),s.push(s[2],s[3]));for(var v=n.length/3,y=1;v-1>y;y++)r.push(y+1,0,y);t.ComputeNormals(n,r,o),t._ComputeSides(c,n,r,o,s);var b=new t;return b.indices=r,b.positions=n,b.normals=o,b.uvs=s,b},t.CreateIcoSphere=function(i){var n,r=i.sideOrientation||e.Mesh.DEFAULTSIDE,o=i.radius||1,s=void 0===i.flat||i.flat,a=i.subdivisions||4,h=i.radiusX||o,l=i.radiusY||o,c=i.radiusZ||o,u=(1+Math.sqrt(5))/2,d=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],f=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],_=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],m=138/1024,g=239/1024,v=60/1024,y=26/1024,b=-40/1024,x=20/1024,P=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],A=[],C=[],E=[],T=[],S=0,M=new Array(3),I=new Array(3);for(n=0;3>n;n++)M[n]=e.Vector3.Zero(),I[n]=e.Vector2.Zero();for(var w=0;20>w;w++){for(n=0;3>n;n++){var R=f[3*w+n];M[n].copyFromFloats(d[3*p[R]],d[3*p[R]+1],d[3*p[R]+2]),M[n].normalize().scaleInPlace(o),I[n].copyFromFloats(_[2*R]*m+v+P[w]*b,_[2*R+1]*g+y+P[w]*x)}for(var D=function(t,i,n,r){var o=e.Vector3.Lerp(M[0],M[2],i/a),u=e.Vector3.Lerp(M[1],M[2],i/a),d=a===i?M[2]:e.Vector3.Lerp(o,u,t/(a-i));d.normalize();var f;if(s){var p=e.Vector3.Lerp(M[0],M[2],r/a),_=e.Vector3.Lerp(M[1],M[2],r/a);f=e.Vector3.Lerp(p,_,n/(a-r))}else f=new e.Vector3(d.x,d.y,d.z);f.x/=h,f.y/=l,f.z/=c,f.normalize();var m=e.Vector2.Lerp(I[0],I[2],i/a),g=e.Vector2.Lerp(I[1],I[2],i/a),v=a===i?I[2]:e.Vector2.Lerp(m,g,t/(a-i));C.push(d.x*h,d.y*l,d.z*c),E.push(f.x,f.y,f.z),T.push(v.x,v.y),A.push(S),S++},O=0;a>O;O++)for(var L=0;a>L+O;L++)D(L,O,L+1/3,O+1/3),D(L+1,O,L+1/3,O+1/3),D(L,O+1,L+1/3,O+1/3),a>L+O+1&&(D(L+1,O,L+2/3,O+2/3),D(L+1,O+1,L+2/3,O+2/3),D(L,O+1,L+2/3,O+2/3))}t._ComputeSides(r,C,A,E,T);var B=new t;return B.indices=A,B.positions=C,B.normals=E,B.uvs=T,B},t.CreatePolyhedron=function(i){var n=[];n[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},n[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},n[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},n[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},n[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},n[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},n[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},n[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},n[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},n[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},n[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},n[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},n[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},n[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},n[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var r,o,s,a,h,l,c=i.type<0||i.type>=n.length?0:i.type||0,u=i.size,d=i.sizeX||u||1,f=i.sizeY||u||1,p=i.sizeZ||u||1,_=i.custom||n[c],m=_.face.length,g=i.faceUV||new Array(m),v=i.faceColors,y=void 0===i.flat||i.flat,b=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,x=[],P=[],A=[],C=[],E=[],T=0,S=0,M=[],I=0,w=0;if(y)for(w=0;m>w;w++)v&&void 0===v[w]&&(v[w]=new e.Color4(1,1,1,1)),g&&void 0===g[w]&&(g[w]=new e.Vector4(0,0,1,1));if(y)for(w=0;m>w;w++){var R=_.face[w].length;for(s=2*Math.PI/R,a=.5*Math.tan(s/2),h=.5,I=0;R>I;I++)x.push(_.vertex[_.face[w][I]][0]*d,_.vertex[_.face[w][I]][1]*f,_.vertex[_.face[w][I]][2]*p),M.push(T),T++,r=g[w].x+(g[w].z-g[w].x)*(.5+a),o=g[w].y+(g[w].w-g[w].y)*(h-.5),C.push(r,o),l=a*Math.cos(s)-h*Math.sin(s),h=a*Math.sin(s)+h*Math.cos(s),a=l,v&&E.push(v[w].r,v[w].g,v[w].b,v[w].a);for(I=0;R-2>I;I++)P.push(M[0+S],M[I+2+S],M[I+1+S]);S+=R}else{for(I=0;I<_.vertex.length;I++)x.push(_.vertex[I][0]*d,_.vertex[I][1]*f,_.vertex[I][2]*p),C.push(0,0);for(w=0;m>w;w++)for(I=0;I<_.face[w].length-2;I++)P.push(_.face[w][0],_.face[w][I+2],_.face[w][I+1])}t.ComputeNormals(x,P,A),t._ComputeSides(b,x,P,A,C);var D=new t;return D.positions=x,D.indices=P,D.normals=A,D.uvs=C,v&&y&&(D.colors=E),D},t.CreateTorusKnot=function(i){var n,r,o=[],s=[],a=[],h=[],l=i.radius||2,c=i.tube||.5,u=i.radialSegments||32,d=i.tubularSegments||32,f=i.p||2,p=i.q||3,_=0===i.sideOrientation?0:i.sideOrientation||e.Mesh.DEFAULTSIDE,m=function(t){var i=Math.cos(t),n=Math.sin(t),r=p/f*t,o=Math.cos(r),s=l*(2+o)*.5*i,a=l*(2+o)*n*.5,h=l*Math.sin(r)*.5;return new e.Vector3(s,a,h)};for(n=0;u>=n;n++){var g=n%u,v=g/u*2*f*Math.PI,y=m(v),b=m(v+.01),x=b.subtract(y),P=b.add(y),A=e.Vector3.Cross(x,P);for(P=e.Vector3.Cross(A,x),A.normalize(),P.normalize(),r=0;d>r;r++){var C=r%d,E=C/d*2*Math.PI,T=-c*Math.cos(E),S=c*Math.sin(E);s.push(y.x+T*P.x+S*A.x),s.push(y.y+T*P.y+S*A.y),s.push(y.z+T*P.z+S*A.z),h.push(n/u),h.push(r/d)}}for(n=0;u>n;n++)for(r=0;d>r;r++){var M=(r+1)%d,I=n*d+r,w=(n+1)*d+r,R=(n+1)*d+M,D=n*d+M;o.push(D),o.push(w),o.push(I),o.push(D),o.push(R),o.push(w)}t.ComputeNormals(s,o,a),t._ComputeSides(_,s,o,a,h);var O=new t;return O.indices=o,O.positions=s,O.normals=a,O.uvs=h,O},t.ComputeNormals=function(e,t,i){var n=0,r=0,o=0,s=0,a=0,h=0,l=0,c=0,u=0,d=0,f=0,p=0,_=0,m=0;for(n=0;n<e.length;n++)i[n]=0;var g=t.length/3;for(n=0;g>n;n++)p=t[3*n],_=t[3*n+1],m=t[3*n+2],r=e[3*p]-e[3*_],o=e[3*p+1]-e[3*_+1],s=e[3*p+2]-e[3*_+2],a=e[3*m]-e[3*_],h=e[3*m+1]-e[3*_+1],l=e[3*m+2]-e[3*_+2],c=o*l-s*h,u=s*a-r*l,d=r*h-o*a,f=Math.sqrt(c*c+u*u+d*d),f=0===f?1:f,c/=f,u/=f,d/=f,i[3*p]+=c,i[3*p+1]+=u,i[3*p+2]+=d,i[3*_]+=c,i[3*_+1]+=u,i[3*_+2]+=d,i[3*m]+=c,i[3*m+1]+=u,i[3*m+2]+=d;for(n=0;n<i.length/3;n++)c=i[3*n],u=i[3*n+1],d=i[3*n+2],f=Math.sqrt(c*c+u*u+d*d),f=0===f?1:f,c/=f,u/=f,d/=f,i[3*n]=c,i[3*n+1]=u,i[3*n+2]=d},t._ComputeSides=function(t,i,n,r,o){var s,a,h=n.length,l=r.length;switch(t=t||e.Mesh.DEFAULTSIDE){case e.Mesh.FRONTSIDE:break;case e.Mesh.BACKSIDE:var c;for(s=0;h>s;s+=3)c=n[s],n[s]=n[s+2],n[s+2]=c;for(a=0;l>a;a++)r[a]=-r[a];break;case e.Mesh.DOUBLESIDE:for(var u=i.length,d=u/3,f=0;u>f;f++)i[u+f]=i[f];for(s=0;h>s;s+=3)n[s+h]=n[s+2]+d,n[s+1+h]=n[s+1]+d,n[s+2+h]=n[s]+d;for(a=0;l>a;a++)r[l+a]=-r[a];for(var p=o.length,_=0;p>_;_++)o[_+p]=o[_]}},t.ImportVertexData=function(i,n){var r=new t,o=i.positions;o&&r.set(o,e.VertexBuffer.PositionKind);var s=i.normals;s&&r.set(s,e.VertexBuffer.NormalKind);var a=i.uvs;a&&r.set(a,e.VertexBuffer.UVKind);var h=i.uv2s;h&&r.set(h,e.VertexBuffer.UV2Kind);var l=i.uv3s;l&&r.set(l,e.VertexBuffer.UV3Kind);var c=i.uv4s;c&&r.set(c,e.VertexBuffer.UV4Kind);var u=i.uv5s;u&&r.set(u,e.VertexBuffer.UV5Kind);var d=i.uv6s;d&&r.set(d,e.VertexBuffer.UV6Kind);var f=i.colors;f&&r.set(e.Color4.CheckColors4(f,o.length/3),e.VertexBuffer.ColorKind);var p=i.matricesIndices;p&&r.set(p,e.VertexBuffer.MatricesIndicesKind);var _=i.matricesWeights;_&&r.set(_,e.VertexBuffer.MatricesWeightsKind);var m=i.indices;m&&(r.indices=m),n.setAllVerticesData(r,i.updatable)},t}();e.VertexData=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.EnableFor=function(e){e._tags=e._tags||{},e.hasTags=function(){return t.HasTags(e)},e.addTags=function(i){return t.AddTagsTo(e,i)},e.removeTags=function(i){return t.RemoveTagsFrom(e,i)},e.matchesTagsQuery=function(i){return t.MatchesQuery(e,i)}},t.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},t.HasTags=function(t){return!!t._tags&&!e.Tools.IsEmpty(t._tags)},t.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var i=[];for(var n in e._tags)e._tags.hasOwnProperty(n)&&e._tags[n]===!0&&i.push(n);return i.join(" ")}return e._tags},t.AddTagsTo=function(e,i){if(i&&"string"==typeof i){var n=i.split(" ");for(var r in n)t._AddTagTo(e,n[r])}},t._AddTagTo=function(e,i){i=i.trim(),""!==i&&"true"!==i&&"false"!==i&&(i.match(/[\s]/)||i.match(/^([!]|([|]|[&]){2})/)||(t.EnableFor(e),e._tags[i]=!0))},t.RemoveTagsFrom=function(e,i){if(t.HasTags(e)){var n=i.split(" ");for(var r in n)t._RemoveTagFrom(e,n[r])}},t._RemoveTagFrom=function(e,t){delete e._tags[t]},t.MatchesQuery=function(i,n){return void 0===n||(""===n?t.HasTags(i):e.Internals.AndOrNotEvaluator.Eval(n,function(e){return t.HasTags(i)&&i._tags[e]}))},t}();e.Tags=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(){}return e.Eval=function(t,i){return t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,i)}):e._HandleParenthesisContent(t,i),"true"===t||"false"!==t&&e.Eval(t,i)},e._HandleParenthesisContent=function(t,i){i=i||function(e){return"true"===e};var n,r=t.split("||");for(var o in r){var s=e._SimplifyNegation(r[o].trim()),a=s.split("&&");if(a.length>1)for(var h=0;h<a.length;++h){var l=e._SimplifyNegation(a[h].trim());if(n="true"!==l&&"false"!==l?"!"===l[0]?!i(l.substring(1)):i(l):"true"===l,!n){s="false";break}}if(n||"true"===s){n=!0;break}n="true"!==s&&"false"!==s?"!"===s[0]?!i(s.substring(1)):i(s):"true"===s}return n?"true":"false"},e._SimplifyNegation=function(e){return e=e.replace(/^[\s!]+/,function(e){return e=e.replace(/[\s]/g,function(){return""}),e.length%2?"!":""}),e=e.trim(),"!true"===e?e="false":"!false"===e&&(e="true"),e},e}();e.AndOrNotEvaluator=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o,s){this._enabled=!0,this._refCount=0,this._name=i,this._renderTexture=new e.RenderTargetTexture(i,n,t),this.setRenderList(r),this._renderTexture.onBeforeRenderObservable.add(o),this._renderTexture.onAfterRenderObservable.add(s),this._scene=t,this._renderList=r}return t.prototype._incRefCount=function(){return 0===this._refCount&&this._scene.customRenderTargets.push(this._renderTexture),++this._refCount},t.prototype._decRefCount=function(){return this._refCount--,this._refCount<=0&&this._scene.customRenderTargets.splice(this._scene.customRenderTargets.indexOf(this._renderTexture),1),this._refCount},t.prototype._update=function(){this.setRenderList(this._renderList)},t.prototype.setRenderList=function(e){this._renderTexture.renderList=e},t.prototype.getRenderTexture=function(){return this._renderTexture},t}();e.PostProcessRenderPass=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,n){this._engine=e,this._name=t,this._singleInstance=n||!0,this._getPostProcess=i,this._cameras=[],this._indicesForCamera=[],this._postProcesses={},this._renderPasses={},this._renderEffectAsPasses={}}return Object.defineProperty(t.prototype,"isSupported",{get:function(){for(var e in this._postProcesses)if(!this._postProcesses[e].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype._update=function(){for(var e in this._renderPasses)this._renderPasses[e]._update()},t.prototype.addPass=function(e){this._renderPasses[e._name]=e,this._linkParameters()},t.prototype.removePass=function(e){delete this._renderPasses[e._name],this._linkParameters()},t.prototype.addRenderEffectAsPass=function(e){this._renderEffectAsPasses[e._name]=e,this._linkParameters()},t.prototype.getPass=function(e){for(var t in this._renderPasses)if(t===e)return this._renderPasses[e]},t.prototype.emptyPasses=function(){this._renderPasses={},this._linkParameters()},t.prototype._attachCameras=function(t){for(var i,n=e.Tools.MakeArray(t||this._cameras),r=0;r<n.length;r++){var o=n[r],s=o.name;i=this._singleInstance?0:s,this._postProcesses[i]=this._postProcesses[i]||this._getPostProcess();var a=o.attachPostProcess(this._postProcesses[i]);this._indicesForCamera[s]||(this._indicesForCamera[s]=[]),this._indicesForCamera[s].push(a),-1===this._cameras.indexOf(o)&&(this._cameras[s]=o);for(var h in this._renderPasses)this._renderPasses[h]._incRefCount()}this._linkParameters()},t.prototype._detachCameras=function(t){for(var i=e.Tools.MakeArray(t||this._cameras),n=0;n<i.length;n++){var r=i[n],o=r.name;r.detachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o]);var s=this._cameras.indexOf(o);this._indicesForCamera.splice(s,1),this._cameras.splice(s,1);for(var a in this._renderPasses)this._renderPasses[a]._decRefCount()}},t.prototype._enable=function(t){for(var i=e.Tools.MakeArray(t||this._cameras),n=0;n<i.length;n++){for(var r=i[n],o=r.name,s=0;s<this._indicesForCamera[o].length;s++)void 0===r._postProcesses[this._indicesForCamera[o][s]]&&t[n].attachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o][s]);for(var a in this._renderPasses)this._renderPasses[a]._incRefCount()}},t.prototype._disable=function(t){for(var i=e.Tools.MakeArray(t||this._cameras),n=0;n<i.length;n++){
var r=i[n],o=r.Name;r.detachPostProcess(this._postProcesses[this._singleInstance?0:o],this._indicesForCamera[o]);for(var s in this._renderPasses)this._renderPasses[s]._decRefCount()}},t.prototype.getPostProcess=function(e){return this._singleInstance?this._postProcesses[0]:this._postProcesses[e.name]},t.prototype._linkParameters=function(){var e=this;for(var t in this._postProcesses)this.applyParameters&&this.applyParameters(this._postProcesses[t]),this._postProcesses[t].onBeforeRenderObservable.add(function(t){e._linkTextures(t)})},t.prototype._linkTextures=function(e){for(var t in this._renderPasses)e.setTexture(t,this._renderPasses[t].getRenderTexture());for(var i in this._renderEffectAsPasses)e.setTextureFromPostProcess(i+"Sampler",this._renderEffectAsPasses[i].getPostProcess())},t}();e.PostProcessRenderEffect=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this._engine=e,this._name=t,this._renderEffects={},this._renderEffectsForIsolatedPass={},this._cameras=[]}return Object.defineProperty(t.prototype,"isSupported",{get:function(){for(var e in this._renderEffects)if(!this._renderEffects[e].isSupported)return!1;return!0},enumerable:!0,configurable:!0}),t.prototype.addEffect=function(e){this._renderEffects[e._name]=e},t.prototype._enableEffect=function(t,i){var n=this._renderEffects[t];n&&n._enable(e.Tools.MakeArray(i||this._cameras))},t.prototype._disableEffect=function(t,i){var n=this._renderEffects[t];n&&n._disable(e.Tools.MakeArray(i||this._cameras))},t.prototype._attachCameras=function(t,i){var n,r=e.Tools.MakeArray(t||this._cameras),o=[];for(n=0;n<r.length;n++){var s=r[n],a=s.name;-1===this._cameras.indexOf(s)?this._cameras[a]=s:i&&o.push(n)}for(n=0;n<o.length;n++)t.splice(o[n],1);for(var h in this._renderEffects)this._renderEffects[h]._attachCameras(r)},t.prototype._detachCameras=function(t){var i=e.Tools.MakeArray(t||this._cameras);for(var n in this._renderEffects)this._renderEffects[n]._detachCameras(i);for(var r=0;r<i.length;r++)this._cameras.splice(this._cameras.indexOf(i[r]),1)},t.prototype._enableDisplayOnlyPass=function(i,n){var r,o=this,s=e.Tools.MakeArray(n||this._cameras),a=null;for(r in this._renderEffects)if(a=this._renderEffects[r].getPass(i),null!=a)break;if(null!==a){for(r in this._renderEffects)this._renderEffects[r]._disable(s);a._name=t.PASS_SAMPLER_NAME;for(var h=0;h<s.length;h++){var l=s[h],c=l.name;this._renderEffectsForIsolatedPass[c]=this._renderEffectsForIsolatedPass[c]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new e.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,null,o._engine,!0)}),this._renderEffectsForIsolatedPass[c].emptyPasses(),this._renderEffectsForIsolatedPass[c].addPass(a),this._renderEffectsForIsolatedPass[c]._attachCameras(l)}}},t.prototype._disableDisplayOnlyPass=function(i){for(var n=this,r=e.Tools.MakeArray(i||this._cameras),o=0;o<r.length;o++){var s=r[o],a=s.name;this._renderEffectsForIsolatedPass[a]=this._renderEffectsForIsolatedPass[a]||new e.PostProcessRenderEffect(this._engine,t.PASS_EFFECT_NAME,function(){return new e.DisplayPassPostProcess(t.PASS_EFFECT_NAME,1,null,null,n._engine,!0)}),this._renderEffectsForIsolatedPass[a]._disable(s)}for(var h in this._renderEffects)this._renderEffects[h]._enable(r)},t.prototype._update=function(){for(var e in this._renderEffects)this._renderEffects[e]._update();for(var t=0;t<this._cameras.length;t++){var i=this._cameras[t].name;this._renderEffectsForIsolatedPass[i]&&this._renderEffectsForIsolatedPass[i]._update()}},t.prototype.dispose=function(){},t.PASS_EFFECT_NAME="passEffect",t.PASS_SAMPLER_NAME="passSampler",t}();e.PostProcessRenderPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this._renderPipelines={}}return e.prototype.addPipeline=function(e){this._renderPipelines[e._name]=e},e.prototype.attachCamerasToRenderPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n._attachCameras(t,i)},e.prototype.detachCamerasFromRenderPipeline=function(e,t){var i=this._renderPipelines[e];i&&i._detachCameras(t)},e.prototype.enableEffectInPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n._enableEffect(t,i)},e.prototype.disableEffectInPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n._disableEffect(t,i)},e.prototype.enableDisplayOnlyPassInPipeline=function(e,t,i){var n=this._renderPipelines[e];n&&n._enableDisplayOnlyPass(t,i)},e.prototype.disableDisplayOnlyPassInPipeline=function(e,t){var i=this._renderPipelines[e];i&&i._disableDisplayOnlyPass(t)},e.prototype.update=function(){for(var e in this._renderPipelines){var t=this._renderPipelines[e];t.isSupported?t._update():(t.dispose(),delete this._renderPipelines[e])}},e}();e.PostProcessRenderPipelineManager=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.frontColor=new e.Color3(1,1,1),this.backColor=new e.Color3(.1,.1,.1),this.showBackLines=!0,this.renderList=new e.SmartArray(32),this._vertexBuffers={},this._scene=t}return t.prototype._prepareRessources=function(){if(!this._colorShader){this._colorShader=new e.ShaderMaterial("colorShader",this._scene,"color",{attributes:[e.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"]});var t=this._scene.getEngine(),i=e.VertexData.CreateBox(1);this._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(t,i.positions,e.VertexBuffer.PositionKind,!1),this._indexBuffer=t.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4])}},t.prototype.reset=function(){this.renderList.reset()},t.prototype.render=function(){if(0!==this.renderList.length&&(this._prepareRessources(),this._colorShader.isReady())){var t=this._scene.getEngine();t.setDepthWrite(!1),this._colorShader._preBind();for(var i=0;i<this.renderList.length;i++){var n=this.renderList.data[i],r=n.minimum,o=n.maximum,s=o.subtract(r),a=r.add(s.scale(.5)),h=e.Matrix.Scaling(s.x,s.y,s.z).multiply(e.Matrix.Translation(a.x,a.y,a.z)).multiply(n.getWorldMatrix());t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect()),this.showBackLines&&(t.setDepthFunctionToGreaterOrEqual(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.backColor.toColor4()),this._colorShader.bind(h),t.draw(!1,0,24)),t.setDepthFunctionToLess(),this._scene.resetCachedMaterial(),this._colorShader.setColor4("color",this.frontColor.toColor4()),this._colorShader.bind(h),t.draw(!1,0,24)}this._colorShader.unbind(),t.setDepthFunctionToLessOrEqual(),t.setDepthWrite(!0)}},t.prototype.dispose=function(){if(this._colorShader){this._colorShader.dispose();var t=this._vertexBuffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._scene.getEngine()._releaseBuffer(this._indexBuffer)}},t}();e.BoundingBoxRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){this._actionManager=e}return e.prototype.isValid=function(){return!0},e.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},e.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},e.prototype.serialize=function(){},e.prototype._serialize=function(e){return{type:2,children:[],name:e.name,properties:e.properties}},e}();e.Condition=t;var i=function(t){function i(e,n,r,o,s){void 0===s&&(s=i.IsEqual),t.call(this,e),this.propertyPath=r,this.value=o,this.operator=s,this._target=n,this._effectiveTarget=this._getEffectiveTarget(n,this.propertyPath),this._property=this._getProperty(this.propertyPath)}return __extends(i,t),Object.defineProperty(i,"IsEqual",{get:function(){return i._IsEqual},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsDifferent",{get:function(){return i._IsDifferent},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsGreater",{get:function(){return i._IsGreater},enumerable:!0,configurable:!0}),Object.defineProperty(i,"IsLesser",{get:function(){return i._IsLesser},enumerable:!0,configurable:!0}),i.prototype.isValid=function(){switch(this.operator){case i.IsGreater:return this._effectiveTarget[this._property]>this.value;case i.IsLesser:return this._effectiveTarget[this._property]<this.value;case i.IsEqual:case i.IsDifferent:var e;return e=this.value.equals?this.value.equals(this._effectiveTarget[this._property]):this.value===this._effectiveTarget[this._property],this.operator===i.IsEqual?e:!e}return!1},i.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)},{name:"operator",value:i.GetOperatorName(this.operator)}]})},i.GetOperatorName=function(e){switch(e){case i._IsEqual:return"IsEqual";case i._IsDifferent:return"IsDifferent";case i._IsGreater:return"IsGreater";case i._IsLesser:return"IsLesser";default:return""}},i._IsEqual=0,i._IsDifferent=1,i._IsGreater=2,i._IsLesser=3,i}(t);e.ValueCondition=i;var n=function(e){function t(t,i){e.call(this,t),this.predicate=i}return __extends(t,e),t.prototype.isValid=function(){return this.predicate()},t}(t);e.PredicateCondition=n;var r=function(t){function i(e,i,n){t.call(this,e),this.value=n,this._target=i}return __extends(i,t),i.prototype.isValid=function(){return this._target.state===this.value},i.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[e.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]})},i}(t);e.StateCondition=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.triggerOptions=e,e.parameter?(this.trigger=e.trigger,this._triggerParameter=e.parameter):this.trigger=e,this._nextActiveAction=this,this._condition=t}return t.prototype._prepare=function(){},t.prototype.getTriggerParameter=function(){return this._triggerParameter},t.prototype._executeCurrent=function(e){if(this._nextActiveAction._condition){var t=this._nextActiveAction._condition,i=this._actionManager.getScene().getRenderId();if(t._evaluationId===i){if(!t._currentResult)return}else{if(t._evaluationId=i,!t.isValid())return void(t._currentResult=!1);t._currentResult=!0}}this._nextActiveAction.execute(e),this.skipToNextActiveAction()},t.prototype.execute=function(e){},t.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},t.prototype.then=function(e){return this._child=e,e._actionManager=this._actionManager,e._prepare(),e},t.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},t.prototype._getEffectiveTarget=function(e,t){return this._actionManager._getEffectiveTarget(e,t)},t.prototype.serialize=function(e){},t.prototype._serialize=function(e,t){var i={type:1,children:[],name:e.name,properties:e.properties||[]};if(this._child&&this._child.serialize(i),this._condition){var n=this._condition.serialize();return n.children.push(i),t&&t.children.push(n),n}return t&&t.children.push(i),i},t._SerializeValueAsString=function(t){return"number"==typeof t?t.toString():"boolean"==typeof t?t?"true":"false":t instanceof e.Vector2?t.x+", "+t.y:t instanceof e.Vector3?t.x+", "+t.y+", "+t.z:t instanceof e.Color3?t.r+", "+t.g+", "+t.b:t instanceof e.Color4?t.r+", "+t.g+", "+t.b+", "+t.a:t},t._GetTargetProperty=function(t){return{name:"target",targetType:t instanceof e.Mesh?"MeshProperties":t instanceof e.Light?"LightProperties":t instanceof e.Camera?"CameraProperties":"SceneProperties",value:t instanceof e.Scene?"Scene":t.name}},t}();e.Action=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i,n,r,o){this.source=e,this.pointerX=t,this.pointerY=i,this.meshUnderPointer=n,this.sourceEvent=r,this.additionalData=o}return e.CreateNew=function(t,i,n){var r=t.getScene();return new e(t,r.pointerX,r.pointerY,r.meshUnderPointer,i,n)},e.CreateNewFromSprite=function(t,i,n,r){return new e(t,i.pointerX,i.pointerY,i.meshUnderPointer,n,r)},e.CreateNewFromScene=function(t,i){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,i)},e.CreateNewFromPrimitive=function(t,i,n,r){return new e(t,i.x,i.y,null,n,r)},e}();e.ActionEvent=t;var i=function(){function t(e){this.actions=new Array,this._scene=e,e._actionManagers.push(this)}return Object.defineProperty(t,"NothingTrigger",{get:function(){return t._NothingTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickTrigger",{get:function(){return t._OnPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnLeftPickTrigger",{get:function(){return t._OnLeftPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnRightPickTrigger",{get:function(){return t._OnRightPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnCenterPickTrigger",{get:function(){return t._OnCenterPickTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickDownTrigger",{get:function(){return t._OnPickDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickUpTrigger",{get:function(){return t._OnPickUpTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPickOutTrigger",{get:function(){return t._OnPickOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnLongPressTrigger",{get:function(){return t._OnLongPressTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOverTrigger",{get:function(){return t._OnPointerOverTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnPointerOutTrigger",{get:function(){return t._OnPointerOutTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnEveryFrameTrigger",{get:function(){return t._OnEveryFrameTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionEnterTrigger",{get:function(){return t._OnIntersectionEnterTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnIntersectionExitTrigger",{get:function(){return t._OnIntersectionExitTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyDownTrigger",{get:function(){return t._OnKeyDownTrigger},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OnKeyUpTrigger",{get:function(){return t._OnKeyUpTrigger},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var e=this._scene._actionManagers.indexOf(this);e>-1&&this._scene._actionManagers.splice(e,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(e){for(var t=0;t<this.actions.length;t++){var i=this.actions[t];if(e.indexOf(i.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTrigger=function(e){for(var t=0;t<this.actions.length;t++){var i=this.actions[t];if(i.trigger===e)return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[e];if(i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnPointerOutTrigger)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var e=0;e<this.actions.length;e++){var i=this.actions[e];if(i.trigger>=t._OnPickTrigger&&i.trigger<=t._OnPickUpTrigger)return!0}return!1},enumerable:!0,configurable:!0}),t.prototype.registerAction=function(i){return i.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(e.Tools.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(i),i._actionManager=this,i._prepare(),i)},t.prototype.processTrigger=function(e,i){for(var n=0;n<this.actions.length;n++){var r=this.actions[n];if(r.trigger===e){if(e===t.OnKeyUpTrigger||e===t.OnKeyDownTrigger){var o=r.getTriggerParameter();if(o){var s=i.sourceEvent.charCode?i.sourceEvent.charCode:i.sourceEvent.keyCode,a=String.fromCharCode(s).toLowerCase();if(a!==o.toLowerCase())continue}}r._executeCurrent(i)}}},t.prototype._getEffectiveTarget=function(e,t){for(var i=t.split("."),n=0;n<i.length-1;n++)e=e[i[n]];return e},t.prototype._getProperty=function(e){var t=e.split(".");return t[t.length-1]},t.prototype.serialize=function(i){for(var n={children:[],name:i,type:3,properties:[]},r=0;r<this.actions.length;r++){var o={type:0,children:[],name:t.GetTriggerName(this.actions[r].trigger),properties:[]},s=this.actions[r].triggerOptions;s&&"number"!=typeof s&&(s.parameter instanceof e.Node?o.properties.push(e.Action._GetTargetProperty(s.parameter)):o.properties.push({name:"parameter",targetType:null,value:s.parameter})),this.actions[r].serialize(o),n.children.push(o)}return n},t.Parse=function(i,n,r){var o=new e.ActionManager(r);null===n?r.actionManager=o:n.actionManager=o;for(var s=function(t,i){var n=Object.create(e[t].prototype);return n.constructor.apply(n,i),n},a=function(t,i,n,r){if(null===r){var o=parseFloat(i);return"true"===i||"false"===i?"true"===i:isNaN(o)?i:o}for(var s=r.split("."),a=i.split(","),h=0;h<s.length;h++)n=n[s[h]];if("boolean"==typeof n)return"true"===a[0];if("string"==typeof n)return a[0];for(var l=new Array,h=0;h<a.length;h++)l.push(parseFloat(a[h]));return n instanceof e.Vector3?e.Vector3.FromArray(l):n instanceof e.Vector4?e.Vector4.FromArray(l):n instanceof e.Color3?e.Color3.FromArray(l):n instanceof e.Color4?e.Color4.FromArray(l):parseFloat(a[0])},h=function(i,n,l,c,u){if(void 0===u&&(u=null),!i.detached){var d=new Array,f=null,p=null,_=i.combine&&i.combine.length>0;if(2===i.type?d.push(o):d.push(n),_){for(var m=new Array,g=0;g<i.combine.length;g++)h(i.combine[g],t.NothingTrigger,l,c,m);d.push(m)}else for(var v=0;v<i.properties.length;v++){var y=i.properties[v].value,b=i.properties[v].name,x=i.properties[v].targetType;"target"===b?y=f=null!==x&&"SceneProperties"===x?r:r.getNodeByName(y):"parent"===b?y=r.getNodeByName(y):"sound"===b?y=r.getSoundByName(y):"propertyPath"!==b?y=2===i.type&&"operator"===b?e.ValueCondition[y]:a(b,y,f,"value"===b?p:null):p=y,d.push(y)}if(null===u?d.push(l):d.push(null),"InterpolateValueAction"===i.name){var P=d[d.length-2];d[d.length-1]=P,d[d.length-2]=l}var A=s(i.name,d);if(A instanceof e.Condition&&null!==l){var C=new e.DoNothingAction(n,l);c?c.then(C):o.registerAction(C),c=C}null===u?A instanceof e.Condition?(l=A,A=c):(l=null,c?c.then(A):o.registerAction(A)):u.push(A);for(var v=0;v<i.children.length;v++)h(i.children[v],n,l,A,null)}},l=0;l<i.children.length;l++){var c,u=i.children[l];if(u.properties.length>0){var d=u.properties[0].value,f=null===u.properties[0].targetType?d:r.getMeshByName(d);c={trigger:e.ActionManager[u.name],parameter:f}}else c=e.ActionManager[u.name];for(var p=0;p<u.children.length;p++)u.detached||h(u.children[p],c,null,null)}},t.GetTriggerName=function(e){switch(e){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t._NothingTrigger=0,t._OnPickTrigger=1,t._OnLeftPickTrigger=2,t._OnRightPickTrigger=3,t._OnCenterPickTrigger=4,t._OnPickDownTrigger=5,t._OnPickUpTrigger=6,t._OnLongPressTrigger=7,t._OnPointerOverTrigger=8,t._OnPointerOutTrigger=9,t._OnEveryFrameTrigger=10,t._OnIntersectionEnterTrigger=11,t._OnIntersectionExitTrigger=12,t._OnKeyDownTrigger=13,t._OnKeyUpTrigger=14,t._OnPickOutTrigger=15,t.DragMovementThreshold=10,t.LongPressDelay=500,t}();e.ActionManager=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,n,r,o,s,a,h){void 0===o&&(o=1e3),t.call(this,e,s),this.propertyPath=n,this.value=r,this.duration=o,this.stopOtherAnimations=a,this.onInterpolationDone=h,this._target=this._effectiveTarget=i}return __extends(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){var t,i=this._actionManager.getScene(),n=[{frame:0,value:this._effectiveTarget[this._property]},{frame:100,value:this.value}];if("number"==typeof this.value)t=e.Animation.ANIMATIONTYPE_FLOAT;else if(this.value instanceof e.Color3)t=e.Animation.ANIMATIONTYPE_COLOR3;else if(this.value instanceof e.Vector3)t=e.Animation.ANIMATIONTYPE_VECTOR3;else if(this.value instanceof e.Matrix)t=e.Animation.ANIMATIONTYPE_MATRIX;else{if(!(this.value instanceof e.Quaternion))return void e.Tools.Warn("InterpolateValueAction: Unsupported type ("+typeof this.value+")");t=e.Animation.ANIMATIONTYPE_QUATERNION}var r=new e.Animation("InterpolateValueAction",this._property,100*(1e3/this.duration),t,e.Animation.ANIMATIONLOOPMODE_CONSTANT);r.setKeys(n),this.stopOtherAnimations&&i.stopAnimation(this._effectiveTarget),i.beginDirectAnimation(this._effectiveTarget,[r],0,100,!1,1,this.onInterpolationDone)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"InterpolateValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)},{name:"duration",value:e.Action._SerializeValueAsString(this.duration)},{name:"stopOtherAnimations",value:e.Action._SerializeValueAsString(this.stopOtherAnimations)||!1}]},i)},i}(e.Action);e.InterpolateValueAction=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i,n,r){t.call(this,e,r),this.propertyPath=n,this._target=this._effectiveTarget=i}return __extends(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},i)},i}(e.Action);e.SwitchBooleanAction=t;var i=function(t){function i(e,i,n,r){t.call(this,e,r),this.value=n,this._target=i}return __extends(i,t),i.prototype.execute=function(){this._target.state=this.value},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetStateAction",properties:[e.Action._GetTargetProperty(this._target),{name:"value",value:this.value}]},i)},i}(e.Action);e.SetStateAction=i;var n=function(t){function i(e,i,n,r,o){t.call(this,e,o),this.propertyPath=n,this.value=r,this._target=this._effectiveTarget=i}return __extends(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},i.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)}]},i)},i}(e.Action);e.SetValueAction=n;var r=function(t){function i(e,i,n,r,o){t.call(this,e,o),this.propertyPath=n,this.value=r,this._target=this._effectiveTarget=i}return __extends(i,t),i.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),"number"!=typeof this._effectiveTarget[this._property]&&e.Tools.Warn("Warning: IncrementValueAction can only be used with number values")},i.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[e.Action._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:e.Action._SerializeValueAsString(this.value)}]},i)},i}(e.Action);e.IncrementValueAction=r;var o=function(t){function i(e,i,n,r,o,s){t.call(this,e,s),this.from=n,this.to=r,this.loop=o,this._target=i}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){var e=this._actionManager.getScene();e.beginAnimation(this._target,this.from,this.to,this.loop)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[e.Action._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:e.Action._SerializeValueAsString(this.loop)||!1}]},i)},i}(e.Action);e.PlayAnimationAction=o;var s=function(t){function i(e,i,n){t.call(this,e,n),this._target=i}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){var e=this._actionManager.getScene();e.stopAnimation(this._target)},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[e.Action._GetTargetProperty(this._target)]},i)},i}(e.Action);e.StopAnimationAction=s;var a=function(t){function i(i,n){void 0===i&&(i=e.ActionManager.NothingTrigger),t.call(this,i,n)}return __extends(i,t),i.prototype.execute=function(){},i.prototype.serialize=function(e){return t.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},e)},i}(e.Action);e.DoNothingAction=a;var h=function(e){function t(t,i,n){e.call(this,t,n),this.children=i}return __extends(t,e),t.prototype._prepare=function(){for(var e=0;e<this.children.length;e++)this.children[e]._actionManager=this._actionManager,this.children[e]._prepare()},t.prototype.execute=function(e){for(var t=0;t<this.children.length;t++)this.children[t].execute(e)},t.prototype.serialize=function(t){for(var i=e.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},t),n=0;n<this.children.length;n++)i.combine.push(this.children[n].serialize(null));return i},t}(e.Action);e.CombineAction=h;var l=function(e){function t(t,i,n){e.call(this,t,n),this.func=i}return __extends(t,e),t.prototype.execute=function(e){this.func(e)},t}(e.Action);e.ExecuteCodeAction=l;var c=function(t){function i(e,i,n,r){t.call(this,e,r),this._target=i,this._parent=n}return __extends(i,t),i.prototype._prepare=function(){},i.prototype.execute=function(){if(this._target.parent!==this._parent){var t=this._parent.getWorldMatrix().clone();t.invert(),this._target.position=e.Vector3.TransformCoordinates(this._target.position,t),this._target.parent=this._parent}},i.prototype.serialize=function(i){return t.prototype._serialize.call(this,{name:"SetParentAction",properties:[e.Action._GetTargetProperty(this._target),e.Action._GetTargetProperty(this._parent)]},i)},i}(e.Action);e.SetParentAction=c;var u=function(e){function t(t,i,n){e.call(this,t,n),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.play()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"PlaySoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(e.Action);e.PlaySoundAction=u;var d=function(e){function t(t,i,n){e.call(this,t,n),this._sound=i}return __extends(t,e),t.prototype._prepare=function(){},t.prototype.execute=function(){void 0!==this._sound&&this._sound.stop()},t.prototype.serialize=function(t){return e.prototype._serialize.call(this,{name:"StopSoundAction",properties:[{name:"sound",value:this._sound.name}]},t)},t}(e.Action);e.StopSoundAction=d}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o){this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this._totalVertices=0,this._isDisposed=!1,this.id=t,this._engine=i.getEngine(),this._meshes=[],this._scene=i,this._vertexBuffers={},this._indices=[],n?this.setAllVerticesData(n,r):(this._totalVertices=0,this._indices=[]),o&&(o instanceof e.LinesMesh&&(this.boundingBias=new e.Vector2(0,o.intersectionThreshold),this.updateExtend()),this.applyToMesh(o),o.computeWorldMatrix(!0))}return Object.defineProperty(t.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias&&this._boundingBias.equals(e)||(this._boundingBias=e.clone(),this.updateBoundingInfo(!0,null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extend",{get:function(){return this._extend},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEngine=function(){return this._engine},t.prototype.isReady=function(){return this.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||this.delayLoadState===e.Engine.DELAYLOADSTATE_NONE},t.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this.notifyUpdate()},t.prototype.setVerticesData=function(t,i,n,r){var o=new e.VertexBuffer(this._engine,i,t,n,0===this._meshes.length,r);this.setVerticesBuffer(o)},t.prototype.setVerticesBuffer=function(t){var i=t.getKind();if(this._vertexBuffers[i]&&this._vertexBuffers[i].dispose(),this._vertexBuffers[i]=t,i===e.VertexBuffer.PositionKind){var n=t.getData(),r=t.getStrideSize();this._totalVertices=n.length/r,this.updateExtend(n,r);for(var o=this._meshes,s=o.length,a=0;s>a;a++){var h=o[a];h._resetPointsArrayCache(),h._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),h._createGlobalSubMesh(),h.computeWorldMatrix(!0)}}this.notifyUpdate(i)},t.prototype.updateVerticesDataDirectly=function(e,t,i){var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,i),this.notifyUpdate(e))},t.prototype.updateVerticesData=function(t,i,n){var r=this.getVertexBuffer(t);if(r){if(r.update(i),t===e.VertexBuffer.PositionKind){var o=r.getStrideSize();this._totalVertices=i.length/o,this.updateBoundingInfo(n,i)}this.notifyUpdate(t)}},t.prototype.updateBoundingInfo=function(t,i){t&&this.updateExtend(i);for(var n=this._meshes,r=n.length,o=0;r>o;o++){var s=n[o];if(s._resetPointsArrayCache(),t){s._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum);for(var a=0;a<s.subMeshes.length;a++){var h=s.subMeshes[a];h.refreshBoundingInfo()}}}},t.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},t.prototype.getVerticesData=function(e,t){var i=this.getVertexBuffer(e);if(!i)return null;var n=i.getData();if(t&&1!==this._meshes.length){for(var r=n.length,o=[],s=0;r>s;s++)o.push(n[s]);return o}return n},t.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},t.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},t.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},t.prototype.setIndices=function(e,t){this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),void 0!==t&&(this._totalVertices=t);for(var i=this._meshes,n=i.length,r=0;n>r;r++)i[r]._createGlobalSubMesh();this.notifyUpdate()},t.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},t.prototype.getIndices=function(e){if(!this.isReady())return null;var t=this._indices;if(e&&1!==this._meshes.length){for(var i=t.length,n=[],r=0;i>r;r++)n.push(t[r]);return n}return t},t.prototype.getIndexBuffer=function(){
return this.isReady()?this._indexBuffer:null},t.prototype.releaseForMesh=function(e,t){var i=this._meshes,n=i.indexOf(e);if(-1!==n){for(var r in this._vertexBuffers)this._vertexBuffers[r].dispose();this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer)&&(this._indexBuffer=null),i.splice(n,1),e._geometry=null,0===i.length&&t&&this.dispose()}},t.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e);var i=this._meshes;e._geometry=this,this._scene.pushGeometry(this),i.push(e),this.isReady()?this._applyToMesh(e):e._boundingInfo=this._boundingInfo}},t.prototype.updateExtend=function(t,i){void 0===t&&(t=null),t||(t=this._vertexBuffers[e.VertexBuffer.PositionKind].getData()),this._extend=e.Tools.ExtractMinAndMax(t,0,this._totalVertices,this.boundingBias,i)},t.prototype._applyToMesh=function(t){var i=this._meshes.length;for(var n in this._vertexBuffers)1===i&&this._vertexBuffers[n].create(),this._vertexBuffers[n].getBuffer().references=i,n===e.VertexBuffer.PositionKind&&(t._resetPointsArrayCache(),this._extend||this.updateExtend(this._vertexBuffers[n].getData()),t._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(),t._updateBoundingInfo());1===i&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices)),this._indexBuffer&&(this._indexBuffer.references=i)},t.prototype.notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e)},t.prototype.load=function(t,i){var n=this;if(this.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADING){if(this.isReady())return void(i&&i());this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADING,t._addPendingData(this),e.Tools.LoadFile(this.delayLoadingFile,function(r){n._delayLoadingFunction(JSON.parse(r),n),n.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,n._delayInfo=[],t._removePendingData(n);for(var o=n._meshes,s=o.length,a=0;s>a;a++)n._applyToMesh(o[a]);i&&i()},function(){},t.database)}},t.prototype.toLeftHanded=function(){var t=this.getIndices(!1);if(null!=t&&t.length>0){for(var i=0;i<t.length;i+=3){var n=t[i+0];t[i+0]=t[i+2],t[i+2]=n}this.setIndices(t)}var r=this.getVerticesData(e.VertexBuffer.PositionKind,!1);if(null!=r&&r.length>0){for(var i=0;i<r.length;i+=3)r[i+2]=-r[i+2];this.setVerticesData(e.VertexBuffer.PositionKind,r,!1)}var o=this.getVerticesData(e.VertexBuffer.NormalKind,!1);if(null!=o&&o.length>0){for(var i=0;i<o.length;i+=3)o[i+2]=-o[i+2];this.setVerticesData(e.VertexBuffer.NormalKind,o,!1)}},t.prototype.isDisposed=function(){return this._isDisposed},t.prototype.dispose=function(){var t,i=this._meshes,n=i.length;for(t=0;n>t;t++)this.releaseForMesh(i[t]);this._meshes=[];for(var r in this._vertexBuffers)this._vertexBuffers[r].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=e.Engine.DELAYLOADSTATE_NONE,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},t.prototype.copy=function(i){var n=new e.VertexData;n.indices=[];for(var r=this.getIndices(),o=0;o<r.length;o++)n.indices.push(r[o]);var s,a=!1,h=!1;for(s in this._vertexBuffers){var l=this.getVerticesData(s);l instanceof Float32Array?n.set(new Float32Array(l),s):n.set(l.slice(0),s),h||(a=this.getVertexBuffer(s).isUpdatable(),h=!a)}var c=new t(i,this._scene,n,a,null);c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction;for(s in this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(s);return c._boundingInfo=new e.BoundingInfo(this._extend.minimum,this._extend.maximum),c},t.prototype.serialize=function(){var t={};return t.id=this.id,e.Tags.HasTags(this)&&(t.tags=e.Tags.GetTags(this)),t},t.prototype.serializeVerticeData=function(){var t=this.serialize();return this.isVerticesDataPresent(e.VertexBuffer.PositionKind)&&(t.positions=this.getVerticesData(e.VertexBuffer.PositionKind)),this.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(t.normals=this.getVerticesData(e.VertexBuffer.NormalKind)),this.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(t.uvs=this.getVerticesData(e.VertexBuffer.UVKind)),this.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(t.uvs2=this.getVerticesData(e.VertexBuffer.UV2Kind)),this.isVerticesDataPresent(e.VertexBuffer.UV3Kind)&&(t.uvs3=this.getVerticesData(e.VertexBuffer.UV3Kind)),this.isVerticesDataPresent(e.VertexBuffer.UV4Kind)&&(t.uvs4=this.getVerticesData(e.VertexBuffer.UV4Kind)),this.isVerticesDataPresent(e.VertexBuffer.UV5Kind)&&(t.uvs5=this.getVerticesData(e.VertexBuffer.UV5Kind)),this.isVerticesDataPresent(e.VertexBuffer.UV6Kind)&&(t.uvs6=this.getVerticesData(e.VertexBuffer.UV6Kind)),this.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(t.colors=this.getVerticesData(e.VertexBuffer.ColorKind)),this.isVerticesDataPresent(e.VertexBuffer.MatricesIndicesKind)&&(t.matricesIndices=this.getVerticesData(e.VertexBuffer.MatricesIndicesKind),t.matricesIndices._isExpanded=!0),this.isVerticesDataPresent(e.VertexBuffer.MatricesWeightsKind)&&(t.matricesWeights=this.getVerticesData(e.VertexBuffer.MatricesWeightsKind)),t.indices=this.getIndices(),t},t.ExtractFromMesh=function(e,t){var i=e._geometry;return i?i.copy(t):null},t.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16)})},t.ImportGeometry=function(t,i){var n=i.getScene(),r=t.geometryId;if(r){var o=n.getGeometryByID(r);o&&o.applyToMesh(i)}else if(t instanceof ArrayBuffer){var s=i._binaryInfo;if(s.positionsAttrDesc&&s.positionsAttrDesc.count>0){var a=new Float32Array(t,s.positionsAttrDesc.offset,s.positionsAttrDesc.count);i.setVerticesData(e.VertexBuffer.PositionKind,a,!1)}if(s.normalsAttrDesc&&s.normalsAttrDesc.count>0){var h=new Float32Array(t,s.normalsAttrDesc.offset,s.normalsAttrDesc.count);i.setVerticesData(e.VertexBuffer.NormalKind,h,!1)}if(s.uvsAttrDesc&&s.uvsAttrDesc.count>0){var l=new Float32Array(t,s.uvsAttrDesc.offset,s.uvsAttrDesc.count);i.setVerticesData(e.VertexBuffer.UVKind,l,!1)}if(s.uvs2AttrDesc&&s.uvs2AttrDesc.count>0){var c=new Float32Array(t,s.uvs2AttrDesc.offset,s.uvs2AttrDesc.count);i.setVerticesData(e.VertexBuffer.UV2Kind,c,!1)}if(s.uvs3AttrDesc&&s.uvs3AttrDesc.count>0){var u=new Float32Array(t,s.uvs3AttrDesc.offset,s.uvs3AttrDesc.count);i.setVerticesData(e.VertexBuffer.UV3Kind,u,!1)}if(s.uvs4AttrDesc&&s.uvs4AttrDesc.count>0){var d=new Float32Array(t,s.uvs4AttrDesc.offset,s.uvs4AttrDesc.count);i.setVerticesData(e.VertexBuffer.UV4Kind,d,!1)}if(s.uvs5AttrDesc&&s.uvs5AttrDesc.count>0){var f=new Float32Array(t,s.uvs5AttrDesc.offset,s.uvs5AttrDesc.count);i.setVerticesData(e.VertexBuffer.UV5Kind,f,!1)}if(s.uvs6AttrDesc&&s.uvs6AttrDesc.count>0){var p=new Float32Array(t,s.uvs6AttrDesc.offset,s.uvs6AttrDesc.count);i.setVerticesData(e.VertexBuffer.UV6Kind,p,!1)}if(s.colorsAttrDesc&&s.colorsAttrDesc.count>0){var _=new Float32Array(t,s.colorsAttrDesc.offset,s.colorsAttrDesc.count);i.setVerticesData(e.VertexBuffer.ColorKind,_,!1,s.colorsAttrDesc.stride)}if(s.matricesIndicesAttrDesc&&s.matricesIndicesAttrDesc.count>0){var m=new Int32Array(t,s.matricesIndicesAttrDesc.offset,s.matricesIndicesAttrDesc.count);i.setVerticesData(e.VertexBuffer.MatricesIndicesKind,m,!1)}if(s.matricesWeightsAttrDesc&&s.matricesWeightsAttrDesc.count>0){var g=new Float32Array(t,s.matricesWeightsAttrDesc.offset,s.matricesWeightsAttrDesc.count);i.setVerticesData(e.VertexBuffer.MatricesWeightsKind,g,!1)}if(s.indicesAttrDesc&&s.indicesAttrDesc.count>0){var v=new Int32Array(t,s.indicesAttrDesc.offset,s.indicesAttrDesc.count);i.setIndices(v)}if(s.subMeshesAttrDesc&&s.subMeshesAttrDesc.count>0){var y=new Int32Array(t,s.subMeshesAttrDesc.offset,5*s.subMeshesAttrDesc.count);i.subMeshes=[];for(var b=0;b<s.subMeshesAttrDesc.count;b++){var x=y[5*b+0],P=y[5*b+1],A=y[5*b+2],C=y[5*b+3],E=y[5*b+4];new e.SubMesh(x,P,A,C,E,i)}}}else if(t.positions&&t.normals&&t.indices){if(i.setVerticesData(e.VertexBuffer.PositionKind,t.positions,!1),i.setVerticesData(e.VertexBuffer.NormalKind,t.normals,!1),t.uvs&&i.setVerticesData(e.VertexBuffer.UVKind,t.uvs,!1),t.uvs2&&i.setVerticesData(e.VertexBuffer.UV2Kind,t.uvs2,!1),t.uvs3&&i.setVerticesData(e.VertexBuffer.UV3Kind,t.uvs3,!1),t.uvs4&&i.setVerticesData(e.VertexBuffer.UV4Kind,t.uvs4,!1),t.uvs5&&i.setVerticesData(e.VertexBuffer.UV5Kind,t.uvs5,!1),t.uvs6&&i.setVerticesData(e.VertexBuffer.UV6Kind,t.uvs6,!1),t.colors&&i.setVerticesData(e.VertexBuffer.ColorKind,e.Color4.CheckColors4(t.colors,t.positions.length/3),!1),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(e.VertexBuffer.MatricesIndicesKind,t.matricesIndices,!1);else{for(var T=[],b=0;b<t.matricesIndices.length;b++){var S=t.matricesIndices[b];T.push(255&S),T.push((65280&S)>>8),T.push((16711680&S)>>16),T.push(S>>24)}i.setVerticesData(e.VertexBuffer.MatricesIndicesKind,T,!1)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,i.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,t.matricesIndicesExtra,!1);else{for(var T=[],b=0;b<t.matricesIndicesExtra.length;b++){var S=t.matricesIndicesExtra[b];T.push(255&S),T.push((65280&S)>>8),T.push((16711680&S)>>16),T.push(S>>24)}i.setVerticesData(e.VertexBuffer.MatricesIndicesExtraKind,T,!1)}t.matricesWeights&&i.setVerticesData(e.VertexBuffer.MatricesWeightsKind,t.matricesWeights,!1),t.matricesWeightsExtra&&i.setVerticesData(e.VertexBuffer.MatricesWeightsExtraKind,t.matricesWeightsExtra,!1),i.setIndices(t.indices)}if(t.subMeshes){i.subMeshes=[];for(var M=0;M<t.subMeshes.length;M++){var I=t.subMeshes[M];new e.SubMesh(I.materialIndex,I.verticesStart,I.verticesCount,I.indexStart,I.indexCount,i)}}i._shouldGenerateFlatShading&&(i.convertToFlatShadedMesh(),delete i._shouldGenerateFlatShading),i.computeWorldMatrix(!0),n._selectionOctree&&n._selectionOctree.addMesh(i)},t.Parse=function(i,n,r){if(n.getGeometryByID(i.id))return null;var o=new t(i.id,n);return e.Tags.AddTagsTo(o,i.tags),i.delayLoadingFile?(o.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED,o.delayLoadingFile=r+i.delayLoadingFile,o._boundingInfo=new e.BoundingInfo(e.Vector3.FromArray(i.boundingBoxMinimum),e.Vector3.FromArray(i.boundingBoxMaximum)),o._delayInfo=[],i.hasUVs&&o._delayInfo.push(e.VertexBuffer.UVKind),i.hasUVs2&&o._delayInfo.push(e.VertexBuffer.UV2Kind),i.hasUVs3&&o._delayInfo.push(e.VertexBuffer.UV3Kind),i.hasUVs4&&o._delayInfo.push(e.VertexBuffer.UV4Kind),i.hasUVs5&&o._delayInfo.push(e.VertexBuffer.UV5Kind),i.hasUVs6&&o._delayInfo.push(e.VertexBuffer.UV6Kind),i.hasColors&&o._delayInfo.push(e.VertexBuffer.ColorKind),i.hasMatricesIndices&&o._delayInfo.push(e.VertexBuffer.MatricesIndicesKind),i.hasMatricesWeights&&o._delayInfo.push(e.VertexBuffer.MatricesWeightsKind),o._delayLoadingFunction=e.VertexData.ImportVertexData):e.VertexData.ImportVertexData(i,o),n.pushGeometry(o,!0),o},t}();e.Geometry=t;var t;!function(t){var i;!function(i){var n=function(e){function t(t,i,n,r){e.call(this,t,i,null,!1,r),this._canBeRegenerated=n,this._beingRegenerated=!0,this.regenerate(),this._beingRegenerated=!1}return __extends(t,e),t.prototype.canBeRegenerated=function(){return this._canBeRegenerated},t.prototype.regenerate=function(){this._canBeRegenerated&&(this._beingRegenerated=!0,this.setAllVerticesData(this._regenerateVertexData(),!1),this._beingRegenerated=!1)},t.prototype.asNewGeometry=function(t){return e.prototype.copy.call(this,t)},t.prototype.setAllVerticesData=function(t,i){this._beingRegenerated&&e.prototype.setAllVerticesData.call(this,t,!1)},t.prototype.setVerticesData=function(t,i,n){this._beingRegenerated&&e.prototype.setVerticesData.call(this,t,i,!1)},t.prototype._regenerateVertexData=function(){throw new Error("Abstract method")},t.prototype.copy=function(e){throw new Error("Must be overriden in sub-classes.")},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.canBeRegenerated=this.canBeRegenerated(),t},t}(t);i._Primitive=n;var r=function(t){function i(i,n,r,o,s,a,h,l,c){void 0===c&&(c=e.Mesh.DEFAULTSIDE),t.call(this,i,n,h,l),this.pathArray=r,this.closeArray=o,this.closePath=s,this.offset=a,this.side=c}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateRibbon({pathArray:this.pathArray,closeArray:this.closeArray,closePath:this.closePath,offset:this.offset,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.pathArray,this.closeArray,this.closePath,this.offset,this.canBeRegenerated(),null,this.side)},i}(n);i.Ribbon=r;var o=function(i){function n(t,n,r,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),i.call(this,t,n,o,s),this.size=r,this.side=a}return __extends(n,i),n.prototype._regenerateVertexData=function(){return e.VertexData.CreateBox({size:this.size,sideOrientation:this.side})},n.prototype.copy=function(e){return new n(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},n.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.size=this.size,e},n.Parse=function(i,n){if(n.getGeometryByID(i.id))return null;var r=new t.Primitives.Box(i.id,n,i.size,i.canBeRegenerated,null);return e.Tags.AddTagsTo(r,i.tags),n.pushGeometry(r,!0),r},n}(n);i.Box=o;var s=function(i){function n(t,n,r,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),i.call(this,t,n,s,a),this.segments=r,this.diameter=o,this.side=h}return __extends(n,i),n.prototype._regenerateVertexData=function(){return e.VertexData.CreateSphere({segments:this.segments,diameter:this.diameter,sideOrientation:this.side})},n.prototype.copy=function(e){return new n(e,this.getScene(),this.segments,this.diameter,this.canBeRegenerated(),null,this.side)},n.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.segments=this.segments,e.diameter=this.diameter,e},n.Parse=function(i,n){if(n.getGeometryByID(i.id))return null;var r=new t.Primitives.Sphere(i.id,n,i.segments,i.diameter,i.canBeRegenerated,null);return e.Tags.AddTagsTo(r,i.tags),n.pushGeometry(r,!0),r},n}(n);i.Sphere=s;var a=function(t){function i(i,n,r,o,s,a,h){void 0===h&&(h=e.Mesh.DEFAULTSIDE),t.call(this,i,n,s,a),this.radius=r,this.tessellation=o,this.side=h}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateDisc({radius:this.radius,tessellation:this.tessellation,sideOrientation:this.side})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.radius,this.tessellation,this.canBeRegenerated(),null,this.side)},i}(n);i.Disc=a;var h=function(i){function n(t,n,r,o,s,a,h,l,c,u){void 0===h&&(h=1),void 0===u&&(u=e.Mesh.DEFAULTSIDE),i.call(this,t,n,l,c),this.height=r,this.diameterTop=o,this.diameterBottom=s,this.tessellation=a,this.subdivisions=h,this.side=u}return __extends(n,i),n.prototype._regenerateVertexData=function(){return e.VertexData.CreateCylinder({height:this.height,diameterTop:this.diameterTop,diameterBottom:this.diameterBottom,tessellation:this.tessellation,subdivisions:this.subdivisions,sideOrientation:this.side})},n.prototype.copy=function(e){return new n(e,this.getScene(),this.height,this.diameterTop,this.diameterBottom,this.tessellation,this.subdivisions,this.canBeRegenerated(),null,this.side)},n.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.height=this.height,e.diameterTop=this.diameterTop,e.diameterBottom=this.diameterBottom,e.tessellation=this.tessellation,e},n.Parse=function(i,n){if(n.getGeometryByID(i.id))return null;var r=new t.Primitives.Cylinder(i.id,n,i.height,i.diameterTop,i.diameterBottom,i.tessellation,i.subdivisions,i.canBeRegenerated,null);return e.Tags.AddTagsTo(r,i.tags),n.pushGeometry(r,!0),r},n}(n);i.Cylinder=h;var l=function(i){function n(t,n,r,o,s,a,h,l){void 0===l&&(l=e.Mesh.DEFAULTSIDE),i.call(this,t,n,a,h),this.diameter=r,this.thickness=o,this.tessellation=s,this.side=l}return __extends(n,i),n.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorus({diameter:this.diameter,thickness:this.thickness,tessellation:this.tessellation,sideOrientation:this.side})},n.prototype.copy=function(e){return new n(e,this.getScene(),this.diameter,this.thickness,this.tessellation,this.canBeRegenerated(),null,this.side)},n.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.diameter=this.diameter,e.thickness=this.thickness,e.tessellation=this.tessellation,e},n.Parse=function(i,n){if(n.getGeometryByID(i.id))return null;var r=new t.Primitives.Torus(i.id,n,i.diameter,i.thickness,i.tessellation,i.canBeRegenerated,null);return e.Tags.AddTagsTo(r,i.tags),n.pushGeometry(r,!0),r},n}(n);i.Torus=l;var c=function(i){function n(e,t,n,r,o,s,a){i.call(this,e,t,s,a),this.width=n,this.height=r,this.subdivisions=o}return __extends(n,i),n.prototype._regenerateVertexData=function(){return e.VertexData.CreateGround({width:this.width,height:this.height,subdivisions:this.subdivisions})},n.prototype.copy=function(e){return new n(e,this.getScene(),this.width,this.height,this.subdivisions,this.canBeRegenerated(),null)},n.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.width=this.width,e.height=this.height,e.subdivisions=this.subdivisions,e},n.Parse=function(i,n){if(n.getGeometryByID(i.id))return null;var r=new t.Primitives.Ground(i.id,n,i.width,i.height,i.subdivisions,i.canBeRegenerated,null);return e.Tags.AddTagsTo(r,i.tags),n.pushGeometry(r,!0),r},n}(n);i.Ground=c;var u=function(t){function i(e,i,n,r,o,s,a,h,l,c){t.call(this,e,i,l,c),this.xmin=n,this.zmin=r,this.xmax=o,this.zmax=s,this.subdivisions=a,this.precision=h}return __extends(i,t),i.prototype._regenerateVertexData=function(){return e.VertexData.CreateTiledGround({xmin:this.xmin,zmin:this.zmin,xmax:this.xmax,zmax:this.zmax,subdivisions:this.subdivisions,precision:this.precision})},i.prototype.copy=function(e){return new i(e,this.getScene(),this.xmin,this.zmin,this.xmax,this.zmax,this.subdivisions,this.precision,this.canBeRegenerated(),null)},i}(n);i.TiledGround=u;var d=function(i){function n(t,n,r,o,s,a){void 0===a&&(a=e.Mesh.DEFAULTSIDE),i.call(this,t,n,o,s),this.size=r,this.side=a}return __extends(n,i),n.prototype._regenerateVertexData=function(){return e.VertexData.CreatePlane({size:this.size,sideOrientation:this.side})},n.prototype.copy=function(e){return new n(e,this.getScene(),this.size,this.canBeRegenerated(),null,this.side)},n.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.size=this.size,e},n.Parse=function(i,n){if(n.getGeometryByID(i.id))return null;var r=new t.Primitives.Plane(i.id,n,i.size,i.canBeRegenerated,null);return e.Tags.AddTagsTo(r,i.tags),n.pushGeometry(r,!0),r},n}(n);i.Plane=d;var f=function(i){function n(t,n,r,o,s,a,h,l,c,u,d){void 0===d&&(d=e.Mesh.DEFAULTSIDE),i.call(this,t,n,c,u),this.radius=r,this.tube=o,this.radialSegments=s,this.tubularSegments=a,this.p=h,this.q=l,this.side=d}return __extends(n,i),n.prototype._regenerateVertexData=function(){return e.VertexData.CreateTorusKnot({radius:this.radius,tube:this.tube,radialSegments:this.radialSegments,tubularSegments:this.tubularSegments,p:this.p,q:this.q,sideOrientation:this.side})},n.prototype.copy=function(e){return new n(e,this.getScene(),this.radius,this.tube,this.radialSegments,this.tubularSegments,this.p,this.q,this.canBeRegenerated(),null,this.side)},n.prototype.serialize=function(){var e=i.prototype.serialize.call(this);return e.radius=this.radius,e.tube=this.tube,e.radialSegments=this.radialSegments,e.tubularSegments=this.tubularSegments,e.p=this.p,e.q=this.q,e},n.Parse=function(i,n){if(n.getGeometryByID(i.id))return null;var r=new t.Primitives.TorusKnot(i.id,n,i.radius,i.tube,i.radialSegments,i.tubularSegments,i.p,i.q,i.canBeRegenerated,null);return e.Tags.AddTagsTo(r,i.tags),n.pushGeometry(r,!0),r},n}(n);i.TorusKnot=f}(i=t.Primitives||(t.Primitives={}))}(t=e.Geometry||(e.Geometry={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n){t.call(this,i,n),this.generateOctree=!1,this._worldInverse=new e.Matrix}return __extends(i,t),Object.defineProperty(i.prototype,"subdivisions",{get:function(){return this._subdivisions},enumerable:!0,configurable:!0}),i.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisions=e,this.subdivide(this._subdivisions),this.createOrUpdateSubmeshesOctree(t)},i.prototype.getHeightAtCoordinates=function(e,t){if(e-=this.position.x,t-=this.position.z,e/=this.scaling.x,t/=this.scaling.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var i=this._getFacetAt(e,t),n=-(i.x*e+i.z*t+i.w)/i.y;return n*this.scaling.y+this.position.y},i.prototype.getNormalAtCoordinates=function(t,i){var n=new e.Vector3(0,1,0);return this.getNormalAtCoordinatesToRef(t,i,n),n},i.prototype.getNormalAtCoordinatesToRef=function(e,t,i){if(e-=this.position.x,t-=this.position.z,e/=this.scaling.x,t/=this.scaling.z,!(e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)){this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var n=this._getFacetAt(e,t);i.x=n.x,i.y=n.y,i.z=n.z}},i.prototype.updateCoordinateHeights=function(){this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads()},i.prototype._getFacetAt=function(e,t){var i,n=Math.floor((e+this._maxX)*this._subdivisions/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisions/this._height+this._subdivisions),o=this._heightQuads[r*this._subdivisions+n];return i=t<o.slope.x*e+o.slope.y?o.facet1:o.facet2},i.prototype._initHeightQuads=function(){this._heightQuads=new Array;for(var t=0;t<this._subdivisions;t++)for(var i=0;i<this._subdivisions;i++){var n={slope:e.Vector2.Zero(),facet1:new e.Vector4(0,0,0,0),facet2:new e.Vector4(0,0,0,0)};this._heightQuads[t*this._subdivisions+i]=n}},i.prototype._computeHeightQuads=function(){for(var t=this.getVerticesData(e.VertexBuffer.PositionKind),i=e.Tmp.Vector3[0],n=e.Tmp.Vector3[1],r=e.Tmp.Vector3[2],o=e.Tmp.Vector3[3],s=e.Tmp.Vector3[4],a=e.Tmp.Vector3[5],h=e.Tmp.Vector3[6],l=e.Tmp.Vector3[7],c=e.Tmp.Vector3[8],u=0,d=0,f=0,p=0,_=0,m=0,g=0,v=0;v<this._subdivisions;v++)for(var y=0;y<this._subdivisions;y++){u=3*y,d=v*(this._subdivisions+1)*3,f=(v+1)*(this._subdivisions+1)*3,i.x=t[d+u],i.y=t[d+u+1],i.z=t[d+u+2],n.x=t[d+u+3],n.y=t[d+u+4],n.z=t[d+u+5],r.x=t[f+u],r.y=t[f+u+1],r.z=t[f+u+2],o.x=t[f+u+3],o.y=t[f+u+4],o.z=t[f+u+5],p=(o.z-i.z)/(o.x-i.x),_=i.z-p*i.x,n.subtractToRef(i,s),r.subtractToRef(i,a),o.subtractToRef(i,h),e.Vector3.CrossToRef(h,a,l),e.Vector3.CrossToRef(s,h,c),l.normalize(),c.normalize(),m=-(l.x*i.x+l.y*i.y+l.z*i.z),g=-(c.x*n.x+c.y*n.y+c.z*n.z);var b=this._heightQuads[v*this._subdivisions+y];b.slope.copyFromFloats(p,_),b.facet1.copyFromFloats(l.x,l.y,l.z,m),b.facet2.copyFromFloats(c.x,c.y,c.z,g)}},i}(e.Mesh);e.GroundMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s){void 0===r&&(r=null),t.call(this,i,n,r,o,s),this.color=new e.Color3(1,1,1),this.alpha=1,this._positionBuffer={},o&&(this.color=o.color.clone(),this.alpha=o.alpha),this._intersectionThreshold=.1,this._colorShader=new e.ShaderMaterial("colorShader",n,"color",{attributes:[e.VertexBuffer.PositionKind],uniforms:["worldViewProjection","color"],needAlphaBlending:!0}),this._positionBuffer[e.VertexBuffer.PositionKind]=null}return __extends(i,t),Object.defineProperty(i.prototype,"intersectionThreshold",{get:function(){return this._intersectionThreshold},set:function(t){this._intersectionThreshold!==t&&(this._intersectionThreshold=t,this.geometry&&(this.geometry.boundingBias=new e.Vector2(0,t)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._colorShader},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.createInstance=function(t){return e.Tools.Log("LinesMeshes do not support createInstance."),null},i.prototype._bind=function(t,i,n){var r=this.getScene().getEngine();this._positionBuffer[e.VertexBuffer.PositionKind]=this._geometry.getVertexBuffer(e.VertexBuffer.PositionKind),r.bindBuffers(this._positionBuffer,this._geometry.getIndexBuffer(),this._colorShader.getEffect()),this._colorShader.setColor4("color",this.color.toColor4(this.alpha))},i.prototype._draw=function(e,t,i){if(this._geometry&&this._geometry.getVertexBuffers()&&this._geometry.getIndexBuffer()){var n=this.getScene().getEngine();n.draw(!1,e.indexStart,e.indexCount)}},i.prototype.dispose=function(e){this._colorShader.dispose(),t.prototype.dispose.call(this,e)},i.prototype.clone=function(e,t,n){return new i(e,this.getScene(),t,this,n)},i}(e.Mesh);e.LinesMesh=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){var n=this;void 0===t&&(t=""),void 0===i&&(i="black"),this._renderingCanvas=e,this._loadingText=t,this._loadingDivBackgroundColor=i,this._resizeLoadingUI=function(){var e=n._renderingCanvas.getBoundingClientRect();n._loadingDiv.style.position="absolute",n._loadingDiv.style.left=e.left+"px",n._loadingDiv.style.top=e.top+"px",n._loadingDiv.style.width=e.width+"px",n._loadingDiv.style.height=e.height+"px"}}return e.prototype.displayLoadingUI=function(){var e=this;if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingTextDiv=document.createElement("div"),this._loadingTextDiv.style.position="absolute",this._loadingTextDiv.style.left="0",this._loadingTextDiv.style.top="50%",this._loadingTextDiv.style.marginTop="80px",this._loadingTextDiv.style.width="100%",this._loadingTextDiv.style.height="20px",this._loadingTextDiv.style.fontFamily="Arial",this._loadingTextDiv.style.fontSize="14px",this._loadingTextDiv.style.color="white",this._loadingTextDiv.style.textAlign="center",this._loadingTextDiv.innerHTML="Loading",this._loadingDiv.appendChild(this._loadingTextDiv),this._loadingTextDiv.innerHTML=this._loadingText;var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAARbSURBVHhe7Z09aFNRFMc716kuLrq4FdyLq4Wi4CAoRQcR0UJBUBdRiuLSIYMo6CA4FF2sgw6CFAdFUOpSQYcWO4hD26UQCfXrIQrx/JJzw1OSWq3NPeL/B4Fy+0jg/HO+7j3vpUcI8b/Q39+/49ihfWdPHT94Yf/e3Se3bd263f8lus218TPn6vV6Ya8Wi/MzNRNmj18iusX9W1evmP1/EKNEIVG6CMbG6E3bt+fT++pHha8NoHdT72bLE8NDg7tGU64gLLndV4Wc4m8j/pS+vr4tGB/DT16v3Fyr8dvBe/jbit8BL0AES9LX1iPAz+BR/hFiLVCynj95dPzNy6fv3IZ/k4L3948Sq7FzYGBg4vLFGxitabuOFCbWNKGrMnbiUuo18KaV6tIHv6YtvL9/nOgE31jCktmrY7k6+/zhE4yP4Vf7hiNqh/BWWEl8mzDol4p22Lf7cIdvdUMEvv0Y2S9fE5S1hLzpqTsPkiep//gFGPnR3Yl7GL5p/xYFBrTwM+iXio3GqpwDGL5p/xYNIX7XG8Q6IJRgdIzf1KBBgafII7oMidhyQtVFaMA2Bt7il4huQRhaXphbcR2g4RXqBzKAGHiCCwGFVUAj/m/RTRDj29cvn10I0PZ3LghH5f4CL1EFlQmqqXK3jDDKFxmhQ3Yt6oQseUZGKmMnTpsOqc8o1F9kBOMjQlOLeqEeIyOc6JV6jYLJD/+XyIFvnzdgl9aXRQ5I2qZDK1SpospMqaoqON/wZZGDciLnMMiXRS7IF4hhqMTNTdk7CFu+LHLhR7BQqBvPDJUUQqCGvCMATHUgBmhWNgApmdOda9YpM+VwRYfuyyIXDK8hBlilNerLIheMZCKGwlUAyru6GlwOgPUbRxADdJ9FAChxXY864viyyEXqPxhc0M2TAfAbatSdRyHtXymhByEdRnE3ky+JnHAIhSA0h74kckETmHoQbSgGwJrCIRMEPSRIBCRIMAhZaYhaggQhJXUJEoRU9mofKwh+F22dLRRfEjlJM7w6KQwCoQpBOKTyJZETjmwRxKqtGV8SOSkNOGjKPQppBEgDDkFgpxdBVGkFgaYQQXRIFQSObk0P5ZFIpAZRHXsQ0r0hCluBWKkuvVbYCkQaCdL5ehBScudJP4yY+rLISdps1NBDEJKXMMmoSfggWC4ZQRR17oFYXph7hSiquIKQ+hJGTX1J5MYSPD/GVdNzsgLBwZVCVyAQAkF0ohiI/c1fS6tNXq9UfEnkhudmIQolsS+J3Hh/UtNDzQLhj42VKJFInqLwFYiUU5ToA+HdfI0JevUpQUAIn+vSz2lHIuUV/dJOIHhOY/IWVWGBIHQtzs88s9zyWBuTgcBLzGOmeNnfF/QslSDgMeQW85i3DOQxuipxAkCyZ8SIm4Omp+7MMlCB59j6sKZcMoM4iIEoeI2J9AKxrFobZx0v4vYInuHFS4J1GQRCAGaLEYQXfyMML5XSQgghhBBCCCH+cXp6vgNhKpSKX/XdOAAAAABJRU5ErkJggg==",t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.marginLeft="-50px",t.style.marginTop="-50px",t.style.transition="transform 1.0s ease",t.style.webkitTransition="-webkit-transform 1.0s ease";var i=360,n=function(){i+=360,t.style.transform="rotateZ("+i+"deg)",t.style.webkitTransform="rotateZ("+i+"deg)"};t.addEventListener("transitionend",n),t.addEventListener("webkitTransitionEnd",n),this._loadingDiv.appendChild(t);var r=new Image;r.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAYJSURBVHhe7Zy/qx1FFMff/2Av2Nvbi4WFiiAEY/OQ2IgQsbCJQoqkCAgpFLXyoZURLfwBIiIpgqZJoYQYlWelNsIrNOxDJcrzfHe+G97dnTl75u7euzv7zgcWHrlnZmfOmXPmzI/NjuM4juM4juM4juM4juM4juM4juM4juM45fPic08/uHf5/CvffH7lnT8PfrtxdHS0n3p+/fHGl5+89/prr5599iEWd8bg0rkXHoFyqehKnlxQpjYSDHTm9JMPsGrHylOPPXofvICKXMcIGtXdf/76AYbm6xyNW9e/eAtKC7rbKLXnvHHx5Sf4auc4Ek7OQkFU1Dap/vv37k/wSjblZANFiFIGzw98hhizwqBgs04mCBdQRNCHidoAEtY+lLIvtSdoGFeyql2ZH57HBH4sE7O+o/r9l+8/ZXUni68+2jsHBQQ9qNRGeP/tSxdSYQX/roUcpL4/f3vtM9TD+jTq92n1LQ7jxF1hhGPtwWL3gGccy8JuS1r8sVWBGXNVdSKMYjBGPUJjCzooiGuSpnwlnnOGP2dhHRSLNgpHp2oMKIriK8TmG4Qh/rwW8D6pps9b9im+LDDipXOqMVJrAngBfg9i98gevWKA+/nnCod3Dr5GfaHaDgidVym6HKRjGIkpqthcAVKGxNqBImbEo66kjCih8AOpNmkUmbMuUrR8kEqiU6FvHZLGAPJ71JCYSyhiBqmwFE2GoD6jLGIfDHtG6EzoU4dK21PCqIRMEF0FGRjFzGDtIkXVAdATvsqfT9CJ0JcOFdYiFIsiMlqYy1YOFpQo2OddqBtyEaq9y+efoVh5oPHoROjLKn0j3JIE5Ka8UqZRtGrMnneX6yVofOhDh94MSbznTcpqmDOt1vyQzOgaJAF4F3JBfIXesrNEGWWmjIX7UBZ6jRJbBMLg/DmJiKUGVHleIpnVNTa+jakzkAviJqLhi4MC9XQGBrZeKJZESSrKy7ik0VGFWhQBRDTHIACKQ5l9nAjy75gya4a2w+Jhs0FJdc0xX/GwUbAqFBkZi7QpJ2w16WUbjFyK9MJF3KaoEM74KhVtLrQOrsmRxkbdHEqmSC/c+EuGnIFkjW7Ih2Kr4CCMIvNG2hrrgLpCjiFloooYCjyYrzCRyvhyBthkIPuQtsZGdnbMTezyDiU71KTC5zr7aVsHbsz2tllrEkS5UHwU1tq1HbtPW4UbeB0O7xx8R5EsMJql+BheUmHjkNVmIRP7LutoM3+D4O4tG7vCkNO9ESZ4lL3J6rKRMPx4qKbD/A0icf8CG7tC7kTahnMTwleuYSrsS7GatRAvfZh1tTm5BmmQCdZ8a0Sefe28xUrRBkmFLKy8KTIKUDRX0Y1xagPgwbaIdeFnQULmKak3xvwNMkVGgok/N5XNoehJvejRlCDl9escI28dJU0tZ++nBTJE9mEF647x5Ehbo4s5hDOKFIU0PdofeA5F5k1q63zIWmQqNI/P3ZubjFTqKxQ3jyjHAOX0RdlgVO9hzRFpczRcjZ3Gbxxpc7Qj6+5pTYF2OFXawNI+yDGf1k2NcvOlzBQeDQ/t7zD7DsEDpJ2xATXaNtDWUS4IzP4DS2ljajAVu57SUkYw245ptxZxA5JiZaJ0DswudGn3kYUy54426EjoT4dZfYbccxC2nI92cDkZHQr96jD4AGkMDKeSy/COBsRe6VTSKFN6irLeaCh3IteQjt1E5+oudsG/b/2DfZ5AqsYo8vMDK9LB1HzSsLWvlGThdxXvC6+NsqyPPWP0pMINtbdsajfVeC6f/GZ+cdAofQoB1d+Hf9waY98I7+RXWab3Lt4zYkjHtTnlOLXHYMsCh1zWeQYehu1zfNPOOiys/d91LAKEBSgh6MJMbSA82AaHofDgAIwbgvVvlLNS11nModMm4UZergLHZBZrodmBuA3lBB1thdorSjkOmATMDwg/UBQVtglqQyx6fbEJ+H3IWIapjYAjAfeIgeCMHldueJvFaqDaAHhwf8qNsEEQ1iQbOoUUGIbCLRc8+Bvfp4jyd2FEijuO4ziO4ziO4ziO4ziO4ziO4ziO4ziOUzw7O/8D0P7rcZ/GEboAAAAASUVORK5CYII=",r.style.position="absolute",r.style.left="50%",r.style.top="50%",r.style.marginLeft="-50px",r.style.marginTop="-50px",this._loadingDiv.appendChild(r),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor,document.body.appendChild(this._loadingDiv),setTimeout(function(){e._loadingDiv.style.opacity="1",t.style.transform="rotateZ(360deg)",t.style.webkitTransform="rotateZ(360deg)"},0)}},e.prototype.hideLoadingUI=function(){var e=this;if(this._loadingDiv){var t=function(){e._loadingDiv&&(document.body.removeChild(e._loadingDiv),window.removeEventListener("resize",e._resizeLoadingUI),e._loadingDiv=null)};this._loadingDiv.style.opacity="0",this._loadingDiv.addEventListener("transitionend",t)}},Object.defineProperty(e.prototype,"loadingUIText",{set:function(e){this._loadingText=e,this._loadingTextDiv&&(this._loadingTextDiv.innerHTML=this._loadingText)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadingUIBackgroundColor",{get:function(){return this._loadingDivBackgroundColor},set:function(e){this._loadingDivBackgroundColor=e,this._loadingDiv&&(this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor);
},enumerable:!0,configurable:!0}),e}();e.DefaultLoadingScreen=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._audioContext=null,this._audioContextInitialized=!1,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.unlocked=!1,"undefined"==typeof window.AudioContext&&"undefined"==typeof window.webkitAudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this.canUseWebAudio=!0),/iPad|iPhone|iPod/.test(navigator.platform)?this._unlockiOSaudio():this.unlocked=!0}return Object.defineProperty(t.prototype,"audioContext",{get:function(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext},enumerable:!0,configurable:!0}),t.prototype._unlockiOSaudio=function(){var e=this,t=function(){var i=e.audioContext.createBuffer(1,1,22050),n=e.audioContext.createBufferSource();n.buffer=i,n.connect(e.audioContext.destination),n.start(0),setTimeout(function(){n.playbackState!==n.PLAYING_STATE&&n.playbackState!==n.FINISHED_STATE||(e.unlocked=!0,window.removeEventListener("touchend",t,!1),e.onAudioUnlocked&&e.onAudioUnlocked())},0)};window.addEventListener("touchend",t,!1)},t.prototype._initializeAudioContext=function(){try{this.canUseWebAudio&&(this._audioContext=new AudioContext,this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this._audioContext.destination),this._audioContextInitialized=!0)}catch(t){this.canUseWebAudio=!1,e.Tools.Error("Web Audio: "+t.message)}},t.prototype.dispose=function(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1},t.prototype.getGlobalVolume=function(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1},t.prototype.setGlobalVolume=function(e){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=e)},t.prototype.connectToAnalyser=function(e){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser=e,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))},t}();e.AudioEngine=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o){var s=this;this.autoplay=!1,this.loop=!1,this.useCustomAttenuation=!1,this.spatialSound=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._startOffset=0,this._position=e.Vector3.Zero(),this._localDirection=new e.Vector3(1,0,0),this._volume=1,this._isLoaded=!1,this._isReadyToPlay=!1,this.isPlaying=!1,this.isPaused=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this.name=t,this._scene=n,this._readyToPlayCallback=r,this._customAttenuationFunction=function(e,t,i,n,r){return i>t?e*(1-t/i):0},o&&(this.autoplay=o.autoplay||!1,this.loop=o.loop||!1,void 0!==o.volume&&(this._volume=o.volume),this.spatialSound=o.spatialSound||!1,this.maxDistance=o.maxDistance||100,this.useCustomAttenuation=o.useCustomAttenuation||!1,this.rolloffFactor=o.rolloffFactor||1,this.refDistance=o.refDistance||1,this.distanceModel=o.distanceModel||"linear",this._playbackRate=o.playbackRate||1,this._streaming=o.streaming||!1),e.Engine.audioEngine.canUseWebAudio?(this._soundGain=e.Engine.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._ouputAudioNode=this._soundGain,this.spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.AddSound(this),i&&("string"==typeof i?this._streaming?(this._htmlAudioElement=new Audio(i),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,this._htmlAudioElement.crossOrigin="anonymous",this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",function(){s._isReadyToPlay=!0,s.autoplay&&s.play(),s._readyToPlayCallback&&s._readyToPlayCallback()}),document.body.appendChild(this._htmlAudioElement)):e.Tools.LoadFile(i,function(e){s._soundLoaded(e)},null,this._scene.database,!0):i instanceof ArrayBuffer?i.byteLength>0&&this._soundLoaded(i):e.Tools.Error("Parameter must be a URL to the sound or an ArrayBuffer of the sound."))):(this._scene.mainSoundTrack.AddSound(this),e.Engine.audioEngine.WarnedWebAudioUnsupported||(e.Tools.Error("Web Audio is not supported by your browser."),e.Engine.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&window.setTimeout(function(){s._readyToPlayCallback()},1e3))}return t.prototype.dispose=function(){e.Engine.audioEngine.canUseWebAudio&&this._isReadyToPlay&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.RemoveSound(this):this._scene.soundTracks[this.soundTrackId].RemoveSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement)),this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedMesh=null))},t.prototype._soundLoaded=function(t){var i=this;this._isLoaded=!0,e.Engine.audioEngine.audioContext.decodeAudioData(t,function(e){i._audioBuffer=e,i._isReadyToPlay=!0,i.autoplay&&i.play(),i._readyToPlayCallback&&i._readyToPlayCallback()},function(){e.Tools.Error("Error while decoding audio data for: "+i.name)})},t.prototype.setAudioBuffer=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._audioBuffer=t,this._isReadyToPlay=!0)},t.prototype.updateOptions=function(e){e&&(this.loop=e.loop||this.loop,this.maxDistance=e.maxDistance||this.maxDistance,this.useCustomAttenuation=e.useCustomAttenuation||this.useCustomAttenuation,this.rolloffFactor=e.rolloffFactor||this.rolloffFactor,this.refDistance=e.refDistance||this.refDistance,this.distanceModel=e.distanceModel||this.distanceModel,this._playbackRate=e.playbackRate||this._playbackRate,this._updateSpatialParameters(),this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate))},t.prototype._createSpatialParameters=function(){e.Engine.audioEngine.canUseWebAudio&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=e.Engine.audioEngine.audioContext.createPanner(),this._updateSpatialParameters(),this._soundPanner.connect(this._ouputAudioNode),this._inputAudioNode=this._soundPanner)},t.prototype._updateSpatialParameters=function(){this.spatialSound&&(this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel))},t.prototype.switchPanningModelToHRTF=function(){this._panningModel="HRTF",this._switchPanningModel()},t.prototype.switchPanningModelToEqualPower=function(){this._panningModel="equalpower",this._switchPanningModel()},t.prototype._switchPanningModel=function(){e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&(this._soundPanner.panningModel=this._panningModel)},t.prototype.connectToSoundTrackAudioNode=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._isOutputConnected&&this._ouputAudioNode.disconnect(),this._ouputAudioNode.connect(t),this._isOutputConnected=!0)},t.prototype.setDirectionalCone=function(t,i,n){return t>i?void e.Tools.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=t,this._coneOuterAngle=i,this._coneOuterGain=n,this._isDirectional=!0,void(this.isPlaying&&this.loop&&(this.stop(),this.play())))},t.prototype.setPosition=function(t){this._position=t,e.Engine.audioEngine.canUseWebAudio&&this.spatialSound&&this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z)},t.prototype.setLocalDirectionToMesh=function(t){this._localDirection=t,e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.isPlaying&&this._updateDirection()},t.prototype._updateDirection=function(){var t=this._connectedMesh.getWorldMatrix(),i=e.Vector3.TransformNormal(this._localDirection,t);i.normalize(),this._soundPanner.setOrientation(i.x,i.y,i.z)},t.prototype.updateDistanceFromListener=function(){if(e.Engine.audioEngine.canUseWebAudio&&this._connectedMesh&&this.useCustomAttenuation){var t=this._connectedMesh.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,t,this.maxDistance,this.refDistance,this.rolloffFactor)}},t.prototype.setAttenuationFunction=function(e){this._customAttenuationFunction=e},t.prototype.play=function(t){var i=this;if(this._isReadyToPlay&&this._scene.audioEnabled)try{this._startOffset<0&&(t=-this._startOffset,this._startOffset=0);var n=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource&&this._streamingSource||this.spatialSound&&(this._soundPanner.setPosition(this._position.x,this._position.y,this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedMesh?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming?(this._streamingSource||(this._streamingSource=e.Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=function(){i._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource.disconnect(),this._streamingSource.connect(this._inputAudioNode),this._htmlAudioElement.play()):(this._soundSource=e.Engine.audioEngine.audioContext.createBufferSource(),this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=function(){i._onended()},this._soundSource.start(n,this.isPaused?this._startOffset%this._soundSource.buffer.duration:0)),this._startTime=n,this.isPlaying=!0,this.isPaused=!1}catch(t){e.Tools.Error("Error while trying to play audio: "+this.name+", "+t.message)}},t.prototype._onended=function(){this.isPlaying=!1,this.onended&&this.onended()},t.prototype.stop=function(t){if(this.isPlaying){if(this._streaming)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else{var i=t?e.Engine.audioEngine.audioContext.currentTime+t:e.Engine.audioEngine.audioContext.currentTime;this._soundSource.stop(i),this._soundSource.onended=null,this.isPaused||(this._startOffset=0)}this.isPlaying=!1}},t.prototype.pause=function(){this.isPlaying&&(this.isPaused=!0,this._streaming?this._htmlAudioElement.pause():(this.stop(0),this._startOffset+=e.Engine.audioEngine.audioContext.currentTime-this._startTime))},t.prototype.setVolume=function(t,i){e.Engine.audioEngine.canUseWebAudio&&(i?(this._soundGain.gain.cancelScheduledValues(e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,e.Engine.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(t,e.Engine.audioEngine.audioContext.currentTime+i)):this._soundGain.gain.value=t),this._volume=t},t.prototype.setPlaybackRate=function(e){this._playbackRate=e,this.isPlaying&&(this._streaming?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource.playbackRate.value=this._playbackRate)},t.prototype.getVolume=function(){return this._volume},t.prototype.attachToMesh=function(e){var t=this;this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedMesh=e,this.spatialSound||(this.spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play())),this._onRegisterAfterWorldMatrixUpdate(this._connectedMesh),this._registerFunc=function(e){return t._onRegisterAfterWorldMatrixUpdate(e)},e.registerAfterWorldMatrixUpdate(this._registerFunc)},t.prototype.detachFromMesh=function(){this._connectedMesh&&(this._connectedMesh.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedMesh=null)},t.prototype._onRegisterAfterWorldMatrixUpdate=function(t){this.setPosition(t.getBoundingInfo().boundingSphere.centerWorld),e.Engine.audioEngine.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()},t.prototype.clone=function(){var e=this;if(this._streaming)return null;var i=function(){e._isReadyToPlay?(r._audioBuffer=e.getAudioBuffer(),r._isReadyToPlay=!0,r.autoplay&&r.play()):window.setTimeout(i,300)},n={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this.spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},r=new t(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,n);return this.useCustomAttenuation&&r.setAttenuationFunction(this._customAttenuationFunction),r.setPosition(this._position),r.setPlaybackRate(this._playbackRate),i(),r},t.prototype.getAudioBuffer=function(){return this._audioBuffer},t.Parse=function(i,n,r,o){var s,a=i.name;s=i.url?r+i.url:r+a;var h,l={autoplay:i.autoplay,loop:i.loop,volume:i.volume,spatialSound:i.spatialSound,maxDistance:i.maxDistance,rolloffFactor:i.rolloffFactor,refDistance:i.refDistance,distanceModel:i.distanceModel,playbackRate:i.playbackRate};if(o){var c=function(){o._isReadyToPlay?(h._audioBuffer=o.getAudioBuffer(),h._isReadyToPlay=!0,h.autoplay&&h.play()):window.setTimeout(c,300)};h=new t(a,new ArrayBuffer(0),n,null,l),c()}else h=new t(a,s,n,function(){n._removePendingData(h)},l),n._addPendingData(h);if(i.position){var u=e.Vector3.FromArray(i.position);h.setPosition(u)}if(i.isDirectional&&(h.setDirectionalCone(i.coneInnerAngle||360,i.coneOuterAngle||360,i.coneOuterGain||0),i.localDirectionToMesh)){var d=e.Vector3.FromArray(i.localDirectionToMesh);h.setLocalDirectionToMesh(d)}if(i.connectedMeshId){var f=n.getMeshByID(i.connectedMeshId);f&&h.attachToMesh(f)}return h},t}();e.Sound=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t){this.id=-1,this._isMainTrack=!1,this._isInitialized=!1,this._scene=e,this.soundCollection=new Array,this._options=t,this._isMainTrack||(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1)}return t.prototype._initializeSoundTrackAudioGraph=function(){e.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode=e.Engine.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(e.Engine.audioEngine.masterGain),this._options&&(this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._options.mainTrack&&(this._isMainTrack=this._options.mainTrack)),this._isInitialized=!0)},t.prototype.dispose=function(){if(e.Engine.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}},t.prototype.AddSound=function(t){this._isInitialized||this._initializeSoundTrackAudioGraph(),e.Engine.audioEngine.canUseWebAudio&&t.connectToSoundTrackAudioNode(this._outputAudioNode),t.soundTrackId&&(-1===t.soundTrackId?this._scene.mainSoundTrack.RemoveSound(t):this._scene.soundTracks[t.soundTrackId].RemoveSound(t)),this.soundCollection.push(t),t.soundTrackId=this.id},t.prototype.RemoveSound=function(e){var t=this.soundCollection.indexOf(e);-1!==t&&this.soundCollection.splice(t,1)},t.prototype.setVolume=function(t){e.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.gain.value=t)},t.prototype.switchPanningModelToHRTF=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()},t.prototype.switchPanningModelToEqualPower=function(){if(e.Engine.audioEngine.canUseWebAudio)for(var t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()},t.prototype.connectToAnalyser=function(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,e.Engine.audioEngine.canUseWebAudio&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,e.Engine.audioEngine.masterGain))},t}();e.SoundTrack=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){}return e.TransformCoordinatesToRefSIMD=function(e,t,i){var n=SIMD.float32x4.loadXYZ(e._data,0),r=SIMD.float32x4.load(t.m,0),o=SIMD.float32x4.load(t.m,4),s=SIMD.float32x4.load(t.m,8),a=SIMD.float32x4.load(t.m,12),h=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,0,0,0,0),r),SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,1,1,1,1),o)),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(n,2,2,2,2),s),a));h=SIMD.float32x4.div(h,SIMD.float32x4.swizzle(h,3,3,3,3)),SIMD.float32x4.storeXYZ(i._data,0,h)},e.TransformCoordinatesFromFloatsToRefSIMD=function(e,t,i,n,r){var o=SIMD.float32x4.splat(e),s=SIMD.float32x4.splat(t),a=SIMD.float32x4.splat(i),h=SIMD.float32x4.load(n.m,0),l=SIMD.float32x4.load(n.m,4),c=SIMD.float32x4.load(n.m,8),u=SIMD.float32x4.load(n.m,12),d=SIMD.float32x4.add(SIMD.float32x4.add(SIMD.float32x4.mul(o,h),SIMD.float32x4.mul(s,l)),SIMD.float32x4.add(SIMD.float32x4.mul(a,c),u));d=SIMD.float32x4.div(d,SIMD.float32x4.swizzle(d,3,3,3,3)),SIMD.float32x4.storeXYZ(r._data,0,d)},e}();e.SIMDVector3=t;var i=function(){function e(){}return e.prototype.multiplyToArraySIMD=function(e,t,i){void 0===i&&(i=0);var n=this.m,r=e.m,o=SIMD.float32x4.load(r,0),s=SIMD.float32x4.load(r,4),a=SIMD.float32x4.load(r,8),h=SIMD.float32x4.load(r,12),l=SIMD.float32x4.load(n,0);SIMD.float32x4.store(t,i+0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(l,3,3,3,3),h)))));var c=SIMD.float32x4.load(n,4);SIMD.float32x4.store(t,i+4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,3,3,3,3),h)))));var u=SIMD.float32x4.load(n,8);SIMD.float32x4.store(t,i+8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(u,3,3,3,3),h)))));var d=SIMD.float32x4.load(n,12);SIMD.float32x4.store(t,i+12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,0,0,0,0),o),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,1,1,1,1),s),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,2,2,2,2),a),SIMD.float32x4.mul(SIMD.float32x4.swizzle(d,3,3,3,3),h)))))},e.prototype.invertToRefSIMD=function(e){var t,i,n,r,o,s,a,h,l,c,u=this.m,d=e.m,f=SIMD.float32x4.load(u,0),p=SIMD.float32x4.load(u,4),_=SIMD.float32x4.load(u,8),m=SIMD.float32x4.load(u,12);return o=SIMD.float32x4.shuffle(f,p,0,1,4,5),i=SIMD.float32x4.shuffle(_,m,0,1,4,5),t=SIMD.float32x4.shuffle(o,i,0,2,4,6),i=SIMD.float32x4.shuffle(i,o,1,3,5,7),o=SIMD.float32x4.shuffle(f,p,2,3,6,7),r=SIMD.float32x4.shuffle(_,m,2,3,6,7),n=SIMD.float32x4.shuffle(o,r,0,2,4,6),r=SIMD.float32x4.shuffle(r,o,1,3,5,7),o=SIMD.float32x4.mul(n,r),o=SIMD.float32x4.swizzle(o,1,0,3,2),s=SIMD.float32x4.mul(i,o),a=SIMD.float32x4.mul(t,o),o=SIMD.float32x4.swizzle(o,2,3,0,1),s=SIMD.float32x4.sub(SIMD.float32x4.mul(i,o),s),a=SIMD.float32x4.sub(SIMD.float32x4.mul(t,o),a),a=SIMD.float32x4.swizzle(a,2,3,0,1),o=SIMD.float32x4.mul(i,n),o=SIMD.float32x4.swizzle(o,1,0,3,2),s=SIMD.float32x4.add(SIMD.float32x4.mul(r,o),s),l=SIMD.float32x4.mul(t,o),o=SIMD.float32x4.swizzle(o,2,3,0,1),s=SIMD.float32x4.sub(s,SIMD.float32x4.mul(r,o)),l=SIMD.float32x4.sub(SIMD.float32x4.mul(t,o),l),l=SIMD.float32x4.swizzle(l,2,3,0,1),o=SIMD.float32x4.mul(SIMD.float32x4.swizzle(i,2,3,0,1),r),o=SIMD.float32x4.swizzle(o,1,0,3,2),n=SIMD.float32x4.swizzle(n,2,3,0,1),s=SIMD.float32x4.add(SIMD.float32x4.mul(n,o),s),h=SIMD.float32x4.mul(t,o),o=SIMD.float32x4.swizzle(o,2,3,0,1),s=SIMD.float32x4.sub(s,SIMD.float32x4.mul(n,o)),h=SIMD.float32x4.sub(SIMD.float32x4.mul(t,o),h),h=SIMD.float32x4.swizzle(h,2,3,0,1),o=SIMD.float32x4.mul(t,i),o=SIMD.float32x4.swizzle(o,1,0,3,2),h=SIMD.float32x4.add(SIMD.float32x4.mul(r,o),h),l=SIMD.float32x4.sub(SIMD.float32x4.mul(n,o),l),o=SIMD.float32x4.swizzle(o,2,3,0,1),h=SIMD.float32x4.sub(SIMD.float32x4.mul(r,o),h),l=SIMD.float32x4.sub(l,SIMD.float32x4.mul(n,o)),o=SIMD.float32x4.mul(t,r),o=SIMD.float32x4.swizzle(o,1,0,3,2),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(n,o)),h=SIMD.float32x4.add(SIMD.float32x4.mul(i,o),h),o=SIMD.float32x4.swizzle(o,2,3,0,1),a=SIMD.float32x4.add(SIMD.float32x4.mul(n,o),a),h=SIMD.float32x4.sub(h,SIMD.float32x4.mul(i,o)),o=SIMD.float32x4.mul(t,n),o=SIMD.float32x4.swizzle(o,1,0,3,2),a=SIMD.float32x4.add(SIMD.float32x4.mul(r,o),a),l=SIMD.float32x4.sub(l,SIMD.float32x4.mul(i,o)),o=SIMD.float32x4.swizzle(o,2,3,0,1),a=SIMD.float32x4.sub(a,SIMD.float32x4.mul(r,o)),l=SIMD.float32x4.add(SIMD.float32x4.mul(i,o),l),c=SIMD.float32x4.mul(t,s),c=SIMD.float32x4.add(SIMD.float32x4.swizzle(c,2,3,0,1),c),c=SIMD.float32x4.add(SIMD.float32x4.swizzle(c,1,0,3,2),c),o=SIMD.float32x4.reciprocalApproximation(c),c=SIMD.float32x4.sub(SIMD.float32x4.add(o,o),SIMD.float32x4.mul(c,SIMD.float32x4.mul(o,o))),c=SIMD.float32x4.swizzle(c,0,0,0,0),s=SIMD.float32x4.mul(c,s),a=SIMD.float32x4.mul(c,a),h=SIMD.float32x4.mul(c,h),l=SIMD.float32x4.mul(c,l),SIMD.float32x4.store(d,0,s),SIMD.float32x4.store(d,4,a),SIMD.float32x4.store(d,8,h),SIMD.float32x4.store(d,12,l),this},e.LookAtLHToRefSIMD=function(e,t,i,n){var r=n.m,o=SIMD.float32x4(t.x,t.y,t.z,0),s=SIMD.float32x4(e.x,e.y,e.z,0),a=SIMD.float32x4(i.x,i.y,i.z,0),h=SIMD.float32x4.sub(o,s),l=SIMD.float32x4.mul(h,h);l=SIMD.float32x4.add(l,SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(l,2,0,1,3))),h=SIMD.float32x4.mul(h,SIMD.float32x4.reciprocalSqrtApproximation(l)),l=SIMD.float32x4.mul(a,a),l=SIMD.float32x4.add(l,SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(l,2,0,1,3))),a=SIMD.float32x4.mul(a,SIMD.float32x4.reciprocalSqrtApproximation(l));var c=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,1,2,0,3),SIMD.float32x4.swizzle(a,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(h,2,0,1,3),SIMD.float32x4.swizzle(a,1,2,0,3)));l=SIMD.float32x4.mul(c,c),l=SIMD.float32x4.add(l,SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(l,2,0,1,3))),c=SIMD.float32x4.mul(c,SIMD.float32x4.reciprocalSqrtApproximation(l));var u=SIMD.float32x4.sub(SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,1,2,0,3),SIMD.float32x4.swizzle(h,2,0,1,3)),SIMD.float32x4.mul(SIMD.float32x4.swizzle(c,2,0,1,3),SIMD.float32x4.swizzle(h,1,2,0,3)));l=SIMD.float32x4.mul(c,c),l=SIMD.float32x4.add(l,SIMD.float32x4.add(SIMD.float32x4.swizzle(l,1,2,0,3),SIMD.float32x4.swizzle(l,2,0,1,3))),c=SIMD.float32x4.mul(c,SIMD.float32x4.reciprocalSqrtApproximation(l));var d=SIMD.float32x4.splat(0);c=SIMD.float32x4.neg(c);var f=SIMD.float32x4.shuffle(c,u,0,1,4,5),p=SIMD.float32x4.shuffle(h,d,0,1,4,5),_=SIMD.float32x4.shuffle(f,p,0,2,4,6),m=SIMD.float32x4.shuffle(f,p,1,3,5,7);f=SIMD.float32x4.shuffle(c,u,2,3,6,7),p=SIMD.float32x4.shuffle(h,d,2,3,6,7);var g=SIMD.float32x4.shuffle(f,p,0,2,4,6),v=SIMD.float32x4(0,0,0,1),y=SIMD.float32x4(1,0,0,0),b=SIMD.float32x4(0,1,0,0),x=SIMD.float32x4(0,0,1,0),P=SIMD.float32x4.neg(s);P=SIMD.float32x4.withW(P,1),SIMD.float32x4.store(r,0,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,0,0,0,0),_),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,1,1,1,1),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(y,3,3,3,3),v))))),SIMD.float32x4.store(r,4,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,0,0,0,0),_),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,1,1,1,1),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(b,3,3,3,3),v))))),SIMD.float32x4.store(r,8,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,0,0,0,0),_),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,1,1,1,1),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(x,3,3,3,3),v))))),SIMD.float32x4.store(r,12,SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(P,0,0,0,0),_),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(P,1,1,1,1),m),SIMD.float32x4.add(SIMD.float32x4.mul(SIMD.float32x4.swizzle(P,2,2,2,2),g),SIMD.float32x4.mul(SIMD.float32x4.swizzle(P,3,3,3,3),v)))))},e}();e.SIMDMatrix=i;var n=e.Matrix.prototype.multiplyToArray,r=e.Matrix.prototype.invertToRef,o=e.Matrix.LookAtLHToRef,s=e.Vector3.TransformCoordinatesToRef,a=e.Vector3.TransformCoordinatesFromFloatsToRef,h=function(){function h(){}return Object.defineProperty(h,"IsEnabled",{get:function(){return h._isEnabled},enumerable:!0,configurable:!0}),h.DisableSIMD=function(){e.Matrix.prototype.multiplyToArray=n,e.Matrix.prototype.invertToRef=r,e.Matrix.LookAtLHToRef=o,e.Vector3.TransformCoordinatesToRef=s,e.Vector3.TransformCoordinatesFromFloatsToRef=a,h._isEnabled=!1},h.EnableSIMD=function(){void 0!==window.SIMD&&(e.Matrix.prototype.multiplyToArray=i.prototype.multiplyToArraySIMD,e.Matrix.prototype.invertToRef=i.prototype.invertToRefSIMD,e.Matrix.LookAtLHToRef=i.LookAtLHToRefSIMD,e.Vector3.TransformCoordinatesToRef=t.TransformCoordinatesToRefSIMD,e.Vector3.TransformCoordinatesFromFloatsToRef=t.TransformCoordinatesFromFloatsToRefSIMD,Object.defineProperty(e.Vector3.prototype,"x",{get:function(){return this._data[0]},set:function(e){this._data||(this._data=new Float32Array(3)),this._data[0]=e}}),Object.defineProperty(e.Vector3.prototype,"y",{get:function(){return this._data[1]},set:function(e){this._data[1]=e}}),Object.defineProperty(e.Vector3.prototype,"z",{get:function(){return this._data[2]},set:function(e){this._data[2]=e}}),h._isEnabled=!0)},h._isEnabled=!1,h}();e.SIMDHelper=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,n){this._pos=i,this._size=n,this._root=e,this._parent=t}return Object.defineProperty(t.prototype,"pos",{get:function(){return this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentSize",{get:function(){return this._contentSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"UVs",{get:function(){var t=this._root._size.width,i=this._root._size.height,n=new e.Vector2(this._pos.x/t,this._pos.y/i),r=new e.Vector2((this._pos.x+this._contentSize.width-1)/t,(this._pos.y+this._contentSize.height-1)/i),o=new Array;return o.push(n),o.push(new e.Vector2(r.x,n.y)),o.push(r),o.push(new e.Vector2(n.x,r.y)),o},enumerable:!0,configurable:!0}),t.prototype.freeContent=function(){this.contentSize&&(this._contentSize=null,this.attemptDefrag())},Object.defineProperty(t.prototype,"isUsed",{get:function(){return null!=this._contentSize||null!=this._leftNode},enumerable:!0,configurable:!0}),t.prototype.findAndSplitNode=function(e){var t=this.findNode(e);return t?(t.splitNode(e),t):null},t.prototype.findNode=function(e){var t=null;return this.isUsed?(this._leftNode&&(t=this._leftNode.findNode(e)),!t&&this._rightNode&&(t=this._rightNode.findNode(e)),!t&&this._bottomNode&&(t=this._bottomNode.findNode(e))):this._initialSize&&e.width<=this._initialSize.width&&e.height<=this._initialSize.height?t=this:e.width<=this._size.width&&e.height<=this._size.height&&(t=this),t},t.prototype.splitNode=function(i){return!this._contentSize&&this._initialSize?(this._leftNode=new t(this._root,this,new e.Vector2(this._pos.x,this._pos.y),new e.Size(this._initialSize.width,this._initialSize.height)),this._leftNode.splitNode(i)):(this._contentSize=i.clone(),this._initialSize=i.clone(),i.width!==this._size.width&&(this._rightNode=new t(this._root,this,new e.Vector2(this._pos.x+i.width,this._pos.y),new e.Size(this._size.width-i.width,i.height))),i.height!==this._size.height&&(this._bottomNode=new t(this._root,this,new e.Vector2(this._pos.x,this._pos.y+i.height),new e.Size(this._size.width,this._size.height-i.height))),this)},t.prototype.attemptDefrag=function(){!this.isUsed&&this.isRecursiveFree&&(this.clearNode(),this._parent&&this._parent.attemptDefrag())},t.prototype.clearNode=function(){this._initialSize=null,this._rightNode=null,this._bottomNode=null},Object.defineProperty(t.prototype,"isRecursiveFree",{get:function(){return!this.contentSize&&(!this._leftNode||this._leftNode.isRecursiveFree)&&(!this._rightNode||this._rightNode.isRecursiveFree)&&(!this._bottomNode||this._bottomNode.isRecursiveFree)},enumerable:!0,configurable:!0}),t.prototype.evalFreeSize=function(e){var t=0;return this.isUsed||(t=this._initialSize?this._initialSize.surface:this._size.surface),this._rightNode&&(t+=this._rightNode.evalFreeSize(0)),this._bottomNode&&(t+=this._bottomNode.evalFreeSize(0)),t+e},t}();e.PackedRect=t;var i=function(t){function i(i){t.call(this,null,null,e.Vector2.Zero(),i),this._root=this}return __extends(i,t),i.prototype.addRect=function(e){var t=this.findAndSplitNode(e);return t},Object.defineProperty(i.prototype,"freeSpace",{get:function(){var e=0;return e=this.evalFreeSize(e),e/(this._size.width*this._size.height)},enumerable:!0,configurable:!0}),i}(t);e.RectPackingMap=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){}return e}();e.DynamicFloatArrayElementInfo=t;var i=function(){function e(e,i){this.compareValueOffset=null,this.sortingAscending=!0,this._stride=e,this.buffer=new Float32Array(e*i),this._lastUsed=0,this._firstFree=0,this._allEntries=new Array(i),this._freeEntries=new Array(i);for(var n=0;i>n;n++){var r=new t;r.offset=n*e,this._allEntries[n]=r,this._freeEntries[i-n-1]=r}}return e.prototype.allocElement=function(){0===this._freeEntries.length&&this._growBuffer();var e=this._freeEntries.pop();return this._lastUsed=Math.max(e.offset,this._lastUsed),e.offset===this._firstFree&&(this._freeEntries.length>0?this._firstFree=this._freeEntries[this._freeEntries.length-1].offset:this._firstFree+=this._stride),e},e.prototype.freeElement=function(e){this._firstFree=Math.min(e.offset,this._firstFree),this._freeEntries.push(e)},e.prototype.pack=function(){if(0===this._freeEntries.length)return this.buffer;if(this._lastUsed<this._firstFree){var e=this.buffer.subarray(0,this._lastUsed+this._stride);return e}var i=this._stride,n=new t;
n.offset=this.totalElementCount*i,this._freeEntries.push(n);for(var r=this._freeEntries.sort(function(e,t){return e.offset-t.offset}),o=this._allEntries.sort(function(e,t){return e.offset-t.offset}),s=r[0].offset,a=1,h=(this.usedElementCount+1)*i,l=r[0].offset,c=1;c<r.length&&!(s>=h);c++){var u=r[c],d=u.offset,f=d-l;if(f!==i){for(var p=f/i-1,_=d-i,m=Math.min(a,p),g=0;m>g;g++){var v=s/i,y=_/i,b=o[y];this._moveElement(b,s);var x=o[v];x.offset=_,o[v]=b,o[y]=x,_-=i,s+=i}p>=a?(s=_+i,a=1+m):a=(d-s)/i+1,l=d}else++a,l=d}var P=this.buffer.subarray(0,s);return this._lastUsed=s-i,this._firstFree=s,r.pop(),this._freeEntries=r.sort(function(e,t){return t.offset-e.offset}),this._allEntries=o,P},e.prototype._moveElement=function(e,t){for(var i=0;i<this._stride;i++)this.buffer[t+i]=this.buffer[e.offset+i];e.offset=t},e.prototype._growBuffer=function(){var e=Math.floor(1.5*this.totalElementCount),i=new Float32Array(e*this._stride);i.set(this.buffer);for(var n=this.totalElementCount,r=e-this.totalElementCount,o=0;r>o;o++){var s=new t;s.offset=(n+o)*this.stride,this._allEntries.push(s),this._freeEntries[r-o-1]=s}this._firstFree=n*this.stride,this.buffer=i},Object.defineProperty(e.prototype,"totalElementCount",{get:function(){return this._allEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"freeElementCount",{get:function(){return this._freeEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"usedElementCount",{get:function(){return this._allEntries.length-this._freeEntries.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stride",{get:function(){return this._stride},enumerable:!0,configurable:!0}),e.prototype.sort=function(){var e=this;if(!this.compareValueOffset)throw new Error("The DynamicFloatArray.sort() method needs a valid 'compareValueOffset' property");var t=this.usedElementCount;if(!this._sortTable||this._sortTable.length<t){var i=Math.min(this.totalElementCount,2*t);this._sortTable=new Array(i),this._sortedTable=new Array(i)}this.pack();for(var r=0,o=this.stride,s=0;t>s;s++,r+=o){var a=this._sortTable[s];a||(a=new n,this._sortTable[s]=a),a.compareData=this.buffer[r+this.compareValueOffset],a.offset=r,a.swapedOffset=null,this._sortedTable[s]=a}this.sortingAscending?this._sortedTable.sort(function(e,t){return e.compareData-t.compareData}):this._sortedTable.sort(function(e,t){return t.compareData-e.compareData});for(var h=function(t,i){for(var n=0;o>n;n++){var r=e.buffer[i+n];e.buffer[i+n]=e.buffer[t+n],e.buffer[t+n]=r}},s=0;t>s;s++){var l=this._sortedTable[s],c=this._sortTable[s],u=l.offset;if(l.swapedOffset){for(var d=l;d.swapedOffset;)d=this._sortTable[d.swapedOffset/o];u=d.offset}c.swapedOffset=u,u!==c.offset&&h(u,c.offset),this._allEntries[l.offset/o].offset=c.offset}return this._allEntries.sort(function(e,t){return e.offset-t.offset}),!0},e}();e.DynamicFloatArray=i;var n=function(){function e(){this.compareData=this.offset=this.swapedOffset=null}return e}()}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){}return e}();e.CharInfo=t;var i=function(i){function n(t,n,r,o,s){void 0===o&&(o=200),void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE),i.call(this,null,r,!0,!1,s),this._charInfos={},this._curCharCount=0,this._lastUpdateCharCount=-1,this._usedCounter=1,this.name=t,this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._context.font=n,this._context.fillStyle="white";var a=this.getFontHeight(n);this._lineHeight=a.height,this._offset=a.offset-1;var h=this._context.measureText("W").width;this._spaceWidth=this._context.measureText(" ").width;var l=this._lineHeight*h*o,c=Math.sqrt(l),u=Math.pow(2,Math.ceil(Math.log(c)/Math.log(2)));this._texture=r.getEngine().createDynamicTexture(u,u,!1,s);var d=this.getSize();this._canvas=document.createElement("canvas"),this._canvas.width=d.width,this._canvas.height=d.height,this._context=this._canvas.getContext("2d"),this._context.textBaseline="top",this._context.font=n,this._context.fillStyle="white",this._context.imageSmoothingEnabled=!1,this._currentFreePosition=e.Vector2.Zero();for(var f=32;127>f;f++){var p=String.fromCharCode(f);this.getChar(p)}this.update()}return __extends(n,i),Object.defineProperty(n.prototype,"spaceWidth",{get:function(){return this._spaceWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineHeight",{get:function(){return this._lineHeight},enumerable:!0,configurable:!0}),n.GetCachedFontTexture=function(t,i){var r=t;r.__fontTextureCache__||(r.__fontTextureCache__=new e.StringDictionary);var o=r.__fontTextureCache__,s=i.toLocaleLowerCase(),a=o.get(s);return a?(++a._usedCounter,a):(a=new n(null,s,t,200,e.Texture.NEAREST_SAMPLINGMODE),o.add(s,a),a)},n.ReleaseCachedFontTexture=function(e,t){var i=e,n=i.__fontTextureCache__;if(n){var r=t.toLocaleLowerCase(),o=n.get(r);0===--o._usedCounter&&(n.remove(r),o.dispose())}},n.prototype.getChar=function(i){if(1!==i.length)return null;var n=this._charInfos[i];if(n)return n;n=new t;var r=this._context.measureText(i),o=this.getSize(),s=2,a=2,h=r.width;return this._currentFreePosition.x+h+s>o.width&&(this._currentFreePosition.x=0,this._currentFreePosition.y+=this._lineHeight+a,this._currentFreePosition.y>o.height)?this.getChar("!"):(this._context.fillText(i,this._currentFreePosition.x-.5,this._currentFreePosition.y-this._offset-.5),n.topLeftUV=new e.Vector2(this._currentFreePosition.x/o.width,this._currentFreePosition.y/o.height),n.bottomRightUV=new e.Vector2(n.topLeftUV.x+h/o.width,n.topLeftUV.y+(this._lineHeight+2)/o.height),n.charWidth=h,this._charInfos[i]=n,this._curCharCount++,this._currentFreePosition.x+=h+s,n)},n.prototype.measureText=function(t,i){void 0===i&&(i=4);for(var n=0,r=0,o=1,s=0,a=0;a<t.length;a++){var h=t[a];if("\n"!==h)if("\t"!==h)" ">h||(r+=this.getChar(h).charWidth,++s);else{var l=s+i;l-=l%i,r+=(l-s)*this.spaceWidth,s=l}else n=Math.max(n,r),s=0,r=0,++o}return n=Math.max(n,r),new e.Size(n,o*this._lineHeight)},n.prototype.getFontHeight=function(e){var t=document.createElement("canvas"),i=t.getContext("2d");i.fillRect(0,0,t.width,t.height),i.textBaseline="top",i.fillStyle="white",i.font=e,i.fillText("jH|",0,0);for(var n=i.getImageData(0,0,t.width,t.height).data,r=-1,o=-1,s=0;s<t.height;s++)for(var a=0;a<t.width;a++){var h=4*(s*t.width+a);if(0!==n[h]){-1===r&&(r=s);break}if(a===t.width-1&&-1!==r){o=s,s=t.height;break}}return{height:o-r,offset:r-1}},Object.defineProperty(n.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),n.prototype.getContext=function(){return this._context},n.prototype.update=function(){this._lastUpdateCharCount<this._curCharCount&&(this.getScene().getEngine().updateDynamicTexture(this._texture,this._canvas,!1,!0),this._lastUpdateCharCount=this._curCharCount)},n.prototype.clone=function(){return null},n}(e.Texture);e.FontTexture=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,n,!0,!1,o),this.name=i,this._size=r,this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._rectPackingMap=new e.RectPackingMap(new e.Size(r.width,r.height)),this._texture=n.getEngine().createRenderTargetTexture(r,{generateMipMaps:!this.noMipmap,type:e.Engine.TEXTURETYPE_UNSIGNED_INT})}return __extends(i,t),i.prototype.allocateRect=function(e){return this._rectPackingMap.addRect(e)},i.prototype.freeRect=function(e){e&&e.freeContent()},Object.defineProperty(i.prototype,"freeSpace",{get:function(){return this._rectPackingMap.freeSpace},enumerable:!0,configurable:!0}),i.prototype.bindTextureForRect=function(e,t){return this.bindTextureForPosSize(e.pos,e.contentSize,t)},i.prototype.bindTextureForPosSize=function(t,i,n){var r=this.getScene().getEngine();r.bindFramebuffer(this._texture),this._replacedViewport=r.setDirectViewport(t.x,t.y,i.width,i.height),n&&r.scissorClear(t.x,t.y,i.width,i.height,new e.Color4(0,0,0,0))},i.prototype.unbindTexture=function(t){t&&e.Tools.DumpFramebuffer(this._size.width,this._size.height,this.getScene().getEngine());var i=this.getScene().getEngine();this._replacedViewport&&(i.setViewport(this._replacedViewport),this._replacedViewport=null),i.unBindFramebuffer(this._texture)},Object.defineProperty(i.prototype,"canRescale",{get:function(){return!1},enumerable:!0,configurable:!0}),i.prototype.clone=function(){return null},i}(e.Texture);e.MapTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.radius=0,this.center=e.Vector2.Zero(),this.extent=e.Vector2.Zero()}return t.CreateFromSize=function(e){var i=new t;return t.CreateFromSizeToRef(e,i),i},t.CreateFromRadius=function(e){var i=new t;return t.CreateFromRadiusToRef(e,i),i},t.CreateFromPoints=function(e){var i=new t;return t.CreateFromPointsToRef(e,i),i},t.CreateFromSizeToRef=function(t,i){t||(t=e.Size.Zero()),i.center.x=+t.width/2,i.center.y=+t.height/2,i.extent.x=i.center.x,i.extent.y=i.center.y,i.radius=i.extent.length()},t.CreateFromRadiusToRef=function(e,t){t.center.x=t.center.y=0;var i=+e;t.extent.x=i,t.extent.y=i,t.radius=i},t.CreateFromPointsToRef=function(e,i){for(var n=Number.MAX_VALUE,r=Number.MAX_VALUE,o=Number.MIN_VALUE,s=Number.MIN_VALUE,a=0;a<e.length;a++){var h=e[a];n=Math.min(h.x,n),o=Math.max(h.x,o),r=Math.min(h.y,r),s=Math.max(h.y,s)}t.CreateFromMinMaxToRef(n,o,r,s,i)},t.CreateFromMinMaxToRef=function(t,i,n,r,o){var s=i-t,a=r-n;o.center=new e.Vector2(t+s/2,n+a/2),o.extent=new e.Vector2(i-o.center.x,r-o.center.y),o.radius=o.extent.length()},t.prototype.clone=function(){var e=new t;return e.center=this.center.clone(),e.radius=this.radius,e.extent=this.extent.clone(),e},t.prototype.max=function(){var t=e.Vector2.Zero();return this.maxToRef(t),t},t.prototype.maxToRef=function(e){e.x=this.center.x+this.extent.x,e.y=this.center.y+this.extent.y},t.prototype.transform=function(e){var i=new t;return this.transformToRef(e,i),i},t.prototype.union=function(e){var i=new t;return this.unionToRef(e,i),i},t.prototype.transformToRef=function(i,n){var r=t._transform;r[0].x=this.center.x+this.extent.x,r[0].y=this.center.y+this.extent.y,r[1].x=this.center.x+this.extent.x,r[1].y=this.center.y-this.extent.y,r[2].x=this.center.x-this.extent.x,r[2].y=this.center.y-this.extent.y,r[3].x=this.center.x-this.extent.x,r[3].y=this.center.y+this.extent.y;for(var o=0;4>o;o++)e.Vector2.TransformToRef(r[o],i,r[o]);t.CreateFromPointsToRef(r,n)},t.prototype.unionToRef=function(e,i){var n=Math.max(this.center.x+this.extent.x,e.center.x+e.extent.x),r=Math.max(this.center.y+this.extent.y,e.center.y+e.extent.y),o=Math.min(this.center.x-this.extent.x,e.center.x-e.extent.x),s=Math.min(this.center.y-this.extent.y,e.center.y-e.extent.y);t.CreateFromMinMaxToRef(o,n,s,r,i)},t.prototype.doesIntersect=function(e){var t=e.subtract(this.center);return t.lengthSquared()<=this.radius*this.radius&&(Math.abs(t.x)<=this.extent.x&&Math.abs(t.y)<=this.extent.y)},t._transform=new Array(e.Vector2.Zero(),e.Vector2.Zero(),e.Vector2.Zero(),e.Vector2.Zero()),t}();e.BoundingInfo2D=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){}return e.prototype.isLocked=function(){return this._isLocked},e.prototype.lock=function(){return!!this._isLocked||(this.onLock(),this._isLocked=!0,!1)},e.prototype.onLock=function(){},e}();e.LockableBase=t;var i=function(t){function i(e,i){void 0===i&&(i=!1),t.call(this),this._color=e,i&&this.lock()}return __extends(i,t),i.prototype.isTransparent=function(){return this._color&&this._color.a<1},Object.defineProperty(i.prototype,"color",{get:function(){return this._color},set:function(e){this.isLocked()||(this._color=e)},enumerable:!0,configurable:!0}),i.prototype.toString=function(){return this._color.toHexString()},i=__decorate([e.className("SolidColorBrush2D")],i)}(t);e.SolidColorBrush2D=i;var n=function(t){function i(i,n,r,o,s,a){void 0===r&&(r=e.Vector2.Zero()),void 0===o&&(o=0),void 0===s&&(s=1),void 0===a&&(a=!1),t.call(this),this._color1=i,this._color2=n,this._translation=r,this._rotation=o,this._scale=s,a&&this.lock()}return __extends(i,t),i.prototype.isTransparent=function(){return this._color1&&this._color1.a<1||this._color2&&this._color2.a<1},Object.defineProperty(i.prototype,"color1",{get:function(){return this._color1},set:function(e){this.isLocked()||(this._color1=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color2",{get:function(){return this._color2},set:function(e){this.isLocked()||(this._color2=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"translation",{get:function(){return this._translation},set:function(e){this.isLocked()||(this._translation=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this.isLocked()||(this._rotation=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},set:function(e){this.isLocked()||(this._scale=e)},enumerable:!0,configurable:!0}),i.prototype.toString=function(){return"C1:"+this._color1+";C2:"+this._color2+";T:"+this._translation.toString()+";R:"+this._rotation+";S:"+this._scale+";"},i.BuildKey=function(e,t,i,n,r){return"C1:"+e+";C2:"+t+";T:"+i.toString()+";R:"+n+";S:"+r+";"},i=__decorate([e.className("GradientColorBrush2D")],i)}(t);e.GradientColorBrush2D=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){function t(e,t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),h._hookProperty(e,t,i,n,o.PROPKIND_MODEL)}function i(e,t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),h._hookProperty(e,t,i,n,o.PROPKIND_INSTANCE)}function n(e,t,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),h._hookProperty(e,t,i,n,o.PROPKIND_DYNAMIC)}var r=function(){function e(){}return e}();e.Prim2DClassInfo=r;var o=function(){function e(){}return e.PROPKIND_MODEL=1,e.PROPKIND_INSTANCE=2,e.PROPKIND_DYNAMIC=3,e}();e.Prim2DPropInfo=o;var s=function(){function e(){}return e}();e.PropertyChangedInfo=s;var a=function(){function t(t,i,n){this._baseClass=t,this._type=i,this._subClasses=new Array,this._levelContent=new e.StringDictionary,this._classContentFactory=n}return Object.defineProperty(t.prototype,"classContent",{get:function(){return this._classContent||(this._classContent=this._classContentFactory(this._baseClass?this._baseClass.classContent:null)),this._classContent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levelContent",{get:function(){return this._levelContent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullContent",{get:function(){if(!this._fullContent){for(var t=new e.StringDictionary,i=this;i;)i.levelContent.forEach(function(e,i){return t.add(e,i)}),i=i._baseClass;this._fullContent=t}return this._fullContent},enumerable:!0,configurable:!0}),t.prototype.getLevelOf=function(e){if(e===this._type)return this;var t=Object.getPrototypeOf(e),i=this.getOrAddType(Object.getPrototypeOf(t),t);return i||this.getLevelOf(t),this.getOrAddType(t,e)},t.prototype.getOrAddType=function(e,i){if(e===this._type){for(var n=0,r=this._subClasses;n<r.length;n++){var o=r[n];if(o.type===i)return o.node}var s=new t(this,i,this._classContentFactory),a={type:i,node:s};return this._subClasses.push(a),a.node}for(var h=0,l=this._subClasses;h<l.length;h++){var o=l[h],a=o.node.getOrAddType(e,i);if(a)return a}return null},t.get=function(e){var t=e.__classTreeInfo;return t?t.getLevelOf(e):null},t.getOrRegister=function(e,i){var n=e.__classTreeInfo;return n||(n=new t(null,e,i),e.__classTreeInfo=n),n},t}();e.ClassTreeInfo=a;var h=function(){function t(){this._flags=0,this._modelKey=null,this._instanceDirtyFlags=0,this._levelBoundingInfo=new e.BoundingInfo2D,this.animations=new Array}return Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isFlagSet(t.flagIsDisposed)},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){return!this.isDisposed&&(this.animations.splice(0),this._setFlags(t.flagIsDisposed),!0)},t.prototype.getAnimatables=function(){return new Array},Object.defineProperty(t.prototype,"modelKey",{get:function(){var i=this;if(!this._isFlagSet(t.flagModelDirty)&&this._modelKey)return this._modelKey;var n="Class:"+e.Tools.getClassName(this)+";",r=this.propDic;return r.forEach(function(t,r){if(r.kind===o.PROPKIND_MODEL){var s=i[r.name];if(s&&s.constructor===Array){var a=s[0];s=a?e.Tools.hashCodeFromStream(e.Tools.arrayOrStringFeeder(s)):0}n+=r.name+":"+(null!=s?r.typeLevelCompare?e.Tools.getClassName(s):s.toString():"[null]")+";"}}),this._clearFlags(t.flagModelDirty),this._modelKey=n,n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDirty",{get:function(){return 0!==this._instanceDirtyFlags||this._areSomeFlagsSet(t.flagModelDirty|t.flagPositioningDirty|t.flagLayoutDirty)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"propDic",{get:function(){if(!this._propInfo){var e=a.get(Object.getPrototypeOf(this));if(!e)throw new Error("Can't access the propDic member in class definition, is this class SmartPropertyPrim based?");this._propInfo=e.fullContent}return this._propInfo},enumerable:!0,configurable:!0}),t._createPropInfo=function(e,t,i,n,s,h){var l=a.getOrRegister(e,function(){return new r}),c=l.getLevelOf(e),u=c.levelContent.get(i.toString());if(u)throw new Error("The ID "+i+" is already taken by another property declaration named: "+u.name);return u=new o,u.id=i,u.flagId=Math.pow(2,i),u.kind=h,u.name=t,u.dirtyBoundingInfo=n,u.typeLevelCompare=s,c.levelContent.add(t,u),u},t._checkUnchanged=function(e,t){if(null===e&&null===t||void 0===e&&void 0===t)return!0;if(null!=e&&null!=t)if("function"==typeof e.equals){if(e.equals(t))return!0}else if(e===t)return!0;return!1},t.prototype.markAsDirty=function(e){if(!this.isDisposed){var t=e.indexOf(".");-1!==t&&(e=e.substr(0,t));var i=this.propDic.get(e);if(i){var n=this[e];this._handlePropChanged(void 0,n,e,i,i.typeLevelCompare)}}},t.prototype._boundingBoxDirty=function(){if(this._setFlags(t.flagLevelBoundingInfoDirty),this instanceof e.Prim2DBase)for(var i=this;i&&(i._boundingSize=null,i._setFlags(t.flagBoundingInfoDirty),i.isSizeAuto&&i.onPrimitivePropertyDirty(e.Prim2DBase.sizeProperty.flagId),!(i instanceof e.Group2D&&i.isRenderableGroup));)i=i.parent},t.prototype._handlePropChanged=function(i,n,r,s,a){s.dirtyBoundingInfo&&this._boundingBoxDirty();var h=t.propChangedInfo;h.oldValue=i,h.newValue=n,h.propertyName=r;var l=s.flagId;if(this.propertyChanged.notifyObservers(h,l),this instanceof e.Group2D&&this.handleGroupChanged(s),this instanceof e.Prim2DBase){var c=this._parent;null!=c&&c.layoutEngine&&0!==(c.layoutEngine.layoutDirtyOnPropertyChangedMask&s.flagId)&&c._setLayoutDirty()}var u=!1;if(a&&null!=i&&null!=n){var d=i.__proto__,f=n.__proto__;u=d===f}u||s.kind!==o.PROPKIND_MODEL?(u||s.kind===o.PROPKIND_INSTANCE||s.kind===o.PROPKIND_DYNAMIC)&&this.onPrimitivePropertyDirty(l):this.onPrimitivePropertyDirty(t.flagModelDirty)},t.prototype.onPrimitivePropertyDirty=function(e){this.isDirty||this.onPrimBecomesDirty(),this._instanceDirtyFlags|=e},t.prototype.handleGroupChanged=function(e){},t.prototype.checkPropertiesDirty=function(e){return 0!==(this._instanceDirtyFlags&e)},t.prototype.clearPropertiesDirty=function(e){return this._instanceDirtyFlags&=~e,this._instanceDirtyFlags},t.prototype._resetPropertiesDirty=function(){this._instanceDirtyFlags=0},Object.defineProperty(t.prototype,"levelBoundingInfo",{get:function(){return this._isFlagSet(t.flagLevelBoundingInfoDirty)&&(this.updateLevelBoundingInfo(),this._clearFlags(t.flagLevelBoundingInfoDirty)),this._levelBoundingInfo},enumerable:!0,configurable:!0}),t.prototype.updateLevelBoundingInfo=function(){},t.prototype.onPrimBecomesDirty=function(){},t._hookProperty=function(e,i,n,r,o){return function(s,a,h){var l=t._createPropInfo(s,a,e,r,n,o);i&&i(l);var c=h.get,u=h.set;h.set=function(e){if(!this.isDisposed){var i=c.call(this);if(!t._checkUnchanged(i,e)){var r=this;u.call(this,e),r._handlePropChanged(i,e,a,l,n)}}}}},t.prototype.addExternalData=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.add(t,i)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(t,i){return this._externalData||(this._externalData=new e.StringDictionary),this._externalData.getOrAddWithFactory(t,i)},t.prototype.removeExternalData=function(e){return!!this._externalData&&this._externalData.remove(e)},t.prototype._isFlagSet=function(e){return 0!==(this._flags&e)},t.prototype._areAllFlagsSet=function(e){return(this._flags&e)===e},t.prototype._areSomeFlagsSet=function(e){return 0!==(this._flags&e)},t.prototype._clearFlags=function(e){this._flags&=~e},t.prototype._setFlags=function(e){var t=this._flags;return this._flags|=e,t},t.prototype._changeFlags=function(e,t){t?this._flags|=e:this._flags&=~e},t.propChangedInfo=new s,t.flagIsDisposed=1,t.flagLevelBoundingInfoDirty=2,t.flagModelDirty=4,t.flagLayoutDirty=8,t.flagLevelVisible=16,t.flagBoundingInfoDirty=32,t.flagIsPickable=64,t.flagIsVisible=128,t.flagVisibilityChanged=256,t.flagPositioningDirty=512,t.flagTrackedGroup=1024,t=__decorate([e.className("SmartPropertyPrim")],t)}();e.SmartPropertyPrim=h,e.modelLevelProperty=t,e.instanceLevelProperty=i,e.dynamicLevelProperty=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this.forceRefreshPrimitive=!1}return e}();e.PrepareRender2DContext=t;var i=function(){function e(e){this._renderMode=e,this.useInstancing=!1,this.groupInfoPartData=null,this.partDataStartIndex=this.partDataEndIndex=null}return Object.defineProperty(e.prototype,"renderMode",{get:function(){return this._renderMode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeOpaque",{get:function(){return e._renderModeOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeAlphaTest",{get:function(){return e._renderModeAlphaTest},enumerable:!0,configurable:!0}),Object.defineProperty(e,"RenderModeTransparent",{get:function(){return e._renderModeTransparent},enumerable:!0,configurable:!0}),e._renderModeOpaque=1,e._renderModeAlphaTest=2,e._renderModeTransparent=3,e}();e.Render2DContext=i;var n=function(){function t(){this.primitivePointerPos=e.Vector2.Zero(),this.tilt=e.Vector2.Zero(),this.cancelBubble=!1}return Object.defineProperty(t,"PointerOver",{get:function(){return t._pointerOver},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerEnter",{get:function(){return t._pointerEnter},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerDown",{get:function(){return t._pointerDown},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerMouseWheel",{get:function(){return t._pointerMouseWheel},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerMove",{get:function(){return t._pointerMove},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerUp",{get:function(){return t._pointerUp},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerOut",{get:function(){return t._pointerOut},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerLeave",{get:function(){return t._pointerLeave},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerGotCapture",{get:function(){return t._pointerGotCapture},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PointerLostCapture",{get:function(){return t._pointerLostCapture},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MouseWheelPrecision",{get:function(){return t._mouseWheelPrecision},enumerable:!0,configurable:!0}),t.prototype.updateRelatedTarget=function(e,t){this.relatedTarget=e,this.relatedTargetPointerPos=t},t.getEventTypeName=function(e){switch(e){case t.PointerOver:return"PointerOver";case t.PointerEnter:return"PointerEnter";case t.PointerDown:return"PointerDown";case t.PointerMouseWheel:return"PointerMouseWheel";case t.PointerMove:return"PointerMove";case t.PointerUp:return"PointerUp";case t.PointerOut:return"PointerOut";case t.PointerLeave:return"PointerLeave";case t.PointerGotCapture:return"PointerGotCapture";case t.PointerLostCapture:return"PointerLostCapture"}},t._pointerOver=1,t._pointerEnter=2,t._pointerDown=4,t._pointerMouseWheel=8,t._pointerMove=16,t._pointerUp=32,t._pointerOut=64,t._pointerLeave=128,t._pointerGotCapture=256,t._pointerLostCapture=512,t._mouseWheelPrecision=3,t}();e.PrimitivePointerInfo=n;var r=function(){function e(t){this._changedCallback=t,this._horizontal=e.AlignLeft,this._vertical=e.AlignBottom}return Object.defineProperty(e,"AlignLeft",{get:function(){return e._AlignLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignTop",{get:function(){return e._AlignTop},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignRight",{get:function(){return e._AlignRight},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignBottom",{get:function(){return e._AlignBottom},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignCenter",{get:function(){return e._AlignCenter},enumerable:!0,configurable:!0}),Object.defineProperty(e,"AlignStretch",{get:function(){return e._AlignStretch},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontal",{get:function(){return this._horizontal},set:function(e){this._horizontal!==e&&(this._horizontal=e,this._changedCallback())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"vertical",{get:function(){return this._vertical},set:function(e){this._vertical!==e&&(this._vertical=e,this._changedCallback())},enumerable:!0,configurable:!0}),e.prototype.setHorizontal=function(t){var i=t.trim().toLocaleLowerCase();switch(i){case"left":return void(this.horizontal=e.AlignLeft);case"right":return void(this.horizontal=e.AlignRight);case"center":return void(this.horizontal=e.AlignCenter);case"stretch":return void(this.horizontal=e.AlignStretch)}},e.prototype.setVertical=function(t){var i=t.trim().toLocaleLowerCase();switch(i){case"top":return void(this.vertical=e.AlignTop);case"bottom":return void(this.vertical=e.AlignBottom);case"center":return void(this.vertical=e.AlignCenter);case"stretch":return void(this.vertical=e.AlignStretch)}},e.prototype.fromString=function(e){for(var t=e.trim().split(","),i=0;i<t.length;i++){var n=t[i];n=n.toLocaleLowerCase().trim();var r=n.indexOf("h:");-1===r&&(r=n.indexOf("horizontal:")),-1===r?(r=n.indexOf("v:"),-1===r&&(r=n.indexOf("vertical:")),-1===r||(n=n.substr(n.indexOf(":")+1),this.setVertical(n))):(n=n.substr(n.indexOf(":")+1),this.setHorizontal(n))}},e._AlignLeft=1,e._AlignTop=1,e._AlignRight=2,e._AlignBottom=2,e._AlignCenter=3,e._AlignStretch=4,e}();e.PrimitiveAlignment=r;var o=function(){function e(e,t){this.prim=e,this.intersectionLocation=t}return e}();e.PrimitiveIntersectedInfo=o;var s=function(){function e(t,i){this._parentAccess=t,this._changedCallback=i,this._pixels=new Array(4),this._percentages=new Array(4),this._setType(0,e.Auto),this._setType(1,e.Auto),this._setType(2,e.Auto),this._setType(3,e.Auto),this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0}return e.prototype.fromString=function(t){this._clear();for(var i=t.trim().split(","),n=!1,r=0;r<i.length;r++){var o=i[r];n=this._extractString(o,!1)||n}if(!n)throw new Error("Can't parse the string to create a PrimitiveMargin object, format must be: 'top: <value>, left:<value>, right:<value>, bottom:<value>");0===(15&this._flags)&&(this._flags|=e.Pixel<<0),0===(240&this._flags)&&(this._flags|=e.Pixel<<4),0===(3840&this._flags)&&(this._flags|=e.Pixel<<8),0===(61440&this._flags)&&(this._flags|=e.Pixel<<12),this._changedCallback()},e.prototype.fromStrings=function(e,t,i,n){return this._clear(),this._setStringValue(e,0,!1),this._setStringValue(t,1,!1),this._setStringValue(i,2,!1),this._setStringValue(n,3,!1),this._changedCallback(),this},e.prototype.fromPixels=function(e,t,i,n){return this._clear(),this._pixels[0]=e,this._pixels[1]=t,this._pixels[2]=i,this._pixels[3]=n,this._changedCallback(),this},e.prototype.fromUniformPixels=function(e){return this._clear(),this._pixels[0]=e,this._pixels[1]=e,this._pixels[2]=e,this._pixels[3]=e,this._changedCallback(),this},e.prototype.auto=function(){return this._clear(),this._flags=e.Auto<<0|e.Auto<<4|e.Auto<<8|e.Auto<<12,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._changedCallback(),this},e.prototype._clear=function(){this._flags=0,this._pixels[0]=0,this._pixels[1]=0,this._pixels[2]=0,this._pixels[3]=0,this._percentages[0]=null,this._percentages[1]=null,this._percentages[2]=null,this._percentages[3]=null},e.prototype._extractString=function(e,t){var i=e.trim().toLocaleLowerCase();return 0===i.indexOf("top:")?(i=i.substr(4).trim(),this._setStringValue(i,0,t)):0===i.indexOf("left:")?(i=i.substr(5).trim(),this._setStringValue(i,1,t)):0===i.indexOf("right:")?(i=i.substr(6).trim(),this._setStringValue(i,2,t)):0===i.indexOf("bottom:")&&(i=i.substr(7).trim(),this._setStringValue(i,3,t))},e.prototype._setStringValue=function(t,i,n){var r=t.trim().toLocaleLowerCase();if("auto"===r){if(this._isType(i,e.Auto))return!0;this._setType(i,e.Auto),this._pixels[i]=0,n&&this._changedCallback()}else{if("inherit"!==r){var o=r.indexOf("%");if(-1!==o){var s=r.substr(0,o),a=Math.round(Number(s))/100;return!(!this._isType(i,e.Percentage)||this._percentages[i]!==a)||(this._setType(i,e.Percentage),!isNaN(a)&&(this._percentages[i]=a,n&&this._changedCallback(),!0))}var h;o=r.indexOf("px"),h=-1!==o?r.substr(0,o).trim():r;var l=Number(h);return!(!this._isType(i,e.Pixel)||this._pixels[i]!==l)||!isNaN(l)&&(this._pixels[i]=l,this._setType(i,e.Pixel),n&&this._changedCallback(),!0)}if(this._isType(i,e.Inherit))return!0;this._setType(i,e.Inherit),this._pixels[i]=null,n&&this._changedCallback()}},e.prototype._setPixels=function(t,i,n){t=Math.round(t),this._isType(i,e.Pixel)&&this._pixels[i]===t||(this._setType(i,e.Pixel),this._pixels[i]=t,n&&this._changedCallback())},e.prototype._setPercentage=function(t,i,n){t=Math.min(1,t),t=Math.max(0,t),t=Math.round(100*t)/100,this._isType(i,e.Percentage)&&this._percentages[i]===t||(this._setType(i,e.Percentage),this._percentages[i]=t,n&&this._changedCallback())},e.prototype._getStringValue=function(t){var i=this._flags>>4*t&15;switch(i){case e.Auto:return"auto";case e.Pixel:return this._pixels[t]+"px";case e.Percentage:return 100*this._percentages[t]+"%";case e.Inherit:return"inherit"}return""},e.prototype._isType=function(e,t){var i=this._flags>>4*e&15;return i===t},e.prototype._getType=function(t,i){var n=this._flags>>4*t&15;if(i&&n===e.Inherit){var r=this._parentAccess();return r?r._getType(t,!0):e.Auto}return n},e.prototype._setType=function(e,t){this._flags&=~(15<<4*e),this._flags|=t<<4*e},e.prototype.setTop=function(e){"string"==typeof e?this._setStringValue(e,0,!0):this.topPixels=e},e.prototype.setLeft=function(e){"string"==typeof e?this._setStringValue(e,1,!0):this.leftPixels=e},e.prototype.setRight=function(e){"string"==typeof e?this._setStringValue(e,2,!0):this.rightPixels=e},e.prototype.setBottom=function(e){"string"==typeof e?this._setStringValue(e,3,!0):this.bottomPixels=e},Object.defineProperty(e.prototype,"top",{get:function(){return this._getStringValue(0)},set:function(e){this._setStringValue(e,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._getStringValue(1)},set:function(e){this._setStringValue(e,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this._getStringValue(2)},set:function(e){this._setStringValue(e,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this._getStringValue(3)},set:function(e){this._setStringValue(e,3,!0);
},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topPixels",{get:function(){return this._pixels[0]},set:function(e){this._setPixels(e,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPixels",{get:function(){return this._pixels[1]},set:function(e){this._setPixels(e,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPixels",{get:function(){return this._pixels[2]},set:function(e){this._setPixels(e,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomPixels",{get:function(){return this._pixels[3]},set:function(e){this._setPixels(e,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topPercentage",{get:function(){return this._percentages[0]},set:function(e){this._setPercentage(e,0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftPercentage",{get:function(){return this._percentages[1]},set:function(e){this._setPercentage(e,1,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightPercentage",{get:function(){return this._percentages[2]},set:function(e){this._setPercentage(e,2,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomPercentage",{get:function(){return this._percentages[3]},set:function(e){this._setPercentage(e,3,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topMode",{get:function(){return this._getType(0,!1)},set:function(e){this._setType(0,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftMode",{get:function(){return this._getType(1,!1)},set:function(e){this._setType(1,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightMode",{get:function(){return this._getType(2,!1)},set:function(e){this._setType(2,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomMode",{get:function(){return this._getType(3,!1)},set:function(e){this._setType(3,e)},enumerable:!0,configurable:!0}),e.prototype._computePixels=function(t,i,n){var r=this._getType(t,!1);if(r===e.Inherit)return void this._parentAccess()._computePixels(t,i,n);if(r===e.Percentage){var o=(0===t||3===t?i.height:i.width)*this._percentages[t];this._pixels[t]=o,n&&this._changedCallback()}},e.prototype.computeWithAlignment=function(t,i,n,o,s){var a=this._getType(0,!0),h=this._getType(1,!0),l=this._getType(2,!0),c=this._getType(3,!0),u=i&&null!=i.width,d=i&&null!=i.height,f=u?i.width:0,p=d?i.height:0,_=a===e.Auto,m=h===e.Auto,g=l===e.Auto,v=c===e.Auto;switch(n.horizontal){case r.AlignLeft:m?o.x=0:(this._computePixels(1,t,!0),o.x=this.leftPixels),s.width=f;break;case r.AlignRight:g?o.x=Math.round(t.width-f):(this._computePixels(2,t,!0),o.x=Math.round(t.width-(f+this.rightPixels))),s.width=f;break;case r.AlignStretch:m?o.x=0:(this._computePixels(1,t,!0),o.x=this.leftPixels);var y=0;g||(this._computePixels(2,t,!0),y=this.rightPixels),s.width=t.width-(o.x+y);break;case r.AlignCenter:m||this._computePixels(1,t,!0),g||this._computePixels(2,t,!0);var b=(m?0:this.leftPixels)-(g?0:this.rightPixels);o.x=Math.round((t.width-f)/2+b),s.width=f}switch(n.vertical){case r.AlignTop:_?o.y=t.height-p:(this._computePixels(0,t,!0),o.y=Math.round(t.height-(p+this.topPixels))),s.height=p;break;case r.AlignBottom:v?o.y=0:(this._computePixels(3,t,!0),o.y=this.bottomPixels),s.height=p;break;case r.AlignStretch:v?o.y=0:(this._computePixels(3,t,!0),o.y=this.bottomPixels);var x=0;_||(this._computePixels(0,t,!0),x=this.topPixels),s.height=t.height-(o.y+x);break;case r.AlignCenter:_||this._computePixels(0,t,!0),v||this._computePixels(3,t,!0);var b=(v?0:this.bottomPixels)-(_?0:this.topPixels);o.y=Math.round((t.height-p)/2+b),s.height=p}},e.prototype.compute=function(e,t,i){this._computePixels(0,e,!0),this._computePixels(1,e,!0),this._computePixels(2,e,!0),this._computePixels(3,e,!0),t.x=this.leftPixels,i.width=e.width-(t.x+this.rightPixels),t.y=this.bottomPixels,i.height=e.height-(t.y+this.topPixels)},e.prototype.computeArea=function(e,t){this._computePixels(0,e,!0),this._computePixels(1,e,!0),this._computePixels(2,e,!0),this._computePixels(3,e,!0),t.width=this.leftPixels+e.width+this.rightPixels,t.height=this.bottomPixels+e.height+this.topPixels},e.Auto=1,e.Inherit=2,e.Percentage=4,e.Pixel=8,e}();e.PrimitiveThickness=s;var a=function(){function t(){this.findFirstOnly=!1,this.intersectHidden=!1,this.pickPosition=e.Vector2.Zero()}return Object.defineProperty(t.prototype,"isIntersected",{get:function(){return this.intersectedPrimitives&&this.intersectedPrimitives.length>0},enumerable:!0,configurable:!0}),t.prototype.isPrimIntersected=function(e){for(var t=0,i=this.intersectedPrimitives;t<i.length;t++){var n=i[t];if(n.prim===e)return n.intersectionLocation}return null},t.prototype._exit=function(e){e&&(this._globalPickPosition=null)},t}();e.IntersectInfo2D=a;var h=function(t){function i(n){null==n&&(n={}),t.call(this);var r,o;if(i._isCanvasInit)r=this,o=null,this._canvasPreInit(n);else if(null!=n.parent){if(o=n.parent,r=n.parent.owner,!r)throw new Error("Parent "+o.id+" of "+n.id+" doesn't have a valid owner!");if(!(this instanceof e.Group2D||this instanceof e.Sprite2D&&null!==n.id&&0===n.id.indexOf("__cachedSpriteOfGroup__")||r.cachingStrategy!==e.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS||o!==r))throw new Error("Can't create a primitive with the canvas as direct parent when the caching strategy is TOPLEVELGROUPS. You need to create a Group below the canvas and use it as the parent for the primitive")}if(this._layoutEngine=e.CanvasLayoutEngine.Singleton,this._size=null,this._actualSize=null,this._boundingSize=null,this._layoutArea=e.Size.Zero(),this._layoutAreaPos=e.Vector2.Zero(),this._marginOffset=e.Vector2.Zero(),this._parentMargingOffset=e.Vector2.Zero(),this._parentContentArea=e.Size.Zero(),this._contentArea=new e.Size(null,null),this._pointerEventObservable=new e.Observable,this._siblingDepthOffset=this._hierarchyDepthOffset=0,this._boundingInfo=new e.BoundingInfo2D,this._owner=r,this._parent=null,this._margin=null,this._padding=null,this._marginAlignment=null,this._id=n.id,this.propertyChanged=new e.Observable,this._children=new Array,this._localTransform=new e.Matrix,this._globalTransform=null,this._invGlobalTransform=null,this._globalTransformProcessStep=0,this._globalTransformStep=0,this._hierarchyDepth=0,this._renderGroup=null,this._setFlags(e.SmartPropertyPrim.flagIsPickable|e.SmartPropertyPrim.flagBoundingInfoDirty),null!=o&&(o.addChild(this),this._patchHierarchy(o.owner)),this.owner&&this instanceof e.Group2D){var s=this;s.detectGroupStates()}if(null!=n.children)for(var a=0,h=n.children;a<h.length;a++){var l=h[a];this.addChild(l),l._patchHierarchy(this.owner)}if(null!=n.position?this.position=n.position:null!=n.x||null!=n.y?this.position=new e.Vector2(n.x||0,n.y||0):this._position=null,this.rotation=null==n.rotation?0:n.rotation,this.scale=null==n.scale?1:n.scale,this.levelVisible=null==n.isVisible||n.isVisible,this.origin=n.origin||new e.Vector2(.5,.5),null!=n.layoutEngine)if("string"==typeof n.layoutEngine){var c=n.layoutEngine.toLocaleLowerCase().trim();"canvas"===c||"canvaslayoutengine"===c?this.layoutEngine=e.CanvasLayoutEngine.Singleton:0===c.indexOf("stackpanel")||0===c.indexOf("horizontalstackpanel")?this.layoutEngine=e.StackPanelLayoutEngine.Horizontal:0===c.indexOf("verticalstackpanel")&&(this.layoutEngine=e.StackPanelLayoutEngine.Vertical)}else n.layoutEngine instanceof e.LayoutEngineBase&&(this.layoutEngine=n.layoutEngine);n.marginTop&&this.margin.setTop(n.marginTop),n.marginLeft&&this.margin.setLeft(n.marginLeft),n.marginRight&&this.margin.setRight(n.marginRight),n.marginBottom&&this.margin.setBottom(n.marginBottom),n.margin&&("string"==typeof n.margin?this.margin.fromString(n.margin):this.margin.fromUniformPixels(n.margin)),n.marginHAlignment&&(this.marginAlignment.horizontal=n.marginHAlignment),n.marginVAlignment&&(this.marginAlignment.vertical=n.marginVAlignment),n.marginAlignment&&this.marginAlignment.fromString(n.marginAlignment),n.paddingTop&&this.padding.setTop(n.paddingTop),n.paddingLeft&&this.padding.setLeft(n.paddingLeft),n.paddingRight&&this.padding.setRight(n.paddingRight),n.paddingBottom&&this.padding.setBottom(n.paddingBottom),n.padding&&this.padding.fromString(n.padding),this._parentLayoutDirty(),this._positioningDirty()}return __extends(i,t),Object.defineProperty(i.prototype,"actionManager",{get:function(){return this._actionManager||(this._actionManager=new e.ActionManager(this.owner.scene)),this._actionManager},enumerable:!0,configurable:!0}),i.prototype.traverseUp=function(e){for(var t=this;null!=t;){if(e(t))return t;t=t._parent}return null},Object.defineProperty(i.prototype,"owner",{get:function(){return this._owner},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"actualPosition",{get:function(){return null!=this._actualPosition?this._actualPosition:null!=this._position?this._position:i._nullPosition},set:function(e){this._actualPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"actualX",{get:function(){return this.actualPosition.x},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"actualY",{get:function(){return this.actualPosition.y},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(e){this._checkPositionChange()&&(this._position=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._position?this._position.x:null},set:function(t){this._checkPositionChange()&&(this._position||(this._position=e.Vector2.Zero()),this._position.x!==t&&(this._position.x=t,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._position?this._position.y:null},set:function(t){this._checkPositionChange()&&(this._position||(this._position=e.Vector2.Zero()),this._position.y!==t&&(this._position.y=t,this.markAsDirty("position")))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this._size&&null!=this._size.width&&null!=this._size.height?this._size:i.boundinbBoxReentrency?i.nullSize:this._boundingSize?this._boundingSize:(i.boundinbBoxReentrency=!0,this.boundingInfo,i.boundinbBoxReentrency=!1,this._boundingSize)},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this.size?this.size.width:null},set:function(t){return this.size?void(this.size.width!==t&&(this.size.width=t,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new e.Size(t,0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.size?this.size.height:null},set:function(t){return this.size?void(this.size.height!==t&&(this.size.height=t,this.markAsDirty("size"),this._positioningDirty())):void(this.size=new e.Size(0,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},set:function(e){this._scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this._size},set:function(e){this._actualSize.equals(e)||(this._actualSize=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"actualZOffset",{get:function(){return this._zOrder||1-this._hierarchyDepthOffset},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"minSize",{get:function(){return this._minSize},set:function(e){this._minSize&&e&&this._minSize.equals(e)||(this._minSize=e,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxSize",{get:function(){return this._maxSize},set:function(e){this._maxSize&&e&&this._maxSize.equals(e)||(this._maxSize=e,this._parentLayoutDirty())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"origin",{get:function(){return this._origin},set:function(e){this._origin=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"levelVisible",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagLevelVisible)},set:function(t){this._changeFlags(e.SmartPropertyPrim.flagLevelVisible,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isVisible",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagIsVisible)},set:function(t){this._changeFlags(e.SmartPropertyPrim.flagIsVisible,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"zOrder",{get:function(){return this._zOrder},set:function(e){this._zOrder=e,this.onZOrderChanged()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"margin",{get:function(){var e=this;return this._margin||(this._margin=new s(function(){return e.parent?e.parent.margin:null},function(){return e._positioningDirty()})),this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_hasMargin",{get:function(){return null!==this._margin||null!==this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"padding",{get:function(){var e=this;return this._padding||(this._padding=new s(function(){return e.parent?e.parent.padding:null},function(){return e._positioningDirty()})),this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"_hasPadding",{get:function(){return null!==this._padding},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"marginAlignment",{get:function(){var e=this;return this._marginAlignment||(this._marginAlignment=new r(function(){return e._positioningDirty()})),this._marginAlignment},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layoutEngine",{get:function(){return this._layoutEngine||(this._layoutEngine=e.CanvasLayoutEngine.Singleton),this._layoutEngine},set:function(e){this._layoutEngine!==e&&this._changeLayoutEngine(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layoutArea",{get:function(){return this._layoutArea},set:function(e){this._layoutArea.equals(e)||(this._positioningDirty(),this._layoutArea=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"layoutAreaPos",{get:function(){return this._layoutAreaPos},set:function(e){this._layoutAreaPos.equals(e)||(this._positioningDirty(),this._layoutAreaPos=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPickable",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagIsPickable)},set:function(t){this._changeFlags(e.SmartPropertyPrim.flagIsPickable,t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hierarchyDepth",{get:function(){return this._hierarchyDepth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"renderGroup",{get:function(){return this._renderGroup},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"globalTransform",{get:function(){return this._globalTransform},enumerable:!0,configurable:!0}),i.prototype.getGlobalPosition=function(){var t=new e.Vector2(0,0);return this.getGlobalPositionByRef(t),t},i.prototype.getGlobalPositionByRef=function(e){e.x=this.globalTransform.m[12],e.y=this.globalTransform.m[13]},Object.defineProperty(i.prototype,"invGlobalTransform",{get:function(){return this._invGlobalTransform},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"localTransform",{get:function(){return this._updateLocalTransform(),this._localTransform},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingInfo",{get:function(){if(this._isFlagSet(e.SmartPropertyPrim.flagBoundingInfoDirty)){this._boundingInfo=this.levelBoundingInfo.clone();for(var t=this._boundingInfo,i=new e.BoundingInfo2D,n=0,r=this._children;n<r.length;n++){var o=r[n];o.boundingInfo.transformToRef(o.localTransform,i),t.unionToRef(i,t)}this._boundingSize=e.Size.Zero();var s=this._boundingInfo.max();this._boundingSize=new e.Size(this._size&&null!=this._size.width?this._size.width:Math.ceil(s.x),this._size&&null!=this._size.height?this._size.height:Math.ceil(s.y)),this._clearFlags(e.SmartPropertyPrim.flagBoundingInfoDirty)}return this._boundingInfo},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isSizeAuto",{get:function(){return null==this._size},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPositionAuto",{get:function(){return null==this._position},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"pointerEventObservable",{get:function(){return this._pointerEventObservable},enumerable:!0,configurable:!0}),i.prototype.findById=function(e){if(this._id===e)return this;for(var t=0,i=this._children;t<i.length;t++){var n=i[t],r=n.findById(e);if(null!=r)return r}},i.prototype.onZOrderChanged=function(){},i.prototype.levelIntersect=function(e){return!1},i.prototype.setPointerEventCapture=function(e){return this.owner._setPointerCapture(e,this)},i.prototype.releasePointerEventsCapture=function(e){return this.owner._releasePointerCapture(e,this)},i.prototype.intersect=function(t){if(!t)return!1;var i=!t._globalPickPosition;if(i&&(t._globalPickPosition=e.Vector2.Zero(),e.Vector2.TransformToRef(t.pickPosition,this.globalTransform,t._globalPickPosition),t._localPickPosition=t.pickPosition.clone(),t.intersectedPrimitives=new Array,t.topMostIntersectedPrimitive=null),!t.intersectHidden&&!this.isVisible)return!1;if(this.isPickable&&!this.boundingInfo.doesIntersect(t._localPickPosition))return t._exit(i),!1;var n=!1;if(this.isPickable&&(n=this.levelIntersect(t))){var r=new o(this,t._localPickPosition.clone());if(t.intersectedPrimitives.push(r),(!t.topMostIntersectedPrimitive||t.topMostIntersectedPrimitive.prim.actualZOffset>r.prim.actualZOffset)&&(t.topMostIntersectedPrimitive=r),t.findFirstOnly)return t._exit(i),!0}if(!n||!t.findFirstOnly)for(var s=0,a=this._children;s<a.length;s++){var h=a[s];if(h.isPickable&&(t.intersectHidden||h.isVisible)&&(e.Vector2.TransformToRef(t._globalPickPosition,h.invGlobalTransform,t._localPickPosition),h.intersect(t)&&t.findFirstOnly))return t._exit(i),!0}return t._exit(i),t.isIntersected},i.prototype.moveChild=function(e,t){if(e.parent!==this)return!1;var i,n,r=this._children.indexOf(e),o=t?this._children.indexOf(t):-1;t?(i=this._children[o]._siblingDepthOffset,n=this._children[o+1]._siblingDepthOffset):(i=1,n=this._children[1]._siblingDepthOffset),e._siblingDepthOffset=(n-i)/2,this._children.splice(o+1,0,this._children.splice(r,1)[0])},i.prototype.addChild=function(e){e._parent=this,this._boundingBoxDirty(),this._patchHierarchyDepth(e),this._children.push(e)},i.prototype.dispose=function(){if(!t.prototype.dispose.call(this))return!1;if(this._actionManager&&(this._actionManager.dispose(),this._actionManager=null),this._parent){var e=this._parent._children.indexOf(this);void 0!==e&&this._parent._children.splice(e,1),this._parent=null}if(this._children)for(;this._children.length>0;)this._children[this._children.length-1].dispose();return!0},i.prototype.onPrimBecomesDirty=function(){this._renderGroup&&this._renderGroup._addPrimToDirtyList(this)},i.prototype._needPrepare=function(){return this._areSomeFlagsSet(e.SmartPropertyPrim.flagVisibilityChanged|e.SmartPropertyPrim.flagModelDirty)||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep},i.prototype._prepareRender=function(e){this._prepareRenderPre(e),this._prepareRenderPost(e)},i.prototype._prepareRenderPre=function(e){},i.prototype._prepareRenderPost=function(t){if(this instanceof e.Group2D){var n=this;if(n.isRenderableGroup)return}this._children.length>0&&(this._globalTransformProcessStep!==this._globalTransformStep||this.checkPropertiesDirty(i.isVisibleProperty.flagId))&&this._children.forEach(function(i){i instanceof e.Group2D&&i.isRenderableGroup||i._prepareRender(t)}),this._clearFlags(e.SmartPropertyPrim.flagModelDirty),this._instanceDirtyFlags=0},i.prototype._canvasPreInit=function(e){},i.CheckParent=function(e){},i.prototype.updateCachedStatesOf=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];n.updateCachedStates(t)}},i.prototype._parentLayoutDirty=function(){this._parent&&!this._parent.isDisposed&&this._parent._setLayoutDirty()},i.prototype._setLayoutDirty=function(){this.isDirty||this.onPrimBecomesDirty(),this._setFlags(e.SmartPropertyPrim.flagLayoutDirty)},i.prototype._checkPositionChange=function(){return!this.parent||this.parent.layoutEngine.isChildPositionAllowed!==!1||(console.log("Can't manually set the position of "+this.id+", the Layout Engine of its parent doesn't allow it"),!1)},i.prototype._positioningDirty=function(){this.isDirty||this.onPrimBecomesDirty(),this._setFlags(e.SmartPropertyPrim.flagPositioningDirty)},i.prototype._changeLayoutEngine=function(e){this._layoutEngine=e},i.prototype._updateLocalTransform=function(){var t=!1,n=null;this._parent?(n=this._parent._marginOffset,t=!n.equals(this._parentMargingOffset),this._parentMargingOffset.copyFrom(n)):n=i._v0;var r=i.actualPositionProperty.flagId|i.rotationProperty.flagId|i.scaleProperty.flagId|i.originProperty.flagId;if(t||this.checkPropertiesDirty(r)){var o,s=e.Quaternion.RotationAxis(new e.Vector3(0,0,1),this._rotation);if(0===this._origin.x&&0===this._origin.y)o=e.Matrix.Compose(new e.Vector3(this._scale,this._scale,1),s,new e.Vector3(this.actualPosition.x+n.x,this.actualPosition.y+n.y,0)),this._localTransform=o;else{var a=this.actualSize;e.Matrix.TranslationToRef(-a.width*this._origin.x,-a.height*this._origin.y,0,i._t0),s.toRotationMatrix(i._t1),i._t0.multiplyToRef(i._t1,i._t2),e.Matrix.ScalingToRef(this._scale,this._scale,1,i._t0),i._t2.multiplyToRef(i._t0,i._t1),e.Matrix.TranslationToRef(a.width*this._origin.x+this.actualPosition.x+n.x,a.height*this._origin.y+this.actualPosition.y+n.y,0,i._t2),i._t1.multiplyToRef(i._t2,this._localTransform)}return this.clearPropertiesDirty(r),!0}return!1},i.prototype.updateCachedStates=function(t){if(!this.isDisposed){this._parent&&(this._parent._globalTransformProcessStep!==this.owner._globalTransformProcessStep||this._parent._areSomeFlagsSet(e.SmartPropertyPrim.flagLayoutDirty|e.SmartPropertyPrim.flagPositioningDirty))&&this._parent.updateCachedStates(!1);var n=this.checkPropertiesDirty(i.sizeProperty.flagId);if(!this._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)&&n){var r=this.size;r&&(null!=this.size.width&&(this.actualSize.width=this.size.width),null!=this.size.height&&(this.actualSize.height=this.size.height),this.clearPropertiesDirty(i.sizeProperty.flagId))}var o=this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty);this._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)&&(this._layoutEngine.updateLayout(this),this._clearFlags(e.SmartPropertyPrim.flagLayoutDirty));var s=o&&!this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty);if(!s&&(n||this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty)||this._parent&&!this._parent.contentArea.equals(this._parentContentArea))&&(this._updatePositioning(),this._clearFlags(e.SmartPropertyPrim.flagPositioningDirty),s=!0),s&&this._parent&&this._parentContentArea.copyFrom(this._parent.contentArea),this===this.owner||this._globalTransformProcessStep!==this.owner._globalTransformProcessStep){var a=this.isVisible;this.isVisible=(!this._parent||this._parent.isVisible)&&this.levelVisible,this._changeFlags(e.SmartPropertyPrim.flagVisibilityChanged,a!==this.isVisible);var h=this._updateLocalTransform(),l=null!=this._parent&&this._parent._globalTransformStep!==this._parentTransformStep;if(!this._globalTransform||h||l){var c=this._parent?this._parent._globalTransform:null;this._globalTransform=this._parent?this._localTransform.multiply(c):this._localTransform,this._invGlobalTransform=e.Matrix.Invert(this._globalTransform),this._globalTransformStep=this.owner._globalTransformProcessStep+1,this._parentTransformStep=this._parent?this._parent._globalTransformStep:0}this._globalTransformProcessStep=this.owner._globalTransformProcessStep}if(t)for(var u=0,d=this._children;u<d.length;u++){var f=d[u];f.updateCachedStates(!(f instanceof e.Group2D&&f.isRenderableGroup))}}},i.prototype._updatePositioning=function(){this._hasMargin||null!=this.actualSize.width&&null!=this.actualSize.height||(null==this.actualSize.width&&(this.marginAlignment.horizontal=r.AlignStretch),null==this.actualSize.height&&(this.marginAlignment.vertical=r.AlignStretch)),this._hasMargin&&(this.margin.computeWithAlignment(this.layoutArea,this.size,this.marginAlignment,this._marginOffset,i._size),this.actualPosition=this._marginOffset.add(this._layoutAreaPos),null!=this.size.width&&(this.size.width=i._size.width),null!=this.size.height&&(this.size.height=i._size.height),this.actualSize.copyFrom(i._size.clone())),this._hasPadding?(this._getInitialContentAreaToRef(this.actualSize,i._icPos,i._icArea),i._icArea.width=Math.max(0,i._icArea.width),i._icArea.height=Math.max(0,i._icArea.height),this.padding.compute(i._icArea,this._marginOffset,i._size),this._marginOffset.x+=i._icPos.x,this._marginOffset.y+=i._icPos.y,this._contentArea.copyFrom(i._size)):(this._getInitialContentAreaToRef(this.actualSize,i._icPos,i._icArea),i._icArea.width=Math.max(0,i._icArea.width),i._icArea.height=Math.max(0,i._icArea.height),this._marginOffset.copyFrom(i._icPos),this._contentArea.copyFrom(i._icArea))},Object.defineProperty(i.prototype,"contentArea",{get:function(){return this._isFlagSet(e.SmartPropertyPrim.flagPositioningDirty)&&(this._updatePositioning(),this._clearFlags(e.SmartPropertyPrim.flagPositioningDirty)),this._contentArea},enumerable:!0,configurable:!0}),i.prototype._patchHierarchy=function(t){if(this._owner=t,null==this._renderGroup){if(this instanceof e.Group2D){var i=this;i.detectGroupStates(),i._trackedNode&&!i._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)&&i.owner._registerTrackedNode(this)}if(this._parent&&(this._renderGroup=this.parent.traverseUp(function(t){return t instanceof e.Group2D&&t.isRenderableGroup}),this._parentLayoutDirty()),this._renderGroup&&this.isDirty){var n=this._renderGroup._renderableData._primDirtyList,r=n.indexOf(this);-1===r&&n.push(this)}for(var o=0,s=this._children;o<s.length;o++){var a=s[o];this._patchHierarchyDepth(a),a._patchHierarchy(t)}}},i.prototype._patchHierarchyDepth=function(t){t._hierarchyDepth=this._hierarchyDepth+1,t._hierarchyDepthOffset=this._hierarchyDepthOffset+(this._children.length+1)*this._siblingDepthOffset,t._siblingDepthOffset=this._siblingDepthOffset/e.Canvas2D.hierarchyLevelMaxSiblingCount},i.prototype._getInitialContentAreaToRef=function(e,t,i){i.width=e.width,i.height=e.height,t.x=t.y=0},i.PRIM2DBASE_PROPCOUNT=15,i._nullPosition=e.Vector2.Zero(),i.boundinbBoxReentrency=!1,i.nullSize=e.Size.Zero(),i._isCanvasInit=!1,i._t0=new e.Matrix,i._t1=new e.Matrix,i._t2=new e.Matrix,i._v0=e.Vector2.Zero(),i._icPos=e.Vector2.Zero(),i._icArea=e.Size.Zero(),i._size=e.Size.Zero(),__decorate([e.instanceLevelProperty(1,function(e){return i.actualPositionProperty=e},!1,!0)],i.prototype,"actualPosition",null),__decorate([e.dynamicLevelProperty(1,function(e){return i.positionProperty=e},!1,!0)],i.prototype,"position",null),__decorate([e.dynamicLevelProperty(2,function(e){return i.sizeProperty=e},!1,!0)],i.prototype,"size",null),__decorate([e.instanceLevelProperty(3,function(e){return i.rotationProperty=e},!1,!0)],i.prototype,"rotation",null),__decorate([e.instanceLevelProperty(4,function(e){return i.scaleProperty=e},!1,!0)],i.prototype,"scale",null),__decorate([e.dynamicLevelProperty(5,function(e){return i.originProperty=e},!1,!0)],i.prototype,"origin",null),__decorate([e.dynamicLevelProperty(6,function(e){return i.levelVisibleProperty=e})],i.prototype,"levelVisible",null),__decorate([e.instanceLevelProperty(7,function(e){return i.isVisibleProperty=e})],i.prototype,"isVisible",null),__decorate([e.instanceLevelProperty(8,function(e){return i.zOrderProperty=e})],i.prototype,"zOrder",null),__decorate([e.dynamicLevelProperty(9,function(e){return i.marginProperty=e})],i.prototype,"margin",null),__decorate([e.dynamicLevelProperty(10,function(e){return i.paddingProperty=e})],i.prototype,"padding",null),__decorate([e.dynamicLevelProperty(11,function(e){return i.marginAlignmentProperty=e})],i.prototype,"marginAlignment",null),i=__decorate([e.className("Prim2DBase")],i)}(e.SmartPropertyPrim);e.Prim2DBase=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n){this._partCount=n,this.owner=t,this.modelRenderCache=i,this.modelRenderCache.addRef(),this.partIndexFromId=new e.StringDictionary,this._usedShaderCategories=new Array(n),this._strides=new Array(n),this._opaqueData=null,this._alphaTestData=null,this._transparentData=null,this.opaqueDirty=this.alphaTestDirty=this.transparentDirty=this.transparentOrderDirty=!1}return t.prototype.dispose=function(){if(this._isDisposed)return!1;this.modelRenderCache&&this.modelRenderCache.dispose();var e=this.owner.owner.engine;return this.opaqueData&&(this.opaqueData.forEach(function(t){return t.dispose(e)}),this.opaqueData=null),this.partIndexFromId=null,this._isDisposed=!0,!0},Object.defineProperty(t.prototype,"hasOpaqueData",{get:function(){return null!=this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasAlphaTestData",{get:function(){return null!=this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasTransparentData",{get:function(){return null!=this._transparentData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opaqueData",{get:function(){if(!this._opaqueData){this._opaqueData=new Array(this._partCount);for(var e=0;e<this._partCount;e++)this._opaqueData[e]=new n(this._strides[e])}return this._opaqueData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alphaTestData",{get:function(){if(!this._alphaTestData){this._alphaTestData=new Array(this._partCount);for(var e=0;e<this._partCount;e++)this._alphaTestData[e]=new n(this._strides[e])}return this._alphaTestData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transparentData",{get:function(){if(!this._transparentData){this._transparentData=new Array(this._partCount);for(var e=0;e<this._partCount;e++){var t=this.modelRenderCache._partData[e]._zBiasOffset;this._transparentData[e]=new r(this._strides[e],t)}}return this._transparentData},enumerable:!0,configurable:!0}),t.prototype.sortTransparentData=function(){if(this.transparentOrderDirty){for(var e=0;e<this._transparentData.length;e++){var t=this._transparentData[e];t._partData.sort()}this.transparentOrderDirty=!1}},Object.defineProperty(t.prototype,"usedShaderCategories",{get:function(){return this._usedShaderCategories},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strides",{get:function(){return this._strides},enumerable:!0,configurable:!0}),t}();e.GroupInstanceInfo=t;var i=function(){function e(){}return e}();e.TransparentSegment=i;var n=function(){function t(t){this._partData=null,this._partBuffer=null,this._partBufferSize=0,this._partData=new e.DynamicFloatArray(t/4,50),this._isDisposed=!1}return t.prototype.dispose=function(e){return!this._isDisposed&&(this._partBuffer&&(e._releaseBuffer(this._partBuffer),this._partBuffer=null),this._partData=null,void(this._isDisposed=!0))},t}();e.GroupInfoPartData=n;var r=function(e){function t(t,i){e.call(this,t),this._partData.compareValueOffset=i,this._partData.sortingAscending=!1}return __extends(t,e),t}(n);e.TransparentGroupInfoPartData=r;var o=function(){function t(t,i){this._engine=t,this._modelKey=i,this._nextKey=1,
this._refCounter=1,this._instancesData=new e.StringDictionary,this._partData=null}return t.prototype.dispose=function(){if(0!==--this._refCounter)return!1;var e=this._engine.getExternalData("__BJSCANVAS2D__");return e&&e.DisposeModelRenderCache(this),!0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._refCounter<=0},enumerable:!0,configurable:!0}),t.prototype.addRef=function(){return++this._refCounter},Object.defineProperty(t.prototype,"modelKey",{get:function(){return this._modelKey},enumerable:!0,configurable:!0}),t.prototype.render=function(e,t){return!0},t.prototype.addInstanceDataParts=function(e){var t=this._nextKey.toString();if(!this._instancesData.add(t,e))throw Error("Key: "+t+" is already allocated");return++this._nextKey,t},t.prototype.removeInstanceData=function(e){this._instancesData.remove(e)},t.prototype.getPartIndexFromId=function(e){for(var t=0;t<this._partData.length;t++)if(this._partData[t]._partId===e)return t;return null},t.prototype.loadInstancingAttributes=function(e,t){var i=this.getPartIndexFromId(e);if(null===i)return null;var n=this._partsClassInfo[i],r=this._partData[i]._partUsedCategories,o=n.classContent.getInstancingAttributeInfos(t,r);return o},t.prototype.setupUniforms=function(e,i,n,r){var o=this._partData[i],s=o._partDataStride/4*r,a=this._partsClassInfo[i];a.fullContent.forEach(function(i,r){if(!r.category||-1!==o._partUsedCategories.indexOf(r.category))switch(r.dataType){case 4:var a=r.instanceOffset.get(o._partJoinedUsedCategories);e.setFloat(r.attributeName,n.buffer[s+a]);break;case 0:var a=r.instanceOffset.get(o._partJoinedUsedCategories);t.v2.x=n.buffer[s+a+0],t.v2.y=n.buffer[s+a+1],e.setVector2(r.attributeName,t.v2);break;case 5:case 1:var a=r.instanceOffset.get(o._partJoinedUsedCategories);t.v3.x=n.buffer[s+a+0],t.v3.y=n.buffer[s+a+1],t.v3.z=n.buffer[s+a+2],e.setVector3(r.attributeName,t.v3);break;case 6:case 2:var a=r.instanceOffset.get(o._partJoinedUsedCategories);t.v4.x=n.buffer[s+a+0],t.v4.y=n.buffer[s+a+1],t.v4.z=n.buffer[s+a+2],t.v4.w=n.buffer[s+a+3],e.setVector4(r.attributeName,t.v4)}})},t.v2=e.Vector2.Zero(),t.v3=e.Vector3.Zero(),t.v4=e.Vector4.Zero(),t}();e.ModelRenderCache=o;var s=function(){function e(){}return e}();e.ModelRenderCachePartData=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){function t(t,r){return function(o,s,a){var h=e.ClassTreeInfo.getOrRegister(o,function(e){return new i(e)}),l=h.getLevelOf(o),c=s;r=r||c;var u=l.levelContent.get(c);if(u)throw new Error("The ID "+c+" is already taken by another instance data");u=new n,u.attributeName=r,u.category=t||null,u.category&&(u.delimitedCategory=";"+u.category+";"),l.levelContent.add(c,u),a.get=function(){return null},a.set=function(e){if(!u.category||-1!==i._CurCategories.indexOf(u.delimitedCategory)){u.size?u.instanceOffset.contains(i._CurCategories)||l.classContent.mapProperty(u,!1):(u.setSize(e),l.classContent.mapProperty(u,!0));var t=this;if(t.dataBuffer&&t.dataElements){var n=t.dataElements[t.curElement].offset+u.instanceOffset.get(i._CurCategories);u.writeData(t.dataBuffer.buffer,n,e)}}}}}var i=function(){function t(t){this._baseInfo=t,this._nextOffset=new e.StringDictionary,this._attributes=new Array}return t.prototype.mapProperty=function(e,i){var n=this._nextOffset.getOrAdd(t._CurCategories,0);e.instanceOffset.add(t._CurCategories,this._getBaseOffset(t._CurCategories)+n),this._nextOffset.set(t._CurCategories,n+e.size/4),i&&this._attributes.push(e)},t.prototype.getInstancingAttributeInfos=function(t,i){for(var n=";"+i.join(";")+";",r=new Array,o=this;o;){for(var s=0,a=o._attributes;s<a.length;s++){var h=a[s];if(!h.category||-1!==i.indexOf(h.category)){var l=t.getAttributeLocationByName(h.attributeName),c=new e.InstancingAttributeInfo;c.index=l,c.attributeSize=h.size/4,c.offset=4*h.instanceOffset.get(n),c.attributeName=h.attributeName,r.push(c)}}o=o._baseInfo}return r},t.prototype.getShaderAttributes=function(e){for(var t=new Array,i=this;i;){for(var n=0,r=i._attributes;n<r.length;n++){var o=r[n];o.category&&-1===e.indexOf(o.category)||t.push(o.attributeName)}i=i._baseInfo}return t},t.prototype._getBaseOffset=function(e){for(var t=0,i=this._baseInfo;i;)t+=i._nextOffset.getOrAdd(e,0),i=i._baseInfo;return t},t}();e.InstanceClassInfo=i;var n=function(){function t(){this.instanceOffset=new e.StringDictionary}return t.prototype.setSize=function(t){if(t instanceof e.Vector2)return this.size=8,void(this.dataType=0);if(t instanceof e.Vector3)return this.size=12,void(this.dataType=1);if(t instanceof e.Vector4)return this.size=16,void(this.dataType=2);if(t instanceof e.Matrix)throw new Error("Matrix type is not supported by WebGL Instance Buffer, you have to use four Vector4 properties instead");return"number"==typeof t?(this.size=4,void(this.dataType=4)):t instanceof e.Color3?(this.size=12,void(this.dataType=5)):t instanceof e.Color4?(this.size=16,void(this.dataType=6)):t instanceof e.Size?(this.size=8,void(this.dataType=7)):void 0},t.prototype.writeData=function(e,t,i){switch(this.dataType){case 0:var n=i;e[t+0]=n.x,e[t+1]=n.y;break;case 1:var n=i;e[t+0]=n.x,e[t+1]=n.y,e[t+2]=n.z;break;case 2:var n=i;e[t+0]=n.x,e[t+1]=n.y,e[t+2]=n.z,e[t+3]=n.w;break;case 5:var n=i;e[t+0]=n.r,e[t+1]=n.g,e[t+2]=n.b;break;case 6:var n=i;e[t+0]=n.r,e[t+1]=n.g,e[t+2]=n.b,e[t+3]=n.a;break;case 4:var n=i;e[t]=n;break;case 3:for(var n=i,r=0;16>r;r++)e[t+r]=n.m[r];break;case 7:var o=i;e[t+0]=o.width,e[t+1]=o.height}},t}();e.InstancePropInfo=n,e.instanceData=t;var r=function(){function i(e,t){this.id=e,this.curElement=0,this.dataElementCount=t}return Object.defineProperty(i.prototype,"zBias",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transformX",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"transformY",{get:function(){return null},enumerable:!0,configurable:!0}),i.prototype.getClassTreeInfo=function(){return this.typeInfo||(this.typeInfo=e.ClassTreeInfo.get(Object.getPrototypeOf(this))),this.typeInfo},i.prototype.allocElements=function(){if(this.dataBuffer){for(var e=new Array(this.dataElementCount),t=0;t<this.dataElementCount;t++)e[t]=this.dataBuffer.allocElement();this.dataElements=e}},i.prototype.freeElements=function(){if(this.dataElements){for(var e=0,t=this.dataElements;e<t.length;e++){var i=t[e];this.dataBuffer.freeElement(i)}this.dataElements=null}},Object.defineProperty(i.prototype,"dataElementCount",{get:function(){return this._dataElementCount},set:function(e){e!==this._dataElementCount&&(this.freeElements(),this._dataElementCount=e,this.allocElements())},enumerable:!0,configurable:!0}),__decorate([t()],i.prototype,"zBias",null),__decorate([t()],i.prototype,"transformX",null),__decorate([t()],i.prototype,"transformY",null),i}();e.InstanceDataBase=r;var o=function(t){function n(e){t.call(this,e),this._isTransparent=!1,this._isAlphaTest=!1,this._transparentPrimitiveInfo=null}return __extends(n,t),Object.defineProperty(n.prototype,"isAlphaTest",{get:function(){return this._isAlphaTest},set:function(e){this._isAlphaTest=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isTransparent",{get:function(){return this._isTransparent},set:function(e){this._isTransparent=e},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=null),this._modelRenderCache&&(this._modelRenderCache.dispose(),this._modelRenderCache=null),this._instanceDataParts&&(this._instanceDataParts.forEach(function(e){e.freeElements()}),this._instanceDataParts=null),!0)},n.prototype._prepareRenderPre=function(i){t.prototype._prepareRenderPre.call(this,i),this._isFlagSet(e.SmartPropertyPrim.flagModelDirty)&&this._modelRenderInstanceID&&(this._modelRenderCache.removeInstanceData(this._modelRenderInstanceID),this._modelRenderInstanceID=null);var n=!1;this._modelRenderCache&&!this._isFlagSet(e.SmartPropertyPrim.flagModelDirty)||(n=this._createModelRenderCache());var r=null,o=!1;this._modelRenderInstanceID||(o=!0,r=this._createModelDataParts()),n&&this.setupModelRenderCache(this._modelRenderCache),(this._isFlagSet(e.SmartPropertyPrim.flagVisibilityChanged)||i.forceRefreshPrimitive||o||0!==this._instanceDirtyFlags||this._globalTransformProcessStep!==this._globalTransformStep)&&(this.isTransparent,this._updateInstanceDataParts(r))},n.prototype._createModelRenderCache=function(){var t=this,i=!1;return this._modelRenderCache&&this._modelRenderCache.dispose(),this._modelRenderCache=this.owner._engineData.GetOrAddModelCache(this.modelKey,function(e){var n=t.createModelRenderCache(e);return i=!0,n}),this._clearFlags(e.SmartPropertyPrim.flagModelDirty),i||this._modelRenderCache.addRef(),i},n.prototype._createModelDataParts=function(){var t=this,i=this.createInstanceDataParts();this._instanceDataParts=i,this._modelRenderCache._partData||this._setupModelRenderCache(i);var n=this.renderGroup._renderableData._renderGroupInstancesInfo.getOrAddWithFactory(this.modelKey,function(i){for(var n=new e.GroupInstanceInfo(t.renderGroup,t._modelRenderCache,t._modelRenderCache._partData.length),r=0;r<t._modelRenderCache._partData.length;r++){var o=t._instanceDataParts[r];n.partIndexFromId.add(o.id.toString(),r),n.usedShaderCategories[r]=";"+t.getUsedShaderCategories(o).join(";")+";",n.strides[r]=t._modelRenderCache._partData[r]._partDataStride}return n}),r=null;r=this.isTransparent?n.transparentData:this.isAlphaTest?n.alphaTestData:n.opaqueData;for(var o=0;o<i.length;o++){var s=i[o];s.dataBuffer=r[o]._partData,s.allocElements()}return this._modelRenderInstanceID=this._modelRenderCache.addInstanceDataParts(this._instanceDataParts),n},n.prototype._setupModelRenderCache=function(t){var n=new Array;this._modelRenderCache._partData=new Array;for(var r=0;r<t.length;r++){var o=t[r],s=new e.ModelRenderCachePartData;this._modelRenderCache._partData.push(s);var a=this.getUsedShaderCategories(o),h=o.getClassTreeInfo(),l=this.isVisible;this.isVisible=!0;var c=";"+a.join(";")+";";s._partJoinedUsedCategories=c,i._CurCategories=c;var u=this.beforeRefreshForLayoutConstruction(o);this.refreshInstanceDataPart(o),this.afterRefreshForLayoutConstruction(o,u),this.isVisible=l;var d=0;h.fullContent.forEach(function(t,i){i.category&&-1===a.indexOf(i.category)||("zBias"===i.attributeName&&(s._zBiasOffset=i.instanceOffset.get(c)),i.size?d+=i.size:console.log("ERROR: Couldn't detect the size of the Property "+i.attributeName+" from type "+e.Tools.getClassName(h.type)+". Property is ignored."))}),s._partDataStride=d,s._partUsedCategories=a,s._partId=o.id,n.push(h)}this._modelRenderCache._partsClassInfo=n},n.prototype.onZOrderChanged=function(){if(this.isTransparent&&this._transparentPrimitiveInfo){this.renderGroup._renderableData.transparentPrimitiveZChanged(this._transparentPrimitiveInfo);var e=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey);e.transparentOrderDirty=!0}},n.prototype._updateInstanceDataParts=function(t){t||(t=this.renderGroup._renderableData._renderGroupInstancesInfo.get(this.modelKey)),this.isTransparent&&this._isFlagSet(e.SmartPropertyPrim.flagVisibilityChanged)&&(this.isVisible?this._transparentPrimitiveInfo||(this._transparentPrimitiveInfo=this.renderGroup._renderableData.addNewTransparentPrimitiveInfo(this,t)):this._transparentPrimitiveInfo&&(this.renderGroup._renderableData.removeTransparentPrimitiveInfo(this._transparentPrimitiveInfo),this._transparentPrimitiveInfo=null),t.transparentOrderDirty=!0);for(var n=0,r=this._instanceDataParts;n<r.length;n++){var o=r[n];this._isFlagSet(e.SmartPropertyPrim.flagVisibilityChanged)&&!o.dataElements&&o.allocElements(),i._CurCategories=t.usedShaderCategories[t.partIndexFromId.get(o.id.toString())],this.refreshInstanceDataPart(o)||o.dataElements&&o.freeElements()}this._instanceDirtyFlags=0,this.isTransparent?t.transparentDirty=!0:this.isAlphaTest?t.alphaTestDirty=!0:t.opaqueDirty=!0,this._clearFlags(e.SmartPropertyPrim.flagVisibilityChanged)},n.prototype._getFirstIndexInDataBuffer=function(){for(var e=0,t=this._instanceDataParts;e<t.length;e++){var i=t[e];if(i)return i.dataElements[0].offset/i.dataBuffer.stride}return null},n.prototype._getLastIndexInDataBuffer=function(){for(var e=0,t=this._instanceDataParts;e<t.length;e++){var i=t[e];if(i)return i.dataElements[i.dataElements.length-1].offset/i.dataBuffer.stride}return null},n.prototype._getNextPrimZOrder=function(){for(var e=this._instanceDataParts.length,t=0;e>t;t++){var i=this._instanceDataParts[t];if(i){var n=i.dataBuffer.stride,r=i.dataElements[i.dataElements.length-1].offset;return i.dataBuffer.totalElementCount*n<=r?null:i.dataBuffer[r+n+this.modelRenderCache._partData[t]._zBiasOffset]}}return null},n.prototype._getPrevPrimZOrder=function(){for(var e=this._instanceDataParts.length,t=0;e>t;t++){var i=this._instanceDataParts[t];if(i){var n=i.dataBuffer.stride,r=i.dataElements[0].offset;return 0===r?null:i.dataBuffer[r-n+this.modelRenderCache._partData[t]._zBiasOffset]}}return null},n.prototype.transformPointWithOriginByRef=function(e,t,i){var n=this.actualSize;i.x=e.x-(this.origin.x+(t?t.x:0))*n.width,i.y=e.y-(this.origin.y+(t?t.y:0))*n.height},n.prototype.transformPointWithOriginToRef=function(e,t,i){return this.transformPointWithOriginByRef(e,t,i),i},n.prototype.getDataPartEffectInfo=function(t,i,n){void 0===n&&(n=null);var r=e.Tools.first(this._instanceDataParts,function(e){return e.id===t});if(!r)return null;var o=this.owner.supportInstancedArray;if(null!=n){if(n&&o===!1)return null;o=n}var s=r.getClassTreeInfo(),a=this.getUsedShaderCategories(r),h=s.classContent.getShaderAttributes(a),l="";return a.forEach(function(e){l+="#define "+e+"\n"}),o&&(l+="#define Instanced\n"),{attributes:o?i.concat(h):i,uniforms:o?[]:h,defines:l}},Object.defineProperty(n.prototype,"modelRenderCache",{get:function(){return this._modelRenderCache},enumerable:!0,configurable:!0}),n.prototype.createModelRenderCache=function(e){return null},n.prototype.setupModelRenderCache=function(e){},n.prototype.createInstanceDataParts=function(){return null},n.prototype.getUsedShaderCategories=function(e){return[]},n.prototype.beforeRefreshForLayoutConstruction=function(e){},n.prototype.afterRefreshForLayoutConstruction=function(e,t){},n.prototype.refreshInstanceDataPart=function(e){return!!this.isVisible&&(e.isVisible=this.isVisible,1===e.dataElementCount&&(e.curElement=0,this.updateInstanceDataPart(e)),!0)},n.prototype.updateInstanceDataPart=function(t,i){void 0===i&&(i=null);var n=this._globalTransform.multiply(this.renderGroup.invGlobalTransform),r=this.renderGroup.viewportSize,o=this.actualZOffset,s=0,a=0;i&&(s=i.x*n.m[0]+i.y*n.m[4],a=i.x*n.m[1]+i.y*n.m[5]);var h=r.width,l=r.height,c=1/o,u=new e.Vector4(2*n.m[0]/h,2*n.m[4]/h,0,2*(n.m[12]+s)/h-1),d=new e.Vector4(2*n.m[1]/l,2*n.m[5]/l,0,2*(n.m[13]+a)/l-1);t.transformX=u,t.transformY=d,t.zBias=new e.Vector2(o,c)},n.RENDERABLEPRIM2D_PROPCOUNT=e.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,__decorate([e.dynamicLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+0,function(e){return n.isAlphaTestProperty=e})],n.prototype,"isAlphaTest",null),__decorate([e.dynamicLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(e){return n.isTransparentProperty=e})],n.prototype,"isTransparent",null),n=__decorate([e.className("RenderablePrim2D")],n)}(e.Prim2DBase);e.RenderablePrim2D=o}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i){t.call(this,i),i||(i={});var n=null;i.border&&(n="string"==typeof i.border?e.Canvas2D.GetBrushFromString(i.border):i.border);var r=null;i.fill&&(r="string"==typeof i.fill?e.Canvas2D.GetBrushFromString(i.fill):i.fill),this.border=n,this.fill=r,this.borderThickness=i.borderThickness}return __extends(i,t),Object.defineProperty(i.prototype,"border",{get:function(){return this._border},set:function(e){this._border=e,this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fill",{get:function(){return this._fill},set:function(e){this._fill=e,this._updateTransparencyStatus()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"borderThickness",{get:function(){return this._borderThickness},set:function(e){this._borderThickness=e},enumerable:!0,configurable:!0}),i.prototype.getUsedShaderCategories=function(n){var r=t.prototype.getUsedShaderCategories.call(this,n);if(n.id===i.SHAPE2D_FILLPARTID){var o=this.fill;o instanceof e.SolidColorBrush2D&&r.push(i.SHAPE2D_CATEGORY_FILLSOLID),o instanceof e.GradientColorBrush2D&&r.push(i.SHAPE2D_CATEGORY_FILLGRADIENT)}if(n.id===i.SHAPE2D_BORDERPARTID){r.push(i.SHAPE2D_CATEGORY_BORDER);var s=this.border;s instanceof e.SolidColorBrush2D&&r.push(i.SHAPE2D_CATEGORY_BORDERSOLID),s instanceof e.GradientColorBrush2D&&r.push(i.SHAPE2D_CATEGORY_BORDERGRADIENT)}return r},i.prototype.refreshInstanceDataPart=function(n){if(!t.prototype.refreshInstanceDataPart.call(this,n))return!1;if(n.id===i.SHAPE2D_FILLPARTID){var r=n;if(this.fill){var o=this.fill;if(o instanceof e.SolidColorBrush2D)r.fillSolidColor=o.color;else if(o instanceof e.GradientColorBrush2D){r.fillGradientColor1=o.color1,r.fillGradientColor2=o.color2;var s=e.Matrix.Compose(new e.Vector3(o.scale,o.scale,o.scale),e.Quaternion.RotationAxis(new e.Vector3(0,0,1),o.rotation),new e.Vector3(o.translation.x,o.translation.y,0)),a=new e.Vector4(s.m[1],s.m[5],s.m[9],s.m[13]);r.fillGradientTY=a}}}else if(n.id===i.SHAPE2D_BORDERPARTID){var r=n;if(this.border){r.borderThickness=this.borderThickness;var h=this.border;if(h instanceof e.SolidColorBrush2D)r.borderSolidColor=h.color;else if(h instanceof e.GradientColorBrush2D){r.borderGradientColor1=h.color1,r.borderGradientColor2=h.color2;var s=e.Matrix.Compose(new e.Vector3(h.scale,h.scale,h.scale),e.Quaternion.RotationAxis(new e.Vector3(0,0,1),h.rotation),new e.Vector3(h.translation.x,h.translation.y,0)),a=new e.Vector4(s.m[1],s.m[5],s.m[9],s.m[13]);r.borderGradientTY=a}}}return!0},i.prototype._updateTransparencyStatus=function(){this.isTransparent=this._border&&this._border.isTransparent()||this._fill&&this._fill.isTransparent()},i.SHAPE2D_BORDERPARTID=1,i.SHAPE2D_FILLPARTID=2,i.SHAPE2D_CATEGORY_BORDER="Border",i.SHAPE2D_CATEGORY_BORDERSOLID="BorderSolid",i.SHAPE2D_CATEGORY_BORDERGRADIENT="BorderGradient",i.SHAPE2D_CATEGORY_FILLSOLID="FillSolid",i.SHAPE2D_CATEGORY_FILLGRADIENT="FillGradient",i.SHAPE2D_PROPCOUNT=e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(e){return i.borderProperty=e},!0)],i.prototype,"border",null),__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(e){return i.fillProperty=e},!0)],i.prototype,"fill",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(e){return i.borderThicknessProperty=e})],i.prototype,"borderThickness",null),i=__decorate([e.className("Shape2D")],i)}(e.RenderablePrim2D);e.Shape2D=t;var i=function(i){function n(){i.apply(this,arguments)}return __extends(n,i),Object.defineProperty(n.prototype,"fillSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fillGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderThickness",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderSolidColor",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderGradientColor1",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderGradientColor2",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderGradientTY",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLSOLID)],n.prototype,"fillSolidColor",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLGRADIENT)],n.prototype,"fillGradientColor1",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLGRADIENT)],n.prototype,"fillGradientColor2",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_FILLGRADIENT)],n.prototype,"fillGradientTY",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDER)],n.prototype,"borderThickness",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERSOLID)],n.prototype,"borderSolidColor",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERGRADIENT)],n.prototype,"borderGradientColor1",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERGRADIENT)],n.prototype,"borderGradientColor2",null),__decorate([e.instanceData(t.SHAPE2D_CATEGORY_BORDERGRADIENT)],n.prototype,"borderGradientTY",null),n}(e.InstanceDataBase);e.Shape2DInstanceData=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function n(i){null==i&&(i={}),null==i.origin&&(i.origin=new e.Vector2(0,0)),t.call(this,i);var r=i.size||i.width||i.height?i.size||new e.Size(i.width||0,i.height||0):null;this._trackedNode=null==i.trackNode?null:i.trackNode,this._trackedNode&&this.owner&&this.owner._registerTrackedNode(this),this._cacheBehavior=null==i.cacheBehavior?n.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY:i.cacheBehavior,this.size=r,this._viewportPosition=e.Vector2.Zero()}return __extends(n,t),n._createCachedCanvasGroup=function(t){var i=new n({parent:t,id:"__cachedCanvasGroup__",position:e.Vector2.Zero(),origin:e.Vector2.Zero(),size:null,isVisible:!0});return i},n.prototype.applyCachedTexture=function(t,i){if(this._bindCacheTarget(),t)for(var n=t.uvs,r=this._renderableData._cacheNode.UVs,o=0;4>o;o++)n[2*o+0]=r[o].x,n[2*o+1]=r[o].y;i&&(i.diffuseTexture=this._renderableData._cacheTexture,i.emissiveColor=new e.Color3(1,1,1)),this._renderableData._cacheTexture.hasAlpha=!0,this._unbindCacheTarget()},Object.defineProperty(n.prototype,"cachedRect",{get:function(){return this._renderableData?this._renderableData._cacheNode:null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cacheTexture",{get:function(){return this._renderableData?this._renderableData._cacheTexture:null},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(null!=this._trackedNode&&(this.owner._unregisterTrackedNode(this),this._trackedNode=null),this._renderableData&&(this._renderableData.dispose(),this._renderableData=null),!0)},Object.defineProperty(n.prototype,"isRenderableGroup",{get:function(){return this._isRenderableGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCachedGroup",{get:function(){return this._isCachedGroup},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"size",{get:function(){return this._size},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewportSize",{get:function(){return this._viewportSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"actualSize",{get:function(){var t;if(this._size)t=new e.Size(Math.ceil(this._size.width),Math.ceil(this._size.height));else{var i=this.boundingInfo.max();t=new e.Size(Math.ceil(i.x),Math.ceil(i.y))}return t.equals(this._actualSize)||(this.onPrimitivePropertyDirty(n.actualSizeProperty.flagId),this._actualSize=t,this.handleGroupChanged(n.actualSizeProperty)),t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cacheBehavior",{get:function(){return this._cacheBehavior},enumerable:!0,configurable:!0}),n.prototype._addPrimToDirtyList=function(e){this._renderableData._primDirtyList.push(e)},n.prototype._renderCachedCanvas=function(){this.updateCachedStates(!0);var t=new e.PrepareRender2DContext;this._prepareGroupRender(t),this._groupRender()},Object.defineProperty(n.prototype,"trackedNode",{get:function(){return this._trackedNode},set:function(t){null!=t?(this._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)||this.owner._registerTrackedNode(this),this._trackedNode=t):(this._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)&&this.owner._unregisterTrackedNode(this),this._trackedNode=null)},enumerable:!0,configurable:!0}),n.prototype.levelIntersect=function(e){return!0},n.prototype.updateLevelBoundingInfo=function(){var t;t=this.size?this.size:new e.Size(0,0),e.BoundingInfo2D.CreateFromSizeToRef(t,this._levelBoundingInfo)},n.prototype._prepareGroupRender=function(t){var i=null;if((this._renderableData._primDirtyList.length>0||t.forceRefreshPrimitive)&&(i=this._renderableData._primDirtyList.sort(function(e,t){return e.hierarchyDepth-t.hierarchyDepth}),this.updateCachedStatesOf(i,!0)),this._isCachedGroup){var n=this.actualSize.clone();n.equals(this._viewportSize)||(t.forceRefreshPrimitive=!0),this._viewportSize=n}else{var r=this._globalTransform.getTranslation(),o=this.actualSize.clone(),s=this.owner._renderingSize;o.height=Math.min(o.height,s.height-r.y),o.width=Math.min(o.width,s.width-r.x);var a=r.x,h=r.y;this._viewportPosition.x=a,this._viewportPosition.y=h;var l=o.width,c=o.height;this._viewportSize?(this._viewportSize.width===l&&this._viewportSize.height===c||(t.forceRefreshPrimitive=!0),this._viewportSize.width=l,this._viewportSize.height=c):this._viewportSize=new e.Size(l,c)}if(this._renderableData._primDirtyList.length>0||t.forceRefreshPrimitive)if(this._cacheGroupDirty=this._isCachedGroup,t.forceRefreshPrimitive)for(var u=0,d=this._children;u<d.length;u++){var f=d[u];f._prepareRender(t)}else i||(i=this._renderableData._primDirtyList.sort(function(e,t){return e.hierarchyDepth-t.hierarchyDepth})),i.forEach(function(e){!e.isDisposed&&e._needPrepare()&&e._prepareRender(t)}),this._renderableData._primDirtyList.forEach(function(e){return e._resetPropertiesDirty()}),this._renderableData._primDirtyList.splice(0);this._renderableData._childrenRenderableGroups.forEach(function(e){e._prepareGroupRender(t)})},n.prototype._groupRender=function(){for(var t=this,i=this.owner.engine,n=0,r=0,o=this._renderableData._childrenRenderableGroups;r<o.length;r++){var s=o[r];s._groupRender()}if(!this.isCachedGroup||this._cacheGroupDirty){if(this.isCachedGroup)this._bindCacheTarget();else var a=i.setDirectViewport(this._viewportPosition.x,this._viewportPosition.y,this._viewportSize.width,this._viewportSize.height);var h=i.getAlphaTesting()===!0,l=i.getDepthWrite()===!0;i.setAlphaTesting(!1),i.setDepthWrite(!0);var c=new e.Render2DContext(e.Render2DContext.RenderModeOpaque);this._renderableData._renderGroupInstancesInfo.forEach(function(e,r){var o=t._prepareContext(i,c,r);if(null!==o&&(!t.owner.supportInstancedArray||o>0)){var s=!r.modelRenderCache.render(r,c);r.opaqueDirty=s,n+=s?1:0}}),i.setAlphaTesting(!0),i.setDepthWrite(!0),c=new e.Render2DContext(e.Render2DContext.RenderModeAlphaTest),this._renderableData._renderGroupInstancesInfo.forEach(function(e,r){var o=t._prepareContext(i,c,r);if(null!==o&&(!t.owner.supportInstancedArray||o>0)){var s=!r.modelRenderCache.render(r,c);r.opaqueDirty=s,n+=s?1:0}}),i.setAlphaTesting(!0),i.setDepthWrite(!1),this._renderableData._transparentListChanged&&this._updateTransparentData(),n+=this._renderTransparentData(),this._cacheGroupDirty=0!==n,this.isCachedGroup?this._unbindCacheTarget():a&&i.setViewport(a),i.setAlphaTesting(h),i.setDepthWrite(l)}},n.prototype._updateTransparentData=function(){var t=this._renderableData;if(null!==t._firstChangedPrim){t._transparentPrimitives.sort(function(e,t){return t._primitive.actualZOffset-e._primitive.actualZOffset});var i=function(e,i){var n=t._transparentPrimitives[i];if(e.groupInsanceInfo!==n._groupInstanceInfo)return!1;var r=n._primitive.actualZOffset;return n._transparentSegment=e,r<e.endZ&&(e.endZ=r,e.endDataIndex=n._primitive._getLastIndexInDataBuffer()+1),!0};t._transparentSegments.splice(0);for(var n=null,r=0;r<t._transparentPrimitives.length;r++){var o=t._transparentPrimitives[r];if(o._groupInstanceInfo.transparentOrderDirty&&o._groupInstanceInfo.sortTransparentData(),o._transparentSegment=null,n&&i(n,r),!o._transparentSegment){var s=new e.TransparentSegment;s.groupInsanceInfo=o._groupInstanceInfo;var a=o._primitive;s.startZ=a.actualZOffset,s.startDataIndex=a._getFirstIndexInDataBuffer(),s.endDataIndex=a._getLastIndexInDataBuffer()+1,s.endZ=s.startZ,o._transparentSegment=s,t._transparentSegments.push(s)}n=o._transparentSegment}t._firstChangedPrim=null,t._transparentListChanged=!1}},n.prototype._renderTransparentData=function(){for(var t=0,i=new e.Render2DContext(e.Render2DContext.RenderModeTransparent),n=this._renderableData,r=n._transparentSegments.length,o=0;r>o;o++){var s=n._transparentSegments[o],a=s.groupInsanceInfo,h=a.modelRenderCache;i.useInstancing=!1,i.partDataStartIndex=s.startDataIndex,i.partDataEndIndex=s.endDataIndex,i.groupInfoPartData=a.transparentData;var l=!h.render(a,i);t+=l?1:0}return t},n.prototype._prepareContext=function(t,i,n){var r,o,s=null;switch(i.renderMode){case e.Render2DContext.RenderModeOpaque:if(!n.hasOpaqueData)return null;r=function(e){n.opaqueDirty=e},o=function(){return n.opaqueDirty},i.groupInfoPartData=n.opaqueData,s=n.opaqueData;break;case e.Render2DContext.RenderModeAlphaTest:if(!n.hasAlphaTestData)return null;r=function(e){n.alphaTestDirty=e},o=function(){return n.alphaTestDirty},i.groupInfoPartData=n.alphaTestData,s=n.alphaTestData;break;default:throw new Error("_prepareContext is only for opaque or alphaTest")}var a=0;if(this.owner.supportInstancedArray){i.useInstancing=!0;for(var h=0;h<s.length;h++){var l=s[h],c=l._partData,u=c.pack();a+=c.usedElementCount;var d=c.usedElementCount*c.stride*4;!l._partBuffer||l._partBufferSize<d?(l._partBuffer&&t.deleteInstancesBuffer(l._partBuffer),l._partBuffer=t.createInstancesBuffer(d),l._partBufferSize=d,r(!1),t.updateArrayBuffer(u)):o()&&(t.bindArrayBuffer(l._partBuffer),t.updateArrayBuffer(u))}r(!1)}else{i.partDataStartIndex=0;for(var h=0;!i.groupInfoPartData[h];)h++;i.partDataEndIndex=i.groupInfoPartData[h]._partData.usedElementCount}return a},n.prototype._bindCacheTarget=function(){var t,i,n=this._renderableData;if(n._cacheNode){var r=n._cacheNode.contentSize,o=Math.ceil(this.actualSize.width),s=Math.ceil(this.actualSize.height);(r.width<o||r.height<s)&&(t=Math.floor(1.07*r.width),i=Math.floor(1.07*r.height),n._cacheTexture.freeRect(n._cacheNode),n._cacheNode=null)}if(!n._cacheNode){var a=this.owner._allocateGroupCache(this,this.renderGroup,t?new e.Size(t,i):null);n._cacheNode=a.node,n._cacheTexture=a.texture,n._cacheRenderSprite=a.sprite;var r=n._cacheNode.contentSize}var h=n._cacheNode;n._cacheTexture.bindTextureForPosSize(h.pos,this.actualSize,!0)},n.prototype._unbindCacheTarget=function(){this._renderableData._cacheTexture&&this._renderableData._cacheTexture.unbindTexture()},n.prototype.handleGroupChanged=function(t){var i=this._renderableData;this.isCachedGroup&&i._cacheRenderSprite&&(t.id===e.Prim2DBase.actualPositionProperty.id?i._cacheRenderSprite.actualPosition=this.actualPosition.clone():t.id===e.Prim2DBase.rotationProperty.id?i._cacheRenderSprite.rotation=this.rotation:t.id===e.Prim2DBase.scaleProperty.id?i._cacheRenderSprite.scale=this.scale:t.id===e.Prim2DBase.originProperty.id?i._cacheRenderSprite.origin=this.origin.clone():t.id===n.actualSizeProperty.id&&(i._cacheRenderSprite.size=this.actualSize.clone()))},n.prototype.detectGroupStates=function(){var t=this instanceof e.Canvas2D,r=this.owner.cachingStrategy;if(r===e.Canvas2D.CACHESTRATEGY_DONTCACHE)this._isRenderableGroup=t,this._isCachedGroup=!1;else if(r===e.Canvas2D.CACHESTRATEGY_CANVAS)t?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup="__cachedCanvasGroup__"===this.id,
this._isCachedGroup=!1);else if(r===e.Canvas2D.CACHESTRATEGY_TOPLEVELGROUPS)t?(this._isRenderableGroup=!0,this._isCachedGroup=!1):1===this.hierarchyDepth?(this._isRenderableGroup=!0,this._isCachedGroup=!0):(this._isRenderableGroup=!1,this._isCachedGroup=!1);else if(r===e.Canvas2D.CACHESTRATEGY_ALLGROUPS){var o=this.cacheBehavior;o!==n.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE&&o!==n.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP||(this._isRenderableGroup=o===n.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE,this._isCachedGroup=!1),o===n.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY&&(this._isRenderableGroup=!0,this._isCachedGroup=!0)}if(this._isRenderableGroup&&(this._renderableData||(this._renderableData=new i)),this._isCachedGroup)for(var s=this.parent;s;){if(s instanceof n&&s._isRenderableGroup){-1===s._renderableData._childrenRenderableGroups.indexOf(this)&&s._renderableData._childrenRenderableGroups.push(this);break}s=s.parent}},n.GROUP2D_PROPCOUNT=e.Prim2DBase.PRIM2DBASE_PROPCOUNT+5,n.GROUPCACHEBEHAVIOR_FOLLOWCACHESTRATEGY=0,n.GROUPCACHEBEHAVIOR_DONTCACHEOVERRIDE=1,n.GROUPCACHEBEHAVIOR_CACHEINPARENTGROUP=2,__decorate([e.instanceLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+1,function(e){return n.sizeProperty=e},!1,!0)],n.prototype,"size",null),__decorate([e.instanceLevelProperty(e.Prim2DBase.PRIM2DBASE_PROPCOUNT+2,function(e){return n.actualSizeProperty=e})],n.prototype,"actualSize",null),n=__decorate([e.className("Group2D")],n)}(e.Prim2DBase);e.Group2D=t;var i=function(){function t(){this._primDirtyList=new Array,this._childrenRenderableGroups=new Array,this._renderGroupInstancesInfo=new e.StringDictionary,this._transparentPrimitives=new Array,this._transparentSegments=new Array,this._firstChangedPrim=null,this._transparentListChanged=!1,this._cacheNode=null,this._cacheTexture=null,this._cacheRenderSprite=null}return t.prototype.dispose=function(){this._cacheRenderSprite&&(this._cacheRenderSprite.dispose(),this._cacheRenderSprite=null),this._cacheTexture&&this._cacheNode&&(this._cacheTexture.freeRect(this._cacheNode),this._cacheTexture=null,this._cacheNode=null),this._primDirtyList&&(this._primDirtyList.splice(0),this._primDirtyList=null),this._renderGroupInstancesInfo&&(this._renderGroupInstancesInfo.forEach(function(e,t){t.dispose()}),this._renderGroupInstancesInfo=null)},t.prototype.addNewTransparentPrimitiveInfo=function(e,t){var i=new n;return i._primitive=e,i._groupInstanceInfo=t,i._transparentSegment=null,this._transparentPrimitives.push(i),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(i),i},t.prototype.removeTransparentPrimitiveInfo=function(e){var t=this._transparentPrimitives.indexOf(e);-1!==t&&(this._transparentPrimitives.splice(t,1),this._transparentListChanged=!0,this.updateSmallestZChangedPrim(e))},t.prototype.transparentPrimitiveZChanged=function(e){this._transparentListChanged=!0,this.updateSmallestZChangedPrim(e)},t.prototype.updateSmallestZChangedPrim=function(e){if(e._primitive){var t=e._primitive.actualZOffset,i=this._firstChangedPrim?this._firstChangedPrim._primitive.actualZOffset:Number.MIN_VALUE;t>i&&(this._firstChangedPrim=e)}},t}();e.RenderableGroupData=i;var n=function(){function e(){}return e}();e.TransparentPrimitiveInfo=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i){t.call(this,e,i),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFill=null,this.effectFillInstanced=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorder=null,this.effectBorderInstanced=null}return __extends(i,t),i.prototype.render=function(t,i){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var n=t.owner.owner.engine,r=0;this.effectFill&&this.effectBorder&&(r=n.getDepthFunction(),n.setDepthFunctionToLessOrEqual());var o=n.getAlphaMode();if(this.effectFill){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_FILLPARTID.toString()),a=i.groupInfoPartData[s];i.renderMode!==e.Render2DContext.RenderModeOpaque&&n.setAlphaMode(e.Engine.ALPHA_COMBINE);var h=i.useInstancing?this.effectFillInstanced:this.effectFill;if(n.enableEffect(h),n.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,h),i.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_FILLPARTID,h)),n.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingFillAttributes),n.draw(!0,0,this.fillIndicesCount,a._partData.usedElementCount),n.unbindInstanceAttributes();else for(var l=i.partDataStartIndex;l<i.partDataEndIndex;l++)this.setupUniforms(h,s,a._partData,l),n.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_BORDERPARTID.toString()),a=i.groupInfoPartData[s];i.renderMode!==e.Render2DContext.RenderModeOpaque&&n.setAlphaMode(e.Engine.ALPHA_COMBINE);var h=i.useInstancing?this.effectBorderInstanced:this.effectBorder;if(n.enableEffect(h),n.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,h),i.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_BORDERPARTID,h)),n.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingBorderAttributes),n.draw(!0,0,this.borderIndicesCount,a._partData.usedElementCount),n.unbindInstanceAttributes();else for(var l=i.partDataStartIndex;l<i.partDataEndIndex;l++)this.setupUniforms(h,s,a._partData,l),n.draw(!0,0,this.borderIndicesCount)}return n.setAlphaMode(o),this.effectFill&&this.effectBorder&&n.setDepthFunction(r),!0},i.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0)},i}(e.ModelRenderCache);e.Rectangle2DRenderCache=t;var i=function(t){function i(e){t.call(this,e,1)}return __extends(i,t),Object.defineProperty(i.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],i.prototype,"properties",null),i}(e.Shape2DInstanceData);e.Rectangle2DInstanceData=i;var n=function(n){function r(t){if(null==t&&(t={}),n.call(this,t),null!=t.size)this.size=t.size;else if(t.width||t.height){var i=new e.Size(t.width,t.height);this.size=i}var r=null==t.roundRadius?0:t.roundRadius,o=null==t.borderThickness?1:t.borderThickness;this.roundRadius=r,this.borderThickness=o}return __extends(r,n),Object.defineProperty(r.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(e){this._actualSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"notRounded",{get:function(){return this._notRounded},set:function(e){this._notRounded=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"roundRadius",{get:function(){return this._roundRadius},set:function(e){this._roundRadius=e,this.notRounded=0===e,this._positioningDirty()},enumerable:!0,configurable:!0}),r.prototype.levelIntersect=function(e){if(this.notRounded)return!0;var t=this.size;r._i0.x=e._localPickPosition.x,r._i0.y=e._localPickPosition.y;var i=this.roundRadius,n=i*i;return r._i1.x=i,r._i1.y=i,r._i0.x<=r._i1.x&&r._i0.y<=r._i1.y?(r._i2.x=r._i0.x-r._i1.x,r._i2.y=r._i0.y-r._i1.y,r._i2.lengthSquared()<=n):(r._i1.x=i,r._i1.y=t.height-i,r._i0.x<=r._i1.x&&r._i0.y>=r._i1.y?(r._i2.x=r._i0.x-r._i1.x,r._i2.y=r._i0.y-r._i1.y,r._i2.lengthSquared()<=n):(r._i1.x=t.width-i,r._i1.y=t.height-i,r._i0.x>=r._i1.x&&r._i0.y>=r._i1.y?(r._i2.x=r._i0.x-r._i1.x,r._i2.y=r._i0.y-r._i1.y,r._i2.lengthSquared()<=n):(r._i1.x=t.width-i,r._i1.y=i,!(r._i0.x>=r._i1.x&&r._i0.y<=r._i1.y)||(r._i2.x=r._i0.x-r._i1.x,r._i2.y=r._i0.y-r._i1.y,r._i2.lengthSquared()<=n))))},r.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},r.prototype.createModelRenderCache=function(e){var i=new t(this.owner.engine,e);return i},r.prototype.setupModelRenderCache=function(t){var i=t,n=this.owner.engine;if(this.fill){for(var o=4*(this.notRounded?1:r.roundSubdivisions)+1,s=new Float32Array(o),a=0;o>a;a++)s[a]=a;i.fillVB=n.createVertexBuffer(s);for(var h=o-1,l=new Float32Array(3*h),a=0;h>a;a++)l[3*a+0]=0,l[3*a+2]=a+1,l[3*a+1]=a+2;l[3*h-2]=1,i.fillIB=n.createIndexBuffer(l),i.fillIndicesCount=3*h;var c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],!0);c&&(i.effectFillInstanced=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)),c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],!1),i.effectFill=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)}if(this.border){for(var o=4*(this.notRounded?1:r.roundSubdivisions)*2,s=new Float32Array(o),a=0;o>a;a++)s[a]=a;i.borderVB=n.createVertexBuffer(s);for(var h=o,u=h/2,l=new Float32Array(3*h),a=0;u>a;a++){var d=a,f=(a+1)%u;l[6*a+0]=u+f,l[6*a+1]=u+d,l[6*a+2]=d,l[6*a+3]=f,l[6*a+4]=u+f,l[6*a+5]=d}i.borderIB=n.createIndexBuffer(l),i.borderIndicesCount=3*h;var c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0);c&&(i.effectBorderInstanced=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)),c=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1),i.effectBorder=n.createEffect("rect2d",c.attributes,c.uniforms,[],c.defines,null)}return i},r.prototype._getInitialContentAreaToRef=function(e,t,i){if(this._notRounded)n.prototype._getInitialContentAreaToRef.call(this,e,t,i);else{var r=Math.round(1.3*(this.roundRadius-this.roundRadius/Math.sqrt(2)));t.x=t.y=r,i.width=Math.max(0,e.width-2*r),i.height=Math.max(0,e.height-2*r)}},r.prototype.createInstanceDataParts=function(){var t=new Array;return this.border&&t.push(new i(e.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&t.push(new i(e.Shape2D.SHAPE2D_FILLPARTID)),t},r.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===e.Shape2D.SHAPE2D_BORDERPARTID){var i=t,r=this.actualSize;i.properties=new e.Vector3(r.width,r.height,this.roundRadius||0)}else if(t.id===e.Shape2D.SHAPE2D_FILLPARTID){var i=t,r=this.actualSize;i.properties=new e.Vector3(r.width,r.height,this.roundRadius||0)}return!0},r._i0=e.Vector2.Zero(),r._i1=e.Vector2.Zero(),r._i2=e.Vector2.Zero(),r.roundSubdivisions=16,__decorate([e.instanceLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+1,function(e){return r.actualSizeProperty=e},!1,!0)],r.prototype,"actualSize",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+2,function(e){return r.notRoundedProperty=e})],r.prototype,"notRounded",null),__decorate([e.instanceLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+3,function(e){return r.roundRadiusProperty=e})],r.prototype,"roundRadius",null),r=__decorate([e.className("Rectangle2D")],r)}(e.Shape2D);e.Rectangle2D=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i){t.call(this,e,i),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFillInstanced=null,this.effectFill=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorderInstanced=null,this.effectBorder=null}return __extends(i,t),i.prototype.render=function(t,i){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var n=t.owner.owner.engine,r=0;this.effectFill&&this.effectBorder&&(r=n.getDepthFunction(),n.setDepthFunctionToLessOrEqual());var o=n.getAlphaMode();if(this.effectFill){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_FILLPARTID.toString()),a=i.groupInfoPartData[s];i.renderMode!==e.Render2DContext.RenderModeOpaque&&n.setAlphaMode(e.Engine.ALPHA_COMBINE);var h=i.useInstancing?this.effectFillInstanced:this.effectFill;if(n.enableEffect(h),n.bindBuffersDirectly(this.fillVB,this.fillIB,[1],4,h),i.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_FILLPARTID,h)),n.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingFillAttributes),n.draw(!0,0,this.fillIndicesCount,a._partData.usedElementCount),n.unbindInstanceAttributes();else for(var l=i.partDataStartIndex;l<i.partDataEndIndex;l++)this.setupUniforms(h,s,a._partData,l),n.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_BORDERPARTID.toString()),a=i.groupInfoPartData[s];i.renderMode!==e.Render2DContext.RenderModeOpaque&&n.setAlphaMode(e.Engine.ALPHA_COMBINE);var h=i.useInstancing?this.effectBorderInstanced:this.effectBorder;if(n.enableEffect(h),n.bindBuffersDirectly(this.borderVB,this.borderIB,[1],4,h),i.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_BORDERPARTID,h)),n.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingBorderAttributes),n.draw(!0,0,this.borderIndicesCount,a._partData.usedElementCount),n.unbindInstanceAttributes();else for(var l=i.partDataStartIndex;l<i.partDataEndIndex;l++)this.setupUniforms(h,s,a._partData,l),n.draw(!0,0,this.borderIndicesCount)}return n.setAlphaMode(o),this.effectFill&&this.effectBorder&&n.setDepthFunction(r),!0},i.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0)},i}(e.ModelRenderCache);e.Ellipse2DRenderCache=t;var i=function(t){function i(e){t.call(this,e,1)}return __extends(i,t),Object.defineProperty(i.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],i.prototype,"properties",null),i}(e.Shape2DInstanceData);e.Ellipse2DInstanceData=i;var n=function(n){function r(t){if(null==t&&(t={}),n.call(this,t),null!=t.size)this.size=t.size;else if(t.width||t.height){var i=new e.Size(t.width,t.height);this.size=i}var r=null==t.subdivisions?64:t.subdivisions;this.subdivisions=r}return __extends(r,n),Object.defineProperty(r.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(e){this._actualSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subdivisions",{get:function(){return this._subdivisions},set:function(e){this._subdivisions=e},enumerable:!0,configurable:!0}),r.prototype.levelIntersect=function(e){var t=this.size.width/2,i=this.size.height/2,n=e._localPickPosition.x-t,r=e._localPickPosition.y-i;return 1>=n*n/(t*t)+r*r/(i*i)},r.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},r.prototype.createModelRenderCache=function(e){var i=new t(this.owner.engine,e);return i},r.prototype.setupModelRenderCache=function(t){var i=t,n=this.owner.engine;if(this.fill){for(var r=this.subdivisions+1,o=new Float32Array(r),s=0;r>s;s++)o[s]=s;i.fillVB=n.createVertexBuffer(o);for(var a=r-1,h=new Float32Array(3*a),s=0;a>s;s++)h[3*s+0]=0,h[3*s+2]=s+1,h[3*s+1]=s+2;h[3*a-2]=1,i.fillIB=n.createIndexBuffer(h),i.fillIndicesCount=3*a;var l=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],!0);l&&(i.effectFillInstanced=n.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},l.attributes,l.uniforms,[],l.defines,null)),l=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["index"],!1),i.effectFill=n.createEffect({vertex:"ellipse2d",fragment:"ellipse2d"},l.attributes,l.uniforms,[],l.defines,null)}if(this.border){for(var r=2*this.subdivisions,o=new Float32Array(r),s=0;r>s;s++)o[s]=s;i.borderVB=n.createVertexBuffer(o);for(var a=r,c=a/2,h=new Float32Array(3*a),s=0;c>s;s++){var u=s,d=(s+1)%c;h[6*s+0]=c+d,h[6*s+1]=c+u,h[6*s+2]=u,h[6*s+3]=d,h[6*s+4]=c+d,h[6*s+5]=u}i.borderIB=n.createIndexBuffer(h),i.borderIndicesCount=3*a;var l=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],!0);l&&(i.effectBorderInstanced=n.createEffect("ellipse2d",l.attributes,l.uniforms,[],l.defines,null)),l=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["index"],!1),i.effectBorder=n.createEffect("ellipse2d",l.attributes,l.uniforms,[],l.defines,null)}return i},r.prototype.createInstanceDataParts=function(){var t=new Array;return this.border&&t.push(new i(e.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&t.push(new i(e.Shape2D.SHAPE2D_FILLPARTID)),t},r.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===e.Shape2D.SHAPE2D_BORDERPARTID){var i=t,r=this.actualSize;i.properties=new e.Vector3(r.width,r.height,this.subdivisions)}else if(t.id===e.Shape2D.SHAPE2D_FILLPARTID){var i=t,r=this.actualSize;i.properties=new e.Vector3(r.width,r.height,this.subdivisions)}return!0},__decorate([e.instanceLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+1,function(e){return r.acutalSizeProperty=e},!1,!0)],r.prototype,"actualSize",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+2,function(e){return r.subdivisionsProperty=e})],r.prototype,"subdivisions",null),r=__decorate([e.className("Ellipse2D")],r)}(e.Shape2D);e.Ellipse2D=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(){t.apply(this,arguments),this.effectsReady=!1,this.vb=null,this.ib=null,this.instancingAttributes=null,this.texture=null,this.effect=null,this.effectInstanced=null}return __extends(i,t),i.prototype.render=function(t,i){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var r=t.owner.owner.engine,o=i.useInstancing?this.effectInstanced:this.effect;r.enableEffect(o),o.setTexture("diffuseSampler",this.texture),r.bindBuffersDirectly(this.vb,this.ib,[1],4,o);var s=r.getAlphaMode();i.renderMode!==e.Render2DContext.RenderModeOpaque&&r.setAlphaMode(e.Engine.ALPHA_COMBINE);var a=i.groupInfoPartData[0];if(i.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(n.SPRITE2D_MAINPARTID,o)),r.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingAttributes),r.draw(!0,0,6,a._partData.usedElementCount),r.unbindInstanceAttributes();else for(var h=i.partDataStartIndex;h<i.partDataEndIndex;h++)this.setupUniforms(o,0,a._partData,h),r.draw(!0,0,6);return r.setAlphaMode(s),!0},i.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.texture&&(this.texture.dispose(),this.texture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=null),!0)},i}(e.ModelRenderCache);e.Sprite2DRenderCache=t;var i=function(t){function i(e){t.call(this,e,1)}return __extends(i,t),Object.defineProperty(i.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"properties",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],i.prototype,"topLeftUV",null),__decorate([e.instanceData()],i.prototype,"sizeUV",null),__decorate([e.instanceData()],i.prototype,"textureSize",null),__decorate([e.instanceData()],i.prototype,"properties",null),i}(e.InstanceDataBase);e.Sprite2DInstanceData=i;var n=function(n){function r(t,i){if(i||(i={}),n.call(this,i),this.texture=t,this.texture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.texture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.size=i.spriteSize||null,this.spriteLocation=i.spriteLocation||new e.Vector2(0,0),this.spriteFrame=0,this.invertY=null!=i.invertY&&i.invertY,this.alignToPixel=null==i.alignToPixel||i.alignToPixel,this._isTransparent=!0,!this.size){var r=t.getSize();this.size=new e.Size(r.width,r.height)}}return __extends(r,n),Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},set:function(e){this._actualSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"spriteLocation",{get:function(){return this._location},set:function(e){this._location=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"spriteFrame",{get:function(){return this._spriteFrame},set:function(e){this._spriteFrame=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"invertY",{get:function(){return this._invertY},set:function(e){this._invertY=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"alignToPixel",{get:function(){return this._alignToPixel},set:function(e){this._alignToPixel=e},enumerable:!0,configurable:!0}),r.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.size,this._levelBoundingInfo)},r.prototype.getAnimatables=function(){var e=new Array;return this.texture&&this.texture.animations&&this.texture.animations.length>0&&e.push(this.texture),e},r.prototype.levelIntersect=function(e){return!0},r._createCachedCanvasSprite=function(t,i,n,o){var s=new r(i,{parent:t,id:"__cachedCanvasSprite__",position:e.Vector2.Zero(),origin:e.Vector2.Zero(),spriteSize:n,spriteLocation:o,alignToPixel:!0});return s},r.prototype.createModelRenderCache=function(e){var i=new t(this.owner.engine,e);return i},r.prototype.setupModelRenderCache=function(e){for(var t=e,i=this.owner.engine,n=new Float32Array(4),o=0;4>o;o++)n[o]=o;t.vb=i.createVertexBuffer(n);var s=new Float32Array(6);s[0]=0,s[1]=2,s[2]=1,s[3]=0,s[4]=3,s[5]=2,t.ib=i.createIndexBuffer(s),t.texture=this.texture;var a=this.getDataPartEffectInfo(r.SPRITE2D_MAINPARTID,["index"],!0);return a&&(t.effectInstanced=i.createEffect("sprite2d",a.attributes,a.uniforms,["diffuseSampler"],a.defines,null)),a=this.getDataPartEffectInfo(r.SPRITE2D_MAINPARTID,["index"],!1),t.effect=i.createEffect("sprite2d",a.attributes,a.uniforms,["diffuseSampler"],a.defines,null),t},r.prototype.createInstanceDataParts=function(){return[new i(r.SPRITE2D_MAINPARTID)]},r.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===r.SPRITE2D_MAINPARTID){var i=this._instanceDataParts[0],o=this.texture.getBaseSize(),s=this.spriteLocation,a=this.actualSize;i.topLeftUV=new e.Vector2(s.x/o.width,s.y/o.height);var h=new e.Vector2(a.width/o.width,a.height/o.height);i.sizeUV=h,r._prop.x=this.spriteFrame,r._prop.y=this.invertY?1:0,r._prop.z=this.alignToPixel?1:0,i.properties=r._prop,i.textureSize=new e.Vector2(o.width,o.height)}return!0},r.SPRITE2D_MAINPARTID=1,r._prop=e.Vector3.Zero(),__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(e){return r.textureProperty=e})],r.prototype,"texture",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(e){return r.actualSizeProperty=e},!1,!0)],r.prototype,"actualSize",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(e){return r.spriteLocationProperty=e})],r.prototype,"spriteLocation",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(e){return r.spriteFrameProperty=e})],r.prototype,"spriteFrame",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+5,function(e){return r.invertYProperty=e})],r.prototype,"invertY",null),r=__decorate([e.className("Sprite2D")],r)}(e.RenderablePrim2D);e.Sprite2D=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(){t.apply(this,arguments),this.effectsReady=!1,this.vb=null,this.ib=null,this.instancingAttributes=null,this.fontTexture=null,this.effect=null,this.effectInstanced=null}return __extends(i,t),i.prototype.render=function(t,i){if(!this.effectsReady){if(this.effect&&(!this.effect.isReady()||this.effectInstanced&&!this.effectInstanced.isReady()))return!1;this.effectsReady=!0}var r=t.owner.owner.engine;this.fontTexture.update();var o=i.useInstancing?this.effectInstanced:this.effect;r.enableEffect(o),o.setTexture("diffuseSampler",this.fontTexture),r.bindBuffersDirectly(this.vb,this.ib,[1],4,o);var s=r.getAlphaMode();r.setAlphaMode(e.Engine.ALPHA_COMBINE,!0);var a=i.groupInfoPartData[0];if(i.useInstancing)this.instancingAttributes||(this.instancingAttributes=this.loadInstancingAttributes(n.TEXT2D_MAINPARTID,o)),r.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingAttributes),r.draw(!0,0,6,a._partData.usedElementCount),r.unbindInstanceAttributes();else for(var h=i.partDataStartIndex;h<i.partDataEndIndex;h++)this.setupUniforms(o,0,a._partData,h),r.draw(!0,0,6);return r.setAlphaMode(s),!0},i.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.vb&&(this._engine._releaseBuffer(this.vb),this.vb=null),this.ib&&(this._engine._releaseBuffer(this.ib),this.ib=null),this.fontTexture&&(this.fontTexture.dispose(),this.fontTexture=null),this.effect&&(this._engine._releaseEffect(this.effect),this.effect=null),this.effectInstanced&&(this._engine._releaseEffect(this.effectInstanced),this.effectInstanced=null),!0)},i}(e.ModelRenderCache);e.Text2DRenderCache=t;var i=function(t){function i(e,i){t.call(this,e,i)}return __extends(i,t),Object.defineProperty(i.prototype,"topLeftUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sizeUV",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureSize",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"color",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([e.instanceData()],i.prototype,"topLeftUV",null),__decorate([e.instanceData()],i.prototype,"sizeUV",null),__decorate([e.instanceData()],i.prototype,"textureSize",null),__decorate([e.instanceData()],i.prototype,"color",null),i}(e.InstanceDataBase);e.Text2DInstanceData=i;var n=function(n){function r(t,i){i||(i={}),n.call(this,i),this.fontName=null==i.fontName?"12pt Arial":i.fontName,this.defaultFontColor=null==i.defaultFontColor?new e.Color4(1,1,1,1):i.defaultFontColor,this._tabulationSize=null==i.tabulationSize?4:i.tabulationSize,this._textSize=null,this.text=t,this.size=null==i.size?null:i.size,this.isAlphaTest=!0}return __extends(r,n),Object.defineProperty(r.prototype,"fontName",{get:function(){return this._fontName},set:function(e){if(this._fontName)throw new Error("Font Name change is not supported right now.");this._fontName=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defaultFontColor",{get:function(){return this._defaultFontColor},set:function(e){this._defaultFontColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"text",{get:function(){return this._text},set:function(e){this._text=e,this._textSize=null,this._size=null,this._updateCharCount(),this.textSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return null!=this._size?this._size:this.textSize},set:function(e){this._size=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"actualSize",{get:function(){return this._actualSize?this._actualSize:this.size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textSize",{get:function(){if(!this._textSize){if(!this.owner)return r.nullSize;var t=this.fontTexture.measureText(this._text,this._tabulationSize);t.equals(this._textSize)||(this.onPrimitivePropertyDirty(e.Prim2DBase.sizeProperty.flagId),this._positioningDirty()),this._textSize=t}return this._textSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fontTexture",{get:function(){return this._fontTexture?this._fontTexture:(this._fontTexture=e.FontTexture.GetCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture)},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){return!!n.prototype.dispose.call(this)&&(this._fontTexture&&(e.FontTexture.ReleaseCachedFontTexture(this.owner.scene,this.fontName),this._fontTexture=null),!0)},r.prototype.updateLevelBoundingInfo=function(){e.BoundingInfo2D.CreateFromSizeToRef(this.actualSize,this._levelBoundingInfo)},r.prototype.levelIntersect=function(e){return!0},r.prototype.createModelRenderCache=function(e){var i=new t(this.owner.engine,e);return i},r.prototype.setupModelRenderCache=function(e){var t=e,i=this.owner.engine;t.fontTexture=this.fontTexture;for(var n=new Float32Array(4),o=0;4>o;o++)n[o]=o;t.vb=i.createVertexBuffer(n);var s=new Float32Array(6);s[0]=0,s[1]=2,s[2]=1,s[3]=0,s[4]=3,s[5]=2,t.ib=i.createIndexBuffer(s);var a=this.getDataPartEffectInfo(r.TEXT2D_MAINPARTID,["index"],!0);return a&&(t.effectInstanced=i.createEffect("text2d",a.attributes,a.uniforms,["diffuseSampler"],a.defines,null)),a=this.getDataPartEffectInfo(r.TEXT2D_MAINPARTID,["index"],!1),t.effect=i.createEffect("text2d",a.attributes,a.uniforms,["diffuseSampler"],a.defines,null),t},r.prototype.createInstanceDataParts=function(){return[new i(r.TEXT2D_MAINPARTID,this._charCount)]},r.prototype.beforeRefreshForLayoutConstruction=function(e){if(!this._charCount){var t=this._text;return this.text="A",t}},r.prototype.afterRefreshForLayoutConstruction=function(e,t){void 0!==t&&(this.text=t)},r.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===r.TEXT2D_MAINPARTID){var i=t,o=this.fontTexture,s=o.getSize(),a=e.Vector2.Zero(),h=this.fontTexture.lineHeight;a.y=(this.textSize.height/h-1)*h;var l=0;i.dataElementCount=this._charCount,i.curElement=0;for(var c=0,u=this.text;c<u.length;c++){var d=u[c];if("\n"===d&&(a.x=0,a.y-=o.lineHeight),"\t"!==d){if(!(" ">d)){this.updateInstanceDataPart(i,a);var f=o.getChar(d);a.x+=f.charWidth,i.topLeftUV=f.topLeftUV;var p=f.bottomRightUV.subtract(f.topLeftUV);i.sizeUV=p,i.textureSize=new e.Vector2(s.width,s.height),i.color=this.defaultFontColor,++i.curElement}}else{var _=l+this._tabulationSize;_-=_%this._tabulationSize,a.x+=(_-l)*o.spaceWidth,l=_}}}return!0},r.prototype._updateCharCount=function(){for(var e=0,t=0,i=this._text;t<i.length;t++){var n=i[t];"\r"===n||"\n"===n||"\t"===n||" ">n||++e;
}this._charCount=e},r.TEXT2D_MAINPARTID=1,__decorate([e.modelLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+1,function(e){return r.fontProperty=e},!1,!0)],r.prototype,"fontName",null),__decorate([e.dynamicLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+2,function(e){return r.defaultFontColorProperty=e})],r.prototype,"defaultFontColor",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+3,function(e){return r.textProperty=e},!1,!0)],r.prototype,"text",null),__decorate([e.instanceLevelProperty(e.RenderablePrim2D.RENDERABLEPRIM2D_PROPCOUNT+4,function(e){return r.sizeProperty=e})],r.prototype,"size",null),r=__decorate([e.className("Text2D")],r)}(e.RenderablePrim2D);e.Text2D=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(e,i){t.call(this,e,i),this.effectsReady=!1,this.fillVB=null,this.fillIB=null,this.fillIndicesCount=0,this.instancingFillAttributes=null,this.effectFill=null,this.effectFillInstanced=null,this.borderVB=null,this.borderIB=null,this.borderIndicesCount=0,this.instancingBorderAttributes=null,this.effectBorder=null,this.effectBorderInstanced=null}return __extends(i,t),i.prototype.render=function(t,i){if(!this.effectsReady){if(this.effectFill&&(!this.effectFill.isReady()||this.effectFillInstanced&&!this.effectFillInstanced.isReady())||this.effectBorder&&(!this.effectBorder.isReady()||this.effectBorderInstanced&&!this.effectBorderInstanced.isReady()))return!1;this.effectsReady=!0}var n=t.owner.owner.engine,r=0;this.effectFill&&this.effectBorder&&(r=n.getDepthFunction(),n.setDepthFunctionToLessOrEqual());var o=n.getAlphaMode();if(this.effectFill){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_FILLPARTID.toString()),a=i.groupInfoPartData[s];i.renderMode!==e.Render2DContext.RenderModeOpaque&&n.setAlphaMode(e.Engine.ALPHA_COMBINE);var h=i.useInstancing?this.effectFillInstanced:this.effectFill;if(n.enableEffect(h),n.bindBuffersDirectly(this.fillVB,this.fillIB,[2],8,h),i.useInstancing)this.instancingFillAttributes||(this.instancingFillAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_FILLPARTID,h)),n.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingFillAttributes),n.draw(!0,0,this.fillIndicesCount,a._partData.usedElementCount),n.unbindInstanceAttributes();else for(var l=i.partDataStartIndex;l<i.partDataEndIndex;l++)this.setupUniforms(h,s,a._partData,l),n.draw(!0,0,this.fillIndicesCount)}if(this.effectBorder){var s=t.partIndexFromId.get(e.Shape2D.SHAPE2D_BORDERPARTID.toString()),a=i.groupInfoPartData[s];i.renderMode!==e.Render2DContext.RenderModeOpaque&&n.setAlphaMode(e.Engine.ALPHA_COMBINE);var h=i.useInstancing?this.effectBorderInstanced:this.effectBorder;if(n.enableEffect(h),n.bindBuffersDirectly(this.borderVB,this.borderIB,[2],8,h),i.useInstancing)this.instancingBorderAttributes||(this.instancingBorderAttributes=this.loadInstancingAttributes(e.Shape2D.SHAPE2D_BORDERPARTID,h)),n.updateAndBindInstancesBuffer(a._partBuffer,null,this.instancingBorderAttributes),n.draw(!0,0,this.borderIndicesCount,a._partData.usedElementCount),n.unbindInstanceAttributes();else for(var l=i.partDataStartIndex;l<i.partDataEndIndex;l++)this.setupUniforms(h,s,a._partData,l),n.draw(!0,0,this.borderIndicesCount)}return n.setAlphaMode(o),this.effectFill&&this.effectBorder&&n.setDepthFunction(r),!0},i.prototype.dispose=function(){return!!t.prototype.dispose.call(this)&&(this.fillVB&&(this._engine._releaseBuffer(this.fillVB),this.fillVB=null),this.fillIB&&(this._engine._releaseBuffer(this.fillIB),this.fillIB=null),this.effectFill&&(this._engine._releaseEffect(this.effectFill),this.effectFill=null),this.effectFillInstanced&&(this._engine._releaseEffect(this.effectFillInstanced),this.effectFillInstanced=null),this.borderVB&&(this._engine._releaseBuffer(this.borderVB),this.borderVB=null),this.borderIB&&(this._engine._releaseBuffer(this.borderIB),this.borderIB=null),this.effectBorder&&(this._engine._releaseEffect(this.effectBorder),this.effectBorder=null),this.effectBorderInstanced&&(this._engine._releaseEffect(this.effectBorderInstanced),this.effectBorderInstanced=null),!0)},i}(e.ModelRenderCache);e.Lines2DRenderCache=t;var i=function(t){function i(e){t.call(this,e,1)}return __extends(i,t),Object.defineProperty(i.prototype,"boundingMin",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingMax",{get:function(){return null},enumerable:!0,configurable:!0}),__decorate([e.instanceData(e.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],i.prototype,"boundingMin",null),__decorate([e.instanceData(e.Shape2D.SHAPE2D_CATEGORY_FILLGRADIENT)],i.prototype,"boundingMax",null),i}(e.Shape2DInstanceData);e.Lines2DInstanceData=i;var n=function(n){function r(t,i){i||(i={}),n.call(this,i),this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,this._size=e.Size.Zero(),this._boundingMin=null,this._boundingMax=null;var r=null==i.fillThickness?1:i.fillThickness,o=null==i.startCap?0:i.startCap,s=null==i.endCap?0:i.endCap,a=null!=i.closed&&i.closed;this.points=t,this.fillThickness=r,this.startCap=o,this.endCap=s,this.closed=a}return __extends(r,n),Object.defineProperty(r,"NoCap",{get:function(){return r._noCap},enumerable:!0,configurable:!0}),Object.defineProperty(r,"RoundCap",{get:function(){return r._roundCap},enumerable:!0,configurable:!0}),Object.defineProperty(r,"TriangleCap",{get:function(){return r._triangleCap},enumerable:!0,configurable:!0}),Object.defineProperty(r,"SquareAnchorCap",{get:function(){return r._squareAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(r,"RoundAnchorCap",{get:function(){return r._roundAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(r,"DiamondAnchorCap",{get:function(){return r._diamondAnchorCap},enumerable:!0,configurable:!0}),Object.defineProperty(r,"ArrowCap",{get:function(){return r._arrowCap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"points",{get:function(){return this._points},set:function(e){this._points=e,this._boundingBoxDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fillThickness",{get:function(){return this._fillThickness},set:function(e){this._fillThickness=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this._closed},set:function(e){this._closed=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"startCap",{get:function(){return this._startCap},set:function(e){this._startCap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"endCap",{get:function(){return this._endCap},set:function(e){this._endCap=e},enumerable:!0,configurable:!0}),r.prototype.levelIntersect=function(t){var i=this;null==this._contour&&this._computeLines2D();var n=this.points.length,o=this.closed?n+1:n,s=t._localPickPosition;this.transformPointWithOriginToRef(this._contour[0],null,r._prevA),this.transformPointWithOriginToRef(this._contour[1],null,r._prevB);for(var a=1;o>a;a++){if(this.transformPointWithOriginToRef(this._contour[a%n*2+0],null,r._curA),this.transformPointWithOriginToRef(this._contour[a%n*2+1],null,r._curB),e.Vector2.PointInTriangle(s,r._prevA,r._prevB,r._curA))return!0;if(e.Vector2.PointInTriangle(s,r._curA,r._prevB,r._curB))return!0;r._prevA.x=r._curA.x,r._prevA.y=r._curA.y,r._prevB.x=r._curB.x,r._prevB.y=r._curB.y}var h=function(t,n){for(var o=t.length,a=0;o>a;a+=3)if(r._curA.x=n[2*t[a+0]+0],r._curA.y=n[2*t[a+0]+1],i.transformPointWithOriginToRef(r._curA,null,r._curB),r._curA.x=n[2*t[a+1]+0],r._curA.y=n[2*t[a+1]+1],i.transformPointWithOriginToRef(r._curA,null,r._prevA),r._curA.x=n[2*t[a+2]+0],r._curA.y=n[2*t[a+2]+1],i.transformPointWithOriginToRef(r._curA,null,r._prevB),e.Vector2.PointInTriangle(s,r._prevA,r._prevB,r._curB))return!0;return!1};if(this._startCapTriIndices){if(h(this._startCapTriIndices,this._startCapContour))return!0;if(h(this._endCapTriIndices,this._endCapContour))return!0}return!1},Object.defineProperty(r.prototype,"boundingMin",{get:function(){return this._boundingMin||this._computeLines2D(),this._boundingMin},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"boundingMax",{get:function(){return this._boundingMax||this._computeLines2D(),this._boundingMax},enumerable:!0,configurable:!0}),r.prototype.getUsedShaderCategories=function(t){var i=n.prototype.getUsedShaderCategories.call(this,t),r=i.indexOf(e.Shape2D.SHAPE2D_CATEGORY_BORDER);return-1!==r&&i.splice(r,1),i},r.prototype.updateLevelBoundingInfo=function(){this._boundingMin||this._computeLines2D(),e.BoundingInfo2D.CreateFromMinMaxToRef(this._boundingMin.x,this._boundingMax.x,this._boundingMin.y,this._boundingMax.y,this._levelBoundingInfo)},r.prototype.createModelRenderCache=function(e){var i=new t(this.owner.engine,e);return i},r.prototype._perp=function(e,t){t.x=e.y,t.y=-e.x},r.prototype._direction=function(e,t,i){e.subtractToRef(t,i),i.normalize()},r.prototype._computeMiter=function(t,i,n,o){return n.addToRef(o,t),t.normalize(),i.x=-t.y,i.y=t.x,r._miterTps.x=-n.y,r._miterTps.y=n.x,1/e.Vector2.Dot(i,r._miterTps)},r.prototype._intersect=function(e,t,i,n,r,o,s,a){var h=(e-i)*(o-a)-(t-n)*(r-s);if(0===h)return!1;var l=((r-s)*(e*n-t*i)-(e-i)*(r*a-o*s))/h;return!(l<Math.min(e,i)||l>Math.max(e,i))&&!(l<Math.min(r,s)||l>Math.max(r,s))},r.prototype._updateMinMax=function(e,t){t>=e.length||(this._boundingMin.x=Math.min(this._boundingMin.x,e[t]),this._boundingMax.x=Math.max(this._boundingMax.x,e[t]),this._boundingMin.y=Math.min(this._boundingMin.y,e[t+1]),this._boundingMax.y=Math.max(this._boundingMax.y,e[t+1]))},r.prototype._store=function(t,i,n,o,s,a,h,l,c){var u=null!=l&&!isNaN(l),d=n*(u?8:4);if(!(d>=t.length)){0===n?this._perp(a,r._startDir):n===o-1&&(this._perp(a,r._endDir),r._endDir.x*=-1,r._endDir.y*=-1);var f=!1;if(t[d+0]=s.x+a.x*h,t[d+1]=s.y+a.y*h,t[d+2]=s.x+a.x*-h,t[d+3]=s.y+a.y*-h,this._updateMinMax(t,d),this._updateMinMax(t,d+2),void 0!==c){var p=c*(u?8:4);if(this._intersect(t[d+0],t[d+1],t[p+0],t[p+1],t[d+2],t[d+3],t[p+2],t[p+3])){f=!0;var _=t[d+0];t[d+0]=t[d+2],t[d+2]=_,_=t[d+1],t[d+1]=t[d+3],t[d+3]=_}}if(u){var m=h+l;t[d+4]=s.x+a.x*(f?-m:m),t[d+5]=s.y+a.y*(f?-m:m),t[d+6]=s.x+a.x*(f?m:-m),t[d+7]=s.y+a.y*(f?m:-m),this._updateMinMax(t,d+4),this._updateMinMax(t,d+6)}i&&(d+=u?4:0,i.push(new e.Vector2(t[d+0],t[d+1])),i.push(new e.Vector2(t[d+2],t[d+3])))}},r.prototype._getCapSize=function(e,t){void 0===t&&(t=!1);var i=r._roundCapSubDiv,n=0,o=0;switch(e){case r.NoCap:!this.closed&&t?(n=4,o=6):n=o=0;break;case r.RoundCap:t?(n=i,o=3*(i-2)):(n=i/2+1,o=i/2*3);break;case r.ArrowCap:t?(n=12,o=24):(n=3,o=3);break;case r.TriangleCap:t?(n=6,o=12):(n=3,o=3);break;case r.DiamondAnchorCap:t?(n=10,o=24):(n=5,o=9);break;case r.SquareAnchorCap:t?(n=12,o=30):(n=4,o=6);break;case r.RoundAnchorCap:t?(n=2*i,o=6*(i-1)):(n=i+1,o=3*(i+1))}return{vbsize:2*n,ibsize:o}},r.prototype._storeVertex=function(e,t,i,n,o,s,a){var h=Math.cos(o),l=Math.sin(o);r._tpsV.x=h*s.x+-l*s.y+n.x,r._tpsV.y=l*s.x+h*s.y+n.y;var c=t+2*i;return e[c+0]=r._tpsV.x,e[c+1]=r._tpsV.y,a&&(a.push(r._tpsV.x),a.push(r._tpsV.y)),this._updateMinMax(e,c),(t+2*i)/2},r.prototype._storeIndex=function(e,t,i,n){e[t+i]=n},r.prototype._buildCap=function(t,i,n,o,s,a,h,l,c,u){var d=r._roundCapSubDiv,f=new e.Vector2(1,0),p=Math.atan2(c.y,c.x)-Math.atan2(f.y,f.x),_=a/2,m=a,g=null!=h,v=h;switch(l){case r.NoCap:if(g&&!this.closed){var y=0,b=0,x=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,_+v),u),P=this._storeVertex(t,i,y++,s,p,new e.Vector2(v,_+v),u),A=this._storeVertex(t,i,y++,s,p,new e.Vector2(v,-(_+v)),u),C=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,-(_+v)),u);this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,C)}break;case r.ArrowCap:_*=2;case r.TriangleCap:if(g){var E=l===r.TriangleCap?v:Math.sqrt(v*v*2),x=this._storeVertex(t,i,0,s,p,new e.Vector2(0,_),null),P=this._storeVertex(t,i,1,s,p,new e.Vector2(_,0),null),A=this._storeVertex(t,i,2,s,p,new e.Vector2(0,-_),null),C=this._storeVertex(t,i,3,s,p,new e.Vector2(0,_+E),u),T=this._storeVertex(t,i,4,s,p,new e.Vector2(_+E,0),u),S=this._storeVertex(t,i,5,s,p,new e.Vector2(0,-(_+E)),u),b=0;if(this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,C),this._storeIndex(n,o,b++,T),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,T),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,S),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,S),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,T),l===r.ArrowCap){var M=a/2,I=this._storeVertex(t,i,9,s,p,new e.Vector2(0,-(M+v)),null),w=this._storeVertex(t,i,11,s,p,new e.Vector2(-v,-(_+E)),u),R=this._storeVertex(t,i,10,s,p,new e.Vector2(-v,-(M+v)),u),D=this._storeVertex(t,i,6,s,p,new e.Vector2(0,M+v),null),O=this._storeVertex(t,i,7,s,p,new e.Vector2(-v,M+v),u),L=this._storeVertex(t,i,8,s,p,new e.Vector2(-v,_+E),u);this._storeIndex(n,o,b++,D),this._storeIndex(n,o,b++,O),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,D),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,C),this._storeIndex(n,o,b++,I),this._storeIndex(n,o,b++,w),this._storeIndex(n,o,b++,R),this._storeIndex(n,o,b++,I),this._storeIndex(n,o,b++,S),this._storeIndex(n,o,b++,w)}}else{var x=this._storeVertex(t,i,0,s,p,new e.Vector2(0,_),u),P=this._storeVertex(t,i,1,s,p,new e.Vector2(_,0),u),A=this._storeVertex(t,i,2,s,p,new e.Vector2(0,-_),u);this._storeIndex(n,o,0,x),this._storeIndex(n,o,1,P),this._storeIndex(n,o,2,A)}break;case r.RoundCap:if(g)for(var B=-Math.PI/2,N=Math.PI/(d/2-1),b=0,F=0;d/2>F;F++){var x=this._storeVertex(t,i,2*F+0,s,p,new e.Vector2(Math.cos(B)*_,Math.sin(B)*_),null),P=this._storeVertex(t,i,2*F+1,s,p,new e.Vector2(Math.cos(B)*(_+v),Math.sin(B)*(_+v)),u);F>0&&(this._storeIndex(n,o,b++,x-2),this._storeIndex(n,o,b++,P-2),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,x-2),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,x)),B+=N}else{var V=this._storeVertex(t,i,0,s,p,new e.Vector2(0,0),null),B=-Math.PI/2,N=Math.PI/(d/2-1);this._storeVertex(t,i,1,s,p,new e.Vector2(Math.cos(B)*_,Math.sin(B)*_),null),B+=N;for(var F=1;d/2>F;F++){var P=this._storeVertex(t,i,F+1,s,p,new e.Vector2(Math.cos(B)*_,Math.sin(B)*_),u);this._storeIndex(n,o,3*F+0,V),this._storeIndex(n,o,3*F+1,P-1),this._storeIndex(n,o,3*F+2,P),B+=N}}break;case r.SquareAnchorCap:var y=0,V=g?null:u,x=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,m),V),P=this._storeVertex(t,i,y++,s,p,new e.Vector2(2*m,m),V),A=this._storeVertex(t,i,y++,s,p,new e.Vector2(2*m,-m),V),C=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,-m),V);if(g){var T=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,_+v),null),S=this._storeVertex(t,i,y++,s,p,new e.Vector2(-v,_+v),u),D=this._storeVertex(t,i,y++,s,p,new e.Vector2(-v,m+v),u),O=this._storeVertex(t,i,y++,s,p,new e.Vector2(2*m+v,m+v),u),L=this._storeVertex(t,i,y++,s,p,new e.Vector2(2*m+v,-(m+v)),u),I=this._storeVertex(t,i,y++,s,p,new e.Vector2(-v,-(m+v)),u),R=this._storeVertex(t,i,y++,s,p,new e.Vector2(-v,-(_+v)),u),w=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,-(_+v)),null),b=0;this._storeIndex(n,o,b++,S),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,T),this._storeIndex(n,o,b++,S),this._storeIndex(n,o,b++,D),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,D),this._storeIndex(n,o,b++,O),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,O),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,O),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,I),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,I),this._storeIndex(n,o,b++,C),this._storeIndex(n,o,b++,I),this._storeIndex(n,o,b++,R),this._storeIndex(n,o,b++,C),this._storeIndex(n,o,b++,R),this._storeIndex(n,o,b++,w),this._storeIndex(n,o,b++,C)}else this._storeIndex(n,o,0,x),this._storeIndex(n,o,1,P),this._storeIndex(n,o,2,A),this._storeIndex(n,o,3,x),this._storeIndex(n,o,4,A),this._storeIndex(n,o,5,C);break;case r.RoundAnchorCap:var k=Math.sqrt(m*m-_*_),z=new e.Vector2(k,0),B=e.Tools.ToRadians(-150),N=e.Tools.ToRadians(300)/(d-1);if(g)for(var b=0,F=0;d>F;F++){var x=this._storeVertex(t,i,2*F+0,s,p,new e.Vector2(k+Math.cos(B)*m,Math.sin(B)*m),null),P=this._storeVertex(t,i,2*F+1,s,p,new e.Vector2(k+Math.cos(B)*(m+v),Math.sin(B)*(m+v)),u);F>0&&(this._storeIndex(n,o,b++,x-2),this._storeIndex(n,o,b++,P-2),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,x-2),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,x)),B+=N}else{var V=this._storeVertex(t,i,0,s,p,z,null);this._storeVertex(t,i,1,s,p,new e.Vector2(k+Math.cos(B)*m,Math.sin(B)*m),null),B+=N;for(var F=1;d>F;F++){var P=this._storeVertex(t,i,F+1,s,p,new e.Vector2(k+Math.cos(B)*m,Math.sin(B)*m),u);this._storeIndex(n,o,3*F+0,V),this._storeIndex(n,o,3*F+1,P-1),this._storeIndex(n,o,3*F+2,P),B+=N}this._storeIndex(n,o,3*d+0,V),this._storeIndex(n,o,3*d+1,V+1),this._storeIndex(n,o,3*d+2,V+d)}break;case r.DiamondAnchorCap:var y=0,V=g?null:u,x=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,_),V),P=this._storeVertex(t,i,y++,s,p,new e.Vector2(_,m),V),A=this._storeVertex(t,i,y++,s,p,new e.Vector2(3*_,0),V),C=this._storeVertex(t,i,y++,s,p,new e.Vector2(_,-m),V),T=this._storeVertex(t,i,y++,s,p,new e.Vector2(0,-_),V);if(g){var E=Math.sqrt(v*v*2),S=this._storeVertex(t,i,y++,s,p,new e.Vector2(-E,_),u),D=this._storeVertex(t,i,y++,s,p,new e.Vector2(_,m+E),u),O=this._storeVertex(t,i,y++,s,p,new e.Vector2(3*_+E,0),u),L=this._storeVertex(t,i,y++,s,p,new e.Vector2(_,-(m+E)),u),I=this._storeVertex(t,i,y++,s,p,new e.Vector2(-E,-_),u),b=0;this._storeIndex(n,o,b++,S),this._storeIndex(n,o,b++,D),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,x),this._storeIndex(n,o,b++,D),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,D),this._storeIndex(n,o,b++,O),this._storeIndex(n,o,b++,P),this._storeIndex(n,o,b++,O),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,O),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,A),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,C),this._storeIndex(n,o,b++,C),this._storeIndex(n,o,b++,L),this._storeIndex(n,o,b++,I),this._storeIndex(n,o,b++,C),this._storeIndex(n,o,b++,I),this._storeIndex(n,o,b++,T)}else this._storeIndex(n,o,0,x),this._storeIndex(n,o,1,P),this._storeIndex(n,o,2,A),this._storeIndex(n,o,3,x),this._storeIndex(n,o,4,A),this._storeIndex(n,o,5,T),this._storeIndex(n,o,6,T),this._storeIndex(n,o,7,A),this._storeIndex(n,o,8,C)}return null},r.prototype._buildLine=function(t,i,n,r){var o=e.Vector2.Zero(),s=e.Vector2.Zero(),a=e.Vector2.Zero(),h=e.Vector2.Zero(),l=null;this.closed&&this.points.push(this.points[0]);for(var c=this.points.length,u=1;c>u;u++){var d=this.points[u-1],f=this.points[u],p=u<this.points.length-1?this.points[u+1]:null;if(this._direction(f,d,o),l||(l=e.Vector2.Zero(),this._perp(o,l)),1===u&&this._store(t,i,0,c,this.points[0],l,n,r),p){this._direction(p,f,s);var _=this._computeMiter(a,h,o,s);this._store(t,i,u,c,this.points[u],h,_*n,_*r,u-1)}else this._perp(o,l),this._store(t,i,u,c,this.points[u],l,n,r,u-1)}if(this.points.length>2&&this.closed){var m=this.points[c-2],g=this.points[0],v=this.points[1];this._direction(g,m,o),this._direction(v,g,s),this._perp(o,l);var y=this._computeMiter(a,h,o,s);if(this._store(t,null,0,c,this.points[0],h,y*n,y*r,1),i){var b=null==r?0:4;i[0].x=t[b+0],i[0].y=t[b+1],i[1].x=t[b+2],i[1].y=t[b+3]}}this.closed&&this.points.splice(c-1)},r.prototype.setupModelRenderCache=function(t){var i=t,n=this.owner.engine;if(null===this._fillVB&&this._computeLines2D(),this.fill){i.fillVB=n.createVertexBuffer(this._fillVB),i.fillIB=n.createIndexBuffer(this._fillIB),i.fillIndicesCount=this._fillIB.length;var r=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["position"],!0);r&&(i.effectFillInstanced=n.createEffect("lines2d",r.attributes,r.uniforms,[],r.defines,null)),r=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_FILLPARTID,["position"],!1),i.effectFill=n.createEffect("lines2d",r.attributes,r.uniforms,[],r.defines,null)}if(this.border){i.borderVB=n.createVertexBuffer(this._borderVB),i.borderIB=n.createIndexBuffer(this._borderIB),i.borderIndicesCount=this._borderIB.length;var r=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["position"],!0);r&&(i.effectBorderInstanced=n.createEffect({vertex:"lines2d",fragment:"lines2d"},r.attributes,r.uniforms,[],r.defines,null)),r=this.getDataPartEffectInfo(e.Shape2D.SHAPE2D_BORDERPARTID,["position"],!1),i.effectBorder=n.createEffect({vertex:"lines2d",fragment:"lines2d"},r.attributes,r.uniforms,[],r.defines,null)}return this._fillVB=null,this._fillIB=null,this._borderVB=null,this._borderIB=null,i},r.prototype._computeLines2D=function(){this._boundingMin=new e.Vector2(Number.MAX_VALUE,Number.MAX_VALUE),this._boundingMax=new e.Vector2(Number.MIN_VALUE,Number.MIN_VALUE);var t=new Array,i=new Array,n=new Array;if(this.fill){var o=this._getCapSize(this.startCap),s=this._getCapSize(this.endCap),a=this.points.length,h=2*a*2+o.vbsize+s.vbsize;this._fillVB=new Float32Array(h);var l=this._fillVB,c=this.fillThickness/2,u=this.points.length;this._buildLine(l,this.border?null:t,c);var d=2*u,f=2*(a-(this.closed?0:1));this._fillIB=new Float32Array(3*f+o.ibsize+s.ibsize);for(var p=this._fillIB,_=0;f>_;_+=2)p[3*_+0]=_+0,p[3*_+1]=_+1,p[3*_+2]=(_+2)%d,p[3*_+3]=_+1,p[3*_+4]=(_+3)%d,p[3*_+5]=(_+2)%d;this._buildCap(l,2*a*2,p,3*f,this.points[0],this.fillThickness,null,this.startCap,r._startDir,this.border?null:i),this._buildCap(l,2*a*2+o.vbsize,p,3*f+o.ibsize,this.points[u-1],this.fillThickness,null,this.endCap,r._endDir,this.border?null:i)}if(this.border){var o=this._getCapSize(this.startCap,!0),s=this._getCapSize(this.endCap,!0),a=this.points.length,h=2*a*2*2+o.vbsize+s.vbsize;this._borderVB=new Float32Array(h);var l=this._borderVB,c=this.fillThickness/2,m=this.borderThickness,u=this.points.length;this._buildLine(l,t,c,m);var d=2*u*2,f=2*(a-(this.closed?0:1))*2;this._borderIB=new Float32Array(3*f+o.ibsize+s.ibsize);for(var p=this._borderIB,_=0;f>_;_+=4)p[3*_+0]=_+0,p[3*_+1]=_+2,p[3*_+2]=(_+6)%d,p[3*_+3]=_+0,p[3*_+4]=(_+6)%d,p[3*_+5]=(_+4)%d,p[3*_+6]=_+3,p[3*_+7]=_+1,p[3*_+8]=(_+5)%d,p[3*_+9]=_+3,p[3*_+10]=(_+5)%d,p[3*_+11]=(_+7)%d;this._buildCap(l,2*a*2*2,p,3*f,this.points[0],this.fillThickness,this.borderThickness,this.startCap,r._startDir,i),this._buildCap(l,2*a*2*2+o.vbsize,p,3*f+o.ibsize,this.points[u-1],this.fillThickness,this.borderThickness,this.endCap,r._endDir,n)}if(this._contour=t,i.length>0){var g=Earcut.earcut(i,null,2);this._startCapTriIndices=g,this._startCapContour=i}if(n.length>0){var v=Earcut.earcut(n,null,2);this._endCapContour=n,this._endCapTriIndices=v}var y=this._boundingMax.subtract(this._boundingMin);this._size.width=y.x,this._size.height=y.y},Object.defineProperty(r.prototype,"size",{get:function(){return null==this._size&&this._computeLines2D(),this._size},enumerable:!0,configurable:!0}),r.prototype.createInstanceDataParts=function(){var t=new Array;return this.border&&t.push(new i(e.Shape2D.SHAPE2D_BORDERPARTID)),this.fill&&t.push(new i(e.Shape2D.SHAPE2D_FILLPARTID)),t},r.prototype.refreshInstanceDataPart=function(t){if(!n.prototype.refreshInstanceDataPart.call(this,t))return!1;if(t.id===e.Shape2D.SHAPE2D_BORDERPARTID){var i=t;this.border instanceof e.GradientColorBrush2D&&(i.boundingMin=this.boundingMin,i.boundingMax=this.boundingMax)}else if(t.id===e.Shape2D.SHAPE2D_FILLPARTID){var i=t;this.fill instanceof e.GradientColorBrush2D&&(i.boundingMin=this.boundingMin,i.boundingMax=this.boundingMax)}return!0},r._prevA=e.Vector2.Zero(),r._prevB=e.Vector2.Zero(),r._curA=e.Vector2.Zero(),r._curB=e.Vector2.Zero(),r._miterTps=e.Vector2.Zero(),r._startDir=e.Vector2.Zero(),r._endDir=e.Vector2.Zero(),r._tpsV=e.Vector2.Zero(),r._noCap=0,r._roundCap=1,r._triangleCap=2,r._squareAnchorCap=3,r._roundAnchorCap=4,r._diamondAnchorCap=5,r._arrowCap=6,r._roundCapSubDiv=36,__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+1,function(e){return r.pointsProperty=e})],r.prototype,"points",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+2,function(e){return r.fillThicknessProperty=e})],r.prototype,"fillThickness",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+3,function(e){return r.closedProperty=e})],r.prototype,"closed",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+4,function(e){return r.startCapProperty=e})],r.prototype,"startCap",null),__decorate([e.modelLevelProperty(e.Shape2D.SHAPE2D_PROPCOUNT+5,function(e){return r.endCapProperty=e})],r.prototype,"endCap",null),r=__decorate([e.className("Lines2D")],r)}(e.Shape2D);e.Lines2D=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._modelCache=new e.StringDictionary}return t.prototype.GetOrAddModelCache=function(e,t){return this._modelCache.getOrAddWithFactory(e,t)},t.prototype.DisposeModelRenderCache=function(e){return!!e.isDisposed&&(this._modelCache.remove(e.modelKey),!0)},t}();e.Canvas2DEngineBoundData=t;var i=function(i){function n(r,o){var s=this;i.call(this,o),this.worldSpaceToNodeLocal=function(t){var i=s._worldSpaceNode;if(i){var n=i.getWorldMatrix().clone();n.invert();var r=e.Vector3.TransformCoordinates(t,n),o=s._renderScaleFactor,a=new e.Vector2(r.x*o,r.y*o),h=s.actualSize;return s.origin,a.x+=.5*h.width,a.y+=.5*h.width,a}},this._notifDebugMode=!1,this._mapCounter=0,e.Prim2DBase._isCanvasInit=!1,o||(o={});var a=null==o.renderScaleFactor?1:o.renderScaleFactor;this._cachingStrategy!==n.CACHESTRATEGY_TOPLEVELGROUPS&&(this._background=new e.Rectangle2D({parent:this,id:"###CANVAS BACKGROUND###",size:o.size}),this._background.zOrder=1,this._background.isPickable=!1,this._background.origin=e.Vector2.Zero(),this._background.levelVisible=!1,null!=o.backgroundRoundRadius&&(this.backgroundRoundRadius=o.backgroundRoundRadius),null!=o.backgroundBorder&&("string"==typeof o.backgroundBorder?this.backgroundBorder=n.GetBrushFromString(o.backgroundBorder):this.backgroundBorder=o.backgroundBorder),null!=o.backgroundBorderThickNess&&(this.backgroundBorderThickness=o.backgroundBorderThickNess),null!=o.backgroundFill&&("string"==typeof o.backgroundFill?this.backgroundFill=n.GetBrushFromString(o.backgroundFill):this.backgroundFill=o.backgroundFill),this._background._patchHierarchy(this));var h=r.getEngine();this.__engineData=h.getOrAddExternalDataWithFactory("__BJSCANVAS2D__",function(e){return new t}),this._renderScaleFactor=a,this._primPointerInfo=new e.PrimitivePointerInfo,this._capturedPointers=new e.StringDictionary,this._pickStartingPosition=e.Vector2.Zero(),this._hierarchyLevelMaxSiblingCount=50,this._hierarchyDepthOffset=0,this._siblingDepthOffset=1/this._hierarchyLevelMaxSiblingCount,this._scene=r,this._engine=h,this._renderingSize=new e.Size(0,0),this._trackedGroups=new Array,this._patchHierarchy(this);var l=null==o.enableInteraction||o.enableInteraction;this._fitRenderingDevice=!o.size,o.size?(o.size.height*=a,o.size.width*=a):o.size=new e.Size(h.getRenderWidth(),h.getRenderHeight()),r.onDisposeObservable.add(function(e,t){s.dispose()}),this._isScreenSpace?this._afterRenderObserver=this._scene.onAfterRenderObservable.add(function(e,t){s._engine.clear(null,!1,!0),s._render()}):this._beforeRenderObserver=this._scene.onBeforeRenderObservable.add(function(e,t){s._render()}),this._supprtInstancedArray=null!==this._engine.getCaps().instancedArrays,this._setupInteraction(l)}return __extends(n,i),n.prototype._canvasPreInit=function(e){var t=null==e.cachingStrategy?n.CACHESTRATEGY_DONTCACHE:e.cachingStrategy;this._cachingStrategy=t,this._isScreenSpace=null==e.isScreenSpace||e.isScreenSpace},n.prototype._setupInteraction=function(e){var t=this;if(e!==this._interactionEnabled)if(this._interactionEnabled=e,this._isScreenSpace){if(!e)return void(this._scenePrePointerObserver&&(this.scene.onPrePointerObservable.remove(this._scenePrePointerObserver),this._scenePrePointerObserver=null));this._scenePrePointerObserver=this.scene.onPrePointerObservable.add(function(e,i){var n=1/t.engine.getHardwareScalingLevel(),r=e.localPosition.multiplyByFloats(n,n);t._handlePointerEventForInteraction(e,r,i)})}else{var i=this.scene;e?(i.constantlyUpdateMeshUnderPointer=!0,this._scenePointerObserver=i.onPointerObservable.add(function(e,i){if(e.pickInfo.hit&&e.pickInfo.pickedMesh===t._worldSpaceNode&&t.worldSpaceToNodeLocal){var n=t.worldSpaceToNodeLocal(e.pickInfo.pickedPoint);t._handlePointerEventForInteraction(e,n,i)}})):this._scenePointerObserver&&(this.scene.onPointerObservable.remove(this._scenePointerObserver),this._scenePointerObserver=null)}},n.prototype._setPointerCapture=function(t,i){if(this.isPointerCaptured(t))return!1;try{this.engine.getRenderingCanvas().setPointerCapture(t)}catch(e){}return this._primPointerInfo.updateRelatedTarget(i,e.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(i,e.PrimitivePointerInfo.PointerGotCapture,null),this._capturedPointers.add(t.toString(),i),!0},n.prototype._releasePointerCapture=function(t,i){if(this._capturedPointers.get(t.toString())!==i)return!1;try{this.engine.getRenderingCanvas().releasePointerCapture(t)}catch(e){}return this._primPointerInfo.updateRelatedTarget(i,e.Vector2.Zero()),this._bubbleNotifyPrimPointerObserver(i,e.PrimitivePointerInfo.PointerLostCapture,null),this._capturedPointers.remove(t.toString()),!0},n.prototype.isPointerCaptured=function(e){return this._capturedPointers.contains(e.toString())},n.prototype.getCapturedPrimitive=function(e){return 0===this._capturedPointers.count?null:this._capturedPointers.get(e.toString())},n.prototype._handlePointerEventForInteraction=function(t,i,n){if(!this.isDisposed){this._updatePointerInfo(t,i);var r=this.getCapturedPrimitive(this._primPointerInfo.pointerId);if(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,null!==r),this._updateOverStatus(),this._actualOverPrimitive||r){var o=r||this._actualOverPrimitive.prim,s=r?this._primPointerInfo.canvasPointerPos.subtract(new e.Vector2(o.globalTransform.m[12],o.globalTransform.m[13])):this._actualOverPrimitive.intersectionLocation;this._primPointerInfo.updateRelatedTarget(o,s),t.type===e.PointerEventTypes.POINTERWHEEL?this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerMouseWheel,t.event):t.type===e.PointerEventTypes.POINTERMOVE?this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerMove,t.event):t.type===e.PointerEventTypes.POINTERDOWN?this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerDown,t.event):t.type===e.PointerEventTypes.POINTERUP&&this._bubbleNotifyPrimPointerObserver(o,e.PrimitivePointerInfo.PointerUp,t.event)}}},n.prototype._updatePointerInfo=function(t,i){var n=this._primPointerInfo;n.canvasPointerPos||(n.canvasPointerPos=e.Vector2.Zero());var r=this._scene.cameraToUseForPointers||this._scene.activeCamera,o=this._scene.getEngine();if(this._isScreenSpace){var s=r.viewport,a=s.toGlobal(o.getRenderWidth(),o.getRenderHeight()),h=i.x-a.x,l=i.y-a.y;n.canvasPointerPos.x=h-this.actualPosition.x,n.canvasPointerPos.y=o.getRenderHeight()-l-this.actualPosition.y}else n.canvasPointerPos.x=i.x,n.canvasPointerPos.y=i.y;if(n.mouseWheelDelta=0,t.type===e.PointerEventTypes.POINTERWHEEL){var c=t.event;c.wheelDelta?n.mouseWheelDelta=c.wheelDelta/(40*e.PrimitivePointerInfo.MouseWheelPrecision):c.detail&&(n.mouseWheelDelta=-c.detail/e.PrimitivePointerInfo.MouseWheelPrecision)}else{var u=t.event;n.ctrlKey=u.ctrlKey,n.altKey=u.altKey,n.shiftKey=u.shiftKey,n.metaKey=u.metaKey,n.button=u.button,n.buttons=u.buttons,n.pointerId=u.pointerId,n.width=u.width,n.height=u.height,n.presssure=u.pressure,n.tilt.x=u.tiltX,n.tilt.y=u.tiltY,n.isCaptured=null!==this.getCapturedPrimitive(u.pointerId)}},n.prototype._updateIntersectionList=function(e,t){if(this.scene.getRenderId()!==this._intersectionRenderId){this._globalTransform||this.updateCachedStates(!0);var i=n._interInfo;if(i.pickPosition.x=e.x,
i.pickPosition.y=e.y,i.findFirstOnly=!1,!t&&!this.boundingInfo.doesIntersect(i.pickPosition))return this._previousIntersectionList=this._actualIntersectionList,this._actualIntersectionList=null,this._previousOverPrimitive=this._actualOverPrimitive,void(this._actualOverPrimitive=null);this.intersect(i),this._previousIntersectionList=this._actualIntersectionList,this._actualIntersectionList=i.intersectedPrimitives,this._previousOverPrimitive=this._actualOverPrimitive,this._actualOverPrimitive=i.topMostIntersectedPrimitive,this._intersectionRenderId=this.scene.getRenderId()}},n.prototype._updateOverStatus=function(){if(this.scene.getRenderId()!==this._hoverStatusRenderId&&this._previousIntersectionList&&this._actualIntersectionList){var t=this._previousOverPrimitive?this._previousOverPrimitive.prim:null,i=this._actualOverPrimitive?this._actualOverPrimitive.prim:null;if(t!==i){var n=this.getCapturedPrimitive(this._primPointerInfo.pointerId);(n&&n===t||!n&&t)&&(this._primPointerInfo.updateRelatedTarget(t,this._previousOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(t,e.PrimitivePointerInfo.PointerOut,null)),(n&&n===i||!n&&i)&&(this._primPointerInfo.updateRelatedTarget(i,this._actualOverPrimitive.intersectionLocation),this._bubbleNotifyPrimPointerObserver(i,e.PrimitivePointerInfo.PointerOver,null))}this._hoverStatusRenderId=this.scene.getRenderId()}},n.prototype._updatePrimPointerPos=function(e){if(this._primPointerInfo.isCaptured)this._primPointerInfo.primitivePointerPos=this._primPointerInfo.relatedTargetPointerPos;else for(var t=0,i=this._actualIntersectionList;t<i.length;t++){var n=i[t];if(n.prim===e)return void(this._primPointerInfo.primitivePointerPos=n.intersectionLocation)}},n.prototype._debugExecObserver=function(t,i){if(this._notifDebugMode){for(var n="",r=0;r<t.hierarchyDepth;r++)n+="  ";var o=this._primPointerInfo;n+="[RID:"+this.scene.getRenderId()+"] ["+t.hierarchyDepth+"] event:"+e.PrimitivePointerInfo.getEventTypeName(i)+", id: "+t.id+" ("+e.Tools.getClassName(t)+"), primPos: "+o.primitivePointerPos.toString()+", canvasPos: "+o.canvasPointerPos.toString(),console.log(n)}},n.prototype._bubbleNotifyPrimPointerObserver=function(t,i,n){var r=this._primPointerInfo;0!==(i&(e.PrimitivePointerInfo.PointerOver|e.PrimitivePointerInfo.PointerOut))&&this._notifParents(t,i);for(var o=!1,s=t;s;){if(!o&&(this._updatePrimPointerPos(s),this._debugExecObserver(s,i),s._pointerEventObservable.notifyObservers(r,i),this._triggerActionManager(s,r,i,n),r.cancelBubble)){if(0===(i&(e.PrimitivePointerInfo.PointerOver|e.PrimitivePointerInfo.PointerOut)))return;o=!0}o&&this._updatePrimPointerPos(s),i===e.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(s,e.PrimitivePointerInfo.PointerEnter),s._pointerEventObservable.notifyObservers(r,e.PrimitivePointerInfo.PointerEnter)):i===e.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(s,e.PrimitivePointerInfo.PointerLeave),s._pointerEventObservable.notifyObservers(r,e.PrimitivePointerInfo.PointerLeave)),s=s.parent}},n.prototype._triggerActionManager=function(t,i,n,r){var o=this;if(this._globalTransform||this.updateCachedStates(!0),0!==(n&e.PrimitivePointerInfo.PointerDown)){if(this._pickStartingPosition=i.primitivePointerPos.clone(),this._pickStartingTime=(new Date).getTime(),this._pickedDownPrim=null,t.actionManager){if(this._pickedDownPrim=t,t.actionManager.hasPickTriggers){var s=e.ActionEvent.CreateNewFromPrimitive(t,i.primitivePointerPos,r);switch(r.button){case 0:t.actionManager.processTrigger(e.ActionManager.OnLeftPickTrigger,s);break;case 1:t.actionManager.processTrigger(e.ActionManager.OnCenterPickTrigger,s);break;case 2:t.actionManager.processTrigger(e.ActionManager.OnRightPickTrigger,s)}t.actionManager.processTrigger(e.ActionManager.OnPickDownTrigger,s)}t.actionManager.hasSpecificTrigger(e.ActionManager.OnLongPressTrigger)&&window.setTimeout(function(){var i=o._primPointerInfo,n=o.getCapturedPrimitive(i.pointerId);o._updateIntersectionList(i.canvasPointerPos,null!==n);var s=new e.IntersectInfo2D;s.pickPosition=i.canvasPointerPos.clone(),s.findFirstOnly=!1,o.intersect(s),null!==s.isPrimIntersected(t)&&t.actionManager&&0!==o._pickStartingTime&&(new Date).getTime()-o._pickStartingTime>e.ActionManager.LongPressDelay&&Math.abs(o._pickStartingPosition.x-s.pickPosition.x)<e.ActionManager.DragMovementThreshold&&Math.abs(o._pickStartingPosition.y-s.pickPosition.y)<e.ActionManager.DragMovementThreshold&&(o._pickStartingTime=0,t.actionManager.processTrigger(e.ActionManager.OnLongPressTrigger,e.ActionEvent.CreateNewFromPrimitive(t,i.primitivePointerPos,r)))},e.ActionManager.LongPressDelay)}}else if(0!==(n&e.PrimitivePointerInfo.PointerUp)){this._pickStartingTime=0;var s=e.ActionEvent.CreateNewFromPrimitive(t,i.primitivePointerPos,r);t.actionManager&&(t.actionManager.processTrigger(e.ActionManager.OnPickUpTrigger,s),Math.abs(this._pickStartingPosition.x-i.canvasPointerPos.x)<e.ActionManager.DragMovementThreshold&&Math.abs(this._pickStartingPosition.y-i.canvasPointerPos.y)<e.ActionManager.DragMovementThreshold&&t.actionManager.processTrigger(e.ActionManager.OnPickTrigger,s)),this._pickedDownPrim&&this._pickedDownPrim.actionManager&&this._pickedDownPrim!==t&&this._pickedDownPrim.actionManager.processTrigger(e.ActionManager.OnPickOutTrigger,s)}else if(0!==(n&e.PrimitivePointerInfo.PointerOver)){if(t.actionManager){var s=e.ActionEvent.CreateNewFromPrimitive(t,i.primitivePointerPos,r);t.actionManager.processTrigger(e.ActionManager.OnPointerOverTrigger,s)}}else if(0!==(n&e.PrimitivePointerInfo.PointerOut)&&t.actionManager){var s=e.ActionEvent.CreateNewFromPrimitive(t,i.primitivePointerPos,r);t.actionManager.processTrigger(e.ActionManager.OnPointerOutTrigger,s)}},n.prototype._notifParents=function(t,i){for(var n=this._primPointerInfo,r=this;r;)this._updatePrimPointerPos(r),i===e.PrimitivePointerInfo.PointerOver?(this._debugExecObserver(r,e.PrimitivePointerInfo.PointerEnter),r._pointerEventObservable.notifyObservers(n,e.PrimitivePointerInfo.PointerEnter)):i===e.PrimitivePointerInfo.PointerOut&&(this._debugExecObserver(r,e.PrimitivePointerInfo.PointerLeave),r._pointerEventObservable.notifyObservers(n,e.PrimitivePointerInfo.PointerLeave)),r=r.parent},n.prototype.dispose=function(){return!!i.prototype.dispose.call(this)&&(this.interactionEnabled&&this._setupInteraction(!1),this._beforeRenderObserver&&(this._scene.onBeforeRenderObservable.remove(this._beforeRenderObserver),this._beforeRenderObserver=null),this._afterRenderObserver&&(this._scene.onAfterRenderObservable.remove(this._afterRenderObserver),this._afterRenderObserver=null),void(this._groupCacheMaps&&(this._groupCacheMaps.forEach(function(e){return e.dispose()}),this._groupCacheMaps=null)))},Object.defineProperty(n.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cachingStrategy",{get:function(){return this._cachingStrategy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"worldSpaceCanvasNode",{get:function(){return this._worldSpaceNode},set:function(e){this._worldSpaceNode=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"supportInstancedArray",{get:function(){return this._supprtInstancedArray},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundFill",{get:function(){return this._background&&this._background.isVisible?this._background.fill:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.fill&&(this._background.fill=e,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundBorder",{get:function(){return this._background&&this._background.isVisible?this._background.border:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.border&&(this._background.border=e,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundBorderThickness",{get:function(){return this._background&&this._background.isVisible?this._background.borderThickness:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.borderThickness&&(this._background.borderThickness=e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"backgroundRoundRadius",{get:function(){return this._background&&this._background.isVisible?this._background.roundRadius:null},set:function(e){this.checkBackgroundAvailability(),e!==this._background.roundRadius&&(this._background.roundRadius=e,this._background.levelVisible=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"interactionEnabled",{get:function(){return this._interactionEnabled},set:function(e){this._setupInteraction(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"_engineData",{get:function(){return this.__engineData},enumerable:!0,configurable:!0}),n.prototype.checkBackgroundAvailability=function(){if(this._cachingStrategy===n.CACHESTRATEGY_TOPLEVELGROUPS)throw Error("Can't use Canvas Background with the caching strategy TOPLEVELGROUPS")},n.prototype.onPrimBecomesDirty=function(){this._addPrimToDirtyList(this)},n.prototype._updateTrackedNodes=function(){var t=this.scene.cameraToUseForPointers||this.scene.activeCamera;t.getViewMatrix().multiplyToRef(t.getProjectionMatrix(),n._m);for(var i=this.engine.getRenderHeight(),r=t.viewport.toGlobal(this.engine.getRenderWidth(),i),o=0,s=this._trackedGroups;o<s.length;o++){var a=s[o];if(!a.isDisposed&&a.isVisible){var h=a.trackedNode,l=h.getWorldMatrix(),c=e.Vector3.Project(n._v,l,n._m,r);a.x=Math.round(c.x),a.y=Math.round(i-c.y)}}},n.prototype._updateCanvasState=function(){if(this.scene.getRenderId()!==this._updateRenderId){var t=!1,i=this.engine.getRenderWidth();i!==this._renderingSize.width&&(t=!0),this._renderingSize.width=i;var n=this.engine.getRenderHeight();n!==this._renderingSize.height&&(t=!0),this._renderingSize.height=n,t&&this._fitRenderingDevice&&(this.size=this._renderingSize,this._background&&(this._background.size=this.size),this._setLayoutDirty());var r=new e.PrepareRender2DContext;++this._globalTransformProcessStep,this.updateCachedStates(!1),this._prepareGroupRender(r),this._updateRenderId=this.scene.getRenderId()}},n.prototype._render=function(){this._updateTrackedNodes(),this._updateCanvasState(),this._primPointerInfo.canvasPointerPos&&(this._updateIntersectionList(this._primPointerInfo.canvasPointerPos,!1),this._updateOverStatus()),this.engine.setState(!1),this._groupRender(),this._cachingStrategy===n.CACHESTRATEGY_CANVAS&&this._cachedCanvasGroup&&this._cachedCanvasGroup._renderCachedCanvas()},n.prototype._allocateGroupCache=function(t,i,r){var o=t.actualSize;o=new e.Size(Math.ceil(o.width),Math.ceil(o.height)),r&&(o.width=Math.max(r.width,o.width),o.height=Math.max(r.height,o.height)),this._groupCacheMaps||(this._groupCacheMaps=new Array);for(var s=null,a=0,h=this._groupCacheMaps;a<h.length;a++){var l=h[a],c=l.allocateRect(o);if(c){s={node:c,texture:l};break}}if(!s){var u=new e.Size(n._groupTextureCacheSize,n._groupTextureCacheSize);(o.width>u.width||o.height>u.height)&&(u.width=Math.pow(2,Math.ceil(Math.log(o.width)/Math.log(2))),u.height=Math.pow(2,Math.ceil(Math.log(o.height)/Math.log(2))));var d="groupsMapChache"+this._mapCounter+"forCanvas"+this.id;l=new e.MapTexture(d,this._scene,u),this._groupCacheMaps.push(l);var c=l.allocateRect(o);s={node:c,texture:l}}if(t!==this||this._isScreenSpace){var c=s.node;if(this._cachingStrategy===n.CACHESTRATEGY_CANVAS){this._cachedCanvasGroup=e.Group2D._createCachedCanvasGroup(this);var f=new e.Sprite2D(l,{parent:this._cachedCanvasGroup,id:"__cachedCanvasSprite__",spriteSize:c.contentSize,spriteLocation:c.pos});f.zOrder=1,f.origin=e.Vector2.Zero()}else{var f=new e.Sprite2D(l,{parent:i,id:"__cachedSpriteOfGroup__"+t.id,x:t.actualPosition.x,y:t.actualPosition.y,spriteSize:c.contentSize,spriteLocation:c.pos});f.origin=t.origin.clone(),s.sprite=f}}return s},n.prototype._registerTrackedNode=function(t){t._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)||(this._trackedGroups.push(t),t._setFlags(e.SmartPropertyPrim.flagTrackedGroup))},n.prototype._unregisterTrackedNode=function(t){if(t._isFlagSet(e.SmartPropertyPrim.flagTrackedGroup)){var i=this._trackedGroups.indexOf(t);-1!==i&&this._trackedGroups.splice(i,1),t._clearFlags(e.SmartPropertyPrim.flagTrackedGroup)}},n.GetSolidColorBrush=function(t){return n._solidColorBrushes.getOrAddWithFactory(t.toHexString(),function(){return new e.SolidColorBrush2D(t.clone(),!0)})},n.GetSolidColorBrushFromHex=function(t){return n._solidColorBrushes.getOrAddWithFactory(t,function(){return new e.SolidColorBrush2D(e.Color4.FromHexString(t),!0)})},n.GetGradientColorBrush=function(t,i,r,o,s){return void 0===r&&(r=e.Vector2.Zero()),void 0===o&&(o=0),void 0===s&&(s=1),n._gradientColorBrushes.getOrAddWithFactory(e.GradientColorBrush2D.BuildKey(t,i,r,o,s),function(){return new e.GradientColorBrush2D(t,i,r,o,s,!0)})},n.GetBrushFromString=function(t){t=t.trim();var i=t.split(",");if(1===i.length){var r=null;if(0===t.indexOf("solid:"))r=t.substr(6).trim();else{if(0!==t.indexOf("#"))return null;r=t}return n.GetSolidColorBrushFromHex(r)}0===i[0].indexOf("gradient:")&&(i[0]=i[0].substr(9).trim());try{var o=e.Color4.FromHexString(i[0].trim()),s=e.Color4.FromHexString(i[1].trim()),a=e.Vector2.Zero();if(i.length>2){var h=i[2].trim();if("["!==h.charAt(0)||"]"!==h.charAt(h.length-1))return null;var l=h.indexOf(":"),c=parseFloat(h.substr(1,l)),u=parseFloat(h.substr(l+1,h.length-(l+1)));a=new e.Vector2(c,u)}var d=0;i.length>3&&(d=e.Tools.ToRadians(parseFloat(i[3].trim())));var f=1;return i.length>4&&(f=parseFloat(i[4].trim())),n.GetGradientColorBrush(o,s,a,d,f)}catch(e){return null}},n.CACHESTRATEGY_TOPLEVELGROUPS=1,n.CACHESTRATEGY_ALLGROUPS=2,n.CACHESTRATEGY_CANVAS=3,n.CACHESTRATEGY_DONTCACHE=4,n.hierarchyLevelMaxSiblingCount=50,n._interInfo=new e.IntersectInfo2D,n._v=e.Vector3.Zero(),n._m=e.Matrix.Identity(),n._groupTextureCacheSize=1024,n._solidColorBrushes=new e.StringDictionary,n._gradientColorBrushes=new e.StringDictionary,n=__decorate([e.className("Canvas2D")],n)}(e.Group2D);e.Canvas2D=i;var n=function(t){function n(n,r,o){e.Prim2DBase._isCanvasInit=!0;var s=o;if(s.isScreenSpace=!1,s.size=r.clone(),o.cachingStrategy=null==o.cachingStrategy?i.CACHESTRATEGY_CANVAS:o.cachingStrategy,o.cachingStrategy!==i.CACHESTRATEGY_CANVAS)throw new Error("Right now only the CACHESTRATEGY_CANVAS cache Strategy is supported for WorldSpace Canvas. More will come soon!");t.call(this,n,o),e.Prim2DBase._isCanvasInit=!1;var a=!o||null==o.customWorldSpaceNode,h=o?o.id||null:null;if(a){var l=new e.WorldSpaceCanvas2DNode(h,n,this),c=e.VertexData.CreatePlane({width:r.width,height:r.height,sideOrientation:o&&o.sideOrientation||e.Mesh.DEFAULTSIDE}),u=new e.StandardMaterial(h+"_Material",n);this.applyCachedTexture(c,u),c.applyToMesh(l,!1),u.specularColor=new e.Color3(0,0,0),u.disableLighting=!0,u.useAlphaFromDiffuseTexture=!0,l.position=o&&o.worldPosition||e.Vector3.Zero(),l.rotationQuaternion=o&&o.worldRotation||e.Quaternion.Identity(),l.material=u,this._worldSpaceNode=l}else this._worldSpaceNode=o.customWorldSpaceNode,this.applyCachedTexture(null,null)}return __extends(n,t),n=__decorate([e.className("WorldSpaceCanvas2D")],n)}(i);e.WorldSpaceCanvas2D=n;var r=function(t){function i(i,n){e.Prim2DBase._isCanvasInit=!0,t.call(this,i,n)}return __extends(i,t),i=__decorate([e.className("ScreenSpaceCanvas2D")],i)}(i);e.ScreenSpaceCanvas2D=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i),this._canvas=n}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._canvas&&(this._canvas.dispose(),this._canvas=null)},t}(e.Mesh);e.WorldSpaceCanvas2DNode=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.layoutDirtyOnPropertyChangedMask=0}return t.prototype.updateLayout=function(e){},Object.defineProperty(t.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.isLocked=function(){return this._isLocked},t.prototype.lock=function(){return!this._isLocked&&(this._isLocked=!0,!0)},t=__decorate([e.className("LayoutEngineBase")],t)}();e.LayoutEngineBase=t;var i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.updateLayout=function(t){if(t._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)){for(var i=0,n=t.children;i<n.length;i++){var r=n[i];this._doUpdate(r)}t._clearFlags(e.SmartPropertyPrim.flagLayoutDirty)}},i.prototype._doUpdate=function(t){t instanceof e.Canvas2D?t.layoutArea=t.actualSize:t.parent instanceof e.Canvas2D?t.layoutArea=t.owner.actualSize:t.layoutArea=t.parent.contentArea},Object.defineProperty(i.prototype,"isChildPositionAllowed",{get:function(){return!0},enumerable:!0,configurable:!0}),i.Singleton=new i,i=__decorate([e.className("CanvasLayoutEngine")],i)}(t);e.CanvasLayoutEngine=i;var n=function(t){function i(){t.call(this),this._isHorizontal=!0,this.layoutDirtyOnPropertyChangedMask=e.Prim2DBase.sizeProperty.flagId}return __extends(i,t),Object.defineProperty(i,"Horizontal",{get:function(){return i._horizontal||(i._horizontal=new i,i._horizontal.isHorizontal=!0,i._horizontal.lock()),i._horizontal},enumerable:!0,configurable:!0}),Object.defineProperty(i,"Vertical",{get:function(){return i._vertical||(i._vertical=new i,i._vertical.isHorizontal=!1,i._vertical.lock()),i._vertical},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isHorizontal",{get:function(){return this._isHorizontal},set:function(e){this.isLocked()||(this._isHorizontal=e)},enumerable:!0,configurable:!0}),i.prototype.updateLayout=function(t){if(t._isFlagSet(e.SmartPropertyPrim.flagLayoutDirty)){for(var i=0,n=0,r=this.isHorizontal,o=0,s=0,a=t.children;s<a.length;s++){var h=a[s],l=h.layoutArea;h.margin.computeArea(h.actualSize,l),o=Math.max(o,r?l.height:l.width)}for(var c=0,u=t.children;c<u.length;c++){var h=u[c];h.layoutAreaPos=new e.Vector2(i,n);var l=h.layoutArea;r?(i+=l.width,h.layoutArea=new e.Size(l.width,o)):(n+=l.height,h.layoutArea=new e.Size(o,l.height))}t._clearFlags(e.SmartPropertyPrim.flagLayoutDirty)}},Object.defineProperty(i.prototype,"isChildPositionAllowed",{get:function(){return!1},enumerable:!0,configurable:!0}),i._horizontal=null,i._vertical=null,i=__decorate([e.className("StackPanelLayoutEngine")],i)}(t);e.StackPanelLayoutEngine=n}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){t.call(this,i,n),this._textures={},this._floats={},this._floatsArrays={},this._colors3={},this._colors4={},this._vectors2={},this._vectors3={},this._vectors4={},this._matrices={},this._matrices3x3={},this._matrices2x2={},this._cachedWorldViewMatrix=new e.Matrix,this._shaderPath=r,o.needAlphaBlending=o.needAlphaBlending||!1,o.needAlphaTesting=o.needAlphaTesting||!1,o.attributes=o.attributes||["position","normal","uv"],o.uniforms=o.uniforms||["worldViewProjection"],o.samplers=o.samplers||[],o.defines=o.defines||[],this._options=o}return __extends(i,t),i.prototype.needAlphaBlending=function(){return this._options.needAlphaBlending},i.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},i.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},i.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},i.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},i.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},i.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},i.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},i.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},i.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},i.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},i.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},i.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},i.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},i.prototype.isReady=function(t,i){var n=this.getScene(),r=n.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===n.getRenderId())return!0;var o=[],s=new e.EffectFallbacks;i&&o.push("#define INSTANCES");for(var a=0;a<this._options.defines.length;a++)o.push(this._options.defines[a]);t&&t.useBones&&t.computeBonesUsingShaders&&(o.push("#define NUM_BONE_INFLUENCERS "+t.numBoneInfluencers),o.push("#define BonesPerMesh "+(t.skeleton.bones.length+1)),s.addCPUSkinningFallback(0,t)),r.getAlphaTesting()&&o.push("#define ALPHATEST");var h=this._effect,l=o.join("\n");return this._effect=r.createEffect(this._shaderPath,this._options.attributes,this._options.uniforms,this._options.samplers,l,s,this.onCompiled,this.onError),!!this._effect.isReady()&&(h!==this._effect&&n.resetCachedMaterial(),this._renderId=n.getRenderId(),!0)},i.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(t.getTransformMatrix()))},i.prototype.bind=function(e,i){if(this.bindOnlyWorldMatrix(e),this.getScene().getCachedMaterial()!==this){-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),i&&i.useBones&&i.computeBonesUsingShaders&&this._effect.setMatrices("mBones",i.skeleton.getTransformMatrices(i));for(var n in this._textures)this._effect.setTexture(n,this._textures[n]);for(n in this._floats)this._effect.setFloat(n,this._floats[n]);for(n in this._floatsArrays)this._effect.setArray(n,this._floatsArrays[n]);for(n in this._colors3)this._effect.setColor3(n,this._colors3[n]);for(n in this._colors4){var r=this._colors4[n];this._effect.setFloat4(n,r.r,r.g,r.b,r.a)}for(n in this._vectors2)this._effect.setVector2(n,this._vectors2[n]);for(n in this._vectors3)this._effect.setVector3(n,this._vectors3[n]);for(n in this._vectors4)this._effect.setVector4(n,this._vectors4[n]);for(n in this._matrices)this._effect.setMatrix(n,this._matrices[n]);for(n in this._matrices3x3)this._effect.setMatrix3x3(n,this._matrices3x3[n]);for(n in this._matrices2x2)this._effect.setMatrix2x2(n,this._matrices2x2[n])}t.prototype.bind.call(this,e,i)},i.prototype.clone=function(e){var t=new i(e,this.getScene(),this._shaderPath,this._options);return t},i.prototype.dispose=function(e,i){if(i)for(var n in this._textures)this._textures[n].dispose();this._textures={},t.prototype.dispose.call(this,e,i)},i.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);t.customType="BABYLON.ShaderMaterial",t.options=this._options,t.shaderPath=this._shaderPath,t.textures={};for(var i in this._textures)t.textures[i]=this._textures[i].serialize();t.floats={};for(i in this._floats)t.floats[i]=this._floats[i];t.floatArrays={};for(i in this._floatsArrays)t.floatArrays[i]=this._floatsArrays[i];t.colors3={};for(i in this._colors3)t.colors3[i]=this._colors3[i].asArray();t.colors4={};for(i in this._colors4)t.colors4[i]=this._colors4[i].asArray();t.vectors2={};for(i in this._vectors2)t.vectors2[i]=this._vectors2[i].asArray();t.vectors3={};for(i in this._vectors3)t.vectors3[i]=this._vectors3[i].asArray();t.vectors4={};for(i in this._vectors4)t.vectors4[i]=this._vectors4[i].asArray();t.matrices={};for(i in this._matrices)t.matrices[i]=this._matrices[i].asArray();t.matrices3x3={};for(i in this._matrices3x3)t.matrices3x3[i]=this._matrices3x3[i];t.matrices2x2={};for(i in this._matrices2x2)t.matrices2x2[i]=this._matrices2x2[i];return t},i.Parse=function(t,n,r){var o=e.SerializationHelper.Parse(function(){return new i(t.name,n,t.shaderPath,t.options)},t,n,r);for(var s in t.textures)o.setTexture(s,e.Texture.Parse(t.textures[s],n,r));for(s in t.floats)o.setFloat(s,t.floats[s]);for(s in t.floatsArrays)o.setFloats(s,t.floatsArrays[s]);for(s in t.colors3)o.setColor3(s,e.Color3.FromArray(t.colors3[s]));for(s in t.colors4)o.setColor4(s,e.Color4.FromArray(t.colors4[s]));for(s in t.vectors2)o.setVector2(s,e.Vector2.FromArray(t.vectors2[s]));for(s in t.vectors3)o.setVector3(s,e.Vector3.FromArray(t.vectors3[s]));for(s in t.vectors4)o.setVector4(s,e.Vector4.FromArray(t.vectors4[s]));for(s in t.matrices)o.setMatrix(s,e.Matrix.FromArray(t.matrices[s]));for(s in t.matrices3x3)o.setMatrix3x3(s,t.matrices3x3[s]);for(s in t.matrices2x2)o.setMatrix2x2(s,t.matrices2x2[s]);return o},i}(e.Material);e.ShaderMaterial=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var r=542327876,o=131072,s=512,a=4,h=64,l=131072,c=i("DXT1"),u=i("DXT3"),d=i("DXT5"),f=31,p=0,_=1,m=2,g=3,v=4,y=7,b=20,x=21,P=22,A=28,C=function(){function t(){}return t.GetDDSInfo=function(e){var t=new Int32Array(e,0,f),i=1;return t[m]&o&&(i=Math.max(1,t[y])),{width:t[v],height:t[g],mipmapCount:i,isFourCC:(t[b]&a)===a,isRGB:(t[b]&h)===h,isLuminance:(t[b]&l)===l,isCube:(t[A]&s)===s}},t.GetRGBAArrayBuffer=function(e,t,i,n,r){for(var o=new Uint8Array(n),s=new Uint8Array(r),a=0,h=t-1;h>=0;h--)for(var l=0;e>l;l++){var c=i+4*(l+h*e);o[a+2]=s[c],o[a+1]=s[c+1],o[a]=s[c+2],o[a+3]=s[c+3],a+=4}return o},t.GetRGBArrayBuffer=function(e,t,i,n,r){for(var o=new Uint8Array(n),s=new Uint8Array(r),a=0,h=t-1;h>=0;h--)for(var l=0;e>l;l++){var c=i+3*(l+h*e);o[a+2]=s[c],o[a+1]=s[c+1],o[a]=s[c+2],a+=3}return o},t.GetLuminanceArrayBuffer=function(e,t,i,n,r){for(var o=new Uint8Array(n),s=new Uint8Array(r),a=0,h=t-1;h>=0;h--)for(var l=0;e>l;l++){var c=i+(l+h*e);o[a]=s[c],a++}return o},t.UploadDDSLevels=function(i,s,a,h,l,b){var A,C,E,T,S,M,I,w,R,D,O=new Int32Array(a,0,f);if(O[p]!=r)return void e.Tools.Error("Invalid magic number in DDS header");if(!h.isFourCC&&!h.isRGB&&!h.isLuminance)return void e.Tools.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(h.isFourCC)switch(A=O[x]){case c:C=8,E=s.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case u:C=16,E=s.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case d:C=16,E=s.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return void console.error("Unsupported FourCC code:",n(A))}R=1,O[m]&o&&l!==!1&&(R=Math.max(1,O[y]));for(var L=O[P],B=0;b>B;B++){var N=1===b?i.TEXTURE_2D:i.TEXTURE_CUBE_MAP_POSITIVE_X+B;for(T=O[v],S=O[g],I=O[_]+4,D=0;R>D;++D){if(h.isRGB)24===L?(M=T*S*3,w=t.GetRGBArrayBuffer(T,S,I,M,a),i.texImage2D(N,D,i.RGB,T,S,0,i.RGB,i.UNSIGNED_BYTE,w)):(M=T*S*4,w=t.GetRGBAArrayBuffer(T,S,I,M,a),i.texImage2D(N,D,i.RGBA,T,S,0,i.RGBA,i.UNSIGNED_BYTE,w));else if(h.isLuminance){var F=i.getParameter(i.UNPACK_ALIGNMENT),V=T,k=Math.floor((T+F-1)/F)*F;M=k*(S-1)+V,w=t.GetLuminanceArrayBuffer(T,S,I,M,a),i.texImage2D(N,D,i.LUMINANCE,T,S,0,i.LUMINANCE,i.UNSIGNED_BYTE,w)}else M=Math.max(4,T)/4*Math.max(4,S)/4*C,w=new Uint8Array(a,I,M),i.compressedTexImage2D(N,D,E,T,S,0,w);I+=M,T*=.5,S*=.5,T=Math.max(1,T),S=Math.max(1,S)}}},t}();t.DDSTools=C}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){return void 0===t&&(t=!0),void 0===i&&(i=10),this._useDeltaForWorldStep=t,this.name="CannonJSPlugin",this._physicsMaterials=[],this._fixedTimeStep=1/60,this._currentCollisionGroup=2,this._minus90X=new e.Quaternion(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new e.Quaternion(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=e.Vector3.Zero(),this._tmpQuaternion=new e.Quaternion,this._tmpDeltaPosition=e.Vector3.Zero(),this._tmpDeltaRotation=new e.Quaternion,this._tmpUnityRotation=new e.Quaternion,this.isSupported()?(this.world=new CANNON.World,this.world.broadphase=new CANNON.NaiveBroadphase,void(this.world.solver.iterations=i)):void e.Tools.Error("CannonJS is not available. Please make sure you included the js file.")}return t.prototype.setGravity=function(e){this.world.gravity.copy(e)},t.prototype.setTimeStep=function(e){this._fixedTimeStep=e},t.prototype.executeStep=function(e,t){this.world.step(this._fixedTimeStep,this._useDeltaForWorldStep?1e3*e:0,3)},t.prototype.applyImpulse=function(e,t,i){var n=new CANNON.Vec3(i.x,i.y,i.z),r=new CANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyImpulse(r,n)},t.prototype.applyForce=function(e,t,i){var n=new CANNON.Vec3(i.x,i.y,i.z),r=new CANNON.Vec3(t.x,t.y,t.z);e.physicsBody.applyImpulse(r,n)},t.prototype.generatePhysicsBody=function(e){if(e.parent)return void(e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate()));if(e.isBodyInitRequired()){var t=this._createShape(e),i=e.physicsBody;i&&this.removePhysicsBody(e);var n=this._addMaterial("mat-"+e.uniqueId,e.getParam("friction"),e.getParam("restitution")),r={mass:e.getParam("mass"),material:n},o=e.getParam("nativeOptions");for(var s in o)o.hasOwnProperty(s)&&(r[s]=o[s]);e.physicsBody=new CANNON.Body(r),e.physicsBody.addEventListener("collide",e.onCollide),this.world.addEventListener("preStep",e.beforeStep),this.world.addEventListener("postStep",e.afterStep),e.physicsBody.addShape(t),this.world.add(e.physicsBody),i&&["force","torque","velocity","angularVelocity"].forEach(function(t){e.physicsBody[t].copy(i[t])}),this._processChildMeshes(e)}this._updatePhysicsBodyTransformation(e)},t.prototype._processChildMeshes=function(t){var i=this,n=t.object.getChildMeshes?t.object.getChildMeshes():[];if(n.length){var r=function(e,n){var o=n.getPhysicsImpostor();if(o){var s=o.parent;if(s!==t){var e=n.position;o.physicsBody&&(i.removePhysicsBody(o),o.physicsBody=null),o.parent=t,o.resetUpdateFlags(),t.physicsBody.addShape(i._createShape(o),new CANNON.Vec3(e.x,e.y,e.z)),t.physicsBody.mass+=o.getParam("mass")}}n.getChildMeshes().forEach(r.bind(i,n.position))};n.forEach(r.bind(this,e.Vector3.Zero()))}},t.prototype.removePhysicsBody=function(e){e.physicsBody.removeEventListener("collide",e.onCollide),this.world.removeEventListener("preStep",e.beforeStep),this.world.removeEventListener("postStep",e.afterStep),this.world.remove(e.physicsBody)},t.prototype.generateJoint=function(t){var i=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(i&&n){var r,o=t.joint.jointData,s={pivotA:o.mainPivot?(new CANNON.Vec3).copy(o.mainPivot):null,pivotB:o.connectedPivot?(new CANNON.Vec3).copy(o.connectedPivot):null,axisA:o.mainAxis?(new CANNON.Vec3).copy(o.mainAxis):null,axisB:o.connectedAxis?(new CANNON.Vec3).copy(o.connectedAxis):null,maxForce:o.nativeParams.maxForce,collideConnected:!!o.collision};switch(t.joint.type){case e.PhysicsJoint.HingeJoint:case e.PhysicsJoint.Hinge2Joint:r=new CANNON.HingeConstraint(i,n,s);break;case e.PhysicsJoint.DistanceJoint:r=new CANNON.DistanceConstraint(i,n,o.maxDistance||2);break;case e.PhysicsJoint.SpringJoint:var a=o;r=new CANNON.Spring(i,n,{restLength:a.length,stiffness:a.stiffness,damping:a.damping,localAnchorA:s.pivotA,localAnchorB:s.pivotB});break;case e.PhysicsJoint.LockJoint:r=new CANNON.LockConstraint(i,n,s);break;case e.PhysicsJoint.PointToPointJoint:case e.PhysicsJoint.BallAndSocketJoint:default:r=new CANNON.PointToPointConstraint(i,s.pivotA,n,s.pivotA,s.maxForce);
}r.collideConnected=!!o.collision,t.joint.physicsJoint=r,t.joint.type!==e.PhysicsJoint.SpringJoint?this.world.addConstraint(r):t.mainImpostor.registerAfterPhysicsStep(function(){r.applyForce()})}},t.prototype.removeJoint=function(e){this.world.removeConstraint(e.joint.physicsJoint)},t.prototype._addMaterial=function(e,t,i){var n,r;for(n=0;n<this._physicsMaterials.length;n++)if(r=this._physicsMaterials[n],r.friction===t&&r.restitution===i)return r;var o=new CANNON.Material(e);return o.friction=t,o.restitution=i,this._physicsMaterials.push(o),o},t.prototype._checkWithEpsilon=function(t){return t<e.PhysicsEngine.Epsilon?e.PhysicsEngine.Epsilon:t},t.prototype._createShape=function(t){var i,n=t.object,r=t.getObjectExtendSize();switch(t.type){case e.PhysicsEngine.SphereImpostor:var o=r.x,s=r.y,a=r.z;i=new CANNON.Sphere(Math.max(this._checkWithEpsilon(o),this._checkWithEpsilon(s),this._checkWithEpsilon(a))/2);break;case e.PhysicsImpostor.CylinderImpostor:i=new CANNON.Cylinder(this._checkWithEpsilon(r.x)/2,this._checkWithEpsilon(r.x)/2,this._checkWithEpsilon(r.y),16);break;case e.PhysicsImpostor.BoxImpostor:var h=r.scale(.5);i=new CANNON.Box(new CANNON.Vec3(this._checkWithEpsilon(h.x),this._checkWithEpsilon(h.y),this._checkWithEpsilon(h.z)));break;case e.PhysicsImpostor.PlaneImpostor:e.Tools.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),i=new CANNON.Plane;break;case e.PhysicsImpostor.MeshImpostor:var l=n.getVerticesData?n.getVerticesData(e.VertexBuffer.PositionKind):[],c=n.getIndices?n.getIndices():[];e.Tools.Warn("MeshImpostor only collides against spheres."),i=new CANNON.Trimesh(l,c);break;case e.PhysicsImpostor.HeightmapImpostor:i=this._createHeightmap(n);break;case e.PhysicsImpostor.ParticleImpostor:i=new CANNON.Particle}return i},t.prototype._createHeightmap=function(t,i){for(var n=t.getVerticesData(e.VertexBuffer.PositionKind),r=[],o=i||~~(Math.sqrt(n.length/3)-1),s=Math.min(t.getBoundingInfo().boundingBox.extendSize.x,t.getBoundingInfo().boundingBox.extendSize.z),a=2*s/o,h=t.getBoundingInfo().boundingBox.extendSize.y,l=0;l<n.length;l+=3){var c=Math.round(n[l+0]/a+o/2),u=Math.round(-1*(n[l+2]/a-o/2)),d=n[l+1]+h;r[c]||(r[c]=[]),r[c][u]||(r[c][u]=d),r[c][u]=Math.max(d,r[c][u])}for(var c=0;o>=c;++c){if(!r[c]){for(var f=1;!r[(c+f)%o];)f++;r[c]=r[(c+f)%o].slice()}for(var u=0;o>=u;++u)if(!r[c][u]){for(var p,f=1;void 0===p;)p=r[c][(u+f++)%o];r[c][u]=p}}var _=new CANNON.Heightfield(r,{elementSize:a});return _.minY=h,_},t.prototype._updatePhysicsBodyTransformation=function(t){var i=t.object;i.computeWorldMatrix&&i.computeWorldMatrix(!0);var n=t.getObjectCenter();t.getObjectExtendSize(),this._tmpDeltaPosition.copyFrom(i.position.subtract(n)),this._tmpPosition.copyFrom(n);var r=i.rotationQuaternion;if(t.type!==e.PhysicsImpostor.PlaneImpostor&&t.type!==e.PhysicsImpostor.HeightmapImpostor&&t.type!==e.PhysicsImpostor.CylinderImpostor||(r=r.multiply(this._minus90X),t.setDeltaRotation(this._plus90X)),t.type===e.PhysicsEngine.HeightmapImpostor){var o=i,s=o.rotationQuaternion;o.rotationQuaternion=this._tmpUnityRotation,o.computeWorldMatrix(!0);var a=n.clone(),h=o.getPivotMatrix()||e.Matrix.Translation(0,0,0);o.rotationQuaternion=s;var l=e.Matrix.Translation(o.getBoundingInfo().boundingBox.extendSize.x,0,-o.getBoundingInfo().boundingBox.extendSize.z);o.setPivotMatrix(l),o.computeWorldMatrix(!0);var c=o.getBoundingInfo().boundingBox.center.subtract(n).subtract(o.position).negate();this._tmpPosition.copyFromFloats(c.x,c.y-o.getBoundingInfo().boundingBox.extendSize.y,c.z),this._tmpDeltaPosition.copyFrom(o.getBoundingInfo().boundingBox.center.subtract(a)),this._tmpDeltaPosition.y+=o.getBoundingInfo().boundingBox.extendSize.y,o.setPivotMatrix(h),o.computeWorldMatrix(!0)}else t.type===e.PhysicsEngine.MeshImpostor&&(this._tmpDeltaPosition.copyFromFloats(0,0,0),this._tmpPosition.copyFrom(i.position));t.setDeltaPosition(this._tmpDeltaPosition),t.physicsBody.position.copy(this._tmpPosition),t.physicsBody.quaternion.copy(r)},t.prototype.setTransformationFromPhysicsBody=function(e){e.object.position.copyFrom(e.physicsBody.position),e.object.rotationQuaternion.copyFrom(e.physicsBody.quaternion)},t.prototype.setPhysicsBodyTransformation=function(e,t,i){e.physicsBody.position.copy(t),e.physicsBody.quaternion.copy(i)},t.prototype.isSupported=function(){return void 0!==window.CANNON},t.prototype.setLinearVelocity=function(e,t){e.physicsBody.velocity.copy(t)},t.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.copy(t)},t.prototype.getLinearVelocity=function(t){var i=t.physicsBody.velocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.getAngularVelocity=function(t){var i=t.physicsBody.angularVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.setBodyMass=function(e,t){e.physicsBody.mass=t,e.physicsBody.updateMassProperties()},t.prototype.sleepBody=function(e){e.physicsBody.sleep()},t.prototype.wakeUpBody=function(e){e.physicsBody.wakeUp()},t.prototype.updateDistanceJoint=function(e,t,i){e.physicsJoint.distance=t},t.prototype.enableMotor=function(e,t){t||e.physicsJoint.enableMotor()},t.prototype.disableMotor=function(e,t){t||e.physicsJoint.disableMotor()},t.prototype.setMotor=function(e,t,i,n){n||(e.physicsJoint.enableMotor(),e.physicsJoint.setMotorSpeed(t),i&&this.setLimit(e,i))},t.prototype.setLimit=function(e,t,i){e.physicsJoint.motorEquation.maxForce=t,e.physicsJoint.motorEquation.minForce=void 0===i?-t:i},t.prototype.dispose=function(){},t}();e.CannonJSPlugin=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.name="OimoJSPlugin",this._tmpImpostorsArray=[],this._tmpPositionVector=e.Vector3.Zero(),this.world=new OIMO.World(1/60,2,t,!0),this.world.clear(),this.world.isNoStat=!0}return t.prototype.setGravity=function(e){this.world.gravity.copy(e)},t.prototype.setTimeStep=function(e){this.world.timeStep=e},t.prototype.executeStep=function(e,t){var i=this;t.forEach(function(e){e.beforeStep()}),this.world.step(),t.forEach(function(e){e.afterStep(),i._tmpImpostorsArray[e.uniqueId]=e});for(var n=this.world.contacts;null!==n;)if(!n.touching||n.body1.sleeping||n.body2.sleeping){var r=this._tmpImpostorsArray[+n.body1.name],o=this._tmpImpostorsArray[+n.body2.name];r&&o?(r.onCollide({body:o.physicsBody}),o.onCollide({body:r.physicsBody}),n=n.next):n=n.next}else n=n.next},t.prototype.applyImpulse=function(e,t,i){var n=e.physicsBody.massInfo.mass;e.physicsBody.applyImpulse(i.scale(OIMO.INV_SCALE),t.scale(OIMO.INV_SCALE*n))},t.prototype.applyForce=function(t,i,n){e.Tools.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(t,i,n)},t.prototype.generatePhysicsBody=function(t){function i(e){e.getChildMeshes&&e.getChildMeshes().forEach(function(e){e.physicsImpostor&&(s.push(e.physicsImpostor),e.physicsImpostor._init())})}function n(t){return Math.max(t,e.PhysicsEngine.Epsilon)}var r=this;if(t.parent)return void(t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate()));if(t.isBodyInitRequired()){var o={name:t.uniqueId,config:[t.getParam("mass")||1,t.getParam("friction"),t.getParam("restitution")],size:[],type:[],pos:[],rot:[],move:0!==t.getParam("mass"),world:this.world},s=[t];i(t.object),s.forEach(function(i){var s=i.object.rotationQuaternion,a=(new OIMO.Euler).setFromQuaternion({x:t.object.rotationQuaternion.x,y:t.object.rotationQuaternion.y,z:t.object.rotationQuaternion.z,s:t.object.rotationQuaternion.w}),h=i.getObjectExtendSize();if(i===t){var l=t.getObjectCenter();t.object.position.subtractToRef(l,r._tmpPositionVector),o.pos.push(l.x),o.pos.push(l.y),o.pos.push(l.z),o.rot.push(a.x/(OIMO.degtorad||OIMO.TO_RAD)),o.rot.push(a.y/(OIMO.degtorad||OIMO.TO_RAD)),o.rot.push(a.z/(OIMO.degtorad||OIMO.TO_RAD))}else o.pos.push(i.object.position.x),o.pos.push(i.object.position.y),o.pos.push(i.object.position.z),o.rot.push(0),o.rot.push(0),o.rot.push(0);switch(i.type){case e.PhysicsImpostor.ParticleImpostor:e.Tools.Warn("No Particle support in Oimo.js. using SphereImpostor instead");case e.PhysicsImpostor.SphereImpostor:var c=h.x,u=h.y,d=h.z,f=Math.max(n(c),n(u),n(d))/2;o.type.push("sphere"),o.size.push(f),o.size.push(f),o.size.push(f);break;case e.PhysicsImpostor.CylinderImpostor:var p=n(h.x)/2,_=n(h.y);o.type.push("cylinder"),o.size.push(p),o.size.push(_),o.size.push(_);break;case e.PhysicsImpostor.PlaneImpostor:case e.PhysicsImpostor.BoxImpostor:default:var p=n(h.x),_=n(h.y),m=n(h.z);o.type.push("box"),o.size.push(p),o.size.push(_),o.size.push(m)}i.object.rotationQuaternion=s}),t.physicsBody=new OIMO.Body(o).body}else this._tmpPositionVector.copyFromFloats(0,0,0);t.setDeltaPosition(this._tmpPositionVector)},t.prototype.removePhysicsBody=function(e){this.world.removeRigidBody(e.physicsBody)},t.prototype.generateJoint=function(t){var i=t.mainImpostor.physicsBody,n=t.connectedImpostor.physicsBody;if(i&&n){var r,o=t.joint.jointData,s=o.nativeParams||{},a={body1:i,body2:n,axe1:s.axe1||(o.mainAxis?o.mainAxis.asArray():null),axe2:s.axe2||(o.connectedAxis?o.connectedAxis.asArray():null),pos1:s.pos1||(o.mainPivot?o.mainPivot.asArray():null),pos2:s.pos2||(o.connectedPivot?o.connectedPivot.asArray():null),min:s.min,max:s.max,collision:s.collision||o.collision,spring:s.spring,world:this.world};switch(t.joint.type){case e.PhysicsJoint.BallAndSocketJoint:r="jointBall";break;case e.PhysicsJoint.SpringJoint:e.Tools.Warn("Oimo.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var h=o;a.min=h.length||a.min,a.max=Math.max(a.min,a.max);case e.PhysicsJoint.DistanceJoint:r="jointDistance",a.max=o.maxDistance;break;case e.PhysicsJoint.PrismaticJoint:r="jointPrisme";break;case e.PhysicsJoint.SliderJoint:r="jointSlide";break;case e.PhysicsJoint.WheelJoint:r="jointWheel";break;case e.PhysicsJoint.HingeJoint:default:r="jointHinge"}a.type=r,t.joint.physicsJoint=new OIMO.Link(a).joint}},t.prototype.removeJoint=function(t){try{this.world.removeJoint(t.joint.physicsJoint)}catch(t){e.Tools.Warn(t)}},t.prototype.isSupported=function(){return void 0!==OIMO},t.prototype.setTransformationFromPhysicsBody=function(e){if(!e.physicsBody.sleeping){if(e.physicsBody.shapes.next){var t=this._getLastShape(e.physicsBody);e.object.position.x=t.position.x*OIMO.WORLD_SCALE,e.object.position.y=t.position.y*OIMO.WORLD_SCALE,e.object.position.z=t.position.z*OIMO.WORLD_SCALE}else e.object.position.copyFrom(e.physicsBody.getPosition());e.object.rotationQuaternion.copyFrom(e.physicsBody.getQuaternion()),e.object.rotationQuaternion.normalize()}},t.prototype.setPhysicsBodyTransformation=function(e,t,i){var n=e.physicsBody;n.position.init(t.x*OIMO.INV_SCALE,t.y*OIMO.INV_SCALE,t.z*OIMO.INV_SCALE),n.orientation.init(i.w,i.x,i.y,i.z),n.syncShapes(),n.awake()},t.prototype._getLastShape=function(e){for(var t=e.shapes;t.next;)t=t.next;return t},t.prototype.setLinearVelocity=function(e,t){e.physicsBody.linearVelocity.init(t.x,t.y,t.z)},t.prototype.setAngularVelocity=function(e,t){e.physicsBody.angularVelocity.init(t.x,t.y,t.z)},t.prototype.getLinearVelocity=function(t){var i=t.physicsBody.linearVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.getAngularVelocity=function(t){var i=t.physicsBody.angularVelocity;return i?new e.Vector3(i.x,i.y,i.z):null},t.prototype.setBodyMass=function(e,t){var i=0===t;e.physicsBody.shapes.density=i?1:t,e.physicsBody.setupMass(i?2:1)},t.prototype.sleepBody=function(e){e.physicsBody.sleep()},t.prototype.wakeUpBody=function(e){e.physicsBody.awake()},t.prototype.updateDistanceJoint=function(e,t,i){e.physicsJoint.limitMotoe.upperLimit=t,void 0!==i&&(e.physicsJoint.limitMotoe.lowerLimit=i)},t.prototype.setMotor=function(e,t,i,n){var r=n?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;r&&r.setMotor(t,i)},t.prototype.setLimit=function(e,t,i,n){var r=n?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;r&&r.setLimit(t,void 0===i?-t:i)},t.prototype.dispose=function(){this.world.clear()},t}();e.OimoJSPlugin=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n,r,o,s){e.call(this,t,"displayPass",["passSampler"],["passSampler"],i,n,r,o,s)}return __extends(t,e),t}(e.PostProcess);e.DisplayPassPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e,t,i){this.quality=e,this.distance=t,this.optimizeMesh=i}return e}();e.SimplificationSettings=t;var i=function(){function t(){this.running=!1,this._simplificationArray=[]}return t.prototype.addTask=function(e){this._simplificationArray.push(e)},t.prototype.executeNext=function(){var e=this._simplificationArray.pop();e?(this.running=!0,this.runSimplification(e)):this.running=!1},t.prototype.runSimplification=function(t){var i=this;if(t.parallelProcessing)t.settings.forEach(function(e){var n=i.getSimplifier(t);n.simplify(e,function(n){t.mesh.addLODLevel(e.distance,n),n.isVisible=!0,e.quality===t.settings[t.settings.length-1].quality&&t.successCallback&&t.successCallback(),i.executeNext()})});else{var n=this.getSimplifier(t),r=function(e,i){n.simplify(e,function(n){t.mesh.addLODLevel(e.distance,n),n.isVisible=!0,i()})};e.AsyncLoop.Run(t.settings.length,function(e){r(t.settings[e.index],function(){e.executeNext()})},function(){t.successCallback&&t.successCallback(),i.executeNext()})}},t.prototype.getSimplifier=function(e){switch(e.simplificationType){case n.QUADRATIC:default:return new h(e.mesh)}},t}();e.SimplificationQueue=i,function(e){e[e.QUADRATIC=0]="QUADRATIC"}(e.SimplificationType||(e.SimplificationType={}));var n=e.SimplificationType,r=function(){function e(e){this.vertices=e,this.error=new Array(4),this.deleted=!1,this.isDirty=!1,this.deletePending=!1,this.borderFactor=0}return e}();e.DecimationTriangle=r;var o=function(){function e(e,t){this.position=e,this.id=t,this.isBorder=!0,this.q=new s,this.triangleCount=0,this.triangleStart=0,this.originalOffsets=[]}return e.prototype.updatePosition=function(e){this.position.copyFrom(e)},e}();e.DecimationVertex=o;var s=function(){function e(e){this.data=new Array(10);for(var t=0;10>t;++t)e&&e[t]?this.data[t]=e[t]:this.data[t]=0}return e.prototype.det=function(e,t,i,n,r,o,s,a,h){var l=this.data[e]*this.data[r]*this.data[h]+this.data[i]*this.data[n]*this.data[a]+this.data[t]*this.data[o]*this.data[s]-this.data[i]*this.data[r]*this.data[s]-this.data[e]*this.data[o]*this.data[a]-this.data[t]*this.data[n]*this.data[h];return l},e.prototype.addInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e.data[t]},e.prototype.addArrayInPlace=function(e){for(var t=0;10>t;++t)this.data[t]+=e[t]},e.prototype.add=function(t){for(var i=new e,n=0;10>n;++n)i.data[n]=this.data[n]+t.data[n];return i},e.FromData=function(t,i,n,r){return new e(e.DataFromNumbers(t,i,n,r))},e.DataFromNumbers=function(e,t,i,n){return[e*e,e*t,e*i,e*n,t*t,t*i,t*n,i*i,i*n,n*n]},e}();e.QuadraticMatrix=s;var a=function(){function e(e,t){this.vertexId=e,this.triangleId=t}return e}();e.Reference=a;var h=function(){function t(t){this._mesh=t,this.initialized=!1,this.syncIterations=5e3,this.aggressiveness=7,this.decimationIterations=100,this.boundingBoxEpsilon=e.Epsilon}return t.prototype.simplify=function(t,i){var n=this;this.initDecimatedMesh(),e.AsyncLoop.Run(this._mesh.subMeshes.length,function(e){n.initWithMesh(e.index,function(){n.runDecimation(t,e.index,function(){e.executeNext()})},t.optimizeMesh)},function(){setTimeout(function(){i(n._reconstructedMesh)},0)})},t.prototype.isTriangleOnBoundingBox=function(e){var t=this,i=0;return e.vertices.forEach(function(e){var n=0,r=e.position,o=t._mesh.getBoundingInfo().boundingBox;(o.maximum.x-r.x<t.boundingBoxEpsilon||r.x-o.minimum.x>t.boundingBoxEpsilon)&&++n,o.maximum.y!==r.y&&r.y!==o.minimum.y||++n,o.maximum.z!==r.z&&r.z!==o.minimum.z||++n,n>1&&++i}),i>1&&console.log(e,i),i>1},t.prototype.runDecimation=function(t,i,n){var r=this,o=~~(this.triangles.length*t.quality),s=0,a=this.triangles.length,h=function(t,i){setTimeout(function(){t%5===0&&r.updateMesh(0===t);for(var n=0;n<r.triangles.length;++n)r.triangles[n].isDirty=!1;var h=1e-9*Math.pow(t+3,r.aggressiveness),l=function(t){var i=~~((r.triangles.length/2+t)%r.triangles.length),n=r.triangles[i];if(n&&!(n.error[3]>h||n.deleted||n.isDirty))for(var o=0;3>o;++o)if(n.error[o]<h){var a=[],l=[],c=n.vertices[o],u=n.vertices[(o+1)%3];if(c.isBorder||u.isBorder)continue;var d=e.Vector3.Zero(),f=e.Vector3.Zero(),p=e.Vector2.Zero(),_=new e.Color4(0,0,0,1);r.calculateError(c,u,d,f,p,_);var m=[];if(r.isFlipped(c,u,d,a,n.borderFactor,m))continue;if(r.isFlipped(u,c,d,l,n.borderFactor,m))continue;if(a.indexOf(!0)<0||l.indexOf(!0)<0)continue;var g=[];if(m.forEach(function(e){-1===g.indexOf(e)&&(e.deletePending=!0,g.push(e))}),g.length%2!==0)continue;c.q=u.q.add(c.q),c.updatePosition(d);var v=r.references.length;s=r.updateTriangles(c,c,a,s),s=r.updateTriangles(c,u,l,s);var y=r.references.length-v;if(y<=c.triangleCount){if(y)for(var b=0;y>b;b++)r.references[c.triangleStart+b]=r.references[v+b]}else c.triangleStart=v;c.triangleCount=y;break}};e.AsyncLoop.SyncAsyncForLoop(r.triangles.length,r.syncIterations,l,i,function(){return o>=a-s})},0)};e.AsyncLoop.Run(this.decimationIterations,function(e){o>=a-s?e.breakLoop():h(e.index,function(){e.executeNext()})},function(){setTimeout(function(){r.reconstructMesh(i),n()},0)})},t.prototype.initWithMesh=function(t,i,n){var s=this;this.vertices=[],this.triangles=[];var a=this._mesh.getVerticesData(e.VertexBuffer.PositionKind),h=this._mesh.getIndices(),l=this._mesh.subMeshes[t],c=function(e){if(n)for(var t=0;t<s.vertices.length;++t)if(s.vertices[t].position.equals(e))return s.vertices[t];return null},u=[],d=function(t){var i=t+l.verticesStart,n=e.Vector3.FromArray(a,3*i),r=c(n)||new o(n,s.vertices.length);r.originalOffsets.push(i),r.id===s.vertices.length&&s.vertices.push(r),u.push(r.id)},f=l.verticesCount;e.AsyncLoop.SyncAsyncForLoop(f,this.syncIterations/4>>0,d,function(){var t=function(e){var t=l.indexStart/3+e,i=3*t,n=h[i+0],o=h[i+1],a=h[i+2],c=s.vertices[u[n-l.verticesStart]],d=s.vertices[u[o-l.verticesStart]],f=s.vertices[u[a-l.verticesStart]],p=new r([c,d,f]);p.originalOffset=i,s.triangles.push(p)};e.AsyncLoop.SyncAsyncForLoop(l.indexCount/3,s.syncIterations,t,function(){s.init(i)})})},t.prototype.init=function(t){var i=this,n=function(t){var n=i.triangles[t];n.normal=e.Vector3.Cross(n.vertices[1].position.subtract(n.vertices[0].position),n.vertices[2].position.subtract(n.vertices[0].position)).normalize();for(var r=0;3>r;r++)n.vertices[r].q.addArrayInPlace(s.DataFromNumbers(n.normal.x,n.normal.y,n.normal.z,-e.Vector3.Dot(n.normal,n.vertices[0].position)))};e.AsyncLoop.SyncAsyncForLoop(this.triangles.length,this.syncIterations,n,function(){var n=function(e){for(var t=i.triangles[e],n=0;3>n;++n)t.error[n]=i.calculateError(t.vertices[n],t.vertices[(n+1)%3]);t.error[3]=Math.min(t.error[0],t.error[1],t.error[2])};e.AsyncLoop.SyncAsyncForLoop(i.triangles.length,i.syncIterations,n,function(){i.initialized=!0,t()})})},t.prototype.reconstructMesh=function(t){var i,n=[];for(i=0;i<this.vertices.length;++i)this.vertices[i].triangleCount=0;var r,o;for(i=0;i<this.triangles.length;++i)if(!this.triangles[i].deleted){for(r=this.triangles[i],o=0;3>o;++o)r.vertices[o].triangleCount=1;n.push(r)}var s=this._reconstructedMesh.getVerticesData(e.VertexBuffer.PositionKind)||[],a=this._reconstructedMesh.getVerticesData(e.VertexBuffer.NormalKind)||[],h=this._reconstructedMesh.getVerticesData(e.VertexBuffer.UVKind)||[],l=this._reconstructedMesh.getVerticesData(e.VertexBuffer.ColorKind)||[],c=this._mesh.getVerticesData(e.VertexBuffer.NormalKind),u=this._mesh.getVerticesData(e.VertexBuffer.UVKind),d=this._mesh.getVerticesData(e.VertexBuffer.ColorKind),f=0;for(i=0;i<this.vertices.length;++i){var p=this.vertices[i];p.id=f,p.triangleCount&&p.originalOffsets.forEach(function(e){s.push(p.position.x),s.push(p.position.y),s.push(p.position.z),a.push(c[3*e]),a.push(c[3*e+1]),a.push(c[3*e+2]),u&&u.length?(h.push(u[2*e]),h.push(u[2*e+1])):d&&d.length&&(l.push(d[4*e]),l.push(d[4*e+1]),l.push(d[4*e+2]),l.push(d[4*e+3])),++f})}var _=this._reconstructedMesh.getTotalIndices(),m=this._reconstructedMesh.getTotalVertices(),g=this._reconstructedMesh.subMeshes;this._reconstructedMesh.subMeshes=[];var v=this._reconstructedMesh.getIndices(),y=this._mesh.getIndices();for(i=0;i<n.length;++i)r=n[i],[0,1,2].forEach(function(e){var t=y[r.originalOffset+e],i=r.vertices[e].originalOffsets.indexOf(t);0>i&&(i=0),v.push(r.vertices[e].id+i+m)});this._reconstructedMesh.setIndices(v),this._reconstructedMesh.setVerticesData(e.VertexBuffer.PositionKind,s),this._reconstructedMesh.setVerticesData(e.VertexBuffer.NormalKind,a),h.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.UVKind,h),l.length>0&&this._reconstructedMesh.setVerticesData(e.VertexBuffer.ColorKind,l);var b=this._mesh.subMeshes[t];t>0&&(this._reconstructedMesh.subMeshes=[],g.forEach(function(t){new e.SubMesh(t.materialIndex,t.verticesStart,t.verticesCount,t.indexStart,t.indexCount,t.getMesh())}),new e.SubMesh(b.materialIndex,m,f,_,3*n.length,this._reconstructedMesh))},t.prototype.initDecimatedMesh=function(){this._reconstructedMesh=new e.Mesh(this._mesh.name+"Decimated",this._mesh.getScene()),this._reconstructedMesh.material=this._mesh.material,this._reconstructedMesh.parent=this._mesh.parent,this._reconstructedMesh.isVisible=!1,this._reconstructedMesh.renderingGroupId=this._mesh.renderingGroupId},t.prototype.isFlipped=function(t,i,n,r,o,s){for(var a=0;a<t.triangleCount;++a){var h=this.triangles[this.references[t.triangleStart+a].triangleId];if(!h.deleted){var l=this.references[t.triangleStart+a].vertexId,c=h.vertices[(l+1)%3],u=h.vertices[(l+2)%3];if(c!==i&&u!==i){var d=c.position.subtract(n);d=d.normalize();var f=u.position.subtract(n);if(f=f.normalize(),Math.abs(e.Vector3.Dot(d,f))>.999)return!0;var p=e.Vector3.Cross(d,f).normalize();if(r[a]=!1,e.Vector3.Dot(p,h.normal)<.2)return!0}else r[a]=!0,s.push(h)}}return!1},t.prototype.updateTriangles=function(e,t,i,n){for(var r=n,o=0;o<t.triangleCount;++o){var s=this.references[t.triangleStart+o],a=this.triangles[s.triangleId];a.deleted||(i[o]&&a.deletePending?(a.deleted=!0,r++):(a.vertices[s.vertexId]=e,a.isDirty=!0,a.error[0]=this.calculateError(a.vertices[0],a.vertices[1])+a.borderFactor/2,a.error[1]=this.calculateError(a.vertices[1],a.vertices[2])+a.borderFactor/2,a.error[2]=this.calculateError(a.vertices[2],a.vertices[0])+a.borderFactor/2,a.error[3]=Math.min(a.error[0],a.error[1],a.error[2]),this.references.push(s)))}return r},t.prototype.identifyBorder=function(){for(var e=0;e<this.vertices.length;++e){var t,i=[],n=[],r=this.vertices[e];for(t=0;t<r.triangleCount;++t)for(var o=this.triangles[this.references[r.triangleStart+t].triangleId],s=0;3>s;s++){for(var a=0,h=o.vertices[s];a<i.length&&n[a]!==h.id;)++a;a===i.length?(i.push(1),n.push(h.id)):i[a]++}for(t=0;t<i.length;++t)1===i[t]?this.vertices[n[t]].isBorder=!0:this.vertices[n[t]].isBorder=!1}},t.prototype.updateMesh=function(e){void 0===e&&(e=!1);var t;if(!e){var i=[];for(t=0;t<this.triangles.length;++t)this.triangles[t].deleted||i.push(this.triangles[t]);this.triangles=i}for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleCount=0,this.vertices[t].triangleStart=0;var n,r,o;for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],r=0;3>r;++r)o=n.vertices[r],o.triangleCount++;var s=0;for(t=0;t<this.vertices.length;++t)this.vertices[t].triangleStart=s,s+=this.vertices[t].triangleCount,this.vertices[t].triangleCount=0;var h=new Array(3*this.triangles.length);for(t=0;t<this.triangles.length;++t)for(n=this.triangles[t],r=0;3>r;++r)o=n.vertices[r],h[o.triangleStart+o.triangleCount]=new a(r,t),o.triangleCount++;this.references=h,e&&this.identifyBorder()},t.prototype.vertexError=function(e,t){var i=t.x,n=t.y,r=t.z;return e.data[0]*i*i+2*e.data[1]*i*n+2*e.data[2]*i*r+2*e.data[3]*i+e.data[4]*n*n+2*e.data[5]*n*r+2*e.data[6]*n+e.data[7]*r*r+2*e.data[8]*r+e.data[9]},t.prototype.calculateError=function(t,i,n,r,o,s){var a=t.q.add(i.q),h=t.isBorder&&i.isBorder,l=0,c=a.det(0,1,2,1,4,5,2,5,7);if(0===c||h){var u=t.position.add(i.position).divide(new e.Vector3(2,2,2)),d=this.vertexError(a,t.position),f=this.vertexError(a,i.position),p=this.vertexError(a,u);l=Math.min(d,f,p),l===d?n&&n.copyFrom(t.position):l===f?n&&n.copyFrom(i.position):n&&n.copyFrom(u)}else n||(n=e.Vector3.Zero()),n.x=-1/c*a.det(1,2,3,4,5,6,5,7,8),n.y=1/c*a.det(0,2,3,1,5,6,2,7,8),n.z=-1/c*a.det(0,1,3,1,4,6,2,5,8),l=this.vertexError(a,n);return l},t}();e.QuadraticErrorSimplification=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=[],i=function(i,n){if(!t[i.id]){if(i instanceof e.Geometry.Primitives.Box)n.boxes.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Sphere)n.spheres.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Cylinder)n.cylinders.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Torus)n.toruses.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Ground)n.grounds.push(i.serialize());else if(i instanceof e.Geometry.Primitives.Plane)n.planes.push(i.serialize());else if(i instanceof e.Geometry.Primitives.TorusKnot)n.torusKnots.push(i.serialize());else{if(i instanceof e.Geometry.Primitives._Primitive)throw new Error("Unknown primitive type");n.vertexData.push(i.serializeVerticeData())}t[i.id]=!0}},n=function(t,n){var r={};r.name=t.name,r.id=t.id,e.Tags.HasTags(t)&&(r.tags=e.Tags.GetTags(t)),r.position=t.position.asArray(),t.rotationQuaternion?r.rotationQuaternion=t.rotationQuaternion.asArray():t.rotation&&(r.rotation=t.rotation.asArray()),r.scaling=t.scaling.asArray(),r.localMatrix=t.getPivotMatrix().asArray(),r.isEnabled=t.isEnabled(),r.isVisible=t.isVisible,r.infiniteDistance=t.infiniteDistance,r.pickable=t.isPickable,r.receiveShadows=t.receiveShadows,r.billboardMode=t.billboardMode,r.visibility=t.visibility,r.checkCollisions=t.checkCollisions,t.parent&&(r.parentId=t.parent.id);var o=t._geometry;if(o){var s=o.id;r.geometryId=s,t.getScene().getGeometryByID(s)||i(o,n.geometries),r.subMeshes=[];for(var a=0;a<t.subMeshes.length;a++){var h=t.subMeshes[a];r.subMeshes.push({materialIndex:h.materialIndex,verticesStart:h.verticesStart,verticesCount:h.verticesCount,indexStart:h.indexStart,indexCount:h.indexCount})}}t.material?r.materialId=t.material.id:t.material=null,t.skeleton&&(r.skeletonId=t.skeleton.id),t.getPhysicsImpostor()&&(r.physicsMass=t.getPhysicsMass(),r.physicsFriction=t.getPhysicsFriction(),r.physicsRestitution=t.getPhysicsRestitution(),r.physicsImpostor=t.getPhysicsImpostor().type),r.instances=[];for(var l=0;l<t.instances.length;l++){var c=t.instances[l],u={name:c.name,position:c.position.asArray(),scaling:c.scaling.asArray()};c.rotationQuaternion?u.rotationQuaternion=c.rotationQuaternion.asArray():c.rotation&&(u.rotation=c.rotation.asArray()),r.instances.push(u),e.Animation.AppendSerializedAnimations(c,u),u.ranges=c.serializeAnimationRanges()}return e.Animation.AppendSerializedAnimations(t,r),r.ranges=t.serializeAnimationRanges(),r.layerMask=t.layerMask,t.actionManager&&(r.actions=t.actionManager.serialize(t.name)),r},r=function(t,r){if(t.delayLoadState===e.Engine.DELAYLOADSTATE_LOADED||t.delayLoadState===e.Engine.DELAYLOADSTATE_NONE){t.material&&(t.material instanceof e.StandardMaterial?(r.materials=r.materials||[],r.materials.some(function(e){return e.id===t.material.id})||r.materials.push(t.material.serialize())):t.material instanceof e.MultiMaterial&&(r.multiMaterials=r.multiMaterials||[],r.multiMaterials.some(function(e){return e.id===t.material.id})||r.multiMaterials.push(t.material.serialize())));var o=t._geometry;o&&(r.geometries||(r.geometries={},r.geometries.boxes=[],r.geometries.spheres=[],r.geometries.cylinders=[],r.geometries.toruses=[],r.geometries.grounds=[],r.geometries.planes=[],r.geometries.torusKnots=[],r.geometries.vertexData=[]),i(o,r.geometries)),t.skeleton&&(r.skeletons=r.skeletons||[],r.skeletons.push(t.skeleton.serialize())),r.meshes=r.meshes||[],r.meshes.push(n(t,r))}},o=function(){function o(){}return o.ClearCache=function(){t=[]},o.Serialize=function(r){var o={};o.useDelayedTextureLoading=r.useDelayedTextureLoading,o.autoClear=r.autoClear,o.clearColor=r.clearColor.asArray(),o.ambientColor=r.ambientColor.asArray(),o.gravity=r.gravity.asArray(),o.collisionsEnabled=r.collisionsEnabled,o.workerCollisions=r.workerCollisions,r.fogMode&&0!==r.fogMode&&(o.fogMode=r.fogMode,o.fogColor=r.fogColor.asArray(),o.fogStart=r.fogStart,o.fogEnd=r.fogEnd,o.fogDensity=r.fogDensity),r.isPhysicsEnabled()&&(o.physicsEnabled=!0,o.physicsGravity=r.getPhysicsEngine().gravity.asArray(),o.physicsEngine=r.getPhysicsEngine().getPhysicsPluginName()),o.lights=[];var s,a;for(s=0;s<r.lights.length;s++)a=r.lights[s],o.lights.push(a.serialize());for(o.cameras=[],s=0;s<r.cameras.length;s++){var h=r.cameras[s];o.cameras.push(h.serialize())}r.activeCamera&&(o.activeCameraID=r.activeCamera.id),e.Animation.AppendSerializedAnimations(r,o),o.materials=[],o.multiMaterials=[];var l;for(s=0;s<r.materials.length;s++)l=r.materials[s],o.materials.push(l.serialize());for(o.multiMaterials=[],s=0;s<r.multiMaterials.length;s++){var c=r.multiMaterials[s];o.multiMaterials.push(c.serialize())}for(o.skeletons=[],s=0;s<r.skeletons.length;s++)o.skeletons.push(r.skeletons[s].serialize());o.geometries={},o.geometries.boxes=[],o.geometries.spheres=[],o.geometries.cylinders=[],o.geometries.toruses=[],o.geometries.grounds=[],o.geometries.planes=[],o.geometries.torusKnots=[],o.geometries.vertexData=[],t=[];var u=r.getGeometries();for(s=0;s<u.length;s++){var d=u[s];d.isReady()&&i(d,o.geometries)}for(o.meshes=[],s=0;s<r.meshes.length;s++){var f=r.meshes[s];if(f instanceof e.Mesh){var p=f;p.delayLoadState!==e.Engine.DELAYLOADSTATE_LOADED&&p.delayLoadState!==e.Engine.DELAYLOADSTATE_NONE||o.meshes.push(n(p,o))}}for(o.particleSystems=[],s=0;s<r.particleSystems.length;s++)o.particleSystems.push(r.particleSystems[s].serialize());for(o.lensFlareSystems=[],s=0;s<r.lensFlareSystems.length;s++)o.lensFlareSystems.push(r.lensFlareSystems[s].serialize());for(o.shadowGenerators=[],s=0;s<r.lights.length;s++)a=r.lights[s],a.getShadowGenerator()&&o.shadowGenerators.push(a.getShadowGenerator().serialize());return r.actionManager&&(o.actions=r.actionManager.serialize("scene")),o},o.SerializeMesh=function(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var o={};if(t=t instanceof Array?t:[t],i||n)for(var s=0;s<t.length;++s)n&&t[s].getDescendants().forEach(function(i){i instanceof e.Mesh&&t.indexOf(i)<0&&t.push(i)}),i&&t[s].parent&&t.indexOf(t[s].parent)<0&&t.push(t[s].parent);return t.forEach(function(e){r(e,o)}),o},o}();e.SceneSerializer=o}(BABYLON||(BABYLON={}));var Earcut;!function(e){function t(e,t,n){n=n||2;var o=t&&t.length,s=o?t[0]*n:e.length,a=i(e,0,s,n,!0),h=[];if(!a)return h;var c,u,d,f,p,_,m;if(o&&(a=l(e,t,a,n)),e.length>80*n){c=d=e[0],u=f=e[1];for(var g=n;s>g;g+=n)p=e[g],_=e[g+1],c>p&&(c=p),u>_&&(u=_),p>d&&(d=p),_>f&&(f=_);m=Math.max(d-c,f-u)}return r(a,h,n,c,u,m,void 0),h}function i(e,t,i,n,r){var o,s;if(r===w(e,t,i,n)>0)for(o=t;i>o;o+=n)s=T(o,e[o],e[o+1],s);else for(o=i-n;o>=t;o-=n)s=T(o,e[o],e[o+1],s);return s&&b(s,s.next)&&(S(s),s=s.next),s}function n(e,t){if(!e)return e;t||(t=e);var i,n=e;do if(i=!1,n.steiner||!b(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{if(S(n),n=t=n.prev,n===n.next)return null;i=!0}while(i||n!==t);return t}function r(e,t,i,l,c,u,d){if(e){!d&&u&&f(e,l,c,u);for(var p,_,m=e;e.prev!==e.next;)if(p=e.prev,_=e.next,u?s(e,l,c,u):o(e))t.push(p.i/i),t.push(e.i/i),t.push(_.i/i),S(e),e=_.next,m=_.next;else if(e=_,e===m){d?1===d?(e=a(e,t,i),r(e,t,i,l,c,u,2)):2===d&&h(e,t,i,l,c,u):r(n(e,void 0),t,i,l,c,u,1);break}}}function o(e){var t=e.prev,i=e,n=e.next;if(y(t,i,n)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(g(t.x,t.y,i.x,i.y,n.x,n.y,r.x,r.y)&&y(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function s(e,t,i,n){var r=e.prev,o=e,s=e.next;if(y(r,o,s)>=0)return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,h=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,l=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,c=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,u=_(a,h,t,i,n),d=_(l,c,t,i,n),f=e.nextZ;f&&f.z<=d;){
if(f!==e.prev&&f!==e.next&&g(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=e.prevZ;f&&f.z>=u;){if(f!==e.prev&&f!==e.next&&g(r.x,r.y,o.x,o.y,s.x,s.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function a(e,t,i){var n=e;do{var r=n.prev,o=n.next.next;!b(r,o)&&x(r,n,n.next,o)&&A(r,o)&&A(o,r)&&(t.push(r.i/i),t.push(n.i/i),t.push(o.i/i),S(n),S(n.next),n=e=o),n=n.next}while(n!==e);return n}function h(e,t,i,o,s,a){var h=e;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&v(h,l)){var c=E(h,l);return h=n(h,h.next),c=n(c,c.next),r(h,t,i,o,s,a,void 0),void r(c,t,i,o,s,a,void 0)}l=l.next}h=h.next}while(h!==e)}function l(e,t,r,o){var s,a,h,l,d,f=[];for(s=0,a=t.length;a>s;s++)h=t[s]*o,l=a-1>s?t[s+1]*o:e.length,d=i(e,h,l,o,!1),d===d.next&&(d.steiner=!0),f.push(m(d));for(f.sort(c),s=0;s<f.length;s++)u(f[s],r),r=n(r,r.next);return r}function c(e,t){return e.x-t.x}function u(e,t){if(t=d(e,t)){var i=E(t,e);n(i,i.next)}}function d(e,t){var i,n=t,r=e.x,o=e.y,s=-(1/0);do{if(o<=n.y&&o>=n.next.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(r>=a&&a>s){if(s=a,a===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!i)return null;if(r===s)return i.prev;var h,l=i,c=i.x,u=i.y,d=1/0;for(n=i.next;n!==l;)r>=n.x&&n.x>=c&&g(u>o?r:s,o,c,u,u>o?s:r,o,n.x,n.y)&&(h=Math.abs(o-n.y)/(r-n.x),(d>h||h===d&&n.x>i.x)&&A(n,e)&&(i=n,d=h)),n=n.next;return i}function f(e,t,i,n){var r=e;do null===r.z&&(r.z=_(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,p(r)}function p(e){var t,i,n,r,o,s,a,h,l=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,n=i,a=0,t=0;l>t&&(a++,n=n.nextZ);t++);for(h=l;a>0||h>0&&n;)0===a?(r=n,n=n.nextZ,h--):0!==h&&n?i.z<=n.z?(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,h--):(r=i,i=i.nextZ,a--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;i=n}o.nextZ=null,l*=2}while(s>1);return e}function _(e,t,i,n,r){return e=32767*(e-i)/r,t=32767*(t-n)/r,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function m(e){var t=e,i=e;do t.x<i.x&&(i=t),t=t.next;while(t!==e);return i}function g(e,t,i,n,r,o,s,a){return(r-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(r-s)*(n-a)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!P(e,t)&&A(e,t)&&A(t,e)&&C(e,t)}function y(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function b(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,i,n){return!!(b(e,t)&&b(i,n)||b(e,n)&&b(i,t))||y(e,t,i)>0!=y(e,t,n)>0&&y(i,n,e)>0!=y(i,n,t)>0}function P(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&x(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function A(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function C(e,t){var i=e,n=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do i.y>o!=i.next.y>o&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==e);return n}function E(e,t){var i=new M(e.i,e.x,e.y),n=new M(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function T(e,t,i,n){var r=new M(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function M(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,i,n){var r=t&&t.length,o=r?t[0]*i:e.length,s=Math.abs(w(e,0,o,i));if(r)for(var a=0,h=t.length;h>a;a++){var l=t[a]*i,c=h-1>a?t[a+1]*i:e.length;s-=Math.abs(w(e,l,c,i))}var u=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;u+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)}function w(e,t,i,n){for(var r=0,o=t,s=i-n;i>o;o+=n)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}function R(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},n=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;t>s;s++)i.vertices.push(e[r][o][s]);r>0&&(n+=e[r-1].length,i.holes.push(n))}return i}e.earcut=t,e.deviation=I,e.flatten=R}(Earcut||(Earcut={}));var BABYLON;!function(e){var t=0,i=function(){function t(e,t,i){this.pos=e,this.normal=t,this.uv=i}return t.prototype.clone=function(){return new t(this.pos.clone(),this.normal.clone(),this.uv.clone())},t.prototype.flip=function(){this.normal=this.normal.scale(-1)},t.prototype.interpolate=function(i,n){return new t(e.Vector3.Lerp(this.pos,i.pos,n),e.Vector3.Lerp(this.normal,i.normal,n),e.Vector2.Lerp(this.uv,i.uv,n))},t}(),n=function(){function t(e,t){this.normal=e,this.w=t}return t.FromPoints=function(i,n,r){var o=r.subtract(i),s=n.subtract(i);if(0===o.lengthSquared()||0===s.lengthSquared())return null;var a=e.Vector3.Normalize(e.Vector3.Cross(o,s));return new t(a,e.Vector3.Dot(a,i))},t.prototype.clone=function(){return new t(this.normal.clone(),this.w)},t.prototype.flip=function(){this.normal.scaleInPlace(-1),this.w=-this.w},t.prototype.splitPolygon=function(i,n,o,s,a){var h,l,c=0,u=1,d=2,f=3,p=0,_=[];for(h=0;h<i.vertices.length;h++){l=e.Vector3.Dot(this.normal,i.vertices[h].pos)-this.w;var m=l<-t.EPSILON?d:l>t.EPSILON?u:c;p|=m,_.push(m)}switch(p){case c:(e.Vector3.Dot(this.normal,i.plane.normal)>0?n:o).push(i);break;case u:s.push(i);break;case d:a.push(i);break;case f:var g=[],v=[];for(h=0;h<i.vertices.length;h++){var y=(h+1)%i.vertices.length,b=_[h],x=_[y],P=i.vertices[h],A=i.vertices[y];if(b!==d&&g.push(P),b!==u&&v.push(b!==d?P.clone():P),(b|x)===f){l=(this.w-e.Vector3.Dot(this.normal,P.pos))/e.Vector3.Dot(this.normal,A.pos.subtract(P.pos));var C=P.interpolate(A,l);g.push(C),v.push(C.clone())}}var E;g.length>=3&&(E=new r(g,i.shared),E.plane&&s.push(E)),v.length>=3&&(E=new r(v,i.shared),E.plane&&a.push(E))}},t.EPSILON=1e-5,t}(),r=function(){function e(e,t){this.vertices=e,this.shared=t,this.plane=n.FromPoints(e[0].pos,e[1].pos,e[2].pos)}return e.prototype.clone=function(){var t=this.vertices.map(function(e){return e.clone()});return new e(t,this.shared)},e.prototype.flip=function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},e}(),o=function(){function e(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}return e.prototype.clone=function(){var t=new e;return t.plane=this.plane&&this.plane.clone(),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t},e.prototype.invert=function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},e.prototype.clipPolygons=function(e){if(!this.plane)return e.slice();for(var t=[],i=[],n=0;n<e.length;n++)this.plane.splitPolygon(e[n],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)},e.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.prototype.build=function(t){if(t.length){this.plane||(this.plane=t[0].plane.clone());for(var i=[],n=[],r=0;r<t.length;r++)this.plane.splitPolygon(t[r],this.polygons,this.polygons,i,n);i.length&&(this.front||(this.front=new e),this.front.build(i)),n.length&&(this.back||(this.back=new e),this.back.build(n))}},e}(),s=function(){function n(){this.polygons=new Array}return n.FromMesh=function(o){var s,a,h,l,c,u,d,f,p,_,m,g=new Array;if(!(o instanceof e.Mesh))throw"BABYLON.CSG: Wrong Mesh type, must be BABYLON.Mesh";o.computeWorldMatrix(!0),d=o.getWorldMatrix(),f=o.position.clone(),p=o.rotation.clone(),o.rotationQuaternion&&(_=o.rotationQuaternion.clone()),m=o.scaling.clone();for(var v=o.getIndices(),y=o.getVerticesData(e.VertexBuffer.PositionKind),b=o.getVerticesData(e.VertexBuffer.NormalKind),x=o.getVerticesData(e.VertexBuffer.UVKind),P=o.subMeshes,A=0,C=P.length;C>A;A++)for(var E=P[A].indexStart,T=P[A].indexCount+P[A].indexStart;T>E;E+=3){u=[];for(var S=0;3>S;S++){var M=new e.Vector3(b[3*v[E+S]],b[3*v[E+S]+1],b[3*v[E+S]+2]);h=new e.Vector2(x[2*v[E+S]],x[2*v[E+S]+1]);var I=new e.Vector3(y[3*v[E+S]],y[3*v[E+S]+1],y[3*v[E+S]+2]);l=e.Vector3.TransformCoordinates(I,d),a=e.Vector3.TransformNormal(M,d),s=new i(l,a,h),u.push(s)}c=new r(u,{subMeshId:A,meshId:t,materialIndex:P[A].materialIndex}),c.plane&&g.push(c)}var w=n.FromPolygons(g);return w.matrix=d,w.position=f,w.rotation=p,w.scaling=m,w.rotationQuaternion=_,t++,w},n.FromPolygons=function(e){var t=new n;return t.polygons=e,t},n.prototype.clone=function(){var e=new n;return e.polygons=this.polygons.map(function(e){return e.clone()}),e.copyTransformAttributes(this),e},n.prototype.toPolygons=function(){return this.polygons},n.prototype.union=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.unionInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),this.polygons=t.allPolygons()},n.prototype.subtract=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.subtractInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},n.prototype.intersect=function(e){var t=new o(this.clone().polygons),i=new o(e.clone().polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),n.FromPolygons(t.allPolygons()).copyTransformAttributes(this)},n.prototype.intersectInPlace=function(e){var t=new o(this.polygons),i=new o(e.polygons);t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),this.polygons=t.allPolygons()},n.prototype.inverse=function(){var e=this.clone();return e.inverseInPlace(),e},n.prototype.inverseInPlace=function(){this.polygons.map(function(e){e.flip()})},n.prototype.copyTransformAttributes=function(e){return this.matrix=e.matrix,this.position=e.position,this.rotation=e.rotation,this.scaling=e.scaling,this.rotationQuaternion=e.rotationQuaternion,this},n.prototype.buildMeshGeometry=function(t,i,n){var r=this.matrix.clone();r.invert();var o,s,a,h=new e.Mesh(t,i),l=[],c=[],u=[],d=[],f=e.Vector3.Zero(),p=e.Vector3.Zero(),_=e.Vector2.Zero(),m=this.polygons,g=[0,0,0],v={},y=0,b={};n&&m.sort(function(e,t){return e.shared.meshId===t.shared.meshId?e.shared.subMeshId-t.shared.subMeshId:e.shared.meshId-t.shared.meshId});for(var x=0,P=m.length;P>x;x++){o=m[x],b[o.shared.meshId]||(b[o.shared.meshId]={}),b[o.shared.meshId][o.shared.subMeshId]||(b[o.shared.meshId][o.shared.subMeshId]={indexStart:+(1/0),indexEnd:-(1/0),materialIndex:o.shared.materialIndex}),a=b[o.shared.meshId][o.shared.subMeshId];for(var A=2,C=o.vertices.length;C>A;A++){g[0]=0,g[1]=A-1,g[2]=A;for(var E=0;3>E;E++){f.copyFrom(o.vertices[g[E]].pos),p.copyFrom(o.vertices[g[E]].normal),_.copyFrom(o.vertices[g[E]].uv);var T=e.Vector3.TransformCoordinates(f,r),S=e.Vector3.TransformNormal(p,r);s=v[T.x+","+T.y+","+T.z],"undefined"!=typeof s&&u[3*s]===S.x&&u[3*s+1]===S.y&&u[3*s+2]===S.z&&d[2*s]===_.x&&d[2*s+1]===_.y||(l.push(T.x,T.y,T.z),d.push(_.x,_.y),u.push(p.x,p.y,p.z),s=v[T.x+","+T.y+","+T.z]=l.length/3-1),c.push(s),a.indexStart=Math.min(y,a.indexStart),a.indexEnd=Math.max(y,a.indexEnd),y++}}}if(h.setVerticesData(e.VertexBuffer.PositionKind,l),h.setVerticesData(e.VertexBuffer.NormalKind,u),h.setVerticesData(e.VertexBuffer.UVKind,d),h.setIndices(c),n){var M,I=0;h.subMeshes=new Array;for(var w in b){M=-1;for(var R in b[w])a=b[w][R],e.SubMesh.CreateFromIndices(a.materialIndex+I,a.indexStart,a.indexEnd-a.indexStart+1,h),M=Math.max(a.materialIndex,M);I+=++M}}return h},n.prototype.toMesh=function(e,t,i,n){var r=this.buildMeshGeometry(e,i,n);return r.material=t,r.position.copyFrom(this.position),r.rotation.copyFrom(this.rotation),this.rotationQuaternion&&(r.rotationQuaternion=this.rotationQuaternion.clone()),r.scaling.copyFrom(this.scaling),r.computeWorldMatrix(!0),r},n}();e.CSG=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){var s=this;t.call(this,i,"vrDistortionCorrection",["LensCenter","Scale","ScaleIn","HmdWarpParam"],null,o.postProcessScaleFactor,n,e.Texture.BILINEAR_SAMPLINGMODE,null,null),this._isRightEye=r,this._distortionFactors=o.distortionK,this._postProcessScaleFactor=o.postProcessScaleFactor,this._lensCenterOffset=o.lensCenterOffset,this.onSizeChangedObservable.add(function(){s.aspectRatio=.5*s.width/s.height,s._scaleIn=new e.Vector2(2,2/s.aspectRatio),s._scaleFactor=new e.Vector2(.5*(1/s._postProcessScaleFactor),.5*(1/s._postProcessScaleFactor)*s.aspectRatio),s._lensCenter=new e.Vector2(s._isRightEye?.5-.5*s._lensCenterOffset:.5+.5*s._lensCenterOffset,.5)}),this.onApplyObservable.add(function(e){e.setFloat2("LensCenter",s._lensCenter.x,s._lensCenter.y),e.setFloat2("Scale",s._scaleFactor.x,s._scaleFactor.y),e.setFloat2("ScaleIn",s._scaleIn.x,s._scaleIn.y),e.setFloat4("HmdWarpParam",s._distortionFactors[0],s._distortionFactors[1],s._distortionFactors[2],s._distortionFactors[3])})}return __extends(i,t),i}(e.PostProcess);e.VRDistortionCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(e.JoystickAxis||(e.JoystickAxis={}));var t=e.JoystickAxis,i=function(){function i(n){var r=this;n?this._leftJoystick=!0:this._leftJoystick=!1,this._joystickIndex=i._globalJoystickIndex,i._globalJoystickIndex++,this._axisTargetedByLeftAndRight=t.X,this._axisTargetedByUpAndDown=t.Y,this.reverseLeftRight=!1,this.reverseUpDown=!1,this._touches=new e.StringDictionary,this.deltaPosition=e.Vector3.Zero(),this._joystickSensibility=25,this._inversedSensibility=1/(this._joystickSensibility/1e3),this._rotationSpeed=25,this._inverseRotationSpeed=1/(this._rotationSpeed/1e3),this._rotateOnAxisRelativeToMesh=!1,this._onResize=function(e){i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.vjCanvas.width=i.vjCanvasWidth,i.vjCanvas.height=i.vjCanvasHeight,i.halfWidth=i.vjCanvasWidth/2,i.halfHeight=i.vjCanvasHeight/2},i.vjCanvas||(window.addEventListener("resize",this._onResize,!1),i.vjCanvas=document.createElement("canvas"),i.vjCanvasWidth=window.innerWidth,i.vjCanvasHeight=window.innerHeight,i.vjCanvas.width=window.innerWidth,i.vjCanvas.height=window.innerHeight,i.vjCanvas.style.width="100%",i.vjCanvas.style.height="100%",i.vjCanvas.style.position="absolute",i.vjCanvas.style.backgroundColor="transparent",i.vjCanvas.style.top="0px",i.vjCanvas.style.left="0px",i.vjCanvas.style.zIndex="5",i.vjCanvas.style.msTouchAction="none",i.vjCanvas.setAttribute("touch-action","none"),i.vjCanvasContext=i.vjCanvas.getContext("2d"),i.vjCanvasContext.strokeStyle="#ffffff",i.vjCanvasContext.lineWidth=2,document.body.appendChild(i.vjCanvas)),i.halfWidth=i.vjCanvas.width/2,i.halfHeight=i.vjCanvas.height/2,this.pressed=!1,this._joystickColor="cyan",this._joystickPointerID=-1,this._joystickPointerPos=new e.Vector2(0,0),this._joystickPreviousPointerPos=new e.Vector2(0,0),this._joystickPointerStartPos=new e.Vector2(0,0),this._deltaJoystickVector=new e.Vector2(0,0),this._onPointerDownHandlerRef=function(e){r._onPointerDown(e)},this._onPointerMoveHandlerRef=function(e){r._onPointerMove(e)},this._onPointerOutHandlerRef=function(e){r._onPointerUp(e)},this._onPointerUpHandlerRef=function(e){r._onPointerUp(e)},i.vjCanvas.addEventListener("pointerdown",this._onPointerDownHandlerRef,!1),i.vjCanvas.addEventListener("pointermove",this._onPointerMoveHandlerRef,!1),i.vjCanvas.addEventListener("pointerup",this._onPointerUpHandlerRef,!1),i.vjCanvas.addEventListener("pointerout",this._onPointerUpHandlerRef,!1),i.vjCanvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),requestAnimationFrame(function(){r._drawVirtualJoystick()})}return i.prototype.setJoystickSensibility=function(e){this._joystickSensibility=e,this._inversedSensibility=1/(this._joystickSensibility/1e3)},i.prototype._onPointerDown=function(e){var t;e.preventDefault(),t=this._leftJoystick===!0?e.clientX<i.halfWidth:e.clientX>i.halfWidth,t&&this._joystickPointerID<0?(this._joystickPointerID=e.pointerId,this._joystickPointerStartPos.x=e.clientX,this._joystickPointerStartPos.y=e.clientY,this._joystickPointerPos=this._joystickPointerStartPos.clone(),this._joystickPreviousPointerPos=this._joystickPointerStartPos.clone(),this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this.pressed=!0,this._touches.add(e.pointerId.toString(),e)):i._globalJoystickIndex<2&&this._action&&(this._action(),this._touches.add(e.pointerId.toString(),{x:e.clientX,y:e.clientY,prevX:e.clientX,prevY:e.clientY}))},i.prototype._onPointerMove=function(e){if(this._joystickPointerID==e.pointerId){this._joystickPointerPos.x=e.clientX,this._joystickPointerPos.y=e.clientY,this._deltaJoystickVector=this._joystickPointerPos.clone(),this._deltaJoystickVector=this._deltaJoystickVector.subtract(this._joystickPointerStartPos);var i=this.reverseLeftRight?-1:1,n=i*this._deltaJoystickVector.x/this._inversedSensibility;switch(this._axisTargetedByLeftAndRight){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,n));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,n));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,n))}var r=this.reverseUpDown?1:-1,o=r*this._deltaJoystickVector.y/this._inversedSensibility;switch(this._axisTargetedByUpAndDown){case t.X:this.deltaPosition.x=Math.min(1,Math.max(-1,o));break;case t.Y:this.deltaPosition.y=Math.min(1,Math.max(-1,o));break;case t.Z:this.deltaPosition.z=Math.min(1,Math.max(-1,o))}}else{var s=this._touches.get(e.pointerId.toString());s&&(s.x=e.clientX,s.y=e.clientY)}},i.prototype._onPointerUp=function(e){if(this._joystickPointerID==e.pointerId)i.vjCanvasContext.clearRect(this._joystickPointerStartPos.x-63,this._joystickPointerStartPos.y-63,126,126),i.vjCanvasContext.clearRect(this._joystickPreviousPointerPos.x-41,this._joystickPreviousPointerPos.y-41,82,82),this._joystickPointerID=-1,this.pressed=!1;else{var t=this._touches.get(e.pointerId.toString());t&&i.vjCanvasContext.clearRect(t.prevX-43,t.prevY-43,86,86)}this._deltaJoystickVector.x=0,this._deltaJoystickVector.y=0,this._touches.remove(e.pointerId.toString())},i.prototype.setJoystickColor=function(e){this._joystickColor=e},i.prototype.setActionOnTouch=function(e){this._action=e},i.prototype.setAxisForLeftRight=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByLeftAndRight=e;break;default:this._axisTargetedByLeftAndRight=t.X}},i.prototype.setAxisForUpDown=function(e){switch(e){case t.X:case t.Y:case t.Z:this._axisTargetedByUpAndDown=e;break;default:this._axisTargetedByUpAndDown=t.Y}},i.prototype._clearCanvas=function(){this._leftJoystick?i.vjCanvasContext.clearRect(0,0,i.vjCanvasWidth/2,i.vjCanvasHeight):i.vjCanvasContext.clearRect(i.vjCanvasWidth/2,0,i.vjCanvasWidth,i.vjCanvasHeight)},i.prototype._drawVirtualJoystick=function(){var e=this;this.pressed&&this._touches.forEach(function(t){t.pointerId===e._joystickPointerID?(i.vjCanvasContext.clearRect(e._joystickPointerStartPos.x-63,e._joystickPointerStartPos.y-63,126,126),i.vjCanvasContext.clearRect(e._joystickPreviousPointerPos.x-41,e._joystickPreviousPointerPos.y-41,82,82),i.vjCanvasContext.beginPath(),i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.lineWidth=2,i.vjCanvasContext.arc(e._joystickPointerStartPos.x,e._joystickPointerStartPos.y,60,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle=e._joystickColor,i.vjCanvasContext.arc(e._joystickPointerPos.x,e._joystickPointerPos.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),e._joystickPreviousPointerPos=e._joystickPointerPos.clone()):(i.vjCanvasContext.clearRect(t.prevX-43,t.prevY-43,86,86),i.vjCanvasContext.beginPath(),i.vjCanvasContext.fillStyle="white",i.vjCanvasContext.beginPath(),i.vjCanvasContext.strokeStyle="red",i.vjCanvasContext.lineWidth=6,i.vjCanvasContext.arc(t.x,t.y,40,0,2*Math.PI,!0),i.vjCanvasContext.stroke(),i.vjCanvasContext.closePath(),t.prevX=t.x,t.prevY=t.y)}),requestAnimationFrame(function(){e._drawVirtualJoystick()})},i.prototype.releaseCanvas=function(){i.vjCanvas&&(i.vjCanvas.removeEventListener("pointerdown",this._onPointerDownHandlerRef),i.vjCanvas.removeEventListener("pointermove",this._onPointerMoveHandlerRef),i.vjCanvas.removeEventListener("pointerup",this._onPointerUpHandlerRef),i.vjCanvas.removeEventListener("pointerout",this._onPointerUpHandlerRef),window.removeEventListener("resize",this._onResize),document.body.removeChild(i.vjCanvas),i.vjCanvas=null)},i._globalJoystickIndex=0,i}();e.VirtualJoystick=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.inputs.addVirtualJoystick()}return __extends(t,e),t}(e.FreeCamera);e.VirtualJoysticksCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){}return t.prototype.getLeftJoystick=function(){return this._leftjoystick},t.prototype.getRightJoystick=function(){return this._rightjoystick},t.prototype.checkInputs=function(){if(this._leftjoystick){var t=this.camera,i=50*t._computeLocalCameraSpeed(),n=e.Matrix.RotationYawPitchRoll(t.rotation.y,t.rotation.x,0),r=e.Vector3.TransformCoordinates(new e.Vector3(this._leftjoystick.deltaPosition.x*i,this._leftjoystick.deltaPosition.y*i,this._leftjoystick.deltaPosition.z*i),n);t.cameraDirection=t.cameraDirection.add(r),t.cameraRotation=t.cameraRotation.addVector3(this._rightjoystick.deltaPosition),this._leftjoystick.pressed||(this._leftjoystick.deltaPosition=this._leftjoystick.deltaPosition.scale(.9)),this._rightjoystick.pressed||(this._rightjoystick.deltaPosition=this._rightjoystick.deltaPosition.scale(.9))}},t.prototype.attachControl=function(t,i){this._leftjoystick=new e.VirtualJoystick(!0),this._leftjoystick.setAxisForUpDown(e.JoystickAxis.Z),this._leftjoystick.setAxisForLeftRight(e.JoystickAxis.X),this._leftjoystick.setJoystickSensibility(.15),this._rightjoystick=new e.VirtualJoystick(!1),this._rightjoystick.setAxisForUpDown(e.JoystickAxis.X),this._rightjoystick.setAxisForLeftRight(e.JoystickAxis.Y),this._rightjoystick.reverseUpDown=!0,this._rightjoystick.setJoystickSensibility(.05),this._rightjoystick.setJoystickColor("yellow")},t.prototype.detachControl=function(e){this._leftjoystick.releaseCanvas(),this._rightjoystick.releaseCanvas()},t.prototype.getTypeName=function(){return"FreeCameraVirtualJoystickInput"},t.prototype.getSimpleName=function(){return"virtualJoystick"},t}();e.FreeCameraVirtualJoystickInput=t,e.CameraInputTypes.FreeCameraVirtualJoystickInput=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n,r,o,s){var a=this;e.call(this,t,"anaglyph",null,["leftSampler"],i,n[1],r,o,s),this._passedProcess=n[0]._rigPostProcess,this.onApplyObservable.add(function(e){e.setTextureFromPostProcess("leftSampler",a._passedProcess)})}return __extends(t,e),t}(e.PostProcess);e.AnaglyphPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e){this._scene=e}return t.prototype.render=function(t,i,n){var r=this;void 0===n&&(n=!1);var o=this._scene,s=this._scene.getEngine(),a=null!==s.getCaps().instancedArrays&&null!==i.visibleInstances[t._id]&&void 0!==i.visibleInstances[t._id];if(this.isReady(t,a)){var h=t.getRenderingMesh(),l=t.getMaterial();if(s.enableEffect(this._effect),this._effect.setFloat("offset",n?0:h.outlineWidth),this._effect.setColor4("color",n?h.overlayColor:h.outlineColor,n?h.overlayAlpha:1),this._effect.setMatrix("viewProjection",o.getTransformMatrix()),h.useBones&&h.computeBonesUsingShaders&&this._effect.setMatrices("mBones",h.skeleton.getTransformMatrices(h)),h._bind(t,this._effect,e.Material.TriangleFillMode),l&&l.needAlphaTesting()){var c=l.getAlphaTestTexture();this._effect.setTexture("diffuseSampler",c),this._effect.setMatrix("diffuseMatrix",c.getTextureMatrix())}h._processRendering(t,this._effect,e.Material.TriangleFillMode,i,a,function(e,t){r._effect.setMatrix("world",t)})}},t.prototype.isReady=function(t,i){var n=[],r=[e.VertexBuffer.PositionKind,e.VertexBuffer.NormalKind],o=t.getMesh(),s=t.getMaterial();s&&s.needAlphaTesting()&&(n.push("#define ALPHATEST"),o.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(r.push(e.VertexBuffer.UVKind),n.push("#define UV1")),o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(r.push(e.VertexBuffer.UV2Kind),n.push("#define UV2"))),o.useBones&&o.computeBonesUsingShaders?(r.push(e.VertexBuffer.MatricesIndicesKind),r.push(e.VertexBuffer.MatricesWeightsKind),o.numBoneInfluencers>4&&(r.push(e.VertexBuffer.MatricesIndicesExtraKind),r.push(e.VertexBuffer.MatricesWeightsExtraKind)),n.push("#define NUM_BONE_INFLUENCERS "+o.numBoneInfluencers),n.push("#define BonesPerMesh "+(o.skeleton.bones.length+1))):n.push("#define NUM_BONE_INFLUENCERS 0"),i&&(n.push("#define INSTANCES"),r.push("world0"),r.push("world1"),r.push("world2"),r.push("world3"));var a=n.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("outline",r,["world","mBones","viewProjection","diffuseMatrix","offset","color"],["diffuseSampler"],a)),this._effect.isReady()},t}();e.OutlineRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,n){this.name=e,this.meshesNames=t,this.rootUrl=i,this.sceneFilename=n,this.isCompleted=!1}return t.prototype.run=function(t,i,n){var r=this;e.SceneLoader.ImportMesh(this.meshesNames,this.rootUrl,this.sceneFilename,t,function(e,t,n){r.loadedMeshes=e,r.loadedParticleSystems=t,r.loadedSkeletons=n,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),i()},null,function(){r.onError&&r.onError(r),n()})},t}();e.MeshAssetTask=t;var i=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,n){var r=this;e.Tools.LoadFile(this.url,function(e){r.text=e,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),i()},null,t.database,!1,function(){r.onError&&r.onError(r),n()})},t}();e.TextFileAssetTask=i;var n=function(){function t(e,t){this.name=e,this.url=t,this.isCompleted=!1}return t.prototype.run=function(t,i,n){var r=this;e.Tools.LoadFile(this.url,function(e){r.data=e,r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),i()},null,t.database,!0,function(){r.onError&&r.onError(r),n()})},t}();e.BinaryFileAssetTask=n;var r=function(){function e(e,t){this.name=e,this.url=t,this.isCompleted=!1}return e.prototype.run=function(e,t,i){var n=this,r=new Image;r.onload=function(){n.image=r,n.isCompleted=!0,n.onSuccess&&n.onSuccess(n),t()},r.onerror=function(){n.onError&&n.onError(n),i()},r.src=this.url},e}();e.ImageAssetTask=r;var o=function(){function t(t,i,n,r,o){void 0===o&&(o=e.Texture.TRILINEAR_SAMPLINGMODE),this.name=t,this.url=i,this.noMipmap=n,this.invertY=r,this.samplingMode=o,this.isCompleted=!1}return t.prototype.run=function(t,i,n){var r=this,o=function(){r.isCompleted=!0,r.onSuccess&&r.onSuccess(r),i()},s=function(){r.onError&&r.onError(r),n()};this.texture=new e.Texture(this.url,t,this.noMipmap,this.invertY,this.samplingMode,o,s)},t}();e.TextureAssetTask=o;var s=function(){function s(e){this._tasks=new Array,this._waitingTasksCount=0,this.useDefaultLoadingScreen=!0,this._scene=e}return s.prototype.addMeshTask=function(e,i,n,r){var o=new t(e,i,n,r);return this._tasks.push(o),o},s.prototype.addTextFileTask=function(e,t){var n=new i(e,t);return this._tasks.push(n),n},s.prototype.addBinaryFileTask=function(e,t){var i=new n(e,t);return this._tasks.push(i),i},s.prototype.addImageTask=function(e,t){var i=new r(e,t);return this._tasks.push(i),i},s.prototype.addTextureTask=function(t,i,n,r,s){void 0===s&&(s=e.Texture.TRILINEAR_SAMPLINGMODE);var a=new o(t,i,n,r,s);return this._tasks.push(a),a},s.prototype._decreaseWaitingTasksCount=function(){this._waitingTasksCount--,0===this._waitingTasksCount&&(this.onFinish&&this.onFinish(this._tasks),this._scene.getEngine().hideLoadingUI())},s.prototype._runTask=function(e){var t=this;e.run(this._scene,function(){t.onTaskSuccess&&t.onTaskSuccess(e),t._decreaseWaitingTasksCount()},function(){t.onTaskError&&t.onTaskError(e),t._decreaseWaitingTasksCount()})},s.prototype.reset=function(){return this._tasks=new Array,this},s.prototype.load=function(){if(this._waitingTasksCount=this._tasks.length,0===this._waitingTasksCount)return this.onFinish&&this.onFinish(this._tasks),this;this.useDefaultLoadingScreen&&this._scene.getEngine().displayLoadingUI();for(var e=0;e<this._tasks.length;e++){var t=this._tasks[e];this._runTask(t)}return this},s}();e.AssetsManager=s}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this.compensateDistortion=!0}return Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.hResolution/(2*this.vResolution)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatioFov",{get:function(){return 2*Math.atan(this.postProcessScaleFactor*this.vScreenSize/(2*this.eyeToScreenDistance))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightHMatrix",{get:function(){var t=this.hScreenSize/4-this.lensSeparationDistance/2,i=4*t/this.hScreenSize;return e.Matrix.Translation(-i,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"leftPreViewMatrix",{get:function(){return e.Matrix.Translation(.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightPreViewMatrix",{get:function(){return e.Matrix.Translation(-.5*this.interpupillaryDistance,0,0)},enumerable:!0,configurable:!0}),t.GetDefault=function(){var e=new t;return e.hResolution=1280,e.vResolution=800,e.hScreenSize=.149759993,e.vScreenSize=.0935999975,e.vScreenCenter=.0467999987,e.eyeToScreenDistance=.0410000011,e.lensSeparationDistance=.063500002,e.interpupillaryDistance=.064000003,e.distortionK=[1,.219999999,.239999995,0],e.chromaAbCorrection=[.995999992,-.00400000019,1.01400006,0],e.postProcessScaleFactor=1.714605507808412,e.lensCenterOffset=.151976421,e},t}();e.VRCameraMetrics=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){void 0===o&&(o=!0),t.call(this,i,n,r),this.rotationQuaternion=new e.Quaternion;var s=e.VRCameraMetrics.GetDefault();s.compensateDistortion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this.inputs.addDeviceOrientation()}return __extends(i,t),i.prototype.getTypeName=function(){return"VRDeviceOrientationFreeCamera"},i}(e.FreeCamera);e.VRDeviceOrientationFreeCamera=t;var i=function(t){function i(i,n,r,o,s,a,h){void 0===h&&(h=!0),t.call(this,i,n,r,o,s,a);var l=e.VRCameraMetrics.GetDefault();l.compensateDistortion=h,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{
vrCameraMetrics:l}),this.inputs.addVRDeviceOrientation()}return __extends(i,t),i.prototype.getTypeName=function(){return"VRDeviceOrientationArcRotateCamera"},i}(e.ArcRotateCamera);e.VRDeviceOrientationArcRotateCamera=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){void 0===o&&(o=!0),t.call(this,i,n,r),this._hmdDevice=null,this._sensorDevice=null,this._cacheState=null,this._vrEnabled=!1;var s=e.VRCameraMetrics.GetDefault();s.compensateDistortion=o,this.setCameraRigMode(e.Camera.RIG_MODE_VR,{vrCameraMetrics:s}),this._getWebVRDevices=this._getWebVRDevices.bind(this),this.rotationQuaternion=new e.Quaternion}return __extends(i,t),i.prototype._getWebVRDevices=function(e){var t=e.length,i=0;for(this._sensorDevice=null,this._hmdDevice=null;t>i&&null===this._hmdDevice;)e[i]instanceof HMDVRDevice&&(this._hmdDevice=e[i]),i++;for(i=0;t>i&&null===this._sensorDevice;)e[i]instanceof PositionSensorVRDevice&&(!this._hmdDevice||e[i].hardwareUnitId===this._hmdDevice.hardwareUnitId)&&(this._sensorDevice=e[i]),i++;this._vrEnabled=!(!this._sensorDevice||!this._hmdDevice)},i.prototype._checkInputs=function(){this._vrEnabled&&(this._cacheState=this._sensorDevice.getState(),this.rotationQuaternion.copyFrom(this._cacheState.orientation),this.rotationQuaternion.z*=-1,this.rotationQuaternion.w*=-1),t.prototype._checkInputs.call(this)},i.prototype.attachControl=function(i,n){t.prototype.attachControl.call(this,i,n),n=!e.Camera.ForceAttachControlToAlwaysPreventDefault&&n,navigator.getVRDevices?navigator.getVRDevices().then(this._getWebVRDevices):navigator.mozGetVRDevices&&navigator.mozGetVRDevices(this._getWebVRDevices)},i.prototype.detachControl=function(e){t.prototype.detachControl.call(this,e),this._vrEnabled=!1},i.prototype.requestVRFullscreen=function(e){this._hmdDevice&&this.getEngine().switchFullscreen(e,{vrDisplay:this._hmdDevice})},i.prototype.getTypeName=function(){return"WebVRFreeCamera"},i}(e.FreeCamera);e.WebVRFreeCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){void 0===e&&(e=0),this.priority=e,this.apply=function(e){return!0}}return e}();e.SceneOptimization=t;var i=function(e){function t(t,i){var n=this;void 0===t&&(t=0),void 0===i&&(i=1024),e.call(this,t),this.priority=t,this.maximumSize=i,this.apply=function(e){for(var t=!0,i=0;i<e.textures.length;i++){var r=e.textures[i];if(r.canRescale){var o=r.getSize(),s=Math.max(o.width,o.height);s>n.maximumSize&&(r.scale(.5),t=!1)}}return t}}return __extends(t,e),t}(t);e.TextureOptimization=i;var n=function(e){function t(t,i){var n=this;void 0===t&&(t=0),void 0===i&&(i=2),e.call(this,t),this.priority=t,this.maximumScale=i,this._currentScale=1,this.apply=function(e){return n._currentScale++,e.getEngine().setHardwareScalingLevel(n._currentScale),n._currentScale>=n.maximumScale}}return __extends(t,e),t}(t);e.HardwareScalingOptimization=n;var r=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.shadowsEnabled=!1,!0}}return __extends(t,e),t}(t);e.ShadowsOptimization=r;var o=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.postProcessesEnabled=!1,!0}}return __extends(t,e),t}(t);e.PostProcessesOptimization=o;var s=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.lensFlaresEnabled=!1,!0}}return __extends(t,e),t}(t);e.LensFlaresOptimization=s;var a=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.particlesEnabled=!1,!0}}return __extends(t,e),t}(t);e.ParticlesOptimization=a;var h=function(e){function t(){e.apply(this,arguments),this.apply=function(e){return e.renderTargetsEnabled=!1,!0}}return __extends(t,e),t}(t);e.RenderTargetsOptimization=h;var l=function(t){function i(){var n=this;t.apply(this,arguments),this._canBeMerged=function(t){if(!(t instanceof e.Mesh))return!1;var i=t;return!(!i.isVisible||!i.isEnabled())&&(!(i.instances.length>0)&&(!i.skeleton&&!i.hasLODLevels&&!i.parent))},this.apply=function(t,r){for(var o=t.meshes.slice(0),s=o.length,a=0;s>a;a++){var h=new Array,l=o[a];if(n._canBeMerged(l)){h.push(l);for(var c=a+1;s>c;c++){var u=o[c];n._canBeMerged(u)&&u.material===l.material&&u.checkCollisions===l.checkCollisions&&(h.push(u),s--,o.splice(c,1),c--)}h.length<2||e.Mesh.MergeMeshes(h)}}return void 0!=r?r&&t.createOrUpdateSelectionOctree():i.UpdateSelectionTree&&t.createOrUpdateSelectionOctree(),!0}}return __extends(i,t),Object.defineProperty(i,"UpdateSelectionTree",{get:function(){return i._UpdateSelectionTree},set:function(e){i._UpdateSelectionTree=e},enumerable:!0,configurable:!0}),i._UpdateSelectionTree=!1,i}(t);e.MergeMeshesOptimization=l;var c=function(){function e(e,t){void 0===e&&(e=60),void 0===t&&(t=2e3),this.targetFrameRate=e,this.trackerDuration=t,this.optimizations=new Array}return e.LowDegradationAllowed=function(t){var n=new e(t),h=0;return n.optimizations.push(new l(h)),n.optimizations.push(new r(h)),n.optimizations.push(new s(h)),h++,n.optimizations.push(new o(h)),n.optimizations.push(new a(h)),h++,n.optimizations.push(new i(h,1024)),n},e.ModerateDegradationAllowed=function(t){var c=new e(t),u=0;return c.optimizations.push(new l(u)),c.optimizations.push(new r(u)),c.optimizations.push(new s(u)),u++,c.optimizations.push(new o(u)),c.optimizations.push(new a(u)),u++,c.optimizations.push(new i(u,512)),u++,c.optimizations.push(new h(u)),u++,c.optimizations.push(new n(u,2)),c},e.HighDegradationAllowed=function(t){var c=new e(t),u=0;return c.optimizations.push(new l(u)),c.optimizations.push(new r(u)),c.optimizations.push(new s(u)),u++,c.optimizations.push(new o(u)),c.optimizations.push(new a(u)),u++,c.optimizations.push(new i(u,256)),u++,c.optimizations.push(new h(u)),u++,c.optimizations.push(new n(u,4)),c},e}();e.SceneOptimizerOptions=c;var u=function(){function e(){}return e._CheckCurrentState=function(t,i,n,r,o){if(t.getEngine().getFps()>=i.targetFrameRate)return void(r&&r());for(var s=!0,a=!0,h=0;h<i.optimizations.length;h++){var l=i.optimizations[h];l.priority===n&&(a=!1,s=s&&l.apply(t))}return a?void(o&&o()):(s&&n++,void t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,n,r,o)},i.trackerDuration)}))},e.OptimizeAsync=function(t,i,n,r){i||(i=c.ModerateDegradationAllowed()),t.executeWhenReady(function(){setTimeout(function(){e._CheckCurrentState(t,i,0,n,r)},i.trackerDuration)})},e}();e.SceneOptimizer=u}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function e(e,t){this.distance=e,this.mesh=t}return e}();e.MeshLODLevel=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a,h,l){void 0===a&&(a=!0),void 0===h&&(h=!1),void 0===l&&(l=e.Texture.TRILINEAR_SAMPLINGMODE),t.call(this,null,s,!a,h),this.format=o,this._texture=s.getEngine().createRawTexture(i,n,r,o,a,h,l),this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE}return __extends(i,t),i.prototype.update=function(e){this.getScene().getEngine().updateRawTexture(this._texture,e,this.format,this._invertY)},i.CreateLuminanceTexture=function(t,n,r,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,n,r,e.Engine.TEXTUREFORMAT_LUMINANCE,o,s,a,h)},i.CreateLuminanceAlphaTexture=function(t,n,r,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,n,r,e.Engine.TEXTUREFORMAT_LUMINANCE_ALPHA,o,s,a,h)},i.CreateAlphaTexture=function(t,n,r,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,n,r,e.Engine.TEXTUREFORMAT_ALPHA,o,s,a,h)},i.CreateRGBTexture=function(t,n,r,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,n,r,e.Engine.TEXTUREFORMAT_RGB,o,s,a,h)},i.CreateRGBATexture=function(t,n,r,o,s,a,h){return void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=e.Texture.TRILINEAR_SAMPLINGMODE),new i(t,n,r,e.Engine.TEXTUREFORMAT_RGBA,o,s,a,h)},i}(e.Texture);e.RawTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i){e.call(this,t.x,t.y),this.index=i}return __extends(t,e),t}(e.Vector2),i=function(){function i(){this.elements=new Array}return i.prototype.add=function(e){var i=this,n=new Array;return e.forEach(function(e){if(0===n.length||!e.equalsWithEpsilon(n[0])){var r=new t(e,i.elements.length);n.push(r),i.elements.push(r)}}),n},i.prototype.computeBounds=function(){var t=new e.Vector2(this.elements[0].x,this.elements[0].y),i=new e.Vector2(this.elements[0].x,this.elements[0].y);return this.elements.forEach(function(e){e.x<t.x?t.x=e.x:e.x>i.x&&(i.x=e.x),e.y<t.y?t.y=e.y:e.y>i.y&&(i.y=e.y)}),{min:t,max:i,width:i.x-t.x,height:i.y-t.y}},i}(),n=function(){function t(){}return t.Rectangle=function(t,i,n,r){return[new e.Vector2(t,i),new e.Vector2(n,i),new e.Vector2(n,r),new e.Vector2(t,r)]},t.Circle=function(t,i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=32);for(var o=new Array,s=0,a=2*Math.PI/r,h=0;r>h;h++)o.push(new e.Vector2(i+Math.cos(s)*t,n+Math.sin(s)*t)),s-=a;return o},t.Parse=function(t){var i,n=t.split(/[^-+eE\.\d]+/).map(parseFloat).filter(function(e){return!isNaN(e)}),r=[];for(i=0;i<(2147483646&n.length);i+=2)r.push(new e.Vector2(n[i],n[i+1]));return r},t.StartingAt=function(t,i){return e.Path2.StartingAt(t,i)},t}();e.Polygon=n;var r=function(){function t(t,n,r){this._points=new i,this._outlinepoints=new i,this._holes=[],this._epoints=new Array,this._eholes=new Array,this._name=t,this._scene=r;var o;o=n instanceof e.Path2?n.getPoints():n,this._addToepoint(o),this._points.add(o),this._outlinepoints.add(o)}return t.prototype._addToepoint=function(e){for(var t=0;t<e.length;t++){var i=e[t];this._epoints.push(i.x,i.y)}},t.prototype.addHole=function(e){this._points.add(e);var t=new i;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},t.prototype.build=function(t,i){var n=this;void 0===t&&(t=!1);var r=new e.Mesh(this._name,this._scene),o=[],s=[],a=[],h=this._points.computeBounds();this._points.elements.forEach(function(e){o.push(0,1,0),s.push(e.x,0,e.y),a.push((e.x-h.min.x)/h.width,(e.y-h.min.y)/h.height)});for(var l=[],c=Earcut.earcut(this._epoints,this._eholes,2),u=0;u<c.length;u++)l.push(c[u]);if(i>0){var d=s.length/3;this._points.elements.forEach(function(e){o.push(0,-1,0),s.push(e.x,-i,e.y),a.push(1-(e.x-h.min.x)/h.width,1-(e.y-h.min.y)/h.height)});for(var f=l.length,u=0;f>u;u+=3){var p=l[u+0],_=l[u+1],m=l[u+2];l.push(m+d),l.push(_+d),l.push(p+d)}this.addSide(s,o,a,l,h,this._outlinepoints,i,!1),this._holes.forEach(function(e){n.addSide(s,o,a,l,h,e,i,!0)})}return r.setVerticesData(e.VertexBuffer.PositionKind,s,t),r.setVerticesData(e.VertexBuffer.NormalKind,o,t),r.setVerticesData(e.VertexBuffer.UVKind,a,t),r.setIndices(l),r},t.prototype.addSide=function(t,i,n,r,o,s,a,h){for(var l=t.length/3,c=0,u=0;u<s.elements.length;u++){var d,f=s.elements[u];d=u+1>s.elements.length-1?s.elements[0]:s.elements[u+1],t.push(f.x,0,f.y),t.push(f.x,-a,f.y),t.push(d.x,0,d.y),t.push(d.x,-a,d.y);var p=new e.Vector3(f.x,0,f.y),_=new e.Vector3(d.x,0,d.y),m=_.subtract(p),g=new e.Vector3(0,1,0),v=e.Vector3.Cross(m,g);v=v.normalize(),n.push(c/o.width,0),n.push(c/o.width,1),c+=m.length(),n.push(c/o.width,0),n.push(c/o.width,1),h?(i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),i.push(v.x,v.y,v.z),r.push(l),r.push(l+2),r.push(l+1),r.push(l+1),r.push(l+2),r.push(l+3)):(i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),i.push(-v.x,-v.y,-v.z),r.push(l),r.push(l+1),r.push(l+2),r.push(l+1),r.push(l+3),r.push(l+2)),l+=4}},t}();e.PolygonMeshBuilder=r}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n){void 0===n&&(n=2),this.maxDepth=n,this.dynamicContent=new Array,this._maxBlockCapacity=i||64,this._selectionContent=new e.SmartArray(1024),this._creationFunc=t}return t.prototype.update=function(e,i,n){t._CreateBlocks(e,i,n,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)},t.prototype.addMesh=function(e){for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];i.addEntry(e)}},t.prototype.select=function(e,t){this._selectionContent.reset();for(var i=0;i<this.blocks.length;i++){var n=this.blocks[i];n.select(e,this._selectionContent,t)}return t?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersects=function(e,t,i){this._selectionContent.reset();for(var n=0;n<this.blocks.length;n++){var r=this.blocks[n];r.intersects(e,t,this._selectionContent,i)}return i?this._selectionContent.concat(this.dynamicContent):this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t.prototype.intersectsRay=function(e){this._selectionContent.reset();for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];i.intersectsRay(e,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.dynamicContent),this._selectionContent},t._CreateBlocks=function(t,i,n,r,o,s,a,h){a.blocks=new Array;for(var l=new e.Vector3((i.x-t.x)/2,(i.y-t.y)/2,(i.z-t.z)/2),c=0;2>c;c++)for(var u=0;2>u;u++)for(var d=0;2>d;d++){var f=t.add(l.multiplyByFloats(c,u,d)),p=t.add(l.multiplyByFloats(c+1,u+1,d+1)),_=new e.OctreeBlock(f,p,r,o+1,s,h);_.addEntries(n),a.blocks.push(_)}},t.CreationFuncForMeshes=function(e,t){!e.isBlocked&&e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t.CreationFuncForSubMeshes=function(e,t){e.getBoundingInfo().boundingBox.intersectsMinMax(t.minPoint,t.maxPoint)&&t.entries.push(e)},t}();e.Octree=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(e,t,i,n,r,o){this.entries=new Array,this._boundingVectors=new Array,this._capacity=i,this._depth=n,this._maxDepth=r,this._creationFunc=o,this._minPoint=e,this._maxPoint=t,this._boundingVectors.push(e.clone()),this._boundingVectors.push(t.clone()),this._boundingVectors.push(e.clone()),this._boundingVectors[2].x=t.x,this._boundingVectors.push(e.clone()),this._boundingVectors[3].y=t.y,this._boundingVectors.push(e.clone()),this._boundingVectors[4].z=t.z,this._boundingVectors.push(t.clone()),this._boundingVectors[5].z=e.z,this._boundingVectors.push(t.clone()),this._boundingVectors[6].x=e.x,this._boundingVectors.push(t.clone()),this._boundingVectors[7].y=e.y}return Object.defineProperty(t.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minPoint",{get:function(){return this._minPoint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxPoint",{get:function(){return this._maxPoint},enumerable:!0,configurable:!0}),t.prototype.addEntry=function(e){if(this.blocks)for(var t=0;t<this.blocks.length;t++){var i=this.blocks[t];i.addEntry(e)}else this._creationFunc(e,this),this.entries.length>this.capacity&&this._depth<this._maxDepth&&this.createInnerBlocks()},t.prototype.addEntries=function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addEntry(i)}},t.prototype.select=function(t,i,n){if(e.BoundingBox.IsInFrustum(this._boundingVectors,t)){if(this.blocks){for(var r=0;r<this.blocks.length;r++){var o=this.blocks[r];o.select(t,i,n)}return}n?i.concat(this.entries):i.concatWithNoDuplicate(this.entries)}},t.prototype.intersects=function(t,i,n,r){if(e.BoundingBox.IntersectsSphere(this._minPoint,this._maxPoint,t,i)){if(this.blocks){for(var o=0;o<this.blocks.length;o++){var s=this.blocks[o];s.intersects(t,i,n,r)}return}r?n.concat(this.entries):n.concatWithNoDuplicate(this.entries)}},t.prototype.intersectsRay=function(e,t){if(e.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.blocks){for(var i=0;i<this.blocks.length;i++){var n=this.blocks[i];n.intersectsRay(e,t)}return}t.concatWithNoDuplicate(this.entries)}},t.prototype.createInnerBlocks=function(){e.Octree._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc)},t}();e.OctreeBlock=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a,h,l){var c=this;void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,i,"blur",["screenSize","direction","blurWidth"],null,o,s,a,h,l),this.direction=n,this.blurWidth=r,this.onApplyObservable.add(function(e){e.setFloat2("screenSize",c.width,c.height),e.setVector2("direction",c.direction),e.setFloat("blurWidth",c.blurWidth)})}return __extends(i,t),i}(e.PostProcess);e.BlurPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a,h,l,c,u){var d=this;t.call(this,i,"refraction",["baseColor","depth","colorLevel"],["refractionSampler"],a,h,l,c,u),this.color=r,this.depth=o,this.colorLevel=s,this.onActivateObservable.add(function(t){d._refRexture=d._refRexture||new e.Texture(n,t.getScene())}),this.onApplyObservable.add(function(e){e.setColor3("baseColor",d.color),e.setFloat("depth",d.depth),e.setFloat("colorLevel",d.colorLevel),e.setTexture("refractionSampler",d._refRexture)})}return __extends(i,t),i.prototype.dispose=function(e){this._refRexture&&this._refRexture.dispose(),t.prototype.dispose.call(this,e)},i}(e.PostProcess);e.RefractionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n,r,o,s){e.call(this,t,"blackAndWhite",null,null,i,n,r,o,s)}return __extends(t,e),t}(e.PostProcess);e.BlackAndWhitePostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n,r,o,s,a){var h=this;e.call(this,t,"convolution",["kernel","screenSize"],null,n,r,o,s,a),this.kernel=i,this.onApply=function(e){e.setFloat2("screenSize",h.width,h.height),e.setArray("kernel",h.kernel)}}return __extends(t,e),t.EdgeDetect0Kernel=[1,0,-1,0,0,0,-1,0,1],t.EdgeDetect1Kernel=[0,1,0,1,-4,1,0,1,0],t.EdgeDetect2Kernel=[-1,-1,-1,-1,8,-1,-1,-1,-1],t.SharpenKernel=[0,-1,0,-1,5,-1,0,-1,0],t.EmbossKernel=[-2,-1,0,-1,1,1,0,1,2],t.GaussianKernel=[0,1,0,1,1,1,0,1,0],t}(e.PostProcess);e.ConvolutionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n,r,o,s,a){var h=this;e.call(this,t,"filter",["kernelMatrix"],null,n,r,o,s,a),this.kernelMatrix=i,this.onApply=function(e){e.setMatrix("kernelMatrix",h.kernelMatrix)}}return __extends(t,e),t}(e.PostProcess);e.FilterPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n,r,o,s){var a=this;e.call(this,t,"fxaa",["texelSize"],null,i,n,r,o,s),this.onSizeChangedObservable.add(function(){a.texelWidth=1/a.width,a.texelHeight=1/a.height}),this.onApplyObservable.add(function(e){e.setFloat2("texelSize",a.texelWidth,a.texelHeight)})}return __extends(t,e),t}(e.PostProcess);e.FxaaPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a){var h=this;t.call(this,i,"stereoscopicInterlace",["stepSize"],["camASampler"],1,n[1],o,s,a,r?"#define IS_STEREOSCOPIC_HORIZ 1":void 0),this._passedProcess=n[0]._rigPostProcess,this._stepSize=new e.Vector2(1/this.width,1/this.height),this.onSizeChangedObservable.add(function(){h._stepSize=new e.Vector2(1/h.width,1/h.height)}),this.onApplyObservable.add(function(e){e.setTextureFromPostProcess("camASampler",h._passedProcess),e.setFloat2("stepSize",h._stepSize.x,h._stepSize.y)})}return __extends(i,t),i}(e.PostProcess);e.StereoscopicInterlacePostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o){this.size=t,this.position=i,this.dispose=function(){this.texture&&this.texture.dispose();var e=this._system.lensFlares.indexOf(this);this._system.lensFlares.splice(e,1)},this.color=n||new e.Color3(1,1,1),this.texture=r?new e.Texture(r,o.getScene(),!0):null,this._system=o,o.lensFlares.push(this)}return t}();e.LensFlare=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n){this.name=t,this.lensFlares=new Array,this.borderLimit=300,this.layerMask=268435455,this._vertexBuffers={},this._isEnabled=!0,this._scene=n,this._emitter=i,this.id=t,n.lensFlareSystems.push(this),this.meshesSelectionPredicate=function(e){return e.material&&e.isVisible&&e.isEnabled()&&e.isBlocker&&0!=(e.layerMask&n.activeCamera.layerMask)};var r=n.getEngine(),o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(r,o,e.VertexBuffer.PositionKind,!1,!1,2);var s=[];s.push(0),s.push(1),s.push(2),s.push(0),s.push(2),s.push(3),this._indexBuffer=r.createIndexBuffer(s),this._effect=r.createEffect("lensFlare",[e.VertexBuffer.PositionKind],["color","viewportMatrix"],["textureSampler"],"")}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype.getEmitter=function(){return this._emitter},t.prototype.setEmitter=function(e){this._emitter=e},t.prototype.getEmitterPosition=function(){return this._emitter.getAbsolutePosition?this._emitter.getAbsolutePosition():this._emitter.position},t.prototype.computeEffectivePosition=function(t){var i=this.getEmitterPosition();return i=e.Vector3.Project(i,e.Matrix.Identity(),this._scene.getTransformMatrix(),t),this._positionX=i.x,this._positionY=i.y,i=e.Vector3.TransformCoordinates(this.getEmitterPosition(),this._scene.getViewMatrix()),i.z>0&&this._positionX>t.x&&this._positionX<t.x+t.width&&this._positionY>t.y&&this._positionY<t.y+t.height},t.prototype._isVisible=function(){if(!this._isEnabled)return!1;var t=this.getEmitterPosition(),i=t.subtract(this._scene.activeCamera.position),n=i.length();i.normalize();var r=new e.Ray(this._scene.activeCamera.position,i),o=this._scene.pickWithRay(r,this.meshesSelectionPredicate,!0);return!o.hit||o.distance>n},t.prototype.render=function(){if(!this._effect.isReady())return!1;var t=this._scene.getEngine(),i=this._scene.activeCamera.viewport,n=i.toGlobal(t.getRenderWidth(!0),t.getRenderHeight(!0));if(!this.computeEffectivePosition(n))return!1;if(!this._isVisible())return!1;var r,o;r=this._positionX<this.borderLimit+n.x?this.borderLimit+n.x-this._positionX:this._positionX>n.x+n.width-this.borderLimit?this._positionX-n.x-n.width+this.borderLimit:0,o=this._positionY<this.borderLimit+n.y?this.borderLimit+n.y-this._positionY:this._positionY>n.y+n.height-this.borderLimit?this._positionY-n.y-n.height+this.borderLimit:0;var s=r>o?r:o;s>this.borderLimit&&(s=this.borderLimit);var a=1-s/this.borderLimit;if(0>a)return!1;a>1&&(a=1);var h=n.x+n.width/2,l=n.y+n.height/2,c=h-this._positionX,u=l-this._positionY;t.enableEffect(this._effect),t.setState(!1),t.setDepthBuffer(!1),t.setAlphaMode(e.Engine.ALPHA_ONEONE),t.bindBuffers(this._vertexBuffers,this._indexBuffer,this._effect);for(var d=0;d<this.lensFlares.length;d++){var f=this.lensFlares[d],p=h-c*f.position,_=l-u*f.position,m=f.size,g=f.size*t.getAspectRatio(this._scene.activeCamera,!0),v=2*(p/n.width)-1,y=1-2*(_/n.height),b=e.Matrix.FromValues(m/2,0,0,0,0,g/2,0,0,0,0,1,0,v,y,0,1);this._effect.setMatrix("viewportMatrix",b),this._effect.setTexture("textureSampler",f.texture),this._effect.setFloat4("color",f.color.r*a,f.color.g*a,f.color.b*a,1),t.draw(!0,0,6)}return t.setDepthBuffer(!0),t.setAlphaMode(e.Engine.ALPHA_DISABLE),!0},t.prototype.dispose=function(){var t=this._vertexBuffers[e.VertexBuffer.PositionKind];for(t&&(t.dispose(),this._vertexBuffers[e.VertexBuffer.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null);this.lensFlares.length;)this.lensFlares[0].dispose();var i=this._scene.lensFlareSystems.indexOf(this);this._scene.lensFlareSystems.splice(i,1)},t.Parse=function(i,n,r){var o=n.getLastEntryByID(i.emitterId),s=i.name||"lensFlareSystem#"+i.emitterId,a=new t(s,o,n);a.id=i.id||s,a.borderLimit=i.borderLimit;for(var h=0;h<i.flares.length;h++){var l=i.flares[h];new e.LensFlare(l.size,l.position,e.Color3.FromArray(l.color),r+l.textureName,a)}return a},t.prototype.serialize=function(){var t={};t.id=this.id,t.name=this.name,t.emitterId=this.getEmitter().id,t.borderLimit=this.borderLimit,t.flares=[];for(var i=0;i<this.lensFlares.length;i++){var n=this.lensFlares[i];t.flares.push({size:n.size,position:n.position,color:n.color.asArray(),textureName:e.Tools.GetFilename(n.texture.name)})}return t},t}();e.LensFlareSystem=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.inputs.addDeviceOrientation()}return __extends(t,e),Object.defineProperty(t.prototype,"angularSensibility",{get:function(){return 0},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moveSensibility",{get:function(){return 0},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.getTypeName=function(){return"DeviceOrientationCamera"},t}(e.FreeCamera);e.DeviceOrientationCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.inputs.addGamepad()}return __extends(t,e),Object.defineProperty(t.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:void 0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:void 0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),t.prototype.getTypeName=function(){return"UniversalCamera"},t}(e.TouchCamera);e.UniversalCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(e){var t=this;this.babylonGamepads=[],this.oneGamepadConnected=!1,this.isMonitoring=!1,this.gamepadEventSupported="GamepadEvent"in window,this.gamepadSupportAvailable=navigator.getGamepads||!!navigator.webkitGetGamepads||!!navigator.msGetGamepads||!!navigator.webkitGamepads,this._callbackGamepadConnected=e,this.gamepadSupportAvailable&&(this.gamepadEventSupported?(this._onGamepadConnectedEvent=function(e){t._onGamepadConnected(e)},this._onGamepadDisonnectedEvent=function(e){t._onGamepadDisconnected(e)},window.addEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.addEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1)):this._startMonitoringGamepads())}return e.prototype.dispose=function(){e.gamepadDOMInfo&&document.body.removeChild(e.gamepadDOMInfo),this._onGamepadConnectedEvent&&(window.removeEventListener("gamepadconnected",this._onGamepadConnectedEvent,!1),window.removeEventListener("gamepaddisconnected",this._onGamepadDisonnectedEvent,!1),this._onGamepadConnectedEvent=null,this._onGamepadDisonnectedEvent=null)},e.prototype._onGamepadConnected=function(e){var t=this._addNewGamepad(e.gamepad);this._callbackGamepadConnected&&this._callbackGamepadConnected(t),this._startMonitoringGamepads()},e.prototype._addNewGamepad=function(t){this.oneGamepadConnected||(this.oneGamepadConnected=!0,e.gamepadDOMInfo&&(document.body.removeChild(e.gamepadDOMInfo),e.gamepadDOMInfo=null));var i;return i=-1!==t.id.search("Xbox 360")||-1!==t.id.search("xinput")?new a(t.id,t.index,t):new r(t.id,t.index,t),this.babylonGamepads.push(i),i},e.prototype._onGamepadDisconnected=function(e){for(var t in this.babylonGamepads)if(this.babylonGamepads[t].index==e.gamepad.index){this.babylonGamepads.splice(+t,1);break}0==this.babylonGamepads.length&&this._stopMonitoringGamepads()},e.prototype._startMonitoringGamepads=function(){this.isMonitoring||(this.isMonitoring=!0,this._checkGamepadsStatus())},e.prototype._stopMonitoringGamepads=function(){this.isMonitoring=!1},e.prototype._checkGamepadsStatus=function(){var e=this;this._updateGamepadObjects();for(var t in this.babylonGamepads)this.babylonGamepads[t].update();this.isMonitoring&&(window.requestAnimationFrame?window.requestAnimationFrame(function(){e._checkGamepadsStatus()}):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(function(){e._checkGamepadsStatus()}):window.webkitRequestAnimationFrame&&window.webkitRequestAnimationFrame(function(){e._checkGamepadsStatus()}))},e.prototype._updateGamepadObjects=function(){for(var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0;t<e.length;t++)if(e[t])if(e[t].index in this.babylonGamepads)this.babylonGamepads[t].browserGamepad=e[t];else{var i=this._addNewGamepad(e[t]);this._callbackGamepadConnected&&this._callbackGamepadConnected(i)}},e}();e.Gamepads=t;var i=function(){function e(e,t){this.x=e,this.y=t}return e}();e.StickValues=i;var n=function(){function e(e,t,i){this.id=e,this.index=t,this.browserGamepad=i,this.browserGamepad.axes.length>=2&&(this._leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this.browserGamepad.axes.length>=4&&(this._rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})}return e.prototype.onleftstickchanged=function(e){this._onleftstickchanged=e},e.prototype.onrightstickchanged=function(e){this._onrightstickchanged=e},Object.defineProperty(e.prototype,"leftStick",{get:function(){return this._leftStick},set:function(e){!this._onleftstickchanged||this._leftStick.x===e.x&&this._leftStick.y===e.y||this._onleftstickchanged(e),this._leftStick=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightStick",{get:function(){return this._rightStick},set:function(e){!this._onrightstickchanged||this._rightStick.x===e.x&&this._rightStick.y===e.y||this._onrightstickchanged(e),this._rightStick=e},enumerable:!0,configurable:!0}),e.prototype.update=function(){this._leftStick&&(this.leftStick={x:this.browserGamepad.axes[0],y:this.browserGamepad.axes[1]}),this._rightStick&&(this.rightStick={x:this.browserGamepad.axes[2],y:this.browserGamepad.axes[3]})},e}();e.Gamepad=n;var r=function(e){function t(t,i,n){e.call(this,t,i,n),this.id=t,this.index=i,this.gamepad=n,this._buttons=new Array(n.buttons.length)}return __extends(t,e),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype.update=function(){e.prototype.update.call(this);for(var t=0;t<this._buttons.length;t++)this._buttons[t]=this._setButtonValue(this.gamepad.buttons[t].value,this._buttons[t],t)},t}(n);e.GenericPad=r,function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.Start=4]="Start",e[e.Back=5]="Back",e[e.LB=6]="LB",e[e.RB=7]="RB",e[e.LeftStick=8]="LeftStick",e[e.RightStick=9]="RightStick"}(e.Xbox360Button||(e.Xbox360Button={}));var o=e.Xbox360Button;!function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(e.Xbox360Dpad||(e.Xbox360Dpad={}));var s=e.Xbox360Dpad,a=function(e){function t(){e.apply(this,arguments),this._leftTrigger=0,this._rightTrigger=0,this._buttonA=0,this._buttonB=0,this._buttonX=0,this._buttonY=0,this._buttonBack=0,this._buttonStart=0,this._buttonLB=0,this._buttonRB=0,this._buttonLeftStick=0,this._buttonRightStick=0,this._dPadUp=0,this._dPadDown=0,this._dPadLeft=0,this._dPadRight=0}return __extends(t,e),t.prototype.onlefttriggerchanged=function(e){this._onlefttriggerchanged=e},t.prototype.onrighttriggerchanged=function(e){this._onrighttriggerchanged=e},Object.defineProperty(t.prototype,"leftTrigger",{get:function(){return this._leftTrigger},set:function(e){this._onlefttriggerchanged&&this._leftTrigger!==e&&this._onlefttriggerchanged(e),this._leftTrigger=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rightTrigger",{get:function(){return this._rightTrigger},set:function(e){this._onrighttriggerchanged&&this._rightTrigger!==e&&this._onrighttriggerchanged(e),
this._rightTrigger=e},enumerable:!0,configurable:!0}),t.prototype.onbuttondown=function(e){this._onbuttondown=e},t.prototype.onbuttonup=function(e){this._onbuttonup=e},t.prototype.ondpaddown=function(e){this._ondpaddown=e},t.prototype.ondpadup=function(e){this._ondpadup=e},t.prototype._setButtonValue=function(e,t,i){return e!==t&&(this._onbuttondown&&1===e&&this._onbuttondown(i),this._onbuttonup&&0===e&&this._onbuttonup(i)),e},t.prototype._setDPadValue=function(e,t,i){return e!==t&&(this._ondpaddown&&1===e&&this._ondpaddown(i),this._ondpadup&&0===e&&this._ondpadup(i)),e},Object.defineProperty(t.prototype,"buttonA",{get:function(){return this._buttonA},set:function(e){this._buttonA=this._setButtonValue(e,this._buttonA,o.A)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonB",{get:function(){return this._buttonB},set:function(e){this._buttonB=this._setButtonValue(e,this._buttonB,o.B)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonX",{get:function(){return this._buttonX},set:function(e){this._buttonX=this._setButtonValue(e,this._buttonX,o.X)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonY",{get:function(){return this._buttonY},set:function(e){this._buttonY=this._setButtonValue(e,this._buttonY,o.Y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonStart",{get:function(){return this._buttonStart},set:function(e){this._buttonStart=this._setButtonValue(e,this._buttonStart,o.Start)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonBack",{get:function(){return this._buttonBack},set:function(e){this._buttonBack=this._setButtonValue(e,this._buttonBack,o.Back)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLB",{get:function(){return this._buttonLB},set:function(e){this._buttonLB=this._setButtonValue(e,this._buttonLB,o.LB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRB",{get:function(){return this._buttonRB},set:function(e){this._buttonRB=this._setButtonValue(e,this._buttonRB,o.RB)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonLeftStick",{get:function(){return this._buttonLeftStick},set:function(e){this._buttonLeftStick=this._setButtonValue(e,this._buttonLeftStick,o.LeftStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttonRightStick",{get:function(){return this._buttonRightStick},set:function(e){this._buttonRightStick=this._setButtonValue(e,this._buttonRightStick,o.RightStick)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadUp",{get:function(){return this._dPadUp},set:function(e){this._dPadUp=this._setDPadValue(e,this._dPadUp,s.Up)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadDown",{get:function(){return this._dPadDown},set:function(e){this._dPadDown=this._setDPadValue(e,this._dPadDown,s.Down)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadLeft",{get:function(){return this._dPadLeft},set:function(e){this._dPadLeft=this._setDPadValue(e,this._dPadLeft,s.Left)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dPadRight",{get:function(){return this._dPadRight},set:function(e){this._dPadRight=this._setDPadValue(e,this._dPadRight,s.Right)},enumerable:!0,configurable:!0}),t.prototype.update=function(){e.prototype.update.call(this),this.buttonA=this.browserGamepad.buttons[0].value,this.buttonB=this.browserGamepad.buttons[1].value,this.buttonX=this.browserGamepad.buttons[2].value,this.buttonY=this.browserGamepad.buttons[3].value,this.buttonLB=this.browserGamepad.buttons[4].value,this.buttonRB=this.browserGamepad.buttons[5].value,this.leftTrigger=this.browserGamepad.buttons[6].value,this.rightTrigger=this.browserGamepad.buttons[7].value,this.buttonBack=this.browserGamepad.buttons[8].value,this.buttonStart=this.browserGamepad.buttons[9].value,this.buttonLeftStick=this.browserGamepad.buttons[10].value,this.buttonRightStick=this.browserGamepad.buttons[11].value,this.dPadUp=this.browserGamepad.buttons[12].value,this.dPadDown=this.browserGamepad.buttons[13].value,this.dPadLeft=this.browserGamepad.buttons[14].value,this.dPadRight=this.browserGamepad.buttons[15].value},t}(n);e.Xbox360Pad=a}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r){e.Tools.Warn("Deprecated. Please use Universal Camera instead."),t.call(this,i,n,r)}return __extends(i,t),Object.defineProperty(i.prototype,"gamepadAngularSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadAngularSensibility:void 0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadAngularSensibility=e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gamepadMoveSensibility",{get:function(){var e=this.inputs.attached.gamepad;return e?e.gamepadMoveSensibility:void 0},set:function(e){var t=this.inputs.attached.gamepad;t&&(t.gamepadMoveSensibility=e)},enumerable:!0,configurable:!0}),i.prototype.getTypeName=function(){return"GamepadCamera"},i}(e.UniversalCamera);e.GamepadCamera=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){this.SMOOTHING=.75,this.FFT_SIZE=512,this.BARGRAPHAMPLITUDE=256,this.DEBUGCANVASPOS={x:20,y:20},this.DEBUGCANVASSIZE={width:320,height:200},this._scene=t,this._audioEngine=e.Engine.audioEngine,this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser=this._audioEngine.audioContext.createAnalyser(),this._webAudioAnalyser.minDecibels=-140,this._webAudioAnalyser.maxDecibels=0,this._byteFreqs=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._byteTime=new Uint8Array(this._webAudioAnalyser.frequencyBinCount),this._floatFreqs=new Float32Array(this._webAudioAnalyser.frequencyBinCount))}return t.prototype.getFrequencyBinCount=function(){return this._audioEngine.canUseWebAudio?this._webAudioAnalyser.frequencyBinCount:0},t.prototype.getByteFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteFrequencyData(this._byteFreqs)),this._byteFreqs},t.prototype.getByteTimeDomainData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getByteTimeDomainData(this._byteTime)),this._byteTime},t.prototype.getFloatFrequencyData=function(){return this._audioEngine.canUseWebAudio&&(this._webAudioAnalyser.smoothingTimeConstant=this.SMOOTHING,this._webAudioAnalyser.fftSize=this.FFT_SIZE,this._webAudioAnalyser.getFloatFrequencyData(this._floatFreqs)),this._floatFreqs},t.prototype.drawDebugCanvas=function(){var e=this;if(this._audioEngine.canUseWebAudio&&(this._debugCanvas||(this._debugCanvas=document.createElement("canvas"),this._debugCanvas.width=this.DEBUGCANVASSIZE.width,this._debugCanvas.height=this.DEBUGCANVASSIZE.height,this._debugCanvas.style.position="absolute",this._debugCanvas.style.top=this.DEBUGCANVASPOS.y+"px",this._debugCanvas.style.left=this.DEBUGCANVASPOS.x+"px",this._debugCanvasContext=this._debugCanvas.getContext("2d"),document.body.appendChild(this._debugCanvas),this._registerFunc=function(){e.drawDebugCanvas()},this._scene.registerBeforeRender(this._registerFunc)),this._registerFunc)){var t=this.getByteFrequencyData();this._debugCanvasContext.fillStyle="rgb(0, 0, 0)",this._debugCanvasContext.fillRect(0,0,this.DEBUGCANVASSIZE.width,this.DEBUGCANVASSIZE.height);for(var i=0;i<this.getFrequencyBinCount();i++){var n=t[i],r=n/this.BARGRAPHAMPLITUDE,o=this.DEBUGCANVASSIZE.height*r,s=this.DEBUGCANVASSIZE.height-o-1,a=this.DEBUGCANVASSIZE.width/this.getFrequencyBinCount(),h=i/this.getFrequencyBinCount()*360;this._debugCanvasContext.fillStyle="hsl("+h+", 100%, 50%)",this._debugCanvasContext.fillRect(i*a,s,a,o)}}},t.prototype.stopDebugCanvas=function(){this._debugCanvas&&(this._scene.unregisterBeforeRender(this._registerFunc),this._registerFunc=null,document.body.removeChild(this._debugCanvas),this._debugCanvas=null,this._debugCanvasContext=null)},t.prototype.connectAudioNodes=function(e,t){this._audioEngine.canUseWebAudio&&(e.connect(this._webAudioAnalyser),this._webAudioAnalyser.connect(t))},t.prototype.dispose=function(){this._audioEngine.canUseWebAudio&&this._webAudioAnalyser.disconnect()},t}();e.Analyser=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i){var n=this;void 0===i&&(i=e.Engine.TEXTURETYPE_FLOAT),this._viewMatrix=e.Matrix.Zero(),this._projectionMatrix=e.Matrix.Zero(),this._transformMatrix=e.Matrix.Zero(),this._worldViewProjection=e.Matrix.Zero(),this._scene=t;var r=t.getEngine();this._depthMap=new e.RenderTargetTexture("depthMap",{width:r.getRenderWidth(),height:r.getRenderHeight()},this._scene,!1,!0,i),this._depthMap.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._depthMap.refreshRate=1,this._depthMap.renderParticles=!1,this._depthMap.renderList=null,this._depthMap.onClearObservable.add(function(t){t.clear(new e.Color4(1,1,1,1),!0,!0)});var o=function(t){var i=t.getRenderingMesh(),r=n._scene,o=r.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(n.isReady(t,a)){o.enableEffect(n._effect),i._bind(t,n._effect,e.Material.TriangleFillMode);var h=t.getMaterial();if(n._effect.setMatrix("viewProjection",r.getTransformMatrix()),n._effect.setFloat("far",r.activeCamera.maxZ),h&&h.needAlphaTesting()){var l=h.getAlphaTestTexture();n._effect.setTexture("diffuseSampler",l),n._effect.setMatrix("diffuseMatrix",l.getTextureMatrix())}i.useBones&&i.computeBonesUsingShaders&&n._effect.setMatrices("mBones",i.skeleton.getTransformMatrices(i)),i._processRendering(t,n._effect,e.Material.TriangleFillMode,s,a,function(e,t){return n._effect.setMatrix("world",t)})}}};this._depthMap.customRenderFunction=function(e,t){var i;for(i=0;i<e.length;i++)o(e.data[i]);for(i=0;i<t.length;i++)o(t.data[i])}}return t.prototype.isReady=function(t,i){var n=t.getMaterial();if(n.disableDepthWrite)return!1;var r=[],o=[e.VertexBuffer.PositionKind],s=t.getMesh();s.getScene(),n&&n.needAlphaTesting()&&(r.push("#define ALPHATEST"),s.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),r.push("#define UV1")),s.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),r.push("#define UV2"))),s.useBones&&s.computeBonesUsingShaders?(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),s.numBoneInfluencers>4&&(o.push(e.VertexBuffer.MatricesIndicesExtraKind),o.push(e.VertexBuffer.MatricesWeightsExtraKind)),r.push("#define NUM_BONE_INFLUENCERS "+s.numBoneInfluencers),r.push("#define BonesPerMesh "+(s.skeleton.bones.length+1))):r.push("#define NUM_BONE_INFLUENCERS 0"),i&&(r.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var a=r.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._effect=this._scene.getEngine().createEffect("depth",o,["world","mBones","viewProjection","diffuseMatrix","far"],["diffuseSampler"],a)),this._effect.isReady()},t.prototype.getDepthMap=function(){return this._depthMap},t.prototype.dispose=function(){this._depthMap.dispose()},t}();e.DepthRenderer=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o){var s=this;t.call(this,n.getEngine(),i),this.SSAOOriginalSceneColorEffect="SSAOOriginalSceneColorEffect",this.SSAORenderEffect="SSAORenderEffect",this.SSAOBlurHRenderEffect="SSAOBlurHRenderEffect",this.SSAOBlurVRenderEffect="SSAOBlurVRenderEffect",this.SSAOCombineRenderEffect="SSAOCombineRenderEffect",this.totalStrength=1,this.radius=1e-4,this.area=.0075,this.fallOff=1e-6,this.base=.5,this._firstUpdate=!0,this._scene=n,this._createRandomTexture(),this._depthTexture=n.enableDepthRenderer().getDepthMap();var a=r.ssaoRatio||r,h=r.combineRatio||r;this._ratio={ssaoRatio:a,combineRatio:h},this._originalColorPostProcess=new e.PassPostProcess("SSAOOriginalSceneColor",h,null,e.Texture.BILINEAR_SAMPLINGMODE,n.getEngine(),!1),this._createSSAOPostProcess(a),this._createBlurPostProcess(a),this._createSSAOCombinePostProcess(h),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOOriginalSceneColorEffect,function(){return s._originalColorPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAORenderEffect,function(){return s._ssaoPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOBlurHRenderEffect,function(){return s._blurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOBlurVRenderEffect,function(){return s._blurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(n.getEngine(),this.SSAOCombineRenderEffect,function(){return s._ssaoCombinePostProcess},!0)),n.postProcessRenderPipelineManager.addPipeline(this),o&&n.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,o)}return __extends(i,t),i.prototype.getBlurHPostProcess=function(){return e.Tools.Error("SSAORenderinPipeline.getBlurHPostProcess() is deprecated, no more blur post-process exists"),null},i.prototype.getBlurVPostProcess=function(){return e.Tools.Error("SSAORenderinPipeline.getBlurVPostProcess() is deprecated, no more blur post-process exists"),null},i.prototype.dispose=function(e){void 0===e&&(e=!1);for(var t=0;t<this._scene.cameras.length;t++){var i=this._scene.cameras[t];this._originalColorPostProcess.dispose(i),this._ssaoPostProcess.dispose(i),this._blurHPostProcess.dispose(i),this._blurVPostProcess.dispose(i),this._ssaoCombinePostProcess.dispose(i)}this._randomTexture.dispose(),e&&this._scene.disableDepthRenderer(),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras)},i.prototype._createBlurPostProcess=function(t){for(var i=this,n=[],r=-8;8>r;r++)n.push(2*r);this._blurHPostProcess=new e.PostProcess("BlurH","ssao",["outSize","samplerOffsets"],["depthSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define BILATERAL_BLUR_H\n#define SAMPLES 16"),this._blurHPostProcess.onApply=function(e){e.setFloat("outSize",i._ssaoCombinePostProcess.width),e.setTexture("depthSampler",i._depthTexture),i._firstUpdate&&e.setArray("samplerOffsets",n)},this._blurVPostProcess=new e.PostProcess("BlurV","ssao",["outSize","samplerOffsets"],["depthSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define BILATERAL_BLUR\n#define SAMPLES 16"),this._blurVPostProcess.onApply=function(e){e.setFloat("outSize",i._ssaoCombinePostProcess.height),e.setTexture("depthSampler",i._depthTexture),i._firstUpdate&&(e.setArray("samplerOffsets",n),i._firstUpdate=!1)}},i.prototype._createSSAOPostProcess=function(t){var i=this,n=16,r=[.5381,.1856,-.4319,.1379,.2486,.443,.3371,.5679,-.0057,-.6999,-.0451,-.0019,.0689,-.1598,-.8547,.056,.0069,-.1843,-.0146,.1402,.0762,.01,-.1924,-.0344,-.3577,-.5301,-.4358,-.3169,.1063,.0158,.0103,-.5869,.0046,-.0897,-.494,.3287,.7119,-.0154,-.0918,-.0533,.0596,-.5411,.0352,-.0631,.546,-.4776,.2847,-.0271],o=1/n;this._ssaoPostProcess=new e.PostProcess("ssao","ssao",["sampleSphere","samplesFactor","randTextureTiles","totalStrength","radius","area","fallOff","base","range","viewport"],["randomSampler"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,"#define SAMPLES "+n+"\n#define SSAO"),new e.Vector2(0,0),this._ssaoPostProcess.onApply=function(e){i._firstUpdate&&(e.setArray3("sampleSphere",r),e.setFloat("samplesFactor",o),e.setFloat("randTextureTiles",4)),e.setFloat("totalStrength",i.totalStrength),e.setFloat("radius",i.radius),e.setFloat("area",i.area),e.setFloat("fallOff",i.fallOff),e.setFloat("base",i.base),e.setTexture("textureSampler",i._depthTexture),e.setTexture("randomSampler",i._randomTexture)}},i.prototype._createSSAOCombinePostProcess=function(t){var i=this;this._ssaoCombinePostProcess=new e.PostProcess("ssaoCombine","ssaoCombine",[],["originalColor"],t,null,e.Texture.BILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._ssaoCombinePostProcess.onApply=function(e){e.setTextureFromPostProcess("originalColor",i._originalColorPostProcess)}},i.prototype._createRandomTexture=function(){var t=512;this._randomTexture=new e.DynamicTexture("SSAORandomTexture",t,this._scene,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._randomTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._randomTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i=this._randomTexture.getContext(),n=function(e,t){return Math.random()*(t-e)+e},r=e.Vector3.Zero(),o=0;t>o;o++)for(var s=0;t>s;s++)r.x=Math.floor(255*n(-1,1)),r.y=Math.floor(255*n(-1,1)),r.z=Math.floor(255*n(-1,1)),i.fillStyle="rgb("+r.x+", "+r.y+", "+r.z+")",i.fillRect(o,s,1,1);this._randomTexture.update(!1)},__decorate([e.serialize()],i.prototype,"totalStrength",void 0),__decorate([e.serialize()],i.prototype,"radius",void 0),__decorate([e.serialize()],i.prototype,"area",void 0),__decorate([e.serialize()],i.prototype,"fallOff",void 0),__decorate([e.serialize()],i.prototype,"base",void 0),__decorate([e.serialize()],i.prototype,"_ratio",void 0),i}(e.PostProcessRenderPipeline);e.SSAORenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(n,r,o,s,a,h,l,c,u){var d=this;void 0===a&&(a=100),void 0===h&&(h=e.Texture.BILINEAR_SAMPLINGMODE),t.call(this,n,"volumetricLightScattering",["decay","exposure","weight","meshPositionOnScreen","density"],["lightScatteringSampler"],r.postProcessRatio||r,o,h,l,c,"#define NUM_SAMPLES "+a),this._screenCoordinates=e.Vector2.Zero(),this.customMeshPosition=e.Vector3.Zero(),this.useCustomMeshPosition=!1,this.invert=!0,this.excludedMeshes=new Array,this.exposure=.3,this.decay=.96815,this.weight=.58767,this.density=.926,u=null===o?u:o.getScene();var l=u.getEngine();this._viewPort=new e.Viewport(0,0,1,1).toGlobal(l.getRenderWidth(),l.getRenderHeight()),this.mesh=null!==s?s:i.CreateDefaultMesh("VolumetricLightScatteringMesh",u),this._createPass(u,r.passRatio||r),this.onActivate=function(e){d.isSupported||d.dispose(e),d.onActivate=null},this.onApplyObservable.add(function(e){d._updateMeshScreenCoordinates(u),e.setTexture("lightScatteringSampler",d._volumetricLightScatteringRTT),e.setFloat("exposure",d.exposure),e.setFloat("decay",d.decay),e.setFloat("weight",d.weight),e.setFloat("density",d.density),e.setVector2("meshPositionOnScreen",d._screenCoordinates)})}return __extends(i,t),Object.defineProperty(i.prototype,"useDiffuseColor",{get:function(){return e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead"),!1},set:function(t){e.Tools.Warn("VolumetricLightScatteringPostProcess.useDiffuseColor is no longer used, use the mesh material directly instead")},enumerable:!0,configurable:!0}),i.prototype.isReady=function(t,i){var n=t.getMesh();if(n===this.mesh)return n.material.isReady(n);var r=[],o=[e.VertexBuffer.PositionKind],s=t.getMaterial();s&&(s.needAlphaTesting()&&r.push("#define ALPHATEST"),n.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(o.push(e.VertexBuffer.UVKind),r.push("#define UV1")),n.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(o.push(e.VertexBuffer.UV2Kind),r.push("#define UV2"))),n.useBones&&n.computeBonesUsingShaders?(o.push(e.VertexBuffer.MatricesIndicesKind),o.push(e.VertexBuffer.MatricesWeightsKind),r.push("#define NUM_BONE_INFLUENCERS "+n.numBoneInfluencers),r.push("#define BonesPerMesh "+(n.skeleton.bones.length+1))):r.push("#define NUM_BONE_INFLUENCERS 0"),i&&(r.push("#define INSTANCES"),o.push("world0"),o.push("world1"),o.push("world2"),o.push("world3"));var a=r.join("\n");return this._cachedDefines!==a&&(this._cachedDefines=a,this._volumetricLightScatteringPass=n.getScene().getEngine().createEffect({vertexElement:"depth",fragmentElement:"volumetricLightScatteringPass"},o,["world","mBones","viewProjection","diffuseMatrix"],["diffuseSampler"],a)),this._volumetricLightScatteringPass.isReady()},i.prototype.setCustomMeshPosition=function(e){this.customMeshPosition=e},i.prototype.getCustomMeshPosition=function(){return this.customMeshPosition},i.prototype.dispose=function(e){var i=e.getScene().customRenderTargets.indexOf(this._volumetricLightScatteringRTT);-1!==i&&e.getScene().customRenderTargets.splice(i,1),this._volumetricLightScatteringRTT.dispose(),t.prototype.dispose.call(this,e)},i.prototype.getPass=function(){return this._volumetricLightScatteringRTT},i.prototype._meshExcluded=function(e){return this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e)},i.prototype._createPass=function(t,i){var n=this,r=t.getEngine();this._volumetricLightScatteringRTT=new e.RenderTargetTexture("volumetricLightScatteringMap",{width:r.getRenderWidth()*i,height:r.getRenderHeight()*i},t,!1,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT),this._volumetricLightScatteringRTT.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.wrapV=e.Texture.CLAMP_ADDRESSMODE,this._volumetricLightScatteringRTT.renderList=null,this._volumetricLightScatteringRTT.renderParticles=!1,t.customRenderTargets.push(this._volumetricLightScatteringRTT);var o,s=function(t){var i=t.getRenderingMesh();if(!n._meshExcluded(i)){var r=i.getScene(),o=r.getEngine();o.setState(t.getMaterial().backFaceCulling);var s=i._getInstancesRenderList(t._id);if(!s.mustReturn){var a=null!==o.getCaps().instancedArrays&&null!==s.visibleInstances[t._id];if(n.isReady(t,a)){var h=n._volumetricLightScatteringPass;if(i===n.mesh&&(h=t.getMaterial().getEffect()),o.enableEffect(h),i._bind(t,h,e.Material.TriangleFillMode),i===n.mesh)t.getMaterial().bind(i.getWorldMatrix(),i);else{var l=t.getMaterial();if(n._volumetricLightScatteringPass.setMatrix("viewProjection",r.getTransformMatrix()),l&&l.needAlphaTesting()){var c=l.getAlphaTestTexture();n._volumetricLightScatteringPass.setTexture("diffuseSampler",c),c&&n._volumetricLightScatteringPass.setMatrix("diffuseMatrix",c.getTextureMatrix())}i.useBones&&i.computeBonesUsingShaders&&n._volumetricLightScatteringPass.setMatrices("mBones",i.skeleton.getTransformMatrices(i))}i._processRendering(t,n._volumetricLightScatteringPass,e.Material.TriangleFillMode,s,a,function(e,t){return h.setMatrix("world",t)})}}}},a=new e.Color4(0,0,0,1);this._volumetricLightScatteringRTT.onBeforeRenderObservable.add(function(){o=t.clearColor,t.clearColor=a}),this._volumetricLightScatteringRTT.onAfterRenderObservable.add(function(){t.clearColor=o}),this._volumetricLightScatteringRTT.customRenderFunction=function(i,n,r){var o,a=t.getEngine();for(o=0;o<i.length;o++)s(i.data[o]);for(a.setAlphaTesting(!0),o=0;o<n.length;o++)s(n.data[o]);if(a.setAlphaTesting(!1),r.length){for(o=0;o<r.length;o++){var h=r.data[o];h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=h.getBoundingInfo().boundingSphere.centerWorld.subtract(t.activeCamera.position).length()}var l=r.data.slice(0,r.length);for(l.sort(function(e,t){return e._alphaIndex>t._alphaIndex?1:e._alphaIndex<t._alphaIndex?-1:e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0}),a.setAlphaMode(e.Engine.ALPHA_COMBINE),o=0;o<l.length;o++)s(l[o]);a.setAlphaMode(e.Engine.ALPHA_DISABLE)}}},i.prototype._updateMeshScreenCoordinates=function(t){var i,n=t.getTransformMatrix();i=this.useCustomMeshPosition?this.customMeshPosition:this.attachedNode?this.attachedNode.position:this.mesh.parent?this.mesh.getAbsolutePosition():this.mesh.position;var r=e.Vector3.Project(i,e.Matrix.Identity(),n,this._viewPort);this._screenCoordinates.x=r.x/this._viewPort.width,this._screenCoordinates.y=r.y/this._viewPort.height,this.invert&&(this._screenCoordinates.y=1-this._screenCoordinates.y)},i.CreateDefaultMesh=function(t,i){var n=e.Mesh.CreatePlane(t,1,i);n.billboardMode=e.AbstractMesh.BILLBOARDMODE_ALL;var r=new e.StandardMaterial(t+"Material",i);return r.emissiveColor=new e.Color3(1,1,1),n.material=r,n},__decorate([e.serializeAsVector3()],i.prototype,"customMeshPosition",void 0),__decorate([e.serialize()],i.prototype,"useCustomMeshPosition",void 0),__decorate([e.serialize()],i.prototype,"invert",void 0),__decorate([e.serializeAsMeshReference()],i.prototype,"mesh",void 0),__decorate([e.serialize()],i.prototype,"excludedMeshes",void 0),__decorate([e.serialize()],i.prototype,"exposure",void 0),__decorate([e.serialize()],i.prototype,"decay",void 0),__decorate([e.serialize()],i.prototype,"weight",void 0),__decorate([e.serialize()],i.prototype,"density",void 0),i}(e.PostProcess);e.VolumetricLightScatteringPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s){var a=this;void 0===o&&(o=1),t.call(this,r.getEngine(),i),this.LensChromaticAberrationEffect="LensChromaticAberrationEffect",this.HighlightsEnhancingEffect="HighlightsEnhancingEffect",this.LensDepthOfFieldEffect="LensDepthOfFieldEffect",this._scene=r,this._depthTexture=r.enableDepthRenderer().getDepthMap(),n.grain_texture?this._grainTexture=n.grain_texture:this._createGrainTexture(),this._edgeBlur=n.edge_blur?n.edge_blur:0,this._grainAmount=n.grain_amount?n.grain_amount:0,this._chromaticAberration=n.chromatic_aberration?n.chromatic_aberration:0,this._distortion=n.distortion?n.distortion:0,this._highlightsGain=void 0!==n.dof_gain?n.dof_gain:-1,this._highlightsThreshold=n.dof_threshold?n.dof_threshold:1,this._dofDistance=void 0!==n.dof_focus_distance?n.dof_focus_distance:-1,this._dofAperture=n.dof_aperture?n.dof_aperture:1,this._dofDarken=n.dof_darken?n.dof_darken:0,this._dofPentagon=void 0===n.dof_pentagon||n.dof_pentagon,this._blurNoise=void 0===n.blur_noise||n.blur_noise,this._createChromaticAberrationPostProcess(o),this._createHighlightsPostProcess(o),this._createDepthOfFieldPostProcess(o/4),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.LensChromaticAberrationEffect,function(){return a._chromaticAberrationPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.HighlightsEnhancingEffect,function(){return a._highlightsPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),this.LensDepthOfFieldEffect,function(){return a._depthOfFieldPostProcess},!0)),-1===this._highlightsGain&&this._disableEffect(this.HighlightsEnhancingEffect,null),r.postProcessRenderPipelineManager.addPipeline(this),s&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(i,s)}return __extends(i,t),i.prototype.setEdgeBlur=function(e){this._edgeBlur=e},i.prototype.disableEdgeBlur=function(){this._edgeBlur=0},i.prototype.setGrainAmount=function(e){this._grainAmount=e},i.prototype.disableGrain=function(){this._grainAmount=0},i.prototype.setChromaticAberration=function(e){this._chromaticAberration=e},i.prototype.disableChromaticAberration=function(){this._chromaticAberration=0},i.prototype.setEdgeDistortion=function(e){this._distortion=e},i.prototype.disableEdgeDistortion=function(){this._distortion=0},i.prototype.setFocusDistance=function(e){this._dofDistance=e},i.prototype.disableDepthOfField=function(){this._dofDistance=-1},i.prototype.setAperture=function(e){this._dofAperture=e},i.prototype.setDarkenOutOfFocus=function(e){this._dofDarken=e},i.prototype.enablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect("#define PENTAGON\n")},i.prototype.disablePentagonBokeh=function(){this._highlightsPostProcess.updateEffect()},i.prototype.enableNoiseBlur=function(){this._blurNoise=!0},i.prototype.disableNoiseBlur=function(){this._blurNoise=!1},i.prototype.setHighlightsGain=function(e){this._highlightsGain=e},i.prototype.setHighlightsThreshold=function(e){-1===this._highlightsGain&&(this._highlightsGain=1),this._highlightsThreshold=e},i.prototype.disableHighlights=function(){this._highlightsGain=-1},i.prototype.dispose=function(e){void 0===e&&(e=!1),this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras),this._chromaticAberrationPostProcess=void 0,this._highlightsPostProcess=void 0,this._depthOfFieldPostProcess=void 0,this._grainTexture.dispose(),e&&this._scene.disableDepthRenderer()},i.prototype._createChromaticAberrationPostProcess=function(t){var i=this;this._chromaticAberrationPostProcess=new e.PostProcess("LensChromaticAberration","chromaticAberration",["chromatic_aberration","screen_width","screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._chromaticAberrationPostProcess.onApply=function(e){e.setFloat("chromatic_aberration",i._chromaticAberration),e.setFloat("screen_width",i._scene.getEngine().getRenderingCanvas().width),e.setFloat("screen_height",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createHighlightsPostProcess=function(t){var i=this;this._highlightsPostProcess=new e.PostProcess("LensHighlights","lensHighlights",["gain","threshold","screen_width","screen_height"],[],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1,this._dofPentagon?"#define PENTAGON\n":""),this._highlightsPostProcess.onApply=function(e){e.setFloat("gain",i._highlightsGain),e.setFloat("threshold",i._highlightsThreshold),e.setTextureFromPostProcess("textureSampler",i._chromaticAberrationPostProcess),e.setFloat("screen_width",i._scene.getEngine().getRenderingCanvas().width),e.setFloat("screen_height",i._scene.getEngine().getRenderingCanvas().height)}},i.prototype._createDepthOfFieldPostProcess=function(t){var i=this;this._depthOfFieldPostProcess=new e.PostProcess("LensDepthOfField","depthOfField",["grain_amount","blur_noise","screen_width","screen_height","distortion","dof_enabled","screen_distance","aperture","darken","edge_blur","highlights","near","far"],["depthSampler","grainSampler","highlightsSampler"],t,null,e.Texture.TRILINEAR_SAMPLINGMODE,this._scene.getEngine(),!1),this._depthOfFieldPostProcess.onApply=function(e){e.setTexture("depthSampler",i._depthTexture),e.setTexture("grainSampler",i._grainTexture),e.setTextureFromPostProcess("textureSampler",i._highlightsPostProcess),e.setTextureFromPostProcess("highlightsSampler",i._depthOfFieldPostProcess),e.setFloat("grain_amount",i._grainAmount),e.setBool("blur_noise",i._blurNoise),e.setFloat("screen_width",i._scene.getEngine().getRenderingCanvas().width),e.setFloat("screen_height",i._scene.getEngine().getRenderingCanvas().height),e.setFloat("distortion",i._distortion),e.setBool("dof_enabled",-1!==i._dofDistance),e.setFloat("screen_distance",1/(.1-1/i._dofDistance)),e.setFloat("aperture",i._dofAperture),e.setFloat("darken",i._dofDarken),e.setFloat("edge_blur",i._edgeBlur),e.setBool("highlights",-1!==i._highlightsGain),e.setFloat("near",i._scene.activeCamera.minZ),e.setFloat("far",i._scene.activeCamera.maxZ)}},i.prototype._createGrainTexture=function(){var t=512;this._grainTexture=new e.DynamicTexture("LensNoiseTexture",t,this._scene,!1,e.Texture.BILINEAR_SAMPLINGMODE),this._grainTexture.wrapU=e.Texture.WRAP_ADDRESSMODE,this._grainTexture.wrapV=e.Texture.WRAP_ADDRESSMODE;for(var i,n=this._grainTexture.getContext(),r=function(e,t){return Math.random()*(t-e)+e},o=0;t>o;o++)for(var s=0;t>s;s++)i=Math.floor(255*r(.42,.58)),n.fillStyle="rgb("+i+", "+i+", "+i+")",n.fillRect(o,s,1,1);this._grainTexture.update(!1)},i}(e.PostProcessRenderPipeline);e.LensRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a,h){var l=this;t.call(this,i,"colorCorrection",null,["colorTable"],r,o,s,a,h),this._colorTableTexture=new e.Texture(n,o.getScene(),!0,!1,e.Texture.TRILINEAR_SAMPLINGMODE),this._colorTableTexture.anisotropicFilteringLevel=1,this._colorTableTexture.wrapU=e.Texture.CLAMP_ADDRESSMODE,this._colorTableTexture.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.onApply=function(e){e.setTexture("colorTable",l._colorTableTexture)}}return __extends(i,t),i}(e.PostProcess);e.ColorCorrectionPostProcess=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){
function i(i,n,r,o){t.call(this,i,n,o),this.interaxialDistance=r,this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r})}return __extends(i,t),i.prototype.getTypeName=function(){return"AnaglyphFreeCamera"},i}(e.FreeCamera);e.AnaglyphFreeCamera=t;var i=function(t){function i(i,n,r,o,s,a,h){t.call(this,i,n,r,o,s,h),this.interaxialDistance=a,this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:a})}return __extends(i,t),i.prototype.getTypeName=function(){return"AnaglyphArcRotateCamera"},i}(e.ArcRotateCamera);e.AnaglyphArcRotateCamera=i;var n=function(t){function i(i,n,r,o){t.call(this,i,n,o),this.interaxialDistance=r,this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r})}return __extends(i,t),i.prototype.getTypeName=function(){return"AnaglyphGamepadCamera"},i}(e.GamepadCamera);e.AnaglyphGamepadCamera=n;var r=function(t){function i(i,n,r,o){t.call(this,i,n,o),this.interaxialDistance=r,this.setCameraRigMode(e.Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH,{interaxialDistance:r})}return __extends(i,t),i.prototype.getTypeName=function(){return"AnaglyphUniversalCamera"},i}(e.UniversalCamera);e.AnaglyphUniversalCamera=r;var o=function(t){function i(i,n,r,o,s){t.call(this,i,n,s),this.interaxialDistance=r,this.isStereoscopicSideBySide=o,this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r})}return __extends(i,t),i.prototype.getTypeName=function(){return"StereoscopicFreeCamera"},i}(e.FreeCamera);e.StereoscopicFreeCamera=o;var s=function(t){function i(i,n,r,o,s,a,h,l){t.call(this,i,n,r,o,s,l),this.interaxialDistance=a,this.isStereoscopicSideBySide=h,this.setCameraRigMode(h?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:a})}return __extends(i,t),i.prototype.getTypeName=function(){return"StereoscopicArcRotateCamera"},i}(e.ArcRotateCamera);e.StereoscopicArcRotateCamera=s;var a=function(t){function i(i,n,r,o,s){t.call(this,i,n,s),this.interaxialDistance=r,this.isStereoscopicSideBySide=o,this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r})}return __extends(i,t),i.prototype.getTypeName=function(){return"StereoscopicGamepadCamera"},i}(e.GamepadCamera);e.StereoscopicGamepadCamera=a;var h=function(t){function i(i,n,r,o,s){t.call(this,i,n,s),this.interaxialDistance=r,this.isStereoscopicSideBySide=o,this.setCameraRigMode(o?e.Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:e.Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER,{interaxialDistance:r})}return __extends(i,t),i.prototype.getTypeName=function(){return"StereoscopicUniversalCamera"},i}(e.UniversalCamera);e.StereoscopicUniversalCamera=h}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(n,r,o,s,a){var h=this;void 0===s&&(s=null),t.call(this,r.getEngine(),n),this.gaussCoeff=.3,this.gaussMean=1,this.gaussStandDev=.8,this.gaussMultiplier=4,this.exposure=1,this.minimumLuminance=1,this.maximumLuminance=1e20,this.luminanceIncreaserate=.5,this.luminanceDecreaseRate=.5,this.brightThreshold=.8,this._needUpdate=!0,this._scene=r,this._createBrightPassPostProcess(r,o),this._createDownSampleX4PostProcess(r,o),this._createGaussianBlurPostProcess(r,o),this._createTextureAdderPostProcess(r,o),this._createLuminanceGeneratorPostProcess(r),this._createHDRPostProcess(r,o),null===s?this._originalPostProcess=new e.PassPostProcess("hdr",o,null,e.Texture.BILINEAR_SAMPLINGMODE,r.getEngine(),!1):this._originalPostProcess=s,this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRPassPostProcess",function(){return h._originalPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRBrightPass",function(){return h._brightPassPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRDownSampleX4",function(){return h._downSampleX4PostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRGaussianBlurH",function(){return h._guassianBlurHPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRGaussianBlurV",function(){return h._guassianBlurVPostProcess},!0)),this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRTextureAdder",function(){return h._textureAdderPostProcess},!0));for(var l=function(t){h.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDRDownSampler"+t,function(){return h._downSamplePostProcesses[t]},!0))},c=i.LUM_STEPS-1;c>=0;c--)l(c);this.addEffect(new e.PostProcessRenderEffect(r.getEngine(),"HDR",function(){return h._hdrPostProcess},!0)),r.postProcessRenderPipelineManager.addPipeline(this),null!==a&&r.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(n,a),this.update()}return __extends(i,t),i.prototype.update=function(){this._needUpdate=!0},i.prototype.getCurrentLuminance=function(){return this._hdrCurrentLuminance},i.prototype.getOutputLuminance=function(){return this._hdrOutputLuminance},i.prototype.dispose=function(){this._originalPostProcess=void 0,this._brightPassPostProcess=void 0,this._downSampleX4PostProcess=void 0,this._guassianBlurHPostProcess=void 0,this._guassianBlurVPostProcess=void 0,this._textureAdderPostProcess=void 0;for(var e=i.LUM_STEPS-1;e>=0;e--)this._downSamplePostProcesses[e]=void 0;this._hdrPostProcess=void 0,this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name,this._scene.cameras)},i.prototype._createHDRPostProcess=function(t,i){var n=this,r=0;this._hdrOutputLuminance=-1,this._hdrCurrentLuminance=1,this._hdrPostProcess=new e.PostProcess("hdr","hdr",["exposure","avgLuminance"],["otherSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define HDR"),this._hdrPostProcess.onApply=function(i){if(n._hdrOutputLuminance<0)n._hdrOutputLuminance=n._hdrCurrentLuminance;else{var o=(r-(r+t.getEngine().getDeltaTime()))/1e3;n._hdrCurrentLuminance<n._hdrOutputLuminance+n.luminanceDecreaseRate*o?n._hdrOutputLuminance+=n.luminanceDecreaseRate*o:n._hdrCurrentLuminance>n._hdrOutputLuminance-n.luminanceIncreaserate*o?n._hdrOutputLuminance-=n.luminanceIncreaserate*o:n._hdrOutputLuminance=n._hdrCurrentLuminance}n._hdrOutputLuminance=e.MathTools.Clamp(n._hdrOutputLuminance,n.minimumLuminance,n.maximumLuminance),r+=t.getEngine().getDeltaTime(),i.setTextureFromPostProcess("textureSampler",n._textureAdderPostProcess),i.setTextureFromPostProcess("otherSampler",n._originalPostProcess),i.setFloat("exposure",n.exposure),i.setFloat("avgLuminance",n._hdrOutputLuminance),n._needUpdate=!1}},i.prototype._createTextureAdderPostProcess=function(t,i){var n=this;this._textureAdderPostProcess=new e.PostProcess("hdr","hdr",[],["otherSampler"],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define TEXTURE_ADDER"),this._textureAdderPostProcess.onApply=function(e){e.setTextureFromPostProcess("otherSampler",n._originalPostProcess)}},i.prototype._createDownSampleX4PostProcess=function(t,i){var n=this,r=new Array(32);this._downSampleX4PostProcess=new e.PostProcess("hdr","hdr",["dsOffsets"],[],i/4,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define DOWN_SAMPLE_X4"),this._downSampleX4PostProcess.onApply=function(e){if(n._needUpdate)for(var t=0,i=-2;2>i;i++)for(var o=-2;2>o;o++)r[t]=(i+.5)*(1/n._downSampleX4PostProcess.width),r[t+1]=(o+.5)*(1/n._downSampleX4PostProcess.height),t+=2;e.setArray2("dsOffsets",r)}},i.prototype._createBrightPassPostProcess=function(t,i){var n=this,r=new Array(8),o=function(e){if(n._needUpdate){var t=1/n._brightPassPostProcess.width,i=1/n._brightPassPostProcess.height;r[0]=-.5*t,r[1]=.5*i,r[2]=.5*t,r[3]=.5*i,r[4]=-.5*t,r[5]=-.5*i,r[6]=.5*t,r[7]=-.5*i}e.setArray2("dsOffsets",r),e.setFloat("brightThreshold",n.brightThreshold)};this._brightPassPostProcess=new e.PostProcess("hdr","hdr",["dsOffsets","brightThreshold"],[],i,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define BRIGHT_PASS"),this._brightPassPostProcess.onApply=o},i.prototype._createLuminanceGeneratorPostProcess=function(t){var n,r=this,o=i.LUM_STEPS,s=new Array(8),a=new Array(18);this._downSamplePostProcesses=new Array(o);var h=function(e,t){var i=1/e,n=1/t;s[0]=-.5*i,s[1]=.5*n,s[2]=.5*i,s[3]=.5*n,s[4]=-.5*i,s[5]=-.5*n,s[6]=.5*i,s[7]=-.5*n},l=function(e,t){for(var i=0,n=-1;2>n;n++)for(var r=-1;2>r;r++)a[i]=n/e,a[i+1]=r/t,i+=2},c=function(e){r._needUpdate&&h(r._textureAdderPostProcess.width,r._textureAdderPostProcess.height),e.setTextureFromPostProcess("textureSampler",r._textureAdderPostProcess),e.setArray2("lumOffsets",s)},u=function(e){var t=e;return function(e){h(r._downSamplePostProcesses[t].width,r._downSamplePostProcesses[t].height),l(r._downSamplePostProcesses[t].width,r._downSamplePostProcesses[t].height),n=.5/r._downSamplePostProcesses[t].width,e.setTextureFromPostProcess("textureSampler",r._downSamplePostProcesses[t+1]),e.setFloat("halfDestPixelSize",n),e.setArray2("dsOffsets",a)}},d=function(i){var n=t.getEngine().readPixels(0,0,1,1),o=new e.Vector4(1/16581375,1/65025,1/255,1);r._hdrCurrentLuminance=(n[0]*o.x+n[1]*o.y+n[2]*o.z+n[3]*o.w)/100},f={width:Math.pow(3,o-1),height:Math.pow(3,o-1)};this._downSamplePostProcesses[o-1]=new e.PostProcess("hdr","hdr",["lumOffsets"],[],f,null,e.Texture.NEAREST_SAMPLINGMODE,t.getEngine(),!1,"#define LUMINANCE_GENERATOR",e.Engine.TEXTURETYPE_FLOAT),this._downSamplePostProcesses[o-1].onApply=c;for(var p=o-2;p>=0;p--){var _=Math.pow(3,p);f={width:_,height:_};var m="#define DOWN_SAMPLE\n";0===p&&(m+="#define FINAL_DOWN_SAMPLE\n"),this._downSamplePostProcesses[p]=new e.PostProcess("hdr","hdr",["dsOffsets","halfDestPixelSize"],[],f,null,e.Texture.NEAREST_SAMPLINGMODE,t.getEngine(),!1,m,e.Engine.TEXTURETYPE_FLOAT),this._downSamplePostProcesses[p].onApply=u(p),0===p&&(this._downSamplePostProcesses[p].onAfterRender=d)}},i.prototype._createGaussianBlurPostProcess=function(t,i){var n=this,r=new Array(9),o=new Array(9),s=new Array(9),a=["blurOffsets","blurWeights","multiplier"],h=function(e){for(var i={width:t.getEngine().getRenderWidth(),height:t.getEngine().getRenderHeight()},n=0;9>n;n++){var s=(n-4)*(1/(e===!0?i.height:i.width));e?o[n]=s:r[n]=s}},l=function(){for(var e=0,t=0;9>t;t++)e=(t-4)/4,s[t]=n.gaussCoeff*(1/Math.sqrt(2*Math.PI*n.gaussStandDev))*Math.exp(-((e-n.gaussMean)*(e-n.gaussMean))/(2*n.gaussStandDev*n.gaussStandDev))},c=function(e){return function(t){n._needUpdate&&(l(),h(e)),t.setArray("blurOffsets",e?o:r),t.setArray("blurWeights",s),t.setFloat("multiplier",n.gaussMultiplier)}};this._guassianBlurHPostProcess=new e.PostProcess("hdr","hdr",a,[],i/4,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define GAUSSIAN_BLUR_H"),this._guassianBlurHPostProcess.onApply=c(!1),this._guassianBlurVPostProcess=new e.PostProcess("hdr","hdr",a,[],i/4,null,e.Texture.BILINEAR_SAMPLINGMODE,t.getEngine(),!1,"#define GAUSSIAN_BLUR_V"),this._guassianBlurVPostProcess.onApply=c(!0)},i.LUM_STEPS=6,i}(e.PostProcessRenderPipeline);e.HDRRenderingPipeline=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function e(){this.edges=new Array,this.edgesConnectedCount=0}return e}(),i=function(){function i(e,t,i){void 0===t&&(t=.95),void 0===i&&(i=!1),this.edgesWidthScalerForOrthographic=1e3,this.edgesWidthScalerForPerspective=50,this._linesPositions=new Array,this._linesNormals=new Array,this._linesIndices=new Array,this._buffers={},this._checkVerticesInsteadOfIndices=!1,this._source=e,this._checkVerticesInsteadOfIndices=i,this._epsilon=t,this._prepareRessources(),this._generateEdgesLines()}return i.prototype._prepareRessources=function(){this._lineShader||(this._lineShader=new e.ShaderMaterial("lineShader",this._source.getScene(),"line",{attributes:["position","normal"],uniforms:["worldViewProjection","color","width","aspectRatio"]}),this._lineShader.disableDepthWrite=!0,this._lineShader.backFaceCulling=!1)},i.prototype.dispose=function(){var t=this._buffers[e.VertexBuffer.PositionKind];t&&(t.dispose(),this._buffers[e.VertexBuffer.PositionKind]=null),t=this._buffers[e.VertexBuffer.NormalKind],t&&(t.dispose(),this._buffers[e.VertexBuffer.NormalKind]=null),this._source.getScene().getEngine()._releaseBuffer(this._ib),this._lineShader.dispose()},i.prototype._processEdgeForAdjacencies=function(e,t,i,n,r){return e===i&&t===n||e===n&&t===i?0:e===n&&t===r||e===r&&t===n?1:e===r&&t===i||e===i&&t===r?2:-1},i.prototype._processEdgeForAdjacenciesWithVertices=function(e,t,i,n,r){return e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(n)||e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(i)?0:e.equalsWithEpsilon(n)&&t.equalsWithEpsilon(r)||e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(n)?1:e.equalsWithEpsilon(r)&&t.equalsWithEpsilon(i)||e.equalsWithEpsilon(i)&&t.equalsWithEpsilon(r)?2:-1},i.prototype._checkEdge=function(t,i,n,r,o){var s;if(void 0===i)s=!0;else{var a=e.Vector3.Dot(n[t],n[i]);s=a<this._epsilon}if(s){var h=this._linesPositions.length/3,l=r.subtract(o);l.normalize(),this._linesPositions.push(r.x),this._linesPositions.push(r.y),this._linesPositions.push(r.z),this._linesPositions.push(r.x),this._linesPositions.push(r.y),this._linesPositions.push(r.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesPositions.push(o.x),this._linesPositions.push(o.y),this._linesPositions.push(o.z),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(-1),this._linesNormals.push(o.x),this._linesNormals.push(o.y),this._linesNormals.push(o.z),this._linesNormals.push(1),this._linesNormals.push(r.x),this._linesNormals.push(r.y),this._linesNormals.push(r.z),this._linesNormals.push(-1),this._linesNormals.push(r.x),this._linesNormals.push(r.y),this._linesNormals.push(r.z),this._linesNormals.push(1),this._linesIndices.push(h),this._linesIndices.push(h+1),this._linesIndices.push(h+2),this._linesIndices.push(h),this._linesIndices.push(h+2),this._linesIndices.push(h+3)}},i.prototype._generateEdgesLines=function(){var i,n,r=this._source.getVerticesData(e.VertexBuffer.PositionKind),o=this._source.getIndices(),s=new Array,a=new Array;for(i=0;i<o.length;i+=3){n=new t;var h=o[i],l=o[i+1],c=o[i+2];n.p0=new e.Vector3(r[3*h],r[3*h+1],r[3*h+2]),n.p1=new e.Vector3(r[3*l],r[3*l+1],r[3*l+2]),n.p2=new e.Vector3(r[3*c],r[3*c+1],r[3*c+2]);var u=e.Vector3.Cross(n.p1.subtract(n.p0),n.p2.subtract(n.p1));u.normalize(),a.push(u),s.push(n)}for(i=0;i<s.length;i++){n=s[i];for(var d=i+1;d<s.length;d++){var f=s[d];if(3===n.edgesConnectedCount)break;if(3!==f.edgesConnectedCount)for(var p=o[3*d],_=o[3*d+1],m=o[3*d+2],g=0;3>g;g++){var v;if(void 0===n.edges[g]){switch(g){case 0:v=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(n.p0,n.p1,f.p0,f.p1,f.p2):this._processEdgeForAdjacencies(o[3*i],o[3*i+1],p,_,m);break;case 1:v=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(n.p1,n.p2,f.p0,f.p1,f.p2):this._processEdgeForAdjacencies(o[3*i+1],o[3*i+2],p,_,m);break;case 2:v=this._checkVerticesInsteadOfIndices?this._processEdgeForAdjacenciesWithVertices(n.p2,n.p0,f.p0,f.p1,f.p2):this._processEdgeForAdjacencies(o[3*i+2],o[3*i],p,_,m)}if(-1!==v&&(n.edges[g]=d,f.edges[v]=i,n.edgesConnectedCount++,f.edgesConnectedCount++,3===n.edgesConnectedCount))break}}}}for(i=0;i<s.length;i++){var y=s[i];this._checkEdge(i,y.edges[0],a,y.p0,y.p1),this._checkEdge(i,y.edges[1],a,y.p1,y.p2),this._checkEdge(i,y.edges[2],a,y.p2,y.p0)}var b=this._source.getScene().getEngine();this._buffers[e.VertexBuffer.PositionKind]=new e.VertexBuffer(b,this._linesPositions,e.VertexBuffer.PositionKind,!1),this._buffers[e.VertexBuffer.NormalKind]=new e.VertexBuffer(b,this._linesNormals,e.VertexBuffer.NormalKind,!1,!1,4),this._ib=b.createIndexBuffer(this._linesIndices),this._indicesCount=this._linesIndices.length},i.prototype.render=function(){if(this._lineShader.isReady()){var t=this._source.getScene(),i=t.getEngine();this._lineShader._preBind(),i.bindBuffers(this._buffers,this._ib,this._lineShader.getEffect()),t.resetCachedMaterial(),this._lineShader.setColor4("color",this._source.edgesColor),t.activeCamera.mode===e.Camera.ORTHOGRAPHIC_CAMERA?this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForOrthographic):this._lineShader.setFloat("width",this._source.edgesWidth/this.edgesWidthScalerForPerspective),this._lineShader.setFloat("aspectRatio",i.getAspectRatio(t.activeCamera)),this._lineShader.bind(this._source.getWorldMatrix()),i.draw(!0,0,this._indicesCount),this._lineShader.unbind(),i.setDepthWrite(!0)}},i}();e.EdgesRenderer=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){!function(e){e[e.Hable=0]="Hable",e[e.Reinhard=1]="Reinhard",e[e.HejiDawson=2]="HejiDawson",e[e.Photographic=3]="Photographic"}(e.TonemappingOperator||(e.TonemappingOperator={}));var t=e.TonemappingOperator,i=function(i){function n(n,r,o,s,a,h,l){var c=this;void 0===a&&(a=e.Texture.BILINEAR_SAMPLINGMODE),void 0===l&&(l=e.Engine.TEXTURETYPE_UNSIGNED_INT),i.call(this,n,"tonemap",["_ExposureAdjustment"],null,1,s,a,h,!0,u,l),this._operator=r,this.exposureAdjustment=o;var u="#define ";this._operator===t.Hable?u+="HABLE_TONEMAPPING":this._operator===t.Reinhard?u+="REINHARD_TONEMAPPING":this._operator===t.HejiDawson?u+="OPTIMIZED_HEJIDAWSON_TONEMAPPING":this._operator===t.Photographic&&(u+="PHOTOGRAPHIC_TONEMAPPING"),this.updateEffect(u),this.onApply=function(e){e.setFloat("_ExposureAdjustment",c.exposureAdjustment)}}return __extends(n,i),n}(e.PostProcess);e.TonemapPostProcess=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r){var o=this;void 0===r&&(r=!0),this.name=t,this._viewMatrix=e.Matrix.Identity(),this._target=e.Vector3.Zero(),this._add=e.Vector3.Zero(),this.invertYAxis=!1,this.position=e.Vector3.Zero(),this._scene=n,this._scene.reflectionProbes.push(this),this._renderTargetTexture=new e.RenderTargetTexture(t,i,n,r,!0,e.Engine.TEXTURETYPE_UNSIGNED_INT,!0),this._renderTargetTexture.onBeforeRenderObservable.add(function(t){switch(t){case 0:o._add.copyFromFloats(1,0,0);break;case 1:o._add.copyFromFloats(-1,0,0);break;case 2:o._add.copyFromFloats(0,o.invertYAxis?1:-1,0);break;case 3:o._add.copyFromFloats(0,o.invertYAxis?-1:1,0);break;case 4:o._add.copyFromFloats(0,0,1);break;case 5:o._add.copyFromFloats(0,0,-1)}o._attachedMesh&&o.position.copyFrom(o._attachedMesh.getAbsolutePosition()),o.position.addToRef(o._add,o._target),e.Matrix.LookAtLHToRef(o.position,o._target,e.Vector3.Up(),o._viewMatrix),n.setTransformMatrix(o._viewMatrix,o._projectionMatrix)}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){n.updateTransformMatrix(!0)}),this._projectionMatrix=e.Matrix.PerspectiveFovLH(Math.PI/2,1,n.activeCamera.minZ,n.activeCamera.maxZ)}return Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(e){this._renderTargetTexture.refreshRate=e},enumerable:!0,configurable:!0}),t.prototype.getScene=function(){return this._scene},Object.defineProperty(t.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!0,configurable:!0}),t.prototype.attachToMesh=function(e){this._attachedMesh=e},t.prototype.dispose=function(){var e=this._scene.reflectionProbes.indexOf(this);-1!==e&&this._scene.reflectionProbes.splice(e,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},t}();e.ReflectionProbe=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n,r,o){this.color=new e.Color4(1,1,1,1),this.position=e.Vector3.Zero(),this.rotation=e.Vector3.Zero(),this.scaling=new e.Vector3(1,1,1),this.uvs=new e.Vector4(0,0,1,1),this.velocity=e.Vector3.Zero(),this.alive=!0,this.isVisible=!0,this.idx=t,this._pos=i,this._model=n,this.shapeId=r,this.idxInShape=o}return Object.defineProperty(t.prototype,"scale",{get:function(){return this.scaling},set:function(e){this.scaling=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(e){this.rotationQuaternion=e},enumerable:!0,configurable:!0}),t}();e.SolidParticle=t;var i=function(){function e(e,t,i,n,r){this.shapeID=e,this._shape=t,this._shapeUV=i,this._positionFunction=n,this._vertexFunction=r}return e}();e.ModelShape=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t,i,n){this.particles=new Array,this.nbParticles=0,this.billboard=!1,this.counter=0,this.vars={},this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._index=0,this._updatable=!0,this._pickable=!1,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._shapeCounter=0,this._copy=new e.SolidParticle(null,null,null,null,null),this._color=new e.Color4(0,0,0,0),this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeParticleVertex=!1,this._computeBoundingBox=!1,this._cam_axisZ=e.Vector3.Zero(),this._cam_axisY=e.Vector3.Zero(),this._cam_axisX=e.Vector3.Zero(),this._axisX=e.Axis.X,this._axisY=e.Axis.Y,this._axisZ=e.Axis.Z,this._fakeCamPos=e.Vector3.Zero(),this._rotMatrix=new e.Matrix,this._invertMatrix=new e.Matrix,this._rotated=e.Vector3.Zero(),this._quaternion=new e.Quaternion,this._vertex=e.Vector3.Zero(),this._normal=e.Vector3.Zero(),this._yaw=0,this._pitch=0,this._roll=0,this._halfroll=0,this._halfpitch=0,this._halfyaw=0,this._sinRoll=0,this._cosRoll=0,this._sinPitch=0,this._cosPitch=0,this._sinYaw=0,this._cosYaw=0,this._w=0,this._minimum=e.Tmp.Vector3[0],this._maximum=e.Tmp.Vector3[1],this.name=t,this._scene=i,this._camera=i.activeCamera,this._pickable=!!n&&n.isPickable,n&&n.updatable?this._updatable=n.updatable:this._updatable=!0,this._pickable&&(this.pickedParticles=[])}return t.prototype.buildMesh=function(){if(0===this.nbParticles){var t=e.MeshBuilder.CreateDisc("",{radius:1,tessellation:3},this._scene);this.addShape(t,1),t.dispose()}this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors),e.VertexData.ComputeNormals(this._positions32,this._indices,this._normals),this._normals32=new Float32Array(this._normals),this._fixedNormal32=new Float32Array(this._normals);var i=new e.VertexData;i.set(this._positions32,e.VertexBuffer.PositionKind),i.indices=this._indices,i.set(this._normals32,e.VertexBuffer.NormalKind),this._uvs32&&i.set(this._uvs32,e.VertexBuffer.UVKind),this._colors32&&i.set(this._colors32,e.VertexBuffer.ColorKind);var n=new e.Mesh(this.name,this._scene);return i.applyToMesh(n,this._updatable),this.mesh=n,this.mesh.isPickable=this._pickable,this._positions=null,this._normals=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0),n},t.prototype.digest=function(t,i){var n=i&&i.facetNb||1,r=i&&i.number,o=i&&i.delta||0,s=t.getVerticesData(e.VertexBuffer.PositionKind),a=t.getIndices(),h=t.getVerticesData(e.VertexBuffer.UVKind),l=t.getVerticesData(e.VertexBuffer.ColorKind),c=0,u=a.length/3;r?(r=r>u?u:r,n=Math.round(u/r),o=0):n=n>u?u:n;for(var d=[],f=[],p=[],_=[],m=e.Tmp.Vector3[0],g=n;u>c;){n=g+Math.floor((1+o)*Math.random()),c>u-n&&(n=u-c),d.length=0,f.length=0,p.length=0,_.length=0;for(var v=0,y=3*c;3*(c+n)>y;y++){f.push(v);var b=a[y];d.push(s[3*b],s[3*b+1],s[3*b+2]),h&&p.push(h[2*b],h[2*b+1]),l&&_.push(l[4*b],l[4*b+1],l[4*b+2],l[4*b+3]),v++}var x,P=this.nbParticles,A=this._posToShape(d),C=this._uvsToShapeUV(p);for(x=0;x<A.length;x++)m.addInPlace(A[x]);for(m.scaleInPlace(1/A.length),x=0;x<A.length;x++)A[x].subtractInPlace(m);var E=new e.ModelShape(this._shapeCounter,A,C,null,null);this._meshBuilder(this._index,A,this._positions,f,this._indices,p,this._uvs,_,this._colors,P,0,null),this._addParticle(P,this._positions.length,E,this._shapeCounter,0),this.particles[this.nbParticles].position.addInPlace(m),this._index+=A.length,P++,this.nbParticles++,this._shapeCounter++,c+=n}return this},t.prototype._resetCopy=function(){this._copy.position.x=0,this._copy.position.y=0,this._copy.position.z=0,this._copy.rotation.x=0,this._copy.rotation.y=0,this._copy.rotation.z=0,this._copy.rotationQuaternion=null,this._copy.scaling.x=1,this._copy.scaling.y=1,this._copy.scaling.z=1,this._copy.uvs.x=0,this._copy.uvs.y=0,this._copy.uvs.z=1,this._copy.uvs.w=1,this._copy.color=null},t.prototype._meshBuilder=function(t,i,n,r,o,s,a,h,l,c,u,d){var f,p=0,_=0;for(this._resetCopy(),d&&d.positionFunction&&d.positionFunction(this._copy,c,u),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),f=0;f<i.length;f++)this._vertex.x=i[f].x,this._vertex.y=i[f].y,this._vertex.z=i[f].z,d&&d.vertexFunction&&d.vertexFunction(this._copy,this._vertex,f),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,e.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),n.push(this._copy.position.x+this._rotated.x,this._copy.position.y+this._rotated.y,this._copy.position.z+this._rotated.z),s&&(a.push((this._copy.uvs.z-this._copy.uvs.x)*s[p]+this._copy.uvs.x,(this._copy.uvs.w-this._copy.uvs.y)*s[p+1]+this._copy.uvs.y),p+=2),this._copy.color?this._color=this._copy.color:h&&h[_]?(this._color.r=h[_],this._color.g=h[_+1],this._color.b=h[_+2],this._color.a=h[_+3]):(this._color.r=1,this._color.g=1,this._color.b=1,this._color.a=1),l.push(this._color.r,this._color.g,this._color.b,this._color.a),_+=4;for(f=0;f<r.length;f++)o.push(t+r[f]);if(this._pickable){var m=r.length/3;for(f=0;m>f;f++)this.pickedParticles.push({idx:c,faceId:f})}},t.prototype._posToShape=function(t){for(var i=[],n=0;n<t.length;n+=3)i.push(new e.Vector3(t[n],t[n+1],t[n+2]));return i},t.prototype._uvsToShapeUV=function(e){var t=[];if(e)for(var i=0;i<e.length;i++)t.push(e[i]);return t},t.prototype._addParticle=function(t,i,n,r,o){this.particles.push(new e.SolidParticle(t,i,n,r,o))},t.prototype.addShape=function(t,i,n){for(var r=t.getVerticesData(e.VertexBuffer.PositionKind),o=t.getIndices(),s=t.getVerticesData(e.VertexBuffer.UVKind),a=t.getVerticesData(e.VertexBuffer.ColorKind),h=this._posToShape(r),l=this._uvsToShapeUV(s),c=n?n.positionFunction:null,u=n?n.vertexFunction:null,d=new e.ModelShape(this._shapeCounter,h,l,c,u),f=this.nbParticles,p=0;i>p;p++)this._meshBuilder(this._index,h,this._positions,o,this._indices,s,this._uvs,a,this._colors,f,p,n),this._updatable&&this._addParticle(f,this._positions.length,d,this._shapeCounter,p),this._index+=h.length,f++;return this.nbParticles+=i,this._shapeCounter++,this._shapeCounter-1},t.prototype._rebuildParticle=function(t){this._resetCopy(),t._model._positionFunction&&t._model._positionFunction(this._copy,t.idx,t.idxInShape),this._copy.rotationQuaternion?this._quaternion.copyFrom(this._copy.rotationQuaternion):(this._yaw=this._copy.rotation.y,this._pitch=this._copy.rotation.x,this._roll=this._copy.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix(),this._shape=t._model._shape;for(var i=0;i<this._shape.length;i++)this._vertex.x=this._shape[i].x,this._vertex.y=this._shape[i].y,this._vertex.z=this._shape[i].z,t._model._vertexFunction&&t._model._vertexFunction(this._copy,this._vertex,i),this._vertex.x*=this._copy.scaling.x,this._vertex.y*=this._copy.scaling.y,this._vertex.z*=this._copy.scaling.z,e.Vector3.TransformCoordinatesToRef(this._vertex,this._rotMatrix,this._rotated),this._positions32[t._pos+3*i]=this._copy.position.x+this._rotated.x,this._positions32[t._pos+3*i+1]=this._copy.position.y+this._rotated.y,this._positions32[t._pos+3*i+2]=this._copy.position.z+this._rotated.z;t.position.x=0,t.position.y=0,t.position.z=0,t.rotation.x=0,t.rotation.y=0,t.rotation.z=0,t.rotationQuaternion=null,t.scaling.x=1,t.scaling.y=1,t.scaling.z=1},t.prototype.rebuildMesh=function(){for(var t=0;t<this.particles.length;t++)this._rebuildParticle(this.particles[t]);this.mesh.updateVerticesData(e.VertexBuffer.PositionKind,this._positions32,!1,!1)},t.prototype.setParticles=function(t,i,n){if(void 0===t&&(t=0),void 0===i&&(i=this.nbParticles-1),void 0===n&&(n=!0),this._updatable){this.beforeUpdateParticles(t,i,n),this._cam_axisX.x=1,this._cam_axisX.y=0,this._cam_axisX.z=0,this._cam_axisY.x=0,this._cam_axisY.y=1,this._cam_axisY.z=0,this._cam_axisZ.x=0,this._cam_axisZ.y=0,this._cam_axisZ.z=1,this.billboard&&(this._yaw=this.mesh.rotation.y,this._pitch=this.mesh.rotation.x,this._roll=this.mesh.rotation.z,this._quaternionRotationYPR(),this._quaternionToRotationMatrix(),this._rotMatrix.invertToRef(this._invertMatrix),e.Vector3.TransformCoordinatesToRef(this._camera.globalPosition,this._invertMatrix,this._fakeCamPos),this._fakeCamPos.subtractToRef(this.mesh.position,this._cam_axisZ),e.Vector3.CrossToRef(this._cam_axisZ,this._axisX,this._cam_axisY),e.Vector3.CrossToRef(this._cam_axisZ,this._cam_axisY,this._cam_axisX),this._cam_axisY.normalize(),this._cam_axisX.normalize(),this._cam_axisZ.normalize()),e.Matrix.IdentityToRef(this._rotMatrix);var r=0,o=0,s=0,a=0,h=0,l=0,c=0;this._computeBoundingBox&&(e.Vector3.FromFloatsToRef(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this._minimum),e.Vector3.FromFloatsToRef(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this._maximum)),i=i>this.nbParticles-1?this.nbParticles-1:i;for(var u=t;i>=u;u++){if(this._particle=this.particles[u],this._shape=this._particle._model._shape,this._shapeUV=this._particle._model._shapeUV,this.updateParticle(this._particle),this._particle.isVisible)for(this.billboard&&(this._particle.rotation.x=0,this._particle.rotation.y=0),this._computeParticleRotation&&(this._particle.rotationQuaternion?this._quaternion.copyFrom(this._particle.rotationQuaternion):(this._yaw=this._particle.rotation.y,this._pitch=this._particle.rotation.x,this._roll=this._particle.rotation.z,this._quaternionRotationYPR()),this._quaternionToRotationMatrix()),c=0;c<this._shape.length;c++)r=o+3*c,s=a+4*c,h=l+2*c,this._vertex.x=this._shape[c].x,this._vertex.y=this._shape[c].y,this._vertex.z=this._shape[c].z,this._computeParticleVertex&&this.updateParticleVertex(this._particle,this._vertex,c),this._vertex.x*=this._particle.scaling.x,this._vertex.y*=this._particle.scaling.y,this._vertex.z*=this._particle.scaling.z,this._w=this._vertex.x*this._rotMatrix.m[3]+this._vertex.y*this._rotMatrix.m[7]+this._vertex.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._vertex.x*this._rotMatrix.m[0]+this._vertex.y*this._rotMatrix.m[4]+this._vertex.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._vertex.x*this._rotMatrix.m[1]+this._vertex.y*this._rotMatrix.m[5]+this._vertex.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._vertex.x*this._rotMatrix.m[2]+this._vertex.y*this._rotMatrix.m[6]+this._vertex.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._positions32[r]=this._particle.position.x+this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._positions32[r+1]=this._particle.position.y+this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._positions32[r+2]=this._particle.position.z+this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z,this._computeBoundingBox&&(this._positions32[r]<this._minimum.x&&(this._minimum.x=this._positions32[r]),this._positions32[r]>this._maximum.x&&(this._maximum.x=this._positions32[r]),this._positions32[r+1]<this._minimum.y&&(this._minimum.y=this._positions32[r+1]),this._positions32[r+1]>this._maximum.y&&(this._maximum.y=this._positions32[r+1]),this._positions32[r+2]<this._minimum.z&&(this._minimum.z=this._positions32[r+2]),this._positions32[r+2]>this._maximum.z&&(this._maximum.z=this._positions32[r+2])),
this._computeParticleVertex||this.billboard||(this._normal.x=this._fixedNormal32[r],this._normal.y=this._fixedNormal32[r+1],this._normal.z=this._fixedNormal32[r+2],this._w=this._normal.x*this._rotMatrix.m[3]+this._normal.y*this._rotMatrix.m[7]+this._normal.z*this._rotMatrix.m[11]+this._rotMatrix.m[15],this._rotated.x=(this._normal.x*this._rotMatrix.m[0]+this._normal.y*this._rotMatrix.m[4]+this._normal.z*this._rotMatrix.m[8]+this._rotMatrix.m[12])/this._w,this._rotated.y=(this._normal.x*this._rotMatrix.m[1]+this._normal.y*this._rotMatrix.m[5]+this._normal.z*this._rotMatrix.m[9]+this._rotMatrix.m[13])/this._w,this._rotated.z=(this._normal.x*this._rotMatrix.m[2]+this._normal.y*this._rotMatrix.m[6]+this._normal.z*this._rotMatrix.m[10]+this._rotMatrix.m[14])/this._w,this._normals32[r]=this._cam_axisX.x*this._rotated.x+this._cam_axisY.x*this._rotated.y+this._cam_axisZ.x*this._rotated.z,this._normals32[r+1]=this._cam_axisX.y*this._rotated.x+this._cam_axisY.y*this._rotated.y+this._cam_axisZ.y*this._rotated.z,this._normals32[r+2]=this._cam_axisX.z*this._rotated.x+this._cam_axisY.z*this._rotated.y+this._cam_axisZ.z*this._rotated.z),this._computeParticleColor&&(this._colors32[s]=this._particle.color.r,this._colors32[s+1]=this._particle.color.g,this._colors32[s+2]=this._particle.color.b,this._colors32[s+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[h]=this._shapeUV[2*c]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[h+1]=this._shapeUV[2*c+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);else for(c=0;c<this._shape.length;c++)r=o+3*c,s=a+4*c,h=l+2*c,this._positions32[r]=this._camera.position.x,this._positions32[r+1]=this._camera.position.y,this._positions32[r+2]=this._camera.position.z,this._normals32[r]=0,this._normals32[r+1]=0,this._normals32[r+2]=0,this._computeParticleColor&&(this._colors32[s]=this._particle.color.r,this._colors32[s+1]=this._particle.color.g,this._colors32[s+2]=this._particle.color.b,this._colors32[s+3]=this._particle.color.a),this._computeParticleTexture&&(this._uvs32[h]=this._shapeUV[2*c]*(this._particle.uvs.z-this._particle.uvs.x)+this._particle.uvs.x,this._uvs32[h+1]=this._shapeUV[2*c+1]*(this._particle.uvs.w-this._particle.uvs.y)+this._particle.uvs.y);o=r+3,a=s+4,l=h+2}if(n&&(this._computeParticleColor&&this.mesh.updateVerticesData(e.VertexBuffer.ColorKind,this._colors32,!1,!1),this._computeParticleTexture&&this.mesh.updateVerticesData(e.VertexBuffer.UVKind,this._uvs32,!1,!1),this.mesh.updateVerticesData(e.VertexBuffer.PositionKind,this._positions32,!1,!1),!this.mesh.areNormalsFrozen)){if(this._computeParticleVertex||this.billboard){e.VertexData.ComputeNormals(this._positions32,this._indices,this._normals32);for(var d=0;d<this._normals32.length;d++)this._fixedNormal32[d]=this._normals32[d]}this.mesh.updateVerticesData(e.VertexBuffer.NormalKind,this._normals32,!1,!1)}this._computeBoundingBox&&(this.mesh._boundingInfo=new e.BoundingInfo(this._minimum,this._maximum),this.mesh._boundingInfo.update(this.mesh._worldMatrix)),this.afterUpdateParticles(t,i,n)}},t.prototype._quaternionRotationYPR=function(){this._halfroll=.5*this._roll,this._halfpitch=.5*this._pitch,this._halfyaw=.5*this._yaw,this._sinRoll=Math.sin(this._halfroll),this._cosRoll=Math.cos(this._halfroll),this._sinPitch=Math.sin(this._halfpitch),this._cosPitch=Math.cos(this._halfpitch),this._sinYaw=Math.sin(this._halfyaw),this._cosYaw=Math.cos(this._halfyaw),this._quaternion.x=this._cosYaw*this._sinPitch*this._cosRoll+this._sinYaw*this._cosPitch*this._sinRoll,this._quaternion.y=this._sinYaw*this._cosPitch*this._cosRoll-this._cosYaw*this._sinPitch*this._sinRoll,this._quaternion.z=this._cosYaw*this._cosPitch*this._sinRoll-this._sinYaw*this._sinPitch*this._cosRoll,this._quaternion.w=this._cosYaw*this._cosPitch*this._cosRoll+this._sinYaw*this._sinPitch*this._sinRoll},t.prototype._quaternionToRotationMatrix=function(){this._rotMatrix.m[0]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.z*this._quaternion.z),this._rotMatrix.m[1]=2*(this._quaternion.x*this._quaternion.y+this._quaternion.z*this._quaternion.w),this._rotMatrix.m[2]=2*(this._quaternion.z*this._quaternion.x-this._quaternion.y*this._quaternion.w),this._rotMatrix.m[3]=0,this._rotMatrix.m[4]=2*(this._quaternion.x*this._quaternion.y-this._quaternion.z*this._quaternion.w),this._rotMatrix.m[5]=1-2*(this._quaternion.z*this._quaternion.z+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[6]=2*(this._quaternion.y*this._quaternion.z+this._quaternion.x*this._quaternion.w),this._rotMatrix.m[7]=0,this._rotMatrix.m[8]=2*(this._quaternion.z*this._quaternion.x+this._quaternion.y*this._quaternion.w),this._rotMatrix.m[9]=2*(this._quaternion.y*this._quaternion.z-this._quaternion.x*this._quaternion.w),this._rotMatrix.m[10]=1-2*(this._quaternion.y*this._quaternion.y+this._quaternion.x*this._quaternion.x),this._rotMatrix.m[11]=0,this._rotMatrix.m[12]=0,this._rotMatrix.m[13]=0,this._rotMatrix.m[14]=0,this._rotMatrix.m[15]=1},t.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._positions32=null,this._normals32=null,this._fixedNormal32=null,this._uvs32=null,this._colors32=null,this.pickedParticles=null},t.prototype.refreshVisibleSize=function(){this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo()},t.prototype.setVisibilityBox=function(t){var i=t/2;this.mesh._boundingInfo=new e.BoundingInfo(new e.Vector3(-i,-i,-i),new e.Vector3(i,i,i))},Object.defineProperty(t.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isVisibilityBoxLocked",{get:function(){return this._isVisibilityBoxLocked},set:function(e){this._isVisibilityBoxLocked=e,this.mesh.getBoundingInfo().isLocked=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleRotation",{get:function(){return this._computeParticleRotation},set:function(e){this._computeParticleRotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(e){this._computeParticleColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(e){this._computeParticleTexture=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeParticleVertex",{get:function(){return this._computeParticleVertex},set:function(e){this._computeParticleVertex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(e){this._computeBoundingBox=e},enumerable:!0,configurable:!0}),t.prototype.initParticles=function(){},t.prototype.recycleParticle=function(e){return e},t.prototype.updateParticle=function(e){return e},t.prototype.updateParticleVertex=function(e,t,i){return t},t.prototype.beforeUpdateParticles=function(e,t,i){},t.prototype.afterUpdateParticles=function(e,t,i){},t}();e.SolidParticleSystem=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function e(e,t,i,n){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=i,this.worldAxisForFileY=n}return e}(),n=function(){function t(){}return t.ConvertCubeMapToSphericalPolynomial=function(t){for(var i=new e.SphericalHarmonics,n=0,r=2/t.size,o=r,s=.5*r-1,a=0;6>a;a++)for(var h=this.FileFaces[a],l=t[h.name],c=s,u=0;u<t.size;u++){for(var d=s,f=0;f<t.size;f++){var p=h.worldAxisForFileX.scale(d).add(h.worldAxisForFileY.scale(c)).add(h.worldAxisForNormal);p.normalize();var _,m=Math.pow(1+d*d+c*c,-1.5),g=l[u*t.size*3+3*f+0],v=l[u*t.size*3+3*f+1],y=l[u*t.size*3+3*f+2],_=new e.Color3(g,v,y);i.addLight(p,_,m),n+=m,d+=r}c+=o}var b=4*Math.PI,x=b/n;return i.scale(x),i.scale(1/Math.PI),e.SphericalPolynomial.getSphericalPolynomialFromHarmonics(i)},t.FileFaces=[new i("right",new e.Vector3(1,0,0),new e.Vector3(0,0,-1),new e.Vector3(0,-1,0)),new i("left",new e.Vector3(-1,0,0),new e.Vector3(0,0,1),new e.Vector3(0,-1,0)),new i("up",new e.Vector3(0,1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,1)),new i("down",new e.Vector3(0,-1,0),new e.Vector3(1,0,0),new e.Vector3(0,0,-1)),new i("front",new e.Vector3(0,0,1),new e.Vector3(1,0,0),new e.Vector3(0,-1,0)),new i("back",new e.Vector3(0,0,-1),new e.Vector3(-1,0,0),new e.Vector3(0,-1,0))],t}();t.CubeMapToSphericalPolynomialTools=n}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){}return t.ConvertPanoramaToCubemap=function(e,t,i,n){if(!e)throw"ConvertPanoramaToCubemap: input cannot be null";if(e.length!=t*i*3)throw"ConvertPanoramaToCubemap: input size is wrong";var r=this.CreateCubemapTexture(n,this.FACE_FRONT,e,t,i),o=this.CreateCubemapTexture(n,this.FACE_BACK,e,t,i),s=this.CreateCubemapTexture(n,this.FACE_LEFT,e,t,i),a=this.CreateCubemapTexture(n,this.FACE_RIGHT,e,t,i),h=this.CreateCubemapTexture(n,this.FACE_UP,e,t,i),l=this.CreateCubemapTexture(n,this.FACE_DOWN,e,t,i);return{front:r,back:o,left:s,right:a,up:h,down:l,size:n}},t.CreateCubemapTexture=function(e,t,i,n,r){for(var o=new ArrayBuffer(e*e*4*3),s=new Float32Array(o),a=t[1].subtract(t[0]).scale(1/e),h=t[3].subtract(t[2]).scale(1/e),l=1/e,c=0,u=0;e>u;u++){for(var d=t[0],f=t[2],p=0;e>p;p++){var _=f.subtract(d).scale(c).add(d);_.normalize();var m=this.CalcProjectionSpherical(_,i,n,r);s[u*e*3+3*p+0]=m.r,s[u*e*3+3*p+1]=m.g,s[u*e*3+3*p+2]=m.b,d=d.add(a),f=f.add(h)}c+=l}return s},t.CalcProjectionSpherical=function(e,t,i,n){for(var r=Math.atan2(e.z,e.x),o=Math.acos(e.y);r<-Math.PI;)r+=2*Math.PI;for(;r>Math.PI;)r-=2*Math.PI;var s=r/Math.PI,a=o/Math.PI;s=.5*s+.5;var h=Math.round(s*i);0>h?h=0:h>=i&&(h=i-1);var l=Math.round(a*n);0>l?l=0:l>=n&&(l=n-1);var c=n-l-1,u=t[c*i*3+3*h+0],d=t[c*i*3+3*h+1],f=t[c*i*3+3*h+2];return{r:u,g:d,b:f}},t.FACE_FRONT=[new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1),new e.Vector3(-1,1,-1),new e.Vector3(1,1,-1)],t.FACE_BACK=[new e.Vector3(1,-1,1),new e.Vector3(-1,-1,1),new e.Vector3(1,1,1),new e.Vector3(-1,1,1)],t.FACE_RIGHT=[new e.Vector3(1,-1,-1),new e.Vector3(1,-1,1),new e.Vector3(1,1,-1),new e.Vector3(1,1,1)],t.FACE_LEFT=[new e.Vector3(-1,-1,1),new e.Vector3(-1,-1,-1),new e.Vector3(-1,1,1),new e.Vector3(-1,1,-1)],t.FACE_DOWN=[new e.Vector3(-1,1,-1),new e.Vector3(1,1,-1),new e.Vector3(-1,1,1),new e.Vector3(1,1,1)],t.FACE_UP=[new e.Vector3(-1,-1,1),new e.Vector3(1,-1,1),new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1)],t}();t.PanoramaToCubeMapTools=i}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(e){var t=function(){function t(){}return t.Ldexp=function(e,t){return t>1023?e*Math.pow(2,1023)*Math.pow(2,t-1023):-1074>t?e*Math.pow(2,-1074)*Math.pow(2,t+1074):e*Math.pow(2,t)},t.Rgbe2float=function(e,t,i,n,r,o){r>0?(r=this.Ldexp(1,r-136),e[o+0]=t*r,e[o+1]=i*r,e[o+2]=n*r):(e[o+0]=0,e[o+1]=0,e[o+2]=0)},t.readStringLine=function(e,t){for(var i="",n="",r=t;r<e.length-t&&(n=String.fromCharCode(e[r]),"\n"!=n);r++)i+=n;return i},t.RGBE_ReadHeader=function(e){var t=0,i=0,n=this.readStringLine(e,0);if("#"!=n[0]||"?"!=n[1])throw"Bad HDR Format.";var r=!1,o=!1,s=0;do s+=n.length+1,n=this.readStringLine(e,s),"FORMAT=32-bit_rle_rgbe"==n?o=!0:0==n.length&&(r=!0);while(!r);if(!o)throw"HDR Bad header format, unsupported FORMAT";s+=n.length+1,n=this.readStringLine(e,s);var a=/^\-Y (.*) \+X (.*)$/g,h=a.exec(n);if(h.length<3)throw"HDR Bad header format, no size";if(i=parseInt(h[2]),t=parseInt(h[1]),8>i||i>32767)throw"HDR Bad header format, unsupported size";return s+=n.length+1,{height:t,width:i,dataPosition:s}},t.GetCubeMapTextureData=function(t,i){var n=new Uint8Array(t),r=this.RGBE_ReadHeader(n),o=this.RGBE_ReadPixels_RLE(n,r),s=e.PanoramaToCubeMapTools.ConvertPanoramaToCubemap(o,r.width,r.height,i);return s},t.RGBE_ReadPixels=function(e,t){return this.RGBE_ReadPixels_RLE(e,t)},t.RGBE_ReadPixels_RLE=function(e,t){for(var i,n,r,o,s,a=t.height,h=t.width,l=t.dataPosition,c=0,u=0,d=0,f=new ArrayBuffer(4*h),p=new Uint8Array(f),_=new ArrayBuffer(t.width*t.height*4*3),m=new Float32Array(_);a>0;){if(i=e[l++],n=e[l++],r=e[l++],o=e[l++],2!=i||2!=n||128&r)throw"HDR Bad header format, not RLE";if((r<<8|o)!=h)throw"HDR Bad header format, wrong scan line width";for(c=0,d=0;4>d;d++)for(u=(d+1)*h;u>c;)if(i=e[l++],n=e[l++],i>128){if(s=i-128,0==s||s>u-c)throw"HDR Bad Format, bad scanline data (run)";for(;s-- >0;)p[c++]=n}else{if(s=i,0==s||s>u-c)throw"HDR Bad Format, bad scanline data (non-run)";if(p[c++]=n,--s>0)for(var g=0;s>g;g++)p[c++]=e[l++]}for(d=0;h>d;d++)i=p[d],n=p[d+h],r=p[d+2*h],o=p[d+3*h],this.Rgbe2float(m,i,n,r,o,(t.height-a)*h*3+3*d);a--}return m},t}();e.HDRTools=t}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(){this.min=new e.Vector3(0,0,0),this.max=new e.Vector3(0,0,0),this.clear()}return t.prototype.clear=function(){this.min.x=t.MAX,this.min.y=t.MAX,this.min.z=t.MAX,this.max.x=t.MIN,this.max.y=t.MIN,this.max.z=t.MIN},t.prototype.augment=function(e,t,i){this.min.x=Math.min(this.min.x,e),this.min.y=Math.min(this.min.y,t),this.min.z=Math.min(this.min.z,i),this.max.x=Math.max(this.max.x,e),this.max.y=Math.max(this.max.y,t),this.max.z=Math.max(this.max.z,i)},t.prototype.clampMin=function(e,t,i){this.min.x=Math.max(this.min.x,e),this.min.y=Math.max(this.min.y,t),this.min.z=Math.max(this.min.z,i)},t.prototype.clampMax=function(e,t,i){this.max.x=Math.min(this.max.x,e),this.max.y=Math.min(this.max.y,t),this.max.z=Math.min(this.max.z,i)},t.prototype.empty=function(){return this.min.x>this.max.y||this.min.y>this.max.y||this.min.z>this.max.y},t.MAX=Number.MAX_VALUE,t.MIN=Number.MIN_VALUE,t}(),n=function(){function t(e,t,i,n,r,o,s,a,h,l){this.input=e,this.inputSize=t,this.outputSize=i,this.maxNumMipLevels=n,this.numChannels=r,this.isFloat=o,this.specularPower=s,this.cosinePowerDropPerMip=a,this.excludeBase=h,this.fixup=l,this._outputSurface=[],this._numMipLevels=0}return t.prototype.filterCubeMap=function(){return this.init(),this.filterCubeMapMipChain(),this._outputSurface},t.prototype.init=function(){var e,i,n;for(0==this.maxNumMipLevels&&(this.maxNumMipLevels=t.CP_MAX_MIPLEVELS),n=this.outputSize,i=0;i<this.maxNumMipLevels;i++){for(this._outputSurface.length++,this._outputSurface[i]=[],e=0;6>e;e++)this._outputSurface[i].length++,this.isFloat?this._outputSurface[i][e]=new Float32Array(n*n*this.numChannels):this._outputSurface[i][e]=new Uint32Array(n*n*this.numChannels);if(n>>=1,this._numMipLevels++,0==n)return void(this.maxNumMipLevels=i)}},t.prototype.filterCubeMapMipChain=function(){var e=this.specularPower;this.precomputeFilterLookupTables(this.inputSize);for(var t=0;t<this._numMipLevels;t++){this.excludeBase&&0==t&&(e=1e5);var i=this.input,n=this._outputSurface[t],r=this.outputSize>>t,o=this.getBaseFilterAngle(e);this.filterCubeSurfaces(i,this.inputSize,n,r,o,e),this.fixup&&this.fixupCubeEdges(n,r),this.excludeBase&&0==t&&(e=this.specularPower),e*=this.cosinePowerDropPerMip}},t.prototype.getBaseFilterAngle=function(e){var t=1e-6,i=180;return i=Math.acos(Math.pow(t,1/e)),i*=180/Math.PI,i*=2},t.prototype.precomputeFilterLookupTables=function(e){this._normCubeMap=[],this.buildNormalizerSolidAngleCubemap(e)},t.prototype.buildNormalizerSolidAngleCubemap=function(e){var t,i,n;for(t=0;6>t;t++)for(this._normCubeMap.push(new Float32Array(e*e*4)),this.input[t],n=0;e>n;n++)for(i=0;e>i;i++){var r=this.texelCoordToVect(t,i,n,e,this.fixup);this._normCubeMap[t][4*(n*e+i)+0]=r.x,this._normCubeMap[t][4*(n*e+i)+1]=r.y,this._normCubeMap[t][4*(n*e+i)+2]=r.z;var o=this.texelCoordSolidAngle(t,i,n,e);this._normCubeMap[t][4*(n*e+i)+4]=o}},t.prototype.texelCoordToVect=function(e,i,n,r,o){var s,a;if(s=2*(i+.5)/r-1,a=2*(n+.5)/r-1,o&&r>1){var h=Math.pow(r,2)/Math.pow(r-1,3);s=h*Math.pow(s,3)+s,a=h*Math.pow(a,3)+a}var l=t._sgFace2DMapping[e][t.CP_UDIR];t._vectorTemp.x=l[0]*s,t._vectorTemp.y=l[1]*s,t._vectorTemp.z=l[2]*s;var c=t._sgFace2DMapping[e][t.CP_VDIR];t._vectorTemp.x+=c[0]*a,t._vectorTemp.y+=c[1]*a,t._vectorTemp.z+=c[2]*a;var u=t._sgFace2DMapping[e][t.CP_FACEAXIS];return t._vectorTemp.x+=u[0],t._vectorTemp.y+=u[1],t._vectorTemp.z+=u[2],t._vectorTemp.normalize(),t._vectorTemp},t.prototype.vectToTexelCoord=function(e,i,n,r){var o,s,a=Math.abs(e),h=Math.abs(i),l=Math.abs(n);a>=h&&a>=l?(o=a,s=e>=0?t.CP_FACE_X_POS:t.CP_FACE_X_NEG):h>=a&&h>=l?(o=h,s=i>=0?t.CP_FACE_Y_POS:t.CP_FACE_Y_NEG):(o=l,s=n>=0?t.CP_FACE_Z_POS:t.CP_FACE_Z_NEG);var c=1/o;e*=c,i*=c,n*=c;var u=t._sgFace2DMapping[s][t.CP_UDIR],d=u[0]*e+u[1]*i+u[2]*n;u=t._sgFace2DMapping[s][t.CP_VDIR];var f=u[0]*e+u[1]*i+u[2]*n,p=Math.floor(.5*(r-1)*(d+1)),_=Math.floor(.5*(r-1)*(f+1));return t._vectorTemp.x=s,t._vectorTemp.y=p,t._vectorTemp.z=_,t._vectorTemp},t.prototype.areaElement=function(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))},t.prototype.texelCoordSolidAngle=function(e,t,i,n){t=2*(t+.5)/n-1,i=2*(i+.5)/n-1;var r=1/n,o=t-r,s=i-r,a=t+r,h=i+r,l=this.areaElement(o,s)-this.areaElement(o,h)-this.areaElement(a,s)+this.areaElement(a,h);return l},t.prototype.filterCubeSurfaces=function(e,t,n,r,o,s){var a,h,l,c=[];for(a=0;6>a;a++)c.push(new i);var u=180/Math.PI*Math.atan2(1,t),d=o/2;u>d&&(d=u),d>90&&(d=90);var f=Math.ceil(d/u);1>f&&(f=1);var p=Math.cos(Math.PI/180*d);for(a=0;6>a;a++)for(l=0;r>l;l++)for(h=0;r>h;h++){var _=this.texelCoordToVect(a,h,l,r,this.fixup).clone();this.clearFilterExtents(c),this.determineFilterExtents(_,t,f,c);var m=this.processFilterExtents(_,p,c,e,t,s);n[a][(l*r+h)*this.numChannels+0]=m.x,n[a][(l*r+h)*this.numChannels+1]=m.y,n[a][(l*r+h)*this.numChannels+2]=m.z}},t.prototype.clearFilterExtents=function(e){for(var t=0;6>t;t++)e[t].clear()},t.prototype.determineFilterExtents=function(e,i,n,r){var o,s,a,h=[0,0,0,0],l=[0,0,0,0],c=[0,0,0,0],u=this.vectToTexelCoord(e.x,e.y,e.z,i),d=u.x,f=u.y,p=u.z;r[d].augment(f-n,p-n,0),r[d].augment(f+n,p+n,0),r[d].clampMin(0,0,0),r[d].clampMax(i-1,i-1,0);var _=r[d].min.x,m=r[d].min.y,g=r[d].max.x,v=r[d].max.y;h[0]=n-f,l[0]=m,c[0]=v,h[1]=f+n-(i-1),l[1]=m,c[1]=v,h[2]=n-p,l[2]=_,c[2]=g,h[3]=p+n-(i-1),l[3]=_,c[3]=g;for(var y=0;4>y;y++){if(h[y]>0){switch(o=t._sgCubeNgh[d][y][0],s=t._sgCubeNgh[d][y][1],y!=s&&y+s!=3||(l[y]=i-1-l[y],c[y]=i-1-c[y]),t._sgCubeNgh[d][y][1]){case t.CP_EDGE_LEFT:r[o].augment(0,l[y],0),r[o].augment(h[y],c[y],0);break;case t.CP_EDGE_RIGHT:r[o].augment(i-1,l[y],0),r[o].augment(i-1-h[y],c[y],0);break;case t.CP_EDGE_TOP:r[o].augment(l[y],0,0),r[o].augment(c[y],h[y],0);break;case t.CP_EDGE_BOTTOM:r[o].augment(l[y],i-1,0),r[o].augment(c[y],i-1-h[y],0)}r[o].clampMin(0,0,0),r[o].clampMax(i-1,i-1,0)}if(h[y]>i){switch(d){case t.CP_FACE_X_POS:a=t.CP_FACE_X_NEG;break;case t.CP_FACE_X_NEG:a=t.CP_FACE_X_POS;break;case t.CP_FACE_Y_POS:a=t.CP_FACE_Y_NEG;break;case t.CP_FACE_Y_NEG:a=t.CP_FACE_Y_POS;break;case t.CP_FACE_Z_POS:a=t.CP_FACE_Z_NEG;break;case t.CP_FACE_Z_NEG:a=t.CP_FACE_Z_POS}r[a].augment(0,0,0),r[a].augment(i-1,i-1,0)}}},t.prototype.processFilterExtents=function(e,i,n,r,o,s){for(var a=[0,0,0,0],h=0,l=0,c=this.numChannels,u=o,d=4*u,f=u*this.numChannels,p=1,_=0;6>_;_++)if(!n[_].empty())for(var m=n[_].min.x,g=n[_].min.y,v=n[_].max.x,y=n[_].max.y,b=4*(g*u+m),x=this.numChannels*(g*u+m),P=g;y>=P;P++){for(var A=0,C=0,E=m;v>=E;E++){var T=this._normCubeMap[_][b+A+0],S=this._normCubeMap[_][b+A+1],M=this._normCubeMap[_][b+A+2],I=T*e.x+S*e.y+M*e.z;if(I>=i&&I>0){var w=this._normCubeMap[_][b+A+3];for(w*=Math.pow(I,s+p),l=0;c>l;l++)a[l]+=w*r[_][x+C],C++;h+=w}else C+=c;A+=4}b+=d,x+=f}if(0!=h)t._vectorTemp.x=a[0]/h,t._vectorTemp.y=a[1]/h,t._vectorTemp.z=a[2]/h,this.numChannels>3&&(t._vectorTemp.w=a[3]/h);else{var R=this.vectToTexelCoord(e.x,e.y,e.z,o).clone();t._vectorTemp.x=r[R.x][this.numChannels*(R.z*o+R.y)+0],t._vectorTemp.y=r[R.x][this.numChannels*(R.z*o+R.y)+1],t._vectorTemp.z=r[R.x][this.numChannels*(R.z*o+R.y)+2],this.numChannels>3&&(t._vectorTemp.z=r[R.x][this.numChannels*(R.z*o+R.y)+3])}return t._vectorTemp},t.prototype.fixupCubeEdges=function(e,i){var n,r,o,s,a=0,h=[0,0,0,0,0,0,0,0],l=[[],[],[],[]],c=[[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]],[[],[],[]]];if(!(1>i))if(1!=i){for(s=0;6>s;s++)for(l[0]=[s,0],l[1]=[s,(i-1)*this.numChannels],l[2]=[s,i*(i-1)*this.numChannels],l[3]=[s,(i*(i-1)+(i-1))*this.numChannels],a=0;4>a;a++){var u=t._sgCubeCornerList[s][a];c[u][h[u]]=l[a],h[u]++}for(a=0;8>a;a++)for(n=0;n<this.numChannels;n++){var d=0;for(o=0;3>o;o++)d+=e[c[a][o][0]][c[a][o][1]+n];for(d*=1/3,o=0;3>o;o++)e[c[a][o][0]][c[a][o][1]+n]=d}for(o=0;12>o;o++){var f=t._sgCubeEdgeList[o][0],p=t._sgCubeEdgeList[o][1],_=t._sgCubeNgh[f][p][0],m=t._sgCubeNgh[f][p][1],g=0,v=0,y=0,b=0;switch(p){case t.CP_EDGE_LEFT:y=this.numChannels*i;break;case t.CP_EDGE_RIGHT:g+=(i-1)*this.numChannels,y=this.numChannels*i;break;case t.CP_EDGE_TOP:y=this.numChannels;break;case t.CP_EDGE_BOTTOM:g+=i*(i-1)*this.numChannels,y=this.numChannels}if(p==m||p+m==3)switch(m){case t.CP_EDGE_LEFT:v+=(i-1)*i*this.numChannels,b=-(this.numChannels*i);break;case t.CP_EDGE_RIGHT:v+=((i-1)*i+(i-1))*this.numChannels,b=-(this.numChannels*i);break;case t.CP_EDGE_TOP:v+=(i-1)*this.numChannels,b=-this.numChannels;break;case t.CP_EDGE_BOTTOM:v+=((i-1)*i+(i-1))*this.numChannels,b=-this.numChannels}else switch(m){case t.CP_EDGE_LEFT:b=this.numChannels*i;break;case t.CP_EDGE_RIGHT:v+=(i-1)*this.numChannels,b=this.numChannels*i;break;case t.CP_EDGE_TOP:b=this.numChannels;break;case t.CP_EDGE_BOTTOM:v+=i*(i-1)*this.numChannels,b=this.numChannels}for(g+=y,v+=b,r=1;i-1>r;r++){for(n=0;n<this.numChannels;n++){var x=e[f][g+n],P=e[_][v+n],A=.5*(x+P);e[f][g+n]=A,e[_][v+n]=A}g+=y,v+=b}}}else for(n=0;n<this.numChannels;n++){var C=0;for(s=0;6>s;s++)C+=e[s][n];for(C/=6,s=0;6>s;s++)e[s][n]=C}},t.CP_MAX_MIPLEVELS=16,t.CP_UDIR=0,t.CP_VDIR=1,t.CP_FACEAXIS=2,t.CP_FACE_X_POS=0,t.CP_FACE_X_NEG=1,t.CP_FACE_Y_POS=2,t.CP_FACE_Y_NEG=3,t.CP_FACE_Z_POS=4,t.CP_FACE_Z_NEG=5,t.CP_EDGE_LEFT=0,t.CP_EDGE_RIGHT=1,t.CP_EDGE_TOP=2,t.CP_EDGE_BOTTOM=3,t.CP_CORNER_NNN=0,t.CP_CORNER_NNP=1,t.CP_CORNER_NPN=2,t.CP_CORNER_NPP=3,t.CP_CORNER_PNN=4,t.CP_CORNER_PNP=5,t.CP_CORNER_PPN=6,t.CP_CORNER_PPP=7,t._vectorTemp=new e.Vector4(0,0,0,0),t._sgFace2DMapping=[[[0,0,-1],[0,-1,0],[1,0,0]],[[0,0,1],[0,-1,0],[-1,0,0]],[[1,0,0],[0,0,1],[0,1,0]],[[1,0,0],[0,0,-1],[0,-1,0]],[[1,0,0],[0,-1,0],[0,0,1]],[[-1,0,0],[0,-1,0],[0,0,-1]]],t._sgCubeNgh=[[[t.CP_FACE_Z_POS,t.CP_EDGE_RIGHT],[t.CP_FACE_Z_NEG,t.CP_EDGE_LEFT],[t.CP_FACE_Y_POS,t.CP_EDGE_RIGHT],[t.CP_FACE_Y_NEG,t.CP_EDGE_RIGHT]],[[t.CP_FACE_Z_NEG,t.CP_EDGE_RIGHT],[t.CP_FACE_Z_POS,t.CP_EDGE_LEFT],[t.CP_FACE_Y_POS,t.CP_EDGE_LEFT],[t.CP_FACE_Y_NEG,t.CP_EDGE_LEFT]],[[t.CP_FACE_X_NEG,t.CP_EDGE_TOP],[t.CP_FACE_X_POS,t.CP_EDGE_TOP],[t.CP_FACE_Z_NEG,t.CP_EDGE_TOP],[t.CP_FACE_Z_POS,t.CP_EDGE_TOP]],[[t.CP_FACE_X_NEG,t.CP_EDGE_BOTTOM],[t.CP_FACE_X_POS,t.CP_EDGE_BOTTOM],[t.CP_FACE_Z_POS,t.CP_EDGE_BOTTOM],[t.CP_FACE_Z_NEG,t.CP_EDGE_BOTTOM]],[[t.CP_FACE_X_NEG,t.CP_EDGE_RIGHT],[t.CP_FACE_X_POS,t.CP_EDGE_LEFT],[t.CP_FACE_Y_POS,t.CP_EDGE_BOTTOM],[t.CP_FACE_Y_NEG,t.CP_EDGE_TOP]],[[t.CP_FACE_X_POS,t.CP_EDGE_RIGHT],[t.CP_FACE_X_NEG,t.CP_EDGE_LEFT],[t.CP_FACE_Y_POS,t.CP_EDGE_TOP],[t.CP_FACE_Y_NEG,t.CP_EDGE_BOTTOM]]],t._sgCubeEdgeList=[[t.CP_FACE_X_POS,t.CP_EDGE_LEFT],[t.CP_FACE_X_POS,t.CP_EDGE_RIGHT],[t.CP_FACE_X_POS,t.CP_EDGE_TOP],[t.CP_FACE_X_POS,t.CP_EDGE_BOTTOM],[t.CP_FACE_X_NEG,t.CP_EDGE_LEFT],[t.CP_FACE_X_NEG,t.CP_EDGE_RIGHT],[t.CP_FACE_X_NEG,t.CP_EDGE_TOP],[t.CP_FACE_X_NEG,t.CP_EDGE_BOTTOM],[t.CP_FACE_Z_POS,t.CP_EDGE_TOP],[t.CP_FACE_Z_POS,t.CP_EDGE_BOTTOM],[t.CP_FACE_Z_NEG,t.CP_EDGE_TOP],[t.CP_FACE_Z_NEG,t.CP_EDGE_BOTTOM]],t._sgCubeCornerList=[[t.CP_CORNER_PPP,t.CP_CORNER_PPN,t.CP_CORNER_PNP,t.CP_CORNER_PNN],[t.CP_CORNER_NPN,t.CP_CORNER_NPP,t.CP_CORNER_NNN,t.CP_CORNER_NNP],[t.CP_CORNER_NPN,t.CP_CORNER_PPN,t.CP_CORNER_NPP,t.CP_CORNER_PPP],[t.CP_CORNER_NNP,t.CP_CORNER_PNP,t.CP_CORNER_NNN,t.CP_CORNER_PNN],[t.CP_CORNER_NPP,t.CP_CORNER_PPP,t.CP_CORNER_NNP,t.CP_CORNER_PNP],[t.CP_CORNER_PPN,t.CP_CORNER_NPN,t.CP_CORNER_PNN,t.CP_CORNER_NNN]],t}();t.PMREMGenerator=n}(t=e.Internals||(e.Internals={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n,r,o,s,a,h){void 0===o&&(o=!1),void 0===s&&(s=!0),void 0===a&&(a=!1),void 0===h&&(h=!1),t.call(this,n),this._useInGammaSpace=!1,this._generateHarmonics=!0,this._isBABYLONPreprocessed=!1,this.coordinatesMode=e.Texture.CUBIC_MODE,this.sphericalPolynomial=null,this.isPMREM=!1,i&&(this.name=i,this.url=i,this.hasAlpha=!1,this.isCube=!0,this._textureMatrix=e.Matrix.Identity(),r?(this._isBABYLONPreprocessed=!1,this._noMipmap=o,this._size=r,this._useInGammaSpace=a,this._usePMREMGenerator=h&&n.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace):(this._isBABYLONPreprocessed=!0,this._noMipmap=!1,this._useInGammaSpace=!1,this._usePMREMGenerator=n.getEngine().getCaps().textureLOD&&this.getScene().getEngine().getCaps().textureFloat&&!this._useInGammaSpace),this.isPMREM=this._usePMREMGenerator,this._texture=this._getFromCache(i,this._noMipmap),this._texture||(n.useDelayedTextureLoading?this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()))}return __extends(i,t),i.prototype.loadBabylonTexture=function(){var t=this,i=0,n=null,r=!this._useInGammaSpace&&this.getScene().getEngine().getCaps().textureFloat?function(e){for(var r=[],o=30,s=0;i>s;s++){r.push([]);for(var a=3*Math.pow(t._size>>s,2),h=0;6>h;h++){var l=n.subarray(o,o+a);r[s].push(l),o+=a}}return r}:null,o=function(o){var s=new Int32Array(o);n=new Float32Array(o),s[0],t._size=s[1],t.getScene().getEngine().updateTextureSize(t._texture,t._size,t._size),t.sphericalPolynomial=new e.SphericalPolynomial,t.sphericalPolynomial.x.copyFromFloats(n[2],n[3],n[4]),t.sphericalPolynomial.y.copyFromFloats(n[5],n[6],n[7]),t.sphericalPolynomial.z.copyFromFloats(n[8],n[9],n[10]),t.sphericalPolynomial.xx.copyFromFloats(n[11],n[12],n[13]),t.sphericalPolynomial.yy.copyFromFloats(n[14],n[15],n[16]),t.sphericalPolynomial.zz.copyFromFloats(n[17],n[18],n[19]),t.sphericalPolynomial.xy.copyFromFloats(n[20],n[21],n[22]),t.sphericalPolynomial.yz.copyFromFloats(n[23],n[24],n[25]),t.sphericalPolynomial.zx.copyFromFloats(n[26],n[27],n[28]),i=s[29];for(var a=30,h=[],l=3*Math.pow(t._size,2),c=0;6>c;c++)h.push(n.subarray(a,a+l)),a+=l;for(var u=[],d=null,f=0;6>f;f++){var p=null;if(r)p=h[f];else{var _=[0,2,4,1,3,5][f];if(p=h[_],!t.getScene().getEngine().getCaps().textureFloat){var m=new ArrayBuffer(l);d=new Uint8Array(m)}for(var g=0;g<t._size*t._size;g++)if(t._useInGammaSpace&&(p[3*g+0]=Math.pow(p[3*g+0],e.ToGammaSpace),p[3*g+1]=Math.pow(p[3*g+1],e.ToGammaSpace),p[3*g+2]=Math.pow(p[3*g+2],e.ToGammaSpace)),d){var v=Math.max(255*p[3*g+0],0),y=Math.max(255*p[3*g+1],0),b=Math.max(255*p[3*g+2],0),x=Math.max(Math.max(v,y),b);if(x>255){var P=255/x;v*=P,y*=P,b*=P}d[3*g+0]=v,d[3*g+1]=y,d[3*g+2]=b}}d?u.push(d):u.push(p)}return u};this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,e.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,o,r)},i.prototype.loadHDRTexture=function(){var t=this,n=function(n){var r=e.Internals.HDRTools.GetCubeMapTextureData(n,t._size);t._generateHarmonics&&(t.sphericalPolynomial=e.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(r));for(var o=[],s=null,a=0;6>a;a++){if(!t.getScene().getEngine().getCaps().textureFloat){var h=new ArrayBuffer(t._size*t._size*3);s=new Uint8Array(h)}var l=r[i._facesMapping[a]];if(t._useInGammaSpace||s)for(var c=0;c<t._size*t._size;c++)if(t._useInGammaSpace&&(l[3*c+0]=Math.pow(l[3*c+0],e.ToGammaSpace),l[3*c+1]=Math.pow(l[3*c+1],e.ToGammaSpace),l[3*c+2]=Math.pow(l[3*c+2],e.ToGammaSpace)),s){var u=Math.max(255*l[3*c+0],0),d=Math.max(255*l[3*c+1],0),f=Math.max(255*l[3*c+2],0),p=Math.max(Math.max(u,d),f);if(p>255){var _=255/p;u*=_,d*=_,f*=_}s[3*c+0]=u,s[3*c+1]=d,s[3*c+2]=f}s?o.push(s):o.push(l)}return o},r=null;!this._noMipmap&&this._usePMREMGenerator&&(r=function(i){var n=new e.Internals.PMREMGenerator(i,t._size,t._size,0,3,t.getScene().getEngine().getCaps().textureFloat,2048,.25,!1,!0);return n.filterCubeMap()}),this._texture=this.getScene().getEngine().createRawCubeTexture(this.url,this.getScene(),this._size,e.Engine.TEXTUREFORMAT_RGB,this.getScene().getEngine().getCaps().textureFloat?e.Engine.TEXTURETYPE_FLOAT:e.Engine.TEXTURETYPE_UNSIGNED_INT,this._noMipmap,n,r)},i.prototype.loadTexture=function(){this._isBABYLONPreprocessed?this.loadBabylonTexture():this.loadHDRTexture()},i.prototype.clone=function(){var e=this._isBABYLONPreprocessed?null:this._size,t=new i(this.url,this.getScene(),e,this._noMipmap,this._generateHarmonics,this._useInGammaSpace,this._usePMREMGenerator);return t.level=this.level,t.wrapU=this.wrapU,t.wrapV=this.wrapV,t.coordinatesIndex=this.coordinatesIndex,t.coordinatesMode=this.coordinatesMode,t},i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},i.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},i.Parse=function(t,i,n){var r=null;if(t.name&&!t.isRenderTarget){var o=t.isBABYLONPreprocessed?null:t.size;r=new e.HDRCubeTexture(n+t.name,i,o,r.generateHarmonics,r.useInGammaSpace,r.usePMREMGenerator),r.name=t.name,r.hasAlpha=t.hasAlpha,r.level=t.level,r.coordinatesMode=t.coordinatesMode}return r},i.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.hasAlpha=this.hasAlpha,e.isCube=!0,e.level=this.level,e.size=this._size,e.coordinatesMode=this.coordinatesMode,e.useInGammaSpace=this._useInGammaSpace,e.generateHarmonics=this._generateHarmonics,e.usePMREMGenerator=this._usePMREMGenerator,e.isBABYLONPreprocessed=this._isBABYLONPreprocessed,e},i.generateBabylonHDROnDisk=function(e,t,n){void 0===n&&(n=null);var r=function(e){var t=new Blob([e],{type:"application/octet-stream"}),i=window.URL.createObjectURL(t),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=i,n.download="envmap.babylon.hdr",n.click()};i.generateBabylonHDR(e,t,r,n)},i.generateBabylonHDR=function(t,i,n,r){if(void 0===r&&(r=null),!t)return null;if(!e.Tools.IsExponentOfTwo(i))return null;var o=function(t){var r=e.Internals.HDRTools.GetCubeMapTextureData(t,i),o=e.Internals.CubeMapToSphericalPolynomialTools.ConvertCubeMapToSphericalPolynomial(r),s=[];s.push(r.right),s.push(r.left),s.push(r.up),s.push(r.down),s.push(r.front),s.push(r.back);var a=new e.Internals.PMREMGenerator(s,i,i,0,3,!0,2048,.25,!1,!0),h=a.filterCubeMap(),l=4;l+=4,l+=108,l+=4;for(var c=0;c<h.length;c++){var u=i>>c;l+=6*u*u*3*4}var d=new ArrayBuffer(l),f=new Int32Array(d),p=new Float32Array(d);f[0]=1,f[1]=i,o.x.toArray(p,2),o.y.toArray(p,5),o.z.toArray(p,8),o.xx.toArray(p,11),o.yy.toArray(p,14),o.zz.toArray(p,17),o.xy.toArray(p,20),o.yz.toArray(p,23),o.zx.toArray(p,26),f[29]=h.length;for(var _=30,c=0;c<h.length;c++)for(var m=3*Math.pow(i>>c,2),g=0;6>g;g++)p.set(h[c][g],_),_+=m;n(d)};e.Tools.LoadFile(t,function(e){o(e)},null,null,!0,r)},i._facesMapping=["right","up","front","left","down","back"],i}(e.BaseTexture);e.HDRCubeTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t;!function(t){var i=function(){function t(t,i,n,r,o){void 0===r&&(r=!0),void 0===o&&(o=1),this.skeleton=t,this.mesh=i,this.autoUpdateBonesMatrices=r,this.renderingGroupId=o,this.color=e.Color3.White(),this._debugLines=[],this._isEnabled=!1,this._scene=n,this.update(),this._renderFunction=this.update.bind(this)}return Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){
this._isEnabled!==e&&(this._isEnabled=e,e?this._scene.registerBeforeRender(this._renderFunction):this._scene.unregisterBeforeRender(this._renderFunction))},enumerable:!0,configurable:!0}),t.prototype._getBonePosition=function(t,i,n,r,o,s){void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=0);var a=e.Tmp.Matrix[0],h=i.getParent();if(a.copyFrom(i.getLocalMatrix()),0!==r||0!==o||0!==s){var l=e.Tmp.Matrix[1];e.Matrix.IdentityToRef(l),l.m[12]=r,l.m[13]=o,l.m[14]=s,l.multiplyToRef(a,a)}h&&a.multiplyToRef(h.getAbsoluteTransform(),a),a.multiplyToRef(n,a),t.x=a.m[12],t.y=a.m[13],t.z=a.m[14]},t.prototype._getLinesForBonesWithLength=function(t,i){for(var n=t.length,r=0;n>r;r++){var o=t[r],s=this._debugLines[r];s||(s=[e.Vector3.Zero(),e.Vector3.Zero()],this._debugLines[r]=s),this._getBonePosition(s[0],o,i),this._getBonePosition(s[1],o,i,0,o.length,0)}},t.prototype._getLinesForBonesNoLength=function(t,i){for(var n=t.length,r=0,o=n-1;o>=0;o--){var s=t[o],a=s.getParent();if(a){var h=this._debugLines[r];h||(h=[e.Vector3.Zero(),e.Vector3.Zero()],this._debugLines[r]=h),this._getBonePosition(h[0],s,i),this._getBonePosition(h[1],a,i),r++}}},t.prototype.update=function(){this.autoUpdateBonesMatrices&&this._updateBoneMatrix(this.skeleton.bones[0]),void 0===this.skeleton.bones[0].length?this._getLinesForBonesNoLength(this.skeleton.bones,this.mesh.getWorldMatrix()):this._getLinesForBonesWithLength(this.skeleton.bones,this.mesh.getWorldMatrix()),this._debugMesh?e.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0,instance:this._debugMesh},this._scene):(this._debugMesh=e.MeshBuilder.CreateLineSystem(null,{lines:this._debugLines,updatable:!0},this._scene),this._debugMesh.renderingGroupId=this.renderingGroupId),this._debugMesh.color=this.color},t.prototype._updateBoneMatrix=function(e){e.getParent()&&e.getLocalMatrix().multiplyToRef(e.getParent().getAbsoluteTransform(),e.getAbsoluteTransform());for(var t=e.children,i=t.length,n=0;i>n;n++)this._updateBoneMatrix(t[n])},t.prototype.dispose=function(){this._debugMesh&&(this.isEnabled=!1,this._debugMesh.dispose(),this._debugMesh=null)},t}();t.SkeletonViewer=i}(t=e.Debug||(e.Debug={}))}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(){this._dirty=!0,this._tempColor=new e.Color4(0,0,0,0),this._globalCurve=new e.Color4(0,0,0,0),this._highlightsCurve=new e.Color4(0,0,0,0),this._midtonesCurve=new e.Color4(0,0,0,0),this._shadowsCurve=new e.Color4(0,0,0,0),this._positiveCurve=new e.Color4(0,0,0,0),this._negativeCurve=new e.Color4(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(t.prototype,"GlobalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"GlobalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"GlobalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HighlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HighlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HighlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"HighlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MidtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MidtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MidtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"MidtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ShadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!0,configurable:!0}),t.Bind=function(e,t){e._dirty&&(e._dirty=!1,e.getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e.getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e.getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e.getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t.setFloat4("vCameraColorCurvePositive",e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4("vCameraColorCurveNeutral",e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4("vCameraColorCurveNegative",e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a)},t.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},t.prototype.getColorGradingDataToRef=function(e,i,n,r,o){null!=e&&(e=t.clamp(e,0,360),i=t.clamp(i,-100,100),n=t.clamp(n,-100,100),r=t.clamp(r,-100,100),i=t.applyColorGradingSliderNonlinear(i),i*=.5,r=t.applyColorGradingSliderNonlinear(r),0>i&&(i*=-1,e=(e+180)%360),t.fromHSBToRef(e,i,50+.25*r,o),o.scaleToRef(2,o),o.a=1+.01*n)},t.applyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),0>e&&(t*=-1),t*=100},t.fromHSBToRef=function(e,i,n,r){var o=t.clamp(e,0,360),s=t.clamp(i/100,0,1),a=t.clamp(n/100,0,1);if(0===s)r.r=a,r.g=a,r.b=a;else{o/=60;var h=Math.floor(o),l=o-h,c=a*(1-s),u=a*(1-s*l),d=a*(1-s*(1-l));switch(h){case 0:r.r=a,r.g=d,r.b=c;break;case 1:r.r=u,r.g=a,r.b=c;break;case 2:r.r=c,r.g=a,r.b=d;break;case 3:r.r=c,r.g=u,r.b=a;break;case 4:r.r=d,r.g=c,r.b=a;break;default:r.r=a,r.g=c,r.b=u}}r.a=1},t.clamp=function(e,t,i){return Math.min(Math.max(e,t),i)},t.prototype.clone=function(){return e.SerializationHelper.Clone(function(){return new t},this)},t.prototype.serialize=function(){return e.SerializationHelper.Serialize(this)},t.Parse=function(i){return e.SerializationHelper.Parse(function(){return new t},i,null,null)},__decorate([e.serialize()],t.prototype,"_globalHue",void 0),__decorate([e.serialize()],t.prototype,"_globalDensity",void 0),__decorate([e.serialize()],t.prototype,"_globalSaturation",void 0),__decorate([e.serialize()],t.prototype,"_globalExposure",void 0),__decorate([e.serialize()],t.prototype,"_highlightsHue",void 0),__decorate([e.serialize()],t.prototype,"_highlightsDensity",void 0),__decorate([e.serialize()],t.prototype,"_highlightsSaturation",void 0),__decorate([e.serialize()],t.prototype,"_highlightsExposure",void 0),__decorate([e.serialize()],t.prototype,"_midtonesHue",void 0),__decorate([e.serialize()],t.prototype,"_midtonesDensity",void 0),__decorate([e.serialize()],t.prototype,"_midtonesSaturation",void 0),__decorate([e.serialize()],t.prototype,"_midtonesExposure",void 0),t}();e.ColorCurves=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(t){function i(i,n){t.call(this,n),i&&(this._textureMatrix=e.Matrix.Identity(),this.name=i,this.url=i,this.hasAlpha=!1,this.isCube=!1,this.wrapU=e.Texture.CLAMP_ADDRESSMODE,this.wrapV=e.Texture.CLAMP_ADDRESSMODE,this.anisotropicFilteringLevel=1,this._texture=this._getFromCache(i,!0),this._texture||(n.useDelayedTextureLoading?this.delayLoadState=e.Engine.DELAYLOADSTATE_NOTLOADED:this.loadTexture()))}return __extends(i,t),i.prototype.getTextureMatrix=function(){return this._textureMatrix},i.prototype.load3dlTexture=function(){var t=this,n=this.getScene().getEngine().createRawTexture(null,1,1,e.Engine.TEXTUREFORMAT_RGBA,!1,!1,e.Texture.BILINEAR_SAMPLINGMODE);this._texture=n;var r=function(r){for(var o,s,a,h=r.split("\n"),l=0,c=0,u=0,d=0,f=0,p=0;p<h.length;p++)if(a=h[p],i._noneEmptyLineRegex.test(a)&&0!==a.indexOf("#")){var _=a.split(" ");if(0!==l){if(0!=l){var m=Math.max(parseInt(_[0]),0),g=Math.max(parseInt(_[1]),0),v=Math.max(parseInt(_[2]),0);f=Math.max(m,f),f=Math.max(g,f),f=Math.max(v,f);var y=4*(c+d*l+u*l*l);s[y+0]=m,s[y+1]=g,s[y+2]=v,s[y+3]=0,d++,d%l==0&&(u++,d=0,u%l==0&&(c++,u=0))}}else l=_.length,o=new Uint8Array(l*l*l*4),s=new Float32Array(l*l*l*4)}for(var p=0;p<s.length;p++){var b=s[p];o[p]=b/f*255}t.getScene().getEngine().updateTextureSize(n,l*l,l),t.getScene().getEngine().updateRawTexture(n,o,e.Engine.TEXTUREFORMAT_RGBA,!1)};return e.Tools.LoadFile(this.url,r),this._texture},i.prototype.loadTexture=function(){this.url&&this.url.toLocaleLowerCase().indexOf(".3dl")==this.url.length-4&&this.load3dlTexture()},i.prototype.clone=function(){var e=new i(this.url,this.getScene());return e.level=this.level,e},i.prototype.delayLoad=function(){this.delayLoadState===e.Engine.DELAYLOADSTATE_NOTLOADED&&(this.delayLoadState=e.Engine.DELAYLOADSTATE_LOADED,this._texture=this._getFromCache(this.url,!0),this._texture||this.loadTexture())},i.Parse=function(t,i,n){var r=null;return t.name&&!t.isRenderTarget&&(r=new e.ColorGradingTexture(t.name,i),r.name=t.name,r.level=t.level),r},i.prototype.serialize=function(){if(!this.name)return null;var e={};return e.name=this.name,e.level=this.level,e},i._noneEmptyLineRegex=/\S+/,i}(e.BaseTexture);e.ColorGradingTexture=t}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(e){function t(){e.call(this),this.ALBEDO=!1,this.AMBIENT=!1,this.OPACITY=!1,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.REFLECTIVITY=!1,this.BUMP=!1,this.PARALLAX=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.ALPHATEST=!1,this.ALPHAFROMALBEDO=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.OPACITYFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.UV1=!1,this.UV2=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.INSTANCES=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHALBEDO=!1,this.LIGHTMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.CAMERATONEMAP=!1,this.CAMERACONTRAST=!1,this.CAMERACOLORGRADING=!1,this.CAMERACOLORCURVES=!1,this.OVERLOADEDVALUES=!1,this.OVERLOADEDSHADOWVALUES=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.LINKREFRACTIONTOTRANSPARENCY=!1,this.REFRACTIONMAPINLINEARSPACE=!1,this.LODBASEDMICROSFURACE=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.RADIANCEOVERALPHA=!1,this.USEPMREMREFLECTION=!1,this.USEPMREMREFRACTION=!1,this.OPENGLNORMALMAP=!1,this.INVERTNORMALMAPX=!1,this.INVERTNORMALMAPY=!1,this.rebuild()}return __extends(t,e),t}(e.MaterialDefines),i=function(i){function n(n,r){var o=this;i.call(this,n,r),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this._lightingInfos=new e.Vector4(this.directIntensity,this.emissiveIntensity,this.environmentIntensity,this.specularIntensity),this.disableBumpMap=!1,this.overloadedShadowIntensity=1,this.overloadedShadeIntensity=1,this._overloadedShadowInfos=new e.Vector4(this.overloadedShadowIntensity,this.overloadedShadeIntensity,0,0),this.cameraExposure=1,this.cameraContrast=1,this.cameraColorGradingTexture=null,this._cameraColorGradingScaleOffset=new e.Vector4(1,1,0,0),this._cameraColorGradingInfos=new e.Vector4(1,1,0,0),this.cameraColorCurves=null,this._cameraInfos=new e.Vector4(1,1,0,0),this._microsurfaceTextureLods=new e.Vector2(0,0),this.overloadedAmbient=e.Color3.White(),this.overloadedAmbientIntensity=0,this.overloadedAlbedo=e.Color3.White(),this.overloadedAlbedoIntensity=0,this.overloadedReflectivity=new e.Color3(.3,.3,.3),this.overloadedReflectivityIntensity=0,this.overloadedEmissive=e.Color3.White(),this.overloadedEmissiveIntensity=0,this._overloadedIntensity=new e.Vector4(this.overloadedAmbientIntensity,this.overloadedAlbedoIntensity,this.overloadedReflectivityIntensity,this.overloadedEmissiveIntensity),this.overloadedReflection=e.Color3.White(),this.overloadedReflectionIntensity=0,this.overloadedMicroSurface=0,this.overloadedMicroSurfaceIntensity=0,this._overloadedMicroSurface=new e.Vector3(this.overloadedMicroSurface,this.overloadedMicroSurfaceIntensity,this.overloadedReflectionIntensity),this.ambientColor=new e.Color3(0,0,0),this.albedoColor=new e.Color3(1,1,1),this.reflectivityColor=new e.Color3(1,1,1),this.reflectionColor=new e.Color3(.5,.5,.5),this.emissiveColor=new e.Color3(0,0,0),this.microSurface=.9,this.indexOfRefraction=.66,this.invertRefractionY=!1,this.linkRefractionWithTransparency=!1,this.linkEmissiveWithAlbedo=!1,this.useLightmapAsShadowmap=!1,this.useEmissiveAsIllumination=!1,this.useAlphaFromAlbedoTexture=!1,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useScalarInLinearSpace=!1,this.usePhysicalLightFalloff=!0,this.useRadianceOverAlpha=!0,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this._renderTargets=new e.SmartArray(16),this._worldViewProjectionMatrix=e.Matrix.Zero(),this._globalAmbientColor=new e.Color3(0,0,0),this._tempColor=new e.Color3,this._defines=new t,this._cachedDefines=new t,this._myScene=null,this._myShadowGenerator=null,this._cachedDefines.BonesPerMesh=-1,this.getRenderTargetTextures=function(){return o._renderTargets.reset(),o.reflectionTexture&&o.reflectionTexture.isRenderTarget&&o._renderTargets.push(o.reflectionTexture),o.refractionTexture&&o.refractionTexture.isRenderTarget&&o._renderTargets.push(o.refractionTexture),o._renderTargets}}return __extends(n,i),Object.defineProperty(n.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported},enumerable:!0,configurable:!0}),n.prototype.needAlphaBlending=function(){return!this.linkRefractionWithTransparency&&(this.alpha<1||null!=this.opacityTexture||this._shouldUseAlphaFromAlbedoTexture()||this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled)},n.prototype.needAlphaTesting=function(){return!this.linkRefractionWithTransparency&&(null!=this.albedoTexture&&this.albedoTexture.hasAlpha)},n.prototype._shouldUseAlphaFromAlbedoTexture=function(){return null!=this.albedoTexture&&this.albedoTexture.hasAlpha&&this.useAlphaFromAlbedoTexture},n.prototype.getAlphaTestTexture=function(){return this.albedoTexture},n.prototype._checkCache=function(e,t,i){return!t||this._defines.INSTANCES===i&&!(!t._materialDefines||!t._materialDefines.isEqual(this._defines))},n.prototype.convertColorToLinearSpaceToRef=function(e,t){n.convertColorToLinearSpaceToRef(e,t,this.useScalarInLinearSpace)},n.convertColorToLinearSpaceToRef=function(e,t,i){i?(t.r=e.r,t.g=e.g,t.b=e.b):e.toLinearSpaceToRef(t)},n.BindLights=function(t,i,r,o,s,a,h){for(var l=0,c=!1,u=0;u<t.lights.length;u++){var d=t.lights[u];if(d.isEnabled()&&d.canAffectMesh(i)&&(e.MaterialHelper.BindLightProperties(d,r,l),this.convertColorToLinearSpaceToRef(d.diffuse,n._scaledAlbedo,s),n._scaledAlbedo.scaleToRef(d.intensity,n._scaledAlbedo),r.setColor4("vLightDiffuse"+l,n._scaledAlbedo,h?d.radius:d.range),o.SPECULARTERM&&(this.convertColorToLinearSpaceToRef(d.specular,n._scaledReflectivity,s),n._scaledReflectivity.scaleToRef(d.intensity,n._scaledReflectivity),r.setColor3("vLightSpecular"+l,n._scaledReflectivity)),t.shadowsEnabled&&(c=e.MaterialHelper.BindLightShadow(d,t,i,l,r,c)),l++,l===a))break}},n.prototype.isReady=function(i,n){if(this.checkReadyOnlyOnce&&this._wasPreviouslyReady)return!0;var r=this.getScene();if(!this.checkReadyOnEveryCall&&this._renderId===r.getRenderId()&&this._checkCache(r,i,n))return!0;var o=r.getEngine(),s=!1,a=!1;if(this._defines.reset(),r.texturesEnabled){if(r.texturesEnabled){if(r.getEngine().getCaps().textureLOD&&(this._defines.LODBASEDMICROSFURACE=!0),this.albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled){if(!this.albedoTexture.isReady())return!1;a=!0,this._defines.ALBEDO=!0}if(this.ambientTexture&&e.StandardMaterial.AmbientTextureEnabled){if(!this.ambientTexture.isReady())return!1;a=!0,this._defines.AMBIENT=!0}if(this.opacityTexture&&e.StandardMaterial.OpacityTextureEnabled){if(!this.opacityTexture.isReady())return!1;a=!0,this._defines.OPACITY=!0,this.opacityTexture.getAlphaFromRGB&&(this._defines.OPACITYRGB=!0)}if(this.reflectionTexture&&e.StandardMaterial.ReflectionTextureEnabled){if(!this.reflectionTexture.isReady())return!1;switch(s=!0,this._defines.REFLECTION=!0,this.reflectionTexture.coordinatesMode===e.Texture.INVCUBIC_MODE&&(this._defines.INVERTCUBICMAP=!0),this._defines.REFLECTIONMAP_3D=this.reflectionTexture.isCube,this.reflectionTexture.coordinatesMode){case e.Texture.CUBIC_MODE:case e.Texture.INVCUBIC_MODE:this._defines.REFLECTIONMAP_CUBIC=!0;break;case e.Texture.EXPLICIT_MODE:this._defines.REFLECTIONMAP_EXPLICIT=!0;break;case e.Texture.PLANAR_MODE:this._defines.REFLECTIONMAP_PLANAR=!0;break;case e.Texture.PROJECTION_MODE:this._defines.REFLECTIONMAP_PROJECTION=!0;break;case e.Texture.SKYBOX_MODE:this._defines.REFLECTIONMAP_SKYBOX=!0;break;case e.Texture.SPHERICAL_MODE:this._defines.REFLECTIONMAP_SPHERICAL=!0;break;case e.Texture.EQUIRECTANGULAR_MODE:this._defines.REFLECTIONMAP_EQUIRECTANGULAR=!0}this.reflectionTexture instanceof e.HDRCubeTexture&&this.reflectionTexture&&(this._defines.USESPHERICALFROMREFLECTIONMAP=!0,s=!0,this.reflectionTexture.isPMREM&&(this._defines.USEPMREMREFLECTION=!0))}if(this.lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled){if(!this.lightmapTexture.isReady())return!1;a=!0,this._defines.LIGHTMAP=!0,this._defines.USELIGHTMAPASSHADOWMAP=this.useLightmapAsShadowmap}if(this.emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled){if(!this.emissiveTexture.isReady())return!1;a=!0,this._defines.EMISSIVE=!0}if(this.reflectivityTexture&&e.StandardMaterial.SpecularTextureEnabled){if(!this.reflectivityTexture.isReady())return!1;a=!0,this._defines.REFLECTIVITY=!0,this._defines.MICROSURFACEFROMREFLECTIVITYMAP=this.useMicroSurfaceFromReflectivityMapAlpha,this._defines.MICROSURFACEAUTOMATIC=this.useAutoMicroSurfaceFromReflectivityMap}}if(r.getEngine().getCaps().standardDerivatives&&this.bumpTexture&&e.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap){if(!this.bumpTexture.isReady())return!1;a=!0,this._defines.BUMP=!0,this.useParallax&&(this._defines.PARALLAX=!0,this.useParallaxOcclusion&&(this._defines.PARALLAXOCCLUSION=!0)),this.invertNormalMapX&&(this._defines.INVERTNORMALMAPX=!0),this.invertNormalMapY&&(this._defines.INVERTNORMALMAPY=!0)}if(this.refractionTexture&&e.StandardMaterial.RefractionTextureEnabled){if(!this.refractionTexture.isReady())return!1;a=!0,this._defines.REFRACTION=!0,this._defines.REFRACTIONMAP_3D=this.refractionTexture.isCube,this.linkRefractionWithTransparency&&(this._defines.LINKREFRACTIONTOTRANSPARENCY=!0),this.refractionTexture instanceof e.HDRCubeTexture&&(this._defines.REFRACTIONMAPINLINEARSPACE=!0,this.refractionTexture.isPMREM&&(this._defines.USEPMREMREFRACTION=!0))}if(this.cameraColorGradingTexture){if(!this.cameraColorGradingTexture.isReady())return!1;this._defines.CAMERACOLORGRADING=!0}}if(r.clipPlane&&(this._defines.CLIPPLANE=!0),o.getAlphaTesting()&&(this._defines.ALPHATEST=!0),this._shouldUseAlphaFromAlbedoTexture()&&(this._defines.ALPHAFROMALBEDO=!0),this.useEmissiveAsIllumination&&(this._defines.EMISSIVEASILLUMINATION=!0),this.linkEmissiveWithAlbedo&&(this._defines.LINKEMISSIVEWITHALBEDO=!0),this.useLogarithmicDepth&&(this._defines.LOGARITHMICDEPTH=!0),1!=this.cameraContrast&&(this._defines.CAMERACONTRAST=!0),1!=this.cameraExposure&&(this._defines.CAMERATONEMAP=!0),this.cameraColorCurves&&(this._defines.CAMERACOLORCURVES=!0),1==this.overloadedShadeIntensity&&1==this.overloadedShadowIntensity||(this._defines.OVERLOADEDSHADOWVALUES=!0),(this.overloadedMicroSurfaceIntensity>0||this.overloadedEmissiveIntensity>0||this.overloadedReflectivityIntensity>0||this.overloadedAlbedoIntensity>0||this.overloadedAmbientIntensity>0||this.overloadedReflectionIntensity>0)&&(this._defines.OVERLOADEDVALUES=!0),(this.pointsCloud||r.forcePointsCloud)&&(this._defines.POINTSIZE=!0),r.fogEnabled&&i&&i.applyFog&&r.fogMode!==e.Scene.FOGMODE_NONE&&this.fogEnabled&&(this._defines.FOG=!0),r.lightsEnabled&&!this.disableLighting&&(s=e.MaterialHelper.PrepareDefinesForLights(r,i,this._defines,this.maxSimultaneousLights)||s),e.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled||this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled)&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&(this._defines.OPACITYFRESNEL=!0),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._defines.EMISSIVEFRESNEL=!0),s=!0,this._defines.FRESNEL=!0),this._defines.SPECULARTERM&&this.useSpecularOverAlpha&&(this._defines.SPECULAROVERALPHA=!0),this.usePhysicalLightFalloff&&(this._defines.USEPHYSICALLIGHTFALLOFF=!0),this.useRadianceOverAlpha&&(this._defines.RADIANCEOVERALPHA=!0),i&&(s&&i.isVerticesDataPresent(e.VertexBuffer.NormalKind)&&(this._defines.NORMAL=!0),a&&(i.isVerticesDataPresent(e.VertexBuffer.UVKind)&&(this._defines.UV1=!0),i.isVerticesDataPresent(e.VertexBuffer.UV2Kind)&&(this._defines.UV2=!0)),i.useVertexColors&&i.isVerticesDataPresent(e.VertexBuffer.ColorKind)&&(this._defines.VERTEXCOLOR=!0,i.hasVertexAlpha&&(this._defines.VERTEXALPHA=!0)),i.useBones&&i.computeBonesUsingShaders&&(this._defines.NUM_BONE_INFLUENCERS=i.numBoneInfluencers,this._defines.BonesPerMesh=i.skeleton.bones.length+1),n&&(this._defines.INSTANCES=!0)),!this._defines.isEqual(this._cachedDefines)){this._defines.cloneTo(this._cachedDefines),r.resetCachedMaterial();var h=new e.EffectFallbacks;this._defines.REFLECTION&&h.addFallback(0,"REFLECTION"),this._defines.REFRACTION&&h.addFallback(0,"REFRACTION"),this._defines.REFLECTIVITY&&h.addFallback(0,"REFLECTIVITY"),this._defines.BUMP&&h.addFallback(0,"BUMP"),this._defines.PARALLAX&&h.addFallback(1,"PARALLAX"),this._defines.PARALLAXOCCLUSION&&h.addFallback(0,"PARALLAXOCCLUSION"),this._defines.SPECULAROVERALPHA&&h.addFallback(0,"SPECULAROVERALPHA"),this._defines.FOG&&h.addFallback(1,"FOG"),this._defines.POINTSIZE&&h.addFallback(0,"POINTSIZE"),this._defines.LOGARITHMICDEPTH&&h.addFallback(0,"LOGARITHMICDEPTH"),e.MaterialHelper.HandleFallbacksForShadows(this._defines,h,this.maxSimultaneousLights),this._defines.SPECULARTERM&&h.addFallback(0,"SPECULARTERM"),this._defines.OPACITYFRESNEL&&h.addFallback(1,"OPACITYFRESNEL"),this._defines.EMISSIVEFRESNEL&&h.addFallback(2,"EMISSIVEFRESNEL"),this._defines.FRESNEL&&h.addFallback(3,"FRESNEL"),this._defines.NUM_BONE_INFLUENCERS>0&&h.addCPUSkinningFallback(0,i);var l=[e.VertexBuffer.PositionKind];this._defines.NORMAL&&l.push(e.VertexBuffer.NormalKind),this._defines.UV1&&l.push(e.VertexBuffer.UVKind),this._defines.UV2&&l.push(e.VertexBuffer.UV2Kind),this._defines.VERTEXCOLOR&&l.push(e.VertexBuffer.ColorKind),e.MaterialHelper.PrepareAttributesForBones(l,i,this._defines,h),e.MaterialHelper.PrepareAttributesForInstances(l,this._defines);var c="pbr";r.getEngine().getCaps().standardDerivatives||(c="legacypbr");var u=this._defines.toString(),d=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vEmissiveColor","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vReflectivityInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","bumpMatrix","lightmapMatrix","refractionMatrix","depthValues","opacityParts","emissiveLeftColor","emissiveRightColor","vLightingIntensity","vOverloadedShadowIntensity","vOverloadedIntensity","vOverloadedAlbedo","vOverloadedReflection","vOverloadedReflectivity","vOverloadedEmissive","vOverloadedMicroSurface","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX","vSphericalYY","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vMicrosurfaceTextureLods","vCameraInfos","vCameraColorGradingInfos","vCameraColorGradingScaleOffset"],f=["albedoSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","reflectivitySampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","cameraColorGrading2DSampler"];e.ColorCurves.PrepareUniforms(d),e.MaterialHelper.PrepareUniformsAndSamplersList(d,f,this._defines,this.maxSimultaneousLights),this._effect=r.getEngine().createEffect(c,l,d,f,u,h,this.onCompiled,this.onError,{maxSimultaneousLights:this.maxSimultaneousLights})}return!!this._effect.isReady()&&(this._renderId=r.getRenderId(),this._wasPreviouslyReady=!0,i&&(i._materialDefines||(i._materialDefines=new t),this._defines.cloneTo(i._materialDefines)),!0)},n.prototype.unbind=function(){this.reflectionTexture&&this.reflectionTexture.isRenderTarget&&this._effect.setTexture("reflection2DSampler",null),this.refractionTexture&&this.refractionTexture.isRenderTarget&&this._effect.setTexture("refraction2DSampler",null),i.prototype.unbind.call(this)},n.prototype.bindOnlyWorldMatrix=function(e){this._effect.setMatrix("world",e)},n.prototype.bind=function(t,r){if(this._myScene=this.getScene(),this.bindOnlyWorldMatrix(t),e.MaterialHelper.BindBonesParameters(r,this._effect),this._myScene.getCachedMaterial()!==this){if(this._effect.setMatrix("viewProjection",this._myScene.getTransformMatrix()),e.StandardMaterial.FresnelEnabled&&(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&this._effect.setColor4("opacityParts",new e.Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(this._effect.setColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),this._effect.setColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),this._myScene.texturesEnabled){if(this.albedoTexture&&e.StandardMaterial.DiffuseTextureEnabled&&(this._effect.setTexture("albedoSampler",this.albedoTexture),this._effect.setFloat2("vAlbedoInfos",this.albedoTexture.coordinatesIndex,this.albedoTexture.level),this._effect.setMatrix("albedoMatrix",this.albedoTexture.getTextureMatrix())),this.ambientTexture&&e.StandardMaterial.AmbientTextureEnabled&&(this._effect.setTexture("ambientSampler",this.ambientTexture),this._effect.setFloat2("vAmbientInfos",this.ambientTexture.coordinatesIndex,this.ambientTexture.level),this._effect.setMatrix("ambientMatrix",this.ambientTexture.getTextureMatrix())),this.opacityTexture&&e.StandardMaterial.OpacityTextureEnabled&&(this._effect.setTexture("opacitySampler",this.opacityTexture),this._effect.setFloat2("vOpacityInfos",this.opacityTexture.coordinatesIndex,this.opacityTexture.level),this._effect.setMatrix("opacityMatrix",this.opacityTexture.getTextureMatrix())),this.reflectionTexture&&e.StandardMaterial.ReflectionTextureEnabled&&(this._microsurfaceTextureLods.x=Math.round(Math.log(this.reflectionTexture.getSize().width)*Math.LOG2E),this.reflectionTexture.isCube?this._effect.setTexture("reflectionCubeSampler",this.reflectionTexture):this._effect.setTexture("reflection2DSampler",this.reflectionTexture),this._effect.setMatrix("reflectionMatrix",this.reflectionTexture.getReflectionTextureMatrix()),this._effect.setFloat2("vReflectionInfos",this.reflectionTexture.level,0),this._defines.USESPHERICALFROMREFLECTIONMAP&&(this._effect.setFloat3("vSphericalX",this.reflectionTexture.sphericalPolynomial.x.x,this.reflectionTexture.sphericalPolynomial.x.y,this.reflectionTexture.sphericalPolynomial.x.z),this._effect.setFloat3("vSphericalY",this.reflectionTexture.sphericalPolynomial.y.x,this.reflectionTexture.sphericalPolynomial.y.y,this.reflectionTexture.sphericalPolynomial.y.z),this._effect.setFloat3("vSphericalZ",this.reflectionTexture.sphericalPolynomial.z.x,this.reflectionTexture.sphericalPolynomial.z.y,this.reflectionTexture.sphericalPolynomial.z.z),this._effect.setFloat3("vSphericalXX",this.reflectionTexture.sphericalPolynomial.xx.x,this.reflectionTexture.sphericalPolynomial.xx.y,this.reflectionTexture.sphericalPolynomial.xx.z),this._effect.setFloat3("vSphericalYY",this.reflectionTexture.sphericalPolynomial.yy.x,this.reflectionTexture.sphericalPolynomial.yy.y,this.reflectionTexture.sphericalPolynomial.yy.z),this._effect.setFloat3("vSphericalZZ",this.reflectionTexture.sphericalPolynomial.zz.x,this.reflectionTexture.sphericalPolynomial.zz.y,this.reflectionTexture.sphericalPolynomial.zz.z),this._effect.setFloat3("vSphericalXY",this.reflectionTexture.sphericalPolynomial.xy.x,this.reflectionTexture.sphericalPolynomial.xy.y,this.reflectionTexture.sphericalPolynomial.xy.z),this._effect.setFloat3("vSphericalYZ",this.reflectionTexture.sphericalPolynomial.yz.x,this.reflectionTexture.sphericalPolynomial.yz.y,this.reflectionTexture.sphericalPolynomial.yz.z),this._effect.setFloat3("vSphericalZX",this.reflectionTexture.sphericalPolynomial.zx.x,this.reflectionTexture.sphericalPolynomial.zx.y,this.reflectionTexture.sphericalPolynomial.zx.z))),this.emissiveTexture&&e.StandardMaterial.EmissiveTextureEnabled&&(this._effect.setTexture("emissiveSampler",this.emissiveTexture),this._effect.setFloat2("vEmissiveInfos",this.emissiveTexture.coordinatesIndex,this.emissiveTexture.level),this._effect.setMatrix("emissiveMatrix",this.emissiveTexture.getTextureMatrix())),
this.lightmapTexture&&e.StandardMaterial.LightmapTextureEnabled&&(this._effect.setTexture("lightmapSampler",this.lightmapTexture),this._effect.setFloat2("vLightmapInfos",this.lightmapTexture.coordinatesIndex,this.lightmapTexture.level),this._effect.setMatrix("lightmapMatrix",this.lightmapTexture.getTextureMatrix())),this.reflectivityTexture&&e.StandardMaterial.SpecularTextureEnabled&&(this._effect.setTexture("reflectivitySampler",this.reflectivityTexture),this._effect.setFloat2("vReflectivityInfos",this.reflectivityTexture.coordinatesIndex,this.reflectivityTexture.level),this._effect.setMatrix("reflectivityMatrix",this.reflectivityTexture.getTextureMatrix())),this.bumpTexture&&this._myScene.getEngine().getCaps().standardDerivatives&&e.StandardMaterial.BumpTextureEnabled&&!this.disableBumpMap&&(this._effect.setTexture("bumpSampler",this.bumpTexture),this._effect.setFloat3("vBumpInfos",this.bumpTexture.coordinatesIndex,1/this.bumpTexture.level,this.parallaxScaleBias),this._effect.setMatrix("bumpMatrix",this.bumpTexture.getTextureMatrix())),this.refractionTexture&&e.StandardMaterial.RefractionTextureEnabled){this._microsurfaceTextureLods.y=Math.round(Math.log(this.refractionTexture.getSize().width)*Math.LOG2E);var o=1;this.refractionTexture.isCube?this._effect.setTexture("refractionCubeSampler",this.refractionTexture):(this._effect.setTexture("refraction2DSampler",this.refractionTexture),this._effect.setMatrix("refractionMatrix",this.refractionTexture.getReflectionTextureMatrix()),this.refractionTexture.depth&&(o=this.refractionTexture.depth)),this._effect.setFloat4("vRefractionInfos",this.refractionTexture.level,this.indexOfRefraction,o,this.invertRefractionY?-1:1)}if((this.reflectionTexture||this.refractionTexture)&&this._effect.setFloat2("vMicrosurfaceTextureLods",this._microsurfaceTextureLods.x,this._microsurfaceTextureLods.y),this.cameraColorGradingTexture){this._effect.setTexture("cameraColorGrading2DSampler",this.cameraColorGradingTexture),this._cameraColorGradingInfos.x=this.cameraColorGradingTexture.level,this._cameraColorGradingInfos.y=this.cameraColorGradingTexture.getSize().height,this._cameraColorGradingInfos.z=this._cameraColorGradingInfos.y-1,this._cameraColorGradingInfos.w=1/this._cameraColorGradingInfos.y,this._effect.setFloat4("vCameraColorGradingInfos",this._cameraColorGradingInfos.x,this._cameraColorGradingInfos.y,this._cameraColorGradingInfos.z,this._cameraColorGradingInfos.w);var s=this._cameraColorGradingInfos.w/this._cameraColorGradingInfos.y,a=1/this._cameraColorGradingInfos.y;this._cameraColorGradingScaleOffset.x=this._cameraColorGradingInfos.z*s,this._cameraColorGradingScaleOffset.y=this._cameraColorGradingInfos.z/this._cameraColorGradingInfos.y,this._cameraColorGradingScaleOffset.z=.5*s,this._cameraColorGradingScaleOffset.w=.5*a,this._effect.setFloat4("vCameraColorGradingScaleOffset",this._cameraColorGradingScaleOffset.x,this._cameraColorGradingScaleOffset.y,this._cameraColorGradingScaleOffset.z,this._cameraColorGradingScaleOffset.w)}}e.MaterialHelper.BindClipPlane(this._effect,this._myScene),this.pointsCloud&&this._effect.setFloat("pointSize",this.pointSize),this._myScene.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this.convertColorToLinearSpaceToRef(this.reflectivityColor,n._scaledReflectivity),this._effect.setVector3("vEyePosition",this._myScene._mirroredCameraPosition?this._myScene._mirroredCameraPosition:this._myScene.activeCamera.position),this._effect.setColor3("vAmbientColor",this._globalAmbientColor),this._effect.setColor4("vReflectivityColor",n._scaledReflectivity,this.microSurface),this.convertColorToLinearSpaceToRef(this.emissiveColor,n._scaledEmissive),this._effect.setColor3("vEmissiveColor",n._scaledEmissive),this.convertColorToLinearSpaceToRef(this.reflectionColor,n._scaledReflection),this._effect.setColor3("vReflectionColor",n._scaledReflection)}this._myScene.getCachedMaterial()===this&&this.isFrozen||(this.convertColorToLinearSpaceToRef(this.albedoColor,n._scaledAlbedo),this._effect.setColor4("vAlbedoColor",n._scaledAlbedo,this.alpha*r.visibility),this._myScene.lightsEnabled&&!this.disableLighting&&n.BindLights(this._myScene,r,this._effect,this._defines,this.useScalarInLinearSpace,this.maxSimultaneousLights,this.usePhysicalLightFalloff),(this._myScene.fogEnabled&&r.applyFog&&this._myScene.fogMode!==e.Scene.FOGMODE_NONE||this.reflectionTexture)&&this._effect.setMatrix("view",this._myScene.getViewMatrix()),e.MaterialHelper.BindFogParameters(this._myScene,r,this._effect),this._lightingInfos.x=this.directIntensity,this._lightingInfos.y=this.emissiveIntensity,this._lightingInfos.z=this.environmentIntensity,this._lightingInfos.w=this.specularIntensity,this._effect.setVector4("vLightingIntensity",this._lightingInfos),this._overloadedShadowInfos.x=this.overloadedShadowIntensity,this._overloadedShadowInfos.y=this.overloadedShadeIntensity,this._effect.setVector4("vOverloadedShadowIntensity",this._overloadedShadowInfos),this._cameraInfos.x=this.cameraExposure,this._cameraInfos.y=this.cameraContrast,this._effect.setVector4("vCameraInfos",this._cameraInfos),this.cameraColorCurves&&e.ColorCurves.Bind(this.cameraColorCurves,this._effect),this._overloadedIntensity.x=this.overloadedAmbientIntensity,this._overloadedIntensity.y=this.overloadedAlbedoIntensity,this._overloadedIntensity.z=this.overloadedReflectivityIntensity,this._overloadedIntensity.w=this.overloadedEmissiveIntensity,this._effect.setVector4("vOverloadedIntensity",this._overloadedIntensity),this.convertColorToLinearSpaceToRef(this.overloadedAmbient,this._tempColor),this._effect.setColor3("vOverloadedAmbient",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedAlbedo,this._tempColor),this._effect.setColor3("vOverloadedAlbedo",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflectivity,this._tempColor),this._effect.setColor3("vOverloadedReflectivity",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedEmissive,this._tempColor),this._effect.setColor3("vOverloadedEmissive",this._tempColor),this.convertColorToLinearSpaceToRef(this.overloadedReflection,this._tempColor),this._effect.setColor3("vOverloadedReflection",this._tempColor),this._overloadedMicroSurface.x=this.overloadedMicroSurface,this._overloadedMicroSurface.y=this.overloadedMicroSurfaceIntensity,this._overloadedMicroSurface.z=this.overloadedReflectionIntensity,this._effect.setVector3("vOverloadedMicroSurface",this._overloadedMicroSurface),e.MaterialHelper.BindLogDepth(this._defines,this._effect,this._myScene)),i.prototype.bind.call(this,t,r),this._myScene=null},n.prototype.getAnimatables=function(){var e=[];return this.albedoTexture&&this.albedoTexture.animations&&this.albedoTexture.animations.length>0&&e.push(this.albedoTexture),this.ambientTexture&&this.ambientTexture.animations&&this.ambientTexture.animations.length>0&&e.push(this.ambientTexture),this.opacityTexture&&this.opacityTexture.animations&&this.opacityTexture.animations.length>0&&e.push(this.opacityTexture),this.reflectionTexture&&this.reflectionTexture.animations&&this.reflectionTexture.animations.length>0&&e.push(this.reflectionTexture),this.emissiveTexture&&this.emissiveTexture.animations&&this.emissiveTexture.animations.length>0&&e.push(this.emissiveTexture),this.reflectivityTexture&&this.reflectivityTexture.animations&&this.reflectivityTexture.animations.length>0&&e.push(this.reflectivityTexture),this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this.lightmapTexture&&this.lightmapTexture.animations&&this.lightmapTexture.animations.length>0&&e.push(this.lightmapTexture),this.refractionTexture&&this.refractionTexture.animations&&this.refractionTexture.animations.length>0&&e.push(this.refractionTexture),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.animations&&this.cameraColorGradingTexture.animations.length>0&&e.push(this.cameraColorGradingTexture),e},n.prototype.dispose=function(e,t){t&&(this.albedoTexture&&this.albedoTexture.dispose(),this.ambientTexture&&this.ambientTexture.dispose(),this.opacityTexture&&this.opacityTexture.dispose(),this.reflectionTexture&&this.reflectionTexture.dispose(),this.emissiveTexture&&this.emissiveTexture.dispose(),this.reflectivityTexture&&this.reflectivityTexture.dispose(),this.bumpTexture&&this.bumpTexture.dispose(),this.lightmapTexture&&this.lightmapTexture.dispose(),this.refractionTexture&&this.refractionTexture.dispose(),this.cameraColorGradingTexture&&this.cameraColorGradingTexture.dispose()),i.prototype.dispose.call(this,e,t)},n.prototype.clone=function(t){var i=this;return e.SerializationHelper.Clone(function(){return new n(t,i.getScene())},this)},n.prototype.serialize=function(){var t=e.SerializationHelper.Serialize(this);return t.customType="BABYLON.PBRMaterial",t},n.Parse=function(t,i,r){return e.SerializationHelper.Parse(function(){return new n(t.name,i)},t,i,r)},n._scaledAlbedo=new e.Color3,n._scaledReflectivity=new e.Color3,n._scaledEmissive=new e.Color3,n._scaledReflection=new e.Color3,__decorate([e.serialize()],n.prototype,"directIntensity",void 0),__decorate([e.serialize()],n.prototype,"emissiveIntensity",void 0),__decorate([e.serialize()],n.prototype,"environmentIntensity",void 0),__decorate([e.serialize()],n.prototype,"specularIntensity",void 0),__decorate([e.serialize()],n.prototype,"disableBumpMap",void 0),__decorate([e.serialize()],n.prototype,"overloadedShadowIntensity",void 0),__decorate([e.serialize()],n.prototype,"overloadedShadeIntensity",void 0),__decorate([e.serialize()],n.prototype,"cameraExposure",void 0),__decorate([e.serialize()],n.prototype,"cameraContrast",void 0),__decorate([e.serializeAsTexture()],n.prototype,"cameraColorGradingTexture",void 0),__decorate([e.serializeAsColorCurves()],n.prototype,"cameraColorCurves",void 0),__decorate([e.serializeAsColor3()],n.prototype,"overloadedAmbient",void 0),__decorate([e.serialize()],n.prototype,"overloadedAmbientIntensity",void 0),__decorate([e.serializeAsColor3()],n.prototype,"overloadedAlbedo",void 0),__decorate([e.serialize()],n.prototype,"overloadedAlbedoIntensity",void 0),__decorate([e.serializeAsColor3()],n.prototype,"overloadedReflectivity",void 0),__decorate([e.serialize()],n.prototype,"overloadedReflectivityIntensity",void 0),__decorate([e.serializeAsColor3()],n.prototype,"overloadedEmissive",void 0),__decorate([e.serialize()],n.prototype,"overloadedEmissiveIntensity",void 0),__decorate([e.serializeAsColor3()],n.prototype,"overloadedReflection",void 0),__decorate([e.serialize()],n.prototype,"overloadedReflectionIntensity",void 0),__decorate([e.serialize()],n.prototype,"overloadedMicroSurface",void 0),__decorate([e.serialize()],n.prototype,"overloadedMicroSurfaceIntensity",void 0),__decorate([e.serializeAsTexture()],n.prototype,"albedoTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"ambientTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"opacityTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"reflectionTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"emissiveTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"reflectivityTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"bumpTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"lightmapTexture",void 0),__decorate([e.serializeAsTexture()],n.prototype,"refractionTexture",void 0),__decorate([e.serializeAsColor3("ambient")],n.prototype,"ambientColor",void 0),__decorate([e.serializeAsColor3("albedo")],n.prototype,"albedoColor",void 0),__decorate([e.serializeAsColor3("reflectivity")],n.prototype,"reflectivityColor",void 0),__decorate([e.serializeAsColor3("reflection")],n.prototype,"reflectionColor",void 0),__decorate([e.serializeAsColor3("emissive")],n.prototype,"emissiveColor",void 0),__decorate([e.serialize()],n.prototype,"microSurface",void 0),__decorate([e.serialize()],n.prototype,"indexOfRefraction",void 0),__decorate([e.serialize()],n.prototype,"invertRefractionY",void 0),__decorate([e.serializeAsFresnelParameters()],n.prototype,"opacityFresnelParameters",void 0),__decorate([e.serializeAsFresnelParameters()],n.prototype,"emissiveFresnelParameters",void 0),__decorate([e.serialize()],n.prototype,"linkRefractionWithTransparency",void 0),__decorate([e.serialize()],n.prototype,"linkEmissiveWithAlbedo",void 0),__decorate([e.serialize()],n.prototype,"useLightmapAsShadowmap",void 0),__decorate([e.serialize()],n.prototype,"useEmissiveAsIllumination",void 0),__decorate([e.serialize()],n.prototype,"useAlphaFromAlbedoTexture",void 0),__decorate([e.serialize()],n.prototype,"useSpecularOverAlpha",void 0),__decorate([e.serialize()],n.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),__decorate([e.serialize()],n.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),__decorate([e.serialize()],n.prototype,"useScalarInLinearSpace",void 0),__decorate([e.serialize()],n.prototype,"usePhysicalLightFalloff",void 0),__decorate([e.serialize()],n.prototype,"useRadianceOverAlpha",void 0),__decorate([e.serialize()],n.prototype,"useParallax",void 0),__decorate([e.serialize()],n.prototype,"useParallaxOcclusion",void 0),__decorate([e.serialize()],n.prototype,"parallaxScaleBias",void 0),__decorate([e.serialize()],n.prototype,"disableLighting",void 0),__decorate([e.serialize()],n.prototype,"maxSimultaneousLights",void 0),__decorate([e.serialize()],n.prototype,"invertNormalMapX",void 0),__decorate([e.serialize()],n.prototype,"invertNormalMapY",void 0),__decorate([e.serialize()],n.prototype,"useLogarithmicDepth",null),n}(e.Material);e.PBRMaterial=i}(BABYLON||(BABYLON={}));var BABYLON;!function(e){var t=function(){function t(t){var i=this;this._transformationMatrix=e.Matrix.Identity(),this._enabled=!1,this._labelsEnabled=!1,this._displayStatistics=!0,this._displayTree=!1,this._displayLogs=!1,this._skeletonViewers=new Array,this._identityMatrix=e.Matrix.Identity(),this.axisRatio=.02,this.accentColor="orange",this._scene=t,this._syncPositions=function(){var e=i._scene.getEngine(),t=e.getRenderingCanvasClientRect();i._showUI&&(i._statsDiv.style.left=t.width-410+"px",i._statsDiv.style.top=t.height-290+"px",i._statsDiv.style.width="400px",i._statsDiv.style.height="auto",i._statsSubsetDiv.style.maxHeight="240px",i._optionsDiv.style.left="0px",i._optionsDiv.style.top="10px",i._optionsDiv.style.width="200px",i._optionsDiv.style.height="auto",i._optionsSubsetDiv.style.maxHeight=t.height-225+"px",i._logDiv.style.left="0px",i._logDiv.style.top=t.height-170+"px",i._logDiv.style.width="600px",i._logDiv.style.height="160px",i._treeDiv.style.left=t.width-310+"px",i._treeDiv.style.top="10px",i._treeDiv.style.width="300px",i._treeDiv.style.height="auto",i._treeSubsetDiv.style.maxHeight=t.height-340+"px"),i._globalDiv.style.left=t.left+"px",i._globalDiv.style.top=t.top+"px",i._drawingCanvas.style.left="0px",i._drawingCanvas.style.top="0px",i._drawingCanvas.style.width=e.getRenderWidth()+"px",i._drawingCanvas.style.height=e.getRenderHeight()+"px";var n=window.devicePixelRatio||1,r=i._drawingContext,o=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1;i._ratio=n/o,i._drawingCanvas.width=e.getRenderWidth()*i._ratio,i._drawingCanvas.height=e.getRenderHeight()*i._ratio},this._onCanvasClick=function(e){i._clickPosition={x:e.clientX*i._ratio,y:e.clientY*i._ratio}},this._syncUI=function(){i._showUI&&(i._displayStatistics?(i._displayStats(),i._statsDiv.style.display=""):i._statsDiv.style.display="none",i._displayLogs?i._logDiv.style.display="":i._logDiv.style.display="none",i._displayTree?(i._treeDiv.style.display="",i._needToRefreshMeshesTree&&(i._needToRefreshMeshesTree=!1,i._refreshMeshesTreeContent())):i._treeDiv.style.display="none")},this._syncData=function(){if(i._labelsEnabled||!i._showUI){i._camera.getViewMatrix().multiplyToRef(i._camera.getProjectionMatrix(),i._transformationMatrix),i._drawingContext.clearRect(0,0,i._drawingCanvas.width,i._drawingCanvas.height);var t,n,r=i._scene.getEngine(),o=i._camera.viewport,s=o.toGlobal(r.getRenderWidth(),r.getRenderHeight()),a=i._camera.getActiveMeshes();for(t=0;t<a.length;t++){var h=a.data[t],l=h.getBoundingInfo().boundingSphere.center;n=e.Vector3.Project(l,h.getWorldMatrix(),i._transformationMatrix,s),(h.renderOverlay||i.shouldDisplayAxis&&i.shouldDisplayAxis(h))&&i._renderAxis(n,h,s),i.shouldDisplayLabel&&!i.shouldDisplayLabel(h)||i._renderLabel(h.name,n,12,function(){h.renderOverlay=!h.renderOverlay},function(){return h.renderOverlay?"red":"black"})}var c=i._scene.cameras;for(t=0;t<c.length;t++){var u=c[t];u!==i._camera&&(n=e.Vector3.Project(e.Vector3.Zero(),u.getWorldMatrix(),i._transformationMatrix,s),i.shouldDisplayLabel&&!i.shouldDisplayLabel(u)||i._renderLabel(u.name,n,12,function(){i._camera.detachControl(r.getRenderingCanvas()),i._camera=u,i._camera.attachControl(r.getRenderingCanvas())},function(){return"purple"}))}var d=i._scene.lights;for(t=0;t<d.length;t++){var f=d[t];f.position&&(n=e.Vector3.Project(f.getAbsolutePosition(),i._identityMatrix,i._transformationMatrix,s),i.shouldDisplayLabel&&!i.shouldDisplayLabel(f)||i._renderLabel(f.name,n,-20,function(){f.setEnabled(!f.isEnabled())},function(){return f.isEnabled()?"orange":"gray"}))}}i._clickPosition=void 0}}return t.prototype._refreshMeshesTreeContent=function(){for(;this._treeSubsetDiv.hasChildNodes();)this._treeSubsetDiv.removeChild(this._treeSubsetDiv.lastChild);var e=this._scene.meshes.slice(0,this._scene.meshes.length);e.sort(function(e,t){return e.name===t.name?0:e.name>t.name?1:-1});for(var t=0;t<e.length;t++){var i=e[t];i.isEnabled()&&this._generateAdvancedCheckBox(this._treeSubsetDiv,i.name,i.getTotalVertices()+" verts",i.isVisible,function(e,t){t.isVisible=e.checked},i)}},t.prototype._renderSingleAxis=function(e,t,i,n,r){this._drawingContext.beginPath(),this._drawingContext.moveTo(e.x,e.y),this._drawingContext.lineTo(t.x,t.y),this._drawingContext.strokeStyle=r,this._drawingContext.lineWidth=4,this._drawingContext.stroke(),this._drawingContext.font="normal 14px Segoe UI",this._drawingContext.fillStyle=r,this._drawingContext.fillText(n,i.x,i.y)},t.prototype._renderAxis=function(t,i,n){var r=i.getBoundingInfo().boundingSphere.center,o=i.getWorldMatrix(),s=e.Vector3.UnprojectFromTransform(t.add(new e.Vector3(this._drawingCanvas.width*this.axisRatio,0,0)),n.width,n.height,o,this._transformationMatrix),a=s.subtract(r).length(),h=e.Vector3.Project(r.add(new e.Vector3(a,0,0)),o,this._transformationMatrix,n),l=e.Vector3.Project(r.add(new e.Vector3(1.5*a,0,0)),o,this._transformationMatrix,n);this._renderSingleAxis(t,h,l,"x","#FF0000");var c=e.Vector3.Project(r.add(new e.Vector3(0,a,0)),o,this._transformationMatrix,n),u=e.Vector3.Project(r.add(new e.Vector3(0,1.5*a,0)),o,this._transformationMatrix,n);this._renderSingleAxis(t,c,u,"y","#00FF00");var d=e.Vector3.Project(r.add(new e.Vector3(0,0,a)),o,this._transformationMatrix,n),f=e.Vector3.Project(r.add(new e.Vector3(0,0,1.5*a)),o,this._transformationMatrix,n);this._renderSingleAxis(t,d,f,"z","#0000FF")},t.prototype._renderLabel=function(e,t,i,n,r){if(t.z>0&&t.z<1){this._drawingContext.font="normal 12px Segoe UI";var o=this._drawingContext.measureText(e),s=t.x-o.width/2,a=t.y,h=this._drawingCanvas.getBoundingClientRect();this._showUI&&this._isClickInsideRect(h.left*this._ratio+s-5,h.top*this._ratio+a-i-12,o.width+10,17)&&n(),this._drawingContext.beginPath(),this._drawingContext.rect(s-5,a-i-12,o.width+10,17),this._drawingContext.fillStyle=r(),this._drawingContext.globalAlpha=.5,this._drawingContext.fill(),this._drawingContext.globalAlpha=1,this._drawingContext.strokeStyle="#FFFFFF",this._drawingContext.lineWidth=1,this._drawingContext.stroke(),this._drawingContext.fillStyle="#FFFFFF",this._drawingContext.fillText(e,s,a-i),this._drawingContext.beginPath(),this._drawingContext.arc(t.x,a,5,0,2*Math.PI,!1),this._drawingContext.fill()}},t.prototype._isClickInsideRect=function(e,t,i,n){return!!this._clickPosition&&(!(this._clickPosition.x<e||this._clickPosition.x>e+i)&&!(this._clickPosition.y<t||this._clickPosition.y>t+n))},t.prototype.isVisible=function(){return this._enabled},t.prototype.hide=function(){if(this._enabled){this._enabled=!1;var t=this._scene.getEngine();this._scene.unregisterBeforeRender(this._syncData),this._scene.unregisterAfterRender(this._syncUI),this._rootElement.removeChild(this._globalDiv),this._scene.forceShowBoundingBoxes=!1,this._scene.forceWireframe=!1,e.StandardMaterial.DiffuseTextureEnabled=!0,e.StandardMaterial.AmbientTextureEnabled=!0,e.StandardMaterial.SpecularTextureEnabled=!0,e.StandardMaterial.EmissiveTextureEnabled=!0,e.StandardMaterial.BumpTextureEnabled=!0,e.StandardMaterial.OpacityTextureEnabled=!0,e.StandardMaterial.ReflectionTextureEnabled=!0,e.StandardMaterial.LightmapTextureEnabled=!0,e.StandardMaterial.RefractionTextureEnabled=!0,this._scene.shadowsEnabled=!0,this._scene.particlesEnabled=!0,this._scene.postProcessesEnabled=!0,this._scene.collisionsEnabled=!0,this._scene.lightsEnabled=!0,this._scene.texturesEnabled=!0,this._scene.lensFlaresEnabled=!0,this._scene.proceduralTexturesEnabled=!0,this._scene.renderTargetsEnabled=!0,this._scene.probesEnabled=!0,t.getRenderingCanvas().removeEventListener("click",this._onCanvasClick),this._clearSkeletonViewers()}},t.prototype._clearSkeletonViewers=function(){for(var e=0;e<this._skeletonViewers.length;e++)this._skeletonViewers[e].dispose();this._skeletonViewers=[]},t.prototype.show=function(e,t,i){if(void 0===e&&(e=!0),void 0===t&&(t=null),void 0===i&&(i=null),!this._enabled){this._enabled=!0,t?this._camera=t:this._camera=this._scene.activeCamera,this._showUI=e;var n=this._scene.getEngine();this._globalDiv=document.createElement("div"),this._rootElement=i||document.body,this._rootElement.appendChild(this._globalDiv),this._generateDOMelements(),n.getRenderingCanvas().addEventListener("click",this._onCanvasClick),this._syncPositions(),this._scene.registerBeforeRender(this._syncData),this._scene.registerAfterRender(this._syncUI)}},t.prototype._clearLabels=function(){this._drawingContext.clearRect(0,0,this._drawingCanvas.width,this._drawingCanvas.height);for(var e=0;e<this._scene.meshes.length;e++){var t=this._scene.meshes[e];t.renderOverlay=!1}},t.prototype._generateheader=function(e,t){var i=document.createElement("div");i.innerHTML=t+"&nbsp;",i.style.textAlign="right",i.style.width="100%",i.style.color="white",i.style.backgroundColor="Black",i.style.padding="5px 5px 4px 0px",i.style.marginLeft="-5px",i.style.fontWeight="bold",e.appendChild(i)},t.prototype._generateTexBox=function(e,t,i){var n=document.createElement("label");n.style.display="inline",n.innerHTML=t,n.style.color=i,e.appendChild(n),e.appendChild(document.createElement("br"))},t.prototype._generateAdvancedCheckBox=function(e,t,i,n,r,o){void 0===o&&(o=null);var s=document.createElement("label");s.style.display="inline";var a=document.createElement("input");a.type="checkbox",a.checked=n,a.style.display="inline",a.style.margin="0px 5px 0px 0px",a.style.verticalAlign="sub",a.addEventListener("change",function(e){r(e.target,o)}),s.appendChild(a);var h=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span");c.style.cssFloat="right",l.innerHTML=t,c.innerHTML=i,c.style.fontSize="12px",c.style.maxWidth="200px",h.appendChild(l),h.appendChild(c),s.appendChild(h),e.appendChild(s),e.appendChild(document.createElement("br"))},t.prototype._generateCheckBox=function(e,t,i,n,r){void 0===r&&(r=null);var o=document.createElement("label");o.style.display="inline";var s=document.createElement("input");s.type="checkbox",s.checked=i,s.style.display="inline",s.style.margin="0px 5px 0px 0px",s.style.verticalAlign="sub",s.addEventListener("change",function(e){n(e.target,r)}),o.appendChild(s),o.appendChild(document.createTextNode(t)),e.appendChild(o),e.appendChild(document.createElement("br"))},t.prototype._generateButton=function(e,t,i,n){void 0===n&&(n=null);var r=document.createElement("button");r.innerHTML=t,r.style.height="24px",r.style.width="150px",r.style.marginBottom="5px",r.style.color="#444444",r.style.border="1px solid white",r.className="debugLayerButton",r.addEventListener("click",function(e){i(e.target,n)}),e.appendChild(r),e.appendChild(document.createElement("br"))},t.prototype._generateRadio=function(e,t,i,n,r,o){void 0===o&&(o=null);var s=document.createElement("label");s.style.display="inline";var a=document.createElement("input");a.type="radio",a.name=i,a.checked=n,a.style.display="inline",a.style.margin="0px 5px 0px 0px",a.style.verticalAlign="sub",a.addEventListener("change",function(e){r(e.target,o)}),s.appendChild(a),s.appendChild(document.createTextNode(t)),e.appendChild(s),e.appendChild(document.createElement("br"))},t.prototype._generateDOMelements=function(){var t=this;if(this._globalDiv.id="DebugLayer",this._globalDiv.style.position="absolute",this._globalDiv.style.fontFamily="Segoe UI, Arial",this._globalDiv.style.fontSize="14px",this._globalDiv.style.color="white",this._drawingCanvas=document.createElement("canvas"),this._drawingCanvas.id="DebugLayerDrawingCanvas",this._drawingCanvas.style.position="absolute",this._drawingCanvas.style.pointerEvents="none",this._drawingCanvas.style.backgroundColor="transparent",this._drawingContext=this._drawingCanvas.getContext("2d"),this._globalDiv.appendChild(this._drawingCanvas),this._showUI){var i="rgba(128, 128, 128, 0.4)",n="rgb(180, 180, 180) solid 1px";this._statsDiv=document.createElement("div"),this._statsDiv.id="DebugLayerStats",this._statsDiv.style.border=n,this._statsDiv.style.position="absolute",this._statsDiv.style.background=i,this._statsDiv.style.padding="0px 0px 0px 5px",this._generateheader(this._statsDiv,"STATISTICS"),this._statsSubsetDiv=document.createElement("div"),this._statsSubsetDiv.style.paddingTop="5px",this._statsSubsetDiv.style.paddingBottom="5px",this._statsSubsetDiv.style.overflowY="auto",this._statsDiv.appendChild(this._statsSubsetDiv),this._treeDiv=document.createElement("div"),this._treeDiv.id="DebugLayerTree",this._treeDiv.style.border=n,this._treeDiv.style.position="absolute",this._treeDiv.style.background=i,this._treeDiv.style.padding="0px 0px 0px 5px",this._treeDiv.style.display="none",this._generateheader(this._treeDiv,"MESHES TREE"),this._treeSubsetDiv=document.createElement("div"),this._treeSubsetDiv.style.paddingTop="5px",this._treeSubsetDiv.style.paddingRight="5px",this._treeSubsetDiv.style.overflowY="auto",this._treeSubsetDiv.style.maxHeight="300px",this._treeDiv.appendChild(this._treeSubsetDiv),this._needToRefreshMeshesTree=!0,this._logDiv=document.createElement("div"),this._logDiv.style.border=n,this._logDiv.id="DebugLayerLogs",this._logDiv.style.position="absolute",this._logDiv.style.background=i,this._logDiv.style.padding="0px 0px 0px 5px",this._logDiv.style.display="none",this._generateheader(this._logDiv,"LOGS"),this._logSubsetDiv=document.createElement("div"),this._logSubsetDiv.style.height="127px",this._logSubsetDiv.style.paddingTop="5px",this._logSubsetDiv.style.overflowY="auto",this._logSubsetDiv.style.fontSize="12px",this._logSubsetDiv.style.fontFamily="consolas",this._logSubsetDiv.innerHTML=e.Tools.LogCache,this._logDiv.appendChild(this._logSubsetDiv),e.Tools.OnNewCacheEntry=function(e){t._logSubsetDiv.innerHTML=e+t._logSubsetDiv.innerHTML},this._optionsDiv=document.createElement("div"),this._optionsDiv.id="DebugLayerOptions",this._optionsDiv.style.border=n,this._optionsDiv.style.position="absolute",this._optionsDiv.style.background=i,this._optionsDiv.style.padding="0px 0px 0px 5px",this._optionsDiv.style.overflowY="auto",this._generateheader(this._optionsDiv,"OPTIONS"),this._optionsSubsetDiv=document.createElement("div"),this._optionsSubsetDiv.style.paddingTop="5px",this._optionsSubsetDiv.style.paddingBottom="5px",this._optionsSubsetDiv.style.overflowY="auto",this._optionsSubsetDiv.style.maxHeight="200px",this._optionsDiv.appendChild(this._optionsSubsetDiv),this._generateTexBox(this._optionsSubsetDiv,"<b>Windows:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Statistics",this._displayStatistics,function(e){t._displayStatistics=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Logs",this._displayLogs,function(e){t._displayLogs=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Meshes tree",this._displayTree,function(e){t._displayTree=e.checked,t._needToRefreshMeshesTree=!0}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>General:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Bounding boxes",this._scene.forceShowBoundingBoxes,function(e){t._scene.forceShowBoundingBoxes=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Clickable labels",this._labelsEnabled,function(e){t._labelsEnabled=e.checked,t._labelsEnabled||t._clearLabels()}),this._generateCheckBox(this._optionsSubsetDiv,"Generate user marks (F12)",e.Tools.PerformanceLogLevel===e.Tools.PerformanceUserMarkLogLevel,function(t){t.checked?e.Tools.PerformanceLogLevel=e.Tools.PerformanceUserMarkLogLevel:e.Tools.PerformanceLogLevel=e.Tools.PerformanceNoneLogLevel}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Rendering mode:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Solid","renderMode",!this._scene.forceWireframe&&!this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Wireframe","renderMode",this._scene.forceWireframe,function(e){e.checked&&(t._scene.forceWireframe=!0,t._scene.forcePointsCloud=!1)}),this._generateRadio(this._optionsSubsetDiv,"Point","renderMode",this._scene.forcePointsCloud,function(e){e.checked&&(t._scene.forceWireframe=!1,t._scene.forcePointsCloud=!0)}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Texture channels:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Diffuse",e.StandardMaterial.DiffuseTextureEnabled,function(t){e.StandardMaterial.DiffuseTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Ambient",e.StandardMaterial.AmbientTextureEnabled,function(t){e.StandardMaterial.AmbientTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Specular",e.StandardMaterial.SpecularTextureEnabled,function(t){e.StandardMaterial.SpecularTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Emissive",e.StandardMaterial.EmissiveTextureEnabled,function(t){e.StandardMaterial.EmissiveTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Bump",e.StandardMaterial.BumpTextureEnabled,function(t){e.StandardMaterial.BumpTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Opacity",e.StandardMaterial.OpacityTextureEnabled,function(t){e.StandardMaterial.OpacityTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Reflection",e.StandardMaterial.ReflectionTextureEnabled,function(t){e.StandardMaterial.ReflectionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Refraction",e.StandardMaterial.RefractionTextureEnabled,function(t){e.StandardMaterial.RefractionTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lightmap",e.StandardMaterial.LightmapTextureEnabled,function(t){e.StandardMaterial.LightmapTextureEnabled=t.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fresnel",e.StandardMaterial.FresnelEnabled,function(t){e.StandardMaterial.FresnelEnabled=t.checked}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Options:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Animations",this._scene.animationsEnabled,function(e){t._scene.animationsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Collisions",this._scene.collisionsEnabled,function(e){
t._scene.collisionsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Fog",this._scene.fogEnabled,function(e){t._scene.fogEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lens flares",this._scene.lensFlaresEnabled,function(e){t._scene.lensFlaresEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Lights",this._scene.lightsEnabled,function(e){t._scene.lightsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Particles",this._scene.particlesEnabled,function(e){t._scene.particlesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Post-processes",this._scene.postProcessesEnabled,function(e){t._scene.postProcessesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Probes",this._scene.probesEnabled,function(e){t._scene.probesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Procedural textures",this._scene.proceduralTexturesEnabled,function(e){t._scene.proceduralTexturesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Render targets",this._scene.renderTargetsEnabled,function(e){t._scene.renderTargetsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Shadows",this._scene.shadowsEnabled,function(e){t._scene.shadowsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",this._scene.skeletonsEnabled,function(e){t._scene.skeletonsEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Sprites",this._scene.spritesEnabled,function(e){t._scene.spritesEnabled=e.checked}),this._generateCheckBox(this._optionsSubsetDiv,"Textures",this._scene.texturesEnabled,function(e){t._scene.texturesEnabled=e.checked}),e.AudioEngine&&e.Engine.audioEngine.canUseWebAudio&&(this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Audio:</b>",this.accentColor),this._generateRadio(this._optionsSubsetDiv,"Headphones","panningModel",this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!0)}),this._generateRadio(this._optionsSubsetDiv,"Normal Speakers","panningModel",!this._scene.headphone,function(e){e.checked&&(t._scene.headphone=!1)}),this._generateCheckBox(this._optionsSubsetDiv,"Disable audio",!this._scene.audioEnabled,function(e){t._scene.audioEnabled=!e.checked})),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Viewers:</b>",this.accentColor),this._generateCheckBox(this._optionsSubsetDiv,"Skeletons",!1,function(i){if(!i.checked)return void t._clearSkeletonViewers();for(var n=0;n<t._scene.meshes.length;n++){var r=t._scene.meshes[n];if(r.skeleton){for(var o=!1,s=0;s<t._skeletonViewers.length;s++)if(t._skeletonViewers[s].skeleton===r.skeleton){o=!0;break}if(o)continue;var a=new e.Debug.SkeletonViewer(r.skeleton,r,t._scene);a.isEnabled=!0,t._skeletonViewers.push(a)}}}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._generateTexBox(this._optionsSubsetDiv,"<b>Tools:</b>",this.accentColor),this._generateButton(this._optionsSubsetDiv,"Dump rendertargets",function(e){t._scene.dumpNextRenderTargets=!0}),this._generateButton(this._optionsSubsetDiv,"Run SceneOptimizer",function(i){e.SceneOptimizer.OptimizeAsync(t._scene)}),this._generateButton(this._optionsSubsetDiv,"Log camera object",function(e){t._camera?console.log(t._camera):console.warn("No camera defined, or debug layer created before camera creation!")}),this._optionsSubsetDiv.appendChild(document.createElement("br")),this._globalDiv.appendChild(this._statsDiv),this._globalDiv.appendChild(this._logDiv),this._globalDiv.appendChild(this._optionsDiv),this._globalDiv.appendChild(this._treeDiv)}},t.prototype._displayStats=function(){var t=this._scene,i=t.getEngine(),n=i.getGlInfo();this._statsSubsetDiv.innerHTML="Babylon.js v"+e.Engine.Version+" - <b>"+e.Tools.Format(i.getFps(),0)+" fps</b><br><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Count</b><br>Total meshes: "+t.meshes.length+"<br>Total lights: "+t.lights.length+"<br>Total vertices: "+t.getTotalVertices()+"<br>Total materials: "+t.materials.length+"<br>Total textures: "+t.textures.length+"<br>Active meshes: "+t.getActiveMeshes().length+"<br>Active indices: "+t.getActiveIndices()+"<br>Active bones: "+t.getActiveBones()+"<br>Active particles: "+t.getActiveParticles()+"<br><b>Draw calls: "+i.drawCalls+"</b><br><br><b>Duration</b><br>Meshes selection:</i> "+e.Tools.Format(t.getEvaluateActiveMeshesDuration())+" ms<br>Render Targets: "+e.Tools.Format(t.getRenderTargetsDuration())+" ms<br>Particles: "+e.Tools.Format(t.getParticlesDuration())+" ms<br>Sprites: "+e.Tools.Format(t.getSpritesDuration())+" ms<br><br>Render: <b>"+e.Tools.Format(t.getRenderDuration())+" ms</b><br>Frame: "+e.Tools.Format(t.getLastFrameDuration())+" ms<br>Potential FPS: "+e.Tools.Format(1e3/t.getLastFrameDuration(),0)+"<br>Resolution: "+i.getRenderWidth()+"x"+i.getRenderHeight()+"<br><br></div><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Extensions</b><br>Std derivatives: "+(i.getCaps().standardDerivatives?"Yes":"No")+"<br>Compressed textures: "+(i.getCaps().s3tc?"Yes":"No")+"<br>Hardware instances: "+(i.getCaps().instancedArrays?"Yes":"No")+"<br>Texture float: "+(i.getCaps().textureFloat?"Yes":"No")+"<br><br>32bits indices: "+(i.getCaps().uintIndices?"Yes":"No")+"<br>Fragment depth: "+(i.getCaps().fragmentDepthSupported?"Yes":"No")+"<br>High precision shaders: "+(i.getCaps().highPrecisionShaderSupported?"Yes":"No")+"<br>Draw buffers: "+(i.getCaps().drawBuffersExtension?"Yes":"No")+"<br></div><br><div style='column-count: 2;-moz-column-count:2;-webkit-column-count:2'><b>Caps.</b><br>Max textures units: "+i.getCaps().maxTexturesImageUnits+"<br>Max textures size: "+i.getCaps().maxTextureSize+"<br>Max anisotropy: "+i.getCaps().maxAnisotropy+"<br><b>Info</b><br>WebGL feature level: "+i.webGLVersion+"<br>"+n.version+"<br></div><br>"+n.renderer+"<br>",this.customStatsFunction&&(this._statsSubsetDiv.innerHTML+=this.customStatsFunction())},t}();e.DebugLayer=t}(BABYLON||(BABYLON={})),BABYLON.Effect.ShadersStore={anaglyphPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D leftSampler;\nvoid main(void)\n{\nvec4 leftFrag=texture2D(leftSampler,vUV);\nleftFrag=vec4(1.0,leftFrag.g,leftFrag.b,1.0);\nvec4 rightFrag=texture2D(textureSampler,vUV);\nrightFrag=vec4(rightFrag.r,1.0,1.0,1.0);\ngl_FragColor=vec4(rightFrag.rgb*leftFrag.rgb,1.0);\n}",blackAndWhitePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\nfloat luminance=dot(texture2D(textureSampler,vUV).rgb,vec3(0.3,0.59,0.11));\ngl_FragColor=vec4(luminance,luminance,luminance,1.0);\n}",blurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nuniform vec2 direction;\nuniform float blurWidth;\nvoid main(void)\n{\nfloat weights[7];\nweights[0]=0.05;\nweights[1]=0.1;\nweights[2]=0.2;\nweights[3]=0.3;\nweights[4]=0.2;\nweights[5]=0.1;\nweights[6]=0.05;\nvec2 texelSize=vec2(1.0/screenSize.x,1.0/screenSize.y);\nvec2 texelStep=texelSize*direction*blurWidth;\nvec2 start=vUV-3.0*texelStep;\nvec4 baseColor=vec4(0.,0.,0.,0.);\nvec2 texelOffset=vec2(0.,0.);\nfor (int i=0; i<7; i++)\n{\nbaseColor+=texture2D(textureSampler,start+texelOffset)*weights[i];\ntexelOffset+=texelStep;\n}\ngl_FragColor=baseColor;\n}",chromaticAberrationPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float chromatic_aberration;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\nvoid main(void)\n{\nvec2 centered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nfloat radius2=centered_screen_pos.x*centered_screen_pos.x\n+centered_screen_pos.y*centered_screen_pos.y;\nfloat radius=sqrt(radius2);\nvec4 original=texture2D(textureSampler,vUV);\nif (chromatic_aberration>0.0) {\n\nvec3 ref_indices=vec3(-0.3,0.0,0.3);\nfloat ref_shiftX=chromatic_aberration*radius*17.0/screen_width;\nfloat ref_shiftY=chromatic_aberration*radius*17.0/screen_height;\n\nvec2 ref_coords_r=vec2(vUV.x+ref_indices.r*ref_shiftX,vUV.y+ref_indices.r*ref_shiftY*0.5);\nvec2 ref_coords_g=vec2(vUV.x+ref_indices.g*ref_shiftX,vUV.y+ref_indices.g*ref_shiftY*0.5);\nvec2 ref_coords_b=vec2(vUV.x+ref_indices.b*ref_shiftX,vUV.y+ref_indices.b*ref_shiftY*0.5);\noriginal.r=texture2D(textureSampler,ref_coords_r).r;\noriginal.g=texture2D(textureSampler,ref_coords_g).g;\noriginal.b=texture2D(textureSampler,ref_coords_b).b;\n}\ngl_FragColor=original;\n}",colorPixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",colorVertexShader:"\nattribute vec3 position;\n\nuniform mat4 worldViewProjection;\nvoid main(void) {\ngl_Position=worldViewProjection*vec4(position,1.0);\n}",colorCorrectionPixelShader:"\nuniform sampler2D textureSampler; \nuniform sampler2D colorTable; \n\nvarying vec2 vUV;\n\nconst float SLICE_COUNT=16.0; \n\nvec4 sampleAs3DTexture(sampler2D texture,vec3 uv,float width) {\nfloat sliceSize=1.0/width; \nfloat slicePixelSize=sliceSize/width; \nfloat sliceInnerSize=slicePixelSize*(width-1.0); \nfloat zSlice0=min(floor(uv.z*width),width-1.0);\nfloat zSlice1=min(zSlice0+1.0,width-1.0);\nfloat xOffset=slicePixelSize*0.5+uv.x*sliceInnerSize;\nfloat s0=xOffset+(zSlice0*sliceSize);\nfloat s1=xOffset+(zSlice1*sliceSize);\nvec4 slice0Color=texture2D(texture,vec2(s0,uv.y));\nvec4 slice1Color=texture2D(texture,vec2(s1,uv.y));\nfloat zOffset=mod(uv.z*width,1.0);\nvec4 result=mix(slice0Color,slice1Color,zOffset);\nreturn result;\n}\nvoid main(void)\n{\nvec4 screen_color=texture2D(textureSampler,vUV);\ngl_FragColor=sampleAs3DTexture(colorTable,screen_color.rgb,SLICE_COUNT);\n}",convolutionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\nuniform float kernel[9];\nvoid main(void)\n{\nvec2 onePixel=vec2(1.0,1.0)/screenSize;\nvec4 colorSum =\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,-1))*kernel[0] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,-1))*kernel[1] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,-1))*kernel[2] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,0))*kernel[3] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,0))*kernel[4] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,0))*kernel[5] +\ntexture2D(textureSampler,vUV+onePixel*vec2(-1,1))*kernel[6] +\ntexture2D(textureSampler,vUV+onePixel*vec2(0,1))*kernel[7] +\ntexture2D(textureSampler,vUV+onePixel*vec2(1,1))*kernel[8];\nfloat kernelWeight =\nkernel[0] +\nkernel[1] +\nkernel[2] +\nkernel[3] +\nkernel[4] +\nkernel[5] +\nkernel[6] +\nkernel[7] +\nkernel[8];\nif (kernelWeight<=0.0) {\nkernelWeight=1.0;\n}\ngl_FragColor=vec4((colorSum/kernelWeight).rgb,1);\n}",defaultPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n\n#define RECIPROCAL_PI2 0.15915494\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec2 diffuseUV=vDiffuseUV;\n#endif\n#include<bumpFragment>\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,diffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..maxSimultaneousLights]\n\nvec3 refractionColor=vec3(0.,0.,0.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\nrefractionColor=textureCube(refractionCubeSampler,refractionVector).rgb*vRefractionInfos.x;\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords).rgb*vRefractionInfos.x;\n#endif\n#endif\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias).rgb*vReflectionInfos.x;\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+emissiveColor+refractionColor,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor+refractionColor,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor;\n#else\ncolor.rgb+=lightmapColor;\n#endif\n#endif\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n}",defaultVertexShader:"\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#include<pointCloudVertexDeclaration>\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n}",depthPixelShader:"#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nuniform float far;\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\nfloat depth=(gl_FragCoord.z/gl_FragCoord.w)/far;\ngl_FragColor=vec4(depth,depth*depth,0.0,1.0);\n}",depthVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",depthBoxBlurPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec2 screenSize;\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}",depthOfFieldPixelShader:"\n\n\n\n\nuniform sampler2D textureSampler;\nuniform sampler2D highlightsSampler;\nuniform sampler2D depthSampler;\nuniform sampler2D grainSampler;\n\nuniform float grain_amount;\nuniform bool blur_noise;\nuniform float screen_width;\nuniform float screen_height;\nuniform float distortion;\nuniform bool dof_enabled;\n\nuniform float screen_distance; \nuniform float aperture;\nuniform float darken;\nuniform float edge_blur;\nuniform bool highlights;\n\nuniform float near;\nuniform float far;\n\nvarying vec2 vUV;\n\n#define PI 3.14159265\n#define TWOPI 6.28318530\n#define inverse_focal_length 0.1 \n\nvec2 centered_screen_pos;\nvec2 distorted_coords;\nfloat radius2;\nfloat radius;\n\nvec2 rand(vec2 co)\n{\nfloat noise1=(fract(sin(dot(co,vec2(12.9898,78.233)))*43758.5453));\nfloat noise2=(fract(sin(dot(co,vec2(12.9898,78.233)*2.0))*43758.5453));\nreturn clamp(vec2(noise1,noise2),0.0,1.0);\n}\n\nvec2 getDistortedCoords(vec2 coords) {\nif (distortion == 0.0) { return coords; }\nvec2 direction=1.0*normalize(centered_screen_pos);\nvec2 dist_coords=vec2(0.5,0.5);\ndist_coords.x=0.5+direction.x*radius2*1.0;\ndist_coords.y=0.5+direction.y*radius2*1.0;\nfloat dist_amount=clamp(distortion*0.23,0.0,1.0);\ndist_coords=mix(coords,dist_coords,dist_amount);\nreturn dist_coords;\n}\n\nfloat sampleScreen(inout vec4 color,const in vec2 offset,const in float weight) {\n\nvec2 coords=distorted_coords;\nfloat angle=rand(coords*100.0).x*TWOPI;\ncoords+=vec2(offset.x*cos(angle)-offset.y*sin(angle),offset.x*sin(angle)+offset.y*cos(angle));\ncolor+=texture2D(textureSampler,coords)*weight;\nreturn weight;\n}\n\nfloat getBlurLevel(float size) {\nreturn min(3.0,ceil(size/1.0));\n}\n\nvec4 getBlurColor(float size) {\nvec4 col=texture2D(textureSampler,distorted_coords);\nif (size == 0.0) { return col; }\n\n\nfloat blur_level=getBlurLevel(size);\nfloat w=(size/screen_width);\nfloat h=(size/screen_height);\nfloat total_weight=1.0;\nvec2 sample_coords;\ntotal_weight+=sampleScreen(col,vec2(-0.50*w,0.24*h),0.93);\ntotal_weight+=sampleScreen(col,vec2(0.30*w,-0.75*h),0.90);\ntotal_weight+=sampleScreen(col,vec2(0.36*w,0.96*h),0.87);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,-0.55*h),0.85);\ntotal_weight+=sampleScreen(col,vec2(1.33*w,-0.37*h),0.83);\ntotal_weight+=sampleScreen(col,vec2(-0.82*w,1.31*h),0.80);\ntotal_weight+=sampleScreen(col,vec2(-0.31*w,-1.67*h),0.78);\ntotal_weight+=sampleScreen(col,vec2(1.47*w,1.11*h),0.76);\ntotal_weight+=sampleScreen(col,vec2(-1.97*w,0.19*h),0.74);\ntotal_weight+=sampleScreen(col,vec2(1.42*w,-1.57*h),0.72);\nif (blur_level>1.0) {\ntotal_weight+=sampleScreen(col,vec2(0.01*w,2.25*h),0.70);\ntotal_weight+=sampleScreen(col,vec2(-1.62*w,-1.74*h),0.67);\ntotal_weight+=sampleScreen(col,vec2(2.49*w,0.20*h),0.65);\ntotal_weight+=sampleScreen(col,vec2(-2.07*w,1.61*h),0.63);\ntotal_weight+=sampleScreen(col,vec2(0.46*w,-2.70*h),0.61);\ntotal_weight+=sampleScreen(col,vec2(1.55*w,2.40*h),0.59);\ntotal_weight+=sampleScreen(col,vec2(-2.88*w,-0.75*h),0.56);\ntotal_weight+=sampleScreen(col,vec2(2.73*w,-1.44*h),0.54);\ntotal_weight+=sampleScreen(col,vec2(-1.08*w,3.02*h),0.52);\ntotal_weight+=sampleScreen(col,vec2(-1.28*w,-3.05*h),0.49);\n}\nif (blur_level>2.0) {\ntotal_weight+=sampleScreen(col,vec2(3.11*w,1.43*h),0.46);\ntotal_weight+=sampleScreen(col,vec2(-3.36*w,1.08*h),0.44);\ntotal_weight+=sampleScreen(col,vec2(1.80*w,-3.16*h),0.41);\ntotal_weight+=sampleScreen(col,vec2(0.83*w,3.65*h),0.38);\ntotal_weight+=sampleScreen(col,vec2(-3.16*w,-2.19*h),0.34);\ntotal_weight+=sampleScreen(col,vec2(3.92*w,-0.53*h),0.31);\ntotal_weight+=sampleScreen(col,vec2(-2.59*w,3.12*h),0.26);\ntotal_weight+=sampleScreen(col,vec2(-0.20*w,-4.15*h),0.22);\ntotal_weight+=sampleScreen(col,vec2(3.02*w,3.00*h),0.15);\n}\ncol/=total_weight; \n\nif (darken>0.0) {\ncol.rgb*=clamp(0.3,1.0,1.05-size*0.5*darken);\n}\n\n\n\n\nreturn col;\n}\nvoid main(void)\n{\n\ncentered_screen_pos=vec2(vUV.x-0.5,vUV.y-0.5);\nradius2=centered_screen_pos.x*centered_screen_pos.x+centered_screen_pos.y*centered_screen_pos.y;\nradius=sqrt(radius2);\ndistorted_coords=getDistortedCoords(vUV); \nvec2 texels_coords=vec2(vUV.x*screen_width,vUV.y*screen_height); \nfloat depth=texture2D(depthSampler,distorted_coords).r; \nfloat distance=near+(far-near)*depth; \nvec4 color=texture2D(textureSampler,vUV); \n\n\nfloat coc=abs(aperture*(screen_distance*(inverse_focal_length-1.0/distance)-1.0));\n\nif (dof_enabled == false || coc<0.07) { coc=0.0; }\n\nfloat edge_blur_amount=0.0;\nif (edge_blur>0.0) {\nedge_blur_amount=clamp((radius*2.0-1.0+0.15*edge_blur)*1.5,0.0,1.0)*1.3;\n}\n\nfloat blur_amount=max(edge_blur_amount,coc);\n\nif (blur_amount == 0.0) {\ngl_FragColor=texture2D(textureSampler,distorted_coords);\n}\nelse {\n\ngl_FragColor=getBlurColor(blur_amount*1.7);\n\nif (highlights) {\ngl_FragColor.rgb+=clamp(coc,0.0,1.0)*texture2D(highlightsSampler,distorted_coords).rgb;\n}\nif (blur_noise) {\n\nvec2 noise=rand(distorted_coords)*0.01*blur_amount;\nvec2 blurred_coord=vec2(distorted_coords.x+noise.x,distorted_coords.y+noise.y);\ngl_FragColor=0.04*texture2D(textureSampler,blurred_coord)+0.96*gl_FragColor;\n}\n}\n\nif (grain_amount>0.0) {\nvec4 grain_color=texture2D(grainSampler,texels_coords*0.003);\ngl_FragColor.rgb+=(-0.5+grain_color.rgb)*0.30*grain_amount;\n}\n}\n",displayPassPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D passSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(passSampler,vUV);\n}",ellipse2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",ellipse2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat ms=properties.z;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<ms) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=ms;\n}\nfloat angle=TWOPI*segi/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat ms=properties.z;\nfloat angle=TWOPI*(index-1.0)/ms;\npos2.x=(cos(angle)/2.0)+0.5;\npos2.y=(sin(angle)/2.0)+0.5;\n}\n#endif\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",filterPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform mat4 kernelMatrix;\nvoid main(void)\n{\nvec3 baseColor=texture2D(textureSampler,vUV).rgb;\nvec3 updatedColor=(kernelMatrix*vec4(baseColor,1.0)).rgb;\ngl_FragColor=vec4(updatedColor,1.0);\n}",
fxaaPixelShader:"#define FXAA_REDUCE_MIN (1.0/128.0)\n#define FXAA_REDUCE_MUL (1.0/8.0)\n#define FXAA_SPAN_MAX 8.0\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 texelSize;\nvoid main(){\nvec2 localTexelSize=texelSize;\nvec4 rgbNW=texture2D(textureSampler,(vUV+vec2(-1.0,-1.0)*localTexelSize));\nvec4 rgbNE=texture2D(textureSampler,(vUV+vec2(1.0,-1.0)*localTexelSize));\nvec4 rgbSW=texture2D(textureSampler,(vUV+vec2(-1.0,1.0)*localTexelSize));\nvec4 rgbSE=texture2D(textureSampler,(vUV+vec2(1.0,1.0)*localTexelSize));\nvec4 rgbM=texture2D(textureSampler,vUV);\nvec4 luma=vec4(0.299,0.587,0.114,1.0);\nfloat lumaNW=dot(rgbNW,luma);\nfloat lumaNE=dot(rgbNE,luma);\nfloat lumaSW=dot(rgbSW,luma);\nfloat lumaSE=dot(rgbSE,luma);\nfloat lumaM=dot(rgbM,luma);\nfloat lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));\nfloat lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));\nvec2 dir=vec2(-((lumaNW+lumaNE)-(lumaSW+lumaSE)),((lumaNW+lumaSW)-(lumaNE+lumaSE)));\nfloat dirReduce=max(\n(lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),\nFXAA_REDUCE_MIN);\nfloat rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);\ndir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),\nmax(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),\ndir*rcpDirMin))*localTexelSize;\nvec4 rgbA=0.5*(\ntexture2D(textureSampler,vUV+dir*(1.0/3.0-0.5)) +\ntexture2D(textureSampler,vUV+dir*(2.0/3.0-0.5)));\nvec4 rgbB=rgbA*0.5+0.25*(\ntexture2D(textureSampler,vUV+dir*-0.5) +\ntexture2D(textureSampler,vUV+dir*0.5));\nfloat lumaB=dot(rgbB,luma);\nif ((lumaB<lumaMin) || (lumaB>lumaMax)) {\ngl_FragColor=rgbA;\n}\nelse {\ngl_FragColor=rgbB;\n}\n}",hdrPixelShader:"uniform sampler2D textureSampler;\nvarying vec2 vUV;\n#if defined(GAUSSIAN_BLUR_H) || defined(GAUSSIAN_BLUR_V)\nuniform float blurOffsets[9];\nuniform float blurWeights[9];\nuniform float multiplier;\nvoid main(void) {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfor (int i=0; i<9; i++) {\n#ifdef GAUSSIAN_BLUR_H\ncolor+=(texture2D(textureSampler,vUV+vec2(blurOffsets[i]*multiplier,0.0))*blurWeights[i]);\n#else\ncolor+=(texture2D(textureSampler,vUV+vec2(0.0,blurOffsets[i]*multiplier))*blurWeights[i]);\n#endif\n}\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n#if defined(TEXTURE_ADDER)\nuniform sampler2D otherSampler;\nvoid main() {\nvec4 sum=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nsum.a=clamp(sum.a,0.0,1.0);\ngl_FragColor=sum;\n}\n#endif\n#if defined(LUMINANCE_GENERATOR)\nuniform vec2 lumOffsets[4];\nvoid main() {\nfloat average=0.0;\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat maximum=-1e20;\nfor (int i=0; i<4; i++) {\ncolor=texture2D(textureSampler,vUV+lumOffsets[i]);\nfloat GreyValue=length(color.rgb);\nmaximum=max(maximum,GreyValue);\naverage+=(0.25*log(1e-5+GreyValue));\n}\naverage=exp(average);\ngl_FragColor=vec4(average,maximum,0.0,1.0);\n}\n#endif\n#if defined(DOWN_SAMPLE)\nuniform vec2 dsOffsets[9];\nuniform float halfDestPixelSize;\n#ifdef FINAL_DOWN_SAMPLE\nvec4 pack(float value) {\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(value*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n#endif\nvoid main() {\nvec4 color=vec4(0.0,0.0,0.0,0.0);\nfloat average=0.0;\nfor (int i=0; i<9; i++) {\ncolor=texture2D(textureSampler,vUV+vec2(halfDestPixelSize,halfDestPixelSize)+dsOffsets[i]);\naverage+=color.r;\n}\naverage/=9.0;\n#ifndef FINAL_DOWN_SAMPLE\ngl_FragColor=vec4(average,average,0.0,1.0);\n#else\ngl_FragColor=pack(average);\n#endif\n}\n#endif\n#if defined(BRIGHT_PASS)\nuniform vec2 dsOffsets[4];\nuniform float brightThreshold;\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+vec2(dsOffsets[0].x,dsOffsets[0].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[1].x,dsOffsets[1].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[2].x,dsOffsets[2].y));\naverage+=texture2D(textureSampler,vUV+vec2(dsOffsets[3].x,dsOffsets[3].y));\naverage*=0.25;\nfloat luminance=length(average.rgb);\nif (luminance<brightThreshold) {\naverage=vec4(0.0,0.0,0.0,1.0);\n}\ngl_FragColor=average;\n}\n#endif\n#if defined(DOWN_SAMPLE_X4)\nuniform vec2 dsOffsets[16];\nvoid main() {\nvec4 average=vec4(0.0,0.0,0.0,0.0);\naverage=texture2D(textureSampler,vUV+dsOffsets[0]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[1]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[2]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[3]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[4]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[5]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[6]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[7]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[8]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[9]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[10]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[11]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[12]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[13]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[14]);\naverage+=texture2D(textureSampler,vUV+dsOffsets[15]);\naverage/=16.0;\ngl_FragColor=average;\n}\n#endif\n#if defined(HDR)\nuniform sampler2D otherSampler;\nuniform float exposure;\nuniform float avgLuminance;\nvoid main() {\nvec4 color=texture2D(textureSampler,vUV)+texture2D(otherSampler,vUV);\nvec4 adjustedColor=color/avgLuminance*exposure;\ncolor=adjustedColor;\ncolor.a=1.0;\ngl_FragColor=color;\n}\n#endif\n",layerPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=baseColor*color;\n}",layerVertexShader:"\nattribute vec2 position;\n\nuniform vec2 scale;\nuniform vec2 offset;\nuniform mat4 textureMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvec2 shiftedPosition=position*scale+offset;\nvUV=vec2(textureMatrix*vec4(shiftedPosition*madd+madd,1.0,0.0));\ngl_Position=vec4(shiftedPosition,0.0,1.0);\n}",legacydefaultPixelShader:"#define MAP_PROJECTION 4.\n\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef REFLECTION\nvarying vec3 vReflectionUVW;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\nuniform vec2 vReflectionInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform sampler2D specularSampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 normalW=normalize(vNormalW);\n\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\nglossiness=vSpecularColor.a;\n#endif\nfloat shadow=1.;\n#include<lightFragment>[0..3]\n\nvec3 reflectionColor=vec3(0.,0.,0.);\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW).rgb*vReflectionInfos.x;\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords).rgb*vReflectionInfos.x;\n#endif\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\nreflectionColor*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n\nfloat alpha=vDiffuseColor.a;\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef SPECULARTERM\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nspecularColor=texture2D(specularSampler,vSpecularUV).rgb*vSpecularInfos.y;\n#endif\n#endif\n\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n}",legacydefaultVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nvarying vec2 vSpecularUV;\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec2 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTION\nuniform vec3 vEyePosition;\nvarying vec3 vReflectionUVW;\nuniform mat4 reflectionMatrix;\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 coords=vec3(view*vec4(worldNormal,0.0));\nreturn vec3(reflectionMatrix*vec4(coords,1.0));\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn position;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef REFLECTION\nvReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),vNormalW);\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",legacypbrPixelShader:"precision mediump float;\n\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec4 vAlbedoColor;\nuniform vec3 vReflectionColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#ifdef CAMERACOLORGRADING\nuniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;\n#endif\n\n#include<pbrFunctions>\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution= vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance,alpha);\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor,cameraColorGrading2DSampler,vCameraColorGradingInfos,vCameraColorGradingScaleOffset);\n#endif\ngl_FragColor=finalColor;\n}",legacypbrVertexShader:"precision mediump float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vNormalW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\nvoid main(void) {\nmat4 finalWorld=world;\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<clipPlaneVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n}",lensFlarePixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform vec4 color;\nvoid main(void) {\nvec4 baseColor=texture2D(textureSampler,vUV);\ngl_FragColor=baseColor*color;\n}",lensFlareVertexShader:"\nattribute vec2 position;\n\nuniform mat4 viewportMatrix;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=position*madd+madd;\ngl_Position=viewportMatrix*vec4(position,0.0,1.0);\n}",lensHighlightsPixelShader:"\nuniform sampler2D textureSampler; \n\nuniform float gain;\nuniform float threshold;\nuniform float screen_width;\nuniform float screen_height;\n\nvarying vec2 vUV;\n\nvec4 highlightColor(vec4 color) {\nvec4 highlight=color;\nfloat luminance=dot(highlight.rgb,vec3(0.2125,0.7154,0.0721));\nfloat lum_threshold;\nif (threshold>1.0) { lum_threshold=0.94+0.01*threshold; }\nelse { lum_threshold=0.5+0.44*threshold; }\nluminance=clamp((luminance-lum_threshold)*(1.0/(1.0-lum_threshold)),0.0,1.0);\nhighlight*=luminance*gain;\nhighlight.a=1.0;\nreturn highlight;\n}\nvoid main(void)\n{\nvec4 original=texture2D(textureSampler,vUV);\n\nif (gain == -1.0) {\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nreturn;\n}\nfloat w=2.0/screen_width;\nfloat h=2.0/screen_height;\nfloat weight=1.0;\n\nvec4 blurred=vec4(0.0,0.0,0.0,0.0);\n#ifdef PENTAGON\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.84*w,0.43*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.48*w,-1.29*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.61*w,1.51*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.55*w,-0.74*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.71*w,-0.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.94*w,1.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.40*w,-1.87*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.62*w,1.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.09*w,0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.46*w,-1.71*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.08*w,2.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.85*w,-1.89*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.89*w,0.16*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.29*w,1.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.40*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.54*w,2.26*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.60*w,-0.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.31*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.83*w,2.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.12*w,-2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.60*w,1.11*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.99*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.50*w,-2.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.85*w,3.33*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.94*w,-1.92*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.27*w,-0.53*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.95*w,2.48*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.23*w,-3.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.17*w,2.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.97*w,-0.04*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.25*w,-2.00*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.31*w,3.08*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.94*w,-2.59*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.37*w,0.64*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.13*w,1.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.03*w,-3.65*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.60*w,3.17*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.14*w,-1.19*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.00*w,-1.19*h)));\n#else\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.85*w,0.36*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.52*w,-1.14*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.46*w,1.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.46*w,-0.83*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.79*w,-0.42*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.11*w,1.62*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.29*w,-2.07*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.69*w,1.39*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.28*w,0.12*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.65*w,-1.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.08*w,2.44*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.63*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.55*w,0.31*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.13*w,1.52*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.56*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.38*w,2.34*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.64*w,-0.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.53*w,-1.21*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.06*w,2.63*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.00*w,-2.69*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.59*w,1.32*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.82*w,0.78*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.57*w,-2.50*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(0.54*w,2.93*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.39*w,-1.81*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,-0.28*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.04*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.02*w,-3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.09*w,2.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-3.07*w,-0.25*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.44*w,-1.90*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-0.52*w,3.05*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-1.68*w,-2.61*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(3.01*w,0.79*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.76*w,1.46*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.05*w,-2.94*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(1.21*w,2.88*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(-2.84*w,-1.30*h)));\nblurred+=highlightColor(texture2D(textureSampler,vUV+vec2(2.98*w,-0.96*h)));\n#endif\nblurred/=39.0;\ngl_FragColor=blurred;\n\n}",
linePixelShader:"uniform vec4 color;\nvoid main(void) {\ngl_FragColor=color;\n}",lineVertexShader:"\nattribute vec3 position;\nattribute vec4 normal;\n\nuniform mat4 worldViewProjection;\nuniform float width;\nuniform float aspectRatio;\nvoid main(void) {\nvec4 viewPosition=worldViewProjection*vec4(position,1.0);\nvec4 viewPositionNext=worldViewProjection*vec4(normal.xyz,1.0);\nvec2 currentScreen=viewPosition.xy/viewPosition.w;\nvec2 nextScreen=viewPositionNext.xy/viewPositionNext.w;\ncurrentScreen.x*=aspectRatio;\nnextScreen.x*=aspectRatio;\nvec2 dir=normalize(nextScreen-currentScreen);\nvec2 normalDir=vec2(-dir.y,dir.x);\nnormalDir*=width/2.0;\nnormalDir.x/=aspectRatio;\nvec4 offset=vec4(normalDir*normal.w,0.0,0.0);\ngl_Position=viewPosition+offset;\n}",lines2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",lines2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute vec2 position;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec2 boundingMin;\natt vec2 boundingMax;\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4((position.xy-boundingMin)/(boundingMax-boundingMin),1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=position.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",outlinePixelShader:"uniform vec4 color;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void) {\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\ngl_FragColor=color;\n}",outlineVertexShader:"\nattribute vec3 position;\nattribute vec3 normal;\n#include<bonesDeclaration>\n\nuniform float offset;\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\nvec3 offsetPosition=position+normal*offset;\n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(offsetPosition,1.0);\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n",particlesPixelShader:"\nvarying vec2 vUV;\nvarying vec4 vColor;\nuniform vec4 textureMask;\nuniform sampler2D diffuseSampler;\n#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\nvoid main(void) {\n#ifdef CLIPPLANE\nif (fClipDistance>0.0)\ndiscard;\n#endif\nvec4 baseColor=texture2D(diffuseSampler,vUV);\ngl_FragColor=(baseColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n}",particlesVertexShader:"\nattribute vec3 position;\nattribute vec4 color;\nattribute vec4 options;\n\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nuniform mat4 invView;\nvarying float fClipDistance;\n#endif\nvoid main(void) { \nvec3 viewPos=(view*vec4(position,1.0)).xyz; \nvec3 cornerPos;\nfloat size=options.y;\nfloat angle=options.x;\nvec2 offset=options.zw;\ncornerPos=vec3(offset.x-0.5,offset.y-0.5,0.)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \nvColor=color;\nvUV=offset;\n\n#ifdef CLIPPLANE\nvec4 worldPos=invView*vec4(viewPos,1.0);\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n}",passPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}",pbrPixelShader:"#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\nuniform vec3 vEyePosition;\nuniform vec3 vAmbientColor;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\n\nuniform vec4 vLightingIntensity;\nuniform vec4 vCameraInfos;\n#ifdef OVERLOADEDVALUES\nuniform vec4 vOverloadedIntensity;\nuniform vec3 vOverloadedAmbient;\nuniform vec3 vOverloadedAlbedo;\nuniform vec3 vOverloadedReflectivity;\nuniform vec3 vOverloadedEmissive;\nuniform vec3 vOverloadedReflection;\nuniform vec3 vOverloadedMicroSurface;\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nuniform vec4 vOverloadedShadowIntensity;\n#endif\n#if defined(REFLECTION) || defined(REFRACTION)\nuniform vec2 vMicrosurfaceTextureLods;\n#endif\nuniform vec4 vReflectivityColor;\nuniform vec3 vEmissiveColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<lightFragmentDeclaration>[0..maxSimultaneousLights]\n\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform sampler2D albedoSampler;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform sampler2D ambientSampler;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform sampler2D emissiveSampler;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform sampler2D lightmapSampler;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform sampler2D reflectivitySampler;\n#endif\n\n#include<fresnelFunction>\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)\nuniform mat4 view;\n#endif\n\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\nuniform mat4 refractionMatrix;\n#endif\n#endif\n\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION)\nuniform mat4 reflectionMatrix;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#ifdef CAMERACOLORGRADING\n#include<colorGradingDefinition>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurvesDefinition>\n#endif\n\n#include<pbrShadowFunctions>\n#include<pbrFunctions>\n#ifdef CAMERACOLORGRADING\n#include<colorGrading>\n#endif\n#ifdef CAMERACOLORCURVES\n#include<colorCurves>\n#endif\n#include<harmonicsFunctions>\n#include<pbrLightFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\n\nvec4 surfaceAlbedo=vec4(1.,1.,1.,1.);\nvec3 surfaceAlbedoContribution=vAlbedoColor.rgb;\n\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\nsurfaceAlbedo=texture2D(albedoSampler,vAlbedoUV);\nsurfaceAlbedo=vec4(toLinearSpace(surfaceAlbedo.rgb),surfaceAlbedo.a);\n#ifndef LINKREFRACTIONTOTRANSPARENCY\n#ifdef ALPHATEST\nif (surfaceAlbedo.a<0.4)\ndiscard;\n#endif\n#endif\n#ifdef ALPHAFROMALBEDO\nalpha*=surfaceAlbedo.a;\n#endif\nsurfaceAlbedo.rgb*=vAlbedoInfos.y;\n#else\n\nsurfaceAlbedo.rgb=surfaceAlbedoContribution;\nsurfaceAlbedoContribution=vec3(1.,1.,1.);\n#endif\n#ifdef VERTEXCOLOR\nsurfaceAlbedo.rgb*=vColor.rgb;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceAlbedo.rgb=mix(surfaceAlbedo.rgb,vOverloadedAlbedo,vOverloadedIntensity.y);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#include<bumpFragment>\n\nvec3 ambientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nambientColor=texture2D(ambientSampler,vAmbientUV).rgb*vAmbientInfos.y;\n#ifdef OVERLOADEDVALUES\nambientColor.rgb=mix(ambientColor.rgb,vOverloadedAmbient,vOverloadedIntensity.x);\n#endif\n#endif\n\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor.rgb=mix(surfaceReflectivityColor.rgb,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef REFLECTIVITY\nvec4 surfaceReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV);\nsurfaceReflectivityColor=surfaceReflectivityColorMap.rgb;\nsurfaceReflectivityColor=toLinearSpace(surfaceReflectivityColor);\n#ifdef OVERLOADEDVALUES\nsurfaceReflectivityColor=mix(surfaceReflectivityColor,vOverloadedReflectivity,vOverloadedIntensity.z);\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface=surfaceReflectivityColorMap.a;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nmicroSurface=mix(microSurface,vOverloadedMicroSurface.x,vOverloadedMicroSurface.y);\n#endif\n\nfloat NdotV=max(0.00000000001,dot(normalW,viewDirectionW));\n\nmicroSurface=clamp(microSurface,0.,1.)*0.98;\n\nfloat roughness=clamp(1.-microSurface,0.000001,1.0);\n\nvec3 lightDiffuseContribution=vec3(0.,0.,0.);\n#ifdef OVERLOADEDSHADOWVALUES\nvec3 shadowedOnlyLightDiffuseContribution=vec3(1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nvec3 lightSpecularContribution=vec3(0.,0.,0.);\n#endif\nfloat notShadowLevel=1.; \nfloat NdotL=-1.;\nlightingInfo info;\n\nfloat reflectance=max(max(surfaceReflectivityColor.r,surfaceReflectivityColor.g),surfaceReflectivityColor.b);\n\n\nfloat reflectance90=clamp(reflectance*25.0,0.0,1.0);\nvec3 specularEnvironmentR0=surfaceReflectivityColor.rgb;\nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;\n#include<pbrLightFunctionsCall>[0..maxSimultaneousLights]\n#ifdef SPECULARTERM\nlightSpecularContribution*=vLightingIntensity.w;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n\nvec3 surfaceRefractionColor=vec3(0.,0.,0.);\n\n#ifdef LODBASEDMICROSFURACE\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\n#endif\n#ifdef REFRACTION\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\nfloat lodRefraction=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.y,alphaG);\n#else\nfloat lodRefraction=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.y,alphaG);\n#endif\n#else\nfloat biasRefraction=(vMicrosurfaceTextureLods.y+2.)*(1.0-microSurface);\n#endif\n#ifdef REFRACTIONMAP_3D\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0)\n{\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFRACTION\n\nif ((vMicrosurfaceTextureLods.y-lodRefraction)>4.0)\n{\n\nfloat scaleRefraction=1.-exp2(lodRefraction)/exp2(vMicrosurfaceTextureLods.y); \nfloat maxRefraction=max(max(abs(refractionVector.x),abs(refractionVector.y)),abs(refractionVector.z));\nif (abs(refractionVector.x) != maxRefraction) refractionVector.x*=scaleRefraction;\nif (abs(refractionVector.y) != maxRefraction) refractionVector.y*=scaleRefraction;\nif (abs(refractionVector.z) != maxRefraction) refractionVector.z*=scaleRefraction;\n}\n#endif\nsurfaceRefractionColor=textureCubeLodEXT(refractionCubeSampler,refractionVector,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=textureCube(refractionCubeSampler,refractionVector,biasRefraction).rgb*vRefractionInfos.x;\n#endif\n}\n#ifndef REFRACTIONMAPINLINEARSPACE\nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#ifdef LODBASEDMICROSFURACE\nsurfaceRefractionColor=texture2DLodEXT(refraction2DSampler,refractionCoords,lodRefraction).rgb*vRefractionInfos.x;\n#else\nsurfaceRefractionColor=texture2D(refraction2DSampler,refractionCoords,biasRefraction).rgb*vRefractionInfos.x;\n#endif \nsurfaceRefractionColor=toLinearSpace(surfaceRefractionColor.rgb);\n#endif\n#endif\n\nvec3 environmentRadiance=vReflectionColor.rgb;\nvec3 environmentIrradiance=vReflectionColor.rgb;\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\nfloat lodReflection=getMipMapIndexFromAverageSlopeWithPMREM(vMicrosurfaceTextureLods.x,alphaG);\n#else\nfloat lodReflection=getMipMapIndexFromAverageSlope(vMicrosurfaceTextureLods.x,alphaG);\n#endif\n#else\nfloat biasReflection=(vMicrosurfaceTextureLods.x+2.)*(1.0-microSurface);\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef LODBASEDMICROSFURACE\n#ifdef USEPMREMREFLECTION\n\nif ((vMicrosurfaceTextureLods.y-lodReflection)>4.0)\n{\n\nfloat scaleReflection=1.-exp2(lodReflection)/exp2(vMicrosurfaceTextureLods.x); \nfloat maxReflection=max(max(abs(vReflectionUVW.x),abs(vReflectionUVW.y)),abs(vReflectionUVW.z));\nif (abs(vReflectionUVW.x) != maxReflection) vReflectionUVW.x*=scaleReflection;\nif (abs(vReflectionUVW.y) != maxReflection) vReflectionUVW.y*=scaleReflection;\nif (abs(vReflectionUVW.z) != maxReflection) vReflectionUVW.z*=scaleReflection;\n}\n#endif\nenvironmentRadiance=textureCubeLodEXT(reflectionCubeSampler,vReflectionUVW,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=textureCube(reflectionCubeSampler,vReflectionUVW,biasReflection).rgb*vReflectionInfos.x;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifndef REFLECTIONMAP_SKYBOX\nvec3 normalEnvironmentSpace=(reflectionMatrix*vec4(normalW,1)).xyz;\nenvironmentIrradiance=EnvironmentIrradiance(normalEnvironmentSpace);\n#endif\n#else\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=textureCube(reflectionCubeSampler,normalW,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\nenvironmentIrradiance*=0.2; \n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\n#ifdef LODBASEDMICROSFURACE\nenvironmentRadiance=texture2DLodEXT(reflection2DSampler,coords,lodReflection).rgb*vReflectionInfos.x;\n#else\nenvironmentRadiance=texture2D(reflection2DSampler,coords,biasReflection).rgb*vReflectionInfos.x;\n#endif\nenvironmentRadiance=toLinearSpace(environmentRadiance.rgb);\nenvironmentIrradiance=texture2D(reflection2DSampler,coords,20.).rgb*vReflectionInfos.x;\nenvironmentIrradiance=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\n#ifdef OVERLOADEDVALUES\nenvironmentIrradiance=mix(environmentIrradiance,vOverloadedReflection,vOverloadedMicroSurface.z);\nenvironmentRadiance=mix(environmentRadiance,vOverloadedReflection,vOverloadedMicroSurface.z);\n#endif\nenvironmentRadiance*=vLightingIntensity.z;\nenvironmentIrradiance*=vLightingIntensity.z;\n\nvec3 specularEnvironmentReflectance=FresnelSchlickEnvironmentGGX(clamp(NdotV,0.,1.),specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n\nvec3 refractance=vec3(0.0,0.0,0.0);\n#ifdef REFRACTION\nvec3 transmission=vec3(1.0,1.0,1.0);\n#ifdef LINKREFRACTIONTOTRANSPARENCY\n\ntransmission*=(1.0-alpha);\n\n\nvec3 mixedAlbedo=surfaceAlbedoContribution.rgb*surfaceAlbedo.rgb;\nfloat maxChannel=max(max(mixedAlbedo.r,mixedAlbedo.g),mixedAlbedo.b);\nvec3 tint=clamp(maxChannel*mixedAlbedo,0.0,1.0);\n\nsurfaceAlbedoContribution*=alpha;\n\nenvironmentIrradiance*=alpha;\n\nsurfaceRefractionColor*=tint;\n\nalpha=1.0;\n#endif\n\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\nspecularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,alpha);\n\ntransmission*=1.0-specularEnvironmentReflectance;\n\nrefractance=surfaceRefractionColor*transmission;\n#endif\n\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\nrefractance*=vLightingIntensity.z;\nenvironmentRadiance*=specularEnvironmentReflectance;\n\nvec3 surfaceEmissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV).rgb;\nsurfaceEmissiveColor=toLinearSpace(emissiveColorTex.rgb)*surfaceEmissiveColor*vEmissiveInfos.y;\n#endif\n#ifdef OVERLOADEDVALUES\nsurfaceEmissiveColor=mix(surfaceEmissiveColor,vOverloadedEmissive,vOverloadedIntensity.w);\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nsurfaceEmissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\n#ifdef LINKEMISSIVEWITHALBEDO\nvec3 finalDiffuse=max((lightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max((shadowedOnlyLightDiffuseContribution+surfaceEmissiveColor)*surfaceAlbedoContribution+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#else\nvec3 finalDiffuse=max(lightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#ifdef OVERLOADEDSHADOWVALUES\nshadowedOnlyLightDiffuseContribution=max(shadowedOnlyLightDiffuseContribution*surfaceAlbedoContribution+surfaceEmissiveColor+vAmbientColor,0.0)*surfaceAlbedo.rgb;\n#endif\n#endif\n#endif\n#ifdef OVERLOADEDSHADOWVALUES\nfinalDiffuse=mix(finalDiffuse,shadowedOnlyLightDiffuseContribution,(1.0-vOverloadedShadowIntensity.y));\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=lightSpecularContribution*surfaceReflectivityColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+getLuminance(finalSpecular),0.,1.);\n#endif\n#ifdef RADIANCEOVERALPHA\nalpha=clamp(alpha+getLuminance(environmentRadiance),0.,1.);\n#endif\n\n\n#ifdef EMISSIVEASILLUMINATION\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+surfaceEmissiveColor*vLightingIntensity.y+refractance,alpha);\n#else\nvec4 finalColor=vec4(finalDiffuse*ambientColor*vLightingIntensity.x+surfaceAlbedo.rgb*environmentIrradiance+finalSpecular*vLightingIntensity.x+environmentRadiance+refractance,alpha);\n#endif\n#ifdef LIGHTMAP\nvec3 lightmapColor=texture2D(lightmapSampler,vLightmapUV).rgb*vLightmapInfos.y;\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor;\n#else\nfinalColor.rgb+=lightmapColor;\n#endif\n#endif\nfinalColor=max(finalColor,0.0);\n#ifdef CAMERATONEMAP\nfinalColor.rgb=toneMaps(finalColor.rgb);\n#endif\nfinalColor.rgb=toGammaSpace(finalColor.rgb);\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#ifdef CAMERACONTRAST\nfinalColor=contrasts(finalColor);\n#endif\nfinalColor.rgb=clamp(finalColor.rgb,0.,1.);\n#ifdef CAMERACOLORGRADING\nfinalColor=colorGrades(finalColor);\n#endif\n#ifdef CAMERACOLORCURVES\nfinalColor.rgb=applyColorCurves(finalColor.rgb);\n#endif\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngl_FragColor=finalColor;\n}",pbrVertexShader:"precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nvarying vec2 vAlbedoUV;\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nvarying vec2 vAmbientUV;\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nvarying vec2 vEmissiveUV;\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nvarying vec2 vLightmapUV;\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(REFLECTIVITY)\nvarying vec2 vReflectivityUV;\nuniform vec2 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<shadowsVertexDeclaration>[0..maxSimultaneousLights]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\nvoid main(void) {\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=position;\n#endif \n#include<instancesVertex>\n#include<bonesVertex>\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvDirectionW=normalize(vec3(finalWorld*vec4(position,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef ALBEDO\nif (vAlbedoInfos.x == 0.)\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAlbedoUV=vec2(albedoMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef AMBIENT\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef OPACITY\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef EMISSIVE\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef LIGHTMAP\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(REFLECTIVITY)\nif (vReflectivityInfos.x == 0.)\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvReflectivityUV=vec2(reflectivityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef BUMP\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n\n#include<logDepthVertex>\n}",postprocessVertexShader:"\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}",proceduralVertexShader:"\nattribute vec2 position;\n\nvarying vec2 vPosition;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) { \nvPosition=position;\nvUV=position*madd+madd;\ngl_Position=vec4(position,0.0,1.0);\n}",rect2dPixelShader:"varying vec4 vColor;\nvoid main(void) {\ngl_FragColor=vColor;\n}",rect2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n#ifdef Border\natt float borderThickness;\n#endif\n#ifdef FillSolid\natt vec4 fillSolidColor;\n#endif\n#ifdef BorderSolid\natt vec4 borderSolidColor;\n#endif\n#ifdef FillGradient\natt vec4 fillGradientColor1;\natt vec4 fillGradientColor2;\natt vec4 fillGradientTY;\n#endif\n#ifdef BorderGradient\natt vec4 borderGradientColor1;\natt vec4 borderGradientColor2;\natt vec4 borderGradientTY;\n#endif\n\natt vec3 properties;\n\n#define rsub0 17.0\n#define rsub1 33.0\n#define rsub2 49.0\n#define rsub3 65.0\n#define rsub 64.0\n#define TWOPI 6.28318530\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (properties.z == 0.0) {\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<4.0) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=4.0;\n}\nif (segi == 0.0) {\npos2=vec2(1.0,1.0);\n} \nelse if (segi == 1.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (segi == 2.0) {\npos2=vec2(0.0,0.0);\n} \nelse {\npos2=vec2(0.0,1.0);\n}\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse if (index == 1.0) {\npos2=vec2(1.0,1.0);\n}\nelse if (index == 2.0) {\npos2=vec2(1.0,0.0);\n}\nelse if (index == 3.0) {\npos2=vec2(0.0,0.0);\n}\nelse {\npos2=vec2(0.0,1.0);\n}\n#endif\n}\nelse\n{\n#ifdef Border\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\nvec2 borderOffset=vec2(1.0,1.0);\nfloat segi=index;\nif (index<rsub) {\nborderOffset=vec2(1.0-(borderThickness*2.0/w),1.0-(borderThickness*2.0/h));\n}\nelse {\nsegi-=rsub;\n}\n\nif (segi<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (segi<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (segi<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\npos2.x=((pos2.x-0.5)*borderOffset.x)+0.5;\npos2.y=((pos2.y-0.5)*borderOffset.y)+0.5;\n#else\nif (index == 0.0) {\npos2=vec2(0.5,0.5);\n}\nelse {\nfloat w=properties.x;\nfloat h=properties.y;\nfloat r=properties.z;\nfloat nru=r/w;\nfloat nrv=r/h;\n\nif (index<rsub0) {\npos2=vec2(1.0-nru,nrv);\n}\n\nelse if (index<rsub1) {\npos2=vec2(nru,nrv);\n}\n\nelse if (index<rsub2) {\npos2=vec2(nru,1.0-nrv);\n}\n\nelse {\npos2=vec2(1.0-nru,1.0-nrv);\n}\nfloat angle=TWOPI-((index-1.0)*TWOPI/(rsub-0.5));\npos2.x+=cos(angle)*nru;\npos2.y+=sin(angle)*nrv;\n}\n#endif\n}\n#ifdef FillSolid\nvColor=fillSolidColor;\n#endif\n#ifdef BorderSolid\nvColor=borderSolidColor;\n#endif\n#ifdef FillGradient\nfloat v=dot(vec4(pos2.xy,1,1),fillGradientTY);\nvColor=mix(fillGradientColor2,fillGradientColor1,v); \n#endif\n#ifdef BorderGradient\nfloat v=dot(vec4(pos2.xy,1,1),borderGradientTY);\nvColor=mix(borderGradientColor2,borderGradientColor1,v); \n#endif\nvec4 pos;\npos.xy=pos2.xy*properties.xy;\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",refractionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform sampler2D refractionSampler;\n\nuniform vec3 baseColor;\nuniform float depth;\nuniform float colorLevel;\nvoid main() {\nfloat ref=1.0-texture2D(refractionSampler,vUV).r;\nvec2 uv=vUV-vec2(0.5);\nvec2 offset=uv*depth*ref;\nvec3 sourceColor=texture2D(textureSampler,vUV-offset).rgb;\ngl_FragColor=vec4(sourceColor+sourceColor*ref*colorLevel,1.0);\n}",shadowMapPixelShader:"vec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\n\nvec2 packHalf(float depth) \n{ \nconst vec2 bitOffset=vec2(1.0/255.,0.);\nvec2 color=vec2(depth,fract(depth*255.));\nreturn color-(color.yy*bitOffset);\n}\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#ifdef CUBEMAP\nuniform vec3 lightPosition;\nuniform vec2 depthValues;\n#endif\nvoid main(void)\n{\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef CUBEMAP\nvec3 directionToLight=vPosition.xyz-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\n#else\nfloat depth=vPosition.z/vPosition.w;\ndepth=depth*0.5+0.5;\n#endif\n#ifdef VSM\nfloat moment1=depth;\nfloat moment2=moment1*moment1;\ngl_FragColor=vec4(packHalf(moment1),packHalf(moment2));\n#else\ngl_FragColor=pack(depth);\n#endif\n}",shadowMapVertexShader:"\nattribute vec3 position;\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nvarying vec4 vPosition;\n#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef CUBEMAP\nvPosition=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\n#else\nvPosition=viewProjection*finalWorld*vec4(position,1.0);\ngl_Position=vPosition;\n#endif\n#ifdef ALPHATEST\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}",sprite2dPixelShader:"varying vec2 vUV;\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a == 0.05) {\ndiscard;\n}\ngl_FragColor=color;\n}",sprite2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\n\natt vec3 properties;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\n\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nvec2 off=vec2(0.0,0.0);\nfloat frame=properties.x;\nfloat invertY=properties.y;\nfloat alignToPixel=properties.z;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,topLeftUV.y-off.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x+(frame*sizeUV.x)+off.x,(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 2.0) {\npos2=vec2( 1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),(topLeftUV.y+sizeUV.y));\n}\n\nelse if (index == 3.0) {\npos2=vec2( 1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x+(frame*sizeUV.x),topLeftUV.y-off.y);\n}\nif (invertY == 1.0) {\nvUV.y=1.0-vUV.y;\n}\nvec4 pos;\nif (alignToPixel == 1.0)\n{\npos.xy=floor(pos2.xy*sizeUV*textureSize);\n} else {\npos.xy=pos2.xy*sizeUV*textureSize;\n}\npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n} ",
spritesPixelShader:"uniform bool alphaTest;\nvarying vec4 vColor;\n\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (alphaTest) \n{\nif (color.a<0.95)\ndiscard;\n}\ncolor*=vColor;\n#include<fogFragment>\ngl_FragColor=color;\n}",spritesVertexShader:"\nattribute vec4 position;\nattribute vec4 options;\nattribute vec4 cellInfo;\nattribute vec4 color;\n\nuniform vec2 textureInfos;\nuniform mat4 view;\nuniform mat4 projection;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n#include<fogVertexDeclaration>\nvoid main(void) { \nvec3 viewPos=(view*vec4(position.xyz,1.0)).xyz; \nvec2 cornerPos;\nfloat angle=position.w;\nvec2 size=vec2(options.x,options.y);\nvec2 offset=options.zw;\nvec2 uvScale=textureInfos.xy;\ncornerPos=vec2(offset.x-0.5,offset.y-0.5)*size;\n\nvec3 rotatedCorner;\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);\nrotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);\nrotatedCorner.z=0.;\n\nviewPos+=rotatedCorner;\ngl_Position=projection*vec4(viewPos,1.0); \n\nvColor=color;\n\nvec2 uvOffset=vec2(abs(offset.x-cellInfo.x),1.0-abs(offset.y-cellInfo.y));\nvUV=(uvOffset+cellInfo.zw)*uvScale;\n\n#ifdef FOG\nfFogDistance=viewPos.z;\n#endif\n}",ssaoPixelShader:"\nuniform sampler2D textureSampler;\nvarying vec2 vUV;\n#ifdef SSAO\nuniform sampler2D randomSampler;\nuniform float randTextureTiles;\nuniform float samplesFactor;\nuniform vec3 sampleSphere[SAMPLES];\nuniform float totalStrength;\nuniform float radius;\nuniform float area;\nuniform float fallOff;\nuniform float base;\nvec3 normalFromDepth(float depth,vec2 coords)\n{\nvec2 offset1=vec2(0.0,radius);\nvec2 offset2=vec2(radius,0.0);\nfloat depth1=texture2D(textureSampler,coords+offset1).r;\nfloat depth2=texture2D(textureSampler,coords+offset2).r;\nvec3 p1=vec3(offset1,depth1-depth);\nvec3 p2=vec3(offset2,depth2-depth);\nvec3 normal=cross(p1,p2);\nnormal.z=-normal.z;\nreturn normalize(normal);\n}\nvoid main()\n{\nvec3 random=normalize(texture2D(randomSampler,vUV*randTextureTiles).rgb);\nfloat depth=texture2D(textureSampler,vUV).r;\nvec3 position=vec3(vUV,depth);\nvec3 normal=normalFromDepth(depth,vUV);\nfloat radiusDepth=radius/depth;\nfloat occlusion=0.0;\nvec3 ray;\nvec3 hemiRay;\nfloat occlusionDepth;\nfloat difference;\nfor (int i=0; i<SAMPLES; i++)\n{\nray=radiusDepth*reflect(sampleSphere[i],random);\nhemiRay=position+sign(dot(ray,normal))*ray;\nocclusionDepth=texture2D(textureSampler,clamp(hemiRay.xy,vec2(0.001,0.001),vec2(0.999,0.999))).r;\ndifference=depth-occlusionDepth;\nocclusion+=step(fallOff,difference)*(1.0-smoothstep(fallOff,area,difference));\n}\nfloat ao=1.0-totalStrength*occlusion*samplesFactor;\nfloat result=clamp(ao+base,0.0,1.0);\ngl_FragColor.r=result;\ngl_FragColor.g=result;\ngl_FragColor.b=result;\ngl_FragColor.a=1.0;\n}\n#endif\n#ifdef BILATERAL_BLUR\nuniform sampler2D depthSampler;\nuniform float outSize;\nuniform float samplerOffsets[SAMPLES];\nvoid main()\n{\nfloat texelsize=1.0/outSize;\nfloat compareDepth=texture2D(depthSampler,vUV).r;\nfloat result=0.0;\nfloat weightSum=0.0;\nfor (int i=0; i<SAMPLES; ++i)\n{\n#ifdef BILATERAL_BLUR_H\nvec2 sampleOffset=vec2(texelsize*samplerOffsets[i],0.0);\n#else\nvec2 sampleOffset=vec2(0.0,texelsize*samplerOffsets[i]);\n#endif\nvec2 samplePos=vUV+sampleOffset;\nfloat sampleDepth=texture2D(depthSampler,samplePos).r;\nfloat weight=(1.0/(0.0001+abs(compareDepth-sampleDepth)));\nresult+=texture2D(textureSampler,samplePos).r*weight;\nweightSum+=weight;\n}\nresult/=weightSum;\ngl_FragColor.rgb=vec3(result);\ngl_FragColor.a=1.0;\n}\n#endif\n",ssaoCombinePixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D originalColor;\nvarying vec2 vUV;\nvoid main(void) {\nvec4 ssaoColor=texture2D(textureSampler,vUV);\nvec4 sceneColor=texture2D(originalColor,vUV);\ngl_FragColor=sceneColor*ssaoColor;\n}\n",stereoscopicInterlacePixelShader:"const vec3 TWO=vec3(2.0,2.0,2.0);\nvarying vec2 vUV;\nuniform sampler2D camASampler;\nuniform sampler2D textureSampler;\nuniform vec2 stepSize;\nvoid main(void)\n{\nbool useCamB;\nvec2 texCoord1;\nvec2 texCoord2;\nvec3 frag1;\nvec3 frag2;\n#ifdef IS_STEREOSCOPIC_HORIZ\nuseCamB=vUV.x>0.5;\ntexCoord1=vec2(useCamB ? (vUV.x-0.5)*2.0 : vUV.x*2.0,vUV.y);\ntexCoord2=vec2(texCoord1.x+stepSize.x,vUV.y);\n#else\nuseCamB=vUV.y>0.5;\ntexCoord1=vec2(vUV.x,useCamB ? (vUV.y-0.5)*2.0 : vUV.y*2.0);\ntexCoord2=vec2(vUV.x,texCoord1.y+stepSize.y);\n#endif\n\nif (useCamB){\nfrag1=texture2D(textureSampler,texCoord1).rgb;\nfrag2=texture2D(textureSampler,texCoord2).rgb;\n}else{\nfrag1=texture2D(camASampler ,texCoord1).rgb;\nfrag2=texture2D(camASampler ,texCoord2).rgb;\n}\ngl_FragColor=vec4((frag1+frag2)/TWO,1.0);\n}",text2dPixelShader:"varying vec4 vColor;\nvarying vec2 vUV;\n\nuniform sampler2D diffuseSampler;\nvoid main(void) {\nvec4 color=texture2D(diffuseSampler,vUV);\nif (color.a<0.05)\ndiscard;\ngl_FragColor=color*vColor;\n}",text2dVertexShader:"\n#ifdef Instanced\n#define att attribute\n#else\n#define att uniform\n#endif\n\nattribute float index;\natt vec2 zBias;\natt vec4 transformX;\natt vec4 transformY;\natt vec2 topLeftUV;\natt vec2 sizeUV;\natt vec2 textureSize;\natt vec4 color;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvoid main(void) {\nvec2 pos2;\n\nif (index == 0.0) {\npos2=vec2(0.0,0.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y+sizeUV.y);\n}\n\nelse if (index == 1.0) {\npos2=vec2(0.0,1.0);\nvUV=vec2(topLeftUV.x,topLeftUV.y);\n}\n\nelse if (index == 2.0) {\npos2=vec2(1.0,1.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y);\n}\n\nelse if (index == 3.0) {\npos2=vec2(1.0,0.0);\nvUV=vec2(topLeftUV.x+sizeUV.x,topLeftUV.y+sizeUV.y);\n}\n\nvUV=(floor(vUV*textureSize)+vec2(0.0,0.0))/textureSize;\nvColor=color;\nvec4 pos;\npos.xy=floor(pos2.xy*sizeUV*textureSize); \npos.z=1.0;\npos.w=1.0;\ngl_Position=vec4(dot(pos,transformX),dot(pos,transformY),zBias.x,1);\n}",tonemapPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\n\nuniform float _ExposureAdjustment;\n#if defined(HABLE_TONEMAPPING)\nconst float A=0.15;\nconst float B=0.50;\nconst float C=0.10;\nconst float D=0.20;\nconst float E=0.02;\nconst float F=0.30;\nconst float W=11.2;\n#endif\nfloat Luminance(vec3 c)\n{\nreturn dot(c,vec3(0.22,0.707,0.071));\n}\nvoid main(void) \n{\nvec3 colour=texture2D(textureSampler,vUV).rgb;\n#if defined(REINHARD_TONEMAPPING)\nfloat lum=Luminance(colour.rgb); \nfloat lumTm=lum*_ExposureAdjustment;\nfloat scale=lumTm/(1.0+lumTm); \ncolour*=scale/lum;\n#elif defined(HABLE_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nconst float ExposureBias=2.0;\nvec3 x=ExposureBias*colour;\nvec3 curr=((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\nx=vec3(W,W,W);\nvec3 whiteScale=1.0/(((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F);\ncolour=curr*whiteScale;\n#elif defined(OPTIMIZED_HEJIDAWSON_TONEMAPPING)\ncolour*=_ExposureAdjustment;\nvec3 X=max(vec3(0.0,0.0,0.0),colour-0.004);\nvec3 retColor=(X*(6.2*X+0.5))/(X*(6.2*X+1.7)+0.06);\ncolour=retColor*retColor;\n#elif defined(PHOTOGRAPHIC_TONEMAPPING)\ncolour=vec3(1.0,1.0,1.0)-exp2(-_ExposureAdjustment*colour);\n#endif\ngl_FragColor=vec4(colour.rgb,1.0);\n}",volumetricLightScatteringPixelShader:"uniform sampler2D textureSampler;\nuniform sampler2D lightScatteringSampler;\nuniform float decay;\nuniform float exposure;\nuniform float weight;\nuniform float density;\nuniform vec2 meshPositionOnScreen;\nvarying vec2 vUV;\nvoid main(void) {\nvec2 tc=vUV;\nvec2 deltaTexCoord=(tc-meshPositionOnScreen.xy);\ndeltaTexCoord*=1.0/float(NUM_SAMPLES)*density;\nfloat illuminationDecay=1.0;\nvec4 color=texture2D(lightScatteringSampler,tc)*0.4;\nfor(int i=0; i<NUM_SAMPLES; i++) {\ntc-=deltaTexCoord;\nvec4 sample=texture2D(lightScatteringSampler,tc)*0.4;\nsample*=illuminationDecay*weight;\ncolor+=sample;\nilluminationDecay*=decay;\n}\nvec4 realColor=texture2D(textureSampler,vUV);\ngl_FragColor=((vec4((vec3(color.r,color.g,color.b)*exposure),1))+(realColor*(1.5-0.4)));\n}\n",volumetricLightScatteringPassPixelShader:"#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\n#endif\n#if defined(ALPHATEST)\nuniform sampler2D diffuseSampler;\n#endif\nvoid main(void)\n{\n#if defined(ALPHATEST)\nvec4 diffuseColor=texture2D(diffuseSampler,vUV);\nif (diffuseColor.a<0.4)\ndiscard;\n#endif\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\n}\n",vrDistortionCorrectionPixelShader:"\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 LensCenter;\nuniform vec2 Scale;\nuniform vec2 ScaleIn;\nuniform vec4 HmdWarpParam;\nvec2 HmdWarp(vec2 in01) {\nvec2 theta=(in01-LensCenter)*ScaleIn; \nfloat rSq=theta.x*theta.x+theta.y*theta.y;\nvec2 rvector=theta*(HmdWarpParam.x+HmdWarpParam.y*rSq+HmdWarpParam.z*rSq*rSq+HmdWarpParam.w*rSq*rSq*rSq);\nreturn LensCenter+Scale*rvector;\n}\nvoid main(void)\n{\nvec2 tc=HmdWarp(vUV);\nif (tc.x <0.0 || tc.x>1.0 || tc.y<0.0 || tc.y>1.0)\ngl_FragColor=vec4(0.0,0.0,0.0,1.0);\nelse{\ngl_FragColor=vec4(texture2D(textureSampler,tc).rgb,1.0);\n}\n}"},BABYLON.Effect.IncludesShadersStore={bonesDeclaration:"#if NUM_BONE_INFLUENCERS>0\nuniform mat4 mBones[BonesPerMesh];\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#endif",bonesVertex:"#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif \n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif \nfinalWorld=finalWorld*influence;\n#endif",bumpFragment:"#ifdef BUMP\nvec2 bumpUV=vBumpUV;\n#endif\n#if defined(BUMP) || defined(PARALLAX)\nmat3 TBN=cotangent_frame(normalW*vBumpInfos.y,-viewDirectionW,bumpUV);\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nvec2 uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,bumpUV,vBumpInfos.z);\n#else\nvec2 uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\ndiffuseUV+=uvOffset;\nbumpUV+=uvOffset;\n#endif\n#ifdef BUMP\nnormalW=perturbNormal(viewDirectionW,TBN,bumpUV);\n#endif",bumpFragmentFunctions:"#ifdef BUMP\nvarying vec2 vBumpUV;\nuniform vec3 vBumpInfos;\nuniform sampler2D bumpSampler;\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,mat3 cotangentFrame,vec2 uv)\n{\nvec3 map=texture2D(bumpSampler,uv).xyz;\n#ifdef INVERTNORMALMAPX\nmap.x=1.0-map.x;\n#endif\n#ifdef INVERTNORMALMAPY\nmap.y=1.0-map.y;\n#endif\nmap=map*255./127.-128./127.;\nreturn normalize(cotangentFrame*map);\n}\n#ifdef PARALLAX\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\n\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\n\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;\n\nif (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\n\nbreak;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\n\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n#endif",clipPlaneFragment:"#ifdef CLIPPLANE\nif (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif",clipPlaneFragmentDeclaration:"#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif",clipPlaneVertex:"#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif",clipPlaneVertexDeclaration:"#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif",colorCurves:"const vec3 HDTVRec709_RGBLuminanceCoefficients=vec3(0.2126,0.7152,0.0722);\nvec3 applyColorCurves(vec3 original) {\nvec3 result=original;\n\n\n\nfloat luma=dot(result.rgb,HDTVRec709_RGBLuminanceCoefficients);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0,0.0),vec2(1.0,1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma,luma,luma),result.rgb,colorCurve.a);\nreturn result;\n}",colorCurvesDefinition:"uniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\nuniform vec4 vCameraColorCurveNegative;",colorGrading:"vec4 colorGrades(vec4 color) \n{ \n\nfloat sliceContinuous=color.z*vCameraColorGradingInfos.z;\nfloat sliceInteger=floor(sliceContinuous);\n\n\nfloat sliceFraction=sliceContinuous-sliceInteger; \n\nvec2 sliceUV=color.xy*vCameraColorGradingScaleOffset.xy+vCameraColorGradingScaleOffset.zw;\n\n\nsliceUV.x+=sliceInteger*vCameraColorGradingInfos.w;\nvec4 slice0Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nsliceUV.x+=vCameraColorGradingInfos.w;\nvec4 slice1Color=texture2D(cameraColorGrading2DSampler,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\ncolor.rgb=mix(color.rgb,result,vCameraColorGradingInfos.x);\nreturn color;\n}",colorGradingDefinition:"uniform sampler2D cameraColorGrading2DSampler;\nuniform vec4 vCameraColorGradingInfos;\nuniform vec4 vCameraColorGradingScaleOffset;",fogFragment:"#ifdef FOG\nfloat fog=CalcFogFactor();\ncolor.rgb=fog*color.rgb+(1.0-fog)*vFogColor;\n#endif",fogFragmentDeclaration:"#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying float fFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nif (FOGMODE_LINEAR == vFogInfos.x)\n{\nfogCoeff=(fogEnd-fFogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2 == vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fFogDistance*fFogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif",fogVertex:"#ifdef FOG\nfFogDistance=(view*worldPos).z;\n#endif",fogVertexDeclaration:"#ifdef FOG\nvarying float fFogDistance;\n#endif",fresnelFunction:"#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif",harmonicsFunctions:"#ifdef USESPHERICALFROMREFLECTIONMAP\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX;\nuniform vec3 vSphericalYY;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\nvec3 EnvironmentIrradiance(vec3 normal)\n{\n\n\n\nvec3 result =\nvSphericalX*normal.x +\nvSphericalY*normal.y +\nvSphericalZ*normal.z +\nvSphericalXX*normal.x*normal.x +\nvSphericalYY*normal.y*normal.y +\nvSphericalZZ*normal.z*normal.z +\nvSphericalYZ*normal.y*normal.z +\nvSphericalZX*normal.z*normal.x +\nvSphericalXY*normal.x*normal.y;\nreturn result.rgb;\n}\n#endif",helperFunctions:"mat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}",instancesDeclaration:"#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#else\nuniform mat4 world;\n#endif",instancesVertex:"#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#else\nmat4 finalWorld=world;\n#endif",lightFragment:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},glossiness);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,glossiness);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nshadow=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nshadow=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nshadow=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nshadow=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nshadow=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nshadow=1.;\n#endif\ndiffuseBase+=info.diffuse*shadow;\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#endif",lightFragmentDeclaration:"#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec3 vLightSpecular{X};\n#endif\n#ifdef SHADOW{X}\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvarying vec4 vPositionFromLight{X};\nuniform sampler2D shadowSampler{X};\n#else\nuniform samplerCube shadowSampler{X};\n#endif\nuniform vec3 shadowsInfo{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\n#endif\n#ifdef HEMILIGHT{X}\nuniform vec3 vLightGround{X};\n#endif\n#endif",lightsFragmentFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w == 0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\n\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\n\nfloat cosAngle=max(0.,dot(-lightDirection.xyz,lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\n\nfloat ndl=max(0.,dot(vNormal,-lightDirection.xyz));\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW-lightDirection.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\n\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\n\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n",logDepthDeclaration:"#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif",logDepthFragment:"#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif",logDepthVertex:"#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif",pbrFunctions:"\n#define RECIPROCAL_PI2 0.15915494\n#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n\nconst float kPi=3.1415926535897932384626433832795;\nconst float kRougnhessToAlphaScale=0.1;\nconst float kRougnhessToAlphaOffset=0.29248125;\nfloat Square(float value)\n{\nreturn value*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,vec3(0.2126,0.7152,0.0722)),0.,1.);\n}\nfloat convertRoughnessToAverageSlope(float roughness)\n{\n\nconst float kMinimumVariance=0.0005;\nfloat alphaG=Square(roughness)+kMinimumVariance;\nreturn alphaG;\n}\n\nfloat getMipMapIndexFromAverageSlope(float maxMipLevel,float alpha)\n{\n\n\n\n\n\n\n\nfloat mip=kRougnhessToAlphaOffset+maxMipLevel+(maxMipLevel*kRougnhessToAlphaScale*log2(alpha));\nreturn clamp(mip,0.,maxMipLevel);\n}\nfloat getMipMapIndexFromAverageSlopeWithPMREM(float maxMipLevel,float alphaG)\n{\nfloat specularPower=clamp(2./alphaG-2.,0.000001,2048.);\n\nreturn clamp(- 0.5*log2(specularPower)+5.5,0.,maxMipLevel);\n}\n\nfloat smithVisibilityG1_TrowbridgeReitzGGX(float dot,float alphaG)\n{\nfloat tanSquared=(1.0-dot*dot)/(dot*dot);\nreturn 2.0/(1.0+sqrt(1.0+alphaG*alphaG*tanSquared));\n}\nfloat smithVisibilityG_TrowbridgeReitzGGX_Walter(float NdotL,float NdotV,float alphaG)\n{\nreturn smithVisibilityG1_TrowbridgeReitzGGX(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGX(NdotV,alphaG);\n}\n\n\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\n\n\n\nfloat a2=Square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(kPi*d*d);\n}\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow(clamp(1.0-VdotH,0.,1.),5.0);\n}\nvec3 FresnelSchlickEnvironmentGGX(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\n\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow(clamp(1.0-VdotN,0.,1.),5.0);\n}\n\nvec3 computeSpecularTerm(float NdotH,float NdotL,float NdotV,float VdotH,float roughness,vec3 specularColor,vec3 reflectance90)\n{\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\nfloat visibility=smithVisibilityG_TrowbridgeReitzGGX_Walter(NdotL,NdotV,alphaG);\nvisibility/=(4.0*NdotL*NdotV); \nvec3 fresnel=fresnelSchlickGGX(VdotH,specularColor,reflectance90);\nfloat specTerm=max(0.,visibility*distribution)*NdotL;\nreturn fresnel*specTerm*kPi; \n}\nfloat computeDiffuseTerm(float NdotL,float NdotV,float VdotH,float roughness)\n{\n\n\nfloat diffuseFresnelNV=pow(clamp(1.0-NdotL,0.000001,1.),5.0);\nfloat diffuseFresnelNL=pow(clamp(1.0-NdotV,0.000001,1.),5.0);\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat diffuseFresnelTerm =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn diffuseFresnelTerm*NdotL;\n\n\n}\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\n\nfloat lightRoughness=lightRadius/lightDistance;\n\nfloat totalRoughness=clamp(lightRoughness+roughness,0.,1.);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nfloat kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\nvec3 toLinearSpace(vec3 color)\n{\nreturn vec3(pow(color.r,2.2),pow(color.g,2.2),pow(color.b,2.2));\n}\nvec3 toGammaSpace(vec3 color)\n{\nreturn vec3(pow(color.r,1.0/2.2),pow(color.g,1.0/2.2),pow(color.b,1.0/2.2));\n}\n#ifdef CAMERATONEMAP\nvec3 toneMaps(vec3 color)\n{\ncolor=max(color,0.0);\n\ncolor.rgb=color.rgb*vCameraInfos.x;\nfloat tuning=1.5; \n\n\nvec3 tonemapped=1.0-exp2(-color.rgb*tuning); \ncolor.rgb=mix(color.rgb,tonemapped,1.0);\nreturn color;\n}\n#endif\n#ifdef CAMERACONTRAST\nvec4 contrasts(vec4 color)\n{\ncolor=clamp(color,0.0,1.0);\nvec3 resultHighContrast=color.rgb*color.rgb*(3.0-2.0*color.rgb);\nfloat contrast=vCameraInfos.y;\nif (contrast<1.0)\n{\n\ncolor.rgb=mix(vec3(0.5,0.5,0.5),color.rgb,contrast);\n}\nelse\n{\n\ncolor.rgb=mix(color.rgb,resultHighContrast,contrast-1.0);\n}\nreturn color;\n}\n#endif",pbrLightFunctions:"\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n};\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range)\n{ \n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat lightDistanceFalloff=1.0/((lightDistanceSquared+0.0001));\n#else\nfloat lightDistanceFalloff=max(0.,1.0-length(lightOffset)/range);\n#endif\nreturn lightDistanceFalloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngle,float exponent)\n{\nfloat falloff=0.0;\n#ifdef USEPHYSICALLIGHTFALLOFF\nfloat cosHalfAngle=cos(lightAngle*0.5);\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \n\n\n\n\n\nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\n\n\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfalloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\n#else\nfloat cosAngle=max(0.000000000000001,dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=lightAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\n#endif\nreturn falloff;\n}\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightDirection;\nfloat attenuation=1.0;\nfloat lightDistance;\n\nif (lightData.w == 0.)\n{\nvec3 lightOffset=lightData.xyz-vPositionW;\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nattenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\nlightDistance=sqrt(lightDistanceSquared);\nlightDirection=normalize(lightOffset);\n}\n\nelse\n{\nlightDistance=length(-lightData.xyz);\nlightDirection=normalize(-lightData.xyz);\n}\n\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW+lightDirection);\nNdotL=max(0.00000000001,dot(vNormal,lightDirection));\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float rangeRadius,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\nvec3 lightOffset=lightData.xyz-vPositionW;\nvec3 directionToLightCenterW=normalize(lightOffset);\n\nfloat lightDistanceSquared=dot(lightOffset,lightOffset);\nfloat attenuation=computeDistanceLightFalloff(lightOffset,lightDistanceSquared,rangeRadius);\n\nfloat directionalAttenuation=computeDirectionalLightFalloff(lightDirection.xyz,directionToLightCenterW,lightDirection.w,lightData.w);\nattenuation*=directionalAttenuation;\n\nfloat lightDistance=sqrt(lightDistanceSquared);\nroughness=adjustRoughnessFromLightProperties(roughness,rangeRadius,lightDistance);\n\nvec3 H=normalize(viewDirectionW-lightDirection.xyz);\nNdotL=max(0.00000000001,dot(vNormal,-lightDirection.xyz));\nfloat VdotH=clamp(dot(viewDirectionW,H),0.00000000001,1.0);\nfloat diffuseTerm=computeDiffuseTerm(NdotL,NdotV,VdotH,roughness);\nresult.diffuse=diffuseTerm*diffuseColor*attenuation;\n#ifdef SPECULARTERM\n\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float roughness,float NdotV,vec3 reflectance90,out float NdotL) {\nlightingInfo result;\n\n\n\nNdotL=dot(vNormal,lightData.xyz)*0.5+0.5;\nresult.diffuse=mix(groundColor,diffuseColor,NdotL);\n#ifdef SPECULARTERM\n\nvec3 lightVectorW=normalize(lightData.xyz);\nvec3 H=normalize(viewDirectionW+lightVectorW);\nfloat NdotH=max(0.00000000001,dot(vNormal,H));\nNdotL=max(0.00000000001,NdotL);\nfloat VdotH=clamp(0.00000000001,1.0,dot(viewDirectionW,H));\nvec3 specTerm=computeSpecularTerm(NdotH,NdotL,NdotV,VdotH,roughness,specularColor,reflectance90);\nresult.specular=specTerm;\n#endif\nreturn result;\n}",pbrLightFunctionsCall:"#ifdef LIGHT{X}\n#ifndef SPECULARTERM\nvec3 vLightSpecular{X}=vec3(0.0);\n#endif\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,vLightData{X},vLightDirection{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef HEMILIGHT{X}\ninfo=computeHemisphericLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightGround{X},roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#if defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,vLightData{X},vLightDiffuse{X}.rgb,vLightSpecular{X},vLightDiffuse{X}.a,roughness,NdotV,specularEnvironmentR90,NdotL);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWVSM{X}\nnotShadowLevel=computeShadowWithVSM(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\n#ifdef SHADOWPCF{X}\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowWithPCFCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#else\nnotShadowLevel=computeShadowWithPCF(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.y,shadowsInfo{X}.z,shadowsInfo{X}.x);\n#endif\n#else\n#if defined(POINTLIGHT{X})\nnotShadowLevel=computeShadowCube(vLightData{X}.xyz,shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#else\nnotShadowLevel=computeShadow(vPositionFromLight{X},shadowSampler{X},shadowsInfo{X}.x,shadowsInfo{X}.z);\n#endif\n#endif\n#endif\n#else\nnotShadowLevel=1.;\n#endif\nlightDiffuseContribution+=info.diffuse*notShadowLevel;\n#ifdef OVERLOADEDSHADOWVALUES\nif (NdotL<0.000000000011)\n{\nnotShadowLevel=1.;\n}\nshadowedOnlyLightDiffuseContribution*=notShadowLevel;\n#endif\n#ifdef SPECULARTERM\nlightSpecularContribution+=info.specular*notShadowLevel;\n#endif\n#endif",
pbrShadowFunctions:"\n#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y =-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\n#ifdef OVERLOADEDSHADOWVALUES\nreturn mix(1.0,darkness,vOverloadedShadowIntensity.x);\n#else\nreturn darkness;\n#endif\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,visibility+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,visibility+darkness);\n#endif\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\n#ifdef OVERLOADEDSHADOWVALUES\nreturn min(1.0,mix(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness,vOverloadedShadowIntensity.x));\n#else\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n#endif\n}\n#endif",pointCloudVertex:"#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif",pointCloudVertexDeclaration:"#ifdef POINTSIZE\nuniform float pointSize;\n#endif",reflectionFunction:"vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nfloat t=clamp(direction.y*-0.5+0.5,0.,1.0);\nfloat s=atan(direction.z,direction.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nvec3 cameraToVertex=normalize(worldPos.xyz-vEyePosition);\nvec3 r=reflect(cameraToVertex,worldNormal);\nfloat t=clamp(r.y*-0.5+0.5,0.,1.0);\nfloat s=atan(r.z,r.x)*RECIPROCAL_PI2+0.5;\nreturn vec3(s,t,0);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n#endif\n#ifdef REFLECTIONMAP_CUBIC\nvec3 viewDir=worldPos.xyz-vEyePosition;\nvec3 coords=reflect(viewDir,worldNormal);\n#ifdef INVERTCUBICMAP\ncoords.y=1.0-coords.y;\n#endif\nreturn vec3(reflectionMatrix*vec4(coords,0));\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn vec3(reflectionMatrix*(view*worldPos));\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn vPositionUVW;\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}",shadowsFragmentFunctions:"#ifdef SHADOWS\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\nuniform vec2 depthValues;\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float bias)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight))+bias;\nif (depth>shadow)\n{\nreturn darkness;\n}\nreturn 1.0;\n}\nfloat computeShadowWithPCFCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth-depthValues.x)/(depthValues.y-depthValues.x);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n\nfloat biasedDepth=depth-bias;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\nfloat computeShadow(vec4 vPositionFromLight,sampler2D shadowSampler,float darkness,float bias)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat shadow=unpack(texture2D(shadowSampler,uv))+bias;\nif (depth.z>shadow)\n{\nreturn darkness;\n}\nreturn 1.;\n}\nfloat computeShadowWithPCF(vec4 vPositionFromLight,sampler2D shadowSampler,float mapSize,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n\nfloat biasedDepth=depth.z-bias;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<biasedDepth) visibility-=0.25;\nif (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<biasedDepth) visibility-=0.25;\nreturn min(1.0,visibility+darkness);\n}\n\nfloat unpackHalf(vec2 color)\n{\nreturn color.x+(color.y/255.0);\n}\nfloat linstep(float low,float high,float v) {\nreturn clamp((v-low)/(high-low),0.0,1.0);\n}\nfloat ChebychevInequality(vec2 moments,float compare,float bias)\n{\nfloat p=smoothstep(compare-bias,compare,moments.x);\nfloat variance=max(moments.y-moments.x*moments.x,0.02);\nfloat d=compare-moments.x;\nfloat p_max=linstep(0.2,1.0,variance/(variance+d*d));\nreturn clamp(max(p,p_max),0.0,1.0);\n}\nfloat computeShadowWithVSM(vec4 vPositionFromLight,sampler2D shadowSampler,float bias,float darkness)\n{\nvec3 depth=vPositionFromLight.xyz/vPositionFromLight.w;\ndepth=0.5*depth+vec3(0.5);\nvec2 uv=depth.xy;\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0 || depth.z>=1.0)\n{\nreturn 1.0;\n}\nvec4 texel=texture2D(shadowSampler,uv);\nvec2 moments=vec2(unpackHalf(texel.xy),unpackHalf(texel.zw));\nreturn min(1.0,1.0-ChebychevInequality(moments,depth.z,bias)+darkness);\n}\n#endif",shadowsVertex:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#endif\n#endif",shadowsVertexDeclaration:"#ifdef SHADOWS\n#if defined(SPOTLIGHT{X}) || defined(DIRLIGHT{X})\nuniform mat4 lightMatrix{X};\nvarying vec4 vPositionFromLight{X};\n#endif\n#endif\n"},BABYLON.CollisionWorker='var BABYLON;!function(t){var e=function(t,e,o,i){return t.x>o.x+i?!1:o.x-i>e.x?!1:t.y>o.y+i?!1:o.y-i>e.y?!1:t.z>o.z+i?!1:!(o.z-i>e.z)},o=function(t,e,o,i){var s=e*e-4*t*o,r={root:0,found:!1};if(0>s)return r;var n=Math.sqrt(s),c=(-e-n)/(2*t),h=(-e+n)/(2*t);if(c>h){var a=h;h=c,c=a}return c>0&&i>c?(r.root=c,r.found=!0,r):h>0&&i>h?(r.root=h,r.found=!0,r):r},i=function(){function i(){this.radius=new t.Vector3(1,1,1),this.retry=0,this.basePointWorld=t.Vector3.Zero(),this.velocityWorld=t.Vector3.Zero(),this.normalizedVelocity=t.Vector3.Zero(),this._collisionPoint=t.Vector3.Zero(),this._planeIntersectionPoint=t.Vector3.Zero(),this._tempVector=t.Vector3.Zero(),this._tempVector2=t.Vector3.Zero(),this._tempVector3=t.Vector3.Zero(),this._tempVector4=t.Vector3.Zero(),this._edge=t.Vector3.Zero(),this._baseToVertex=t.Vector3.Zero(),this._destinationPoint=t.Vector3.Zero(),this._slidePlaneNormal=t.Vector3.Zero(),this._displacementVector=t.Vector3.Zero()}return i.prototype._initialize=function(e,o,i){this.velocity=o,t.Vector3.NormalizeToRef(o,this.normalizedVelocity),this.basePoint=e,e.multiplyToRef(this.radius,this.basePointWorld),o.multiplyToRef(this.radius,this.velocityWorld),this.velocityWorldLength=this.velocityWorld.length(),this.epsilon=i,this.collisionFound=!1},i.prototype._checkPointInTriangle=function(e,o,i,s,r){o.subtractToRef(e,this._tempVector),i.subtractToRef(e,this._tempVector2),t.Vector3.CrossToRef(this._tempVector,this._tempVector2,this._tempVector4);var n=t.Vector3.Dot(this._tempVector4,r);return 0>n?!1:(s.subtractToRef(e,this._tempVector3),t.Vector3.CrossToRef(this._tempVector2,this._tempVector3,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),0>n?!1:(t.Vector3.CrossToRef(this._tempVector3,this._tempVector,this._tempVector4),n=t.Vector3.Dot(this._tempVector4,r),n>=0))},i.prototype._canDoCollision=function(o,i,s,r){var n=t.Vector3.Distance(this.basePointWorld,o),c=Math.max(this.radius.x,this.radius.y,this.radius.z);return n>this.velocityWorldLength+c+i?!1:!!e(s,r,this.basePointWorld,this.velocityWorldLength+c)},i.prototype._testTriangle=function(e,i,s,r,n,c){var h,a=!1;i||(i=[]),i[e]||(i[e]=new t.Plane(0,0,0,0),i[e].copyFromPoints(s,r,n));var l=i[e];if(c||l.isFrontFacingTo(this.normalizedVelocity,0)){var _=l.signedDistanceTo(this.basePoint),d=t.Vector3.Dot(l.normal,this.velocity);if(0==d){if(Math.abs(_)>=1)return;a=!0,h=0}else{h=(-1-_)/d;var V=(1-_)/d;if(h>V){var u=V;V=h,h=u}if(h>1||0>V)return;0>h&&(h=0),h>1&&(h=1)}this._collisionPoint.copyFromFloats(0,0,0);var P=!1,p=1;if(a||(this.basePoint.subtractToRef(l.normal,this._planeIntersectionPoint),this.velocity.scaleToRef(h,this._tempVector),this._planeIntersectionPoint.addInPlace(this._tempVector),this._checkPointInTriangle(this._planeIntersectionPoint,s,r,n,l.normal)&&(P=!0,p=h,this._collisionPoint.copyFrom(this._planeIntersectionPoint))),!P){var m=this.velocity.lengthSquared(),f=m;this.basePoint.subtractToRef(s,this._tempVector);var T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p);y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(s)),this.basePoint.subtractToRef(r,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(r)),this.basePoint.subtractToRef(n,this._tempVector),T=2*t.Vector3.Dot(this.velocity,this._tempVector),b=this._tempVector.lengthSquared()-1,y=o(f,T,b,p),y.found&&(p=y.root,P=!0,this._collisionPoint.copyFrom(n)),r.subtractToRef(s,this._edge),s.subtractToRef(this.basePoint,this._baseToVertex);var g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex);if(f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found){var D=(v*y.root-R)/g;D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),s.addToRef(this._edge,this._collisionPoint))}n.subtractToRef(r,this._edge),r.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),r.addToRef(this._edge,this._collisionPoint))),s.subtractToRef(n,this._edge),n.subtractToRef(this.basePoint,this._baseToVertex),g=this._edge.lengthSquared(),v=t.Vector3.Dot(this._edge,this.velocity),R=t.Vector3.Dot(this._edge,this._baseToVertex),f=g*-m+v*v,T=g*(2*t.Vector3.Dot(this.velocity,this._baseToVertex))-2*v*R,b=g*(1-this._baseToVertex.lengthSquared())+R*R,y=o(f,T,b,p),y.found&&(D=(v*y.root-R)/g,D>=0&&1>=D&&(p=y.root,P=!0,this._edge.scaleInPlace(D),n.addToRef(this._edge,this._collisionPoint)))}if(P){var x=p*this.velocity.length();(!this.collisionFound||x<this.nearestDistance)&&(this.intersectionPoint?this.intersectionPoint.copyFrom(this._collisionPoint):this.intersectionPoint=this._collisionPoint.clone(),this.nearestDistance=x,this.collisionFound=!0)}}},i.prototype._collide=function(t,e,o,i,s,r,n){for(var c=i;s>c;c+=3){var h=e[o[c]-r],a=e[o[c+1]-r],l=e[o[c+2]-r];this._testTriangle(c,t,l,a,h,n)}},i.prototype._getResponse=function(e,o){e.addToRef(o,this._destinationPoint),o.scaleInPlace(this.nearestDistance/o.length()),this.basePoint.addToRef(o,e),e.subtractToRef(this.intersectionPoint,this._slidePlaneNormal),this._slidePlaneNormal.normalize(),this._slidePlaneNormal.scaleToRef(this.epsilon,this._displacementVector),e.addInPlace(this._displacementVector),this.intersectionPoint.addInPlace(this._displacementVector),this._slidePlaneNormal.scaleInPlace(t.Plane.SignedDistanceToPlaneFromPositionAndNormal(this.intersectionPoint,this._slidePlaneNormal,this._destinationPoint)),this._destinationPoint.subtractInPlace(this._slidePlaneNormal),this._destinationPoint.subtractToRef(this.intersectionPoint,o)},i}();t.Collider=i}(BABYLON||(BABYLON={}));var BABYLON;!function(o){o.WorkerIncluded=!0;var e=function(){function o(){this._meshes={},this._geometries={}}return o.prototype.getMeshes=function(){return this._meshes},o.prototype.getGeometries=function(){return this._geometries},o.prototype.getMesh=function(o){return this._meshes[o]},o.prototype.addMesh=function(o){this._meshes[o.uniqueId]=o},o.prototype.removeMesh=function(o){delete this._meshes[o]},o.prototype.getGeometry=function(o){return this._geometries[o]},o.prototype.addGeometry=function(o){this._geometries[o.id]=o},o.prototype.removeGeometry=function(o){delete this._geometries[o]},o}();o.CollisionCache=e;var i=function(){function e(e,i,r){this.collider=e,this._collisionCache=i,this.finalPosition=r,this.collisionsScalingMatrix=o.Matrix.Zero(),this.collisionTranformationMatrix=o.Matrix.Zero()}return e.prototype.collideWithWorld=function(o,e,i,r){var t=.01;if(this.collider.retry>=i)return void this.finalPosition.copyFrom(o);this.collider._initialize(o,e,t);for(var s,l=this._collisionCache.getMeshes(),n=Object.keys(l),a=n.length,c=0;a>c;++c)if(s=n[c],parseInt(s)!=r){var d=l[s];d.checkCollisions&&this.checkCollision(d)}return this.collider.collisionFound?(0===e.x&&0===e.y&&0===e.z||this.collider._getResponse(o,e),e.length()<=t?void this.finalPosition.copyFrom(o):(this.collider.retry++,void this.collideWithWorld(o,e,i,r))):void o.addToRef(e,this.finalPosition)},e.prototype.checkCollision=function(e){if(this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))){o.Matrix.ScalingToRef(1/this.collider.radius.x,1/this.collider.radius.y,1/this.collider.radius.z,this.collisionsScalingMatrix);var i=o.Matrix.FromArray(e.worldMatrixFromCache);i.multiplyToRef(this.collisionsScalingMatrix,this.collisionTranformationMatrix),this.processCollisionsForSubMeshes(this.collisionTranformationMatrix,e)}},e.prototype.processCollisionsForSubMeshes=function(o,e){var i=e.subMeshes,r=i.length;if(!e.geometryId)return void console.log("no mesh geometry id");var t=this._collisionCache.getGeometry(e.geometryId);if(!t)return void console.log("couldn\'t find geometry",e.geometryId);for(var s=0;r>s;s++){var l=i[s];r>1&&!this.checkSubmeshCollision(l)||(this.collideForSubMesh(l,o,t),this.collider.collisionFound&&(this.collider.collidedMesh=e.uniqueId))}},e.prototype.collideForSubMesh=function(e,i,r){if(!r.positionsArray){r.positionsArray=[];for(var t=0,s=r.positions.length;s>t;t+=3){var l=o.Vector3.FromArray([r.positions[t],r.positions[t+1],r.positions[t+2]]);r.positionsArray.push(l)}}if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(i)){e._lastColliderTransformMatrix=i.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,a=e.verticesStart+e.verticesCount,t=n;a>t;t++)e._lastColliderWorldVertices.push(o.Vector3.TransformCoordinates(r.positionsArray[t],i))}this.collider._collide(e._trianglePlanes,e._lastColliderWorldVertices,r.indices,e.indexStart,e.indexStart+e.indexCount,e.verticesStart,e.hasMaterial)},e.prototype.checkSubmeshCollision=function(e){return this.collider._canDoCollision(o.Vector3.FromArray(e.sphereCenter),e.sphereRadius,o.Vector3.FromArray(e.boxMinimum),o.Vector3.FromArray(e.boxMaximum))},e}();o.CollideWorker=i;var r=function(){function r(){}return r.prototype.onInit=function(i){this._collisionCache=new e;var r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.INIT};postMessage(r,void 0)},r.prototype.onUpdate=function(e){var i=this,r={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.UPDATE};try{for(var t in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(t)&&this._collisionCache.addGeometry(e.updatedGeometries[t]);for(var s in e.updatedMeshes)e.updatedMeshes.hasOwnProperty(s)&&this._collisionCache.addMesh(e.updatedMeshes[s]);e.removedGeometries.forEach(function(o){i._collisionCache.removeGeometry(o)}),e.removedMeshes.forEach(function(o){i._collisionCache.removeMesh(o)})}catch(l){r.error=o.WorkerReplyType.UNKNOWN_ERROR}postMessage(r,void 0)},r.prototype.onCollision=function(e){var r=o.Vector3.Zero(),t=new o.Collider;t.radius=o.Vector3.FromArray(e.collider.radius);var s=new i(t,this._collisionCache,r);s.collideWithWorld(o.Vector3.FromArray(e.collider.position),o.Vector3.FromArray(e.collider.velocity),e.maximumRetry,e.excludedMeshUniqueId);var l={collidedMeshUniqueId:t.collidedMesh,collisionId:e.collisionId,newPosition:r.asArray()},n={error:o.WorkerReplyType.SUCCESS,taskType:o.WorkerTaskType.COLLIDE,payload:l};postMessage(n,void 0)},r}();o.CollisionDetectorTransferable=r;try{if(self&&self instanceof WorkerGlobalScope){window={},o.Collider||(importScripts("./babylon.collisionCoordinator.js"),importScripts("./babylon.collider.js"),importScripts("../Math/babylon.math.js"));var t=new r,s=function(e){var i=e.data;switch(i.taskType){case o.WorkerTaskType.INIT:t.onInit(i.payload);break;case o.WorkerTaskType.COLLIDE:t.onCollision(i.payload);break;case o.WorkerTaskType.UPDATE:t.onUpdate(i.payload)}};self.onmessage=s}}catch(l){console.log("single worker init")}}(BABYLON||(BABYLON={}));var BABYLON;!function(e){e.CollisionWorker="",function(e){e[e.INIT=0]="INIT",e[e.UPDATE=1]="UPDATE",e[e.COLLIDE=2]="COLLIDE"}(e.WorkerTaskType||(e.WorkerTaskType={}));var o=e.WorkerTaskType;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.UNKNOWN_ERROR=1]="UNKNOWN_ERROR"}(e.WorkerReplyType||(e.WorkerReplyType={}));var i=e.WorkerReplyType,t=function(){function t(){var r=this;this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this.onMeshUpdated=function(e){r._addUpdateMeshesList[e.uniqueId]=t.SerializeMesh(e)},this.onGeometryUpdated=function(e){r._addUpdateGeometriesList[e.id]=t.SerializeGeometry(e)},this._afterRender=function(){if(r._init&&!(0==r._toRemoveGeometryArray.length&&0==r._toRemoveMeshesArray.length&&0==Object.keys(r._addUpdateGeometriesList).length&&0==Object.keys(r._addUpdateMeshesList).length||r._runningUpdated>4)){++r._runningUpdated;var e={updatedMeshes:r._addUpdateMeshesList,updatedGeometries:r._addUpdateGeometriesList,removedGeometries:r._toRemoveGeometryArray,removedMeshes:r._toRemoveMeshesArray},i={payload:e,taskType:o.UPDATE},t=[];for(var s in e.updatedGeometries)e.updatedGeometries.hasOwnProperty(s)&&(t.push(i.payload.updatedGeometries[s].indices.buffer),t.push(i.payload.updatedGeometries[s].normals.buffer),t.push(i.payload.updatedGeometries[s].positions.buffer));r._worker.postMessage(i,t),r._addUpdateMeshesList={},r._addUpdateGeometriesList={},r._toRemoveGeometryArray=[],r._toRemoveMeshesArray=[]}},this._onMessageFromWorker=function(t){var s=t.data;if(s.error!=i.SUCCESS)return void e.Tools.Warn("error returned from worker!");switch(s.taskType){case o.INIT:r._init=!0,r._scene.meshes.forEach(function(e){r.onMeshAdded(e)}),r._scene.getGeometries().forEach(function(e){r.onGeometryAdded(e)});break;case o.UPDATE:r._runningUpdated--;break;case o.COLLIDE:r._runningCollisionTask=!1;var n=s.payload;if(!r._collisionsCallbackArray[n.collisionId])return;r._collisionsCallbackArray[n.collisionId](n.collisionId,e.Vector3.FromArray(n.newPosition),r._scene.getMeshByUniqueID(n.collidedMeshUniqueId)),r._collisionsCallbackArray[n.collisionId]=void 0}},this._collisionsCallbackArray=[],this._init=!1,this._runningUpdated=0,this._runningCollisionTask=!1,this._addUpdateMeshesList={},this._addUpdateGeometriesList={},this._toRemoveGeometryArray=[],this._toRemoveMeshesArray=[]}return t.prototype.getNewPosition=function(e,i,t,r,s,n,a){if(this._init&&!this._collisionsCallbackArray[a]&&!this._collisionsCallbackArray[a+1e5]){e.divideToRef(t.radius,this._scaledPosition),i.divideToRef(t.radius,this._scaledVelocity),this._collisionsCallbackArray[a]=n;var d={collider:{position:this._scaledPosition.asArray(),velocity:this._scaledVelocity.asArray(),radius:t.radius.asArray()},collisionId:a,excludedMeshUniqueId:s?s.uniqueId:null,maximumRetry:r},l={payload:d,taskType:o.COLLIDE};this._worker.postMessage(l)}},t.prototype.init=function(i){this._scene=i,this._scene.registerAfterRender(this._afterRender);var t=e.WorkerIncluded?e.Engine.CodeRepository+"Collisions/babylon.collisionWorker.js":URL.createObjectURL(new Blob([e.CollisionWorker],{type:"application/javascript"}));this._worker=new Worker(t),this._worker.onmessage=this._onMessageFromWorker;var r={payload:{},taskType:o.INIT};this._worker.postMessage(r)},t.prototype.destroy=function(){this._scene.unregisterAfterRender(this._afterRender),this._worker.terminate()},t.prototype.onMeshAdded=function(e){e.registerAfterWorldMatrixUpdate(this.onMeshUpdated),this.onMeshUpdated(e)},t.prototype.onMeshRemoved=function(e){this._toRemoveMeshesArray.push(e.uniqueId)},t.prototype.onGeometryAdded=function(e){e.onGeometryUpdated=this.onGeometryUpdated,this.onGeometryUpdated(e)},t.prototype.onGeometryDeleted=function(e){this._toRemoveGeometryArray.push(e.id)},t.SerializeMesh=function(o){var i=[];o.subMeshes&&(i=o.subMeshes.map(function(e,o){return{position:o,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount,hasMaterial:!!e.getMaterial(),sphereCenter:e.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:e.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:e.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:e.getBoundingInfo().boundingBox.maximumWorld.asArray()}}));var t=null;return o instanceof e.Mesh?t=o.geometry?o.geometry.id:null:o instanceof e.InstancedMesh&&(t=o.sourceMesh&&o.sourceMesh.geometry?o.sourceMesh.geometry.id:null),{uniqueId:o.uniqueId,id:o.id,name:o.name,geometryId:t,sphereCenter:o.getBoundingInfo().boundingSphere.centerWorld.asArray(),sphereRadius:o.getBoundingInfo().boundingSphere.radiusWorld,boxMinimum:o.getBoundingInfo().boundingBox.minimumWorld.asArray(),boxMaximum:o.getBoundingInfo().boundingBox.maximumWorld.asArray(),worldMatrixFromCache:o.worldMatrixFromCache.asArray(),subMeshes:i,checkCollisions:o.checkCollisions}},t.SerializeGeometry=function(o){return{id:o.id,positions:new Float32Array(o.getVerticesData(e.VertexBuffer.PositionKind)||[]),normals:new Float32Array(o.getVerticesData(e.VertexBuffer.NormalKind)||[]),indices:new Int32Array(o.getIndices()||[])}},t}();e.CollisionCoordinatorWorker=t;var r=function(){function o(){this._scaledPosition=e.Vector3.Zero(),this._scaledVelocity=e.Vector3.Zero(),this._finalPosition=e.Vector3.Zero()}return o.prototype.getNewPosition=function(e,o,i,t,r,s,n){e.divideToRef(i.radius,this._scaledPosition),o.divideToRef(i.radius,this._scaledVelocity),i.collidedMesh=null,i.retry=0,i.initialVelocity=this._scaledVelocity,i.initialPosition=this._scaledPosition,this._collideWithWorld(this._scaledPosition,this._scaledVelocity,i,t,this._finalPosition,r),this._finalPosition.multiplyInPlace(i.radius),s(n,this._finalPosition,i.collidedMesh)},o.prototype.init=function(e){this._scene=e},o.prototype.destroy=function(){},o.prototype.onMeshAdded=function(e){},o.prototype.onMeshUpdated=function(e){},o.prototype.onMeshRemoved=function(e){},o.prototype.onGeometryAdded=function(e){},o.prototype.onGeometryUpdated=function(e){},o.prototype.onGeometryDeleted=function(e){},o.prototype._collideWithWorld=function(o,i,t,r,s,n){void 0===n&&(n=null);var a=10*e.Engine.CollisionsEpsilon;if(t.retry>=r)return void s.copyFrom(o);t._initialize(o,i,a);for(var d=0;d<this._scene.meshes.length;d++){var l=this._scene.meshes[d];l.isEnabled()&&l.checkCollisions&&l.subMeshes&&l!==n&&l._checkCollision(t)}return t.collisionFound?(0===i.x&&0===i.y&&0===i.z||t._getResponse(o,i),i.length()<=a?void s.copyFrom(o):(t.retry++,void this._collideWithWorld(o,i,t,r,s,n))):void o.addToRef(i,s)},o}();e.CollisionCoordinatorLegacy=r}(BABYLON||(BABYLON={}));var BABYLON;!function(t){t.ToGammaSpace=1/2.2,t.ToLinearSpace=2.2,t.Epsilon=.001;var i=function(){function t(){}return t.WithinEpsilon=function(t,i,n){void 0===n&&(n=1.401298e-45);var r=t-i;return r>=-n&&n>=r},t.ToHex=function(t){var i=t.toString(16);return 15>=t?("0"+i).toUpperCase():i.toUpperCase()},t.Sign=function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},t.Clamp=function(t,i,n){return void 0===i&&(i=0),void 0===n&&(n=1),Math.min(n,Math.max(i,t))},t}();t.MathTools=i;var n=function(){function n(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.r=t,this.g=i,this.b=n}return n.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},n.prototype.getClassName=function(){return"Color3"},n.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,this},n.prototype.toColor4=function(t){return void 0===t&&(t=1),new r(this.r,this.g,this.b,t)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},n.prototype.multiply=function(t){return new n(this.r*t.r,this.g*t.g,this.b*t.b)},n.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,this},n.prototype.equals=function(t){return t&&this.r===t.r&&this.g===t.g&&this.b===t.b},n.prototype.equalsFloats=function(t,i,n){return this.r===t&&this.g===i&&this.b===n},n.prototype.scale=function(t){return new n(this.r*t,this.g*t,this.b*t)},n.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,this},n.prototype.add=function(t){return new n(this.r+t.r,this.g+t.g,this.b+t.b)},n.prototype.addToRef=function(t,i){return i.r=this.r+t.r,i.g=this.g+t.g,i.b=this.b+t.b,this},n.prototype.subtract=function(t){return new n(this.r-t.r,this.g-t.g,this.b-t.b)},n.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,this},n.prototype.clone=function(){return new n(this.r,this.g,this.b)},n.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},n.prototype.copyFromFloats=function(t,i,n){return this.r=t,this.g=i,this.b=n,this},n.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)},n.prototype.toLinearSpace=function(){var t=new n;return this.toLinearSpaceToRef(t),t},n.prototype.toLinearSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToLinearSpace),i.g=Math.pow(this.g,t.ToLinearSpace),i.b=Math.pow(this.b,t.ToLinearSpace),this},n.prototype.toGammaSpace=function(){var t=new n;return this.toGammaSpaceToRef(t),t},n.prototype.toGammaSpaceToRef=function(i){return i.r=Math.pow(this.r,t.ToGammaSpace),i.g=Math.pow(this.g,t.ToGammaSpace),i.b=Math.pow(this.b,t.ToGammaSpace),this},n.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new n(0,0,0);var i=parseInt(t.substring(1,3),16),r=parseInt(t.substring(3,5),16),o=parseInt(t.substring(5,7),16);return n.FromInts(i,r,o)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1],t[i+2])},n.FromInts=function(t,i,r){return new n(t/255,i/255,r/255)},n.Lerp=function(t,i,r){var o=t.r+(i.r-t.r)*r,s=t.g+(i.g-t.g)*r,e=t.b+(i.b-t.b)*r;return new n(o,s,e)},n.Red=function(){return new n(1,0,0)},n.Green=function(){return new n(0,1,0)},n.Blue=function(){return new n(0,0,1)},n.Black=function(){return new n(0,0,0)},n.White=function(){return new n(1,1,1)},n.Purple=function(){return new n(.5,0,.5)},n.Magenta=function(){return new n(1,0,1)},n.Yellow=function(){return new n(1,1,0)},n.Gray=function(){return new n(.5,.5,.5)},n}();t.Color3=n;var r=function(){function t(t,i,n,r){this.r=t,this.g=i,this.b=n,this.a=r}return t.prototype.addInPlace=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},t.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},t.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t[i+3]=this.a,this},t.prototype.add=function(i){return new t(this.r+i.r,this.g+i.g,this.b+i.b,this.a+i.a)},t.prototype.subtract=function(i){return new t(this.r-i.r,this.g-i.g,this.b-i.b,this.a-i.a)},t.prototype.subtractToRef=function(t,i){return i.r=this.r-t.r,i.g=this.g-t.g,i.b=this.b-t.b,i.a=this.a-t.a,this},t.prototype.scale=function(i){return new t(this.r*i,this.g*i,this.b*i,this.a*i)},t.prototype.scaleToRef=function(t,i){return i.r=this.r*t,i.g=this.g*t,i.b=this.b*t,i.a=this.a*t,this},t.prototype.multiply=function(i){return new t(this.r*i.r,this.g*i.g,this.b*i.b,this.a*i.a)},t.prototype.multiplyToRef=function(t,i){return i.r=this.r*t.r,i.g=this.g*t.g,i.b=this.b*t.b,i.a=this.a*t.a,i},t.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},t.prototype.getClassName=function(){return"Color4"},t.prototype.getHashCode=function(){var t=this.r||0;return t=397*t^(this.g||0),t=397*t^(this.b||0),t=397*t^(this.a||0)},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t.prototype.copyFrom=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.toHexString=function(){var t=255*this.r|0,n=255*this.g|0,r=255*this.b|0,o=255*this.a|0;return"#"+i.ToHex(t)+i.ToHex(n)+i.ToHex(r)+i.ToHex(o)},t.FromHexString=function(i){if("#"!==i.substring(0,1)||9!==i.length)return new t(0,0,0,0);var n=parseInt(i.substring(1,3),16),r=parseInt(i.substring(3,5),16),o=parseInt(i.substring(5,7),16),s=parseInt(i.substring(7,9),16);return t.FromInts(n,r,o,s)},t.Lerp=function(i,n,r){var o=new t(0,0,0,0);return t.LerpToRef(i,n,r,o),o},t.LerpToRef=function(t,i,n,r){r.r=t.r+(i.r-t.r)*n,r.g=t.g+(i.g-t.g)*n,r.b=t.b+(i.b-t.b)*n,r.a=t.a+(i.a-t.a)*n},t.FromArray=function(i,n){return void 0===n&&(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.FromInts=function(i,n,r,o){return new t(i/255,n/255,r/255,o/255)},t.CheckColors4=function(t,i){if(t.length===3*i){for(var n=[],r=0;r<t.length;r+=3){var o=r/3*4;n[o]=t[r],n[o+1]=t[r+1],n[o+2]=t[r+2],n[o+3]=1}return n}return t},t}();t.Color4=r;var o=function(){function n(t,i){this.x=t,this.y=i}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+"}"},n.prototype.getClassName=function(){return"Vector2"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0)},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,this},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},n.prototype.copyFromFloats=function(t,i){return this.x=t,this.y=i,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,this},n.prototype.addVector3=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,this},n.prototype.multiplyByFloats=function(t,i){return new n(this.x*t,this.y*i)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,this},n.prototype.negate=function(){return new n(-this.x,-this.y)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t)},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this},n.prototype.clone=function(){return new n(this.x,this.y)},n.Zero=function(){return new n(0,0)},n.FromArray=function(t,i){return void 0===i&&(i=0),new n(t[i],t[i+1])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h);return new n(a,u)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;return s=s>r.y?r.y:s,s=s<i.y?i.y:s,new n(o,s)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y;return new n(c,p)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r;return new n(o,s)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y},n.Normalize=function(t){var i=t.clone();return i.normalize(),i},n.Minimize=function(t,i){var r=t.x<i.x?t.x:i.x,o=t.y<i.y?t.y:i.y;return new n(r,o)},n.Maximize=function(t,i){var r=t.x>i.x?t.x:i.x,o=t.y>i.y?t.y:i.y;return new n(r,o)},n.Transform=function(t,i){var r=n.Zero();return n.TransformToRef(t,i,r),r},n.TransformToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+i.m[13];n.x=r,n.y=o},n.PointInTriangle=function(t,i,n,r){var o=.5*(-n.y*r.x+i.y*(-n.x+r.x)+i.x*(n.y-r.y)+n.x*r.y),s=0>o?-1:1,e=(i.y*r.x-i.x*r.y+(r.y-i.y)*t.x+(i.x-r.x)*t.y)*s,h=(i.x*n.y-i.y*n.x+(i.y-n.y)*t.x+(n.x-i.x)*t.y)*s;return e>0&&h>0&&2*o*s>e+h},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y;return n*n+r*r},n.DistanceOfPointFromSegment=function(t,i,r){var o=n.DistanceSquared(i,r);if(0===o)return n.Distance(t,i);var s=r.subtract(i),e=Math.max(0,Math.min(1,n.Dot(t.subtract(i),s)/o)),h=i.add(s.multiplyByFloats(e,e));return n.Distance(t,h)},n}();t.Vector2=o;var s=function(){function n(t,i,n){this.x=t,this.y=i,this.z=n}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"}"},n.prototype.getClassName=function(){return"Vector3"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,this},n.prototype.toQuaternion=function(){var t=new a(0,0,0,1),i=Math.cos(.5*(this.x+this.z)),n=Math.sin(.5*(this.x+this.z)),r=Math.cos(.5*(this.z-this.x)),o=Math.sin(.5*(this.z-this.x)),s=Math.cos(.5*this.y),e=Math.sin(.5*this.y);return t.x=r*e,t.y=-o*e,t.z=n*s,t.w=i*s,t},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,this},n.prototype.subtractFromFloats=function(t,i,r){return new n(this.x-t,this.y-i,this.z-r)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r){return r.x=this.x-t,r.y=this.y-i,r.z=this.z-n,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)},n.prototype.equalsToFloats=function(t,i,n){return this.x===t&&this.y===i&&this.z===n},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,this},n.prototype.multiplyByFloats=function(t,i,r){return new n(this.x*t,this.y*i,this.z*r)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.prototype.normalize=function(){var t=this.length();if(0===t||1===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},n.prototype.copyFromFloats=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},n.GetClipFactor=function(t,i,r,o){var s=n.Dot(t,r)-o,e=n.Dot(i,r)-o,h=s/(s-e);return h},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromFloatArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2]},n.FromFloatsToRef=function(t,i,n,r){r.x=t,r.y=i,r.z=n},n.Zero=function(){return new n(0,0,0)},n.Up=function(){return new n(0,1,0)},n.TransformCoordinates=function(t,i){var r=n.Zero();return n.TransformCoordinatesToRef(t,i,r),r},n.TransformCoordinatesToRef=function(t,i,n){var r=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8]+i.m[12],o=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9]+i.m[13],s=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]+i.m[14],e=t.x*i.m[3]+t.y*i.m[7]+t.z*i.m[11]+i.m[15];n.x=r/e,n.y=o/e,n.z=s/e},n.TransformCoordinatesFromFloatsToRef=function(t,i,n,r,o){var s=t*r.m[0]+i*r.m[4]+n*r.m[8]+r.m[12],e=t*r.m[1]+i*r.m[5]+n*r.m[9]+r.m[13],h=t*r.m[2]+i*r.m[6]+n*r.m[10]+r.m[14],a=t*r.m[3]+i*r.m[7]+n*r.m[11]+r.m[15];o.x=s/a,o.y=e/a,o.z=h/a},n.TransformNormal=function(t,i){var r=n.Zero();return n.TransformNormalToRef(t,i,r),r},n.TransformNormalToRef=function(t,i,n){n.x=t.x*i.m[0]+t.y*i.m[4]+t.z*i.m[8],n.y=t.x*i.m[1]+t.y*i.m[5]+t.z*i.m[9],n.z=t.x*i.m[2]+t.y*i.m[6]+t.z*i.m[10]},n.TransformNormalFromFloatsToRef=function(t,i,n,r,o){o.x=t*r.m[0]+i*r.m[4]+n*r.m[8],o.y=t*r.m[1]+i*r.m[5]+n*r.m[9],o.z=t*r.m[2]+i*r.m[6]+n*r.m[10]},n.CatmullRom=function(t,i,r,o,s){var e=s*s,h=s*e,a=.5*(2*i.x+(-t.x+r.x)*s+(2*t.x-5*i.x+4*r.x-o.x)*e+(-t.x+3*i.x-3*r.x+o.x)*h),u=.5*(2*i.y+(-t.y+r.y)*s+(2*t.y-5*i.y+4*r.y-o.y)*e+(-t.y+3*i.y-3*r.y+o.y)*h),m=.5*(2*i.z+(-t.z+r.z)*s+(2*t.z-5*i.z+4*r.z-o.z)*e+(-t.z+3*i.z-3*r.z+o.z)*h);return new n(a,u,m)},n.Clamp=function(t,i,r){var o=t.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var s=t.y;s=s>r.y?r.y:s,s=s<i.y?i.y:s;var e=t.z;return e=e>r.z?r.z:e,e=e<i.z?i.z:e,new n(o,s,e)},n.Hermite=function(t,i,r,o,s){var e=s*s,h=s*e,a=2*h-3*e+1,u=-2*h+3*e,m=h-2*e+s,y=h-e,c=t.x*a+r.x*u+i.x*m+o.x*y,p=t.y*a+r.y*u+i.y*m+o.y*y,f=t.z*a+r.z*u+i.z*m+o.z*y;return new n(c,p,f)},n.Lerp=function(t,i,r){var o=t.x+(i.x-t.x)*r,s=t.y+(i.y-t.y)*r,e=t.z+(i.z-t.z)*r;return new n(o,s,e)},n.Dot=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},n.Cross=function(t,i){var r=n.Zero();return n.CrossToRef(t,i,r),r},n.CrossToRef=function(t,i,n){M.Vector3[0].x=t.y*i.z-t.z*i.y,M.Vector3[0].y=t.z*i.x-t.x*i.z,M.Vector3[0].z=t.x*i.y-t.y*i.x,n.copyFrom(M.Vector3[0])},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Project=function(t,i,r,o){var s=o.width,e=o.height,h=o.x,a=o.y,m=u.FromValues(s/2,0,0,0,0,-e/2,0,0,0,0,1,0,h+s/2,e/2+a,0,1),y=i.multiply(r).multiply(m);return n.TransformCoordinates(t,y)},n.UnprojectFromTransform=function(t,r,o,s,e){var h=s.multiply(e);h.invert(),t.x=t.x/r*2-1,t.y=-(t.y/o*2-1);var a=n.TransformCoordinates(t,h),u=t.x*h.m[3]+t.y*h.m[7]+t.z*h.m[11]+h.m[15];return i.WithinEpsilon(u,1)&&(a=a.scale(1/u)),a},n.Unproject=function(t,r,o,s,e,h){var a=s.multiply(e).multiply(h);a.invert();var u=new n(t.x/r*2-1,-(t.y/o*2-1),t.z),m=n.TransformCoordinates(u,a),y=u.x*a.m[3]+u.y*a.m[7]+u.z*a.m[11]+a.m[15];return i.WithinEpsilon(y,1)&&(m=m.scale(1/y)),m},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z;return n*n+r*r+o*o},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n.RotationFromAxis=function(t,i,r){var o=n.Zero();return n.RotationFromAxisToRef(t,i,r,o),o},n.RotationFromAxisToRef=function(r,o,s,e){var h=r.normalize(),a=s.normalize(),u=p.X,m=p.Y,y=0,c=0,f=0,l=0,x=0,z=0,w=0,v=-1,d=0,g=M.Vector3[0],T=0,R=M.Vector3[1];i.WithinEpsilon(a.z,0,t.Epsilon)?z=1:i.WithinEpsilon(a.x,0,t.Epsilon)?l=1:(w=a.z/a.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),R.x=l,R.y=x,R.z=z,R.normalize(),n.CrossToRef(h,R,g),g.normalize(),n.Dot(a,g)<0&&(v=1),T=n.Dot(h,R),T=Math.min(1,Math.max(-1,T)),f=Math.acos(T)*v,n.Dot(R,u)<0&&(f=Math.PI+f,R=R.scaleInPlace(-1),d++);var _=M.Vector3[2],b=M.Vector3[3];l=0,x=0,z=0,v=-1,i.WithinEpsilon(a.z,0,t.Epsilon)?l=1:(w=R.z/R.x,l=-w*Math.sqrt(1/(1+w*w)),z=Math.sqrt(1/(1+w*w))),_.x=l,_.y=x,_.z=z,_.normalize(),n.CrossToRef(_,R,b),b.normalize(),n.CrossToRef(a,_,g),g.normalize(),n.Dot(R,g)<0&&(v=1),T=n.Dot(a,_),T=Math.min(1,Math.max(-1,T)),c=Math.acos(T)*v,n.Dot(b,m)<0&&(c=Math.PI+c,d++),v=-1,n.CrossToRef(u,R,g),g.normalize(),n.Dot(g,m)<0&&(v=1),T=n.Dot(R,u),T=Math.min(1,Math.max(-1,T)),y=-Math.acos(T)*v,0>T&&2>d&&(y=Math.PI+y),e.x=c,e.y=y,e.z=f},n}();t.Vector3=s;var e=function(){function n(t,i,n,r){this.x=t,this.y=i,this.z=n,this.w=r}return n.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+"W:"+this.w+"}"},n.prototype.getClassName=function(){return"Vector4"},n.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},n.prototype.asArray=function(){var t=[];return this.toArray(t,0),t},n.prototype.toArray=function(t,i){return void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,this},n.prototype.addInPlace=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},n.prototype.addToRef=function(t,i){return i.x=this.x+t.x,i.y=this.y+t.y,i.z=this.z+t.z,i.w=this.w+t.w,this},n.prototype.subtractInPlace=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},n.prototype.subtractToRef=function(t,i){return i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z,i.w=this.w-t.w,this},n.prototype.subtractFromFloats=function(t,i,r,o){return new n(this.x-t,this.y-i,this.z-r,this.w-o)},n.prototype.subtractFromFloatsToRef=function(t,i,n,r,o){return o.x=this.x-t,o.y=this.y-i,o.z=this.z-n,o.w=this.w-r,this},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z,-this.w)},n.prototype.scaleInPlace=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.prototype.scale=function(t){return new n(this.x*t,this.y*t,this.z*t,this.w*t)},n.prototype.scaleToRef=function(t,i){i.x=this.x*t,i.y=this.y*t,i.z=this.z*t,i.w=this.w*t},n.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.prototype.equalsWithEpsilon=function(n,r){return void 0===r&&(r=t.Epsilon),n&&i.WithinEpsilon(this.x,n.x,r)&&i.WithinEpsilon(this.y,n.y,r)&&i.WithinEpsilon(this.z,n.z,r)&&i.WithinEpsilon(this.w,n.w,r)},n.prototype.equalsToFloats=function(t,i,n,r){return this.x===t&&this.y===i&&this.z===n&&this.w===r},n.prototype.multiplyInPlace=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.prototype.multiply=function(t){return new n(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},n.prototype.multiplyToRef=function(t,i){return i.x=this.x*t.x,i.y=this.y*t.y,i.z=this.z*t.z,i.w=this.w*t.w,this},n.prototype.multiplyByFloats=function(t,i,r,o){return new n(this.x*t,this.y*i,this.z*r,this.w*o)},n.prototype.divide=function(t){return new n(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},n.prototype.divideToRef=function(t,i){return i.x=this.x/t.x,i.y=this.y/t.y,i.z=this.z/t.z,i.w=this.w/t.w,this},n.prototype.MinimizeInPlace=function(t){return t.x<this.x&&(this.x=t.x),t.y<this.y&&(this.y=t.y),t.z<this.z&&(this.z=t.z),t.w<this.w&&(this.w=t.w),this},n.prototype.MaximizeInPlace=function(t){return t.x>this.x&&(this.x=t.x),t.y>this.y&&(this.y=t.y),t.z>this.z&&(this.z=t.z),t.w>this.w&&(this.w=t.w),this},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.prototype.normalize=function(){var t=this.length();if(0===t)return this;var i=1/t;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},n.prototype.toVector3=function(){return new s(this.x,this.y,this.z)},n.prototype.clone=function(){return new n(this.x,this.y,this.z,this.w)},n.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},n.FromArray=function(t,i){return i||(i=0),new n(t[i],t[i+1],t[i+2],t[i+3])},n.FromArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatArrayToRef=function(t,i,n){n.x=t[i],n.y=t[i+1],n.z=t[i+2],n.w=t[i+3]},n.FromFloatsToRef=function(t,i,n,r,o){o.x=t,o.y=i,o.z=n,o.w=r},n.Zero=function(){return new n(0,0,0,0)},n.Normalize=function(t){var i=n.Zero();return n.NormalizeToRef(t,i),i},n.NormalizeToRef=function(t,i){i.copyFrom(t),i.normalize()},n.Minimize=function(t,i){var n=t.clone();return n.MinimizeInPlace(i),n},n.Maximize=function(t,i){var n=t.clone();return n.MaximizeInPlace(i),n},n.Distance=function(t,i){return Math.sqrt(n.DistanceSquared(t,i))},n.DistanceSquared=function(t,i){var n=t.x-i.x,r=t.y-i.y,o=t.z-i.z,s=t.w-i.w;return n*n+r*r+o*o+s*s},n.Center=function(t,i){var n=t.add(i);return n.scaleInPlace(.5),n},n}();t.Vector4=e;var h=function(){function t(t,i){this.width=t,this.height=i}return t.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},t.prototype.getClassName=function(){return"Size"},t.prototype.getHashCode=function(){var t=this.width||0;return t=397*t^(this.height||0)},t.prototype.copyFrom=function(t){this.width=t.width,this.height=t.height},t.prototype.clone=function(){return new t(this.width,this.height)},t.prototype.equals=function(t){return t?this.width===t.width&&this.height===t.height:!1},Object.defineProperty(t.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),t.Zero=function(){return new t(0,0)},t.prototype.add=function(i){var n=new t(this.width+i.width,this.height+i.height);return n},t.prototype.substract=function(i){var n=new t(this.width-i.width,this.height-i.height);return n},t.Lerp=function(i,n,r){var o=i.width+(n.width-i.width)*r,s=i.height+(n.height-i.height)*r;return new t(o,s)},t}();t.Size=h;var a=function(){function t(t,i,n,r){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1),this.x=t,this.y=i,this.z=n,this.w=r}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var t=this.x||0;return t=397*t^(this.y||0),t=397*t^(this.z||0),t=397*t^(this.w||0)},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t.prototype.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.copyFromFloats=function(t,i,n,r){return this.x=t,this.y=i,this.z=n,this.w=r,this},t.prototype.add=function(i){return new t(this.x+i.x,this.y+i.y,this.z+i.z,this.w+i.w)},t.prototype.subtract=function(i){return new t(this.x-i.x,this.y-i.y,this.z-i.z,this.w-i.w)},t.prototype.scale=function(i){return new t(this.x*i,this.y*i,this.z*i,this.w*i)},t.prototype.multiply=function(i){var n=new t(0,0,0,1);return this.multiplyToRef(i,n),n},t.prototype.multiplyToRef=function(t,i){var n=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,r=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,o=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,s=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w;return i.copyFromFloats(n,r,o,s),this},t.prototype.multiplyInPlace=function(t){return this.multiplyToRef(t,this),this},t.prototype.conjugateToRef=function(t){return t.copyFromFloats(-this.x,-this.y,-this.z,this.w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){var i=new t(-this.x,-this.y,-this.z,this.w);return i},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},t.prototype.toEulerAngles=function(t){void 0===t&&(t="YZX");var i=s.Zero();return this.toEulerAnglesToRef(i,t),i},t.prototype.toEulerAnglesToRef=function(t,i){void 0===i&&(i="YZX");var n,r,o,s=this.x,e=this.y,h=this.z,a=this.w;switch(i){case"YZX":var u=s*e+h*a;if(u>.499&&(n=2*Math.atan2(s,a),r=Math.PI/2,o=0),-.499>u&&(n=-2*Math.atan2(s,a),r=-Math.PI/2,o=0),isNaN(n)){var m=s*s,y=e*e,c=h*h;n=Math.atan2(2*e*a-2*s*h,1-2*y-2*c),r=Math.asin(2*u),o=Math.atan2(2*s*a-2*e*h,1-2*m-2*c)}break;default:throw new Error("Euler order "+i+" not supported yet.")}return t.y=n,t.z=r,t.x=o,this},t.prototype.toRotationMatrix=function(t){var i=this.x*this.x,n=this.y*this.y,r=this.z*this.z,o=this.x*this.y,s=this.z*this.w,e=this.z*this.x,h=this.y*this.w,a=this.y*this.z,u=this.x*this.w;return t.m[0]=1-2*(n+r),t.m[1]=2*(o+s),t.m[2]=2*(e-h),t.m[3]=0,t.m[4]=2*(o-s),t.m[5]=1-2*(r+i),t.m[6]=2*(a+u),t.m[7]=0,t.m[8]=2*(e+h),t.m[9]=2*(a-u),t.m[10]=1-2*(n+i),t.m[11]=0,t.m[12]=0,t.m[13]=0,t.m[14]=0,t.m[15]=1,this},t.prototype.fromRotationMatrix=function(i){return t.FromRotationMatrixToRef(i,this),this},t.FromRotationMatrix=function(i){var n=new t;return t.FromRotationMatrixToRef(i,n),n},t.FromRotationMatrixToRef=function(t,i){var n,r=t.m,o=r[0],s=r[4],e=r[8],h=r[1],a=r[5],u=r[9],m=r[2],y=r[6],c=r[10],p=o+a+c;p>0?(n=.5/Math.sqrt(p+1),i.w=.25/n,i.x=(y-u)*n,i.y=(e-m)*n,i.z=(h-s)*n):o>a&&o>c?(n=2*Math.sqrt(1+o-a-c),i.w=(y-u)/n,i.x=.25*n,i.y=(s+h)/n,i.z=(e+m)/n):a>c?(n=2*Math.sqrt(1+a-o-c),i.w=(e-m)/n,i.x=(s+h)/n,i.y=.25*n,i.z=(u+y)/n):(n=2*Math.sqrt(1+c-o-a),i.w=(h-s)/n,i.x=(e+m)/n,i.y=(u+y)/n,i.z=.25*n)},t.Inverse=function(i){return new t(-i.x,-i.y,-i.z,i.w)},t.Identity=function(){return new t(0,0,0,1)},t.RotationAxis=function(i,n){var r=new t,o=Math.sin(n/2);return i.normalize(),r.w=Math.cos(n/2),r.x=i.x*o,r.y=i.y*o,r.z=i.z*o,r},t.FromArray=function(i,n){return n||(n=0),new t(i[n],i[n+1],i[n+2],i[n+3])},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){var o=.5*n,s=.5*i,e=.5*t,h=Math.sin(o),a=Math.cos(o),u=Math.sin(s),m=Math.cos(s),y=Math.sin(e),c=Math.cos(e);r.x=c*u*a+y*m*h,r.y=y*m*a-c*u*h,r.z=c*m*h-y*u*a,r.w=c*m*a+y*u*h},t.RotationAlphaBetaGamma=function(i,n,r){var o=new t;return t.RotationAlphaBetaGammaToRef(i,n,r,o),o},t.RotationAlphaBetaGammaToRef=function(t,i,n,r){var o=.5*(n+t),s=.5*(n-t),e=.5*i;r.x=Math.cos(s)*Math.sin(e),r.y=Math.sin(s)*Math.sin(e),r.z=Math.sin(o)*Math.cos(e),r.w=Math.cos(o)*Math.cos(e)},t.Slerp=function(i,n,r){var o,s,e=r,h=i.x*n.x+i.y*n.y+i.z*n.z+i.w*n.w,a=!1;if(0>h&&(a=!0,h=-h),h>.999999)s=1-e,o=a?-e:e;else{var u=Math.acos(h),m=1/Math.sin(u);s=Math.sin((1-e)*u)*m,o=a?-Math.sin(e*u)*m:Math.sin(e*u)*m}return new t(s*i.x+o*n.x,s*i.y+o*n.y,s*i.z+o*n.z,s*i.w+o*n.w)},t}();t.Quaternion=a;var u=function(){function t(){this.m=new Float32Array(16)}return t.prototype.isIdentity=function(){return 1!==this.m[0]||1!==this.m[5]||1!==this.m[10]||1!==this.m[15]?!1:0===this.m[1]&&0===this.m[2]&&0===this.m[3]&&0===this.m[4]&&0===this.m[6]&&0===this.m[7]&&0===this.m[8]&&0===this.m[9]&&0===this.m[11]&&0===this.m[12]&&0===this.m[13]&&0===this.m[14]},t.prototype.determinant=function(){var t=this.m[10]*this.m[15]-this.m[11]*this.m[14],i=this.m[9]*this.m[15]-this.m[11]*this.m[13],n=this.m[9]*this.m[14]-this.m[10]*this.m[13],r=this.m[8]*this.m[15]-this.m[11]*this.m[12],o=this.m[8]*this.m[14]-this.m[10]*this.m[12],s=this.m[8]*this.m[13]-this.m[9]*this.m[12];return this.m[0]*(this.m[5]*t-this.m[6]*i+this.m[7]*n)-this.m[1]*(this.m[4]*t-this.m[6]*r+this.m[7]*o)+this.m[2]*(this.m[4]*i-this.m[5]*r+this.m[7]*s)-this.m[3]*(this.m[4]*n-this.m[5]*o+this.m[6]*s)},t.prototype.toArray=function(){return this.m},t.prototype.asArray=function(){return this.toArray()},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){for(var t=0;16>t;t++)this.m[t]=0;return this},t.prototype.add=function(i){var n=new t;return this.addToRef(i,n),n},t.prototype.addToRef=function(t,i){for(var n=0;16>n;n++)i.m[n]=this.m[n]+t.m[n];return this},t.prototype.addToSelf=function(t){for(var i=0;16>i;i++)this.m[i]+=t.m[i];return this},t.prototype.invertToRef=function(t){var i=this.m[0],n=this.m[1],r=this.m[2],o=this.m[3],s=this.m[4],e=this.m[5],h=this.m[6],a=this.m[7],u=this.m[8],m=this.m[9],y=this.m[10],c=this.m[11],p=this.m[12],f=this.m[13],l=this.m[14],x=this.m[15],z=y*x-c*l,w=m*x-c*f,v=m*l-y*f,d=u*x-c*p,g=u*l-y*p,T=u*f-m*p,R=e*z-h*w+a*v,_=-(s*z-h*d+a*g),M=s*w-e*d+a*T,b=-(s*v-e*g+h*T),F=1/(i*R+n*_+r*M+o*b),A=h*x-a*l,L=e*x-a*f,P=e*l-h*f,C=s*x-a*p,Z=s*l-h*p,S=s*f-e*p,I=h*c-a*y,q=e*c-a*m,H=e*y-h*m,N=s*c-a*u,V=s*y-h*u,D=s*m-e*u;return t.m[0]=R*F,t.m[4]=_*F,t.m[8]=M*F,t.m[12]=b*F,t.m[1]=-(n*z-r*w+o*v)*F,t.m[5]=(i*z-r*d+o*g)*F,t.m[9]=-(i*w-n*d+o*T)*F,t.m[13]=(i*v-n*g+r*T)*F,t.m[2]=(n*A-r*L+o*P)*F,t.m[6]=-(i*A-r*C+o*Z)*F,t.m[10]=(i*L-n*C+o*S)*F,t.m[14]=-(i*P-n*Z+r*S)*F,t.m[3]=-(n*I-r*q+o*H)*F,t.m[7]=(i*I-r*N+o*V)*F,t.m[11]=-(i*q-n*N+o*D)*F,t.m[15]=(i*H-n*V+r*D)*F,this},t.prototype.setTranslation=function(t){return this.m[12]=t.x,this.m[13]=t.y,this.m[14]=t.z,this},t.prototype.getTranslation=function(){return new s(this.m[12],this.m[13],this.m[14])},t.prototype.multiply=function(i){var n=new t;return this.multiplyToRef(i,n),n},t.prototype.copyFrom=function(t){for(var i=0;16>i;i++)this.m[i]=t.m[i];return this},t.prototype.copyToArray=function(t,i){void 0===i&&(i=0);for(var n=0;16>n;n++)t[i+n]=this.m[n];return this},t.prototype.multiplyToRef=function(t,i){return this.multiplyToArray(t,i.m,0),this},t.prototype.multiplyToArray=function(t,i,n){var r=this.m[0],o=this.m[1],s=this.m[2],e=this.m[3],h=this.m[4],a=this.m[5],u=this.m[6],m=this.m[7],y=this.m[8],c=this.m[9],p=this.m[10],f=this.m[11],l=this.m[12],x=this.m[13],z=this.m[14],w=this.m[15],v=t.m[0],d=t.m[1],g=t.m[2],T=t.m[3],R=t.m[4],_=t.m[5],M=t.m[6],b=t.m[7],F=t.m[8],A=t.m[9],L=t.m[10],P=t.m[11],C=t.m[12],Z=t.m[13],S=t.m[14],I=t.m[15];return i[n]=r*v+o*R+s*F+e*C,i[n+1]=r*d+o*_+s*A+e*Z,i[n+2]=r*g+o*M+s*L+e*S,i[n+3]=r*T+o*b+s*P+e*I,i[n+4]=h*v+a*R+u*F+m*C,i[n+5]=h*d+a*_+u*A+m*Z,i[n+6]=h*g+a*M+u*L+m*S,i[n+7]=h*T+a*b+u*P+m*I,i[n+8]=y*v+c*R+p*F+f*C,\ni[n+9]=y*d+c*_+p*A+f*Z,i[n+10]=y*g+c*M+p*L+f*S,i[n+11]=y*T+c*b+p*P+f*I,i[n+12]=l*v+x*R+z*F+w*C,i[n+13]=l*d+x*_+z*A+w*Z,i[n+14]=l*g+x*M+z*L+w*S,i[n+15]=l*T+x*b+z*P+w*I,this},t.prototype.equals=function(t){return t&&this.m[0]===t.m[0]&&this.m[1]===t.m[1]&&this.m[2]===t.m[2]&&this.m[3]===t.m[3]&&this.m[4]===t.m[4]&&this.m[5]===t.m[5]&&this.m[6]===t.m[6]&&this.m[7]===t.m[7]&&this.m[8]===t.m[8]&&this.m[9]===t.m[9]&&this.m[10]===t.m[10]&&this.m[11]===t.m[11]&&this.m[12]===t.m[12]&&this.m[13]===t.m[13]&&this.m[14]===t.m[14]&&this.m[15]===t.m[15]},t.prototype.clone=function(){return t.FromValues(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5],this.m[6],this.m[7],this.m[8],this.m[9],this.m[10],this.m[11],this.m[12],this.m[13],this.m[14],this.m[15])},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var t=this.m[0]||0,i=1;16>i;i++)t=397*t^(this.m[i]||0);return t},t.prototype.decompose=function(n,r,o){o.x=this.m[12],o.y=this.m[13],o.z=this.m[14];var s=i.Sign(this.m[0]*this.m[1]*this.m[2]*this.m[3])<0?-1:1,e=i.Sign(this.m[4]*this.m[5]*this.m[6]*this.m[7])<0?-1:1,h=i.Sign(this.m[8]*this.m[9]*this.m[10]*this.m[11])<0?-1:1;if(n.x=s*Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]),n.y=e*Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]+this.m[6]*this.m[6]),n.z=h*Math.sqrt(this.m[8]*this.m[8]+this.m[9]*this.m[9]+this.m[10]*this.m[10]),0===n.x||0===n.y||0===n.z)return r.x=0,r.y=0,r.z=0,r.w=1,!1;var u=t.FromValues(this.m[0]/n.x,this.m[1]/n.x,this.m[2]/n.x,0,this.m[4]/n.y,this.m[5]/n.y,this.m[6]/n.y,0,this.m[8]/n.z,this.m[9]/n.z,this.m[10]/n.z,0,0,0,0,1);return a.FromRotationMatrixToRef(u,r),!0},t.FromArray=function(i,n){var r=new t;return n||(n=0),t.FromArrayToRef(i,n,r),r},t.FromArrayToRef=function(t,i,n){for(var r=0;16>r;r++)n.m[r]=t[r+i]},t.FromFloat32ArrayToRefScaled=function(t,i,n,r){for(var o=0;16>o;o++)r.m[o]=t[o+i]*n},t.FromValuesToRef=function(t,i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){x.m[0]=t,x.m[1]=i,x.m[2]=n,x.m[3]=r,x.m[4]=o,x.m[5]=s,x.m[6]=e,x.m[7]=h,x.m[8]=a,x.m[9]=u,x.m[10]=m,x.m[11]=y,x.m[12]=c,x.m[13]=p,x.m[14]=f,x.m[15]=l},t.prototype.getRow=function(t){if(0>t||t>3)return null;var i=4*t;return new e(this.m[i+0],this.m[i+1],this.m[i+2],this.m[i+3])},t.prototype.setRow=function(t,i){if(0>t||t>3)return this;var n=4*t;return this.m[n+0]=i.x,this.m[n+1]=i.y,this.m[n+2]=i.z,this.m[n+3]=i.w,this},t.FromValues=function(i,n,r,o,s,e,h,a,u,m,y,c,p,f,l,x){var z=new t;return z.m[0]=i,z.m[1]=n,z.m[2]=r,z.m[3]=o,z.m[4]=s,z.m[5]=e,z.m[6]=h,z.m[7]=a,z.m[8]=u,z.m[9]=m,z.m[10]=y,z.m[11]=c,z.m[12]=p,z.m[13]=f,z.m[14]=l,z.m[15]=x,z},t.Compose=function(i,n,r){var o=t.FromValues(i.x,0,0,0,0,i.y,0,0,0,0,i.z,0,0,0,0,1),s=t.Identity();return n.toRotationMatrix(s),o=o.multiply(s),o.setTranslation(r),o},t.Identity=function(){return t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},t.IdentityToRef=function(i){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,i)},t.Zero=function(){return t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)},t.RotationX=function(i){var n=new t;return t.RotationXToRef(i,n),n},t.Invert=function(i){var n=new t;return i.invertToRef(n),n},t.RotationXToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[0]=1,i.m[15]=1,i.m[5]=r,i.m[10]=r,i.m[9]=-n,i.m[6]=n,i.m[1]=0,i.m[2]=0,i.m[3]=0,i.m[4]=0,i.m[7]=0,i.m[8]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationY=function(i){var n=new t;return t.RotationYToRef(i,n),n},t.RotationYToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[5]=1,i.m[15]=1,i.m[0]=r,i.m[2]=-n,i.m[8]=n,i.m[10]=r,i.m[1]=0,i.m[3]=0,i.m[4]=0,i.m[6]=0,i.m[7]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationZ=function(i){var n=new t;return t.RotationZToRef(i,n),n},t.RotationZToRef=function(t,i){var n=Math.sin(t),r=Math.cos(t);i.m[10]=1,i.m[15]=1,i.m[0]=r,i.m[1]=n,i.m[4]=-n,i.m[5]=r,i.m[2]=0,i.m[3]=0,i.m[6]=0,i.m[7]=0,i.m[8]=0,i.m[9]=0,i.m[11]=0,i.m[12]=0,i.m[13]=0,i.m[14]=0},t.RotationAxis=function(i,n){var r=t.Zero();return t.RotationAxisToRef(i,n,r),r},t.RotationAxisToRef=function(t,i,n){var r=Math.sin(-i),o=Math.cos(-i),s=1-o;t.normalize(),n.m[0]=t.x*t.x*s+o,n.m[1]=t.x*t.y*s-t.z*r,n.m[2]=t.x*t.z*s+t.y*r,n.m[3]=0,n.m[4]=t.y*t.x*s+t.z*r,n.m[5]=t.y*t.y*s+o,n.m[6]=t.y*t.z*s-t.x*r,n.m[7]=0,n.m[8]=t.z*t.x*s-t.y*r,n.m[9]=t.z*t.y*s+t.x*r,n.m[10]=t.z*t.z*s+o,n.m[11]=0,n.m[15]=1},t.RotationYawPitchRoll=function(i,n,r){var o=new t;return t.RotationYawPitchRollToRef(i,n,r,o),o},t.RotationYawPitchRollToRef=function(t,i,n,r){a.RotationYawPitchRollToRef(t,i,n,this._tempQuaternion),this._tempQuaternion.toRotationMatrix(r)},t.Scaling=function(i,n,r){var o=t.Zero();return t.ScalingToRef(i,n,r,o),o},t.ScalingToRef=function(t,i,n,r){r.m[0]=t,r.m[1]=0,r.m[2]=0,r.m[3]=0,r.m[4]=0,r.m[5]=i,r.m[6]=0,r.m[7]=0,r.m[8]=0,r.m[9]=0,r.m[10]=n,r.m[11]=0,r.m[12]=0,r.m[13]=0,r.m[14]=0,r.m[15]=1},t.Translation=function(i,n,r){var o=t.Identity();return t.TranslationToRef(i,n,r,o),o},t.TranslationToRef=function(i,n,r,o){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,i,n,r,1,o)},t.Lerp=function(i,n,r){for(var o=t.Zero(),s=0;16>s;s++)o.m[s]=i.m[s]*(1-r)+n.m[s]*r;return o},t.DecomposeLerp=function(i,n,r){var o=new s(0,0,0),e=new a,h=new s(0,0,0);i.decompose(o,e,h);var u=new s(0,0,0),m=new a,y=new s(0,0,0);n.decompose(u,m,y);var c=s.Lerp(o,u,r),p=a.Slerp(e,m,r),f=s.Lerp(h,y,r);return t.Compose(c,p,f)},t.LookAtLH=function(i,n,r){var o=t.Zero();return t.LookAtLHToRef(i,n,r,o),o},t.LookAtLHToRef=function(i,n,r,o){n.subtractToRef(i,this._zAxis),this._zAxis.normalize(),s.CrossToRef(r,this._zAxis,this._xAxis),0===this._xAxis.lengthSquared()?this._xAxis.x=1:this._xAxis.normalize(),s.CrossToRef(this._zAxis,this._xAxis,this._yAxis),this._yAxis.normalize();var e=-s.Dot(this._xAxis,i),h=-s.Dot(this._yAxis,i),a=-s.Dot(this._zAxis,i);return t.FromValuesToRef(this._xAxis.x,this._yAxis.x,this._zAxis.x,0,this._xAxis.y,this._yAxis.y,this._zAxis.y,0,this._xAxis.z,this._yAxis.z,this._zAxis.z,0,e,h,a,1,o)},t.OrthoLH=function(i,n,r,o){var s=t.Zero();return t.OrthoLHToRef(i,n,r,o,s),s},t.OrthoLHToRef=function(i,n,r,o,s){var e=2/i,h=2/n,a=1/(o-r),u=r/(r-o);t.FromValuesToRef(e,0,0,0,0,h,0,0,0,0,a,0,0,0,u,1,s)},t.OrthoOffCenterLH=function(i,n,r,o,s,e){var h=t.Zero();return t.OrthoOffCenterLHToRef(i,n,r,o,s,e,h),h},t.OrthoOffCenterLHToRef=function(t,i,n,r,o,s,e){e.m[0]=2/(i-t),e.m[1]=e.m[2]=e.m[3]=0,e.m[5]=2/(r-n),e.m[4]=e.m[6]=e.m[7]=0,e.m[10]=-1/(o-s),e.m[8]=e.m[9]=e.m[11]=0,e.m[12]=(t+i)/(t-i),e.m[13]=(r+n)/(n-r),e.m[14]=o/(o-s),e.m[15]=1},t.PerspectiveLH=function(i,n,r,o){var s=t.Zero();return s.m[0]=2*r/i,s.m[1]=s.m[2]=s.m[3]=0,s.m[5]=2*r/n,s.m[4]=s.m[6]=s.m[7]=0,s.m[10]=-o/(r-o),s.m[8]=s.m[9]=0,s.m[11]=1,s.m[12]=s.m[13]=s.m[15]=0,s.m[14]=r*o/(r-o),s},t.PerspectiveFovLH=function(i,n,r,o){var s=t.Zero();return t.PerspectiveFovLHToRef(i,n,r,o,s),s},t.PerspectiveFovLHToRef=function(t,i,n,r,o,s){void 0===s&&(s=!0);var e=1/Math.tan(.5*t);s?o.m[0]=e/i:o.m[0]=e,o.m[1]=o.m[2]=o.m[3]=0,s?o.m[5]=e:o.m[5]=e*i,o.m[4]=o.m[6]=o.m[7]=0,o.m[8]=o.m[9]=0,o.m[10]=-r/(n-r),o.m[11]=1,o.m[12]=o.m[13]=o.m[15]=0,o.m[14]=n*r/(n-r)},t.GetFinalMatrix=function(i,n,r,o,s,e){var h=i.width,a=i.height,u=i.x,m=i.y,y=t.FromValues(h/2,0,0,0,0,-a/2,0,0,0,0,e-s,0,u+h/2,a/2+m,s,1);return n.multiply(r).multiply(o).multiply(y)},t.GetAsMatrix2x2=function(t){return new Float32Array([t.m[0],t.m[1],t.m[4],t.m[5]])},t.GetAsMatrix3x3=function(t){return new Float32Array([t.m[0],t.m[1],t.m[2],t.m[4],t.m[5],t.m[6],t.m[8],t.m[9],t.m[10]])},t.Transpose=function(i){var n=new t;return n.m[0]=i.m[0],n.m[1]=i.m[4],n.m[2]=i.m[8],n.m[3]=i.m[12],n.m[4]=i.m[1],n.m[5]=i.m[5],n.m[6]=i.m[9],n.m[7]=i.m[13],n.m[8]=i.m[2],n.m[9]=i.m[6],n.m[10]=i.m[10],n.m[11]=i.m[14],n.m[12]=i.m[3],n.m[13]=i.m[7],n.m[14]=i.m[11],n.m[15]=i.m[15],n},t.Reflection=function(i){var n=new t;return t.ReflectionToRef(i,n),n},t.ReflectionToRef=function(t,i){t.normalize();var n=t.normal.x,r=t.normal.y,o=t.normal.z,s=-2*n,e=-2*r,h=-2*o;i.m[0]=s*n+1,i.m[1]=e*n,i.m[2]=h*n,i.m[3]=0,i.m[4]=s*r,i.m[5]=e*r+1,i.m[6]=h*r,i.m[7]=0,i.m[8]=s*o,i.m[9]=e*o,i.m[10]=h*o+1,i.m[11]=0,i.m[12]=s*t.d,i.m[13]=e*t.d,i.m[14]=h*t.d,i.m[15]=1},t._tempQuaternion=new a,t._xAxis=s.Zero(),t._yAxis=s.Zero(),t._zAxis=s.Zero(),t}();t.Matrix=u;var m=function(){function t(t,i,n,r){this.normal=new s(t,i,n),this.d=r}return t.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},t.prototype.clone=function(){return new t(this.normal.x,this.normal.y,this.normal.z,this.d)},t.prototype.getClassName=function(){return"Plane"},t.prototype.getHashCode=function(){var t=this.normal.getHashCode();return t=397*t^(this.d||0)},t.prototype.normalize=function(){var t=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),i=0;return 0!==t&&(i=1/t),this.normal.x*=i,this.normal.y*=i,this.normal.z*=i,this.d*=i,this},t.prototype.transform=function(i){var n=u.Transpose(i),r=this.normal.x,o=this.normal.y,s=this.normal.z,e=this.d,h=r*n.m[0]+o*n.m[1]+s*n.m[2]+e*n.m[3],a=r*n.m[4]+o*n.m[5]+s*n.m[6]+e*n.m[7],m=r*n.m[8]+o*n.m[9]+s*n.m[10]+e*n.m[11],y=r*n.m[12]+o*n.m[13]+s*n.m[14]+e*n.m[15];return new t(h,a,m,y)},t.prototype.dotCoordinate=function(t){return this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.d},t.prototype.copyFromPoints=function(t,i,n){var r,o=i.x-t.x,s=i.y-t.y,e=i.z-t.z,h=n.x-t.x,a=n.y-t.y,u=n.z-t.z,m=s*u-e*a,y=e*h-o*u,c=o*a-s*h,p=Math.sqrt(m*m+y*y+c*c);return r=0!==p?1/p:0,this.normal.x=m*r,this.normal.y=y*r,this.normal.z=c*r,this.d=-(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z),this},t.prototype.isFrontFacingTo=function(t,i){var n=s.Dot(this.normal,t);return i>=n},t.prototype.signedDistanceTo=function(t){return s.Dot(t,this.normal)+this.d},t.FromArray=function(i){return new t(i[0],i[1],i[2],i[3])},t.FromPoints=function(i,n,r){var o=new t(0,0,0,0);return o.copyFromPoints(i,n,r),o},t.FromPositionAndNormal=function(i,n){var r=new t(0,0,0,0);return n.normalize(),r.normal=n,r.d=-(n.x*i.x+n.y*i.y+n.z*i.z),r},t.SignedDistanceToPlaneFromPositionAndNormal=function(t,i,n){var r=-(i.x*t.x+i.y*t.y+i.z*t.z);return s.Dot(n,i)+r},t}();t.Plane=m;var y=function(){function t(t,i,n,r){this.x=t,this.y=i,this.width=n,this.height=r}return t.prototype.toGlobal=function(i,n){return new t(this.x*i,this.y*n,this.width*i,this.height*n)},t}();t.Viewport=y;var c=function(){function t(){}return t.GetPlanes=function(i){for(var n=[],r=0;6>r;r++)n.push(new m(0,0,0,0));return t.GetPlanesToRef(i,n),n},t.GetPlanesToRef=function(t,i){i[0].normal.x=t.m[3]+t.m[2],i[0].normal.y=t.m[7]+t.m[6],i[0].normal.z=t.m[11]+t.m[10],i[0].d=t.m[15]+t.m[14],i[0].normalize(),i[1].normal.x=t.m[3]-t.m[2],i[1].normal.y=t.m[7]-t.m[6],i[1].normal.z=t.m[11]-t.m[10],i[1].d=t.m[15]-t.m[14],i[1].normalize(),i[2].normal.x=t.m[3]+t.m[0],i[2].normal.y=t.m[7]+t.m[4],i[2].normal.z=t.m[11]+t.m[8],i[2].d=t.m[15]+t.m[12],i[2].normalize(),i[3].normal.x=t.m[3]-t.m[0],i[3].normal.y=t.m[7]-t.m[4],i[3].normal.z=t.m[11]-t.m[8],i[3].d=t.m[15]-t.m[12],i[3].normalize(),i[4].normal.x=t.m[3]-t.m[1],i[4].normal.y=t.m[7]-t.m[5],i[4].normal.z=t.m[11]-t.m[9],i[4].d=t.m[15]-t.m[13],i[4].normalize(),i[5].normal.x=t.m[3]+t.m[1],i[5].normal.y=t.m[7]+t.m[5],i[5].normal.z=t.m[11]+t.m[9],i[5].d=t.m[15]+t.m[13],i[5].normalize()},t}();t.Frustum=c,function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(t.Space||(t.Space={}));var p=(t.Space,function(){function t(){}return t.X=new s(1,0,0),t.Y=new s(0,1,0),t.Z=new s(0,0,1),t}());t.Axis=p;var f=function(){function t(){}return t.interpolate=function(t,i,n,r,o){for(var s=1-3*r+3*i,e=3*r-6*i,h=3*i,a=t,u=0;5>u;u++){var m=a*a,y=m*a,c=s*y+e*m+h*a,p=1/(3*s*m+2*e*a+h);a-=(c-t)*p,a=Math.min(1,Math.max(0,a))}return 3*Math.pow(1-a,2)*a*n+3*(1-a)*Math.pow(a,2)*o+Math.pow(a,3)},t}();t.BezierCurve=f,function(t){t[t.CW=0]="CW",t[t.CCW=1]="CCW"}(t.Orientation||(t.Orientation={}));var l=t.Orientation,x=function(){function t(t){var i=this;this.degrees=function(){return 180*i._radians/Math.PI},this.radians=function(){return i._radians},this._radians=t,this._radians<0&&(this._radians+=2*Math.PI)}return t.BetweenTwoPoints=function(i,n){var r=n.subtract(i),o=Math.atan2(r.y,r.x);return new t(o)},t.FromRadians=function(i){return new t(i)},t.FromDegrees=function(i){return new t(i*Math.PI/180)},t}();t.Angle=x;var z=function(){function t(t,i,n){this.startPoint=t,this.midPoint=i,this.endPoint=n;var r=Math.pow(i.x,2)+Math.pow(i.y,2),s=(Math.pow(t.x,2)+Math.pow(t.y,2)-r)/2,e=(r-Math.pow(n.x,2)-Math.pow(n.y,2))/2,h=(t.x-i.x)*(i.y-n.y)-(i.x-n.x)*(t.y-i.y);this.centerPoint=new o((s*(i.y-n.y)-e*(t.y-i.y))/h,((t.x-i.x)*e-(i.x-n.x)*s)/h),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=x.BetweenTwoPoints(this.centerPoint,this.startPoint);var a=this.startAngle.degrees(),u=x.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),m=x.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();u-a>180&&(u-=360),-180>u-a&&(u+=360),m-u>180&&(m-=360),-180>m-u&&(m+=360),this.orientation=0>u-a?l.CW:l.CCW,this.angle=x.FromDegrees(this.orientation===l.CW?a-m:m-a)}return t}();t.Arc2=z;var w=function(){function t(t,i){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new o(t,i))}return t.prototype.addLineTo=function(t,i){if(closed)return this;var n=new o(t,i),r=this._points[this._points.length-1];return this._points.push(n),this._length+=n.subtract(r).length(),this},t.prototype.addArcTo=function(t,i,n,r,s){if(void 0===s&&(s=36),closed)return this;var e=this._points[this._points.length-1],h=new o(t,i),a=new o(n,r),u=new z(e,h,a),m=u.angle.radians()/s;u.orientation===l.CW&&(m*=-1);for(var y=u.startAngle.radians()+m,c=0;s>c;c++){var p=Math.cos(y)*u.radius+u.centerPoint.x,f=Math.sin(y)*u.radius+u.centerPoint.y;this.addLineTo(p,f),y+=m}return this},t.prototype.close=function(){return this.closed=!0,this},t.prototype.length=function(){var t=this._length;if(!this.closed){var i=this._points[this._points.length-1],n=this._points[0];t+=n.subtract(i).length()}return t},t.prototype.getPoints=function(){return this._points},t.prototype.getPointAtLengthPosition=function(t){if(0>t||t>1)return o.Zero();for(var i=t*this.length(),n=0,r=0;r<this._points.length;r++){var s=(r+1)%this._points.length,e=this._points[r],h=this._points[s],a=h.subtract(e),u=a.length()+n;if(i>=n&&u>=i){var m=a.normalize(),y=i-n;return new o(e.x+m.x*y,e.y+m.y*y)}n=u}return o.Zero()},t.StartingAt=function(i,n){return new t(i,n)},t}();t.Path2=w;var v=function(){function n(t,i,n){this.path=t,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(var r=0;r<t.length;r++)this._curve[r]=t[r].clone();this._raw=n||!1,this._compute(i)}return n.prototype.getCurve=function(){return this._curve},n.prototype.getTangents=function(){return this._tangents},n.prototype.getNormals=function(){return this._normals},n.prototype.getBinormals=function(){return this._binormals},n.prototype.getDistances=function(){return this._distances},n.prototype.update=function(t,i){for(var n=0;n<t.length;n++)this._curve[n].x=t[n].x,this._curve[n].y=t[n].y,this._curve[n].z=t[n].z;return this._compute(i),this},n.prototype._compute=function(t){var i=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[i-1]=this._curve[i-1].subtract(this._curve[i-2]),this._raw||this._tangents[i-1].normalize();var n=this._tangents[0],r=this._normalVector(this._curve[0],n,t);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=s.Cross(n,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,e,h,a,u=1;i>u;u++)o=this._getLastNonNullVector(u),i-1>u&&(e=this._getFirstNonNullVector(u),this._tangents[u]=o.add(e),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+o.length(),h=this._tangents[u],a=this._binormals[u-1],this._normals[u]=s.Cross(a,h),this._raw||this._normals[u].normalize(),this._binormals[u]=s.Cross(h,this._normals[u]),this._raw||this._binormals[u].normalize()},n.prototype._getFirstNonNullVector=function(t){for(var i=1,n=this._curve[t+i].subtract(this._curve[t]);0===n.length()&&t+i+1<this._curve.length;)i++,n=this._curve[t+i].subtract(this._curve[t]);return n},n.prototype._getLastNonNullVector=function(t){for(var i=1,n=this._curve[t].subtract(this._curve[t-i]);0===n.length()&&t>i+1;)i++,n=this._curve[t].subtract(this._curve[t-i]);return n},n.prototype._normalVector=function(n,r,o){var e;if(void 0===o||null===o){var h;i.WithinEpsilon(r.y,1,t.Epsilon)?i.WithinEpsilon(r.x,1,t.Epsilon)?i.WithinEpsilon(r.z,1,t.Epsilon)||(h=new s(0,0,1)):h=new s(1,0,0):h=new s(0,-1,0),e=s.Cross(r,h)}else e=s.Cross(r,o),s.CrossToRef(e,r,e);return e.normalize(),e},n}();t.Path3D=v;var d=function(){function t(t){this._length=0,this._points=t,this._length=this._computeLength(t)}return t.CreateQuadraticBezier=function(i,n,r,o){o=o>2?o:3;for(var e=new Array,h=function(t,i,n,r){var o=(1-t)*(1-t)*i+2*t*(1-t)*n+t*t*r;return o},a=0;o>=a;a++)e.push(new s(h(a/o,i.x,n.x,r.x),h(a/o,i.y,n.y,r.y),h(a/o,i.z,n.z,r.z)));return new t(e)},t.CreateCubicBezier=function(i,n,r,o,e){e=e>3?e:4;for(var h=new Array,a=function(t,i,n,r,o){var s=(1-t)*(1-t)*(1-t)*i+3*t*(1-t)*(1-t)*n+3*t*t*(1-t)*r+t*t*t*o;return s},u=0;e>=u;u++)h.push(new s(a(u/e,i.x,n.x,r.x,o.x),a(u/e,i.y,n.y,r.y,o.y),a(u/e,i.z,n.z,r.z,o.z)));return new t(h)},t.CreateHermiteSpline=function(i,n,r,o,e){for(var h=new Array,a=1/e,u=0;e>=u;u++)h.push(s.Hermite(i,n,r,o,u*a));return new t(h)},t.prototype.getPoints=function(){return this._points},t.prototype.length=function(){return this._length},t.prototype["continue"]=function(i){for(var n=this._points[this._points.length-1],r=this._points.slice(),o=i.getPoints(),s=1;s<o.length;s++)r.push(o[s].subtract(o[0]).add(n));var e=new t(r);return e},t.prototype._computeLength=function(t){for(var i=0,n=1;n<t.length;n++)i+=t[n].subtract(t[n-1]).length();return i},t}();t.Curve3=d;var g=function(){function t(){this.L00=s.Zero(),this.L1_1=s.Zero(),this.L10=s.Zero(),this.L11=s.Zero(),this.L2_2=s.Zero(),this.L2_1=s.Zero(),this.L20=s.Zero(),this.L21=s.Zero(),this.L22=s.Zero()}return t.prototype.addLight=function(t,i,n){var r=new s(i.r,i.g,i.b),o=r.scale(n);this.L00=this.L00.add(o.scale(.282095)),this.L1_1=this.L1_1.add(o.scale(.488603*t.y)),this.L10=this.L10.add(o.scale(.488603*t.z)),this.L11=this.L11.add(o.scale(.488603*t.x)),this.L2_2=this.L2_2.add(o.scale(1.092548*t.x*t.y)),this.L2_1=this.L2_1.add(o.scale(1.092548*t.y*t.z)),this.L21=this.L21.add(o.scale(1.092548*t.x*t.z)),this.L20=this.L20.add(o.scale(.315392*(3*t.z*t.z-1))),this.L22=this.L22.add(o.scale(.546274*(t.x*t.x-t.y*t.y)))},t.prototype.scale=function(t){this.L00=this.L00.scale(t),this.L1_1=this.L1_1.scale(t),this.L10=this.L10.scale(t),this.L11=this.L11.scale(t),this.L2_2=this.L2_2.scale(t),this.L2_1=this.L2_1.scale(t),this.L20=this.L20.scale(t),this.L21=this.L21.scale(t),this.L22=this.L22.scale(t)},t}();t.SphericalHarmonics=g;var T=function(){function t(){this.x=s.Zero(),this.y=s.Zero(),this.z=s.Zero(),this.xx=s.Zero(),this.yy=s.Zero(),this.zz=s.Zero(),this.xy=s.Zero(),this.yz=s.Zero(),this.zx=s.Zero()}return t.prototype.addAmbient=function(t){var i=new s(t.r,t.g,t.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},t.getSphericalPolynomialFromHarmonics=function(i){var n=new t;return n.x=i.L11.scale(1.02333),n.y=i.L1_1.scale(1.02333),n.z=i.L10.scale(1.02333),n.xx=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).add(i.L22.scale(.429043)),n.yy=i.L00.scale(.886277).subtract(i.L20.scale(.247708)).subtract(i.L22.scale(.429043)),n.zz=i.L00.scale(.886277).add(i.L20.scale(.495417)),n.yz=i.L2_1.scale(.858086),n.zx=i.L21.scale(.858086),n.xy=i.L2_2.scale(.858086),n},t}();t.SphericalPolynomial=T;var R=function(){function t(t,i){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),this.position=t,this.normal=i}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone())},t}();t.PositionNormalVertex=R;var _=function(){function t(t,i,n){void 0===t&&(t=s.Zero()),void 0===i&&(i=s.Up()),void 0===n&&(n=o.Zero()),this.position=t,this.normal=i,this.uv=n}return t.prototype.clone=function(){return new t(this.position.clone(),this.normal.clone(),this.uv.clone())},t}();t.PositionNormalTextureVertex=_;var M=function(){function t(){}return t.Color3=[n.Black(),n.Black(),n.Black()],t.Vector2=[o.Zero(),o.Zero(),o.Zero()],t.Vector3=[s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero(),s.Zero()],t.Vector4=[e.Zero(),e.Zero(),e.Zero()],t.Quaternion=[new a(0,0,0,0)],t.Matrix=[u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero(),u.Zero()],t}();t.Tmp=M}(BABYLON||(BABYLON={}));',
("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=BABYLON);var BABYLON;!function(e){var t=function(){function t(){this.materials=[],this.parseMTL=function(i,n,r){for(var o,s,a=n.split("\n"),h=/\s+/,l=0;l<a.length;l++){var c=a[l].trim();if(0!==c.length&&"#"!==c.charAt(0)){var u=c.indexOf(" "),d=u>=0?c.substring(0,u):c;d=d.toLowerCase();var f=u>=0?c.substring(u+1).trim():"";"newmtl"===d?(s&&this.materials.push(s),s=new e.StandardMaterial(f,i)):"kd"===d?(o=f.split(h,3),s.diffuseColor=e.Color3.FromArray(o)):"ka"===d?(o=f.split(h,3),s.ambientColor=e.Color3.FromArray(o)):"ks"===d?(o=f.split(h,3),s.specularColor=e.Color3.FromArray(o)):"ns"===d?s.specularPower=f:"d"===d?s.alpha=f:"map_ka"===d?s.ambientTexture=t._getTexture(r,f,i):"map_kd"===d?s.diffuseTexture=t._getTexture(r,f,i):"map_ks"===d?s.specularTexture=t._getTexture(r,f,i):"map_ns"===d||("map_bump"===d?s.bumpTexture=t._getTexture(r,f,i):"map_d"===d&&(s.opacityTexture=t._getTexture(r,f,i)))}}this.materials.push(s)}}return t._getTexture=function(t,i,n){var r=t;if("file:"===t){var o=i.lastIndexOf("\\");o===-1&&(o=i.lastIndexOf("/")),r+=o>-1?i.substr(o+1):i}else r+=i;return new e.Texture(r,n)},t}();e.MTLFileLoader=t;var i=function(){function i(){this.extensions=".obj",this.obj=/^o/,this.group=/^g/,this.mtllib=/^mtllib /,this.usemtl=/^usemtl /,this.smooth=/^s /,this.vertexPattern=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.normalPattern=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.uvPattern=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,this.facePattern1=/f\s+(([\d]{1,}[\s]?){3,})+/,this.facePattern2=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern3=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,this.facePattern4=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/}return i.prototype._loadMTL=function(t,i,n){var r=e.Tools.BaseUrl+i+t;e.Tools.LoadFile(r,n,null,null,!1,function(){console.warn("Error - Unable to load "+r)},!0)},i.prototype.importMesh=function(e,t,i,n,r,o,s){var a=this._parseSolid(e,t,i,n);return r&&a.forEach(function(e){r.push(e)}),!0},i.prototype.load=function(e,t,i){return this.importMesh(null,e,t,i,null,null,null)},i.prototype._parseSolid=function(n,r,o,s){for(var a,h=[],l=[],c=[],u=[],d=[],f=[],p=[],_=[],m=[],g=0,v=!1,y=[],b=[],x=[],P=[],A="",C="",E=new t,T="",S=1,M=!0,I=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});var i=e[t[0]].normals.indexOf(t[1]);return i===-1?-1:e[t[0]].idx[i]},w=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});var i=e[t[0]].normals.indexOf(t[1]);return 1!=i&&t[2]==e[t[0]].uv[i]?e[t[0]].idx[i]:-1},R=function(e,t,n,r,o,s){var a;a=i.OPTIMIZE_WITH_UV?w(m,[e,n,t]):I(m,[e,n]),a==-1?(d.push(f.length),f.push(r),p.push(o),_.push(s),m[e].normals.push(n),m[e].idx.push(g++),i.OPTIMIZE_WITH_UV&&m[e].uv.push(t)):d.push(a)},D=function(){for(var e=0;e<f.length;e++)y.push(f[e].x,f[e].y,f[e].z),b.push(_[e].x,_[e].y,_[e].z),x.push(p[e].x,p[e].y);f=[],_=[],p=[],m=[],g=0},O=function(e,t){t+1<e.length&&(P.push(e[0],e[t],e[t+1]),t+=1,O(e,t))},L=function(t,i){O(t,i);for(var n=0;n<P.length;n++){var r=parseInt(P[n])-1;R(r,0,0,h[r],e.Vector2.Zero(),e.Vector3.Up())}P=[]},B=function(t,i){O(t,i);for(var n=0;n<P.length;n++){var r=P[n].split("/"),o=parseInt(r[0])-1,s=parseInt(r[1])-1;R(o,s,0,h[o],c[s],e.Vector3.Up())}P=[]},N=function(e,t){O(e,t);for(var i=0;i<P.length;i++){var n=P[i].split("/"),r=parseInt(n[0])-1,o=parseInt(n[1])-1,s=parseInt(n[2])-1;R(r,o,s,h[r],c[o],l[s])}P=[]},F=function(t,i){O(t,i);for(var n=0;n<P.length;n++){var r=P[n].split("//"),o=parseInt(r[0])-1,s=parseInt(r[1])-1;R(o,1,s,h[o],e.Vector2.Zero(),l[s])}P=[]},V=function(){u.length>0&&(a=u[u.length-1],D(),d.reverse(),a.indices=d.slice(),a.positions=y.slice(),a.normals=b.slice(),a.uvs=x.slice(),d=[],y=[],b=[],x=[])},k=o.split("\n"),z=0;z<k.length;z++){var U,G=k[z].trim();if(0!==G.length&&"#"!==G.charAt(0))if(null!==(U=this.vertexPattern.exec(G)))h.push(new e.Vector3(parseFloat(U[1]),parseFloat(U[2]),parseFloat(U[3])));else if(null!==(U=this.normalPattern.exec(G)))l.push(new e.Vector3(parseFloat(U[1]),parseFloat(U[2]),parseFloat(U[3])));else if(null!==(U=this.uvPattern.exec(G)))c.push(new e.Vector2(parseFloat(U[1]),parseFloat(U[2])));else if(null!==(U=this.facePattern3.exec(G)))N(U[1].trim().split(" "),1);else if(null!==(U=this.facePattern4.exec(G)))F(U[1].trim().split(" "),1);else if(null!==(U=this.facePattern2.exec(G)))B(U[1].trim().split(" "),1);else if(null!==(U=this.facePattern1.exec(G)))L(U[1].trim().split(" "),1);else if(this.group.test(G)||this.obj.test(G)){var j={name:G.substring(2).trim(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,materialName:""};V(),u.push(j),v=!0,M=!0,S=1}else if(this.usemtl.test(G)){if(A=G.substring(7).trim(),!M){V();var j={name:T+"_mm"+S.toString(),indices:void 0,positions:void 0,normals:void 0,uvs:void 0,materialName:A};S++,u.push(j)}v&&M&&(u[u.length-1].materialName=A,M=!1)}else this.mtllib.test(G)?C=G.substring(7).trim():this.smooth.test(G)||console.log("Unhandled expression at line : "+G)}v&&(a=u[u.length-1],d.reverse(),D(),a.indices=d,a.positions=y,a.normals=b,a.uvs=x),v||(d.reverse(),D(),u.push({name:e.Geometry.RandomId(),indices:d,positions:y,normals:b,uvs:x,materialName:A}));for(var W=[],H=[],Y=0;Y<u.length;Y++){if(n&&u[Y].name)if(n instanceof Array){if(n.indexOf(u[Y].name)==-1)continue}else if(u[Y].name!==n)continue;a=u[Y];var K=new e.Mesh(u[Y].name,r);H.push(u[Y].materialName);var X=new e.VertexData;X.positions=a.positions,X.normals=a.normals,X.uvs=a.uvs,X.indices=a.indices,X.applyToMesh(K),W.push(K)}return""!==C&&this._loadMTL(C,s,function(e){E.parseMTL(r,e,s);for(var t=0;t<E.materials.length;t++){for(var i,n=0,o=[];(i=H.indexOf(E.materials[t].name,n))>-1;)o.push(i),n=i+1;if(i==-1&&0==o.length)E.materials[t].dispose();else for(var a=0;a<o.length;a++)W[o[a]].material=E.materials[t]}}),W},i.OPTIMIZE_WITH_UV=!1,i}();e.OBJFileLoader=i,e.SceneLoader.RegisterPlugin(new i)}(BABYLON||(BABYLON={}));
//# sourceMappingURL=out.js.map
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function compareId(e,t){return e.id.localeCompare(t.id)}var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,p=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(p=(i<3?n(p):i>3?n(t,r,p):n(t,r))||p);return i>3&&p&&Object.defineProperty(t,r,p),p},AnimateSelector=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.recompute=function(){var e=[];for(var t in this.db.ships)e.push({id:t,name:this.db.names[t].name});e.sort(compareId),this.ships=e;var r=[];for(var t in this.db.stations)r.push({id:t,name:this.db.names[t].name});r.sort(compareId),this.stations=r},t}(polymer.Base);__decorate([property({type:Object})],AnimateSelector.prototype,"db",void 0),__decorate([property({type:Array})],AnimateSelector.prototype,"ships",void 0),__decorate([property({type:Array})],AnimateSelector.prototype,"stations",void 0),__decorate([property({type:String,notify:!0})],AnimateSelector.prototype,"selectedId",void 0),__decorate([observe("db.ships.*,db.stations.*,db.names.*")],AnimateSelector.prototype,"recompute",null),AnimateSelector=__decorate([component("animate-selector")],AnimateSelector),AnimateSelector.register();
},{}],2:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var s,n=arguments.length,p=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(p=(n<3?s(p):n>3?s(t,o,p):s(t,o))||p);return n>3&&p&&Object.defineProperty(t,o,p),p},AssetPack=function(e){function t(){var t=e.apply(this,arguments)||this;return t.modelPromises={},t}return __extends(t,e),t.prototype.computeBaseUrl=function(e){return this.urlDir(e)},t.prototype.computeShips=function(e){return e.ships},t.prototype.response=function(){this.loaded=!0},t.prototype.urlDir=function(e){return e.substring(0,Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\")))+"/"},t.prototype.urlBase=function(e){return e.substring(e.lastIndexOf("/")+1)},t.prototype.loadShip=function(e){return this.loadModel(this.baseURL+e.model).then(function(t){var o=e.scale?e.scale:1;return t.scaling.x=o,t.scaling.y=o,t.scaling.z=o,t})},t.prototype.loadModel=function(e){var t=this;if(this.modelPromises[e])return this.modelPromises[e];var o=new Promise(function(o,r){var s=t.urlDir(e),n=t.urlBase(e);BABYLON.SceneLoader.ImportMesh("",s,n,t.scene,function(r,s,n){var p=new BABYLON.Mesh(e,t.scene);p.setEnabled(!1);for(var c=0,a=r;c<a.length;c++){var i=a[c];i.parent=p}o(p)},null,function(e,t,o){r(t)})});return this.modelPromises[e]=o,o},t}(polymer.Base);__decorate([property({type:String})],AssetPack.prototype,"manifest",void 0),__decorate([property({type:Object})],AssetPack.prototype,"manifestBody",void 0),__decorate([property({type:Object})],AssetPack.prototype,"scene",void 0),__decorate([property({type:Boolean,notify:!0,value:!1})],AssetPack.prototype,"loaded",void 0),__decorate([property({computed:"computeBaseUrl(manifest)"})],AssetPack.prototype,"baseURL",void 0),__decorate([property({type:Object,computed:"computeShips(manifestBody)"})],AssetPack.prototype,"ships",void 0),AssetPack=__decorate([component("asset-pack")],AssetPack),exports.AssetPack=AssetPack,AssetPack.register();
},{}],3:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,i){var o,n=arguments.length,c=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,i);else for(var d=e.length-1;d>=0;d--)(o=e[d])&&(c=(n<3?o(c):n>3?o(t,r,c):o(t,r))||c);return n>3&&c&&Object.defineProperty(t,r,c),c},BridgeSimCard=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t}(polymer.Base);BridgeSimCard=__decorate([component("bridgesim-card")],BridgeSimCard),exports.BridgeSimCard=BridgeSimCard,BridgeSimCard.register();
},{}],4:[function(require,module,exports){
"use strict";function pad(t){return("0"+t).substr(-2)}var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__decorate=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,p=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(p=(i<3?r(p):i>3?r(e,o,p):r(e,o))||p);return i>3&&p&&Object.defineProperty(e,o,p),p},TOGGLE_KEY=192,Chat=function(t){function e(){var e=t.apply(this,arguments)||this;return e.text="",e}return __extends(e,t),e.prototype.ready=function(){this.log=[],this.listen(window,"keydown","open")},e.prototype.detached=function(){this.unlisten(window,"keydown","open")},e.prototype.send=function(){this.text.trim()&&(this.fire("net-send",{sendChat:{text:this.text}}),this.text="")},e.prototype.receiveMsg=function(t){this.unshift("log",t)},e.prototype.open=function(t){this.noInput||t.keyCode===TOGGLE_KEY&&(this.toggle(),t.preventDefault(),t.stopPropagation())},e.prototype.swallowOrClose=function(t){this.noInput||(t.keyCode!==TOGGLE_KEY||t.repeat||(this.toggle(),t.preventDefault()),t.stopPropagation())},e.prototype.toggle=function(){this.hidden=!this.hidden,this.hidden||this.$.input.focus()},e.prototype.formatTimestamp=function(t){var e=new Date(t);return pad(e.getHours())+":"+pad(e.getMinutes())+":"+pad(e.getSeconds())},e}(polymer.Base);__decorate([property({type:Boolean,value:!1})],Chat.prototype,"noInput",void 0),__decorate([listen("keydown")],Chat.prototype,"swallowOrClose",null),Chat=__decorate([component("bridgesim-chat")],Chat),exports.Chat=Chat,Chat.register();
},{}],5:[function(require,module,exports){
"use strict";exports.AQUA="#7FDBFF",exports.BLUE="#0074D9",exports.GREEN="#1AE071",exports.RED="#FF4136",exports.WHITE="#FFF",exports.YELLOW="#FFE200";
},{}],6:[function(require,module,exports){
"use strict";exports.HP=.5,exports.CANVAS_FONT="12px Share Tech Mono, monospace";
},{}],7:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,o){var i,n=arguments.length,s=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(s=(n<3?i(s):n>3?i(e,r,s):i(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s},util_1=require("../core/util"),UPDATE_INTERVAL=1e3/3,DRAW_WINDOW=2e3,RECV_WINDOW=3e3,DebugMetrics=function(t){function e(){var e=t.apply(this,arguments)||this;return e.drawPoints=[],e.recvPoints=[],e}return __extends(e,t),e.prototype.attached=function(){this.update()},e.prototype.detached=function(){this.cancelAsync(this.handle)},e.prototype.draw=function(t,e){this.drawPoints.push({ts:t,val:1e3/e})},e.prototype.recv=function(t){this.recvPoints.push({ts:performance.now(),val:t})},e.prototype.update=function(){this.handle=this.async(this.update,UPDATE_INTERVAL);var t=performance.now();this.prune(this.drawPoints,t-DRAW_WINDOW),this.drawRate=this.avg(this.drawPoints).toFixed(1),this.prune(this.recvPoints,t-RECV_WINDOW);var e=0;this.recvPoints.length&&(e=this.sum(this.recvPoints)/this.timespan(this.recvPoints)*1e3);var r=util_1.numberToSI(e),o=r.n,i=r.prefix;this.recvRate=o.toFixed(1),this.recvRatePrefix=i},e.prototype.prune=function(t,e){for(;t.length&&t[0].ts<e;)t.shift()},e.prototype.avg=function(t){return 0===t.length?0:this.sum(t)/t.length},e.prototype.sum=function(t){for(var e=0,r=0,o=t;r<o.length;r++){var i=o[r];e+=i.val}return e},e.prototype.timespan=function(t){return t.length?t[t.length-1].ts-t[0].ts:0},e}(polymer.Base);__decorate([property({type:String})],DebugMetrics.prototype,"drawRate",void 0),__decorate([property({type:String})],DebugMetrics.prototype,"recvRate",void 0),__decorate([property({type:String})],DebugMetrics.prototype,"recvRatePrefix",void 0),DebugMetrics=__decorate([component("debug-metrics")],DebugMetrics),exports.DebugMetrics=DebugMetrics,DebugMetrics.register();
},{"../core/util":65}],8:[function(require,module,exports){
var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var o in r)r.hasOwnProperty(o)&&(e[o]=r[o]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},__decorate=this&&this.__decorate||function(e,r,t,o){var n,c=arguments.length,i=c<3?r:null===o?o=Object.getOwnPropertyDescriptor(r,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,r,t,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(c<3?n(i):c>3?n(r,t,i):n(r,t))||i);return c>3&&i&&Object.defineProperty(r,t,i),i},ErrorScreen=function(e){function r(){return e.apply(this,arguments)||this}return __extends(r,e),r.prototype.home=function(){this.fire("show-welcome")},r}(polymer.Base);ErrorScreen=__decorate([component("bridgesim-error-screen")],ErrorScreen),ErrorScreen.register();
},{}],9:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var p in e)e.hasOwnProperty(p)&&(t[p]=e[p]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__decorate=this&&this.__decorate||function(t,e,o,p){var r,n=arguments.length,i=n<3?e:null===p?p=Object.getOwnPropertyDescriptor(e,o):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,p);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(i=(n<3?r(i):n>3?r(e,o,i):r(e,o))||i);return n>3&&i&&Object.defineProperty(e,o,i),i},Ftl=function(t){function e(){return t.apply(this,arguments)||this}return __extends(e,t),e.prototype.computeCanJump=function(t,e){return!!t&&!!e},e.prototype.computeContracted=function(t,e){return!t&&null==e},e.prototype.computeCountdown=function(t){return null!=t},e.prototype.spool=function(){this.fire("input",{spoolJump:{x:parseInt(this.x),y:parseInt(this.y)}})},e.prototype.toggle=function(){this.expanded=!this.expanded},e.prototype.abort=function(){this.fire("input",{abortJump:!0})},e.prototype.update=function(t,e){if(!t||!e)return void(this.eta=null);var o=this.db.ftl[t];o&&null!=o.eta?(this.expanded=!1,this.eta=o.eta<0?"IDLE":o.eta.toFixed()):this.eta=null},e}(polymer.Base);__decorate([property({type:Object})],Ftl.prototype,"db",void 0),__decorate([property({type:String})],Ftl.prototype,"shipId",void 0),__decorate([property({type:String,value:null})],Ftl.prototype,"x",void 0),__decorate([property({type:String,value:null})],Ftl.prototype,"y",void 0),__decorate([property({type:String,value:null})],Ftl.prototype,"eta",void 0),__decorate([property({type:Boolean,value:!1})],Ftl.prototype,"expanded",void 0),__decorate([property({type:Boolean,computed:"computeCanJump(x, y)"})],Ftl.prototype,"canJump",void 0),__decorate([property({type:Boolean,computed:"computeContracted(expanded, eta)"})],Ftl.prototype,"contracted",void 0),__decorate([property({type:Boolean,computed:"computeCountdown(eta)"})],Ftl.prototype,"countdown",void 0),__decorate([observe("shipId,db.ftl.*")],Ftl.prototype,"update",null),Ftl=__decorate([component("bridgesim-ftl")],Ftl),exports.Ftl=Ftl,Ftl.register();
},{}],10:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,n){var i,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(r<3?i(s):r>3?i(t,o,s):i(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s},client_1=require("../core/client"),conditioner_1=require("../net/conditioner"),Net=require("../net/message"),HOST_TIMEOUT=1e4,Game=function(e){function t(){var t=e.apply(this,arguments)||this;return t.prevTs=0,t}return __extends(t,e),t.prototype.ready=function(){console.log("game: ready")},t.prototype.detached=function(){this.disconnect()},t.prototype.disconnect=function(){console.log("game: disconnect"),this.cancelDebouncer("host-timeout"),cancelAnimationFrame(this.animationRequestId),this.client&&this.client.stop(),this.conn&&(this.conn.onClose=null,this.conn.close()),this.db=null,this.client=null,this.conn=null,this.conditioner=null,this.playerId=null,this.shipId=null,this.connected=!1,this.started=!1,this.hosting=!1,this.joining=!1,this.prevTs=0},t.prototype.urlHashChanged=function(e){var t=this;this.debounce("url-hash",function(){console.log("game: url hash:",e),t.connected&&t.disconnect(),e?"host"===e?(t.hosting=!0,t.scanLocal=!1,t.view="loading",t.loadingMsg="starting host",t.async(function(){var e=t.$$("#host");t.$$("#peerLocalstorage").takeOffer=e.onOffer.bind(e)})):"local"===e?(t.hosting=!1,t.scanLocal=!0,t.view="loading",t.loadingMsg="searching for local game"):"join"===e?(t.hosting=!1,t.scanLocal=!1,t.view="join"):(t.hosting=!1,t.scanLocal=!1,t.view="join",t.token=e,t.$.joinScreen.join()):(t.hosting=!1,t.scanLocal=!1,t.view="welcome")},1)},t.prototype.onUrlHashInert=function(e){this.urlHash=e.detail,this.cancelDebouncer("url-hash")},t.prototype.urlParamsChanged=function(e){e.station&&(this.forceStation={helm:Net.Station.Helm,comms:Net.Station.Comms,science:Net.Station.Science,weapons:Net.Station.Weapons,engineering:Net.Station.Engineering}[e.station]),null!=e.autostart&&(this.autoStart=!0),e.view&&(this.view=e.view),null!=e.nolerp&&this.set("settings.interpolate",!1),null!=e.metrics&&this.set("settings.showMetrics",!0)},t.prototype.onShowWelcome=function(){this.urlHash=""},t.prototype.computeShowJoin=function(){return!0},t.prototype.viewChanged=function(e){this.views=(t={},t[e]=!0,t);var t},t.prototype.fakeLatencyChanged=function(e){this.conditioner&&(this.conditioner.latency=e)},t.prototype.fakePacketLossChanged=function(e){this.conditioner&&(this.conditioner.packetLoss=e/100)},t.prototype.nameChanged=function(e){this.conn&&this.conn.send({updatePlayer:{name:e}},!0)},t.prototype.onLoading=function(e){this.loadingMsg=e.detail||"loading",this.view="loading"},t.prototype.onError=function(e){this.errorMsg=e.detail||"unknown error",this.view="error"},t.prototype.onConnection=function(e){var t=this;console.log("game: got connection"),this.conditioner=new conditioner_1.Conditioner(e.detail),this.conditioner.latency=this.settings.fakeLatency,this.conditioner.packetLoss=this.settings.fakePacketLoss,this.conn=this.conditioner,this.conn.onMessage=this.onMessage.bind(this),this.client=new client_1.Client(this.conn,this.$.input.process.bind(this.$.input)),this.conn.onClose=function(){t.view="error",t.errorMsg="host disconnected",t.disconnect()},console.log("game: sending hello"),this.conn.send({hello:{name:this.settings.name,forceStation:this.forceStation}},!0)},t.prototype.hostGame=function(){this.urlHash="host"},t.prototype.joinGame=function(){this.urlHash="join"},t.prototype.invitePlayer=function(){this.$.peerCopypaste.openHostDialog()},t.prototype.offer=function(e,t){this.$.peerCopypaste.handleOffer(e.Offer).then(function(e){t({Answer:e})})},t.prototype.onMessage=function(e,t,o){var n=this;this.settings.showMetrics&&this.$$("#metrics").recv(o),this.debounce("host-timeout",function(){console.log("game: host timed out after",HOST_TIMEOUT/1e3,"seconds"),n.view="error",n.errorMsg="host timed out",n.disconnect()},HOST_TIMEOUT),e.welcome?(console.log("game: got welcome",e.welcome.playerId),this.playerId=e.welcome.playerId,this.db=this.client.db,this.connected=!0,this.frame(0),this.hosting&&this.autoStart&&this.conn.send({updateSettings:{started:!0}},!0)):e.receiveChat&&this.$.chat.receiveMsg(e.receiveChat)},t.prototype.settingsChanged=function(){if(this.db){var e=this.db.findSettings();if(e){this.size=e.galaxySize,this.token=e.token,e.started?this.started||(this.started=!0,this.view=(t={},t[Net.Station.Helm]="helm",t[Net.Station.Comms]="comms",t[Net.Station.Science]="science",t[Net.Station.Weapons]="weapons",t[Net.Station.Engineering]="engineering",t)[this.db.players[this.playerId].station||Net.Station.Helm]):(this.started=!1,this.view="lobby");var t}}},t.prototype.onNetSend=function(e){this.conn.send(e.detail,!0)},t.prototype.applyInput=function(e){this.$.input.applyInput(e.detail,!1)},t.prototype.applyInputPersistent=function(e){this.$.input.applyInput(e.detail,!0)},t.prototype.notifyChanges=function(e){if(e.components){var t=0;for(var o in e.components)for(var n in e.components[o]){t++;for(var i in e.components[o][n])t++}if(t>500){console.log("game: big update",t);var r=this.db;return this.db=null,void(this.db=r)}for(var o in e.components)for(var n in e.components[o]){this.notifyPath("db."+o+"."+n,this.db[o][n]);for(var i in e.components[o][n])this.notifyPath("db."+o+"."+n+"."+i,this.db[o][n][i])}}},t.prototype.frame=function(e){this.animationRequestId=requestAnimationFrame(this.frame.bind(this));var t=e-this.prevTs;if(!(this.settings.frameLimit>0&&t<1e3/this.settings.frameLimit)){this.settings.showMetrics&&t>0&&this.$$("#metrics").draw(e,t);var o=this.client.update(e);this.settings.interpolate||(o=1);var n=this.db.changes();n&&this.notifyChanges(n),this.shipId=this.db.players[this.playerId].shipId;var i=this.$.views.selectedItem;i&&i.draw&&null!=this.shipId&&i.draw(o,o),this.shipId&&!this.db.ships[this.shipId]&&(this.view="gameOver"),this.prevTs=e}},t}(polymer.Base);__decorate([property({type:Boolean,value:!1})],Game.prototype,"hosting",void 0),__decorate([property({type:Boolean,value:!1})],Game.prototype,"joining",void 0),__decorate([property({type:Boolean,value:!1})],Game.prototype,"scanLocal",void 0),__decorate([property({type:Boolean,value:!1})],Game.prototype,"connected",void 0),__decorate([property({type:Boolean,value:!1})],Game.prototype,"started",void 0),__decorate([property({type:String,value:null})],Game.prototype,"token",void 0),__decorate([property({type:String,value:null})],Game.prototype,"errorMsg",void 0),__decorate([property({type:String,value:null})],Game.prototype,"loadingMsg",void 0),__decorate([property({type:String,value:null})],Game.prototype,"view",void 0),__decorate([property({type:String,value:null})],Game.prototype,"forceStation",void 0),__decorate([property({type:Boolean,value:!1})],Game.prototype,"autoStart",void 0),__decorate([property({type:Object,value:function(){return{}}})],Game.prototype,"views",void 0),__decorate([property({type:Number,value:1})],Game.prototype,"size",void 0),__decorate([property({type:Object,value:function(){return{interpolate:!0,fakeLatency:0,fakePacketLoss:0,frameLimit:0,name:null,showBoundingBoxes:!1,showQuadtree:!1,showPathfinding:!1,showMetrics:!1,showMotion:!1}}})],Game.prototype,"settings",void 0),__decorate([property({type:Object})],Game.prototype,"db",void 0),__decorate([property({type:String})],Game.prototype,"urlHash",void 0),__decorate([property({type:Object})],Game.prototype,"urlParams",void 0),__decorate([property({type:Boolean,value:!0})],Game.prototype,"serverHidden",void 0),__decorate([property({type:String})],Game.prototype,"playerId",void 0),__decorate([property({type:String})],Game.prototype,"shipId",void 0),__decorate([observe("urlHash")],Game.prototype,"urlHashChanged",null),__decorate([listen("url-hash-inert")],Game.prototype,"onUrlHashInert",null),__decorate([observe("urlParams")],Game.prototype,"urlParamsChanged",null),__decorate([listen("show-welcome")],Game.prototype,"onShowWelcome",null),__decorate([property({computed:"computeShowJoin(connecting, connected)"})],Game.prototype,"showJoin",void 0),__decorate([observe("view")],Game.prototype,"viewChanged",null),__decorate([observe("settings.fakeLatency")],Game.prototype,"fakeLatencyChanged",null),__decorate([observe("settings.fakePacketLoss")],Game.prototype,"fakePacketLossChanged",null),__decorate([observe("settings.name")],Game.prototype,"nameChanged",null),__decorate([listen("loading")],Game.prototype,"onLoading",null),__decorate([listen("error-screen")],Game.prototype,"onError",null),__decorate([listen("connection")],Game.prototype,"onConnection",null),__decorate([observe("db.settings.*")],Game.prototype,"settingsChanged",null),__decorate([listen("net-send")],Game.prototype,"onNetSend",null),__decorate([listen("input")],Game.prototype,"applyInput",null),__decorate([listen("input-persistent")],Game.prototype,"applyInputPersistent",null),Game=__decorate([component("bridgesim-game")],Game),Game.register();
},{"../core/client":40,"../net/conditioner":67,"../net/message":69}],11:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__decorate=this&&this.__decorate||function(t,e,i,r){var s,o=arguments.length,n=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(o<3?s(n):o>3?s(e,i,n):s(e,i))||n);return o>3&&n&&Object.defineProperty(e,i,n),n},math_1=require("../core/math"),color=require("./colors"),const_1=require("./const"),util_1=require("./util"),OUTER_RING_WIDTH=10,HeadingIndicator=function(t){function e(){return t.apply(this,arguments)||this}return __extends(e,t),e.prototype.ready=function(){this.can=this.$.canvas,this.ctx=this.can.getContext("2d")},e.prototype.attached=function(){this.async(this.resize.bind(this)),this.listen(window,"resize","resize")},e.prototype.detached=function(){this.unlisten(window,"resize","resize")},e.prototype.draw=function(t){this.maybeResize();var e=this.ctx;e.clearRect(0,0,this.w,this.h);var i=this.radius-OUTER_RING_WIDTH;this.drawTicks(i,20,12),this.drawTicks(i,5,4),this.drawLabels(i-30,20);var r=this.db.positions[this.shipId];if(r){var s=r.yaw,o=this.db.prevPositions[this.shipId];o&&(s=util_1.lerp(s,o.yaw,t)),this.drawTick(this.radius,s,8,color.AQUA)}var n=this.db.motion[this.shipId];n&&this.drawTick(this.radius,math_1.degrees(Math.atan2(n.velocityX,n.velocityY)),8,"#FFF")},e.prototype.maybeResize=function(){0!==this.w&&0!==this.h||this.resize()},e.prototype.resize=function(){this.w=this.can.clientWidth,this.h=this.can.clientHeight,this.centerX=util_1.snap(this.w/2),this.centerY=util_1.snap(this.h/2),this.radius=Math.min(this.w,this.h)/2;var t=window.devicePixelRatio;this.can.width=this.w*t,this.can.height=this.h*t,this.ctx.scale(t,t)},e.prototype.drawTick=function(t,e,i,r){var s=this.ctx;s.save(),s.strokeStyle=r,s.lineWidth=2,s.beginPath(),s.translate(this.centerX,this.centerY),s.rotate(e*Math.PI/180),s.moveTo(0,-t),s.lineTo(0,-t+i),s.stroke(),s.restore()},e.prototype.drawTicks=function(t,e,i){var r=this.ctx;r.save(),r.strokeStyle=color.AQUA,r.beginPath(),r.translate(this.centerX,this.centerY);for(var s=0;s<360;s+=e)r.moveTo(0,-t),r.lineTo(0,-t+i),r.rotate(e*Math.PI/180);r.stroke(),r.restore()},e.prototype.drawLabels=function(t,e){var i=this.ctx;i.save(),i.font=const_1.CANVAS_FONT,i.fillStyle=color.AQUA,i.translate(this.centerX,this.centerY);for(var r=e*Math.PI/180,s=0;s<360;s+=e){var o=s.toString(),n=i.measureText(o).width;i.fillText(o,-n/2,-t),i.rotate(r)}i.restore()},e}(polymer.Base);__decorate([property({type:Object})],HeadingIndicator.prototype,"db",void 0),__decorate([property({type:String})],HeadingIndicator.prototype,"shipId",void 0),HeadingIndicator=__decorate([component("bridgesim-heading-indicator")],HeadingIndicator),exports.HeadingIndicator=HeadingIndicator,HeadingIndicator.register();
},{"../core/math":52,"./colors":5,"./const":6,"./util":36}],12:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var p in t)t.hasOwnProperty(p)&&(e[p]=t[p]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,p){var r,s=arguments.length,a=s<3?t:null===p?p=Object.getOwnPropertyDescriptor(t,o):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,p);else for(var h=e.length-1;h>=0;h--)(r=e[h])&&(a=(s<3?r(a):s>3?r(t,o,a):r(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a},HealthDisplay=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.observeShipId=function(){this.updateHealth()},t.prototype.observeHealths=function(){this.updateHealth()},t.prototype.updateHealth=function(){if(this.db){var e=this.db.healths[this.shipId];e&&(this.health={hp:e.hp,hpMax:e.hpMax,shieldsUp:e.shieldsUp,shields:e.shields,shieldsMax:e.shieldsMax})}},t}(polymer.Base);__decorate([property({type:Object})],HealthDisplay.prototype,"db",void 0),__decorate([property({type:String})],HealthDisplay.prototype,"shipId",void 0),__decorate([observe("shipId")],HealthDisplay.prototype,"observeShipId",null),__decorate([observe("db.healths.*")],HealthDisplay.prototype,"observeHealths",null),__decorate([property({type:Object})],HealthDisplay.prototype,"health",void 0),HealthDisplay=__decorate([component("health-display")],HealthDisplay),exports.HealthDisplay=HealthDisplay,HealthDisplay.register();
},{}],13:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var n,p=arguments.length,s=p<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(s=(p<3?n(s):p>3?n(t,o,s):n(t,o))||s);return p>3&&s&&Object.defineProperty(t,o,s),s},host_1=require("../core/host"),loopback_1=require("../net/loopback"),webrtc_1=require("../net/webrtc"),webrtc_config_1=require("./webrtc-config"),HostWrapper=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.attached=function(){var e=this;console.log("host-wrapper: attached"),this.host=new host_1.Host,this.host.start();var t=new loopback_1.Loopback;t.open(),this.host.addConnection(t.b),this.fire("connection",t.a),this.$.lobby.offer=function(t,o){e.onOffer(t.Offer).then(function(e){o({Answer:e})})}},t.prototype.serverTokenChanged=function(e){this.host.settings.token=e},t.prototype.detached=function(){console.log("host-wrapper: detached"),this.serverToken="",this.host.stop()},t.prototype.onOffer=function(e){var t=this;console.log("host-wrapper: got offer");var o=new webrtc_1.WebRTCConnection(webrtc_config_1.RTC_CONFIG);return o.onOpen=function(){t.host.addConnection(o)},o.takeOffer(webrtc_1.decodeRSD(e)).then(function(e){return webrtc_1.encodeRSD(e)})},t}(polymer.Base);__decorate([property({type:String})],HostWrapper.prototype,"serverName",void 0),__decorate([property({type:Boolean})],HostWrapper.prototype,"serverHidden",void 0),__decorate([property({type:String,notify:!0})],HostWrapper.prototype,"serverToken",void 0),__decorate([observe("serverToken")],HostWrapper.prototype,"serverTokenChanged",null),HostWrapper=__decorate([component("bridgesim-host")],HostWrapper),HostWrapper.register();
},{"../core/host":51,"../net/loopback":68,"../net/webrtc":70,"./webrtc-config":38}],14:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},__decorate=this&&this.__decorate||function(t,e,n,o){var r,s=arguments.length,i=s<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(r=t[p])&&(i=(s<3?r(i):s>3?r(e,n,i):r(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i},Input=function(t){function e(){var e=t.apply(this,arguments)||this;return e.commandsPersisent={},e}return __extends(e,t),e.prototype.created=function(){this.resetCommands()},e.prototype.applyInput=function(t,e){e?Object.assign(this.commandsPersisent,t):Object.assign(this.commands,t)},e.prototype.process=function(){var t=window.navigator.getGamepads()[0],e=.25;if(t){if(0===this.commands.turn){var n=t.axes[0];Math.abs(n)>e&&(this.commands.turn=n)}0===this.commands.thrust&&(this.commands.thrust=t.buttons[7].value-t.buttons[6].value)}var o=this.commands;return this.resetCommands(),o},e.prototype.resetCommands=function(){this.commands={fireWeapons:[],power:{},thrust:0,turn:0},Object.assign(this.commands,this.commandsPersisent)},e}(polymer.Base);__decorate([property({type:Object})],Input.prototype,"db",void 0),__decorate([property({type:String})],Input.prototype,"shipId",void 0),Input=__decorate([component("bridgesim-input")],Input),Input.register();
},{}],15:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var p=e.length-1;p>=0;p--)(r=e[p])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},webrtc_1=require("../net/webrtc"),webrtc_config_1=require("./webrtc-config"),JoinScreen=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.activeChanged=function(e){var t=this;e&&this.async(function(){t.$.tokenInput.$.input.focus()},1)},t.prototype.cancel=function(){this.token=null,this.fire("show-welcome")},t.prototype.join=function(){var e=this;this.fire("loading","finding game");var t=new webrtc_1.WebRTCConnection(webrtc_config_1.RTC_CONFIG);t.onOpen=function(){e.fire("url-hash-inert",e.token),e.fire("connection",t)},t.makeOffer().then(function(t){return e.$.lobbyList.connect(e.token,webrtc_1.encodeRSD(t),"")}).then(function(n){return e.fire("loading","joining game"),t.takeAnswer(webrtc_1.decodeRSD(n.Answer))}).catch(function(n){e.fire("error-screen",n),t.onOpen=null})},t}(polymer.Base);__decorate([property({type:Boolean,value:!1})],JoinScreen.prototype,"active",void 0),__decorate([property({type:String,value:null})],JoinScreen.prototype,"token",void 0),__decorate([property({type:Boolean,value:!0})],JoinScreen.prototype,"invalid",void 0),__decorate([observe("active")],JoinScreen.prototype,"activeChanged",null),JoinScreen=__decorate([component("bridgesim-join-screen")],JoinScreen),JoinScreen.register();
},{"../net/webrtc":70,"./webrtc-config":38}],16:[function(require,module,exports){
var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,o){var n,c=arguments.length,i=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(c<3?n(i):c>3?n(t,r,i):n(t,r))||i);return c>3&&i&&Object.defineProperty(t,r,i),i},LoadingScreen=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t}(polymer.Base);__decorate([property({type:Boolean,value:!1})],LoadingScreen.prototype,"active",void 0),LoadingScreen=__decorate([component("bridgesim-loading-screen")],LoadingScreen),LoadingScreen.register();
},{}],17:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var n,i=arguments.length,p=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,o,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(p=(i<3?n(p):i>3?n(t,o,p):n(t,o))||p);return i>3&&p&&Object.defineProperty(t,o,p),p},Net=require("../net/message"),STATION_IDS=[Net.Station.Helm,Net.Station.Comms,Net.Station.Science,Net.Station.Weapons,Net.Station.Engineering],LobbyScreen=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createShip=function(){this.fire("net-send",{createShip:{name:this.newShipName}}),this.newShipName=null},t.prototype.claimStation=function(e){var t=this.$.ships.modelForElement(e.target).ship,o=e.model.station;this.fire("net-send",{joinCrew:{shipId:t.id,station:o.id}})},t.prototype.start=function(){this.fire("net-send",{updateSettings:{started:!0}})},t.prototype.recompute=function(){var e={};for(var t in this.db.players){var o=this.db.players[t];null!=o.shipId&&(e[o.shipId]||(e[o.shipId]={}),e[o.shipId][o.station]=t)}var r=[];for(var n in this.db.ships)if(!this.db.ais[n]){for(var i=[],p=0,a=STATION_IDS;p<a.length;p++){var s=a[p],t=(e[n]||{})[s],c=null==t?null:this.db.players[t].name;i.push({id:s,name:Net.Station[s],playerName:c})}r.push({id:n,name:this.db.names[n].name,stations:i})}this.ships=r},t.prototype.tokenURL=function(e){return window.location.origin+window.location.pathname+"#"+e},t}(polymer.Base);__decorate([property({type:Object})],LobbyScreen.prototype,"db",void 0),__decorate([property({type:Boolean,value:!1})],LobbyScreen.prototype,"hosting",void 0),__decorate([property({type:String})],LobbyScreen.prototype,"token",void 0),__decorate([property({type:String,notify:!0})],LobbyScreen.prototype,"serverName",void 0),__decorate([property({type:String})],LobbyScreen.prototype,"scenarioName",void 0),__decorate([property({type:Array})],LobbyScreen.prototype,"ships",void 0),__decorate([property({type:String,value:null})],LobbyScreen.prototype,"newShipName",void 0),__decorate([observe("db.ships.*, db.players.*, db.ais.*, db.names.*")],LobbyScreen.prototype,"recompute",null),LobbyScreen=__decorate([component("bridgesim-lobby-screen")],LobbyScreen),LobbyScreen.register();
},{"../net/message":69}],18:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__decorate=this&&this.__decorate||function(t,e,i,r){var o,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var h=t.length-1;h>=0;h--)(o=t[h])&&(a=(s<3?o(a):s>3?o(e,i,a):o(e,i))||a);return s>3&&a&&Object.defineProperty(e,i,a),a},galaxy_1=require("../core/galaxy"),math_1=require("../core/math"),pathfinding_1=require("../core/pathfinding"),quadtree_1=require("../core/quadtree"),weapon_1=require("../core/weapon"),color=require("./colors"),const_1=require("./const"),util_1=require("./util"),BLIP_PX=2,MIN_METERS_PER_PX=10,MAX_METERS_PER_PX=200,WEAPON_COLORS=(_a={},_a[weapon_1.WeaponType.Laser]=color.RED,_a[weapon_1.WeaponType.Missile]=color.AQUA,_a),Map=function(t){function e(){var e=t.apply(this,arguments)||this;return e.centerCC={x:0,y:0},e.followGC={x:0,y:0},e.panStartGC={x:0,y:0},e.drawn=!1,e.frame=0,e}return __extends(e,t),e.prototype.ready=function(){this.can=this.$.canvas,this.ctx=this.can.getContext("2d"),this.shipImage=new Image,this.shipImage.src="images/ship.svg",this.stationImage=new Image,this.stationImage.src="images/station.svg",window.addEventListener("resize",this.resize.bind(this))},e.prototype.resize=function(){this.w=this.clientWidth,this.h=this.clientHeight,this.centerCC.x=this.w/2,this.centerCC.y=this.h/2;var t=this.can.getBoundingClientRect();this.left=t.left,this.top=t.top;var e=window.devicePixelRatio;this.can.width=this.w*e,this.can.height=this.h*e,this.ctx.scale(e,e),this.can.style.transform="scale("+1/window.devicePixelRatio+")"},e.prototype.handleTap=function(t){var e={x:t.detail.x-this.left,y:t.detail.y-this.top};this.fire("map-tap",{screen:e,world:this.screenToWorld(e.x,e.y)})},e.prototype.mapTrack=function(t){this.dragPan&&("start"===t.detail.state?(this.panStartGC.x=this.followGC.x,this.panStartGC.y=this.followGC.y,t.target.style.cursor="move"):"end"===t.detail.state&&(t.target.style.cursor="auto"),this.followGC.x=this.panStartGC.x-t.detail.dx*this.metersPerPx,this.followGC.y=this.panStartGC.y+t.detail.dy*this.metersPerPx)},e.prototype.worldToScreen=function(t,e){return{x:this.centerCC.x+t/this.metersPerPx-this.followGC.x/this.metersPerPx,y:this.centerCC.y-e/this.metersPerPx+this.followGC.y/this.metersPerPx}},e.prototype.screenToWorld=function(t,e){return{x:this.followGC.x+t*this.metersPerPx-this.centerCC.x*this.metersPerPx,y:this.followGC.y-e*this.metersPerPx+this.centerCC.y*this.metersPerPx}},e.prototype.lerpScreenPos=function(t,e){void 0===e&&(e=null),null===e&&(e=t===this.shipId?this.localAlpha:this.remoteAlpha);var i=this.db.positions[t];if(null==i)return null;var r=this.db.prevPositions[t];null==r&&(r=i);var o=this.worldToScreen(util_1.lerp(i.x,r.x,e),util_1.lerp(i.y,r.y,e));return{x:o.x,y:o.y,yaw:util_1.lerp(i.yaw,r.yaw,e),roll:0}},e.prototype.draw=function(t,e){if(this.drawn||this.resize(),this.ctx.clearRect(0,0,this.w,this.h),this.localAlpha=t,this.remoteAlpha=e,this.metersPerPx=-this.zoom*(MAX_METERS_PER_PX-MIN_METERS_PER_PX)+MAX_METERS_PER_PX,this.follow){var i=this.db.positions[this.follow];if(i){var r=this.db.prevPositions[this.follow];null==r&&(r=i),this.followGC.x=util_1.lerp(i.x,r.x,t),this.followGC.y=util_1.lerp(i.y,r.y,t)}}this.drawGrid(),this.drawDebris(),this.showWeaponRanges&&this.drawWeaponRanges(),this.drawShields(),this.drawStations(),this.drawRemoteShips(),this.drawLasers(),this.drawMissiles(),this.drawLocalShip(),this.drawHighlight(),this.showBoundingBoxes&&this.drawBoundingBoxes(),this.showQuadtree&&this.drawQuadtree(),this.showPathfinding&&this.drawPathfinding(),this.showMotion&&this.drawMotion(),this.frame++},e.prototype.drawGrid=function(){var t=this.ctx,e=Math.round(galaxy_1.SECTOR_METERS/this.metersPerPx),i=e*this.size,r={x:util_1.snap(this.centerCC.x-i/2-this.followGC.x/this.metersPerPx),y:util_1.snap(this.centerCC.y-i/2+this.followGC.y/this.metersPerPx)},o=Math.max(0,r.y),s=Math.min(this.h,i+r.y),a=Math.max(0,r.x),h=Math.min(this.w,i+r.x),n=0,l=0;t.strokeStyle="rgba(26, 224, 113, 0.5)",t.beginPath();for(var p=0;p<=this.size;p++)n=p*e+r.x,n>=0&&n<=this.w&&(t.moveTo(n,o),t.lineTo(n,s)),l=p*e+r.y,l>=0&&l<=this.h&&(t.moveTo(a,l),t.lineTo(h,l));t.stroke()},e.prototype.drawDebris=function(){var t=this.ctx;t.strokeStyle="#964B00",t.beginPath();for(var e in this.db.debris){var i=this.lerpScreenPos(e);if(null!=i){var r=this.db.collidables[e];if(null!=r){var o=Math.max(.5,r.length/this.metersPerPx/2);i.x+o<0||i.x-o>this.w||i.y+o<0||i.y-o>this.h||(t.moveTo(i.x+o,i.y),t.arc(i.x,i.y,o,0,2*Math.PI))}}}t.stroke()},e.prototype.drawWeaponRanges=function(){var t=this.ctx;t.lineWidth=1;for(var e in this.db.healths){var i=this.db.healths[e];if(0!=i.weapons.length){var r=this.lerpScreenPos(e);if(null!=r)for(var o=0,s=i.weapons;o<s.length;o++){var a=s[o];t.beginPath(),t.strokeStyle=WEAPON_COLORS[a.type];var h=a.range/this.metersPerPx,n=-math_1.headingToRadians(r.yaw)+a.direction;if(a.angle>=2*Math.PI||a.angle<=0)t.moveTo(r.x+h,r.y),t.arc(r.x,r.y,h,0,2*Math.PI);else{var l=n-a.angle/2,p=n+a.angle/2;t.moveTo(r.x,r.y),t.arc(r.x,r.y,h,l,p),t.lineTo(r.x,r.y)}t.stroke()}}}},e.prototype.drawStations=function(){for(var t in this.db.stations){var e=this.lerpScreenPos(t);if(null!=e){this.drawImage(e.x,e.y,this.stationImage,0,.5);var i=this.db.names[t].name;this.drawText(e.x+10,e.y+5,i);var r=this.db.healths[t];null!=r&&this.drawText(e.x+10,e.y+20,r.hp.toString())}}},e.prototype.drawRemoteShips=function(){for(var t in this.db.ships)if(t!==this.shipId){var e=this.lerpScreenPos(t);if(null==e)return;var i=color.YELLOW,r=this.db.ais[t];r&&(r.friendliness>1/3?i=color.GREEN:r.friendliness<-1/3&&(i=color.RED)),this.ctx.beginPath(),this.drawBlip(e.x,e.y,i);var o=this.db.names[t].name;this.drawText(e.x+10,e.y+5,o);var s=this.db.healths[t];null!=s&&this.drawText(e.x+10,e.y+20,s.hp.toString())}},e.prototype.drawLasers=function(){var t=this.ctx;t.beginPath();for(var e in this.db.lasers){var i=this.lerpScreenPos(e);if(null!=i){var r=math_1.radians(i.yaw-90);t.moveTo(i.x,i.y),t.lineTo(i.x+20*Math.cos(r),i.y+20*Math.sin(r))}}t.strokeStyle=WEAPON_COLORS[weapon_1.WeaponType.Laser],t.lineWidth=2,t.stroke()},e.prototype.drawMissiles=function(){var t=this.ctx;t.beginPath();for(var e in this.db.missiles){var i=this.lerpScreenPos(e);if(null!=i){var r=math_1.radians(i.yaw-90);t.moveTo(i.x,i.y),t.lineTo(i.x+5*Math.cos(r),i.y+5*Math.sin(r))}}t.strokeStyle=WEAPON_COLORS[weapon_1.WeaponType.Missile],t.lineWidth=2,t.stroke()},e.prototype.drawLocalShip=function(){if(null!=this.shipId){var t=this.lerpScreenPos(this.shipId);null!=t&&this.drawImage(t.x,t.y,this.shipImage,t.yaw,.5)}},e.prototype.drawHighlight=function(){if(null!=this.highlight){var t=this.lerpScreenPos(this.highlight),e=this.db.collidables[this.highlight];if(t&&e){var i=Math.max(e.width,e.length)/this.metersPerPx+5,r=60,o=this.frame%r/r,s=2*Math.PI*o,a=this.ctx;a.beginPath(),a.strokeStyle="rgba(255, 0, 0, 0.5)",a.lineWidth=2,a.arc(t.x,t.y,i,s,s+Math.PI),a.stroke()}}},e.prototype.drawBoundingBoxes=function(){var t=this.ctx;t.beginPath(),t.strokeStyle=color.YELLOW,t.lineWidth=1;for(var e in this.db.collidables){var i=this.lerpScreenPos(e);if(null!=i){var r=this.db.collidables[e],o=r.width/this.metersPerPx,s=r.length/this.metersPerPx;t.rect(util_1.snap(i.x-o/2),util_1.snap(i.y-s/2),o,s)}}t.stroke()},e.prototype.drawQuadtree=function(){if(!this.quadtree){var t=galaxy_1.maxCoord(this.size);this.quadtree=new quadtree_1.Quadtree(-t,-t,t,t)}for(var e in this.db.collidables){var i=this.db.collidables[e],r=i.length,o=i.width,s=this.db.positions[e],a=s.x,h=s.y;this.quadtree.insert(e,a,h,a+r,h+o)}var n=this.ctx;n.beginPath(),n.strokeStyle=color.YELLOW,n.lineWidth=1;for(var l=[this.quadtree];l.length>0;){var p=l.pop();l=l.concat(p.subtrees);var d=this.worldToScreen(p.left,p.top),c=d.x,y=d.y,x=this.worldToScreen(p.right,p.bottom),u=x.x,v=x.y;n.rect(util_1.snap(c),util_1.snap(y),Math.round(u-c),Math.round(v-y))}n.stroke(),this.quadtree.clear()},e.prototype.drawPathfinding=function(){var t=new pathfinding_1.Pathfinder(this.db,this.size),e=this.ctx;e.beginPath(),e.strokeStyle=color.YELLOW,e.lineWidth=1;for(var i in this.db.ais){var r=this.db.positions[i];if(!r)return;var o=this.db.ais[i].targetPos,s=t.find(r,o,[this.shipId]),a=this.worldToScreen(r.x,r.y);e.moveTo(a.x,a.y);for(var h=0,n=s;h<n.length;h++){var l=n[h],p=this.worldToScreen(l.x,l.y),d=p.x,c=p.y;e.lineTo(d,c)}}e.stroke()},e.prototype.drawMotion=function(){var t=this.ctx;t.strokeStyle=color.YELLOW,t.lineWidth=1;for(var e in this.db.motion){var i=this.db.motion[e],r=this.lerpScreenPos(e);r&&i&&(t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(r.x+i.velocityX/2,r.y-i.velocityY/2),t.stroke())}},e.prototype.drawText=function(t,e,i){var r=this.ctx;r.beginPath(),r.font=const_1.CANVAS_FONT,r.fillStyle="#FFF",r.strokeStyle="#000",r.lineWidth=3,r.strokeText(i,t,e),r.fillText(i,t,e)},e.prototype.drawBlip=function(t,e,i){var r=this.ctx;r.beginPath(),r.arc(t,e,BLIP_PX,0,2*Math.PI),r.fillStyle=i,r.fill()},e.prototype.drawImage=function(t,e,i,r,o){var s=this.ctx;s.save(),s.translate(t,e),s.rotate(r*Math.PI/180);var a=i.width*o,h=i.height*o;s.drawImage(i,-a/2,-h/2,a,h),s.restore()},e.prototype.drawShields=function(){for(var t in this.db.healths){var e=this.db.healths[t],i=this.db.collidables[t],r=this.lerpScreenPos(t);if(i&&r&&e.shieldsUp&&!(e.shields<=0)){var o=e.shields/e.shieldsMax;o<.2?this.ctx.strokeStyle=color.RED:o<.5?this.ctx.strokeStyle=color.YELLOW:this.ctx.strokeStyle=color.BLUE,this.ctx.lineWidth=2,this.ctx.beginPath();var s=math_1.hypot(i.length/2,i.width/2)/this.metersPerPx;this.ctx.arc(r.x,r.y,s,0,2*Math.PI),this.ctx.stroke()}}},e}(polymer.Base);__decorate([property({type:Object})],Map.prototype,"db",void 0),__decorate([property({type:String})],Map.prototype,"shipId",void 0),__decorate([property({type:String})],Map.prototype,"follow",void 0),__decorate([property({type:String})],Map.prototype,"highlight",void 0),__decorate([property({type:Number,value:2})],Map.prototype,"size",void 0),__decorate([property({type:Number,value:0})],Map.prototype,"zoom",void 0),__decorate([property({type:Boolean,value:!1})],Map.prototype,"showWeaponRanges",void 0),__decorate([property({type:Boolean,value:!1})],Map.prototype,"dragPan",void 0),__decorate([property({type:Boolean,value:!1})],Map.prototype,"showBoundingBoxes",void 0),__decorate([property({type:Boolean,value:!1})],Map.prototype,"showQuadtree",void 0),__decorate([property({type:Boolean,value:!1})],Map.prototype,"showPathfinding",void 0),__decorate([property({type:Boolean,value:!1})],Map.prototype,"showMotion",void 0),__decorate([listen("tap")],Map.prototype,"handleTap",null),__decorate([listen("track")],Map.prototype,"mapTrack",null),Map=__decorate([component("bridgesim-map")],Map),exports.Map=Map,Map.register();var _a;
},{"../core/galaxy":50,"../core/math":52,"../core/pathfinding":53,"../core/quadtree":54,"../core/weapon":66,"./colors":5,"./const":6,"./util":36}],19:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,o){var r,c=arguments.length,i=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(c<3?r(i):c>3?r(t,n,i):r(t,n))||i);return c>3&&i&&Object.defineProperty(t,n,i),i},webrtc_1=require("../net/webrtc"),webrtc_config_1=require("./webrtc-config"),PeerCopypaste=function(e){function t(){var t=e.apply(this,arguments)||this;return t.error=null,t.connecting=!1,t}return __extends(t,e),t.prototype.openClientDialog=function(){var e=this;this.$.clientDialog.open(),this.conn=new webrtc_1.WebRTCConnection(webrtc_config_1.RTC_CONFIG),this.conn.onOpen=function(){e.conn.onOpen=null,e.fire("connection",e.conn),e.$.clientDialog.close()},this.conn.makeOffer().then(function(t){e.copyOffer=webrtc_1.encodeRSD(t)})},t.prototype.connect=function(e){var t=e.model.item.ID,n="";e.model.item.RequiresPassword&&(n=prompt("Server Password")),this.lobbyListConnect(t,n)},t.prototype.onStopConnecting=function(){this.connecting=!1},t.prototype.lobbyListConnect=function(e,t){var n=this;void 0===t&&(t=""),this.error=null,this.connecting=!0;var o=function(){n.connecting=!1};return this.$.lobbyList.connect(e,this.copyOffer,t).then(function(e){n.pasteAnswer=e.Answer}).catch(function(e){n.error=e}).then(o,o)},t.prototype.connectByID=function(e){this.lobbyListConnect(this.hostID)},t.prototype.refreshList=function(){this.$.lobbyList.refresh()},t.prototype.openHostDialog=function(){this.$.hostDialog.open()},t.prototype.onPasteOffer=function(e){e&&this.handleOffer(e)},t.prototype.handleOffer=function(e){var t=this,n=new webrtc_1.WebRTCConnection(webrtc_config_1.RTC_CONFIG);return n.onOpen=function(){n.onOpen=null,t.fire("connection",n),t.$.hostDialog.close()},n.takeOffer(webrtc_1.decodeRSD(e)).then(function(e){return t.copyAnswer=webrtc_1.encodeRSD(e),t.copyAnswer})},t.prototype.onPasteAnswer=function(e){e&&this.conn.takeAnswer(webrtc_1.decodeRSD(e))},t.prototype.clear=function(){this.conn=null,this.copyOffer="",this.copyAnswer="",this.pasteOffer="",this.pasteAnswer=""},t.prototype.selectAndCopy=function(e){e.target.select(),document.execCommand("copy")},t}(polymer.Base);__decorate([observe("pasteOffer")],PeerCopypaste.prototype,"onPasteOffer",null),__decorate([observe("pasteAnswer")],PeerCopypaste.prototype,"onPasteAnswer",null),PeerCopypaste=__decorate([component("bridgesim-peer-copypaste")],PeerCopypaste),PeerCopypaste.register();
},{"../net/webrtc":70,"./webrtc-config":38}],20:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,a=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(a=(s<3?r(a):s>3?r(t,o,a):r(t,o))||a);return s>3&&a&&Object.defineProperty(t,o,a),a},webrtc_1=require("../net/webrtc"),webrtc_config_1=require("./webrtc-config"),PeerLocalstorage=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.makeOffer=function(){var e=this;this.hosting||(this.key=Math.floor(1e4*Math.random()).toString(),this.conn=new webrtc_1.WebRTCConnection(webrtc_config_1.RTC_CONFIG),this.conn.makeOffer().then(function(t){e.set("handshakes."+e.key,{offer:webrtc_1.encodeRSD(t)}),console.log("localstorage: sent offer",e.key)}))},t.prototype.attached=function(){this.hosting||this.makeOffer()},t.prototype.onHandshakesChanged=function(){return this.handshakes?void(this.hosting?this.scanForOffers():null!=this.key&&this.checkIfAccepted()):void(this.handshakes={})},t.prototype.scanForOffers=function(){var e=this,t=function(t){var n=o.handshakes[t];return n.accepted?"continue":(console.log("localstorage: found offer",t),n.accepted=!0,void o.takeOffer(n.offer).then(function(o){e.set("handshakes."+t+".answer",o),console.log("localstorage: set answer",t)}))},o=this;for(var n in this.handshakes)t(n)},t.prototype.checkIfAccepted=function(){var e=this,t=this.handshakes[this.key];if(t&&t.answer){console.log("localstorage: got answer",this.key);var o=this.conn,n=this.key;o.onOpen=function(){console.log("localstorage: connection to host open",n),o.onOpen=null,e.fire("connection",o)},o.takeAnswer(webrtc_1.decodeRSD(t.answer)),this.conn=null,this.key=null}},t}(polymer.Base);__decorate([property({type:Boolean,value:!1})],PeerLocalstorage.prototype,"hosting",void 0),__decorate([property({type:Object})],PeerLocalstorage.prototype,"handshakes",void 0),__decorate([property({type:Object})],PeerLocalstorage.prototype,"takeOffer",void 0),__decorate([observe("handshakes")],PeerLocalstorage.prototype,"onHandshakesChanged",null),PeerLocalstorage=__decorate([component("bridgesim-peer-localstorage")],PeerLocalstorage),PeerLocalstorage.register();
},{"../net/webrtc":70,"./webrtc-config":38}],21:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},__decorate=this&&this.__decorate||function(t,e,r,o){var n,a=arguments.length,i=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var p=t.length-1;p>=0;p--)(n=t[p])&&(i=(a<3?n(i):a>3?n(e,r,i):n(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i},PowerBar=function(t){function e(){var e=t.apply(this,arguments)||this;return e.trackStartLevel=0,e}return __extends(e,t),e.prototype.downBar=function(t){var e=t.target.getBoundingClientRect(),r=1-(t.detail.y-e.top)/e.height;this.trackStartLevel=r,this.fire("input",{power:(o={},o[this.name]=r,o)}),t.preventDefault();var o},e.prototype.trackBar=function(t){"start"===t.detail.state?document.body.style.cursor="ns-resize":"end"===t.detail.state&&(document.body.style.cursor="auto");var e=t.target.getBoundingClientRect(),r=this.trackStartLevel-t.detail.dy/e.height;this.fire("input",{power:(o={},o[this.name]=r,o)}),t.preventDefault();var o},e.prototype.height=function(t){return"height:"+(100*t).toFixed(3)+"%"},e.prototype.percent=function(t){return Math.round(100*t).toString()},e.prototype.overheat=function(t){return t>=.9},e.prototype.idle=function(t){return 0===t},e}(polymer.Base);__decorate([property({type:String,value:"?"})],PowerBar.prototype,"name",void 0),__decorate([property({type:Number,value:0})],PowerBar.prototype,"level",void 0),__decorate([property({type:Boolean,value:!1})],PowerBar.prototype,"active",void 0),PowerBar=__decorate([component("bridgesim-power-bar")],PowerBar),exports.PowerBar=PowerBar,PowerBar.register();
},{}],22:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var s,p=arguments.length,n=p<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(n=(p<3?s(n):p>3?s(t,o,n):s(t,o))||n);return p>3&&n&&Object.defineProperty(t,o,n),n},Components=require("../core/components"),Power=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.ready=function(){this.subsystems=[];for(var e=0,t=Components.Power.prototype.props;e<t.length;e++){var o=t[e];this.push("subsystems",{name:o,level:0})}},t.prototype.updateLevels=function(e,t){if(e&&t&&t.base[e])for(var o in this.subsystems||[]){var r=this.subsystems[o],s=t.base[e][r.name]||0;this.set(["subsystems",o,"level"],s)}},t}(polymer.Base);__decorate([property({type:Object})],Power.prototype,"db",void 0),__decorate([property({type:String})],Power.prototype,"shipId",void 0),__decorate([observe("shipId,db.power.*")],Power.prototype,"updateLevels",null),Power=__decorate([component("bridgesim-power")],Power),exports.Power=Power,Power.register();
},{"../core/components":43}],23:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,s){var n,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(n=e[o])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},ship_1=require("./ship"),galaxy_1=require("../../core/galaxy");exports.SKYBOX_EXTENSIONS=["_right1.png","_top3.png","_front5.png","_left2.png","_bottom4.png","_back6.png"];var Renderer=function(e){function t(){var t=e.apply(this,arguments)||this;return t.renderShips=[],t.shipMap={},t}return __extends(t,e),t.prototype.ready=function(){this.engine=new BABYLON.Engine(this.$.renderCanvas,!0),this.scene=new BABYLON.Scene(this.engine),this.scene.clearColor=new BABYLON.Color4(0,0,0,1),this.assetsManager=new BABYLON.AssetsManager(this.scene),this.assetsManager.useDefaultLoadingScreen=!1,this.engine.enableOfflineSupport=!1,this.camera=new BABYLON.ArcRotateCamera("camera1",-Math.PI/2,Math.PI/2,2,new BABYLON.Vector3(0,0,.45),this.scene),this.camera.attachControl(this.$.renderCanvas,!1,!1),this.camera.maxZ=1e4,this.camera.lowerRadiusLimit=1.5,this.camera.upperRadiusLimit=50;var e=new BABYLON.HDRRenderingPipeline("hdr",this.scene,1,null,[this.camera]);e.brightThreshold=.7,e.gaussCoeff=.5,e.gaussMean=1,e.gaussStandDev=5,e.exposure=1,e.minimumLuminance=.2,e.maximumLuminance=1e20,e.luminanceDecreaseRate=.3,e.luminanceIncreaserate=.5;var t=new BABYLON.DirectionalLight("light1",new BABYLON.Vector3(1,0,0),this.scene);t.intensity=1;var r=new BABYLON.StandardMaterial("Grid Material",this.scene);r.diffuseColor=new BABYLON.Color3(0,1,0),r.emissiveColor=new BABYLON.Color3(0,1,0),r.wireframe=!0;var s=this.size*galaxy_1.SECTOR_METERS,n=BABYLON.Mesh.CreateGround("ground1",s,s,this.size,this.scene);n.material=r,n.position.y=-1;var i=BABYLON.Mesh.CreateBox("skyBox",500,this.scene),a=new BABYLON.StandardMaterial("skyBox",this.scene);a.backFaceCulling=!1,a.reflectionTexture=new BABYLON.CubeTexture("textures/skybox/box",this.scene,exports.SKYBOX_EXTENSIONS),a.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,a.diffuseColor=new BABYLON.Color3(0,0,0),a.specularColor=new BABYLON.Color3(0,0,0),i.material=a,this.skybox=i;var o=new BABYLON.StandardMaterial("",this.scene);o.diffuseTexture=new BABYLON.Texture("textures/sun.png",this.scene),o.diffuseTexture.hasAlpha=!0,o.emissiveColor=new BABYLON.Color3(1,1,1),o.backFaceCulling=!1,o.useAlphaFromDiffuseTexture=!0;var h=BABYLON.Mesh.CreatePlane("sun",70,this.scene);h.material=o,h.position=new BABYLON.Vector3(-1,0,0).normalize().scale(225),h.billboardMode=7,h.parent=i;var p=BABYLON.Mesh.CreatePlane("sun",50,this.scene);p.scaling.x=5,p.scaling.y=.05,p.material=o,p.position=new BABYLON.Vector3(-1,0,0).normalize().scale(100),p.billboardMode=7,p.parent=i;var l=new BABYLON.LensFlareSystem("lensFlareSystem",h,this.scene);new BABYLON.LensFlare(.5,.2,new BABYLON.Color3(.5,.5,1),"textures/Flare.png",l),new BABYLON.LensFlare(.2,1,new BABYLON.Color3(1,1,1),"textures/Flare.png",l),new BABYLON.LensFlare(.4,.4,new BABYLON.Color3(1,.5,1),"textures/Flare.png",l),new BABYLON.LensFlare(.1,.6,new BABYLON.Color3(1,1,1),"textures/Flare.png",l),new BABYLON.LensFlare(.3,.8,new BABYLON.Color3(1,1,1),"textures/Flare.png",l);window.addEventListener("resize",this.resize.bind(this))},t.prototype.attached=function(){this.resize()},t.prototype.resize=function(){var e=this.$.renderCanvas,t=window.innerHeight-this.offsetTop;e.setAttribute("height",t+"px"),this.engine.resize()},t.prototype.draw=function(e,t){this.updateShips(e,t),this.scene.render()},t.prototype.updateShips=function(e,t){var r=this;if(this.assetsLoaded){var s={};for(var n in this.db.ships){var i=this.shipMap[n];i||(i=new ship_1.Ship(n,this.db,this.scene,this.$.assets),this.renderShips.push(i),this.shipMap[n]=i),s[n]=!0;var a=n===this.shipId?e:t;i.update(a)}this.renderShips=this.renderShips.filter(function(e){var t=e.id,n=s[t];return n||delete r.shipMap[t],n});var o=this.shipMap[this.shipId];o&&(this.camera.parent=o.mesh,this.skybox.position=o.mesh.position)}},t}(polymer.Base);__decorate([property({type:Boolean,value:!1})],Renderer.prototype,"assetsLoaded",void 0),__decorate([property({type:Number})],Renderer.prototype,"size",void 0),__decorate([property({type:Object})],Renderer.prototype,"db",void 0),__decorate([property({type:String})],Renderer.prototype,"shipId",void 0),Renderer=__decorate([component("bridgesim-renderer")],Renderer),exports.Renderer=Renderer,Renderer.register();
},{"../../core/galaxy":50,"./ship":24}],24:[function(require,module,exports){
"use strict";var util_1=require("../util"),renderer_1=require("./renderer"),Ship=function(){function e(e,i,s,r){var t=this;this.id=e,this.db=i,this.scene=s,this.formFittingShield=!1,this.mesh=new BABYLON.Mesh("ship",s);var a=r.ships[0],l=new BABYLON.CubeTexture("textures/skybox/box",s,renderer_1.SKYBOX_EXTENSIONS);r.loadShip(a).then(function(e){if(t.visualMesh=e.clone(""),t.visualMesh.setEnabled(!0),t.visualMesh.parent=t.mesh,t.walk(t.visualMesh,function(e){if(e instanceof BABYLON.Mesh){var i=e.material;if(i instanceof BABYLON.StandardMaterial)i.reflectionTexture=l,i.useReflectionFresnelFromSpecular=!0;else if(i instanceof BABYLON.MultiMaterial)for(var s=0,r=i.subMaterials;s<r.length;s++){var t=r[s];t instanceof BABYLON.StandardMaterial&&(t.reflectionTexture=l,t.useReflectionFresnelFromSpecular=!0)}}}),t.formFittingShield){t.shield=e.clone(""),t.shield.setEnabled(!0),t.shield.parent=t.mesh,t.shield.rotation=t.visualMesh.rotation;for(var i=0,s=t.shield.getDescendants();i<s.length;i++){var r=s[i];r instanceof BABYLON.Mesh&&r.scaling.scaleInPlace(1.1)}t.walk(t.shield,function(e){e instanceof BABYLON.Mesh&&(e.material=t.shieldMaterial)})}});var n=new BABYLON.StandardMaterial("kosh",s);n.reflectionTexture=l,n.diffuseColor=new BABYLON.Color3(.5,.95,1),n.emissiveColor=new BABYLON.Color3(.5,.5,.5),n.alpha=.1,n.specularPower=16,n.reflectionFresnelParameters=new BABYLON.FresnelParameters,n.reflectionFresnelParameters.bias=.1,n.emissiveFresnelParameters=new BABYLON.FresnelParameters,n.emissiveFresnelParameters.bias=.6,n.emissiveFresnelParameters.power=4,n.emissiveFresnelParameters.leftColor=BABYLON.Color3.White(),n.emissiveFresnelParameters.rightColor=BABYLON.Color3.Black(),n.opacityFresnelParameters=new BABYLON.FresnelParameters,n.opacityFresnelParameters.leftColor=BABYLON.Color3.White(),n.opacityFresnelParameters.rightColor=BABYLON.Color3.Black(),this.shieldMaterial=n,this.formFittingShield||(this.shield=BABYLON.Mesh.CreateSphere("shield",32,1.5,s),this.shield.position.z+=.45,this.shield.parent=this.mesh,this.shield.material=n)}return e.prototype.update=function(e){var i=this.db.positions[this.id];if(i){var s=this.db.prevPositions[this.id];null==s&&(s=i),this.mesh.position.x=util_1.lerp(i.x,s.x,e),this.mesh.position.z=-util_1.lerp(i.y,s.y,e),this.mesh.rotation.y=Math.PI/180*util_1.lerp(i.yaw,s.yaw,e);var r=util_1.lerp(i.roll,s.roll,e);this.visualMesh&&(this.visualMesh.rotation.x=-(r*r)/4,this.visualMesh.rotation.z=r),this.shield.setEnabled(!1)}},e.prototype.walk=function(e,i){for(var s=0,r=e.getDescendants();s<r.length;s++){var t=r[s];i(t),this.walk(t,i)}},e}();exports.Ship=Ship;
},{"../util":36,"./renderer":23}],25:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,o){var s,p=arguments.length,c=p<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,o);else for(var i=e.length-1;i>=0;i--)(s=e[i])&&(c=(p<3?s(c):p>3?s(t,r,c):s(t,r))||c);return p>3&&c&&Object.defineProperty(t,r,c),c},components_1=require("../core/components"),ResourceDisplay=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.observeShipId=function(e){this.updateResources()},t.prototype.observeResources=function(e){this.shipId&&0===e.path.indexOf("db.resources."+this.shipId+".")&&this.updateResources()},t.prototype.updateResources=function(){if(!this.shipId||!this.db||!this.db.resources[this.shipId])return void(this.resources=[]);for(var e=[],t=0,r=components_1.Resources.prototype.props;t<r.length;t++){var o=r[t];e.push({name:o,count:Math.round(this.db.resources[this.shipId][o]||0)})}this.resources=e},t}(polymer.Base);__decorate([property({type:Object})],ResourceDisplay.prototype,"db",void 0),__decorate([property({type:String})],ResourceDisplay.prototype,"shipId",void 0),__decorate([property({type:Array})],ResourceDisplay.prototype,"resources",void 0),__decorate([observe("shipId")],ResourceDisplay.prototype,"observeShipId",null),__decorate([observe("db.resources.*")],ResourceDisplay.prototype,"observeResources",null),ResourceDisplay=__decorate([component("resource-display")],ResourceDisplay),exports.ResourceDisplay=ResourceDisplay,ResourceDisplay.register();
},{"../core/components":43}],26:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,o){var n,c=arguments.length,i=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(c<3?n(i):c>3?n(t,r,i):n(t,r))||i);return c>3&&i&&Object.defineProperty(t,r,i),i},scenarios_1=require("../scenarios/scenarios"),ScenarioSelector=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.select=function(){this.fire("net-send",{updateSettings:{scenarioName:this.selected}})},t.prototype.settingsChanged=function(){if(this.db){var e=this.db.findSettings();e&&(this.selected=e.scenarioName)}},t}(polymer.Base);__decorate([property({type:Object})],ScenarioSelector.prototype,"db",void 0),__decorate([property({type:Array,value:function(){return scenarios_1.scenarios}})],ScenarioSelector.prototype,"scenarios",void 0),__decorate([property({type:String})],ScenarioSelector.prototype,"selected",void 0),__decorate([property({type:Boolean,value:!1})],ScenarioSelector.prototype,"disabled",void 0),__decorate([observe("db.settings.*")],ScenarioSelector.prototype,"settingsChanged",null),ScenarioSelector=__decorate([component("scenario-selector")],ScenarioSelector),exports.ScenarioSelector=ScenarioSelector,ScenarioSelector.register();
},{"../scenarios/scenarios":74}],27:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},__decorate=this&&this.__decorate||function(t,e,n,r){var o,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;c>=0;c--)(o=t[c])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s},SettingsMenu=function(t){function e(){return t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initializeDefaultName=function(){this.set("settings.name","Player "+(1e3*Math.random()).toFixed(0))},e}(polymer.Base);__decorate([property({type:Object,notify:!0})],SettingsMenu.prototype,"settings",void 0),SettingsMenu=__decorate([component("bridgesim-settings-menu")],SettingsMenu),SettingsMenu.register();
},{}],28:[function(require,module,exports){
"use strict";
},{}],29:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,n);else for(var p=e.length-1;p>=0;p--)(r=e[p])&&(c=(i<3?r(c):i>3?r(t,o,c):r(t,o))||c);return i>3&&c&&Object.defineProperty(t,o,c),c},SidePanel=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.openSettings=function(){this.$.settingsDialog.open()},t.prototype.disconnect=function(){this.fire("show-welcome")},t}(polymer.Base);__decorate([property({type:Boolean,value:!1})],SidePanel.prototype,"connected",void 0),__decorate([property({type:Object})],SidePanel.prototype,"settings",void 0),SidePanel=__decorate([component("bridgesim-side-panel")],SidePanel),SidePanel.register();
},{}],30:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,s){var r,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,s);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(n<3?r(i):n>3?r(t,o,i):r(t,o))||i);return n>3&&i&&Object.defineProperty(t,o,i),i},math_1=require("../../core/math"),components_1=require("../../core/components"),Comms=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.observeSelectedId=function(e){return e?void(this.selected={id:e,name:this.db.names[e].name}):void(this.selected=null)},t.prototype.observeNames=function(){this.selected&&this.set("selected.name",this.db.names[this.selected.id].name)},t.prototype.requestAssistance=function(e){var t=this.db.names[this.selected.id].name;this.logUs(t+": Please assist us!")},t.prototype.requestSurrender=function(e){var t=this.db.names[this.selected.id].name;this.logUs(t+": We request your unconditional surrender!")},t.prototype.requestResources=function(e){var t=this,o=this.db.names[this.selected.id].name;this.logUs(o+": Do you have any resources that we can use?"),setTimeout(function(){for(var e=[],s=0,r=components_1.Resources.prototype.props;s<r.length;s++){var n=r[s],i=t.db.resources[t.selected.id][n]||0;i>0&&e.push(n+" ("+i+")")}t.log(o,"Available resources: "+e.join(", "))},1e3)},t.prototype.requestDock=function(e){var t=this,o=this.db.names[this.selected.id].name;this.logUs(o+": We are requesting permission to dock."),setTimeout(function(){var e=t.db.positions[t.shipId],s=t.db.positions[t.selected.id];math_1.dist(e,s)>1e3?t.log(o,"You are currently out of range."):t.log(o,"Commencing docking procedures.")},1e3)},t.prototype.isShip=function(e){return!!this.db.ships[e]},t.prototype.isStation=function(e){return!!this.db.stations[e]},t.prototype.logUs=function(e){this.log(this.db.names[this.shipId].name,e)},t.prototype.log=function(e,t){this.$.chat.receiveMsg({name:e,text:t,timestamp:+new Date})},t}(polymer.Base);__decorate([property({type:Object})],Comms.prototype,"db",void 0),__decorate([property({type:String})],Comms.prototype,"shipId",void 0),__decorate([property({type:Array})],Comms.prototype,"logs",void 0),__decorate([property({type:String})],Comms.prototype,"selectedId",void 0),__decorate([property({type:Object})],Comms.prototype,"selected",void 0),__decorate([observe("selectedId")],Comms.prototype,"observeSelectedId",null),__decorate([observe("db.names.*")],Comms.prototype,"observeNames",null),Comms=__decorate([component("comms-station")],Comms),Comms.register();
},{"../../core/components":43,"../../core/math":52}],31:[function(require,module,exports){
var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,c=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(t,n,c):o(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c},Engineering=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t}(polymer.Base);Engineering=__decorate([component("engineering-station")],Engineering),Engineering.register();
},{}],32:[function(require,module,exports){
"use strict";function keyCode(t){return t.charCodeAt(0)}var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},__decorate=this&&this.__decorate||function(t,e,n,o){var r,i=arguments.length,u=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(t,e,n,o);else for(var p=t.length-1;p>=0;p--)(r=t[p])&&(u=(i<3?r(u):i>3?r(e,n,u):r(e,n))||u);return i>3&&u&&Object.defineProperty(e,n,u),u},math_1=require("../../core/math"),Helm=function(t){function e(){var e=t.apply(this,arguments)||this;return e.keys=(n={},n[keyCode("W")]={down:function(){return{thrust:1}},up:function(){return{thrust:0}}},n[keyCode("S")]={down:function(){return{thrust:-1}},up:function(){return{thrust:0}}},n[keyCode("A")]={down:function(){return{turn:-1}},up:function(){return{turn:0}}},n[keyCode("D")]={down:function(){return{turn:1}},up:function(){return{turn:0}}},n[keyCode("Z")]={down:function(){return{toggleShield:!0}}},n),e.keyHandlers={keydown:e.onKeydown.bind(e),keyup:e.onKeyup.bind(e),blur:e.onBlur.bind(e)},e;var n}return __extends(e,t),e.prototype.draw=function(t,e){this.$.map.draw(t,e),this.$.headingIndicator.draw(t)},e.prototype.handleZoom=function(t){this.zoom=math_1.clamp(this.zoom+t.deltaY/1e3,0,1),t.preventDefault()},e.prototype.onKeydown=function(t){if(!t.repeat){var e=this.keys[t.keyCode];if(e){e.isDown=!0;var n=e.down();e.up?this.fire("input-persistent",n):this.fire("input",n)}}},e.prototype.onKeyup=function(t){this.keyup(this.keys[t.keyCode])},e.prototype.keyup=function(t){t&&(t.up&&t.isDown&&this.fire("input-persistent",t.up()),t.isDown=!1)},e.prototype.onBlur=function(){for(var t in this.keys)this.keyup(this.keys[t])},e.prototype.activeUpdate=function(t){for(var e in this.keyHandlers){var n=this.keyHandlers[e];t?window.addEventListener(e,n):window.removeEventListener(e,n)}},e.prototype.startLeftTurn=function(){this.fire("input-persistent",{turn:-1})},e.prototype.startRightTurn=function(){this.fire("input-persistent",{turn:1})},e.prototype.stopTurn=function(){this.fire("input-persistent",{turn:0})},e}(polymer.Base);__decorate([property({type:Number,value:.8})],Helm.prototype,"zoom",void 0),__decorate([property({type:Boolean})],Helm.prototype,"active",void 0),__decorate([listen("wheel")],Helm.prototype,"handleZoom",null),__decorate([observe("active")],Helm.prototype,"activeUpdate",null),Helm=__decorate([component("helm-station")],Helm),Helm.register();
},{"../../core/math":52}],33:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,i){var s,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(r=(n<3?s(r):n>3?s(t,o,r):s(t,o))||r);return n>3&&r&&Object.defineProperty(t,o,r),r},math_1=require("../../core/math"),util_1=require("../../core/util"),TAP_RANGE=20,Science=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.draw=function(e,t){this.$.map.draw(e,t)},t.prototype.handleZoom=function(e){this.zoom=math_1.clamp(this.zoom+e.deltaY/1e3,0,1),e.preventDefault()},t.prototype.handleMapTap=function(e){if(this.db){var t=null,o=null,i=null;for(var s in this.db.names){var n=this.db.positions[s];if(n){var r=math_1.dist(e.detail.world,this.db.positions[s]);(null===i||r<i)&&(t=s,o=n,i=r)}}if(null!==t){var c=math_1.dist(e.detail.screen,this.$.map.worldToScreen(o.x,o.y));if(c<=TAP_RANGE)return void(this.selectedId=t)}this.selectedId=null}},t.prototype.observeSelectedId=function(e){return e?void(this.selected={id:e,name:this.db.names[e].name,distance:this.dist(e,this.shipId),heading:this.heading(e,this.shipId)}):void(this.selected=null)},t.prototype.observeNames=function(){this.selected&&this.set("selected.name",this.db.names[this.selected.id].name)},t.prototype.observePositions=function(e){this.shipId&&this.selected&&(0!==e.path.indexOf("db.positions."+this.shipId+".")&&0!==e.path.indexOf("db.positions."+this.selected.id+".")||(this.set("selected.distance",this.dist(this.selectedId,this.shipId)),this.set("selected.heading",this.heading(this.selectedId,this.shipId))))},t.prototype.hideResults=function(){this.scanResults=null},t.prototype.scan=function(){var e=this;this.scanning=!0,this.scanResults=null,setTimeout(function(){e.scanning=!1,e.scanResults="Goats Teleported: "+1e5*Math.random()},1e3)},t.prototype.dist=function(e,t){var o=math_1.dist(this.db.positions[e],this.db.positions[t]);return util_1.formatNumber(o)+"m"},t.prototype.heading=function(e,t){var o=math_1.heading(this.db.positions[e],this.db.positions[t]);return o.toFixed(0)+"Â°"},t}(polymer.Base);__decorate([property({type:Object})],Science.prototype,"db",void 0),__decorate([property({type:String})],Science.prototype,"shipId",void 0),__decorate([property({type:Number,value:.2})],Science.prototype,"zoom",void 0),__decorate([property({type:String})],Science.prototype,"selectedId",void 0),__decorate([property({type:Object})],Science.prototype,"selected",void 0),__decorate([property({type:Boolean,value:!1})],Science.prototype,"scanning",void 0),__decorate([property({type:String})],Science.prototype,"scanResults",void 0),__decorate([listen("wheel")],Science.prototype,"handleZoom",null),__decorate([listen("map-tap")],Science.prototype,"handleMapTap",null),__decorate([observe("selectedId")],Science.prototype,"observeSelectedId",null),__decorate([observe("db.names.*")],Science.prototype,"observeNames",null),__decorate([observe("db.positions.*")],Science.prototype,"observePositions",null),__decorate([observe("selected")],Science.prototype,"hideResults",null),Science=__decorate([component("science-station")],Science),Science.register();
},{"../../core/math":52,"../../core/util":65}],34:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},__decorate=this&&this.__decorate||function(e,t,r,n){var o,c=arguments.length,i=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(i=(c<3?o(i):c>3?o(t,r,i):o(t,r))||i);return c>3&&i&&Object.defineProperty(t,r,i),i},Viewscreen=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.draw=function(e,t){this.renderer&&this.renderer.draw(e,t)},t.prototype.activeChanged=function(e){var t=this;e?this.async(function(){t.renderer=t.$$("#renderer")}):this.renderer=null},t}(polymer.Base);__decorate([property({type:Boolean})],Viewscreen.prototype,"active",void 0),__decorate([observe("active")],Viewscreen.prototype,"activeChanged",null),Viewscreen=__decorate([component("viewscreen-station")],Viewscreen),Viewscreen.register();
},{}],35:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var p in e)e.hasOwnProperty(p)&&(t[p]=e[p]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__decorate=this&&this.__decorate||function(t,e,o,p){var r,n=arguments.length,i=n<3?e:null===p?p=Object.getOwnPropertyDescriptor(e,o):p;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,p);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(i=(n<3?r(i):n>3?r(e,o,i):r(e,o))||i);return n>3&&i&&Object.defineProperty(e,o,i),i},math_1=require("../../core/math"),Weapons=function(t){function e(){return t.apply(this,arguments)||this}return __extends(e,t),e.prototype.draw=function(t,e){this.$.map.draw(t,e)},e.prototype.handleMapTap=function(t){if(this.shipId&&this.db){var e=this.db.positions[this.shipId];if(e){var o={heading:math_1.heading(t.detail.world,this.db.positions[this.shipId]),target:t.detail.world,weapon:this.weapon};this.fire("input",{fireWeapons:[o]})}}},e}(polymer.Base);__decorate([property({type:Object})],Weapons.prototype,"db",void 0),__decorate([property({type:String})],Weapons.prototype,"shipId",void 0),__decorate([property({type:Object})],Weapons.prototype,"weapon",void 0),__decorate([listen("map-tap")],Weapons.prototype,"handleMapTap",null),Weapons=__decorate([component("weapons-station")],Weapons),Weapons.register();
},{"../../core/math":52}],36:[function(require,module,exports){
"use strict";function snap(n){return Math.round(n+const_1.HP)-const_1.HP}function lerp(n,r,t){return r+t*(n-r)}var const_1=require("./const");exports.snap=snap,exports.lerp=lerp;
},{"./const":6}],37:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var n,p=arguments.length,c=p<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(c=(p<3?n(c):p>3?n(t,o,c):n(t,o))||c);return p>3&&c&&Object.defineProperty(t,o,c),c},weapon_1=require("../core/weapon"),WeaponSelector=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.weapons=function(e){var t=this.db.healths[e];if(t)return this.selected||(this.selected=t.weapons[0]),t.weapons},t.prototype.weaponName=function(e){return weapon_1.WeaponType[e]},t.prototype.select=function(e){this.selected=e.model.item},t.prototype.isSelected=function(e){return e===this.selected},t}(polymer.Base);__decorate([property({type:Object})],WeaponSelector.prototype,"db",void 0),__decorate([property({type:String})],WeaponSelector.prototype,"shipId",void 0),__decorate([property({type:Object,notify:!0})],WeaponSelector.prototype,"selected",void 0),WeaponSelector=__decorate([component("weapon-selector")],WeaponSelector),exports.WeaponSelector=WeaponSelector,WeaponSelector.register();
},{"../core/weapon":66}],38:[function(require,module,exports){
"use strict";exports.RTC_CONFIG={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]};
},{}],39:[function(require,module,exports){
var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},__decorate=this&&this.__decorate||function(e,t,o,r){var n,c=arguments.length,i=c<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(i=(c<3?n(i):c>3?n(t,o,i):n(t,o))||i);return c>3&&i&&Object.defineProperty(t,o,i),i},WelcomeScreen=function(e){function t(){return e.apply(this,arguments)||this}return __extends(t,e),t.prototype.fireJoin=function(){this.fire("join")},t.prototype.fireHost=function(){this.fire("host")},t}(polymer.Base);WelcomeScreen=__decorate([component("bridgesim-welcome-screen")],WelcomeScreen),WelcomeScreen.register();
},{}],40:[function(require,module,exports){
"use strict";var db_1=require("./entity/db"),now;try{performance.now(),now=performance.now.bind(performance)}catch(t){now=function(){return Date.now()}}var Client=function(){function t(t,s){this.con=t,this.getCommands=s,this.welcomed=!1,this.updates=[],this.nextSeq=0,this.sendCommandsTimeout=null,this.fwdMessages=t.onMessage,t.onMessage=this.onMessage.bind(this)}return t.prototype.stop=function(){console.log("client: stopped"),null!==this.sendCommandsTimeout&&(clearTimeout(this.sendCommandsTimeout),this.sendCommandsTimeout=null),this.con.onMessage=null},t.prototype.onMessage=function(t,s,e){t.welcome?this.onWelcome(t.welcome):t.update&&this.onUpdate(t.update),this.fwdMessages&&this.fwdMessages(t,s,e)},t.prototype.onWelcome=function(t){return this.welcomed?void console.error("client: already welcomed"):(this.db=new db_1.Db,this.db.apply(t.snapshot),this.settings=this.db.findSettings(),this.settings?(this.savePrevPositions(),this.lastHostSeq=t.snapshot.hostSeq,this.updateInterval=this.settings.updateInterval,this.lastUpdateTime=now(),this.welcomed=!0,void(this.sendCommandsTimeout=setTimeout(this.sendCommands.bind(this),this.settings.tickInterval))):(console.error("client: no settings object found"),void this.stop()))},t.prototype.onUpdate=function(t){this.updates.push(t);var s=now();this.updateInterval=s-this.lastUpdateTime,this.lastUpdateTime=s},t.prototype.sendCommands=function(){this.sendCommandsTimeout=setTimeout(this.sendCommands.bind(this),this.settings.tickInterval);var t=this.getCommands();t.seq=this.nextSeq++,this.con.send({commands:t},!1)},t.prototype.update=function(s){if(!this.welcomed)return void console.error("client: not welcomed");for(this.updates.sort(t.compareHostSeq);this.updates.length;){var e=this.updates[0],o=e.hostSeq-this.lastHostSeq;if(o<1)this.updates.shift();else{if(o>1){console.error("client: missed "+(o-1)+" update(s)");break}this.savePrevPositions(),this.db.apply(e),this.lastHostSeq=e.hostSeq,this.lastIntegratedSeq=e.clientSeq,this.updates.shift()}}return Math.min(1,(s-this.lastUpdateTime)/this.updateInterval)},t.compareHostSeq=function(t,s){return t.hostSeq-s.hostSeq},t.prototype.savePrevPositions=function(){for(var t in this.db.positions){var s=this.db.positions[t],e=this.db.prevPositions[t];e||(e=this.db.newPrevPosition(t)),e.x=s.x,e.y=s.y,e.yaw=s.yaw,e.roll=s.roll}},t}();exports.Client=Client;
},{"./entity/db":44}],41:[function(require,module,exports){
"use strict";var math_1=require("../math"),BoxCollider=function(){function t(t,i,s,h,o){this.x=t,this.y=i,this.width=s,this.height=h,this.mass=o}return t.prototype.isOverlap=function(t){return math_1.overlap(this,t)},t.prototype.resolveCollision=function(t){var i=1.5,s=this.mass/(this.mass+t.mass),h=.5*(this.width+t.width)-Math.abs(t.x-this.x),o=.5*(this.height+t.height)-Math.abs(t.y-this.y);this.x>t.x?(this.x+=i*s*h,t.x-=i*s*h):(this.x-=i*s*h,t.x+=i*s*h),this.y>t.y?(this.y+=i*s*o,t.y-=i*s*o):(this.y-=i*s*o,t.y+=i*s*o)},t}();exports.BoxCollider=BoxCollider;
},{"../math":52}],42:[function(require,module,exports){
"use strict";var Component=function(){function n(){this.changed=!0,this.change={}}return n.prototype.clearChange=function(){this.change={},this.changed=!1},n.prototype.full=function(){for(var n={},t=0,o=this.props||[];t<o.length;t++){var e=o[t];n[e]=this[e]}return n},n.prop=function(n,t){var o=t+"_";Object.defineProperty(n,t,{get:function(){return this[o]},set:function(n){n!==this[o]&&(this[o]=n,this.change[t]=n,this.changed=!0)}}),n.props||(n.props=[]),n.props.push(t)},n}();exports.Component=Component;var Database=function(){function n(){this.removed=[],this.nextId=0}return n.prototype.spawn=function(){return(this.nextId++).toString()},n.prototype.remove=function(n){this.removed.push(n);for(var t in this.components)delete this[t][n]},n.prototype.changes=function(){var n=!1,t={};for(var o in this.components)for(var e in this[o]){var r=this[o][e];r.changed&&(t.components||(t.components={}),t.components[o]||(t.components[o]={}),t.components[o][e]=r.change,r.clearChange(),n=!0)}return this.removed.length&&(t.removed=this.removed,this.removed=[],n=!0),n?t:null},n.prototype.full=function(){var n={full:!0,components:{}};for(var t in this.components)for(var o in this[t]){var e=this[t][o];n.components[t]||(n.components[t]={}),n.components[t][o]=e.full()}return n},n.prototype.apply=function(n){var t={};for(var o in n.components)if(this[o])for(var e in n.components[o]){var r=this[o][e];r||(r=this[o][e]=new this.components[o]);for(var s in n.components[o][e])r[s]=n.components[o][e][s];n.full&&(t[e]=!0)}else console.error("unknown component:",o);if(n.removed)for(var i=0,p=n.removed;i<p.length;i++){var e=p[i];this.remove(e)}if(n.full)for(var c in this.components)for(var e in this[c])t[e]||this.remove(e)},n.table=function(n){return function(t,o){t.components||(t.components={}),t.components[o]=n;var e="new"+o.charAt(0).toUpperCase()+o.slice(1)+"_";t[e]=function(t){var e=new n;return this[o][t]=e,e}}},n}();exports.Database=Database;
},{}],43:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(o,e){function t(){this.constructor=o}for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);o.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)},__decorate=this&&this.__decorate||function(o,e,t,r){var p,n=arguments.length,i=n<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(o,e,t,r);else for(var d=o.length-1;d>=0;d--)(p=o[d])&&(i=(n<3?p(i):n>3?p(e,t,i):p(e,t))||i);return n>3&&i&&Object.defineProperty(e,t,i),i},comdb_1=require("./comdb"),scenarios_1=require("../scenarios/scenarios"),Ai=function(o){function e(){return o.apply(this,arguments)||this}return __extends(e,o),e}(comdb_1.Component);exports.Ai=Ai,__decorate([comdb_1.Component.prop],Ai.prototype,"targetID",void 0),__decorate([comdb_1.Component.prop],Ai.prototype,"targetPos",void 0),__decorate([comdb_1.Component.prop],Ai.prototype,"friendliness",void 0);var Collidable=function(o){function e(){var e=o.apply(this,arguments)||this;return e.length=0,e.width=0,e.ignore="",e.mass=0,e.damage=0,e}return __extends(e,o),e}(comdb_1.Component);exports.Collidable=Collidable,__decorate([comdb_1.Component.prop],Collidable.prototype,"length",void 0),__decorate([comdb_1.Component.prop],Collidable.prototype,"width",void 0),__decorate([comdb_1.Component.prop],Collidable.prototype,"ignore",void 0),__decorate([comdb_1.Component.prop],Collidable.prototype,"mass",void 0),__decorate([comdb_1.Component.prop],Collidable.prototype,"damage",void 0);var Debris=function(o){function e(){return o.apply(this,arguments)||this}return __extends(e,o),e}(comdb_1.Component);exports.Debris=Debris,__decorate([comdb_1.Component.prop],Debris.prototype,"type",void 0),function(o){o[o.ASTEROID=0]="ASTEROID"}(exports.DebrisType||(exports.DebrisType={}));var DebrisType=exports.DebrisType,Health=function(o){function e(){var e=o.apply(this,arguments)||this;return e.hp=0,e.hpMax=0,e.shieldsUp=!1,e.shields=0,e.shieldsMax=0,e.weapons=[],e}return __extends(e,o),e.prototype.damage=function(o){this.shieldsUp?(this.shields-=o,this.shields<0&&(this.hp+=this.shields,this.shields=0)):this.hp-=o},e}(comdb_1.Component);exports.Health=Health,__decorate([comdb_1.Component.prop],Health.prototype,"hp",void 0),__decorate([comdb_1.Component.prop],Health.prototype,"hpMax",void 0),__decorate([comdb_1.Component.prop],Health.prototype,"shieldsUp",void 0),__decorate([comdb_1.Component.prop],Health.prototype,"shields",void 0),__decorate([comdb_1.Component.prop],Health.prototype,"shieldsMax",void 0),__decorate([comdb_1.Component.prop],Health.prototype,"weapons",void 0);var Name=function(o){function e(){var e=o.apply(this,arguments)||this;return e.name="",e}return __extends(e,o),e}(comdb_1.Component);exports.Name=Name,__decorate([comdb_1.Component.prop],Name.prototype,"name",void 0);var Odometer=function(o){function e(){var e=o.apply(this,arguments)||this;return e.meters=0,e}return __extends(e,o),e}(comdb_1.Component);exports.Odometer=Odometer,__decorate([comdb_1.Component.prop],Odometer.prototype,"meters",void 0);var Laser=function(o){function e(){return o.apply(this,arguments)||this}return __extends(e,o),e}(comdb_1.Component);exports.Laser=Laser;var Missile=function(o){function e(){return o.apply(this,arguments)||this}return __extends(e,o),e}(comdb_1.Component);exports.Missile=Missile;var Player=function(o){function e(){var e=o.apply(this,arguments)||this;return e.name="",e.shipId="",e.inputs=[],e.latestSeq=null,e}return __extends(e,o),e}(comdb_1.Component);exports.Player=Player,__decorate([comdb_1.Component.prop],Player.prototype,"name",void 0),__decorate([comdb_1.Component.prop],Player.prototype,"shipId",void 0),__decorate([comdb_1.Component.prop],Player.prototype,"station",void 0);var Position=function(o){function e(){var e=o.apply(this,arguments)||this;return e.x=0,e.y=0,e.yaw=0,e.roll=0,e}return __extends(e,o),e}(comdb_1.Component);exports.Position=Position,__decorate([comdb_1.Component.prop],Position.prototype,"x",void 0),__decorate([comdb_1.Component.prop],Position.prototype,"y",void 0),__decorate([comdb_1.Component.prop],Position.prototype,"yaw",void 0),__decorate([comdb_1.Component.prop],Position.prototype,"roll",void 0);var Power=function(o){function e(){var e=o.apply(this,arguments)||this;return e.engine=0,e.maneuvering=0,e.shields=0,e.laser=0,e.missile=0,e.sensor=0,e.ftl=0,e}return __extends(e,o),e}(comdb_1.Component);exports.Power=Power,__decorate([comdb_1.Component.prop],Power.prototype,"engine",void 0),__decorate([comdb_1.Component.prop],Power.prototype,"maneuvering",void 0),__decorate([comdb_1.Component.prop],Power.prototype,"shields",void 0),__decorate([comdb_1.Component.prop],Power.prototype,"laser",void 0),__decorate([comdb_1.Component.prop],Power.prototype,"missile",void 0),__decorate([comdb_1.Component.prop],Power.prototype,"sensor",void 0),__decorate([comdb_1.Component.prop],Power.prototype,"ftl",void 0);var Resources=function(o){function e(){var e=o.apply(this,arguments)||this;return e.energy=0,e.missile=0,e}return __extends(e,o),e}(comdb_1.Component);exports.Resources=Resources,__decorate([comdb_1.Component.prop],Resources.prototype,"energy",void 0),__decorate([comdb_1.Component.prop],Resources.prototype,"missile",void 0);var Ship=function(o){function e(){return o.apply(this,arguments)||this}return __extends(e,o),e}(comdb_1.Component);exports.Ship=Ship;var Station=function(o){function e(){var e=o.apply(this,arguments)||this;return e.produces={},e}return __extends(e,o),e}(comdb_1.Component);exports.Station=Station,__decorate([comdb_1.Component.prop],Station.prototype,"produces",void 0);var Motion=function(o){function e(){var e=o.apply(this,arguments)||this;return e.thrust=0,e.velocityX=0,e.velocityY=0,e}return __extends(e,o),e}(comdb_1.Component);exports.Motion=Motion,__decorate([comdb_1.Component.prop],Motion.prototype,"thrust",void 0),__decorate([comdb_1.Component.prop],Motion.prototype,"velocityX",void 0),__decorate([comdb_1.Component.prop],Motion.prototype,"velocityY",void 0);var Ftl=function(o){function e(){var e=o.apply(this,arguments)||this;return e.x=null,e.y=null,e.progress=null,e.eta=null,e}return __extends(e,o),e}(comdb_1.Component);exports.Ftl=Ftl,__decorate([comdb_1.Component.prop],Ftl.prototype,"x",void 0),__decorate([comdb_1.Component.prop],Ftl.prototype,"y",void 0),__decorate([comdb_1.Component.prop],Ftl.prototype,"progress",void 0),__decorate([comdb_1.Component.prop],Ftl.prototype,"eta",void 0);var Settings=function(o){function e(){var e=o.apply(this,arguments)||this;return e.token="",e.started=!1,e.updateInterval=1e3/30,e.tickInterval=1e3/30,e.galaxySize=12,e.scenarioName=scenarios_1.scenarios[0].name,e}return __extends(e,o),e}(comdb_1.Component);exports.Settings=Settings,__decorate([comdb_1.Component.prop],Settings.prototype,"token",void 0),__decorate([comdb_1.Component.prop],Settings.prototype,"started",void 0),__decorate([comdb_1.Component.prop],Settings.prototype,"updateInterval",void 0),__decorate([comdb_1.Component.prop],Settings.prototype,"tickInterval",void 0),__decorate([comdb_1.Component.prop],Settings.prototype,"galaxySize",void 0),__decorate([comdb_1.Component.prop],Settings.prototype,"scenarioName",void 0);
},{"../scenarios/scenarios":74,"./comdb":42}],44:[function(require,module,exports){
"use strict";var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},__decorate=this&&this.__decorate||function(t,e,o,r){var n,s=arguments.length,i=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(i=(s<3?n(i):s>3?n(e,o,i):n(e,o))||i);return s>3&&i&&Object.defineProperty(e,o,i),i},comdb_1=require("../comdb"),C=require("../components"),Db=function(t){function e(){var e=t.apply(this,arguments)||this;return e.ais={},e.collidables={},e.debris={},e.healths={},e.lasers={},e.missiles={},e.names={},e.odometers={},e.players={},e.positions={},e.prevPositions={},e.power={},e.resources={},e.ships={},e.stations={},e.motion={},e.ftl={},e.settings={},e.inputs={},e}return __extends(e,t),e.prototype.newAi=function(t){return this.newAis_(t)},e.prototype.newCollidable=function(t){return this.newCollidables_(t)},e.prototype.newDebris=function(t){return this.newDebris_(t)},e.prototype.newHealth=function(t){return this.newHealths_(t)},e.prototype.newLaser=function(t){return this.newLasers_(t)},e.prototype.newMissile=function(t){return this.newMissiles_(t)},e.prototype.newName=function(t){return this.newNames_(t)},e.prototype.newOdometer=function(t){return this.newOdometers_(t)},e.prototype.newPlayer=function(t){return this.newPlayers_(t)},e.prototype.newPosition=function(t){return this.newPositions_(t)},e.prototype.newPrevPosition=function(t){return this.newPrevPositions_(t)},e.prototype.newPower=function(t){return this.newPower_(t)},e.prototype.newResources=function(t){return this.newResources_(t)},e.prototype.newShip=function(t){return this.newShips_(t)},e.prototype.newStation=function(t){return this.newStations_(t)},e.prototype.newMotion=function(t){return this.newMotion_(t)},e.prototype.newFtl=function(t){return this.newFtl_(t)},e.prototype.newSettings=function(t){return this.newSettings_(t)},e.prototype.findSettings=function(){var t=Object.keys(this.settings);return t.length>0?this.settings[t[0]]:null},e}(comdb_1.Database);exports.Db=Db,__decorate([comdb_1.Database.table(C.Ai)],Db.prototype,"ais",void 0),__decorate([comdb_1.Database.table(C.Collidable)],Db.prototype,"collidables",void 0),__decorate([comdb_1.Database.table(C.Debris)],Db.prototype,"debris",void 0),__decorate([comdb_1.Database.table(C.Health)],Db.prototype,"healths",void 0),__decorate([comdb_1.Database.table(C.Laser)],Db.prototype,"lasers",void 0),__decorate([comdb_1.Database.table(C.Missile)],Db.prototype,"missiles",void 0),__decorate([comdb_1.Database.table(C.Name)],Db.prototype,"names",void 0),__decorate([comdb_1.Database.table(C.Odometer)],Db.prototype,"odometers",void 0),__decorate([comdb_1.Database.table(C.Player)],Db.prototype,"players",void 0),__decorate([comdb_1.Database.table(C.Position)],Db.prototype,"positions",void 0),__decorate([comdb_1.Database.table(C.Position)],Db.prototype,"prevPositions",void 0),__decorate([comdb_1.Database.table(C.Power)],Db.prototype,"power",void 0),__decorate([comdb_1.Database.table(C.Resources)],Db.prototype,"resources",void 0),__decorate([comdb_1.Database.table(C.Ship)],Db.prototype,"ships",void 0),__decorate([comdb_1.Database.table(C.Station)],Db.prototype,"stations",void 0),__decorate([comdb_1.Database.table(C.Motion)],Db.prototype,"motion",void 0),__decorate([comdb_1.Database.table(C.Ftl)],Db.prototype,"ftl",void 0),__decorate([comdb_1.Database.table(C.Settings)],Db.prototype,"settings",void 0);
},{"../comdb":42,"../components":43}],45:[function(require,module,exports){
"use strict";function SpawnDebris(e,a,n){var t=e.spawn(),r=e.newDebris(t);r.type=components_1.DebrisType.ASTEROID;var s=e.newHealth(t);s.hp=1e4;var o=e.newPosition(t);o.x=a,o.y=n,o.yaw=360*Math.random();var i=e.newCollidable(t);return i.length=math_1.randInt(MIN_DEBRIS_METERS,MAX_DEBRIS_METERS),i.width=i.length,i.mass=1e4,i.damage=20,t}function SpawnAstroidBelt(e,a,n,t,r){for(var s=5e3,o=5e-4,i=t-a,p=r-n,S=Math.sqrt(i*i+p*p),w=S*o,E=i/w,h=p/w,M=0;M<w;M++)SpawnDebris(e,a+E*M+Math.random()*s,n+h*M+Math.random()*s)}var components_1=require("../components"),math_1=require("../math"),MIN_DEBRIS_METERS=1e3,MAX_DEBRIS_METERS=100;exports.SpawnDebris=SpawnDebris,exports.SpawnAstroidBelt=SpawnAstroidBelt;
},{"../components":43,"../math":52}],46:[function(require,module,exports){
"use strict";function SpawnLaser(e,r,n,a,t,s,w){var i=e.resources[r];if(i){if(i.energy<LASER_ENERGY)return;i.energy-=LASER_ENERGY}var o=e.spawn(),E=e.newLaser(o);E.range=s;var L=e.newPosition(o);L.x=n,L.y=a,L.yaw=t,e.newMotion(o).thrust=500,e.newOdometer(o),e.newHealth(o).hp=1;var g=e.newCollidable(o);return g.length=10,g.width=10,g.damage=w,g.ignore=r,o}var LASER_ENERGY=10;exports.SpawnLaser=SpawnLaser;
},{}],47:[function(require,module,exports){
"use strict";function SpawnMissile(e,i,s,n,t,l){var o=e.resources[i];if(o){if(o.missile<=0)return;o.missile--}var r=e.spawn(),a=e.newMissile(r);a.range=l;var w=e.newPosition(r);w.x=s,w.y=n,w.yaw=t;var v=e.newMotion(r),c=e.motion[i];v.thrust=5,v.velocityX=c.velocityX,v.velocityY=c.velocityY,e.newOdometer(r),e.newHealth(r).hp=1;var m=e.newCollidable(r);return m.length=1e3,m.width=1e3,m.damage=20,m.ignore=i,console.log("entity.missile: spawned missile",r),r}exports.SpawnMissile=SpawnMissile;
},{}],48:[function(require,module,exports){
"use strict";function SpawnShip(e,a,n,i,s,p){void 0===p&&(p=0);var r=e.spawn();e.newShip(r),a||(a="S"+r);var o=e.newName(r);o.name=a;var t=e.newPosition(r);t.x=n,t.y=i,t.yaw=120,e.newMotion(r),e.inputs[r]=[];var w=e.newCollidable(r);w.length=300,w.width=300,w.mass=10,w.damage=10;var l=e.newHealth(r);l.hp=100,l.hpMax=100,l.shieldsUp=!0,l.shields=100,l.shieldsMax=100,l.weapons=[{type:weapon_1.WeaponType.Laser,range:5e3,direction:Math.PI,angle:7*Math.PI/4,damage:1},{type:weapon_1.WeaponType.Laser,range:1e4,direction:0,angle:Math.PI/4,damage:2},{type:weapon_1.WeaponType.Missile,range:15e3,direction:0,angle:2*Math.PI}];var h=e.newPower(r);h.engine=.75,h.maneuvering=.75,h.shields=.75,h.ftl=.3;var d=e.newResources(r);if(d.energy=1e3,d.missile=2,s){var g=e.newAi(r);g.friendliness=p}else e.newFtl(r);return console.log("entity.ship: spawned ship",r,a),r}var weapon_1=require("../weapon");exports.SpawnShip=SpawnShip;
},{"../weapon":66}],49:[function(require,module,exports){
"use strict";function SpawnStation(e,a,n,t){var s=e.spawn(),i=e.newStation(s);e.newResources(s),i.produces.missile=60,i.produces.energy=1,a||(a="Station "+s);var o=e.newName(s);o.name=a;var r=e.newPosition(s);r.x=n,r.y=t;var p=e.newCollidable(s);p.length=300,p.width=300,p.mass=1e3,p.damage=10;var w=e.newHealth(s);w.hp=1e3,w.hpMax=1e3,w.shieldsUp=!0,w.shields=1e3,w.shieldsMax=1e3,w.weapons=[{type:weapon_1.WeaponType.Laser,range:5e3,direction:0,angle:2*Math.PI,damage:1}];var l=e.newAi(s);return l.friendliness=1,console.log("entity.station: spawned station",s,a),s}var weapon_1=require("../weapon");exports.SpawnStation=SpawnStation;
},{"../weapon":66}],50:[function(require,module,exports){
"use strict";function maxCoord(r){return r*exports.SECTOR_METERS/2}function randCoord(r){var o=maxCoord(r);return math_1.randInt(-o,o)}function randPoint(r){return{x:randCoord(r),y:randCoord(r)}}var math_1=require("./math");exports.SECTOR_METERS=1e4,exports.maxCoord=maxCoord,exports.randCoord=randCoord,exports.randPoint=randPoint;
},{"./math":52}],51:[function(require,module,exports){
"use strict";var Net=require("../net/message"),scenarios_1=require("../scenarios/scenarios"),db_1=require("./entity/db"),ship_1=require("./entity/ship"),ai_1=require("./systems/ai"),collision_1=require("./systems/collision"),death_1=require("./systems/death"),input_1=require("./systems/input"),laser_1=require("./systems/laser"),missile_1=require("./systems/missile"),motion_1=require("./systems/motion"),shields_1=require("./systems/shields"),station_1=require("./systems/station"),ftl_1=require("./systems/ftl"),COMMAND_BUFFER_SIZE=100,Host=function(){function t(){this.db=new db_1.Db,this.settings=this.db.newSettings(this.db.spawn()),this.collision=new collision_1.Collision(this.db,this.settings.galaxySize),this.systems=[this.collision,new ai_1.Ai(this.db,this.settings.galaxySize,this.collision),new death_1.Death(this.db),new input_1.Input(this.db),new laser_1.Laser(this.db),new missile_1.Missile(this.db),new ftl_1.Ftl(this.db),new motion_1.Motion(this.db,this.settings.galaxySize),new shields_1.Shields(this.db),new station_1.Station(this.db)],this.conns={},this.timeoutId=null,this.prevTs=0,this.tickLag=0,this.snapshotLag=0,this.snapshotStale=!1,this.seq=0}return t.prototype.addConnection=function(t){var s=this,e=this.db.spawn();this.conns[e]=t,console.log("host: connection added",e),t.onMessage=function(t){s.onMessage(e,t)},t.onClose=function(){console.log("host: connection closed",e),t.onMessage=null,s.db.remove(e),delete s.conns[e],s.announce("player "+e+" disconnected")}},t.prototype.start=function(){console.log("host: starting"),this.spawnShip("USS Default",0,0,!1),this.tick()},t.prototype.stop=function(){null!==this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null);for(var t in this.conns)this.conns[t].close();console.log("host: stopped")},t.prototype.spawnShip=function(t,s,e,i){return ship_1.SpawnShip(this.db,t,s,e,i)},t.prototype.broadcast=function(t,s){for(var e in this.db.players)this.conns[e].send(t,s)},t.prototype.tick=function(){this.timeoutId=setTimeout(this.tick.bind(this),this.settings.tickInterval);var t=performance.now(),s=t-this.prevTs;this.tickLag+=s,this.snapshotLag+=s;for(var e=Math.floor(this.tickLag/this.settings.tickInterval),i=0;i<e;i++){for(var n in this.db.players){var o=this.db.players[n];if(null!=o.shipId){var a=o.inputs[o.inputs.length-e+i];if(a){var r=this.db.inputs[o.shipId];null!=r&&r.push(a)}}}for(var h=0,l=this.systems;h<l.length;h++){var p=l[h];p.tick()}this.tickLag-=this.settings.tickInterval,this.snapshotStale=!0}if(e>0)for(var d in this.db.players)this.db.players[d].inputs=[];if(this.snapshotStale&&this.snapshotLag>=this.settings.updateInterval){var c=this.db.changes();if(c){this.seq++;for(var d in this.db.players)c.hostSeq=this.seq,c.clientSeq=this.db.players[d].latestSeq,this.conns[d].send({update:c},!1);this.snapshotLag=0,this.snapshotStale=!1}}this.prevTs=t},t.prototype.announce=function(t){this.broadcast({receiveChat:{timestamp:Date.now(),announce:!0,text:t}},!0)},t.prototype.onMessage=function(t,s){s.hello?this.onHello(t,s.hello):s.sendChat?this.onSendChat(t,s.sendChat):s.commands?this.onCommands(t,s.commands):s.createShip?this.onCreateShip(t,s.createShip):s.joinCrew?this.onJoinCrew(t,s.joinCrew):s.updatePlayer?this.onUpdatePlayer(t,s.updatePlayer):s.updateSettings&&this.onUpdateSettings(t,s.updateSettings)},t.prototype.onHello=function(t,s){var e=this.findFreeCrewSlot(s.forceStation),i=e.shipId,n=e.station,o=this.db.newPlayer(t);o.name=s.name,o.shipId=i,o.station=n,console.log("new player",t,i,n);var a=this.db.full();a.hostSeq=this.seq;var r={playerId:t,snapshot:a};console.log("host: sending welcome",t),this.conns[t].send({welcome:r},!0),this.announce("player "+o.name+" ("+t+") joined")},t.prototype.findFreeCrewSlot=function(t){for(var s=[Net.Station.Helm,Net.Station.Engineering,Net.Station.Weapons,Net.Station.Science,Net.Station.Comms],e=0,i=t?[t]:s;e<i.length;e++){var n=i[e];for(var o in this.db.ships)if(!this.db.ais[o]){var a=!0;for(var r in this.db.players){var h=this.db.players[r];if(h.shipId===o&&h.station===n){a=!1;break}}if(a)return{shipId:o,station:n}}}return{shipId:this.spawnShip(null,0,0,!1),station:null!=t?t:Net.Station.Helm}},t.prototype.onUpdatePlayer=function(t,s){var e=this.db.players[t],i=e.name;e.name=s.name,this.announce("player "+i+" ("+t+") has changed their name to "+e.name)},t.prototype.onCreateShip=function(t,s){this.spawnShip(s.name,0,0,!1)},t.prototype.onJoinCrew=function(t,s){console.log("joinCrew",t,JSON.stringify(s));var e=s.shipId;if(this.db.ships[e]){var i=(s.station,this.db.players[t]);i.shipId=s.shipId,i.station=s.station}},t.prototype.onSendChat=function(t,s){var e=this.db.players[t]&&this.db.players[t].name||t,i={timestamp:Date.now(),playerId:t,name:e,text:s.text};this.broadcast({receiveChat:i},!0)},t.prototype.onCommands=function(t,s){var e=this.db.players[t];s.seq<=e.latestSeq||(e.inputs.length==COMMAND_BUFFER_SIZE&&e.inputs.shift(),e.inputs.push(s),e.latestSeq=s.seq)},t.prototype.onUpdateSettings=function(t,s){if(null!=s.scenarioName){this.settings.scenarioName=s.scenarioName;for(var e=0,i=scenarios_1.scenarios;e<i.length;e++){var n=i[e];if(n.name===s.scenarioName){this.scenario=n;break}}}s.started&&!this.settings.started?(this.scenario&&(console.log("host: loading scenario",this.scenario.name),this.scenario.start(this.db)),this.settings.started=!0):s.started===!1&&(this.settings.started=!1)},t}();exports.Host=Host;
},{"../net/message":69,"../scenarios/scenarios":74,"./entity/db":44,"./entity/ship":48,"./systems/ai":55,"./systems/collision":56,"./systems/death":57,"./systems/ftl":58,"./systems/input":59,"./systems/laser":60,"./systems/missile":61,"./systems/motion":62,"./systems/shields":63,"./systems/station":64}],52:[function(require,module,exports){
"use strict";function radians(t){return t*Math.PI/180}function degrees(t){return 180*t/Math.PI}function normalizeDegrees(t){for(;t<0;)t+=360;for(;t>360;)t-=360;return t}function randInt(t,r){return Math.floor(Math.random()*(r-t+1))+t}function clamp(t,r,n){return Math.min(n,Math.max(r,t))}function overlap(t,r){return 2*Math.abs(t.x-r.x)<=t.width+r.width&&2*Math.abs(t.y-r.y)<=t.height+r.height}function dist(t,r){return t&&r?exports.hypot(t.x-r.x,t.y-r.y):-1}function heading(t,r){return(Math.atan2(t.x-r.x,t.y-r.y)*(180/Math.PI)+360)%360}function headingToRadians(t){return radians(90-t)}exports.radians=radians,exports.degrees=degrees,exports.normalizeDegrees=normalizeDegrees,exports.randInt=randInt,exports.clamp=clamp,exports.overlap=overlap,exports.hypot=Math.hypot||function(t,r){return Math.sqrt(t*t+r*r)},exports.dist=dist,exports.heading=heading,exports.headingToRadians=headingToRadians;
},{}],53:[function(require,module,exports){
"use strict";var typescript_collections_1=require("typescript-collections"),galaxy_1=require("./galaxy"),math_1=require("./math"),Pathfinder=function(){function t(t,r,i){void 0===i&&(i=1200),this.db=t,this.precision=i;var e=galaxy_1.maxCoord(r);this.max=e;for(var o=2*e/i,n=Array(o),s=0;s<o;s++)n[s]=Array(o);var h=this.precision/2;for(var a in this.db.collidables)for(var u=this.db.collidables[a],c=u.length,p=u.width,y=Math.max(c,p)/2,f=this.db.positions[a],d=f.x,l=f.y,v=this.xyToArr({x:d-h-y,y:l-h-y}),x=this.xyToArr({x:d+h+y,y:l+h+y}),g=Math.max(0,v.x);g<=x.x&&g<o;g++)for(var m=Math.max(0,v.y);m<=x.y&&m<o;m++)n[g][m]||(n[g][m]=[]),n[g][m].push(a);this.nodes=n}return t.prototype.find=function(t,r,i,e){void 0===i&&(i=[]),void 0===e&&(e=[]),t=this.copyPoint(t),r=this.copyPoint(r);var o=this.validate(t,r,e,i);return o?o:this.findInternal(t,r,this.ignoreMap(i))},t.prototype.validate=function(t,r,i,e){if(void 0===e&&(e=[]),!i||0==i.length)return null;var o=this.ignoreMap(e),n=i[i.length-1];if(n.x!=r.x||n.y!=r.y)return null;for(var s=0,h=0,a=0;a<i.length;a++){var u=i[a],c=this.heuristic(t,u,o);if(c<0)return null;(0==a||c<h)&&(h=c,s=a)}return i.slice(s)},t.prototype.xyToArr=function(t){return{x:Math.floor((t.x+this.max)/this.precision),y:Math.floor((t.y+this.max)/this.precision)}},t.prototype.findInternal=function(t,r,i){var e=this.node(t),o=this.node(r),n=this.nodeID(e),s=this.nodeID(o),h={},a={},u={},c={};c[n]=0;var p={};p[n]=this.heuristic(e,o,i);var y={},f=new typescript_collections_1.PriorityQueue(function(t,r){return p[r]-p[t]});for(y[n]=e,f.enqueue(n);!f.isEmpty();){var d=f.dequeue(),l=y[d];if(d===s){var v=this.reconstructPath(h,d,y);return v[0]=t,v[v.length-1]=r,v}delete u[d],a[d]=!0;for(var x=0,g=this.neighbors(l);x<g.length;x++){var m=g[x],M=this.nodeID(m);if(!a[M]){var b=this.heuristic(l,m,i);if(!(b<0)){var P=c[d]+b;u[M]&&P>=c[M]||(h[M]=d,c[M]=P,p[M]=c[M]+this.heuristic(m,o,i),u[M]||(u[M]=!0,y[M]=m,f.enqueue(M)))}}}}return[]},t.prototype.ignoreMap=function(t){for(var r={},i=0,e=t;i<e.length;i++){var o=e[i];r[o]=!0}return r},t.prototype.copyPoint=function(t){return{x:t.x,y:t.y}},t.prototype.reconstructPath=function(t,r,i){for(var e=[];r;){var o=i[r],n=o.x,s=o.y;e.push({x:n+this.precision/2,y:s+this.precision/2}),r=t[r]}return e.reverse()},t.prototype.neighbors=function(t){var r=this;return[this.node(t,1,0),this.node(t,0,1),this.node(t,-1,0),this.node(t,0,-1),this.node(t,1,1),this.node(t,-1,-1),this.node(t,-1,1),this.node(t,1,-1)].filter(function(t){return t.x<r.max&&t.x>-r.max&&t.y<r.max&&t.y>-r.max})},t.prototype.node=function(t,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),{x:(Math.floor(t.x/this.precision)+r)*this.precision,y:(Math.floor(t.y/this.precision)+i)*this.precision}},t.prototype.nodeID=function(t){var r=this.node(t),i=r.x,e=r.y;return i+","+e},t.prototype.heuristic=function(t,r,i){var e=(.5*this.precision,math_1.dist(t,r)),o=this.xyToArr(r),n=o.x,s=o.y,h=this.nodes[n][s];if(h){for(var a=!1,u=0,c=h;u<c.length;u++){var p=c[u];if(i[p]){a=!0;break}}if(!a&&h.length>0)return-1}return e},t}();exports.Pathfinder=Pathfinder;
},{"./galaxy":50,"./math":52,"typescript-collections":71}],54:[function(require,module,exports){
"use strict";var math_1=require("./math"),Quadtree=function(){function t(t,i,e,h,s){void 0===s&&(s=5),this.left=t,this.top=i,this.right=e,this.bottom=h,this.max=s,this.subtrees=[],this.children=[],this.childrenPos=[],this.width=Math.abs(this.right-this.left),this.height=Math.abs(this.bottom-this.top)}return t.prototype.add=function(t){},t.prototype.clear=function(){this.children=[],this.subtrees=[]},t.prototype.insert=function(t,i,e,h,s){if(h<i||e>s)throw"invariant violated!";if(0===this.subtrees.length&&this.children.length+1>this.max){this.split();var r=this.children,o=this.childrenPos;this.children=[],this.childrenPos=[];for(var n=0;n<r.length;n++){var a=o[n];this.insert(r[n],a.left,a.top,a.right,a.bottom)}}var l=this.index(i,e,h,s);l<0||0===this.subtrees.length?(this.children.push(t),this.childrenPos.push({left:i,top:e,right:h,bottom:s})):this.subtrees[l].insert(t,i,e,h,s)},t.prototype.retrieve=function(t,i,e,h,s){if(void 0===s&&(s=!1),e<t||i>h)throw"invariant violated!";var r=this.retrievePos(t,i,e,h,s);return s?r.children.filter(function(s,o){var n=r.pos[o];return math_1.overlap({x:n.left,y:n.top,width:n.right-n.left,height:n.bottom-n.top},{x:t,y:i,width:e-t,height:h-i})}):r.children},t.prototype.retrievePos=function(t,i,e,h,s){for(var r,o=[],n=[],a=[this];a.length>0;){if(r=a.pop(),0!==r.subtrees.length){var l=r.index(t,i,e,h);if(l>=0){var u=r.subtrees[l];a.push(u)}else l===-1&&(a=a.concat(r.subtrees))}o=o.concat(r.children),s&&(n=n.concat(r.childrenPos))}return{children:o,pos:n}},t.prototype.split=function(){if(0!==this.subtrees.length)throw"quadtree already has been split";var i=(this.left+this.right)/2,e=(this.top+this.bottom)/2;this.subtrees[0]=new t(i,this.top,this.right,e,this.max),this.subtrees[1]=new t(this.left,this.top,i,e,this.max),this.subtrees[2]=new t(this.left,e,i,this.bottom,this.max),this.subtrees[3]=new t(i,e,this.right,this.bottom,this.max)},t.prototype.index=function(t,i,e,h){if(e<this.left||h<this.top||t>this.right||i>this.bottom)return-2;var s=(this.left+this.right)/2,r=(this.top+this.bottom)/2;if(e<s){if(h<r)return 1;if(i>r)return 2}else if(t>s){if(h<r)return 0;if(i>r)return 3}return-1},t}();exports.Quadtree=Quadtree;
},{"./math":52}],55:[function(require,module,exports){
"use strict";var galaxy_1=require("../galaxy"),math_1=require("../math"),pathfinding_1=require("../pathfinding"),util_1=require("../util"),weapon_1=require("../weapon"),closeDistance=5e3,Ai=function(){function t(t,i,n){var s=this;this.db=t,this.galaxySize=i,this.collision=n,this.previousPaths={},this.newPaths={},this.tickTargetting=util_1.every(.5,function(){var t=function(t){for(var i=(s.db.ais[t],s.db.positions[t]),n=i.x,e=i.y,o=(i.yaw,s.db.healths[t]),a=0,r=0,h=o.weapons;r<h.length;r++){var p=h[r];p.range>a&&(a=p.range)}for(var d=s.collision.quadtree.retrieve(n,e,n+2*a,e+2*a,!0),c=d.filter(function(i){return!(!s.db.ships[i]&&!s.db.stations[i])&&s.hostility(t,i)>1}),v=s.db.positions[t],f=0,l=o.weapons;f<l.length;f++){var p=l[f];if(!(p.type==weapon_1.WeaponType.Missile&&Math.random()>.1))for(var u=0,y=c;u<y.length;u++){var g=y[u];if(!(math_1.dist(v,s.db.positions[g])>p.range)){var b=math_1.heading(s.db.positions[g],s.db.positions[t]);if(weapon_1.fireWeapon(s.db,t,p,b))break}}}};for(var i in s.db.ais)t(i)}),this.tickMotion=util_1.every(1,function(){s.newPaths={};var t=new pathfinding_1.Pathfinder(s.db,s.galaxySize);for(var i in s.db.ais)s.db.motion[i]&&s.tickMotionOne(i,t);s.previousPaths=s.newPaths})}return t.prototype.tick=function(){this.tickMotion(),this.tickTargetting()},t.prototype.hostility=function(t,i){return Math.abs(this.factionScore(t)-this.factionScore(i))},t.prototype.factionScore=function(t){var i=this.db.ais[t];return i?i.friendliness:1},t.prototype.tickMotionOne=function(t,i){var n=this.db.positions[t],s=this.db.ais[t],e=s.targetPos,o=s.targetID;if(!e||math_1.dist(n,e)<closeDistance){var a=this.nearestEnemy(t),r=this.db.positions[a];if(a===t&&(r=galaxy_1.randPoint(this.galaxySize)),math_1.dist(n,r)<closeDistance)return void this.stopShip(t);var h=i.find(n,r,[t,a]);return void(h.length>0&&(s.targetID=a,s.targetPos=e=r,this.previousPaths[t]=h))}var p=i.find(n,e,[t,o],this.previousPaths[t]);if(this.newPaths[t]=p,0==p.length)return void this.stopShip(t);var d=Math.min(2,p.length-1),c=p[d];n.yaw=math_1.heading(c,n);var v=math_1.headingToRadians(n.yaw),f=20,l=this.db.motion[t];l.velocityX=Math.cos(v)*f,l.velocityY=Math.sin(v)*f},t.prototype.stopShip=function(t){var i=this.db.motion[t];i.velocityX=0,i.velocityY=0},t.prototype.nearestEnemy=function(t){for(var i=this.db.positions[t],n=Object.keys(this.db.ships).concat(Object.keys(this.db.stations)),s=t,e=-1,o=0,a=n;o<a.length;o++){var r=a[o];if(!(r===t||this.hostility(t,r)<=1)){var h=this.db.positions[r],p=math_1.dist(h,i);(e<0||p<e)&&(s=r,e=p)}}return s},t}();exports.Ai=Ai;
},{"../galaxy":50,"../math":52,"../pathfinding":53,"../util":65,"../weapon":66}],56:[function(require,module,exports){
"use strict";var box_collider_1=require("../collision/box-collider"),galaxy_1=require("../galaxy"),quadtree_1=require("../quadtree"),Collision=function(){function e(e,i){this.db=e;var r=galaxy_1.maxCoord(i);this.quadtree=new quadtree_1.Quadtree(-r,-r,r,r)}return e.prototype.tick=function(){this.quadtree.clear();var e={};for(var i in this.db.collidables){var r=this.db.collidables[i],t=r.length,a=r.width,l=r.mass,o=this.db.positions[i],s=o.x,d=o.y;e[i]=new box_collider_1.BoxCollider(s,d,t,a,l),this.quadtree.insert(i,s,d,s+t,d+a)}for(var h=Object.keys(this.db.collidables),n={},b=0;b<h.length;b++){var i=h[b],c=this.db.collidables[i],u=this.db.positions[i],v=e[i];n[i]=!0;for(var s=u.x,d=u.y,x=c.length,a=c.width,g=this.quadtree.retrieve(s,d,s+x,d+a),y=0,q=g;y<q.length;y++){var f=q[y];if(!n[f]){var _=this.db.collidables[f];if(c.ignore!=f&&_.ignore!=i){var p=this.db.positions[f],m=e[f];if(v.isOverlap(m)){v.resolveCollision(m),u.x=v.x,u.y=v.y,p.x=m.x,p.y=m.y;var C=this.db.healths[i],w=this.db.healths[f];C&&C.damage(_.damage),w&&w.damage(c.damage)}}}}}},e}();exports.Collision=Collision;
},{"../collision/box-collider":41,"../galaxy":50,"../quadtree":54}],57:[function(require,module,exports){
"use strict";var Death=function(){function t(t){this.db=t}return t.prototype.tick=function(){for(var t in this.db.healths)this.db.healths[t].hp<=0&&this.db.remove(t)},t}();exports.Death=Death;
},{}],58:[function(require,module,exports){
"use strict";var ENERGY_TOTAL=200,SPOOL_SECS=10,TICK_RATE=30,Ftl=function(){function t(t){this.db=t}return t.prototype.tick=function(){for(var t in this.db.ftl)this.tickOne(t)},t.prototype.tickOne=function(t){var r=this.db.ftl[t];if(r&&null!=r.progress){var o=1,s=this.db.power[t];s&&(o=s.ftl);var e=o/(SPOOL_SECS*TICK_RATE),i=this.db.resources[t];if(i){var n=e*ENERGY_TOTAL;i.energy<n?e=0:i.energy-=n}if(r.progress+=e,0===e?r.eta=-1:r.eta=(1-r.progress)/e/TICK_RATE,r.progress>=1){var l=this.db.positions[t];l?(l.x=r.x,l.y=r.y):console.error("motion: entity has no position",t),r.x=null,r.y=null,r.progress=null,r.eta=null}}},t}();exports.Ftl=Ftl;
},{}],59:[function(require,module,exports){
"use strict";var Components=require("../components"),weapon_1=require("../weapon"),MAX_TURN_SPEED=5,MAX_POWER_PER_SYSTEM=.75,Input=function(){function o(o){this.db=o}return o.prototype.tick=function(){for(var o in this.db.inputs)for(var t=this.db.inputs[o];t.length>0;)this.apply(o,t.shift(),!0)},o.prototype.apply=function(o,t,p){var n=this.db.positions[o],r=this.db.prevPositions[o],e=this.db.motion[o],s=this.db.power[o],l=this.db.healths[o],i=this.db.ftl[o];if(i&&(t.abortJump?(i.x=null,i.y=null,i.progress=null,i.eta=null):t.spoolJump&&null!=t.spoolJump.x&&null!=t.spoolJump.y&&(i.x=t.spoolJump.x,i.y=t.spoolJump.y,i.progress=0)),null!=s){for(var u=Object.keys(Components.Power.prototype.props).length*MAX_POWER_PER_SYSTEM,a=u,h=0,f=Components.Power.prototype.props;h<f.length;h++){var d=f[h];a-=s[d]}for(var d in t.power){var y=s[d],v=t.power[d]-y;v>a&&(v=a),y+v>1&&(v=1-y),y+v<0&&(v=-y),s[d]+=v,a-=v}}if(null!=e&&(e.thrust=t.thrust),null!=n){var v=MAX_TURN_SPEED*t.turn*s.maneuvering;r&&(r.yaw=n.yaw,r.roll=n.roll),n.yaw+=v,n.roll-=v/180*Math.PI/2}if(p&&n)for(var b=0,m=t.fireWeapons;b<m.length;b++){var w=m[b],_=w.heading;weapon_1.fireWeapon(this.db,o,w.weapon,_)}l&&t.toggleShield&&(l.shieldsUp=!l.shieldsUp)},o}();exports.Input=Input;
},{"../components":43,"../weapon":66}],60:[function(require,module,exports){
"use strict";var RANGE=1e4,Laser=function(){function t(t){this.db=t}return t.prototype.tick=function(){for(var t in this.db.lasers){var r=this.db.odometers[t].meters;r>0&&(this.db.motion[t].thrust=0);var s=this.db.lasers[t];r>s.range&&this.db.remove(t)}},t}();exports.Laser=Laser;
},{}],61:[function(require,module,exports){
"use strict";var Missile=function(){function s(s){this.db=s}return s.prototype.tick=function(){for(var s in this.db.missiles){var i=this.db.odometers[s].meters;i>3e3&&(this.db.motion[s].thrust=0);var t=this.db.missiles[s];this.db.odometers[s].meters>t.range&&this.db.remove(s)}},s}();exports.Missile=Missile;
},{}],62:[function(require,module,exports){
"use strict";var galaxy_1=require("../galaxy"),math_1=require("../math"),THRUST_ENERGY=.1,Motion=function(){function o(o,t){this.db=o,this.maxCoord=galaxy_1.maxCoord(t),this.minCoord=-this.maxCoord}return o.prototype.tick=function(){for(var o in this.db.motion)this.tickOne(o)},o.prototype.tickOne=function(o){var t=this.db.motion[o],i=this.db.positions[o],r=this.db.power[o],n=this.db.resources[o];if(!t)return void console.error("motion: entity has no motion",o);if(!i)return void console.error("motion: entity has no position",o);var e=t.thrust;if(r&&(e*=r.engine),n){var a=Math.abs(e)*THRUST_ENERGY;n.energy<a?e=0:n.energy-=a}var s=math_1.radians(i.yaw-90),h=e*Math.cos(s),m=e*Math.sin(s);t.velocityX+=h,t.velocityY-=m,i.x+=t.velocityX,i.y+=t.velocityY,i.x=math_1.clamp(i.x,this.minCoord,this.maxCoord),i.y=math_1.clamp(i.y,this.minCoord,this.maxCoord),i.roll*=.95,i.roll<.01&&(i.roll=0);var l=this.db.odometers[o];null!=l&&(l.meters+=math_1.hypot(t.velocityX,t.velocityY))},o}();exports.Motion=Motion;
},{"../galaxy":50,"../math":52}],63:[function(require,module,exports){
"use strict";var DEFAULT_SHIELD_POWER_LEVEL=.75,SHIELD_REGEN_RATE=.02,SHIELD_ENERGY=.02,Shields=function(){function s(s){this.db=s}return s.prototype.tick=function(){for(var s in this.db.healths){var E=this.db.healths[s];if(E.shieldsUp){var i=this.db.resources[s];i.energy<SHIELD_ENERGY?E.shieldsUp=!1:i.energy-=SHIELD_ENERGY}if(!(E.shields>=E.shieldsMax)){var e=this.db.power[s],h=e?e.shields:DEFAULT_SHIELD_POWER_LEVEL,t=h*SHIELD_REGEN_RATE;E.shields=Math.min(E.shields+t,E.shieldsMax)}}},s}();exports.Shields=Shields;
},{}],64:[function(require,module,exports){
"use strict";var math_1=require("../math"),util_1=require("../util"),components_1=require("../components"),Station=function(){function t(t){this.db=t,this.restockTick=util_1.every(1,this.restockShips.bind(this))}return t.prototype.tick=function(){var t=+new Date;this.lastTick||(this.lastTick=t);var s=(t-this.lastTick)/1e3;for(var i in this.db.stations)this.tickOne(i,s);this.lastTick=t,this.restockTick()},t.prototype.restockShips=function(){for(var t in this.db.stations){var s=this.db.positions[t];for(var i in this.db.ships){var r=this.db.positions[i];if(math_1.dist(s,r)<1e3){this.transferResources(t,i);break}}}},t.prototype.transferResources=function(t,s){for(var i=this.db.resources[t],r=this.db.resources[s],o=0,e=components_1.Resources.prototype.props;o<e.length;o++){var n=e[o];r[n]=(r[n]||0)+(i[n]||0),i[n]=0}},t.prototype.tickOne=function(t,s){var i=this.db.stations[t],r=this.db.resources[t];for(var o in i.produces)Math.random()<s/i.produces[o]&&(r[o]=(r[o]||0)+1)},t}();exports.Station=Station;
},{"../components":43,"../math":52,"../util":65}],65:[function(require,module,exports){
"use strict";function every(r,e){var i=0,f=1e3*r;return function(){var r=+new Date;return r-i>f?(i=r,e()):null}}function numberToSI(r){var e=r>=0?1:-1;r<0&&(r*=-1);for(var i=0,f=ranges;i<f.length;i++){var n=f[i];if(r>=n.divider)return{n:e*(r/n.divider),prefix:n.suffix}}return{n:e*r,prefix:""}}function formatNumber(r,e){void 0===e&&(e=2);var i=numberToSI(r),f=i.n,n=i.prefix;return f.toFixed(e)+n}exports.every=every;var ranges=[{divider:1e18,suffix:"P"},{divider:1e15,suffix:"E"},{divider:1e12,suffix:"T"},{divider:1e9,suffix:"G"},{divider:1e6,suffix:"M"},{divider:1e3,suffix:"k"}];exports.numberToSI=numberToSI,exports.formatNumber=formatNumber;
},{}],66:[function(require,module,exports){
"use strict";function fireWeapon(e,r,s,a){var i=e.positions[r],n=s.angle,p=s.range,t=s.type,o=s.damage,y=s.direction,l=math_1.degrees(n)/2,u=Math.abs((i.yaw+math_1.degrees(y)-a+180+360)%360-180);if(u>l)return!1;e.resources[r];return t===WeaponType.Laser?!!laser_1.SpawnLaser(e,r,i.x,i.y,a,p,o):t==WeaponType.Missile&&!!missile_1.SpawnMissile(e,r,i.x,i.y,a,p)}var laser_1=require("./entity/laser"),missile_1=require("./entity/missile"),math_1=require("./math");!function(e){e[e.Laser=1]="Laser",e[e.Missile=2]="Missile"}(exports.WeaponType||(exports.WeaponType={}));var WeaponType=exports.WeaponType;exports.fireWeapon=fireWeapon;
},{"./entity/laser":46,"./entity/missile":47,"./math":52}],67:[function(require,module,exports){
"use strict";var Conditioner=function(){function e(e){var n=this;this.latency=0,this.packetLoss=0,this.receiveTimeoutId=null,this.sendTimeoutId=null,this.conn=e,e.onMessage=this.proxyOnMessage.bind(this),e.onOpen=function(){n.onOpen&&n.onOpen()},e.onClose=function(){clearTimeout(n.receiveTimeoutId),clearTimeout(n.sendTimeoutId),n.onClose&&n.onClose()}}return e.prototype.proxyOnMessage=function(e,n,t){var o=this;this.onMessage&&(!n&&Math.random()<this.packetLoss||(this.latency>0?this.receiveTimeoutId=window.setTimeout(function(){o.onMessage(e,n,t)},this.latency):this.onMessage(e,n,t)))},e.prototype.send=function(e,n){var t=this;!n&&Math.random()<this.packetLoss||(this.latency>0?this.sendTimeoutId=window.setTimeout(function(){t.conn.send(e,n)},this.latency):this.conn.send(e,n))},e.prototype.close=function(){this.conn.close()},e}();exports.Conditioner=Conditioner;
},{}],68:[function(require,module,exports){
"use strict";var Loopback=function(){function o(){var o=this.a=new LoopbackConnection,e=this.b=new LoopbackConnection;o.receiver=e,e.receiver=o}return o.prototype.open=function(){this.a.open=!0,this.b.open=!0,this.a.onOpen&&this.a.onOpen(),this.b.onOpen&&this.b.onOpen()},o}();exports.Loopback=Loopback;var LoopbackConnection=function(){function o(){this.open=!1}return o.prototype.send=function(o,e){if(!this.open)return void console.error("connection closed");if(this.receiver.onMessage){var n=JSON.stringify(o),t=n.length;this.receiver.onMessage(JSON.parse(n),e,t)}},o.prototype.close=function(){this.open=!1,this.receiver.open&&this.receiver.close(),this.onClose&&this.onClose()},o}();
},{}],69:[function(require,module,exports){
"use strict";!function(e){e[e.Helm=0]="Helm",e[e.Comms=1]="Comms",e[e.Science=2]="Science",e[e.Weapons=3]="Weapons",e[e.Engineering=4]="Engineering"}(exports.Station||(exports.Station={}));var Station=exports.Station;
},{}],70:[function(require,module,exports){
"use strict";function encodeRSD(e){return btoa(JSON.stringify(e)).replace(/=+/g,"")}function decodeRSD(e){return new RTCSessionDescription(JSON.parse(atob(e)))}function pack(e){return JSON.stringify(e)}function unpack(e){return JSON.parse(e)}exports.encodeRSD=encodeRSD,exports.decodeRSD=decodeRSD;var WebRTCConnection=function(){function e(e){this.open=!1;var n=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;this.peer=new n(e)}return e.prototype.send=function(e,n){if(!this.open)return void console.error("connection closed");var t=pack({msg:e});if(n){var i=16384;t.length>i&&this.reliable.send(pack({pieces:Math.ceil(t.length/i)}));for(var o=0;o<t.length;o+=i)this.reliable.send(t.substr(o,i))}else this.unreliable.send(t)},e.prototype.close=function(){this.reliable&&(this.reliable.close(),this.reliable=null),this.unreliable&&(this.unreliable.close(),this.unreliable=null),this.peer.close(),this.pokeState()},e.prototype.makeOffer=function(){var e=this;return this.reliable=this.peer.createDataChannel("reliable"),this.unreliable=this.peer.createDataChannel("unreliable",{ordered:!1,maxRetransmits:0}),this.setupChan(this.reliable,!0),this.setupChan(this.unreliable,!1),new Promise(function(n,t){e.peer.onicecandidate=function(t){t.candidate||n(e.peer.localDescription)},e.peer.createOffer(function(n){e.peer.setLocalDescription(n,function(){},t)},t)})},e.prototype.takeOffer=function(e){var n=this;return this.peer.ondatachannel=function(e){var t=e.channel;if("reliable"==t.label)n.reliable=t,n.setupChan(t,!0);else{if("unreliable"!=t.label)return void console.error("unexpected channel:",t.label);n.unreliable=t,n.setupChan(t,!1)}},new Promise(function(t,i){n.peer.onicecandidate=function(e){e.candidate||t(n.peer.localDescription)},n.peer.setRemoteDescription(e,function(){n.peer.createAnswer(function(e){n.peer.setLocalDescription(e,function(){},i)},i)},i)})},e.prototype.takeAnswer=function(e){var n=this;return new Promise(function(t,i){n.peer.setRemoteDescription(e,t,i)})},e.prototype.setupChan=function(e,n){var t=this;e.onopen=e.onclose=this.pokeState.bind(this);var i="",o=0;e.onmessage=function(e){if(t.onMessage){if(o>0)return i+=e.data,void(o-=1);var r=i.length?i:e.data,s=unpack(r);if(s.pieces>0)return i="",void(o=s.pieces);t.onMessage(s.msg,n,r.length),i.length&&(i="")}}},e.prototype.pokeState=function(){var e=this.reliable&&this.unreliable&&"open"==this.reliable.readyState&&"open"==this.unreliable.readyState;e!=this.open&&(this.open=e,e?this.onOpen&&this.onOpen():this.onClose&&this.onClose())},e}();exports.WebRTCConnection=WebRTCConnection;
},{}],71:[function(require,module,exports){
(function (global){
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.listComponent=t()}}(function(){return require=function t(e,n,i){function r(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return r(n?n:t)},f,f.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";var i=t("./util"),r=t("./Queue"),o=function(){function t(t){this.root=null,this.compare=t||i.defaultCompare,this.nElements=0}return t.prototype.add=function(t){return!i.isUndefined(t)&&(null!==this.insertNode(this.createNode(t))&&(this.nElements++,!0))},t.prototype.clear=function(){this.root=null,this.nElements=0},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.size=function(){return this.nElements},t.prototype.contains=function(t){return!i.isUndefined(t)&&null!==this.searchNode(this.root,t)},t.prototype.remove=function(t){var e=this.searchNode(this.root,t);return null!==e&&(this.removeNode(e),this.nElements--,!0)},t.prototype.inorderTraversal=function(t){this.inorderTraversalAux(this.root,t,{stop:!1})},t.prototype.preorderTraversal=function(t){this.preorderTraversalAux(this.root,t,{stop:!1})},t.prototype.postorderTraversal=function(t){this.postorderTraversalAux(this.root,t,{stop:!1})},t.prototype.levelTraversal=function(t){this.levelTraversalAux(this.root,t)},t.prototype.minimum=function(){if(!this.isEmpty())return this.minimumAux(this.root).element},t.prototype.maximum=function(){if(!this.isEmpty())return this.maximumAux(this.root).element},t.prototype.forEach=function(t){this.inorderTraversal(t)},t.prototype.toArray=function(){var t=[];return this.inorderTraversal(function(e){return t.push(e),!0}),t},t.prototype.height=function(){return this.heightAux(this.root)},t.prototype.searchNode=function(t,e){for(var n=null;null!==t&&0!==n;)n=this.compare(e,t.element),n<0?t=t.leftCh:n>0&&(t=t.rightCh);return t},t.prototype.transplant=function(t,e){null===t.parent?this.root=e:t===t.parent.leftCh?t.parent.leftCh=e:t.parent.rightCh=e,null!==e&&(e.parent=t.parent)},t.prototype.removeNode=function(t){if(null===t.leftCh)this.transplant(t,t.rightCh);else if(null===t.rightCh)this.transplant(t,t.leftCh);else{var e=this.minimumAux(t.rightCh);e.parent!==t&&(this.transplant(e,e.rightCh),e.rightCh=t.rightCh,e.rightCh.parent=e),this.transplant(t,e),e.leftCh=t.leftCh,e.leftCh.parent=e}},t.prototype.inorderTraversalAux=function(t,e,n){null===t||n.stop||(this.inorderTraversalAux(t.leftCh,e,n),n.stop||(n.stop=e(t.element)===!1,n.stop||this.inorderTraversalAux(t.rightCh,e,n)))},t.prototype.levelTraversalAux=function(t,e){var n=new r.default;for(null!==t&&n.enqueue(t);!n.isEmpty();){if(t=n.dequeue(),e(t.element)===!1)return;null!==t.leftCh&&n.enqueue(t.leftCh),null!==t.rightCh&&n.enqueue(t.rightCh)}},t.prototype.preorderTraversalAux=function(t,e,n){null===t||n.stop||(n.stop=e(t.element)===!1,n.stop||(this.preorderTraversalAux(t.leftCh,e,n),n.stop||this.preorderTraversalAux(t.rightCh,e,n)))},t.prototype.postorderTraversalAux=function(t,e,n){null===t||n.stop||(this.postorderTraversalAux(t.leftCh,e,n),n.stop||(this.postorderTraversalAux(t.rightCh,e,n),n.stop||(n.stop=e(t.element)===!1)))},t.prototype.minimumAux=function(t){for(;null!==t.leftCh;)t=t.leftCh;return t},t.prototype.maximumAux=function(t){for(;null!==t.rightCh;)t=t.rightCh;return t},t.prototype.heightAux=function(t){return null===t?-1:Math.max(this.heightAux(t.leftCh),this.heightAux(t.rightCh))+1},t.prototype.insertNode=function(t){for(var e=null,n=this.root,i=null;null!==n;){if(i=this.compare(t.element,n.element),0===i)return null;i<0?(e=n,n=n.leftCh):(e=n,n=n.rightCh)}return t.parent=e,null===e?this.root=t:this.compare(t.element,e.element)<0?e.leftCh=t:e.rightCh=t,t},t.prototype.createNode=function(t){return{element:t,leftCh:null,rightCh:null,parent:null}},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=o},{"./Queue":11,"./util":15}],2:[function(t,e,n){"use strict";var i=t("./util"),r=t("./Dictionary"),o=t("./Set"),s=function(){function t(t){this.toStrF=t||i.defaultToString,this.dictionary=new r.default(this.toStrF),this.nElements=0}return t.prototype.add=function(t,e){if(void 0===e&&(e=1),i.isUndefined(t)||e<=0)return!1;if(this.contains(t))this.dictionary.getValue(t).copies+=e;else{var n={value:t,copies:e};this.dictionary.setValue(t,n)}return this.nElements+=e,!0},t.prototype.count=function(t){return this.contains(t)?this.dictionary.getValue(t).copies:0},t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.remove=function(t,e){if(void 0===e&&(e=1),i.isUndefined(t)||e<=0)return!1;if(this.contains(t)){var n=this.dictionary.getValue(t);return e>n.copies?this.nElements-=n.copies:this.nElements-=e,n.copies-=e,n.copies<=0&&this.dictionary.remove(t),!0}return!1},t.prototype.toArray=function(){for(var t=[],e=this.dictionary.values(),n=0,i=e;n<i.length;n++)for(var r=i[n],o=r.value,s=r.copies,u=0;u<s;u++)t.push(o);return t},t.prototype.toSet=function(){for(var t=new o.default(this.toStrF),e=this.dictionary.values(),n=0,i=e;n<i.length;n++){var r=i[n],s=r.value;t.add(s)}return t},t.prototype.forEach=function(t){this.dictionary.forEach(function(e,n){for(var i=n.value,r=n.copies,o=0;o<r;o++)if(t(i)===!1)return!1;return!0})},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return 0===this.nElements},t.prototype.clear=function(){this.nElements=0,this.dictionary.clear()},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=s},{"./Dictionary":3,"./Set":12,"./util":15}],3:[function(t,e,n){"use strict";var i=t("./util"),r=function(){function t(t){this.table={},this.nElements=0,this.toStr=t||i.defaultToString}return t.prototype.getValue=function(t){var e=this.table["$"+this.toStr(t)];if(!i.isUndefined(e))return e.value},t.prototype.setValue=function(t,e){if(!i.isUndefined(t)&&!i.isUndefined(e)){var n,r="$"+this.toStr(t),o=this.table[r];return i.isUndefined(o)?(this.nElements++,n=void 0):n=o.value,this.table[r]={key:t,value:e},n}},t.prototype.remove=function(t){var e="$"+this.toStr(t),n=this.table[e];if(!i.isUndefined(n))return delete this.table[e],this.nElements--,n.value},t.prototype.keys=function(){var t=[];for(var e in this.table)if(i.has(this.table,e)){var n=this.table[e];t.push(n.key)}return t},t.prototype.values=function(){var t=[];for(var e in this.table)if(i.has(this.table,e)){var n=this.table[e];t.push(n.value)}return t},t.prototype.forEach=function(t){for(var e in this.table)if(i.has(this.table,e)){var n=this.table[e],r=t(n.key,n.value);if(r===!1)return}},t.prototype.containsKey=function(t){return!i.isUndefined(this.getValue(t))},t.prototype.clear=function(){this.table={},this.nElements=0},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){var t="{";return this.forEach(function(e,n){t+="\n\t"+e+" : "+n}),t+"\n}"},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{"./util":15}],4:[function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},r=t("./Dictionary"),o=t("./util"),s=function(t){function e(e,n){t.call(this,n),this.defaultFactoryFunction=e}return i(e,t),e.prototype.setDefault=function(e,n){var i=t.prototype.getValue.call(this,e);return o.isUndefined(i)?(this.setValue(e,n),n):i},e.prototype.getValue=function(t){return this.setDefault(t,this.defaultFactoryFunction())},e}(r.default);Object.defineProperty(n,"__esModule",{value:!0}),n.default=s},{"./Dictionary":3,"./util":15}],5:[function(t,e,n){"use strict";var i=t("./util"),r=t("./arrays"),o=function(){function t(t){this.data=[],this.compare=t||i.defaultCompare}return t.prototype.leftChildIndex=function(t){return 2*t+1},t.prototype.rightChildIndex=function(t){return 2*t+2},t.prototype.parentIndex=function(t){return Math.floor((t-1)/2)},t.prototype.minIndex=function(t,e){return e>=this.data.length?t>=this.data.length?-1:t:this.compare(this.data[t],this.data[e])<=0?t:e},t.prototype.siftUp=function(t){for(var e=this.parentIndex(t);t>0&&this.compare(this.data[e],this.data[t])>0;)r.swap(this.data,e,t),t=e,e=this.parentIndex(t)},t.prototype.siftDown=function(t){for(var e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t));e>=0&&this.compare(this.data[t],this.data[e])>0;)r.swap(this.data,e,t),t=e,e=this.minIndex(this.leftChildIndex(t),this.rightChildIndex(t))},t.prototype.peek=function(){return this.data.length>0?this.data[0]:void 0},t.prototype.add=function(t){if(!i.isUndefined(t))return this.data.push(t),this.siftUp(this.data.length-1),!0},t.prototype.removeRoot=function(){if(this.data.length>0){var t=this.data[0];return this.data[0]=this.data[this.data.length-1],this.data.splice(this.data.length-1,1),this.data.length>0&&this.siftDown(0),t}},t.prototype.contains=function(t){var e=i.compareToEquals(this.compare);return r.contains(this.data,t,e)},t.prototype.size=function(){return this.data.length},t.prototype.isEmpty=function(){return this.data.length<=0},t.prototype.clear=function(){this.data.length=0},t.prototype.forEach=function(t){r.forEach(this.data,t)},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=o},{"./arrays":14,"./util":15}],6:[function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},r=t("./Dictionary"),o=t("./util"),s=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.unlink=function(){this.prev.next=this.next,this.next.prev=this.prev},t}(),u=function(t){function e(e){t.call(this,e),this.head=new s(null,null),this.tail=new s(null,null),this.head.next=this.tail,this.tail.prev=this.head}return i(e,t),e.prototype.appendToTail=function(t){var e=this.tail.prev;e.next=t,t.prev=e,t.next=this.tail,this.tail.prev=t},e.prototype.getLinkedDictionaryPair=function(t){if(!o.isUndefined(t)){var e="$"+this.toStr(t),n=this.table[e];return n}},e.prototype.getValue=function(t){var e=this.getLinkedDictionaryPair(t);if(!o.isUndefined(e))return e.value},e.prototype.remove=function(e){var n=this.getLinkedDictionaryPair(e);if(!o.isUndefined(n))return t.prototype.remove.call(this,e),n.unlink(),n.value},e.prototype.clear=function(){t.prototype.clear.call(this),this.head.next=this.tail,this.tail.prev=this.head},e.prototype.replace=function(t,e){var n="$"+this.toStr(e.key);e.next=t.next,e.prev=t.prev,this.remove(t.key),e.prev.next=e,e.next.prev=e,this.table[n]=e,++this.nElements},e.prototype.setValue=function(t,e){if(!o.isUndefined(t)&&!o.isUndefined(e)){var n=this.getLinkedDictionaryPair(t),i=new s(t,e),r="$"+this.toStr(t);return o.isUndefined(n)?(this.appendToTail(i),this.table[r]=i,void++this.nElements):(this.replace(n,i),n.value)}},e.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(e)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},e.prototype.forEach=function(t){for(var e=this.head.next;null!=e.next;){var n=t(e.key,e.value);if(n===!1)return;e=e.next}},e}(r.default);Object.defineProperty(n,"__esModule",{value:!0}),n.default=u},{"./Dictionary":3,"./util":15}],7:[function(t,e,n){"use strict";var i=t("./util"),r=t("./arrays"),o=function(){function t(){this.firstNode=null,this.lastNode=null,this.nElements=0}return t.prototype.add=function(t,e){if(i.isUndefined(e)&&(e=this.nElements),e<0||e>this.nElements||i.isUndefined(t))return!1;var n=this.createNode(t);if(0===this.nElements)this.firstNode=n,this.lastNode=n;else if(e===this.nElements)this.lastNode.next=n,this.lastNode=n;else if(0===e)n.next=this.firstNode,this.firstNode=n;else{var r=this.nodeAtIndex(e-1);n.next=r.next,r.next=n}return this.nElements++,!0},t.prototype.first=function(){if(null!==this.firstNode)return this.firstNode.element},t.prototype.last=function(){if(null!==this.lastNode)return this.lastNode.element},t.prototype.elementAtIndex=function(t){var e=this.nodeAtIndex(t);if(null!==e)return e.element},t.prototype.indexOf=function(t,e){var n=e||i.defaultEquals;if(i.isUndefined(t))return-1;for(var r=this.firstNode,o=0;null!==r;){if(n(r.element,t))return o;o++,r=r.next}return-1},t.prototype.contains=function(t,e){return this.indexOf(t,e)>=0},t.prototype.remove=function(t,e){var n=e||i.defaultEquals;if(this.nElements<1||i.isUndefined(t))return!1;for(var r=null,o=this.firstNode;null!==o;){if(n(o.element,t))return o===this.firstNode?(this.firstNode=this.firstNode.next,o===this.lastNode&&(this.lastNode=null)):o===this.lastNode?(this.lastNode=r,r.next=o.next,o.next=null):(r.next=o.next,o.next=null),this.nElements--,!0;r=o,o=o.next}return!1},t.prototype.clear=function(){this.firstNode=null,this.lastNode=null,this.nElements=0},t.prototype.equals=function(e,n){var r=n||i.defaultEquals;return e instanceof t&&(this.size()===e.size()&&this.equalsAux(this.firstNode,e.firstNode,r))},t.prototype.equalsAux=function(t,e,n){for(;null!==t;){if(!n(t.element,e.element))return!1;t=t.next,e=e.next}return!0},t.prototype.removeElementAtIndex=function(t){if(!(t<0||t>=this.nElements)){var e;if(1===this.nElements)e=this.firstNode.element,this.firstNode=null,this.lastNode=null;else{var n=this.nodeAtIndex(t-1);null===n?(e=this.firstNode.element,this.firstNode=this.firstNode.next):n.next===this.lastNode&&(e=this.lastNode.element,this.lastNode=n),null!==n&&(e=n.next.element,n.next=n.next.next)}return this.nElements--,e}},t.prototype.forEach=function(t){for(var e=this.firstNode;null!==e&&t(e.element)!==!1;)e=e.next},t.prototype.reverse=function(){for(var t=null,e=this.firstNode,n=null;null!==e;)n=e.next,e.next=t,t=e,e=n;n=this.firstNode,this.firstNode=this.lastNode,this.lastNode=n},t.prototype.toArray=function(){for(var t=[],e=this.firstNode;null!==e;)t.push(e.element),e=e.next;return t},t.prototype.size=function(){return this.nElements},t.prototype.isEmpty=function(){return this.nElements<=0},t.prototype.toString=function(){return r.toString(this.toArray())},t.prototype.nodeAtIndex=function(t){if(t<0||t>=this.nElements)return null;if(t===this.nElements-1)return this.lastNode;for(var e=this.firstNode,n=0;n<t;n++)e=e.next;return e},t.prototype.createNode=function(t){return{element:t,next:null}},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=o},{"./arrays":14,"./util":15}],8:[function(t,e,n){"use strict";var i=t("./util"),r=t("./Dictionary"),o=t("./arrays"),s=function(){function t(t,e,n){void 0===n&&(n=!1),this.dict=new r.default(t),this.equalsF=e||i.defaultEquals,this.allowDuplicate=n}return t.prototype.getValue=function(t){var e=this.dict.getValue(t);return i.isUndefined(e)?[]:o.copy(e)},t.prototype.setValue=function(t,e){if(i.isUndefined(t)||i.isUndefined(e))return!1;if(!this.containsKey(t))return this.dict.setValue(t,[e]),!0;var n=this.dict.getValue(t);return!(!this.allowDuplicate&&o.contains(n,e,this.equalsF))&&(n.push(e),!0)},t.prototype.remove=function(t,e){if(i.isUndefined(e)){var n=this.dict.remove(t);return!i.isUndefined(n)}var r=this.dict.getValue(t);return!!o.remove(r,e,this.equalsF)&&(0===r.length&&this.dict.remove(t),!0)},t.prototype.keys=function(){return this.dict.keys()},t.prototype.values=function(){for(var t=this.dict.values(),e=[],n=0,i=t;n<i.length;n++)for(var r=i[n],o=0,s=r;o<s.length;o++){var u=s[o];e.push(u)}return e},t.prototype.containsKey=function(t){return this.dict.containsKey(t)},t.prototype.clear=function(){this.dict.clear()},t.prototype.size=function(){return this.dict.size()},t.prototype.isEmpty=function(){return this.dict.isEmpty()},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=s},{"./Dictionary":3,"./arrays":14,"./util":15}],9:[function(t,e,n){"use strict";var i;!function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER",t[t.INSIDE_AT_END=2]="INSIDE_AT_END",t[t.INSIDE_AT_START=3]="INSIDE_AT_START"}(i||(i={}));var r=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e={}),this.rootIds=t,this.nodes=e,this.initRootIds(),this.initNodes()}return t.prototype.initRootIds=function(){for(var t=0,e=this.rootIds;t<e.length;t++){var n=e[t];this.createEmptyNodeIfNotExist(n)}},t.prototype.initNodes=function(){for(var t in this.nodes)if(this.nodes.hasOwnProperty(t))for(var e=0,n=this.nodes[t];e<n.length;e++){var i=n[e];this.createEmptyNodeIfNotExist(i)}},t.prototype.createEmptyNodeIfNotExist=function(t){this.nodes[t]||(this.nodes[t]=[])},t.prototype.getRootIds=function(){var t=this.rootIds.slice();return t},t.prototype.getNodes=function(){var t={};for(var e in this.nodes)this.nodes.hasOwnProperty(e)&&(t[e]=this.nodes[e].slice());return t},t.prototype.getObject=function(){return{rootIds:this.getRootIds(),nodes:this.getNodes()}},t.prototype.toObject=function(){return this.getObject()},t.prototype.flatten=function(){function t(t){if(n.nodes[t]){var e=n.nodes[t].length;return e}return 0}function e(t,n,i,r){if(void 0===r&&(r=0),t&&n&&i&&n[t]){r++;for(var o=n[t],s=0;s<o.length;s++){var u=o[s];i.push({id:u,level:r,hasParent:!0}),e(u,n,i,r)}r--}}for(var n=this,i=[],r=0;r<this.rootIds.length;r++){var o=this.rootIds[r];i.push({id:o,level:0,hasParent:!1,childrenCount:void 0}),e(o,this.nodes,i,0)}for(var s=0,u=i;s<u.length;s++){var a=u[s];a.childrenCount=t(a.id)}return i},t.prototype.moveIdBeforeId=function(t,e){return this.moveId(t,e,i.BEFORE)},t.prototype.moveIdAfterId=function(t,e){return this.moveId(t,e,i.AFTER)},t.prototype.moveIdIntoId=function(t,e,n){return void 0===n&&(n=!0),n?this.moveId(t,e,i.INSIDE_AT_START):this.moveId(t,e,i.INSIDE_AT_END)},t.prototype.swapRootIdWithRootId=function(t,e){var n=this.findRootId(t),i=this.findRootId(e);this.swapRootPositionWithRootPosition(n,i)},t.prototype.swapRootPositionWithRootPosition=function(t,e){var n=this.rootIds[e];this.rootIds[e]=this.rootIds[t],this.rootIds[t]=n},t.prototype.deleteId=function(t){this.rootDeleteId(t),this.nodeAndSubNodesDelete(t),this.nodeRefrencesDelete(t)},t.prototype.insertIdBeforeId=function(t,e){var n=this.findRootId(t);n>-1&&this.insertIdIntoRoot(e,n);for(var i in this.nodes)if(this.nodes.hasOwnProperty(i)){var r=this.findNodeId(i,t);r>-1&&this.insertIdIntoNode(i,e,r)}},t.prototype.insertIdAfterId=function(t,e){var n=this.findRootId(t);n>-1&&this.insertIdIntoRoot(e,n+1);for(var i in this.nodes)if(this.nodes.hasOwnProperty(i)){var r=this.findNodeId(i,t);r>-1&&this.insertIdIntoNode(i,e,r+1)}},t.prototype.insertIdIntoId=function(t,e){this.nodeInsertAtEnd(t,e),this.nodes[e]=[]},t.prototype.insertIdIntoRoot=function(t,e){if(void 0===e)this.rootInsertAtEnd(t);else if(e<0){var n=this.rootIds.length;this.rootIds.splice(e+n+1,0,t)}else this.rootIds.splice(e,0,t);this.nodes[t]=this.nodes[t]||[]},t.prototype.insertIdIntoNode=function(t,e,n){if(this.nodes[t]=this.nodes[t]||[],this.nodes[e]=this.nodes[e]||[],void 0===n)this.nodeInsertAtEnd(t,e);else if(n<0){var i=this.nodes[t].length;this.nodes[t].splice(n+i+1,0,e)}else this.nodes[t].splice(n,0,e)},t.prototype.moveId=function(t,e,n){var r,o,s=t,u=this.findRootId(s);this.nodes[e]&&(r=e);for(var a in this.nodes)if(this.nodes.hasOwnProperty(a)){o=this.findNodeId(a,e);break}var h,f,l=e,d=this.findRootId(l);this.nodes[e]&&(h=e);for(var a in this.nodes)if(this.nodes.hasOwnProperty(a)){f=this.findNodeId(a,e);break}if(u>-1)if(d>-1)switch(this.rootDelete(u),d>u&&d--,n){case i.BEFORE:this.insertIdIntoRoot(s,d);break;case i.AFTER:this.insertIdIntoRoot(s,d+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(l,s);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(l,s)}else{this.rootDelete(u);for(var a in this.nodes)if(this.nodes.hasOwnProperty(a)){var p=this.findNodeId(a,l);if(p>-1){switch(n){case i.BEFORE:this.insertIdIntoNode(a,s,p);break;case i.AFTER:this.insertIdIntoNode(a,s,p+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(l,s);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(l,s)}break}}}else if(d>-1){for(var a in this.nodes)if(this.nodes.hasOwnProperty(a)){var p=this.findNodeId(a,s);if(p>-1){this.nodeDeleteAtIndex(a,p);break}}switch(n){case i.BEFORE:this.insertIdIntoRoot(s,d);break;case i.AFTER:this.insertIdIntoRoot(s,d+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(l,s);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(l,s)}}else{for(var a in this.nodes)if(this.nodes.hasOwnProperty(a)){var p=this.findNodeId(a,s);if(p>-1){this.nodeDeleteAtIndex(a,p);break}}for(var a in this.nodes)if(this.nodes.hasOwnProperty(a)){var p=this.findNodeId(a,l);if(p>-1){switch(n){case i.BEFORE:this.insertIdIntoNode(a,s,p);break;case i.AFTER:this.insertIdIntoNode(a,s,p+1);break;case i.INSIDE_AT_START:this.nodeInsertAtStart(l,s);break;case i.INSIDE_AT_END:this.nodeInsertAtEnd(l,s)}break}}}},t.prototype.swapArrayElements=function(t,e,n){var i=t[e];return t[e]=t[n],t[n]=i,t},t.prototype.rootDeleteId=function(t){var e=this.findRootId(t);e>-1&&this.rootDelete(e)},t.prototype.nodeAndSubNodesDelete=function(t){for(var e=[],n=0;n<this.nodes[t].length;n++){var i=this.nodes[t][n];this.nodeAndSubNodesDelete(i),e.push(t)}this.nodeDelete(t);for(var n=0;n<e.length;n++)this.nodeDelete(e[n])},t.prototype.nodeRefrencesDelete=function(t){for(var e in this.nodes)if(this.nodes.hasOwnProperty(e))for(var n=0;n<this.nodes[e].length;n++){var i=this.nodes[e][n];i===t&&this.nodeDeleteAtIndex(e,n)}},t.prototype.nodeDelete=function(t){delete this.nodes[t]},t.prototype.findRootId=function(t){return this.rootIds.indexOf(t)},t.prototype.findNodeId=function(t,e){return this.nodes[t].indexOf(e)},t.prototype.findNode=function(t){return this.nodes[t]},t.prototype.nodeInsertAtStart=function(t,e){this.nodes[t].unshift(e)},t.prototype.nodeInsertAtEnd=function(t,e){this.nodes[t].push(e)},t.prototype.rootDelete=function(t){this.rootIds.splice(t,1)},t.prototype.nodeDeleteAtIndex=function(t,e){this.nodes[t].splice(e,1)},t.prototype.rootInsertAtStart=function(t){this.rootIds.unshift(t)},t.prototype.rootInsertAtEnd=function(t){this.rootIds.push(t)},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{}],10:[function(t,e,n){"use strict";var i=t("./util"),r=t("./Heap"),o=function(){function t(t){this.heap=new r.default(i.reverseCompareFunction(t))}return t.prototype.enqueue=function(t){return this.heap.add(t)},t.prototype.add=function(t){return this.heap.add(t)},t.prototype.dequeue=function(){if(0!==this.heap.size()){var t=this.heap.peek();return this.heap.removeRoot(),t}},t.prototype.peek=function(){return this.heap.peek()},t.prototype.contains=function(t){return this.heap.contains(t)},t.prototype.isEmpty=function(){return this.heap.isEmpty()},t.prototype.size=function(){return this.heap.size()},t.prototype.clear=function(){this.heap.clear()},t.prototype.forEach=function(t){this.heap.forEach(t)},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=o},{"./Heap":5,"./util":15}],11:[function(t,e,n){"use strict";var i=t("./LinkedList"),r=function(){function t(){this.list=new i.default}return t.prototype.enqueue=function(t){return this.list.add(t)},t.prototype.add=function(t){return this.list.add(t)},t.prototype.dequeue=function(){if(0!==this.list.size()){var t=this.list.first();return this.list.removeElementAtIndex(0),t}},t.prototype.peek=function(){if(0!==this.list.size())return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.size()<=0},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{"./LinkedList":7}],12:[function(t,e,n){"use strict";var i=t("./util"),r=t("./arrays"),o=t("./Dictionary"),s=function(){function t(t){this.dictionary=new o.default(t)}return t.prototype.contains=function(t){return this.dictionary.containsKey(t)},t.prototype.add=function(t){return!this.contains(t)&&!i.isUndefined(t)&&(this.dictionary.setValue(t,t),!0)},t.prototype.intersection=function(t){var e=this;this.forEach(function(n){return t.contains(n)||e.remove(n),!0})},t.prototype.union=function(t){var e=this;t.forEach(function(t){return e.add(t),!0})},t.prototype.difference=function(t){var e=this;t.forEach(function(t){return e.remove(t),!0})},t.prototype.isSubsetOf=function(t){if(this.size()>t.size())return!1;var e=!0;return this.forEach(function(n){return!!t.contains(n)||(e=!1,!1)}),e},t.prototype.remove=function(t){return!!this.contains(t)&&(this.dictionary.remove(t),!0)},t.prototype.forEach=function(t){this.dictionary.forEach(function(e,n){return t(n)})},t.prototype.toArray=function(){return this.dictionary.values()},t.prototype.isEmpty=function(){return this.dictionary.isEmpty()},t.prototype.size=function(){return this.dictionary.size()},t.prototype.clear=function(){this.dictionary.clear()},t.prototype.toString=function(){return r.toString(this.toArray())},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=s},{"./Dictionary":3,"./arrays":14,"./util":15}],13:[function(t,e,n){"use strict";var i=t("./LinkedList"),r=function(){function t(){this.list=new i.default}return t.prototype.push=function(t){return this.list.add(t,0)},t.prototype.add=function(t){return this.list.add(t,0)},t.prototype.pop=function(){return this.list.removeElementAtIndex(0)},t.prototype.peek=function(){return this.list.first()},t.prototype.size=function(){return this.list.size()},t.prototype.contains=function(t,e){return this.list.contains(t,e)},t.prototype.isEmpty=function(){return this.list.isEmpty()},t.prototype.clear=function(){this.list.clear()},t.prototype.forEach=function(t){this.list.forEach(t)},t}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=r},{"./LinkedList":7}],14:[function(t,e,n){"use strict";function i(t,e,n){for(var i=n||p.defaultEquals,r=t.length,o=0;o<r;o++)if(i(t[o],e))return o;return-1}function r(t,e,n){for(var i=n||p.defaultEquals,r=t.length,o=r-1;o>=0;o--)if(i(t[o],e))return o;return-1}function o(t,e,n){return i(t,e,n)>=0}function s(t,e,n){var r=i(t,e,n);return!(r<0)&&(t.splice(r,1),!0)}function u(t,e,n){for(var i=n||p.defaultEquals,r=t.length,o=0,s=0;s<r;s++)i(t[s],e)&&o++;return o}function a(t,e,n){var i=n||p.defaultEquals;if(t.length!==e.length)return!1;for(var r=t.length,o=0;o<r;o++)if(!i(t[o],e[o]))return!1;return!0}function h(t){return t.concat()}function f(t,e,n){if(e<0||e>=t.length||n<0||n>=t.length)return!1;var i=t[e];return t[e]=t[n],t[n]=i,!0}function l(t){return"["+t.toString()+"]"}function d(t,e){for(var n=0,i=t;n<i.length;n++){var r=i[n];if(e(r)===!1)return}}var p=t("./util");n.indexOf=i,n.lastIndexOf=r,n.contains=o,n.remove=s,n.frequency=u,n.equals=a,n.copy=h,n.swap=f,n.toString=l,n.forEach=d},{"./util":15}],15:[function(t,e,n){"use strict";function i(t,e){return t<e?-1:t===e?0:1}function r(t,e){return t===e}function o(t){return null===t?"COLLECTION_NULL":a(t)?"COLLECTION_UNDEFINED":h(t)?"$s"+t:"$o"+t.toString()}function s(t,e){if(void 0===e&&(e=","),null===t)return"COLLECTION_NULL";if(a(t))return"COLLECTION_UNDEFINED";if(h(t))return t.toString();var i="{",r=!0;for(var o in t)n.has(t,o)&&(r?r=!1:i+=e,i=i+o+":"+t[o]);return i+"}"}function u(t){return"function"==typeof t}function a(t){return"undefined"==typeof t}function h(t){return"[object String]"===Object.prototype.toString.call(t)}function f(t){return u(t)?function(e,n){return t(e,n)*-1}:function(t,e){return t<e?1:t===e?0:-1}}function l(t){return function(e,n){return 0===t(e,n)}}var d=Object.prototype.hasOwnProperty;n.has=function(t,e){return d.call(t,e)},n.defaultCompare=i,n.defaultEquals=r,n.defaultToString=o,n.makeString=s,n.isFunction=u,n.isUndefined=a,n.isString=h,n.reverseCompareFunction=f,n.compareToEquals=l},{}],"typescript-collections":[function(t,e,n){"use strict";var i=t("./arrays");n.arrays=i;var r=t("./Bag");n.Bag=r.default;var o=t("./BSTree");n.BSTree=o.default;var s=t("./Dictionary");n.Dictionary=s.default;var u=t("./Heap");n.Heap=u.default;var a=t("./LinkedDictionary");n.LinkedDictionary=a.default;var h=t("./LinkedList");n.LinkedList=h.default;var f=t("./MultiDictionary");n.MultiDictionary=f.default;var l=t("./FactoryDictionary");n.FactoryDictionary=l.default;var d=t("./FactoryDictionary");n.DefaultDictionary=d.default;var p=t("./Queue");n.Queue=p.default;var c=t("./PriorityQueue");n.PriorityQueue=c.default;var y=t("./Set");n.Set=y.default;var v=t("./Stack");n.Stack=v.default;var m=t("./MultiRootTree");n.MultiRootTree=m.default;var I=t("./util");n.util=I},{"./BSTree":1,"./Bag":2,"./Dictionary":3,"./FactoryDictionary":4,"./Heap":5,"./LinkedDictionary":6,"./LinkedList":7,"./MultiDictionary":8,"./MultiRootTree":9,"./PriorityQueue":10,"./Queue":11,"./Set":12,"./Stack":13,"./arrays":14,"./util":15}]},{},[]),require("typescript-collections")});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"typescript-collections":71}],72:[function(require,module,exports){
"use strict";var debris_1=require("../core/entity/debris"),ship_1=require("../core/entity/ship"),station_1=require("../core/entity/station"),galaxy_1=require("../core/galaxy"),DefaultScenario=function(){function e(){this.name="Default",this.description="A playable scenario mostly for testing purposes."}return e.prototype.start=function(e){var t=function(){return galaxy_1.randCoord(e.findSettings().galaxySize)};ship_1.SpawnShip(e,"Mean",t(),t(),!0,-1),ship_1.SpawnShip(e,"Neutral",t(),t(),!0,0),ship_1.SpawnShip(e,"Friendly",t(),t(),!0,1);for(var r=0;r<2;r++)station_1.SpawnStation(e,null,t(),t());for(var r=0;r<5;r++)debris_1.SpawnAstroidBelt(e,t(),t(),t(),t())},e}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=DefaultScenario;
},{"../core/entity/debris":45,"../core/entity/ship":48,"../core/entity/station":49,"../core/galaxy":50}],73:[function(require,module,exports){
"use strict";var ship_1=require("../core/entity/ship"),station_1=require("../core/entity/station"),galaxy_1=require("../core/galaxy"),GoodLuckScenario=function(){function t(){this.name="Good Luck!",this.description="An unbeatable scenario."}return t.prototype.start=function(t){var e=function(){return galaxy_1.randCoord(t.findSettings().galaxySize)};station_1.SpawnStation(t,null,e(),e());for(var n=0;n<20;n++)ship_1.SpawnShip(t,null,e(),e(),!0,-1)},t}();Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=GoodLuckScenario;
},{"../core/entity/ship":48,"../core/entity/station":49,"../core/galaxy":50}],74:[function(require,module,exports){
"use strict";function registerScenario(e){exports.scenarios.push(e)}exports.scenarios=[],exports.registerScenario=registerScenario;var default_1=require("./default");registerScenario(new default_1.default);var goodluck_1=require("./goodluck");registerScenario(new goodluck_1.default);
},{"./default":72,"./goodluck":73}]},{},[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39])


//# sourceMappingURL=out.js.map